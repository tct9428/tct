const _0x5f0302=_0x3161;function _0x2265(){const _0x419e0f=['delete','failed\x20aft','setconfig','eplaced\x20wi','copyFileSy','dbbackup.i','\x20at\x20','y\x20attempt\x20','er:\x20\x22SQLit','isCommand','setdb','\x20DB\x20restor','concat','\x20cleaned\x20u','nied.','sage','document','file\x20to\x20re','client','place\x20the\x20','.db','⚠️\x20Warning:','\x27\x20authoriz','\x20create\x20DB','sock','ill\x20be\x20val','QLite\x20head','lidation\x20f','5vYnoEx','toLowerCas','config.yml','fromMe','\x20from\x20','extname','or\x20restore','set','is\x20is\x20inde','to\x20downloa','\x0aNote:\x20A\x20b','✅\x20Config\x20r','ascii','\x20sent\x20DB\x20f','ream','\x20and\x20re-in','requires\x20b','itialized\x20','❌\x20Could\x20no','\x20getconfig','.bak_for_s','\x20overwritt','b\x20failure.','\x20(HTTP\x20410','1823162gsUfWP','videoMessa','d\x20after\x20sh','1214745QQWkIk','n/json','edia\x20to\x20do','writeFileS','\x20file\x20exte','\x20could\x20not','nce\x20not\x20av','❌\x20Failed\x20t','bot.db','\x20sent\x20conf','\x20to\x20','\x20no\x20send\x20s','destinatio','video','string','ode\x20found\x20','fileName','\x20DB\x20reinit','o\x20save\x20con','\x20operation','join','sendMessag','17095540oYCiKz','ckup\x20due\x20t','n\x20path.','\x20command\x20\x27','er\x20the\x20pre','[dbbackup]','./data/db','eDatabase\x20','kup\x20after\x20','endsWith','split','DB\x20from\x20ba','ch).\x0a','.yml','inalDestFr','documentMe','ot\x20instanc','\x20header\x20va','\x20media\x20has','ter\x20getdb\x20','stringify','ig\x20file\x20','basename','sep','ssage','tore\x20faile','runtime-co','has','push','ring\x20resto','DB_NAME','existsSync','status','led','.json',').\x20Please\x20','resolve','d\x20media\x20ty',':\x20uploaded','caption','applicatio','\x20setdb\x20res','ompleted\x20f','1607868xLNUMm','❌\x20Uploaded','nfig.json','isArray','quotedMess','r:\x20','Unsupporte','key','\x20setconfig','fig\x20file:\x20','d\x20step)','DB\x20backed\x20','er\x20getdb\x20f','remoteJid','e\x20format\x203','startsWith','response','\x20database\x20','der\x20mismat','audioMessa','ed\x20recover','6253623luqXXu','ttach\x20or\x20r','d\x20for\x20','readFileSy','231pzyCXw','ices\x20to\x20pi','clear','SQLite\x20for','276600eMfWdj','b\x20at\x20','peration.','replace','wnload','getconfig','\x20failed','utf8','ync','ptv','r\x20to\x20be\x20a\x20','\x20cleanup\x20e','o\x20error\x20du','uploaded\x20D','n/octet-st','DB:\x20','failed:\x20','@g.us','dbbackup','\x0aAn\x20attemp','\x20removed\x20o','etdb','age','function','\x20file\x20does','config.jso','ck\x20up\x20new\x20','e-check\x20an','getdb','4QaqSar','includes','ailed','stickerMes','nitialize\x20','ile:\x20','failed','ailable.','e\x20complete','No\x20media\x20n','❌\x20File\x20not','re-upload\x20','er\x20attempt','\x20found:\x20','map','xtMessage','urface\x20ava','operation.','d\x20config\x20f','❌\x20Invalid\x20','mkdirSync','ot\x20restart','image','the\x20file\x20a','in.','extendedTe','length','contextInf','\x20failed\x20to','Expected\x20S','DB\x20(any\x20ex','up\x20to\x20','\x20safeSend\x20','\x20.json','\x20quick\x20cop','\x20replaced\x20','DB_PATH','was\x20made.','message','\x20backup:\x20','slice','o\x20restore\x20','file\x20heade','t\x20validate','config\x20fil','\x20may\x20be\x20re','config.','✅\x20Active\x20D','\x20some\x20serv','relative','trim','or\x20getdb\x20o','text','nsions:\x20.y','2.5.0','ile\x20','jid','unlinkSync','\x20download\x20','ialized\x20af','error','eply\x20to\x20a\x20','sticker','nd\x20try\x20aga','filename\x20/','\x20uploaded\x20','utdown','file:\x20','idated).','pe\x20or\x20no\x20m','311141bVhBcv','d\x20re-uploa','\x0aA\x20recover','y\x20failed:\x20','valid\x20SQLi','shutdown\x20c','❌\x20Please\x20a','\x20initializ','ed\x20for\x20','rror:\x20','ld\x20config\x20','\x20remove\x20ol'];_0x2265=function(){return _0x419e0f;};return _0x2265();}function _0x3161(_0x2f8cda,_0x45b4c6){const _0x4ad69d=_0x2265();return _0x3161=function(_0x170512,_0x3c5a41){_0x170512=_0x170512-(-0x2070+0x1*0x2515+0x1*-0x2de);let _0x3c6f27=_0x4ad69d[_0x170512];return _0x3c6f27;},_0x3161(_0x2f8cda,_0x45b4c6);}(function(_0x1136d5,_0x176da7){const _0x4d475b=_0x3161,_0x368c92=_0x1136d5();while(!![]){try{const _0x352a1d=parseInt(_0x4d475b(0x1f7))/(0x11*0x12e+0x7c6+-0x1a3*0x11)+parseInt(_0x4d475b(0x237))/(0x1*0x234d+-0x2270+-0xdb*0x1)+-parseInt(_0x4d475b(0x23a))/(-0x613+0x2a8+-0x36e*-0x1)*(-parseInt(_0x4d475b(0x2b5))/(-0x2b*0xc1+-0x1efd*-0x1+0x172))+-parseInt(_0x4d475b(0x21f))/(0x106a+-0x5a8+-0xabd*0x1)*(-parseInt(_0x4d475b(0x27b))/(-0x1*-0xd21+0xa43+-0x175e))+parseInt(_0x4d475b(0x294))/(-0x157+-0x27*0x2b+-0x7eb*-0x1)*(parseInt(_0x4d475b(0x298))/(0xa3*-0x20+-0x33b*0x7+0x2b05))+-parseInt(_0x4d475b(0x290))/(-0x36d*0x7+0x2*-0x10cc+0x399c)+-parseInt(_0x4d475b(0x250))/(-0x1*0x1d1a+0x2*0x5ab+0x8e7*0x2);if(_0x352a1d===_0x176da7)break;else _0x368c92['push'](_0x368c92['shift']());}catch(_0x180173){_0x368c92['push'](_0x368c92['shift']());}}}(_0x2265,-0x71267+0x9bb57+0x6fc8d));import _0x269f7b from'fs';import _0x59b66a from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x5f0302(0x2aa);export const version=_0x5f0302(0x1e7);export const priority=0xa1b*-0x2+-0x14c*-0x8+-0x291*-0x4;export const commands=[_0x5f0302(0x2b4),_0x5f0302(0x20d),_0x5f0302(0x29d),_0x5f0302(0x205)];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x974+-0x1*0x83f+-0x17*0xd)*(-0x23b2+-0xb5d*0x3+0x49b1),processedMessageKeys=new Map();function markProcessed(_0x4c86b8){const _0x54d4a3=_0x5f0302;if(!_0x4c86b8)return;if(processedMessageKeys[_0x54d4a3(0x26b)](_0x4c86b8))try{clearTimeout(processedMessageKeys['get'](_0x4c86b8));}catch(_0x7838ea){}const _0x4f667d=setTimeout(()=>processedMessageKeys[_0x54d4a3(0x203)](_0x4c86b8),DEDUPE_TTL_MS);processedMessageKeys[_0x54d4a3(0x226)](_0x4c86b8,_0x4f667d);}function isProcessed(_0x606fc9){const _0x6d6898=_0x5f0302;return _0x606fc9&&processedMessageKeys[_0x6d6898(0x26b)](_0x606fc9);}async function resolveFinalDestFromCtx(_0x307364){const _0x3fbc93=_0x5f0302;try{if(!_0x307364||!_0x307364[_0x3fbc93(0x282)])return null;const _0xc21758=getBotJid(),_0x5068d7=Boolean(_0x307364['key'][_0x3fbc93(0x222)]);if(_0x5068d7)return _0xc21758||null;const _0x263e43=String(_0x307364[_0x3fbc93(0x282)][_0x3fbc93(0x288)]||'');if(!_0x263e43||_0x263e43[_0x3fbc93(0x259)]('@g.us'))return null;const {findings:_0x66929}=userJidFromCtx(_0x307364);if(!Array[_0x3fbc93(0x27e)](_0x66929)||_0x66929[_0x3fbc93(0x1cb)]===0x11*0x31+-0x1*0xa77+0x736)return null;const _0x4697aa=await listSudo();if(!Array[_0x3fbc93(0x27e)](_0x4697aa)||_0x4697aa['length']===-0x14d+0xaf3*-0x1+0xc40)return null;const _0xb22c83=new Set(_0x4697aa[_0x3fbc93(0x2c3)](_0xabcad0=>String(_0xabcad0)));for(const _0x12f267 of _0x66929){if(!_0x12f267?.[_0x3fbc93(0x1e9)]||typeof _0x12f267[_0x3fbc93(0x1e9)]!==_0x3fbc93(0x248))continue;let _0x1f39ba=null;try{_0x1f39ba=normalizeToJid(_0x12f267[_0x3fbc93(0x1e9)]);}catch(_0x1295f3){_0x1f39ba=null;}if(_0x1f39ba&&_0xb22c83[_0x3fbc93(0x26b)](_0x1f39ba))return _0x1f39ba;const _0x4db7af=(String(_0x12f267[_0x3fbc93(0x1e9)])[_0x3fbc93(0x25a)]('@')[0x313*0x1+0x8bd+0x17a*-0x8]||'')[_0x3fbc93(0x25a)](':')[-0xf71+-0xb*-0x23c+-0x923]||null;if(_0x4db7af)for(const _0xf23aa3 of _0xb22c83){const _0x3211f1=String(_0xf23aa3)[_0x3fbc93(0x25a)]('@')[-0x1ad5+-0x1678+0x314d]||null;if(_0x3211f1&&_0x4db7af===_0x3211f1)return _0xf23aa3;}if(_0xb22c83[_0x3fbc93(0x26b)](_0x12f267[_0x3fbc93(0x1e9)]))return _0x12f267[_0x3fbc93(0x1e9)];}return null;}catch(_0x17f8b4){return warn('['+name+(']\x20resolveF'+_0x3fbc93(0x25e)+'omCtx\x20erro'+_0x3fbc93(0x280))+(_0x17f8b4?.[_0x3fbc93(0x1d7)]||_0x17f8b4)),null;}}function setupSendApi(_0x44a588){const _0xf58751=_0x5f0302;if(!_0x44a588)return;if(typeof _0x44a588[_0xf58751(0x24f)+'e']===_0xf58751(0x2af))sendApi=async(_0x41d328,_0x5d355c)=>await _0x44a588['sendMessag'+'e'](_0x41d328,_0x5d355c);else _0x44a588['sock']&&typeof _0x44a588[_0xf58751(0x21b)][_0xf58751(0x24f)+'e']===_0xf58751(0x2af)?sendApi=async(_0x23f171,_0x41f9a4)=>await _0x44a588[_0xf58751(0x21b)][_0xf58751(0x24f)+'e'](_0x23f171,_0x41f9a4):sendApi=null;}async function safeSend(_0x5a3749,_0x5875d9){const _0x28d21a=_0x5f0302;try{if(!_0x5a3749||!_0x5875d9)return;if(sendApi)return await sendApi(_0x5a3749,_0x5875d9);warn(_0x28d21a(0x255)+_0x28d21a(0x245)+_0x28d21a(0x2c5)+'ilable');}catch(_0x3a1877){error(_0x3a1877,'[dbbackup]'+_0x28d21a(0x1d1)+_0x28d21a(0x2bb)),warn(_0x28d21a(0x255)+'\x20safeSend\x20'+_0x28d21a(0x2a8)+(_0x3a1877?.[_0x28d21a(0x1d7)]||_0x3a1877));}}function resolveDbDir(){const _0x3d92de=_0x5f0302,_0x4f0f02=getConfig(),_0x5cfbb5=_0x4f0f02&&_0x4f0f02[_0x3d92de(0x1d5)]?_0x4f0f02['DB_PATH']:_0x3d92de(0x256),_0x4f1d8f=_0x59b66a['isAbsolute'](_0x5cfbb5)?_0x59b66a[_0x3d92de(0x274)](_0x5cfbb5):_0x59b66a[_0x3d92de(0x274)](PROJECT_ROOT,_0x5cfbb5);return _0x4f1d8f;}function ensureInside(_0x57724f,_0x13a575){const _0x301f79=_0x5f0302,_0x15ea0e=_0x59b66a[_0x301f79(0x274)](_0x57724f)+_0x59b66a[_0x301f79(0x267)],_0x35f3b0=_0x59b66a[_0x301f79(0x274)](_0x13a575);return _0x35f3b0[_0x301f79(0x28a)](_0x15ea0e);}function getMediaFromMessage(_0x26c75a){const _0x4ec634=_0x5f0302;if(!_0x26c75a)return null;if(_0x26c75a[_0x4ec634(0x25f)+_0x4ec634(0x268)]){const _0x241067=_0x26c75a['documentMe'+_0x4ec634(0x268)];return{'type':_0x4ec634(0x213),'mediaMsg':_0x26c75a,'fileName':_0x241067[_0x4ec634(0x24a)]||null,'caption':_0x241067[_0x4ec634(0x277)]||null};}if(_0x26c75a['imageMessa'+'ge']||_0x26c75a[_0x4ec634(0x238)+'ge']||_0x26c75a[_0x4ec634(0x28e)+'ge']||_0x26c75a[_0x4ec634(0x2b8)+_0x4ec634(0x212)]){const _0x1598c4=['imageMessa'+'ge',_0x4ec634(0x238)+'ge','audioMessa'+'ge',_0x4ec634(0x2b8)+'sage'];for(const _0xe34352 of _0x1598c4){if(_0x26c75a[_0xe34352])return{'type':_0xe34352[_0x4ec634(0x29b)]('Message',''),'mediaMsg':_0x26c75a,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x52f38e){const _0x4e9346=_0x5f0302,_0x367b83=_0x52f38e[_0x4e9346(0x1d7)]&&_0x52f38e[_0x4e9346(0x1d7)]['extendedTe'+_0x4e9346(0x2c4)];if(!_0x367b83||!_0x367b83['contextInf'+'o']||!_0x367b83['contextInf'+'o'][_0x4e9346(0x27f)+'age'])return null;const _0xdf778c=_0x367b83[_0x4e9346(0x1cc)+'o'][_0x4e9346(0x27f)+_0x4e9346(0x2ae)];return getMediaFromMessage(_0xdf778c);}async function downloadMessageToBuffer(_0x27d90f){const _0xc9dc26=_0x5f0302;if(!_0x27d90f||!_0x27d90f['message']){const _0x39a925=_0x27d90f,_0x57750f=getMediaFromMessage(_0x39a925);if(!_0x57750f)throw new Error(_0xc9dc26(0x2be)+_0xc9dc26(0x249)+_0xc9dc26(0x228)+'d');_0x27d90f={'message':_0x39a925};}const _0x1b5d51=_0x27d90f[_0xc9dc26(0x1d7)]||{},_0x582262=['document',_0xc9dc26(0x1c7),_0xc9dc26(0x247),_0xc9dc26(0x2a1),'audio',_0xc9dc26(0x1ef)];for(const _0x1d5f8d of _0x582262){const _0x3c40b9=_0x1b5d51[_0x1d5f8d+'Message'];if(!_0x3c40b9)continue;const _0x57bea5=await downloadContentFromMessage(_0x3c40b9,_0x1d5f8d),_0xa80519=[];for await(const _0x2c8cce of _0x57bea5)_0xa80519[_0xc9dc26(0x26c)](_0x2c8cce);return Buffer[_0xc9dc26(0x20f)](_0xa80519);}throw new Error(_0xc9dc26(0x281)+_0xc9dc26(0x275)+_0xc9dc26(0x1f6)+_0xc9dc26(0x23c)+_0xc9dc26(0x29c));}export async function initialize(_0xe47711){const _0x23fffa=_0x5f0302;if(!_0xe47711)throw new Error(_0x23fffa(0x208)+_0x23fffa(0x2b9)+_0x23fffa(0x22f)+_0x23fffa(0x260)+'e');botRef=_0xe47711,setupSendApi(botRef),info(_0x23fffa(0x255)+_0x23fffa(0x1fe)+'ed');}export async function onMessage(_0x469c4a){const _0x477d13=_0x5f0302;try{if(!_0x469c4a||!_0x469c4a[_0x477d13(0x282)]||!_0x469c4a[_0x477d13(0x1d7)])return;const _0x4c2ac4=String(_0x469c4a[_0x477d13(0x282)][_0x477d13(0x288)]||'');if(_0x4c2ac4[_0x477d13(0x259)](_0x477d13(0x2a9)))return;const _0x55d6fe=_0x4c2ac4+'::'+String(_0x469c4a[_0x477d13(0x282)]['id']||'');if(isProcessed(_0x55d6fe))return;if(!_0x469c4a[_0x477d13(0x20c)])return;const _0x4141df=_0x469c4a['text']&&typeof _0x469c4a[_0x477d13(0x1e5)]===_0x477d13(0x248)?_0x469c4a[_0x477d13(0x1e5)]['trim']():'';if(!_0x4141df)return;const _0x4238e8=_0x4141df[_0x477d13(0x25a)](/\r?\n/)[0xcb*0x2b+-0xc9*-0xe+0x77*-0x61][_0x477d13(0x1e3)]()[_0x477d13(0x25a)](/\s+/),_0x36c053=(_0x4238e8[0x9*0xe5+0x2*-0x67b+0x3*0x1a3]||'')[_0x477d13(0x220)+'e']();if(!commands[_0x477d13(0x2b6)](_0x36c053))return;if(!botRef)botRef=_0x469c4a['bot']||_0x469c4a[_0x477d13(0x215)]||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn(_0x477d13(0x255)+'\x20bot\x20insta'+_0x477d13(0x240)+_0x477d13(0x2bc));return;}const _0x590aa1=await resolveFinalDestFromCtx(_0x469c4a);if(!_0x590aa1)return;markProcessed(_0x55d6fe),info(_0x477d13(0x255)+_0x477d13(0x253)+_0x36c053+(_0x477d13(0x219)+_0x477d13(0x1ff))+_0x590aa1);if(_0x36c053==='getdb'){const _0x53399c=getConfig(),_0x3ae2ce=resolveDbDir(),_0x417b5f=_0x53399c&&_0x53399c[_0x477d13(0x26e)]?String(_0x53399c[_0x477d13(0x26e)]):_0x477d13(0x242),_0x304110=_0x4238e8[_0x477d13(0x1cb)]>=0x22c5+-0x1*-0x196c+0x1*-0x3c2f?_0x4238e8['slice'](0x20de+-0xce5*-0x1+0x16e1*-0x2)[_0x477d13(0x24e)]('\x20')[_0x477d13(0x1e3)]():_0x417b5f,_0xde548c=_0x59b66a[_0x477d13(0x274)](_0x3ae2ce,_0x304110);if(!ensureInside(_0x3ae2ce,_0xde548c)){await safeSend(_0x590aa1,{'text':_0x477d13(0x2c8)+_0x477d13(0x1f1)+'\x20access\x20de'+_0x477d13(0x211)});return;}if(!_0x269f7b['existsSync'](_0xde548c)){await safeSend(_0x590aa1,{'text':_0x477d13(0x2bf)+_0x477d13(0x2c2)+_0x304110});return;}const _0x333983=_0x59b66a[_0x477d13(0x24e)](_0x3ae2ce,_0x59b66a[_0x477d13(0x266)](_0xde548c)+('.bak_for_g'+'etdb'));let _0x367086=![];try{await shutdownDatabase(),_0x367086=!![],info('[dbbackup]'+_0x477d13(0x28c)+_0x477d13(0x1fc)+_0x477d13(0x27a)+_0x477d13(0x1e4)+_0x477d13(0x29a));try{_0x269f7b[_0x477d13(0x207)+'nc'](_0xde548c,_0x333983),info(_0x477d13(0x255)+_0x477d13(0x1d3)+'y\x20for\x20getd'+_0x477d13(0x299)+_0x333983);}catch(_0x173066){warn(_0x477d13(0x255)+_0x477d13(0x1d3)+_0x477d13(0x1fa)+(_0x173066?.[_0x477d13(0x1d7)]||_0x173066));}const _0x5797ea=_0x269f7b[_0x477d13(0x293)+'nc'](_0xde548c);await safeSend(_0x590aa1,{'document':_0x5797ea,'fileName':_0x59b66a['basename'](_0xde548c),'mimetype':'applicatio'+_0x477d13(0x2a6)+_0x477d13(0x22d)}),info(_0x477d13(0x255)+_0x477d13(0x22c)+_0x477d13(0x1e8)+_0xde548c+_0x477d13(0x244)+_0x590aa1),await initializeDatabase(),info(_0x477d13(0x255)+_0x477d13(0x24b)+_0x477d13(0x1ec)+_0x477d13(0x263)+_0x477d13(0x2c6));}catch(_0xa31feb){error(_0xa31feb,_0x477d13(0x255)+'\x20getdb\x20fai'+_0x477d13(0x271));try{_0x367086&&(await initializeDatabase(),info(_0x477d13(0x255)+_0x477d13(0x1fe)+_0x477d13(0x257)+'attempted\x20'+'after\x20getd'+_0x477d13(0x235)));}catch(_0x7487c){error(_0x7487c,_0x477d13(0x255)+_0x477d13(0x1fe)+_0x477d13(0x257)+_0x477d13(0x204)+_0x477d13(0x287)+'ailure');}await safeSend(_0x590aa1,{'text':_0x477d13(0x241)+'o\x20retrieve'+'\x20DB:\x20'+(_0xa31feb?.[_0x477d13(0x1d7)]||_0xa31feb)+(_0x477d13(0x1f9)+_0x477d13(0x20a)+_0x477d13(0x1d6))});}finally{try{if(_0x269f7b[_0x477d13(0x26f)](_0x333983))_0x269f7b[_0x477d13(0x1ea)](_0x333983);}catch(_0x20f476){}}return;}if(_0x36c053===_0x477d13(0x20d)){let _0x224119=getMediaFromMessage(_0x469c4a[_0x477d13(0x1d7)])||getQuotedMedia(_0x469c4a),_0x420344=!getMediaFromMessage(_0x469c4a[_0x477d13(0x1d7)])&&!!getQuotedMedia(_0x469c4a);if(!_0x224119||!_0x224119['mediaMsg']){await safeSend(_0x590aa1,{'text':_0x477d13(0x1fd)+'ttach\x20or\x20r'+_0x477d13(0x1ee)+_0x477d13(0x214)+_0x477d13(0x216)+_0x477d13(0x1cf)+'tension;\x20w'+_0x477d13(0x21c)+_0x477d13(0x1f5)});return;}const _0xd6fe22=String(_0x224119[_0x477d13(0x24a)]||'')[_0x477d13(0x1e3)](),_0x16ee1d=getConfig(),_0x22798f=resolveDbDir();let _0x4da9ef=_0x16ee1d&&_0x16ee1d[_0x477d13(0x26e)]?String(_0x16ee1d[_0x477d13(0x26e)]):_0x477d13(0x242),_0x3156d6=_0x59b66a['extname'](_0x4da9ef)[_0x477d13(0x220)+'e']();if(!_0x3156d6){_0x4da9ef=_0x4da9ef||_0x477d13(0x242),_0x3156d6=_0x59b66a['extname'](_0x4da9ef)||_0x477d13(0x217);if(!_0x59b66a['extname'](_0x4da9ef))_0x4da9ef=''+_0x4da9ef+_0x3156d6;}const _0x477556=_0x59b66a[_0x477d13(0x274)](_0x22798f,_0x4da9ef);try{_0x269f7b[_0x477d13(0x2c9)](_0x22798f,{'recursive':!![]});}catch(_0x557a4e){}if(!ensureInside(_0x22798f,_0x477556)){await safeSend(_0x590aa1,{'text':_0x477d13(0x2c8)+_0x477d13(0x246)+_0x477d13(0x252)});return;}const _0x1e87d4=_0x420344?_0x469c4a[_0x477d13(0x1d7)][_0x477d13(0x1ca)+'xtMessage'][_0x477d13(0x1cc)+'o']['quotedMess'+_0x477d13(0x2ae)]:_0x469c4a[_0x477d13(0x1d7)];let _0x21db73;try{_0x21db73=await downloadMessageToBuffer(_0x1e87d4);}catch(_0x53fb63){error(_0x53fb63,_0x477d13(0x255)+_0x477d13(0x1cd)+_0x477d13(0x1eb)+_0x477d13(0x2a5)+'B\x20(downloa'+_0x477d13(0x285));const _0x294258=_0x53fb63?.[_0x477d13(0x28b)]?.[_0x477d13(0x270)]||_0x53fb63?.[_0x477d13(0x270)]||null;_0x294258===0x1295+-0x2b*-0xc0+0x3*-0x1069?await safeSend(_0x590aa1,{'text':_0x477d13(0x241)+'o\x20download'+_0x477d13(0x276)+_0x477d13(0x262)+'\x20expired\x20o'+'n\x20WhatsApp'+_0x477d13(0x236)+_0x477d13(0x273)+_0x477d13(0x2c0)+_0x477d13(0x1c8)+_0x477d13(0x1f0)+_0x477d13(0x1c9)}):await safeSend(_0x590aa1,{'text':'❌\x20Failed\x20t'+'o\x20download'+_0x477d13(0x1f2)+_0x477d13(0x1f4)+(_0x53fb63?.[_0x477d13(0x1d7)]||_0x53fb63)});return;}try{const _0x5dea69=_0x21db73[_0x477d13(0x1d9)](0x2275+-0xb57*0x1+0x1*-0x171e,0x230a+-0x2*-0x737+-0x3168),_0x37dcfd=Buffer['from'](_0x477d13(0x297)+'mat\x203\x00',_0x477d13(0x22b));if(!_0x5dea69['equals'](_0x37dcfd)){await safeSend(_0x590aa1,{'text':_0x477d13(0x27c)+_0x477d13(0x2b0)+'\x20not\x20appea'+_0x477d13(0x2a2)+_0x477d13(0x1fb)+'te\x20DB\x20(hea'+_0x477d13(0x28d)+_0x477d13(0x25c)+(_0x477d13(0x1ce)+_0x477d13(0x21d)+_0x477d13(0x20b)+_0x477d13(0x289)+'\x5c0\x22.\x20If\x20th'+_0x477d13(0x227)+'ed\x20a\x20DB,\x20r'+_0x477d13(0x2b3)+_0x477d13(0x1f8)+'d.')});return;}}catch(_0x3478af){error(_0x3478af,_0x477d13(0x255)+_0x477d13(0x261)+_0x477d13(0x21e)+_0x477d13(0x2b7)),await safeSend(_0x590aa1,{'text':_0x477d13(0x231)+_0x477d13(0x1dc)+_0x477d13(0x1f2)+_0x477d13(0x1db)+_0x477d13(0x280)+(_0x3478af?.[_0x477d13(0x1d7)]||_0x3478af)});return;}const _0x5e6d1a=_0x59b66a[_0x477d13(0x24e)](_0x22798f,_0x59b66a[_0x477d13(0x266)](_0x477556)+(_0x477d13(0x233)+_0x477d13(0x2ad)));let _0x42c5c9=![];try{await shutdownDatabase(),_0x42c5c9=!![],info('[dbbackup]'+'\x20database\x20'+_0x477d13(0x1fc)+_0x477d13(0x27a)+_0x477d13(0x225)+_0x477d13(0x24d)+'.');if(_0x269f7b['existsSync'](_0x477556))try{_0x269f7b[_0x477d13(0x207)+'nc'](_0x477556,_0x5e6d1a),info('[dbbackup]'+'\x20existing\x20'+_0x477d13(0x286)+_0x477d13(0x1d0)+_0x5e6d1a);}catch(_0x17b764){warn(_0x477d13(0x255)+_0x477d13(0x1cd)+'\x20create\x20DB'+_0x477d13(0x1d8)+(_0x17b764?.[_0x477d13(0x1d7)]||_0x17b764)),await safeSend(_0x590aa1,{'text':_0x477d13(0x218)+'\x20could\x20not'+_0x477d13(0x21a)+'\x20backup:\x20'+(_0x17b764?.[_0x477d13(0x1d7)]||_0x17b764)});}_0x269f7b[_0x477d13(0x23d)+'ync'](_0x477556,_0x21db73),info(_0x477d13(0x255)+_0x477d13(0x234)+'en\x20DB\x20file'+_0x477d13(0x209)+_0x477556),await initializeDatabase(),await safeSend(_0x590aa1,{'text':_0x477d13(0x1e0)+'B\x20replaced'+_0x477d13(0x22e)+_0x477d13(0x230)+'as:\x20'+_0x59b66a[_0x477d13(0x1e2)](PROJECT_ROOT,_0x477556)}),info(_0x477d13(0x255)+_0x477d13(0x20e)+_0x477d13(0x2bd)+'\x20and\x20DB\x20re'+'initialize'+_0x477d13(0x292)+_0x590aa1);}catch(_0x1ca813){error(_0x1ca813,_0x477d13(0x255)+_0x477d13(0x279)+_0x477d13(0x269)+_0x477d13(0x239)+_0x477d13(0x1f3));try{_0x269f7b[_0x477d13(0x26f)](_0x5e6d1a)&&(_0x269f7b['copyFileSy'+'nc'](_0x5e6d1a,_0x477556),info('[dbbackup]'+'\x20restored\x20'+_0x477d13(0x25b)+_0x477d13(0x251)+_0x477d13(0x2a4)+_0x477d13(0x26d)+'re'));}catch(_0x5ab9a2){error(_0x5ab9a2,_0x477d13(0x255)+_0x477d13(0x1cd)+'\x20restore\x20D'+'B\x20from\x20bac'+_0x477d13(0x258)+_0x477d13(0x1ed));}try{await initializeDatabase();}catch(_0x5d00d9){error(_0x5d00d9,_0x477d13(0x255)+'\x20initializ'+_0x477d13(0x257)+_0x477d13(0x204)+_0x477d13(0x2c1)+_0x477d13(0x28f)+'y');}await safeSend(_0x590aa1,{'text':_0x477d13(0x241)+_0x477d13(0x1da)+_0x477d13(0x2a7)+(_0x1ca813?.[_0x477d13(0x1d7)]||_0x1ca813)+(_0x477d13(0x2ab)+'t\x20to\x20recov'+_0x477d13(0x254)+'vious\x20DB\x20w'+'as\x20made.')});}finally{try{if(_0x269f7b[_0x477d13(0x26f)](_0x5e6d1a))_0x269f7b[_0x477d13(0x1ea)](_0x5e6d1a);}catch(_0x27512c){}}return;}if(_0x36c053===_0x477d13(0x29d)){const _0x2c8df1=findConfigFile();if(_0x2c8df1){try{const _0x34c306=_0x269f7b[_0x477d13(0x293)+'nc'](_0x2c8df1),_0x3ea98a=_0x2c8df1['toLowerCas'+'e']()['endsWith'](_0x477d13(0x272))?_0x477d13(0x278)+_0x477d13(0x23b):'text/x-yam'+'l';await safeSend(_0x590aa1,{'document':_0x34c306,'fileName':_0x59b66a[_0x477d13(0x266)](_0x2c8df1),'mimetype':_0x3ea98a}),info('[dbbackup]'+_0x477d13(0x243)+_0x477d13(0x265)+_0x2c8df1+'\x20to\x20'+_0x590aa1);}catch(_0xb9ee29){error(_0xb9ee29,'[dbbackup]'+_0x477d13(0x232)+'\x20send\x20fail'+'ed'),await safeSend(_0x590aa1,{'text':_0x477d13(0x241)+'o\x20send\x20con'+_0x477d13(0x284)+(_0xb9ee29?.[_0x477d13(0x1d7)]||_0xb9ee29)});}return;}const _0x75785=getConfig()||{},_0x1ae486=Buffer['from'](JSON[_0x477d13(0x264)](_0x75785,null,0x1c31+-0x3*-0xb47+0x2*-0x1f02),'utf8');await safeSend(_0x590aa1,{'document':_0x1ae486,'fileName':_0x477d13(0x26a)+_0x477d13(0x27d),'mimetype':'applicatio'+_0x477d13(0x23b)});return;}if(_0x36c053===_0x477d13(0x205)){let _0x2871c5=getMediaFromMessage(_0x469c4a[_0x477d13(0x1d7)])||getQuotedMedia(_0x469c4a),_0x52893c=!getMediaFromMessage(_0x469c4a[_0x477d13(0x1d7)])&&!!getQuotedMedia(_0x469c4a);if(!_0x2871c5||!_0x2871c5['mediaMsg']){await safeSend(_0x590aa1,{'text':_0x477d13(0x1fd)+_0x477d13(0x291)+_0x477d13(0x1ee)+_0x477d13(0x1dd)+'e.'});return;}const _0x5b8252=String(_0x2871c5[_0x477d13(0x24a)]||'')[_0x477d13(0x1e3)]()[_0x477d13(0x220)+'e'](),_0x2e6bfe=[_0x477d13(0x25d),'.yaml',_0x477d13(0x272)],_0x879f04=_0x59b66a[_0x477d13(0x224)](_0x5b8252||'');if(!_0x2e6bfe[_0x477d13(0x2b6)](_0x879f04)){await safeSend(_0x590aa1,{'text':'❌\x20Accepted'+_0x477d13(0x23e)+_0x477d13(0x1e6)+'ml,\x20.yaml,'+_0x477d13(0x1d2)});return;}const _0x269223=findConfigFile(),_0x12a93c=_0x879f04===_0x477d13(0x272)?_0x477d13(0x2b1)+'n':_0x477d13(0x221),_0x543299=_0x59b66a[_0x477d13(0x274)](PROJECT_ROOT,_0x12a93c);if(!ensureInside(PROJECT_ROOT,_0x543299)){await safeSend(_0x590aa1,{'text':_0x477d13(0x2c8)+'destinatio'+'n\x20path.'});return;}try{const _0x298aad=_0x52893c?_0x469c4a[_0x477d13(0x1d7)][_0x477d13(0x1ca)+'xtMessage']['contextInf'+'o'][_0x477d13(0x27f)+'age']:_0x469c4a[_0x477d13(0x1d7)],_0x35525d=await downloadMessageToBuffer(_0x298aad);_0x269f7b[_0x477d13(0x23d)+_0x477d13(0x2a0)](_0x543299,_0x35525d,{'encoding':_0x477d13(0x29f)});if(_0x269223&&_0x269223!==_0x543299&&_0x269f7b[_0x477d13(0x26f)](_0x269223))try{_0x269f7b[_0x477d13(0x1ea)](_0x269223),info('[dbbackup]'+_0x477d13(0x2ac)+_0x477d13(0x201)+_0x477d13(0x1f4)+_0x269223);}catch(_0x2d2d69){warn('[dbbackup]'+_0x477d13(0x23f)+_0x477d13(0x202)+_0x477d13(0x2c7)+_0x477d13(0x2ba)+(_0x2d2d69?.[_0x477d13(0x1d7)]||_0x2d2d69));}await safeSend(_0x590aa1,{'text':_0x477d13(0x22a)+_0x477d13(0x206)+'th:\x20'+_0x12a93c+(_0x477d13(0x229)+_0x477d13(0x2ca)+_0x477d13(0x1de)+'quired\x20for'+_0x477d13(0x1e1)+_0x477d13(0x295)+_0x477d13(0x2b2)+_0x477d13(0x1df))}),info(_0x477d13(0x255)+_0x477d13(0x1d4)+_0x477d13(0x1dd)+'e\x20'+_0x543299+_0x477d13(0x223)+_0x590aa1);}catch(_0x2d51d4){error(_0x2d51d4,_0x477d13(0x255)+_0x477d13(0x283)+_0x477d13(0x29e)),await safeSend(_0x590aa1,{'text':_0x477d13(0x241)+_0x477d13(0x24c)+'fig:\x20'+(_0x2d51d4?.[_0x477d13(0x1d7)]||_0x2d51d4)});}return;}}catch(_0x84bfea){error(_0x84bfea,_0x477d13(0x255)+'\x20onMessage'+'\x20error:\x20'+(_0x84bfea?.[_0x477d13(0x1d7)]||_0x84bfea));}}export async function cleanup(){const _0x13ce65=_0x5f0302;try{botRef=null,sendApi=null,processedMessageKeys['forEach'](_0x394e7c=>{try{clearTimeout(_0x394e7c);}catch(_0x44998a){}}),processedMessageKeys[_0x13ce65(0x296)](),info('[dbbackup]'+_0x13ce65(0x210)+'p');}catch(_0x5678a6){warn('[dbbackup]'+_0x13ce65(0x2a3)+_0x13ce65(0x200)+(_0x5678a6?.[_0x13ce65(0x1d7)]||_0x5678a6));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};