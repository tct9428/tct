const _0x2e890f=_0x3222;(function(_0x1f3e9b,_0x204e6f){const _0xbc3d79=_0x3222,_0x265525=_0x1f3e9b();while(!![]){try{const _0x1ef675=parseInt(_0xbc3d79(0x12d))/(-0x20d0+-0x1231*0x1+0x3302)+-parseInt(_0xbc3d79(0x10a))/(0x100*0x23+0x2*-0x853+-0x1258)*(-parseInt(_0xbc3d79(0x1a3))/(-0xf31+0x99*-0x1f+-0x311*-0xb))+-parseInt(_0xbc3d79(0x152))/(0x577*-0x1+0x2*-0x466+0x55*0x2b)+parseInt(_0xbc3d79(0x16d))/(-0x90f+0x12ab+-0x997)+parseInt(_0xbc3d79(0x1a1))/(0x2039+-0x70e+-0x1925)*(-parseInt(_0xbc3d79(0x173))/(-0x1*-0x1eab+0x1*-0xa0c+-0x1498))+parseInt(_0xbc3d79(0x141))/(-0x475+0x1*0x12f9+0x39f*-0x4)*(parseInt(_0xbc3d79(0x103))/(-0xb53+-0x23d3+-0x101*-0x2f))+parseInt(_0xbc3d79(0xff))/(-0x3*-0x5f9+-0x5fa+-0xbe7);if(_0x1ef675===_0x204e6f)break;else _0x265525['push'](_0x265525['shift']());}catch(_0x264df){_0x265525['push'](_0x265525['shift']());}}}(_0x1625,-0x2325d+0x11700+0x9aa3d));import _0x247bc0 from'fs';function _0x3222(_0xa48875,_0x369a5e){const _0x548c63=_0x1625();return _0x3222=function(_0x265ab5,_0x32e2da){_0x265ab5=_0x265ab5-(0x2d7+-0x10be*-0x1+-0x12ee*0x1);let _0x11469b=_0x548c63[_0x265ab5];return _0x11469b;},_0x3222(_0xa48875,_0x369a5e);}import _0x28ebda from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name='dbbackup';export const version=_0x2e890f(0xdf);export const priority=-0x7a6+0x29f*0x1+0x575;export const commands=[_0x2e890f(0xde),'setdb',_0x2e890f(0xb2),_0x2e890f(0x155)];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x8b6*-0x1+-0x10*-0x12a+-0x9e0)*(-0x518+0xc74*-0x2+0x46*0x7c),processedMessageKeys=new Map();function markProcessed(_0x264185){const _0x52f35b=_0x2e890f;if(!_0x264185)return;if(processedMessageKeys['has'](_0x264185))try{clearTimeout(processedMessageKeys[_0x52f35b(0xed)](_0x264185));}catch(_0x3aa2f7){}const _0x2f08b2=setTimeout(()=>processedMessageKeys[_0x52f35b(0x11a)](_0x264185),DEDUPE_TTL_MS);processedMessageKeys[_0x52f35b(0x16b)](_0x264185,_0x2f08b2);}function isProcessed(_0xb8aa42){const _0x144bf7=_0x2e890f;return _0xb8aa42&&processedMessageKeys[_0x144bf7(0xd8)](_0xb8aa42);}async function resolveFinalDestFromCtx(_0x3a5323){const _0x3dac9e=_0x2e890f;try{if(!_0x3a5323||!_0x3a5323[_0x3dac9e(0x142)])return null;const _0x50001f=getBotJid(),_0x2714d2=Boolean(_0x3a5323[_0x3dac9e(0x142)]['fromMe']);if(_0x2714d2)return _0x50001f||null;const _0x4dbe2d=String(_0x3a5323[_0x3dac9e(0x142)]['remoteJid']||'');if(!_0x4dbe2d||_0x4dbe2d[_0x3dac9e(0xcb)](_0x3dac9e(0x116)))return null;const {findings:_0x49ca2f}=userJidFromCtx(_0x3a5323);if(!Array[_0x3dac9e(0x160)](_0x49ca2f)||_0x49ca2f[_0x3dac9e(0xc7)]===-0x1bfe+0x167*0x1+0x1a97)return null;const _0x5ef6b2=await listSudo();if(!Array['isArray'](_0x5ef6b2)||_0x5ef6b2['length']===0x1*0x6ac+-0x892+0x1e6)return null;const _0x503fe7=new Set(_0x5ef6b2[_0x3dac9e(0x195)](_0x26adfd=>String(_0x26adfd)));for(const _0x43eb03 of _0x49ca2f){if(!_0x43eb03?.['jid']||typeof _0x43eb03[_0x3dac9e(0xd6)]!==_0x3dac9e(0x139))continue;let _0x6d331b=null;try{_0x6d331b=normalizeToJid(_0x43eb03[_0x3dac9e(0xd6)]);}catch(_0x62724a){_0x6d331b=null;}if(_0x6d331b&&_0x503fe7[_0x3dac9e(0xd8)](_0x6d331b))return _0x6d331b;const _0x1a7b61=(String(_0x43eb03[_0x3dac9e(0xd6)])[_0x3dac9e(0xa9)]('@')[0x2*-0xda1+0x1*0x16e8+-0x45a*-0x1]||'')['split'](':')[0x13bd*-0x1+0x1a5f+-0x6a2]||null;if(_0x1a7b61)for(const _0x554b6f of _0x503fe7){const _0x3a05fc=String(_0x554b6f)[_0x3dac9e(0xa9)]('@')[-0x43*0x79+-0x22b4+0x425f]||null;if(_0x3a05fc&&_0x1a7b61===_0x3a05fc)return _0x554b6f;}if(_0x503fe7[_0x3dac9e(0xd8)](_0x43eb03[_0x3dac9e(0xd6)]))return _0x43eb03[_0x3dac9e(0xd6)];}return null;}catch(_0x20ab7f){return warn('['+name+(_0x3dac9e(0x197)+_0x3dac9e(0xe9)+_0x3dac9e(0x171)+'r:\x20')+(_0x20ab7f?.[_0x3dac9e(0x14d)]||_0x20ab7f)),null;}}function setupSendApi(_0x3d98f6){const _0x16216c=_0x2e890f;if(!_0x3d98f6)return;if(typeof _0x3d98f6[_0x16216c(0x162)+'e']===_0x16216c(0x112))sendApi=async(_0x1f3bd9,_0x425a8e)=>await _0x3d98f6[_0x16216c(0x162)+'e'](_0x1f3bd9,_0x425a8e);else _0x3d98f6[_0x16216c(0xbf)]&&typeof _0x3d98f6['sock'][_0x16216c(0x162)+'e']===_0x16216c(0x112)?sendApi=async(_0x5ee5cb,_0x1b550e)=>await _0x3d98f6['sock']['sendMessag'+'e'](_0x5ee5cb,_0x1b550e):sendApi=null;}async function safeSend(_0x499d1f,_0x5276db){const _0x179573=_0x2e890f;try{if(!_0x499d1f||!_0x5276db)return;if(sendApi)return await sendApi(_0x499d1f,_0x5276db);warn(_0x179573(0xf2)+_0x179573(0x12b)+'urface\x20ava'+_0x179573(0x19e));}catch(_0x9b4043){error(_0x9b4043,_0x179573(0xf2)+_0x179573(0x117)+'failed'),warn(_0x179573(0xf2)+'\x20safeSend\x20'+_0x179573(0x191)+(_0x9b4043?.[_0x179573(0x14d)]||_0x9b4043));}}function resolveDbDir(){const _0x3fb76d=_0x2e890f,_0x24ad03=getConfig(),_0xf4e802=_0x24ad03&&_0x24ad03[_0x3fb76d(0x119)]?_0x24ad03['DB_PATH']:_0x3fb76d(0x100),_0x3ea9ed=_0x28ebda['isAbsolute'](_0xf4e802)?_0x28ebda[_0x3fb76d(0x110)](_0xf4e802):_0x28ebda[_0x3fb76d(0x110)](PROJECT_ROOT,_0xf4e802);return _0x3ea9ed;}function ensureInside(_0x23ef44,_0x4176a4){const _0x2b9435=_0x2e890f,_0x2d0967=_0x28ebda[_0x2b9435(0x110)](_0x23ef44)+_0x28ebda[_0x2b9435(0xee)],_0x242d88=_0x28ebda[_0x2b9435(0x110)](_0x4176a4);return _0x242d88[_0x2b9435(0x19f)](_0x2d0967);}function getMediaFromMessage(_0x797174){const _0x2bdd29=_0x2e890f;if(!_0x797174)return null;if(_0x797174['documentMe'+'ssage']){const _0x1a1935=_0x797174[_0x2bdd29(0xb9)+'ssage'];return{'type':_0x2bdd29(0x174),'mediaMsg':_0x797174,'fileName':_0x1a1935['fileName']||null,'caption':_0x1a1935['caption']||null};}if(_0x797174[_0x2bdd29(0x196)+'ge']||_0x797174[_0x2bdd29(0x153)+'ge']||_0x797174['audioMessa'+'ge']||_0x797174[_0x2bdd29(0x17d)+_0x2bdd29(0x140)]){const _0x27036b=['imageMessa'+'ge',_0x2bdd29(0x153)+'ge',_0x2bdd29(0x118)+'ge','stickerMes'+_0x2bdd29(0x140)];for(const _0x4abb31 of _0x27036b){if(_0x797174[_0x4abb31])return{'type':_0x4abb31[_0x2bdd29(0x165)](_0x2bdd29(0x14a),''),'mediaMsg':_0x797174,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0xccc06c){const _0x20c96f=_0x2e890f,_0x10495b=_0xccc06c[_0x20c96f(0x14d)]&&_0xccc06c[_0x20c96f(0x14d)][_0x20c96f(0xc2)+_0x20c96f(0x178)];if(!_0x10495b||!_0x10495b[_0x20c96f(0x132)+'o']||!_0x10495b[_0x20c96f(0x132)+'o'][_0x20c96f(0xbb)+'age'])return null;const _0x1c7a48=_0x10495b[_0x20c96f(0x132)+'o'][_0x20c96f(0xbb)+_0x20c96f(0x12c)];return getMediaFromMessage(_0x1c7a48);}async function downloadMessageToBuffer(_0x2218e1){const _0x4692d2=_0x2e890f;if(!_0x2218e1||!_0x2218e1['message']){const _0x4d5789=_0x2218e1,_0x22e5c0=getMediaFromMessage(_0x4d5789);if(!_0x22e5c0)throw new Error(_0x4692d2(0x189)+_0x4692d2(0xe3)+_0x4692d2(0x122)+'d');_0x2218e1={'message':_0x4d5789};}const _0x5b72c6=_0x2218e1[_0x4692d2(0x14d)]||{},_0x4d9fc7=[_0x4692d2(0x174),_0x4692d2(0x18e),_0x4692d2(0xca),_0x4692d2(0xbe),_0x4692d2(0xf0),_0x4692d2(0xaf)];for(const _0x4e2a14 of _0x4d9fc7){const _0x1646e9=_0x5b72c6[_0x4e2a14+_0x4692d2(0x14a)];if(!_0x1646e9)continue;const _0x3f26b0=await downloadContentFromMessage(_0x1646e9,_0x4e2a14),_0x518879=[];for await(const _0x53ae7d of _0x3f26b0)_0x518879[_0x4692d2(0x128)](_0x53ae7d);return Buffer[_0x4692d2(0xc9)](_0x518879);}throw new Error(_0x4692d2(0xd7)+_0x4692d2(0x18c)+_0x4692d2(0xd9)+_0x4692d2(0xe0)+_0x4692d2(0xd3));}export async function initialize(_0x36d812){const _0x357ad8=_0x2e890f;if(!_0x36d812)throw new Error(_0x357ad8(0xd2)+_0x357ad8(0x1a0)+'requires\x20b'+_0x357ad8(0x157)+'e');botRef=_0x36d812,setupSendApi(botRef),info('[dbbackup]'+_0x357ad8(0x12a)+'ed');}export async function onMessage(_0x345b27){const _0x1a2051=_0x2e890f;try{if(!_0x345b27||!_0x345b27[_0x1a2051(0x142)]||!_0x345b27['message'])return;const _0x2b286c=String(_0x345b27[_0x1a2051(0x142)]['remoteJid']||'');if(_0x2b286c[_0x1a2051(0xcb)]('@g.us'))return;const _0x1ebcf4=_0x2b286c+'::'+String(_0x345b27['key']['id']||'');if(isProcessed(_0x1ebcf4))return;if(!_0x345b27[_0x1a2051(0x127)])return;const _0x32ccb1=_0x345b27[_0x1a2051(0xc4)]&&typeof _0x345b27[_0x1a2051(0xc4)]===_0x1a2051(0x139)?_0x345b27[_0x1a2051(0xc4)][_0x1a2051(0x11b)]():'';if(!_0x32ccb1)return;const _0x3b7d8b=_0x32ccb1[_0x1a2051(0xa9)](/\r?\n/)[0x1*-0x19f5+-0xf31+0x2926][_0x1a2051(0x11b)]()[_0x1a2051(0xa9)](/\s+/),_0x17dbb6=(_0x3b7d8b[0x1e92+-0x61*0x3d+-0x775]||'')['toLowerCas'+'e']();if(!commands[_0x1a2051(0x102)](_0x17dbb6))return;if(!botRef)botRef=_0x345b27[_0x1a2051(0x185)]||_0x345b27['client']||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn(_0x1a2051(0xf2)+_0x1a2051(0xd4)+_0x1a2051(0x10b)+_0x1a2051(0xc1));return;}const _0x617434=await resolveFinalDestFromCtx(_0x345b27);if(!_0x617434)return;markProcessed(_0x1ebcf4),info(_0x1a2051(0xf2)+_0x1a2051(0x180)+_0x17dbb6+('\x27\x20authoriz'+_0x1a2051(0x18a))+_0x617434);if(_0x17dbb6===_0x1a2051(0xde)){const _0xe49c2b=getConfig(),_0x54e99b=resolveDbDir(),_0x3387f7=_0xe49c2b&&_0xe49c2b['DB_NAME']?String(_0xe49c2b[_0x1a2051(0x15e)]):_0x1a2051(0x148),_0x558559=_0x3b7d8b[_0x1a2051(0xc7)]>=0x14*-0x1e1+0x2633+-0x9d?_0x3b7d8b[_0x1a2051(0x13b)](-0x13a8+-0x1*-0xdbd+0x2*0x2f6)['join']('\x20')[_0x1a2051(0x11b)]():_0x3387f7,_0x1f4e07=_0x28ebda[_0x1a2051(0x110)](_0x54e99b,_0x558559);if(!ensureInside(_0x54e99b,_0x1f4e07)){await safeSend(_0x617434,{'text':_0x1a2051(0x170)+_0x1a2051(0xda)+'\x20access\x20de'+_0x1a2051(0xaa)});return;}if(!_0x247bc0[_0x1a2051(0xac)](_0x1f4e07)){await safeSend(_0x617434,{'text':_0x1a2051(0x176)+'\x20found:\x20'+_0x558559});return;}const _0x2a10ba=_0x28ebda[_0x1a2051(0xba)](_0x54e99b,_0x28ebda[_0x1a2051(0x166)](_0x1f4e07)+(_0x1a2051(0xa8)+_0x1a2051(0xb7)));let _0x198893=![];try{await shutdownDatabase(),_0x198893=!![],info(_0x1a2051(0xf2)+_0x1a2051(0xfb)+'shutdown\x20c'+_0x1a2051(0x17a)+_0x1a2051(0x15d)+_0x1a2051(0xd0));try{_0x247bc0[_0x1a2051(0x19c)+'nc'](_0x1f4e07,_0x2a10ba),info(_0x1a2051(0xf2)+'\x20quick\x20cop'+'y\x20for\x20getd'+_0x1a2051(0x144)+_0x2a10ba);}catch(_0x11385d){warn('[dbbackup]'+_0x1a2051(0xab)+_0x1a2051(0xf5)+(_0x11385d?.['message']||_0x11385d));}const _0x19c46d=_0x247bc0[_0x1a2051(0x163)+'nc'](_0x1f4e07);await safeSend(_0x617434,{'document':_0x19c46d,'fileName':_0x28ebda['basename'](_0x1f4e07),'mimetype':_0x1a2051(0x137)+_0x1a2051(0x13c)+_0x1a2051(0xc8)}),info(_0x1a2051(0xf2)+'\x20sent\x20DB\x20f'+_0x1a2051(0xe1)+_0x1f4e07+_0x1a2051(0x179)+_0x617434),await initializeDatabase(),info('[dbbackup]'+'\x20DB\x20reinit'+_0x1a2051(0x129)+_0x1a2051(0xbd)+_0x1a2051(0x16f));}catch(_0x34ed4e){error(_0x34ed4e,_0x1a2051(0xf2)+'\x20getdb\x20fai'+'led');try{_0x198893&&(await initializeDatabase(),info('[dbbackup]'+'\x20initializ'+'eDatabase\x20'+'attempted\x20'+_0x1a2051(0xeb)+_0x1a2051(0x194)));}catch(_0x449306){error(_0x449306,_0x1a2051(0xf2)+'\x20initializ'+'eDatabase\x20'+_0x1a2051(0x130)+_0x1a2051(0x11e)+'ailure');}await safeSend(_0x617434,{'text':_0x1a2051(0x169)+_0x1a2051(0x133)+_0x1a2051(0x1a4)+(_0x34ed4e?.[_0x1a2051(0x14d)]||_0x34ed4e)+('\x0aA\x20recover'+'y\x20attempt\x20'+_0x1a2051(0x159))});}finally{try{if(_0x247bc0['existsSync'](_0x2a10ba))_0x247bc0[_0x1a2051(0x193)](_0x2a10ba);}catch(_0x225664){}}return;}if(_0x17dbb6==='setdb'){let _0x3bc90c=getMediaFromMessage(_0x345b27['message'])||getQuotedMedia(_0x345b27),_0xbb86c8=!getMediaFromMessage(_0x345b27[_0x1a2051(0x14d)])&&!!getQuotedMedia(_0x345b27);if(!_0x3bc90c||!_0x3bc90c[_0x1a2051(0x109)]){await safeSend(_0x617434,{'text':_0x1a2051(0x115)+'ttach\x20or\x20r'+'eply\x20to\x20a\x20'+_0x1a2051(0xe8)+_0x1a2051(0x11d)+_0x1a2051(0x13d)+_0x1a2051(0xfe)+'ill\x20be\x20val'+_0x1a2051(0x15b)});return;}const _0x31189d=String(_0x3bc90c[_0x1a2051(0xc0)]||'')[_0x1a2051(0x11b)](),_0x2b9c39=getConfig(),_0x2c27df=resolveDbDir();let _0x59db70=_0x2b9c39&&_0x2b9c39['DB_NAME']?String(_0x2b9c39['DB_NAME']):_0x1a2051(0x148),_0x544f47=_0x28ebda['extname'](_0x59db70)[_0x1a2051(0x149)+'e']();if(!_0x544f47){_0x59db70=_0x59db70||_0x1a2051(0x148),_0x544f47=_0x28ebda['extname'](_0x59db70)||_0x1a2051(0x182);if(!_0x28ebda[_0x1a2051(0x154)](_0x59db70))_0x59db70=''+_0x59db70+_0x544f47;}const _0x473bd5=_0x28ebda[_0x1a2051(0x110)](_0x2c27df,_0x59db70);try{_0x247bc0[_0x1a2051(0x124)](_0x2c27df,{'recursive':!![]});}catch(_0x2913f6){}if(!ensureInside(_0x2c27df,_0x473bd5)){await safeSend(_0x617434,{'text':'❌\x20Invalid\x20'+_0x1a2051(0x136)+'n\x20path.'});return;}const _0x33aa02=_0xbb86c8?_0x345b27[_0x1a2051(0x14d)][_0x1a2051(0xc2)+'xtMessage'][_0x1a2051(0x132)+'o'][_0x1a2051(0xbb)+'age']:_0x345b27['message'];let _0x28bf4f;try{_0x28bf4f=await downloadMessageToBuffer(_0x33aa02);}catch(_0x2e2231){error(_0x2e2231,_0x1a2051(0xf2)+_0x1a2051(0xdc)+_0x1a2051(0x105)+'uploaded\x20D'+_0x1a2051(0x12f)+'d\x20step)');const _0x45d844=_0x2e2231?.[_0x1a2051(0x187)]?.[_0x1a2051(0x14b)]||_0x2e2231?.[_0x1a2051(0x14b)]||null;_0x45d844===-0x23c3*-0x1+0x989*0x1+-0x2f*0xee?await safeSend(_0x617434,{'text':'❌\x20Failed\x20t'+'o\x20download'+':\x20uploaded'+_0x1a2051(0x11f)+_0x1a2051(0x1a2)+_0x1a2051(0x108)+_0x1a2051(0x10e)+_0x1a2051(0xe7)+_0x1a2051(0xad)+'the\x20file\x20a'+'nd\x20try\x20aga'+_0x1a2051(0x16c)}):await safeSend(_0x617434,{'text':_0x1a2051(0x169)+_0x1a2051(0x13f)+_0x1a2051(0x13e)+_0x1a2051(0xfa)+(_0x2e2231?.['message']||_0x2e2231)});return;}try{const _0x37a8c3=_0x28bf4f[_0x1a2051(0x13b)](-0x10a4+-0x28f+0x1333*0x1,0x19f4+-0x7a5+-0x123f),_0x3327d0=Buffer[_0x1a2051(0x134)](_0x1a2051(0x113)+_0x1a2051(0x131),'ascii');if(!_0x37a8c3[_0x1a2051(0x188)](_0x3327d0)){await safeSend(_0x617434,{'text':_0x1a2051(0x172)+'\x20file\x20does'+_0x1a2051(0x19d)+_0x1a2051(0x150)+'valid\x20SQLi'+'te\x20DB\x20(hea'+_0x1a2051(0x13a)+_0x1a2051(0x135)+(_0x1a2051(0x11c)+_0x1a2051(0x17b)+_0x1a2051(0x16e)+'e\x20format\x203'+'\x5c0\x22.\x20If\x20th'+_0x1a2051(0xf6)+_0x1a2051(0xc6)+_0x1a2051(0x138)+'d\x20re-uploa'+'d.')});return;}}catch(_0x6014f2){error(_0x6014f2,_0x1a2051(0xf2)+_0x1a2051(0xbc)+_0x1a2051(0x101)+_0x1a2051(0x15c)),await safeSend(_0x617434,{'text':'❌\x20Could\x20no'+_0x1a2051(0x190)+_0x1a2051(0x13e)+_0x1a2051(0x126)+_0x1a2051(0x17f)+(_0x6014f2?.[_0x1a2051(0x14d)]||_0x6014f2)});return;}const _0x5b14f3=_0x28ebda[_0x1a2051(0xba)](_0x2c27df,_0x28ebda[_0x1a2051(0x166)](_0x473bd5)+(_0x1a2051(0xe4)+_0x1a2051(0xb7)));let _0x55776d=![];try{await shutdownDatabase(),_0x55776d=!![],info(_0x1a2051(0xf2)+_0x1a2051(0xfb)+_0x1a2051(0x181)+_0x1a2051(0x17a)+_0x1a2051(0x184)+_0x1a2051(0x15f)+'.');if(_0x247bc0['existsSync'](_0x473bd5))try{_0x247bc0[_0x1a2051(0x19c)+'nc'](_0x473bd5,_0x5b14f3),info(_0x1a2051(0xf2)+_0x1a2051(0xdd)+_0x1a2051(0xfc)+_0x1a2051(0x125)+_0x5b14f3);}catch(_0x3dee8c){warn('[dbbackup]'+_0x1a2051(0xdc)+_0x1a2051(0x183)+_0x1a2051(0x14f)+(_0x3dee8c?.[_0x1a2051(0x14d)]||_0x3dee8c)),await safeSend(_0x617434,{'text':'⚠️\x20Warning:'+_0x1a2051(0x10f)+_0x1a2051(0x183)+_0x1a2051(0x14f)+(_0x3dee8c?.[_0x1a2051(0x14d)]||_0x3dee8c)});}_0x247bc0[_0x1a2051(0x156)+_0x1a2051(0x19a)](_0x473bd5,_0x28bf4f),info('[dbbackup]'+_0x1a2051(0xf8)+_0x1a2051(0xf4)+_0x1a2051(0xc3)+_0x473bd5),await initializeDatabase(),await safeSend(_0x617434,{'text':_0x1a2051(0xfd)+'B\x20replaced'+_0x1a2051(0x175)+'itialized\x20'+_0x1a2051(0x10c)+_0x28ebda[_0x1a2051(0x123)](PROJECT_ROOT,_0x473bd5)}),info('[dbbackup]'+'\x20DB\x20restor'+_0x1a2051(0x145)+_0x1a2051(0x168)+'initialize'+_0x1a2051(0xa7)+_0x617434);}catch(_0x108466){error(_0x108466,_0x1a2051(0xf2)+_0x1a2051(0xe5)+'tore\x20faile'+'d\x20after\x20sh'+_0x1a2051(0x12e));try{_0x247bc0[_0x1a2051(0xac)](_0x5b14f3)&&(_0x247bc0[_0x1a2051(0x19c)+'nc'](_0x5b14f3,_0x473bd5),info('[dbbackup]'+'\x20restored\x20'+_0x1a2051(0x177)+_0x1a2051(0x151)+_0x1a2051(0x16a)+_0x1a2051(0x104)+'re'));}catch(_0x4fd7a8){error(_0x4fd7a8,_0x1a2051(0xf2)+'\x20failed\x20to'+'\x20restore\x20D'+_0x1a2051(0x186)+_0x1a2051(0xb4)+_0x1a2051(0xce));}try{await initializeDatabase();}catch(_0x2ab470){error(_0x2ab470,'[dbbackup]'+_0x1a2051(0x12a)+'eDatabase\x20'+_0x1a2051(0x130)+_0x1a2051(0x18b)+_0x1a2051(0x18f)+'y');}await safeSend(_0x617434,{'text':_0x1a2051(0x169)+_0x1a2051(0x19b)+'DB:\x20'+(_0x108466?.['message']||_0x108466)+(_0x1a2051(0x164)+'t\x20to\x20recov'+_0x1a2051(0x146)+'vious\x20DB\x20w'+'as\x20made.')});}finally{try{if(_0x247bc0[_0x1a2051(0xac)](_0x5b14f3))_0x247bc0['unlinkSync'](_0x5b14f3);}catch(_0x5372ac){}}return;}if(_0x17dbb6===_0x1a2051(0xb2)){const _0xccf58=findConfigFile();if(_0xccf58){try{const _0x28cc85=_0x247bc0['readFileSy'+'nc'](_0xccf58),_0x5561cb=_0xccf58['toLowerCas'+'e']()[_0x1a2051(0xcb)](_0x1a2051(0xb8))?_0x1a2051(0x137)+'n/json':_0x1a2051(0x158)+'l';await safeSend(_0x617434,{'document':_0x28cc85,'fileName':_0x28ebda[_0x1a2051(0x166)](_0xccf58),'mimetype':_0x5561cb}),info(_0x1a2051(0xf2)+_0x1a2051(0xae)+_0x1a2051(0x161)+_0xccf58+_0x1a2051(0x179)+_0x617434);}catch(_0x4f1d18){error(_0x4f1d18,_0x1a2051(0xf2)+'\x20getconfig'+_0x1a2051(0xec)+'ed'),await safeSend(_0x617434,{'text':_0x1a2051(0x169)+_0x1a2051(0x121)+_0x1a2051(0xb6)+(_0x4f1d18?.[_0x1a2051(0x14d)]||_0x4f1d18)});}return;}const _0x4bcf55=getConfig()||{},_0x4afa31=Buffer[_0x1a2051(0x134)](JSON[_0x1a2051(0xb3)](_0x4bcf55,null,0x140d+0x1ef+-0x15fa),_0x1a2051(0xf7));await safeSend(_0x617434,{'document':_0x4afa31,'fileName':_0x1a2051(0x18d)+_0x1a2051(0xcd),'mimetype':_0x1a2051(0x137)+_0x1a2051(0xcf)});return;}if(_0x17dbb6===_0x1a2051(0x155)){let _0x34d989=getMediaFromMessage(_0x345b27[_0x1a2051(0x14d)])||getQuotedMedia(_0x345b27),_0x4c1cf1=!getMediaFromMessage(_0x345b27[_0x1a2051(0x14d)])&&!!getQuotedMedia(_0x345b27);if(!_0x34d989||!_0x34d989[_0x1a2051(0x109)]){await safeSend(_0x617434,{'text':_0x1a2051(0x115)+'ttach\x20or\x20r'+'eply\x20to\x20a\x20'+_0x1a2051(0xd5)+'e.'});return;}const _0x294beb=String(_0x34d989[_0x1a2051(0xc0)]||'')['trim']()['toLowerCas'+'e'](),_0x54df8d=[_0x1a2051(0xf1),_0x1a2051(0x107),'.json'],_0x2f51a5=_0x28ebda[_0x1a2051(0x154)](_0x294beb||'');if(!_0x54df8d['includes'](_0x2f51a5)){await safeSend(_0x617434,{'text':_0x1a2051(0xb0)+_0x1a2051(0xc5)+_0x1a2051(0x17e)+'ml,\x20.yaml,'+_0x1a2051(0xf9)});return;}const _0x29de96=findConfigFile(),_0x3f8f22=_0x2f51a5==='.json'?_0x1a2051(0xdb)+'n':'config.yml',_0x469467=_0x28ebda[_0x1a2051(0x110)](PROJECT_ROOT,_0x3f8f22);if(!ensureInside(PROJECT_ROOT,_0x469467)){await safeSend(_0x617434,{'text':_0x1a2051(0x170)+_0x1a2051(0x136)+'n\x20path.'});return;}try{const _0x12e45e=_0x4c1cf1?_0x345b27[_0x1a2051(0x14d)][_0x1a2051(0xc2)+_0x1a2051(0x178)][_0x1a2051(0x132)+'o'][_0x1a2051(0xbb)+_0x1a2051(0x12c)]:_0x345b27[_0x1a2051(0x14d)],_0x5a2f8e=await downloadMessageToBuffer(_0x12e45e);_0x247bc0['writeFileS'+_0x1a2051(0x19a)](_0x469467,_0x5a2f8e,{'encoding':_0x1a2051(0xf7)});if(_0x29de96&&_0x29de96!==_0x469467&&_0x247bc0[_0x1a2051(0xac)](_0x29de96))try{_0x247bc0[_0x1a2051(0x193)](_0x29de96),info(_0x1a2051(0xf2)+_0x1a2051(0x14c)+'ld\x20config\x20'+_0x1a2051(0xfa)+_0x29de96);}catch(_0x1a60ee){warn(_0x1a2051(0xf2)+_0x1a2051(0x10f)+'\x20remove\x20ol'+_0x1a2051(0xcc)+_0x1a2051(0xea)+(_0x1a60ee?.[_0x1a2051(0x14d)]||_0x1a60ee));}await safeSend(_0x617434,{'text':_0x1a2051(0x147)+_0x1a2051(0x167)+_0x1a2051(0x14e)+_0x3f8f22+(_0x1a2051(0x111)+_0x1a2051(0xef)+_0x1a2051(0x143)+_0x1a2051(0x198)+_0x1a2051(0x192)+'ices\x20to\x20pi'+_0x1a2051(0x10d)+_0x1a2051(0xb1))}),info(_0x1a2051(0xf2)+'\x20replaced\x20'+_0x1a2051(0xd5)+'e\x20'+_0x469467+_0x1a2051(0xf3)+_0x617434);}catch(_0x341ec1){error(_0x341ec1,_0x1a2051(0xf2)+_0x1a2051(0xd1)+_0x1a2051(0xe2)),await safeSend(_0x617434,{'text':_0x1a2051(0x169)+_0x1a2051(0x120)+_0x1a2051(0xb5)+(_0x341ec1?.[_0x1a2051(0x14d)]||_0x341ec1)});}return;}}catch(_0x1eae14){error(_0x1eae14,_0x1a2051(0xf2)+'\x20onMessage'+_0x1a2051(0x17c)+(_0x1eae14?.[_0x1a2051(0x14d)]||_0x1eae14));}}function _0x1625(){const _0x25720d=['in.','3867500PTVTHv','er:\x20\x22SQLit','operation.','❌\x20Invalid\x20','omCtx\x20erro','❌\x20Uploaded','777prfqDu','document','\x20and\x20re-in','❌\x20File\x20not','DB\x20from\x20ba','xtMessage','\x20to\x20','ompleted\x20f','QLite\x20head','\x20error:\x20','stickerMes','nsions:\x20.y','r:\x20','\x20command\x20\x27','shutdown\x20c','.db','\x20create\x20DB','or\x20restore','bot','B\x20from\x20bac','response','equals','No\x20media\x20n','ed\x20for\x20','er\x20attempt','d\x20media\x20ty','runtime-co','image','ed\x20recover','t\x20validate','failed:\x20','\x20some\x20serv','unlinkSync','b\x20failure.','map','imageMessa',']\x20resolveF','quired\x20for','forEach','ync','o\x20restore\x20','copyFileSy','\x20not\x20appea','ilable','startsWith','nitialize\x20','58818HeNrqb','\x20expired\x20o','64485bpPtRd','\x20DB:\x20','d\x20for\x20','.bak_for_g','split','nied.','\x20quick\x20cop','existsSync','re-upload\x20','\x20sent\x20conf','sticker','❌\x20Accepted','config.','getconfig','stringify','kup\x20after\x20','fig:\x20','fig\x20file:\x20','etdb','.json','documentMe','join','quotedMess','\x20header\x20va','ter\x20getdb\x20','ptv','sock','fileName','ailable.','extendedTe','\x20at\x20','text','\x20file\x20exte','ed\x20a\x20DB,\x20r','length','ream','concat','video','endsWith','d\x20config\x20f','nfig.json','error','n/json','peration.','\x20setconfig','dbbackup.i','wnload','\x20bot\x20insta','config\x20fil','jid','Unsupporte','has','pe\x20or\x20no\x20m','filename\x20/','config.jso','\x20failed\x20to','\x20existing\x20','getdb','2.5.0','edia\x20to\x20do','ile\x20','\x20failed','ode\x20found\x20','.bak_for_s','\x20setdb\x20res','\x20cleanup\x20e',').\x20Please\x20','file\x20to\x20re','inalDestFr','ile:\x20','after\x20getd','\x20send\x20fail','get','sep','ot\x20restart','audio','.yml','[dbbackup]','\x20from\x20','en\x20DB\x20file','y\x20failed:\x20','is\x20is\x20inde','utf8','\x20overwritt','\x20.json','file:\x20','\x20database\x20','DB\x20backed\x20','✅\x20Active\x20D','tension;\x20w','487670PdEtlh','./data/db','lidation\x20f','includes','108513xgToKz','ring\x20resto','\x20download\x20','\x20cleaned\x20u','.yaml','n\x20WhatsApp','mediaMsg','90tTfaSq','nce\x20not\x20av','as:\x20','ck\x20up\x20new\x20','\x20(HTTP\x20410','\x20could\x20not','resolve','\x0aNote:\x20A\x20b','function','SQLite\x20for','rror:\x20','❌\x20Please\x20a','@g.us','\x20safeSend\x20','audioMessa','DB_PATH','delete','trim','Expected\x20S','place\x20the\x20','er\x20getdb\x20f','\x20media\x20has','o\x20save\x20con','o\x20send\x20con','to\x20downloa','relative','mkdirSync','up\x20to\x20','file\x20heade','isCommand','push','ialized\x20af','\x20initializ','\x20no\x20send\x20s','age','479968SzkpaL','utdown','B\x20(downloa','failed\x20aft','mat\x203\x00','contextInf','o\x20retrieve','from','ch).\x0a','destinatio','applicatio','e-check\x20an','string','der\x20mismat','slice','n/octet-st','DB\x20(any\x20ex','\x20uploaded\x20','o\x20download','sage','168usAxpK','key','\x20may\x20be\x20re','b\x20at\x20','e\x20complete','er\x20the\x20pre','✅\x20Config\x20r','bot.db','toLowerCas','Message','status','\x20removed\x20o','message','th:\x20','\x20backup:\x20','r\x20to\x20be\x20a\x20','ckup\x20due\x20t','3494840OUsUhY','videoMessa','extname','setconfig','writeFileS','ot\x20instanc','text/x-yam','was\x20made.','clear','idated).','ailed','or\x20getdb\x20o','DB_NAME','\x20operation','isArray','ig\x20file\x20','sendMessag','readFileSy','\x0aAn\x20attemp','replace','basename','eplaced\x20wi','\x20and\x20DB\x20re','❌\x20Failed\x20t','o\x20error\x20du','set'];_0x1625=function(){return _0x25720d;};return _0x1625();}export async function cleanup(){const _0x4f4b29=_0x2e890f;try{botRef=null,sendApi=null,processedMessageKeys[_0x4f4b29(0x199)](_0x1d2b61=>{try{clearTimeout(_0x1d2b61);}catch(_0x5f3030){}}),processedMessageKeys[_0x4f4b29(0x15a)](),info(_0x4f4b29(0xf2)+_0x4f4b29(0x106)+'p');}catch(_0x36a3ef){warn(_0x4f4b29(0xf2)+_0x4f4b29(0xe6)+_0x4f4b29(0x114)+(_0x36a3ef?.['message']||_0x36a3ef));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};