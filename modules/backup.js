const _0x873d0c=_0x3c7d;(function(_0x29dbc5,_0x4577cb){const _0x1e0b02=_0x3c7d,_0x264f10=_0x29dbc5();while(!![]){try{const _0xb98002=-parseInt(_0x1e0b02(0x9a))/(-0x2085+-0x1d8d+0x3e13)+-parseInt(_0x1e0b02(0x134))/(0x37d*-0x1+-0x6d*0x26+0x13ad)+-parseInt(_0x1e0b02(0x8e))/(-0xcbc+0x1b9+-0x11*-0xa6)+-parseInt(_0x1e0b02(0xfc))/(-0x670+0x64*-0xb+0xac0)*(-parseInt(_0x1e0b02(0xf0))/(-0x7c2+0x4a3*0x7+-0x18ae))+parseInt(_0x1e0b02(0x117))/(0x36a*-0x8+-0x54f*0x7+0x407f)*(-parseInt(_0x1e0b02(0x13d))/(-0x903+0x120c+-0x902))+-parseInt(_0x1e0b02(0xd9))/(-0x25f7*0x1+0x19be+-0xc41*-0x1)*(-parseInt(_0x1e0b02(0xb5))/(-0x4c3+-0x1d*-0x6a+-0x736))+parseInt(_0x1e0b02(0x89))/(0x1c9*0x1+-0x1107+0xf48);if(_0xb98002===_0x4577cb)break;else _0x264f10['push'](_0x264f10['shift']());}catch(_0x58e175){_0x264f10['push'](_0x264f10['shift']());}}}(_0x2f78,-0xdfb7d+-0x157f3c+-0x3035ad*-0x1));function _0x2f78(){const _0x185818=['file:\x20','\x20DB\x20reinit','join','concat','1122052ETKQFd','Unsupporte','d\x20for\x20','ed\x20for\x20','mkdirSync','eDatabase\x20','\x20.json','\x20sent\x20conf','o\x20send\x20con','\x20backup:\x20','r\x20to\x20be\x20a\x20',':\x20uploaded','2.5.0','\x20DB:\x20','y\x20failed:\x20','\x20initializ','initialize','copyFileSy','edia\x20to\x20do','\x27\x20authoriz','DB_NAME','failed:\x20','lidation\x20f','❌\x20Uploaded','kup\x20after\x20','client','sock','138ABhEWC','\x20error:\x20','b\x20at\x20','\x20getdb\x20fai','er\x20getdb\x20f','videoMessa','key','th:\x20','\x20not\x20appea','\x20database\x20','stringify','\x20command\x20\x27','unlinkSync','\x20failed','requires\x20b','audio','ream','\x20quick\x20cop','\x20failed\x20to','re-upload\x20','\x20getconfig','isArray','failed','ailure','o\x20error\x20du','./data/db','failed\x20aft','\x20download\x20','❌\x20Failed\x20t','3067492asYyus','bot','n\x20WhatsApp','function','\x20at\x20','itialized\x20','dbbackup.i','y\x20attempt\x20','te\x20DB\x20(hea','140266lHicnG','etdb','fromMe','destinatio','ld\x20config\x20','operation.','ter\x20getdb\x20','toLowerCas','as:\x20','DB\x20(any\x20ex','valid\x20SQLi','.yaml','ill\x20be\x20val','setconfig','ed\x20a\x20DB,\x20r','text','No\x20media\x20n','ompleted\x20f','utf8','relative','clear','filename\x20/','wnload','jid','\x20setconfig','file\x20to\x20re','✅\x20Active\x20D','slice','n\x20path.','has','basename','writeFileS','\x0aNote:\x20A\x20b','contextInf','DB_PATH','nsions:\x20.y',').\x20Please\x20','B\x20from\x20bac','isCommand','\x20sent\x20DB\x20f','\x20from\x20','DB:\x20','Message','trim','inalDestFr','sendMessag','d\x20after\x20sh','isAbsolute','eply\x20to\x20a\x20','ialized\x20af','getconfig','e\x20complete','getdb','bot.db','\x20existing\x20','nce\x20not\x20av','remoteJid','d\x20media\x20ty','d\x20re-uploa','\x20and\x20re-in','\x20bot\x20insta','string','e-check\x20an','\x20restored\x20','urface\x20ava','❌\x20Invalid\x20','\x20access\x20de','ode\x20found\x20','stickerMes','\x20media\x20has','\x20operation','❌\x20File\x20not','the\x20file\x20a','runtime-co','includes','\x20header\x20va','\x20expired\x20o','status','ile\x20','ot\x20instanc','config\x20fil','r:\x20','config.yml','ed\x20recover','\x20file\x20does','config.jso','sticker','dbbackup','49386020PWiZIk','as\x20made.','extname','after\x20getd','from','4742292zvhwwb','caption','\x20create\x20DB','ascii','equals','config.','resolve','nitialize\x20','tore\x20faile','\x20setdb\x20res','existsSync','\x20replaced\x20','1470801fvWrdz','extendedTe','.bak_for_s','text/x-yam','applicatio','audioMessa','to\x20downloa','@g.us','mediaMsg','[dbbackup]','.db','\x20no\x20send\x20s','ch).\x0a','document','ring\x20resto','response','imageMessa','ssage','\x20uploaded\x20','n/json','idated).','readFileSy','up\x20to\x20','\x20to\x20','nied.','\x0aAn\x20attemp','o\x20retrieve','11943ArqTHG','in.','ailable.','ig\x20file\x20','attempted\x20','was\x20made.','ckup\x20due\x20t','message','ilable','omCtx\x20erro','\x20remove\x20ol','\x20safeSend\x20','\x20overwritt','documentMe','ices\x20to\x20pi','endsWith','ync','get','n/octet-st','.yml','forEach','o\x20download','length','set','fig\x20file:\x20','rror:\x20','eplaced\x20wi','ml,\x20.yaml,','fig:\x20','\x20could\x20not','nfig.json','ailed','\x20removed\x20o','ile:\x20','nd\x20try\x20aga',']\x20resolveF','2296QLUyHT','push','xtMessage','delete','age','quotedMess','en\x20DB\x20file','place\x20the\x20','⚠️\x20Warning:','\x20some\x20serv','is\x20is\x20inde','\x20file\x20exte','\x20onMessage','ck\x20up\x20new\x20','t\x20validate','sage','.json','startsWith','fileName','quired\x20for','❌\x20Accepted','error','replace','10UIksNn','mat\x203\x00','❌\x20Please\x20a','split','B\x20replaced','or\x20restore','e\x20format\x203','\x20cleaned\x20u'];_0x2f78=function(){return _0x185818;};return _0x2f78();}import _0x577c7b from'fs';import _0x565f34 from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';function _0x3c7d(_0x550e42,_0x4bbf37){const _0x18d54e=_0x2f78();return _0x3c7d=function(_0x58d614,_0x2c1c58){_0x58d614=_0x58d614-(-0xe55+0x1e2e*-0x1+0x2d05);let _0x1400e1=_0x18d54e[_0x58d614];return _0x1400e1;},_0x3c7d(_0x550e42,_0x4bbf37);}import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x873d0c(0x88);export const version=_0x873d0c(0x108);export const priority=0x177*-0x2+0x16af*-0x1+0x1a0b;export const commands=[_0x873d0c(0x171),'setdb','getconfig',_0x873d0c(0x14a)];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x100*0x3+-0x712+0x41c)*(-0x5c2+0xc32+-0x288),processedMessageKeys=new Map();function markProcessed(_0x2d7c43){const _0x1d4b2c=_0x873d0c;if(!_0x2d7c43)return;if(processedMessageKeys[_0x1d4b2c(0x15a)](_0x2d7c43))try{clearTimeout(processedMessageKeys[_0x1d4b2c(0xc6)](_0x2d7c43));}catch(_0x51c3a8){}const _0x30a741=setTimeout(()=>processedMessageKeys[_0x1d4b2c(0xdc)](_0x2d7c43),DEDUPE_TTL_MS);processedMessageKeys[_0x1d4b2c(0xcc)](_0x2d7c43,_0x30a741);}function isProcessed(_0x1b13e2){const _0x3217f6=_0x873d0c;return _0x1b13e2&&processedMessageKeys[_0x3217f6(0x15a)](_0x1b13e2);}async function resolveFinalDestFromCtx(_0x507339){const _0x1feffd=_0x873d0c;try{if(!_0x507339||!_0x507339[_0x1feffd(0x11d)])return null;const _0x5703eb=getBotJid(),_0x540106=Boolean(_0x507339[_0x1feffd(0x11d)][_0x1feffd(0x13f)]);if(_0x540106)return _0x5703eb||null;const _0x3a2283=String(_0x507339[_0x1feffd(0x11d)][_0x1feffd(0x175)]||'');if(!_0x3a2283||_0x3a2283[_0x1feffd(0xc4)](_0x1feffd(0xa1)))return null;const {findings:_0x45e8b7}=userJidFromCtx(_0x507339);if(!Array['isArray'](_0x45e8b7)||_0x45e8b7['length']===-0x2324+-0x56e*0x7+0x4926)return null;const _0x21cf9b=await listSudo();if(!Array[_0x1feffd(0x12c)](_0x21cf9b)||_0x21cf9b[_0x1feffd(0xcb)]===0x2*-0x24a+0x1e25*0x1+-0x1991)return null;const _0x5ae676=new Set(_0x21cf9b['map'](_0x2235d6=>String(_0x2235d6)));for(const _0x143127 of _0x45e8b7){if(!_0x143127?.[_0x1feffd(0x154)]||typeof _0x143127[_0x1feffd(0x154)]!=='string')continue;let _0x324599=null;try{_0x324599=normalizeToJid(_0x143127['jid']);}catch(_0x1bc0a1){_0x324599=null;}if(_0x324599&&_0x5ae676[_0x1feffd(0x15a)](_0x324599))return _0x324599;const _0x3262ea=(String(_0x143127['jid'])[_0x1feffd(0xf3)]('@')[-0x25e7+0x1734+-0x47*-0x35]||'')[_0x1feffd(0xf3)](':')[-0x5e4+0x228d+-0x13f*0x17]||null;if(_0x3262ea)for(const _0x2e22fe of _0x5ae676){const _0x519c38=String(_0x2e22fe)[_0x1feffd(0xf3)]('@')[0x1f54+-0x69*0x1f+-0x1*0x129d]||null;if(_0x519c38&&_0x3262ea===_0x519c38)return _0x2e22fe;}if(_0x5ae676[_0x1feffd(0x15a)](_0x143127[_0x1feffd(0x154)]))return _0x143127[_0x1feffd(0x154)];}return null;}catch(_0x405661){return warn('['+name+(_0x1feffd(0xd8)+_0x1feffd(0x169)+_0x1feffd(0xbe)+_0x1feffd(0x82))+(_0x405661?.[_0x1feffd(0xbc)]||_0x405661)),null;}}function setupSendApi(_0x28c10d){const _0x7b272e=_0x873d0c;if(!_0x28c10d)return;if(typeof _0x28c10d[_0x7b272e(0x16a)+'e']===_0x7b272e(0x137))sendApi=async(_0x42b1e3,_0x364145)=>await _0x28c10d[_0x7b272e(0x16a)+'e'](_0x42b1e3,_0x364145);else _0x28c10d[_0x7b272e(0x116)]&&typeof _0x28c10d[_0x7b272e(0x116)][_0x7b272e(0x16a)+'e']===_0x7b272e(0x137)?sendApi=async(_0x161d7b,_0x11f511)=>await _0x28c10d[_0x7b272e(0x116)][_0x7b272e(0x16a)+'e'](_0x161d7b,_0x11f511):sendApi=null;}async function safeSend(_0x5e729a,_0x1bc313){const _0x17f242=_0x873d0c;try{if(!_0x5e729a||!_0x1bc313)return;if(sendApi)return await sendApi(_0x5e729a,_0x1bc313);warn(_0x17f242(0xa3)+_0x17f242(0xa5)+_0x17f242(0x17d)+_0x17f242(0xbd));}catch(_0x43f69b){error(_0x43f69b,_0x17f242(0xa3)+_0x17f242(0xc0)+_0x17f242(0x12d)),warn('[dbbackup]'+_0x17f242(0xc0)+_0x17f242(0x111)+(_0x43f69b?.[_0x17f242(0xbc)]||_0x43f69b));}}function resolveDbDir(){const _0x23ce05=_0x873d0c,_0x4910cd=getConfig(),_0x139489=_0x4910cd&&_0x4910cd['DB_PATH']?_0x4910cd[_0x23ce05(0x15f)]:_0x23ce05(0x130),_0x414dc5=_0x565f34[_0x23ce05(0x16c)](_0x139489)?_0x565f34[_0x23ce05(0x94)](_0x139489):_0x565f34['resolve'](PROJECT_ROOT,_0x139489);return _0x414dc5;}function ensureInside(_0xe5ade4,_0x39270b){const _0x4696d2=_0x873d0c,_0x198e72=_0x565f34[_0x4696d2(0x94)](_0xe5ade4)+_0x565f34['sep'],_0xa9a3a2=_0x565f34[_0x4696d2(0x94)](_0x39270b);return _0xa9a3a2[_0x4696d2(0xea)](_0x198e72);}function getMediaFromMessage(_0x521fcc){const _0x4cc34c=_0x873d0c;if(!_0x521fcc)return null;if(_0x521fcc[_0x4cc34c(0xc2)+_0x4cc34c(0xab)]){const _0x4c5c3f=_0x521fcc[_0x4cc34c(0xc2)+_0x4cc34c(0xab)];return{'type':_0x4cc34c(0xa7),'mediaMsg':_0x521fcc,'fileName':_0x4c5c3f['fileName']||null,'caption':_0x4c5c3f[_0x4cc34c(0x8f)]||null};}if(_0x521fcc[_0x4cc34c(0xaa)+'ge']||_0x521fcc[_0x4cc34c(0x11c)+'ge']||_0x521fcc['audioMessa'+'ge']||_0x521fcc[_0x4cc34c(0x181)+_0x4cc34c(0xe8)]){const _0x1e6c46=[_0x4cc34c(0xaa)+'ge','videoMessa'+'ge',_0x4cc34c(0x9f)+'ge','stickerMes'+_0x4cc34c(0xe8)];for(const _0x3dfc38 of _0x1e6c46){if(_0x521fcc[_0x3dfc38])return{'type':_0x3dfc38[_0x4cc34c(0xef)]('Message',''),'mediaMsg':_0x521fcc,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x5632df){const _0x56b1bc=_0x873d0c,_0x4b39f6=_0x5632df['message']&&_0x5632df['message'][_0x56b1bc(0x9b)+'xtMessage'];if(!_0x4b39f6||!_0x4b39f6['contextInf'+'o']||!_0x4b39f6[_0x56b1bc(0x15e)+'o'][_0x56b1bc(0xde)+_0x56b1bc(0xdd)])return null;const _0x105ff2=_0x4b39f6[_0x56b1bc(0x15e)+'o'][_0x56b1bc(0xde)+_0x56b1bc(0xdd)];return getMediaFromMessage(_0x105ff2);}async function downloadMessageToBuffer(_0x1d7d57){const _0x198c30=_0x873d0c;if(!_0x1d7d57||!_0x1d7d57[_0x198c30(0xbc)]){const _0x257a84=_0x1d7d57,_0x1aeca7=getMediaFromMessage(_0x257a84);if(!_0x1aeca7)throw new Error(_0x198c30(0x14d)+_0x198c30(0x180)+_0x198c30(0xa0)+'d');_0x1d7d57={'message':_0x257a84};}const _0x45606a=_0x1d7d57['message']||{},_0x160127=[_0x198c30(0xa7),'image','video','ptv',_0x198c30(0x126),_0x198c30(0x87)];for(const _0x2ca60b of _0x160127){const _0x20de36=_0x45606a[_0x2ca60b+_0x198c30(0x167)];if(!_0x20de36)continue;const _0x5af0e6=await downloadContentFromMessage(_0x20de36,_0x2ca60b),_0x59be65=[];for await(const _0x3f483b of _0x5af0e6)_0x59be65[_0x198c30(0xda)](_0x3f483b);return Buffer[_0x198c30(0xfb)](_0x59be65);}throw new Error(_0x198c30(0xfd)+_0x198c30(0x176)+'pe\x20or\x20no\x20m'+_0x198c30(0x10e)+_0x198c30(0x153));}export async function initialize(_0xdfc96d){const _0x16dbef=_0x873d0c;if(!_0xdfc96d)throw new Error(_0x16dbef(0x13a)+_0x16dbef(0x95)+_0x16dbef(0x125)+_0x16dbef(0x18c)+'e');botRef=_0xdfc96d,setupSendApi(botRef),info(_0x16dbef(0xa3)+'\x20initializ'+'ed');}export async function onMessage(_0x1b8a5d){const _0x4b4dab=_0x873d0c;try{if(!_0x1b8a5d||!_0x1b8a5d['key']||!_0x1b8a5d[_0x4b4dab(0xbc)])return;const _0x349b21=String(_0x1b8a5d['key'][_0x4b4dab(0x175)]||'');if(_0x349b21[_0x4b4dab(0xc4)]('@g.us'))return;const _0x1690cd=_0x349b21+'::'+String(_0x1b8a5d[_0x4b4dab(0x11d)]['id']||'');if(isProcessed(_0x1690cd))return;if(!_0x1b8a5d[_0x4b4dab(0x163)])return;const _0x2fa8f6=_0x1b8a5d['text']&&typeof _0x1b8a5d[_0x4b4dab(0x14c)]===_0x4b4dab(0x17a)?_0x1b8a5d[_0x4b4dab(0x14c)][_0x4b4dab(0x168)]():'';if(!_0x2fa8f6)return;const _0x510cdd=_0x2fa8f6[_0x4b4dab(0xf3)](/\r?\n/)[-0x24a*0x4+0x1b60+-0x1*0x1238][_0x4b4dab(0x168)]()[_0x4b4dab(0xf3)](/\s+/),_0x29aa6c=(_0x510cdd[0x1ebf+0xac+-0x17f*0x15]||'')[_0x4b4dab(0x144)+'e']();if(!commands['includes'](_0x29aa6c))return;if(!botRef)botRef=_0x1b8a5d[_0x4b4dab(0x135)]||_0x1b8a5d[_0x4b4dab(0x115)]||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn('[dbbackup]'+_0x4b4dab(0x179)+_0x4b4dab(0x174)+_0x4b4dab(0xb7));return;}const _0x2632de=await resolveFinalDestFromCtx(_0x1b8a5d);if(!_0x2632de)return;markProcessed(_0x1690cd),info(_0x4b4dab(0xa3)+_0x4b4dab(0x122)+_0x29aa6c+(_0x4b4dab(0x10f)+_0x4b4dab(0xff))+_0x2632de);if(_0x29aa6c===_0x4b4dab(0x171)){const _0xf4d68=getConfig(),_0x41180e=resolveDbDir(),_0x2747f0=_0xf4d68&&_0xf4d68['DB_NAME']?String(_0xf4d68[_0x4b4dab(0x110)]):_0x4b4dab(0x172),_0xf953b3=_0x510cdd[_0x4b4dab(0xcb)]>=0x1b*0x164+0xef*-0x17+-0x1011?_0x510cdd[_0x4b4dab(0x158)](0xd4+-0x1*0x1100+-0x65*-0x29)[_0x4b4dab(0xfa)]('\x20')['trim']():_0x2747f0,_0x36278a=_0x565f34[_0x4b4dab(0x94)](_0x41180e,_0xf953b3);if(!ensureInside(_0x41180e,_0x36278a)){await safeSend(_0x2632de,{'text':_0x4b4dab(0x17e)+_0x4b4dab(0x152)+_0x4b4dab(0x17f)+_0x4b4dab(0xb2)});return;}if(!_0x577c7b[_0x4b4dab(0x98)](_0x36278a)){await safeSend(_0x2632de,{'text':_0x4b4dab(0x184)+'\x20found:\x20'+_0xf953b3});return;}const _0x217703=_0x565f34[_0x4b4dab(0xfa)](_0x41180e,_0x565f34[_0x4b4dab(0x15b)](_0x36278a)+('.bak_for_g'+_0x4b4dab(0x13e)));let _0x352f36=![];try{await shutdownDatabase(),_0x352f36=!![],info('[dbbackup]'+'\x20database\x20'+'shutdown\x20c'+'ompleted\x20f'+'or\x20getdb\x20o'+'peration.');try{_0x577c7b['copyFileSy'+'nc'](_0x36278a,_0x217703),info(_0x4b4dab(0xa3)+_0x4b4dab(0x128)+'y\x20for\x20getd'+_0x4b4dab(0x119)+_0x217703);}catch(_0x456c0f){warn(_0x4b4dab(0xa3)+_0x4b4dab(0x128)+_0x4b4dab(0x10a)+(_0x456c0f?.[_0x4b4dab(0xbc)]||_0x456c0f));}const _0x45c40d=_0x577c7b[_0x4b4dab(0xaf)+'nc'](_0x36278a);await safeSend(_0x2632de,{'document':_0x45c40d,'fileName':_0x565f34[_0x4b4dab(0x15b)](_0x36278a),'mimetype':'applicatio'+_0x4b4dab(0xc7)+_0x4b4dab(0x127)}),info(_0x4b4dab(0xa3)+_0x4b4dab(0x164)+_0x4b4dab(0x18b)+_0x36278a+_0x4b4dab(0xb1)+_0x2632de),await initializeDatabase(),info(_0x4b4dab(0xa3)+_0x4b4dab(0xf9)+_0x4b4dab(0x16e)+_0x4b4dab(0x143)+_0x4b4dab(0x142));}catch(_0x49cb62){error(_0x49cb62,_0x4b4dab(0xa3)+_0x4b4dab(0x11a)+'led');try{_0x352f36&&(await initializeDatabase(),info(_0x4b4dab(0xa3)+'\x20initializ'+_0x4b4dab(0x101)+_0x4b4dab(0xb9)+_0x4b4dab(0x8c)+'b\x20failure.'));}catch(_0x5b91c4){error(_0x5b91c4,_0x4b4dab(0xa3)+_0x4b4dab(0x10b)+_0x4b4dab(0x101)+_0x4b4dab(0x131)+_0x4b4dab(0x11b)+_0x4b4dab(0x12e));}await safeSend(_0x2632de,{'text':_0x4b4dab(0x133)+_0x4b4dab(0xb4)+_0x4b4dab(0x109)+(_0x49cb62?.[_0x4b4dab(0xbc)]||_0x49cb62)+('\x0aA\x20recover'+_0x4b4dab(0x13b)+_0x4b4dab(0xba))});}finally{try{if(_0x577c7b[_0x4b4dab(0x98)](_0x217703))_0x577c7b[_0x4b4dab(0x123)](_0x217703);}catch(_0xe84f86){}}return;}if(_0x29aa6c==='setdb'){let _0x3d0732=getMediaFromMessage(_0x1b8a5d[_0x4b4dab(0xbc)])||getQuotedMedia(_0x1b8a5d),_0x592038=!getMediaFromMessage(_0x1b8a5d['message'])&&!!getQuotedMedia(_0x1b8a5d);if(!_0x3d0732||!_0x3d0732[_0x4b4dab(0xa2)]){await safeSend(_0x2632de,{'text':_0x4b4dab(0xf2)+'ttach\x20or\x20r'+_0x4b4dab(0x16d)+_0x4b4dab(0x156)+_0x4b4dab(0xe0)+_0x4b4dab(0x146)+'tension;\x20w'+_0x4b4dab(0x149)+_0x4b4dab(0xae)});return;}const _0x572f7b=String(_0x3d0732[_0x4b4dab(0xeb)]||'')['trim'](),_0x2e3555=getConfig(),_0x19e880=resolveDbDir();let _0x268b2c=_0x2e3555&&_0x2e3555[_0x4b4dab(0x110)]?String(_0x2e3555[_0x4b4dab(0x110)]):_0x4b4dab(0x172),_0x5649fc=_0x565f34[_0x4b4dab(0x8b)](_0x268b2c)['toLowerCas'+'e']();if(!_0x5649fc){_0x268b2c=_0x268b2c||_0x4b4dab(0x172),_0x5649fc=_0x565f34['extname'](_0x268b2c)||_0x4b4dab(0xa4);if(!_0x565f34[_0x4b4dab(0x8b)](_0x268b2c))_0x268b2c=''+_0x268b2c+_0x5649fc;}const _0x4cf54c=_0x565f34[_0x4b4dab(0x94)](_0x19e880,_0x268b2c);try{_0x577c7b[_0x4b4dab(0x100)](_0x19e880,{'recursive':!![]});}catch(_0x5b5db1){}if(!ensureInside(_0x19e880,_0x4cf54c)){await safeSend(_0x2632de,{'text':'❌\x20Invalid\x20'+_0x4b4dab(0x140)+_0x4b4dab(0x159)});return;}const _0x57bb4a=_0x592038?_0x1b8a5d[_0x4b4dab(0xbc)]['extendedTe'+_0x4b4dab(0xdb)][_0x4b4dab(0x15e)+'o'][_0x4b4dab(0xde)+'age']:_0x1b8a5d[_0x4b4dab(0xbc)];let _0x5590b4;try{_0x5590b4=await downloadMessageToBuffer(_0x57bb4a);}catch(_0x4c9054){error(_0x4c9054,'[dbbackup]'+'\x20failed\x20to'+_0x4b4dab(0x132)+'uploaded\x20D'+'B\x20(downloa'+'d\x20step)');const _0x273de8=_0x4c9054?.[_0x4b4dab(0xa9)]?.[_0x4b4dab(0x18a)]||_0x4c9054?.[_0x4b4dab(0x18a)]||null;_0x273de8===-0x10ac+-0x24a*-0x10+-0x125a?await safeSend(_0x2632de,{'text':_0x4b4dab(0x133)+_0x4b4dab(0xca)+_0x4b4dab(0x107)+_0x4b4dab(0x182)+_0x4b4dab(0x189)+_0x4b4dab(0x136)+'\x20(HTTP\x20410'+_0x4b4dab(0x161)+_0x4b4dab(0x12a)+_0x4b4dab(0x185)+_0x4b4dab(0xd7)+_0x4b4dab(0xb6)}):await safeSend(_0x2632de,{'text':_0x4b4dab(0x133)+_0x4b4dab(0xca)+_0x4b4dab(0xac)+_0x4b4dab(0xf8)+(_0x4c9054?.[_0x4b4dab(0xbc)]||_0x4c9054)});return;}try{const _0x551d02=_0x5590b4[_0x4b4dab(0x158)](-0x19*0x131+0x3b*-0x56+-0x1089*-0x3,-0x232f+-0x141*0x15+0x4*0xf65),_0x267766=Buffer[_0x4b4dab(0x8d)]('SQLite\x20for'+_0x4b4dab(0xf1),_0x4b4dab(0x91));if(!_0x551d02[_0x4b4dab(0x92)](_0x267766)){await safeSend(_0x2632de,{'text':_0x4b4dab(0x113)+_0x4b4dab(0x85)+_0x4b4dab(0x11f)+_0x4b4dab(0x106)+_0x4b4dab(0x147)+_0x4b4dab(0x13c)+'der\x20mismat'+_0x4b4dab(0xa6)+('Expected\x20S'+'QLite\x20head'+'er:\x20\x22SQLit'+_0x4b4dab(0xf6)+'\x5c0\x22.\x20If\x20th'+_0x4b4dab(0xe3)+_0x4b4dab(0x14b)+_0x4b4dab(0x17b)+_0x4b4dab(0x177)+'d.')});return;}}catch(_0x13c234){error(_0x13c234,_0x4b4dab(0xa3)+_0x4b4dab(0x188)+_0x4b4dab(0x112)+_0x4b4dab(0xd4)),await safeSend(_0x2632de,{'text':'❌\x20Could\x20no'+_0x4b4dab(0xe7)+'\x20uploaded\x20'+'file\x20heade'+_0x4b4dab(0x82)+(_0x13c234?.[_0x4b4dab(0xbc)]||_0x13c234)});return;}const _0x3ddda1=_0x565f34[_0x4b4dab(0xfa)](_0x19e880,_0x565f34[_0x4b4dab(0x15b)](_0x4cf54c)+(_0x4b4dab(0x9c)+_0x4b4dab(0x13e)));let _0x2cfde7=![];try{await shutdownDatabase(),_0x2cfde7=!![],info(_0x4b4dab(0xa3)+_0x4b4dab(0x120)+'shutdown\x20c'+_0x4b4dab(0x14e)+_0x4b4dab(0xf5)+_0x4b4dab(0x183)+'.');if(_0x577c7b[_0x4b4dab(0x98)](_0x4cf54c))try{_0x577c7b['copyFileSy'+'nc'](_0x4cf54c,_0x3ddda1),info(_0x4b4dab(0xa3)+_0x4b4dab(0x173)+'DB\x20backed\x20'+_0x4b4dab(0xb0)+_0x3ddda1);}catch(_0x5e1bdd){warn(_0x4b4dab(0xa3)+_0x4b4dab(0x129)+_0x4b4dab(0x90)+_0x4b4dab(0x105)+(_0x5e1bdd?.['message']||_0x5e1bdd)),await safeSend(_0x2632de,{'text':_0x4b4dab(0xe1)+'\x20could\x20not'+_0x4b4dab(0x90)+_0x4b4dab(0x105)+(_0x5e1bdd?.[_0x4b4dab(0xbc)]||_0x5e1bdd)});}_0x577c7b[_0x4b4dab(0x15c)+'ync'](_0x4cf54c,_0x5590b4),info('[dbbackup]'+_0x4b4dab(0xc1)+_0x4b4dab(0xdf)+_0x4b4dab(0x138)+_0x4cf54c),await initializeDatabase(),await safeSend(_0x2632de,{'text':_0x4b4dab(0x157)+_0x4b4dab(0xf4)+_0x4b4dab(0x178)+_0x4b4dab(0x139)+_0x4b4dab(0x145)+_0x565f34[_0x4b4dab(0x150)](PROJECT_ROOT,_0x4cf54c)}),info(_0x4b4dab(0xa3)+'\x20DB\x20restor'+_0x4b4dab(0x170)+'\x20and\x20DB\x20re'+_0x4b4dab(0x10c)+_0x4b4dab(0xfe)+_0x2632de);}catch(_0x309e96){error(_0x309e96,_0x4b4dab(0xa3)+_0x4b4dab(0x97)+_0x4b4dab(0x96)+_0x4b4dab(0x16b)+'utdown');try{_0x577c7b[_0x4b4dab(0x98)](_0x3ddda1)&&(_0x577c7b[_0x4b4dab(0x10d)+'nc'](_0x3ddda1,_0x4cf54c),info(_0x4b4dab(0xa3)+_0x4b4dab(0x17c)+'DB\x20from\x20ba'+_0x4b4dab(0xbb)+_0x4b4dab(0x12f)+_0x4b4dab(0xa8)+'re'));}catch(_0x5395ef){error(_0x5395ef,_0x4b4dab(0xa3)+'\x20failed\x20to'+'\x20restore\x20D'+_0x4b4dab(0x162)+_0x4b4dab(0x114)+_0x4b4dab(0xee));}try{await initializeDatabase();}catch(_0x257e0c){error(_0x257e0c,'[dbbackup]'+'\x20initializ'+_0x4b4dab(0x101)+_0x4b4dab(0x131)+'er\x20attempt'+_0x4b4dab(0x84)+'y');}await safeSend(_0x2632de,{'text':_0x4b4dab(0x133)+'o\x20restore\x20'+_0x4b4dab(0x166)+(_0x309e96?.['message']||_0x309e96)+(_0x4b4dab(0xb3)+'t\x20to\x20recov'+'er\x20the\x20pre'+'vious\x20DB\x20w'+_0x4b4dab(0x8a))});}finally{try{if(_0x577c7b[_0x4b4dab(0x98)](_0x3ddda1))_0x577c7b['unlinkSync'](_0x3ddda1);}catch(_0x3555ca){}}return;}if(_0x29aa6c===_0x4b4dab(0x16f)){const _0x8cc2af=findConfigFile();if(_0x8cc2af){try{const _0x5eb0ee=_0x577c7b['readFileSy'+'nc'](_0x8cc2af),_0x433777=_0x8cc2af[_0x4b4dab(0x144)+'e']()[_0x4b4dab(0xc4)](_0x4b4dab(0xe9))?_0x4b4dab(0x9e)+_0x4b4dab(0xad):_0x4b4dab(0x9d)+'l';await safeSend(_0x2632de,{'document':_0x5eb0ee,'fileName':_0x565f34[_0x4b4dab(0x15b)](_0x8cc2af),'mimetype':_0x433777}),info(_0x4b4dab(0xa3)+_0x4b4dab(0x103)+_0x4b4dab(0xb8)+_0x8cc2af+_0x4b4dab(0xb1)+_0x2632de);}catch(_0x542fb7){error(_0x542fb7,_0x4b4dab(0xa3)+_0x4b4dab(0x12b)+'\x20send\x20fail'+'ed'),await safeSend(_0x2632de,{'text':'❌\x20Failed\x20t'+_0x4b4dab(0x104)+_0x4b4dab(0xcd)+(_0x542fb7?.[_0x4b4dab(0xbc)]||_0x542fb7)});}return;}const _0x1b1714=getConfig()||{},_0x1b29a2=Buffer[_0x4b4dab(0x8d)](JSON[_0x4b4dab(0x121)](_0x1b1714,null,-0x259b+0x1191*0x1+-0x140c*-0x1),_0x4b4dab(0x14f));await safeSend(_0x2632de,{'document':_0x1b29a2,'fileName':_0x4b4dab(0x186)+_0x4b4dab(0xd3),'mimetype':_0x4b4dab(0x9e)+_0x4b4dab(0xad)});return;}if(_0x29aa6c===_0x4b4dab(0x14a)){let _0xa5a3fe=getMediaFromMessage(_0x1b8a5d[_0x4b4dab(0xbc)])||getQuotedMedia(_0x1b8a5d),_0x1e5eb8=!getMediaFromMessage(_0x1b8a5d[_0x4b4dab(0xbc)])&&!!getQuotedMedia(_0x1b8a5d);if(!_0xa5a3fe||!_0xa5a3fe[_0x4b4dab(0xa2)]){await safeSend(_0x2632de,{'text':_0x4b4dab(0xf2)+'ttach\x20or\x20r'+'eply\x20to\x20a\x20'+_0x4b4dab(0x18d)+'e.'});return;}const _0x4f3ebb=String(_0xa5a3fe[_0x4b4dab(0xeb)]||'')[_0x4b4dab(0x168)]()[_0x4b4dab(0x144)+'e'](),_0x1d4df5=[_0x4b4dab(0xc8),_0x4b4dab(0x148),'.json'],_0x5c098b=_0x565f34['extname'](_0x4f3ebb||'');if(!_0x1d4df5[_0x4b4dab(0x187)](_0x5c098b)){await safeSend(_0x2632de,{'text':_0x4b4dab(0xed)+_0x4b4dab(0xe4)+_0x4b4dab(0x160)+_0x4b4dab(0xd0)+_0x4b4dab(0x102)});return;}const _0x51a0ad=findConfigFile(),_0x2430b1=_0x5c098b===_0x4b4dab(0xe9)?_0x4b4dab(0x86)+'n':_0x4b4dab(0x83),_0xcb1aff=_0x565f34['resolve'](PROJECT_ROOT,_0x2430b1);if(!ensureInside(PROJECT_ROOT,_0xcb1aff)){await safeSend(_0x2632de,{'text':_0x4b4dab(0x17e)+_0x4b4dab(0x140)+_0x4b4dab(0x159)});return;}try{const _0x572951=_0x1e5eb8?_0x1b8a5d[_0x4b4dab(0xbc)]['extendedTe'+_0x4b4dab(0xdb)][_0x4b4dab(0x15e)+'o'][_0x4b4dab(0xde)+'age']:_0x1b8a5d[_0x4b4dab(0xbc)],_0x3bf3a3=await downloadMessageToBuffer(_0x572951);_0x577c7b[_0x4b4dab(0x15c)+_0x4b4dab(0xc5)](_0xcb1aff,_0x3bf3a3,{'encoding':'utf8'});if(_0x51a0ad&&_0x51a0ad!==_0xcb1aff&&_0x577c7b[_0x4b4dab(0x98)](_0x51a0ad))try{_0x577c7b[_0x4b4dab(0x123)](_0x51a0ad),info('[dbbackup]'+_0x4b4dab(0xd5)+_0x4b4dab(0x141)+'file:\x20'+_0x51a0ad);}catch(_0x3cdaa0){warn(_0x4b4dab(0xa3)+_0x4b4dab(0xd2)+_0x4b4dab(0xbf)+'d\x20config\x20f'+_0x4b4dab(0xd6)+(_0x3cdaa0?.['message']||_0x3cdaa0));}await safeSend(_0x2632de,{'text':'✅\x20Config\x20r'+_0x4b4dab(0xcf)+_0x4b4dab(0x11e)+_0x2430b1+(_0x4b4dab(0x15d)+'ot\x20restart'+'\x20may\x20be\x20re'+_0x4b4dab(0xec)+_0x4b4dab(0xe2)+_0x4b4dab(0xc3)+_0x4b4dab(0xe6)+_0x4b4dab(0x93))}),info('[dbbackup]'+_0x4b4dab(0x99)+'config\x20fil'+'e\x20'+_0xcb1aff+_0x4b4dab(0x165)+_0x2632de);}catch(_0x427ce6){error(_0x427ce6,_0x4b4dab(0xa3)+_0x4b4dab(0x155)+_0x4b4dab(0x124)),await safeSend(_0x2632de,{'text':'❌\x20Failed\x20t'+'o\x20save\x20con'+_0x4b4dab(0xd1)+(_0x427ce6?.['message']||_0x427ce6)});}return;}}catch(_0x5428cf){error(_0x5428cf,_0x4b4dab(0xa3)+_0x4b4dab(0xe5)+_0x4b4dab(0x118)+(_0x5428cf?.[_0x4b4dab(0xbc)]||_0x5428cf));}}export async function cleanup(){const _0x5040b1=_0x873d0c;try{botRef=null,sendApi=null,processedMessageKeys[_0x5040b1(0xc9)](_0x3b02bc=>{try{clearTimeout(_0x3b02bc);}catch(_0x41af49){}}),processedMessageKeys[_0x5040b1(0x151)](),info(_0x5040b1(0xa3)+_0x5040b1(0xf7)+'p');}catch(_0x1b3121){warn(_0x5040b1(0xa3)+'\x20cleanup\x20e'+_0x5040b1(0xce)+(_0x1b3121?.[_0x5040b1(0xbc)]||_0x1b3121));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};