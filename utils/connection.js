const _0x140048=_0x2230;(function(_0x4a001f,_0x16e70e){const _0x3408b0=_0x2230,_0x128d39=_0x4a001f();while(!![]){try{const _0x17018f=parseInt(_0x3408b0(0x271))/(0x106c*-0x1+-0xd43*0x2+0x2af3)*(parseInt(_0x3408b0(0x27b))/(-0x1*-0x21d6+0x1*-0x1743+-0x1*0xa91))+parseInt(_0x3408b0(0x257))/(-0x2e*-0x41+-0x1c*0x55+-0x25f)*(parseInt(_0x3408b0(0x316))/(-0x184+-0x924+0xaac))+parseInt(_0x3408b0(0x2fa))/(0x1140+-0xf3*-0xd+0x2f5*-0xa)+parseInt(_0x3408b0(0x2dc))/(-0x60a*0x6+0x1fa1+0x4a1)+parseInt(_0x3408b0(0x263))/(0x11*0x1d2+-0x6*0x29+0x1df5*-0x1)+parseInt(_0x3408b0(0x33c))/(0xbd1+-0x1*-0x1798+0x3*-0xbcb)+-parseInt(_0x3408b0(0x1e8))/(0x4*-0x8ce+0x216c+0x1d5);if(_0x17018f===_0x16e70e)break;else _0x128d39['push'](_0x128d39['shift']());}catch(_0x318e49){_0x128d39['push'](_0x128d39['shift']());}}}(_0x21dd,0x2a86a+0x2a9eb+-0x3f7d*0x7));import{info as _0x4fd762,warn as _0x45ea89,error as _0x44e9dd}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x140048(0x23a)+_0x140048(0x203);function info(..._0x1374fe){const _0x58ef6c=_0x140048;try{_0x4fd762(..._0x1374fe);}catch(_0x4281dd){console[_0x58ef6c(0x2d9)](_0x58ef6c(0x20c),..._0x1374fe);}}function _0x21dd(){const _0x4f04ab=['\x20?,\x20?)','map','coped:\x20','ons\x20(name,','ections_ne','t\x20connecti','name\x20=\x20?\x20A','\x20into\x20conn','ed(','IF\x20NOT\x20EXI','LUMN\x20chat_',';\x0a\x20\x20\x20\x20','nnections','w\x20(\x0a\x20\x20\x20\x20\x20\x20','ATE\x20TABLE\x20','tGroup','SELECT\x20nam','me\x20=\x20?','p_id,\x20chat','XT\x20PRIMARY','nections\x20S','?,\x20?,\x20?,\x20?','68RVYBrQ','up_id','n]\x20listCon','slice','aultGroup','?,\x20?)\x20\x0a\x20\x20\x20','ult\x20failed','onnectionS','up_id\x20FROM','\x20=\x20?\x20WHERE','DER\x20BY\x20nam','e=\x27table\x27\x20','\x20\x20\x20\x20\x20\x20grou','n]\x20getDefa','XISTS\x20conn','EXT\x20NOT\x20NU','UPDATE\x20con','group_id','L,\x0a\x20\x20\x20\x20\x20\x20\x20','ultGroup:\x20','n]\x20schema\x20','ons\x20WHERE\x20','all','join','s\x20SET\x20name','eGroupDefa','AND\x20name\x20=','cluded.nam','or\x20','hatIdsFrom','groups\x20cac','id\x20FROM\x20co','on]\x20migrat','id,\x20group_','(0\x20rows)','O\x20group_de','n]\x20loadAct','_id\x20TEXT\x20N','2225488aCJziF','ared\x20for\x20','\x20CONFLICT(','TO\x20connect','ator_id\x20co','e\x20FROM\x20gro','ailed\x20for\x20','REPLACE\x20IN','etDefaultG','\x0a\x20\x20\x20\x20\x20\x20CRE',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','undefined','t_id\x20FROM\x20','n]\x20loadGro','SELECT\x20cha','KEY\x20(name,','s\x20failed','\x20WHERE\x20use',',\x20creator_','rGroup\x20fai','BEGIN\x20TRAN','to\x20add\x20cre','issing\x20cha','Connection','group_id,\x20','\x20WHERE\x20typ','toLowerCas','user_key','\x20(user_key','ection(','p_id\x20=\x20?\x20O','O\x20connecti','s\x20WHERE\x20gr','T\x20NULL,\x0a\x20\x20','\x20user_key\x20','n]\x20ensureS','on]\x20insert','tions\x20(\x0a\x20\x20','SACTION;','rUser\x20fail','split','ByCreatorI','\x20to\x20set\x20as','No\x20valid\x20c','roup_id,\x20n','TEXT\x20PRIMA','T\x20NULL\x20DEF','No\x20connect','includes','s\x20schema\x20f','\x20(arrays-o','\x20group_id\x20','ions\x20found','up_default','nections\x20(','ROM\x20connec','trim','names\x20prov','8255097ENknwK','set','Caches\x20loa','ALTER\x20TABL','chema\x20fail','or_id)\x20VAL','n]\x20listAll','nectionsCa','n]\x20created','n]\x20failed\x20','ized\x20group','ed:\x20','function','delete','group_id)\x0a','\x20ORDER\x20BY\x20','ded.group_','e\x20provided','values','=\x20?','e,\x20group_i','up_id,\x20nam','ided\x20for\x20s','DROP\x20TABLE','ache\x20faile','ectionReco','AULT\x20\x27[]\x27;','e_groups','aults\x20for\x20','led:\x20','WHERE\x20name','\x22\x20@\x20group\x20','REATE\x20TABL','SELECT\x201\x20F','\x20=\x20?,\x20crea','LUMN\x20group','[INFO]','on:\x20','\x20all','_id)','\x20failed:\x20','ions_new\x20(','me\x20=\x20?\x20AND','p_id\x20TEXT\x20','UPDATE\x20gro','e\x20FROM\x20sql','RY\x20KEY,\x0a\x20\x20','AND\x20group_','k\x20failed\x20f','push','\x20\x20\x20\x20group_','id\x20for\x20\x22','\x20\x20\x20\x20\x20\x20chat','odule\x20did\x20','ons_new\x20RE','\x20TEXT\x20NOT\x20','ons\x20ADD\x20CO','for\x20','defaults\x20(','Scoped\x20fai','\x20setDefaul','\x20name\x20=\x20?\x20','faults\x20WHE','\x20\x20\x20\x20\x20\x20);\x0a\x20','length','ded.','database.j','oup_id\x20=\x20?','nGroup\x20fai','ND\x20group_i','for\x20setDef','-scoped).\x20','isArray','\x20(creator=','connection','up_id\x20colu','chat_id','database\x20m','\x20for\x20','WHERE\x20crea','not\x20export','changes','user_activ',',\x20row\x20dele','che\x20failed','n\x20complete','efaults\x20ca','upDefaults','Scoped:\x20','ator_id','NOT\x20NULL\x0a\x20','moved\x20all\x20','LL,\x0a\x20\x20\x20\x20\x20\x20','INSERT\x20INT','n][migrati','E\x20name\x20=\x20?','SET\x20group_','OT\x20NULL,\x0a\x20','exec','n]\x20setDefa','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','\x20\x20\x20','n]\x20removeC','n]\x20loadCon','me\x20TEXT\x20NO','get','\x22\x20in\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20C','ultsNameTo','ection\x20fai','on]\x20normal','54843pLrVhR','SELECT\x20use','e\x20=\x20?\x20AND\x20','\x20table\x20gro','n]\x20migrate','hat_id\x20TEX','EY\x20(name,\x20','\x20\x20\x20\x20\x20ON\x20CO','DO\x20UPDATE\x20','iveGroupsC','nnections\x20','me)\x20VALUES','1635893MMnViv','\x20\x20\x20\x20name\x20T','ectionScop','User\x20error','[]\x27,\x0a\x20\x20\x20\x20\x20','stringify','le_info(','\x20AND\x20group','group_defa','ons\x20->\x20con','n]\x20connect','\x20name\x20=\x20ex','n\x20names\x20ex','onnection\x20','47YLfyAQ','p\x20failed\x20f','n]\x20updated','group_id\x20=','onnections','n]\x20group\x20d','ections','NAME\x20TO\x20co','COMMIT;','e,\x20chat_id','10456cweLkU','\x20FROM\x20conn','clear','ailed:\x20','\x20COLUMN\x20gr','has','n]\x20added\x20m','nsChatIdTo','STS\x20connec','id\x20=\x20?','on]\x20failed','UPDATE\x20SET','E\x20connecti','[WARN]','\x20\x20\x20\x20\x20\x20name','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20(deleted=','ns;','to\x20add\x20gro','oup:\x20','with\x20group','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','LL\x0a\x20\x20\x20\x20\x20\x20)','ectionName','tor_id\x20=\x20?','oup_id,\x20na','parse','_defaults\x20','roup_id\x20=\x20','creator_id','E\x20IF\x20NOT\x20E','ions\x20cache','to\x20persist','M\x20group_de','n]\x20getConn','string','None\x20of\x20th','OT\x20NULL\x20DE','che\x20loaded','n]\x20active\x20','s\x20group','E\x20group_de','\x20=\x20?\x20AND\x20g','Caches\x20com','run','user_key)\x20','s\x20WHERE\x20na','ized\x20chat_','id\x20TEXT\x20NO','ame','STS\x20','name,\x20grou','coped\x20fail','LUMN\x20creat','n]\x20migrati','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','WHERE\x20grou','from','SELECT\x20gro','ults',')\x20failed','rdScoped(','filter','n]\x20refresh','\x20WHERE\x20nam','nGroup:\x20','nnections;','up_id)\x20DO\x20','\x20table\x20','XT\x20NOT\x20NUL','pDefaultsC','Cache\x20fail','\x20loaded\x20(0','[ERROR]','roup','DELETE\x20FRO','\x20table\x20con','Unsupporte','\x20@\x20','issing\x20cre','d\x20=\x20?','T\x20NOT\x20NULL','NFLICT(gro','d:\x20','\x20chat_id\x20f','[connectio','d\x20migratio','t_id','\x20\x20\x20\x20\x20\x20\x20cre','\x20COLUMN\x20na','\x20connectio','Array\x20fail','n]\x20setActi','on-existen','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','message','7950ylhCGI','g\x20old\x20rows','\x20NOT\x20NULL\x20','\x20rows)','ensured\x20an','\x20@\x20group=','ET\x20chat_id','entries','\x20\x20\x20\x20\x20creat','to\x20import\x20','NULL,\x0a\x20\x20\x20\x20','eConnectio','\x20to\x20update','veGroupFor','PRAGMA\x20tab','or_id\x20TEXT','M\x20connecti','ultForGrou','n]\x20addGrou','efault\x20cle',')\x20VALUES\x20(','he\x20loaded\x20','faults\x20(gr','issing\x20gro','r_key,\x20gro','\x20\x20\x20\x20\x20);\x0a\x20\x20','efault\x20set','p_id\x20PK)',';\x0a\x20\x20\x20\x20\x20\x20','\x20group_id)','412580XMPBCA','led\x20for\x20',',\x20group_id','n]\x20deleteC','\x20IF\x20EXISTS','name'];_0x21dd=function(){return _0x4f04ab;};return _0x21dd();}function warn(..._0x75c0f5){const _0x5166ec=_0x140048;try{_0x45ea89(..._0x75c0f5);}catch(_0x33f31e){console['warn'](_0x5166ec(0x288),..._0x75c0f5);}}function error(..._0x1f8622){const _0x205276=_0x140048;try{_0x44e9dd(..._0x1f8622);}catch(_0x2c911c){console['error'](_0x205276(0x2c4),..._0x1f8622);}}async function getDb(){const _0x213c34=_0x140048;if(db&&typeof db[_0x213c34(0x24a)]===_0x213c34(0x1f4))return db;try{const _0x426ee0=await import('./database.js');if(_0x426ee0&&_0x426ee0['db'])return db=_0x426ee0['db'],db;throw new Error(_0x213c34(0x235)+_0x213c34(0x21d)+_0x213c34(0x238)+'\x20{\x20db\x20}');}catch(_0x140567){error(_0x140567,'[connectio'+_0x213c34(0x1f1)+_0x213c34(0x2e5)+_0x213c34(0x22a)+'s');throw _0x140567;}}function safeParseJSON(_0x27cf6a){try{return JSON['parse'](_0x27cf6a);}catch(_0x2ed833){return null;}}function asArrayStrict(_0x57ad18){const _0x28f254=_0x140048;if(_0x57ad18===null||_0x57ad18===undefined)return[];if(typeof _0x57ad18===_0x28f254(0x29e)){const _0x411fb8=safeParseJSON(_0x57ad18);if(Array[_0x28f254(0x230)](_0x411fb8))return _0x411fb8[_0x28f254(0x301)](String);return[_0x57ad18];}if(Array[_0x28f254(0x230)](_0x57ad18))return _0x57ad18[_0x28f254(0x301)](String);return[String(_0x57ad18)];}function toJSONString(_0x9d8d39){const _0x4638ee=_0x140048;return JSON[_0x4638ee(0x268)](Array[_0x4638ee(0x230)](_0x9d8d39)?_0x9d8d39[_0x4638ee(0x301)](String):[]);}async function tableExists(_0x2394a9){const _0x497383=_0x140048,_0x2e243e=await getDb(),_0x3f6c81=await _0x2e243e[_0x497383(0x251)](_0x497383(0x310)+_0x497383(0x215)+'ite_master'+_0x497383(0x1c7)+_0x497383(0x321)+_0x497383(0x330)+'\x20?',[String(_0x2394a9)]);return!!_0x3f6c81;}function _0x2230(_0x822b68,_0x19e17a){const _0x57ee48=_0x21dd();return _0x2230=function(_0x2b9b61,_0x1dae4e){_0x2b9b61=_0x2b9b61-(-0x88f+0xec8+-0x477*0x1);let _0x1f8c3d=_0x57ee48[_0x2b9b61];return _0x1f8c3d;},_0x2230(_0x822b68,_0x19e17a);}async function columnExists(_0x408fc9,_0x39f0bc){const _0x2c893b=_0x140048;try{const _0x57f895=await getDb(),_0x493bbd=await _0x57f895[_0x2c893b(0x32c)](_0x2c893b(0x2ea)+_0x2c893b(0x269)+_0x408fc9+')');if(!Array[_0x2c893b(0x230)](_0x493bbd))return![];return _0x493bbd['some'](_0x4be465=>String(_0x4be465[_0x2c893b(0x2ff)])[_0x2c893b(0x1c8)+'e']()===String(_0x39f0bc)[_0x2c893b(0x1c8)+'e']());}catch(_0x2019b2){return warn(_0x2c893b(0x2d0)+'n]\x20columnE'+'xists\x20chec'+_0x2c893b(0x218)+_0x2c893b(0x332)+_0x408fc9+'.'+_0x39f0bc+':\x20'+(_0x2019b2?.[_0x2c893b(0x2db)]||_0x2019b2)),![];}}async function ensureConnectionsTable(){const _0x35b619=_0x140048,_0x4177cb=await getDb(),_0x31dc02=await tableExists('connection'+'s');if(!_0x31dc02){await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x345)+_0x35b619(0x30e)+'IF\x20NOT\x20EXI'+_0x35b619(0x283)+_0x35b619(0x1d3)+_0x35b619(0x289)+_0x35b619(0x21f)+_0x35b619(0x2e6)+_0x35b619(0x21a)+'id\x20TEXT\x20NO'+_0x35b619(0x1cf)+_0x35b619(0x21c)+'_id\x20TEXT\x20N'+_0x35b619(0x249)+_0x35b619(0x2d3)+'ator_id\x20TE'+_0x35b619(0x2c0)+_0x35b619(0x328)+'\x20PRIMARY\x20K'+_0x35b619(0x25d)+_0x35b619(0x1f6)+_0x35b619(0x227)+_0x35b619(0x24d)),info(_0x35b619(0x2d0)+_0x35b619(0x1f0)+_0x35b619(0x2c7)+'nections\x20('+'name,\x20grou'+_0x35b619(0x2f7));return;}const _0x15e588=await columnExists(_0x35b619(0x232)+'s',_0x35b619(0x327)),_0x41c32f=await columnExists('connection'+'s',_0x35b619(0x234)),_0x48c463=await columnExists(_0x35b619(0x232)+'s',_0x35b619(0x298));if(!_0x41c32f||!_0x48c463||!_0x15e588)try{await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x253)+_0x35b619(0x208)+_0x35b619(0x299)+_0x35b619(0x324)+_0x35b619(0x304)+_0x35b619(0x30d)+_0x35b619(0x264)+_0x35b619(0x325)+_0x35b619(0x244)+'\x20\x20\x20\x20group_'+'id\x20TEXT\x20NO'+_0x35b619(0x1dc)+'AULT\x20\x27\x27,\x0a\x20'+_0x35b619(0x2b2)+_0x35b619(0x25c)+_0x35b619(0x2cc)+'\x20DEFAULT\x20\x27'+_0x35b619(0x267)+_0x35b619(0x2e4)+'or_id\x20TEXT'+'\x20NOT\x20NULL\x20'+'DEFAULT\x20\x27\x27'+_0x35b619(0x346)+'\x20\x20PRIMARY\x20'+_0x35b619(0x34b)+_0x35b619(0x2f9)+_0x35b619(0x290)+_0x35b619(0x2f8));try{const _0xa9271a=await _0x4177cb[_0x35b619(0x32c)]('SELECT\x20nam'+_0x35b619(0x27a)+',\x20creator_'+_0x35b619(0x335)+'nnections');if(Array[_0x35b619(0x230)](_0xa9271a)&&_0xa9271a['length'])for(const _0x10211a of _0xa9271a){const _0x347827=_0x10211a[_0x35b619(0x2ff)],_0x26678f=typeof _0x10211a[_0x35b619(0x234)]===_0x35b619(0x347)||_0x10211a['chat_id']===null?'[]':_0x10211a[_0x35b619(0x234)],_0x333352=typeof _0x10211a[_0x35b619(0x298)]===_0x35b619(0x347)||_0x10211a[_0x35b619(0x298)]===null?'':_0x10211a['creator_id'];try{await _0x4177cb[_0x35b619(0x2a7)]('INSERT\x20OR\x20'+_0x35b619(0x343)+_0x35b619(0x33f)+_0x35b619(0x211)+_0x35b619(0x2ae)+_0x35b619(0x312)+'_id,\x20creat'+_0x35b619(0x1ed)+'UES\x20(?,\x20?,'+_0x35b619(0x300),[_0x347827,'',_0x26678f,_0x333352]);}catch(_0x1a3045){warn(_0x35b619(0x2d0)+_0x35b619(0x246)+_0x35b619(0x1d2)+_0x35b619(0x307)+'ections_ne'+'w\x20failed\x20f'+'or\x20'+_0x347827+':\x20'+(_0x1a3045?.['message']||_0x1a3045));}}}catch(_0x3b73bb){warn(_0x35b619(0x2d0)+'n][migrati'+'on]\x20readin'+_0x35b619(0x2dd)+_0x35b619(0x210)+(_0x3b73bb?.[_0x35b619(0x2db)]||_0x3b73bb));}try{await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x1ff)+_0x35b619(0x2fe)+'\x20connectio'+_0x35b619(0x28c));}catch(_0x57ebdb){}await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x1eb)+'E\x20connecti'+_0x35b619(0x21e)+_0x35b619(0x278)+_0x35b619(0x2bd)),info(_0x35b619(0x2d0)+_0x35b619(0x25b)+'d\x20connecti'+_0x35b619(0x26c)+_0x35b619(0x1e4)+_0x35b619(0x28f)+_0x35b619(0x20f));}catch(_0x3d3119){warn(_0x35b619(0x2d0)+_0x35b619(0x2b1)+'on\x20to\x20new\x20'+_0x35b619(0x232)+_0x35b619(0x1df)+_0x35b619(0x27e)+(_0x3d3119?.[_0x35b619(0x2db)]||_0x3d3119));if(!_0x41c32f)try{await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x1eb)+_0x35b619(0x287)+_0x35b619(0x220)+_0x35b619(0x30a)+_0x35b619(0x2ab)+_0x35b619(0x1dc)+'AULT\x20\x27[]\x27;'),info('[connectio'+_0x35b619(0x281)+_0x35b619(0x1c4)+'t_id\x20colum'+'n');}catch(_0x221b8e){warn(_0x221b8e,_0x35b619(0x2d0)+'n]\x20failed\x20'+'to\x20add\x20cha'+_0x35b619(0x2d2));}if(!_0x48c463)try{await _0x4177cb[_0x35b619(0x24a)](_0x35b619(0x1eb)+_0x35b619(0x287)+_0x35b619(0x220)+_0x35b619(0x2b0)+_0x35b619(0x2eb)+_0x35b619(0x2de)+'DEFAULT\x20\x27\x27'+';'),info(_0x35b619(0x2d0)+_0x35b619(0x281)+_0x35b619(0x2ca)+_0x35b619(0x340)+'lumn');}catch(_0xeab47f){warn(_0xeab47f,_0x35b619(0x2d0)+_0x35b619(0x1f1)+_0x35b619(0x1c3)+_0x35b619(0x241));}if(!_0x15e588)try{await _0x4177cb['exec'](_0x35b619(0x1eb)+_0x35b619(0x287)+_0x35b619(0x220)+_0x35b619(0x20b)+_0x35b619(0x33b)+_0x35b619(0x2a0)+'FAULT\x20\x27\x27;'),info(_0x35b619(0x2d0)+_0x35b619(0x281)+_0x35b619(0x2f3)+_0x35b619(0x233)+'mn');}catch(_0x4237d0){warn(_0x4237d0,'[connectio'+_0x35b619(0x1f1)+_0x35b619(0x28d)+_0x35b619(0x317));}}}async function ensureGroupDefaultsTable(){const _0x3b338f=_0x140048,_0x2ac33e=await getDb(),_0x4e5513=await tableExists(_0x3b338f(0x26b)+'ults');if(!_0x4e5513){await _0x2ac33e[_0x3b338f(0x24a)](_0x3b338f(0x345)+_0x3b338f(0x30e)+_0x3b338f(0x309)+'STS\x20group_'+_0x3b338f(0x222)+_0x3b338f(0x2da)+'roup_id\x20TE'+_0x3b338f(0x313)+'\x20KEY,\x0a\x20\x20\x20\x20'+_0x3b338f(0x264)+_0x3b338f(0x325)+_0x3b338f(0x291)+_0x3b338f(0x30b)),info('[connectio'+'n]\x20created'+_0x3b338f(0x25a)+_0x3b338f(0x1e3)+'s');return;}!await columnExists(_0x3b338f(0x26b)+_0x3b338f(0x2b6),_0x3b338f(0x327))&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x5d5632=_0x140048,_0x232f52=await getDb();try{await _0x232f52[_0x5d5632(0x24a)](_0x5d5632(0x1eb)+'E\x20group_de'+'faults\x20ADD'+_0x5d5632(0x27f)+'oup_id\x20TEX'+_0x5d5632(0x2cc)+'\x20DEFAULT\x20\x27'+'\x27;'),await _0x232f52[_0x5d5632(0x24a)](_0x5d5632(0x1eb)+_0x5d5632(0x2a4)+'faults\x20ADD'+_0x5d5632(0x2d4)+_0x5d5632(0x250)+'T\x20NULL\x20DEF'+_0x5d5632(0x202));}catch(_0x42ca81){warn(_0x5d5632(0x2d0)+_0x5d5632(0x2ee)+_0x5d5632(0x2c1)+'olumns\x20fai'+_0x5d5632(0x205)+(_0x42ca81?.['message']||_0x42ca81));}}async function ensureActiveGroupsTable(){const _0x2fe243=_0x140048,_0x47fbdf=await getDb(),_0x91b4a1=await tableExists(ACTIVE_TABLE);!_0x91b4a1&&(await _0x47fbdf[_0x2fe243(0x24a)](_0x2fe243(0x345)+'ATE\x20TABLE\x20'+_0x2fe243(0x309)+_0x2fe243(0x2ad)+ACTIVE_TABLE+(_0x2fe243(0x24c)+_0x2fe243(0x1d0)+_0x2fe243(0x1db)+_0x2fe243(0x216)+_0x2fe243(0x322)+_0x2fe243(0x213)+_0x2fe243(0x242)+_0x2fe243(0x2f5)+'\x20\x20')),info('[connectio'+_0x2fe243(0x1f0)+_0x2fe243(0x2bf)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x5c3aa4=_0x140048;try{const _0x3a26e7=await getDb(),_0x55684e=await _0x3a26e7[_0x5c3aa4(0x32c)](_0x5c3aa4(0x310)+_0x5c3aa4(0x1fc)+'d,\x20chat_id'+_0x5c3aa4(0x27c)+_0x5c3aa4(0x277));if(!_0x55684e||_0x55684e[_0x5c3aa4(0x228)]===-0xec1+-0xd39+0x1bfa)return;const _0x2f88c0=[];for(const _0x30c050 of _0x55684e){const _0x80d44f=_0x30c050[_0x5c3aa4(0x234)],_0x3cca06=safeParseJSON(_0x80d44f);if(Array[_0x5c3aa4(0x230)](_0x3cca06)){const _0x567f2d=_0x3cca06[_0x5c3aa4(0x301)](String),_0x164407=toJSONString(_0x567f2d);if(_0x164407!==_0x80d44f)_0x2f88c0[_0x5c3aa4(0x219)]({'name':_0x30c050['name'],'group_id':_0x30c050['group_id']||'','chat_id':_0x164407});continue;}else{let _0x20352f=[];_0x80d44f===null||_0x80d44f===undefined||String(_0x80d44f)[_0x5c3aa4(0x1e6)]()===''?_0x20352f=[]:_0x20352f=[String(_0x80d44f)];const _0x267f54=toJSONString(_0x20352f);_0x2f88c0[_0x5c3aa4(0x219)]({'name':_0x30c050[_0x5c3aa4(0x2ff)],'group_id':_0x30c050[_0x5c3aa4(0x327)]||'','chat_id':_0x267f54});}}if(_0x2f88c0[_0x5c3aa4(0x228)]>-0x27*-0x3a+-0x25*-0x11+0x31*-0x3b){try{await _0x3a26e7['exec']('BEGIN\x20TRAN'+_0x5c3aa4(0x1d4));}catch(_0x1ed634){}for(const _0x858837 of _0x2f88c0){try{await _0x3a26e7['run']('UPDATE\x20con'+_0x5c3aa4(0x314)+'ET\x20chat_id'+_0x5c3aa4(0x31f)+'\x20name\x20=\x20?\x20'+_0x5c3aa4(0x217)+'id\x20=\x20?',[_0x858837[_0x5c3aa4(0x234)],_0x858837[_0x5c3aa4(0x2ff)],_0x858837[_0x5c3aa4(0x327)]]),info(_0x5c3aa4(0x2d0)+_0x5c3aa4(0x246)+_0x5c3aa4(0x256)+_0x5c3aa4(0x2aa)+_0x5c3aa4(0x21b)+_0x858837[_0x5c3aa4(0x2ff)]+(_0x5c3aa4(0x207)+'\x22')+_0x858837[_0x5c3aa4(0x327)]+'\x22');}catch(_0x4970ee){warn('[connectio'+_0x5c3aa4(0x246)+_0x5c3aa4(0x285)+_0x5c3aa4(0x2e8)+_0x5c3aa4(0x2cf)+_0x5c3aa4(0x332)+_0x858837[_0x5c3aa4(0x2ff)]+'@'+_0x858837[_0x5c3aa4(0x327)]+':\x20'+(_0x4970ee?.[_0x5c3aa4(0x2db)]||_0x4970ee));}}try{await _0x3a26e7['exec'](_0x5c3aa4(0x279));}catch(_0x8991b4){}}}catch(_0x4d6f95){warn(_0x5c3aa4(0x2d0)+_0x5c3aa4(0x246)+_0x5c3aa4(0x336)+_0x5c3aa4(0x2e7)+_0x5c3aa4(0x282)+_0x5c3aa4(0x2d6)+_0x5c3aa4(0x1f3)+(_0x4d6f95?.['message']||_0x4d6f95));}}async function migrateGroupDefaultsNameToArray(){const _0x507086=_0x140048;try{const _0x1cf47d=await getDb(),_0x1b633e=await _0x1cf47d[_0x507086(0x32c)](_0x507086(0x2b5)+_0x507086(0x1fd)+'e\x20FROM\x20gro'+_0x507086(0x1e3)+'s');if(!_0x1b633e||_0x1b633e['length']===0x664*0x3+-0x1840+0x514)return;const _0x1f990e=[];for(const _0x3912a8 of _0x1b633e){const _0x16697b=_0x3912a8[_0x507086(0x2ff)],_0x171c07=safeParseJSON(_0x16697b);if(Array[_0x507086(0x230)](_0x171c07)){const _0x141aff=toJSONString(_0x171c07);if(_0x141aff!==_0x16697b)_0x1f990e[_0x507086(0x219)]({'group_id':_0x3912a8['group_id'],'name':_0x141aff});continue;}else{const _0x23f09d=_0x16697b===null||_0x16697b===undefined||String(_0x16697b)[_0x507086(0x1e6)]()===''?[]:[String(_0x16697b)],_0x3f9b45=toJSONString(_0x23f09d);_0x1f990e[_0x507086(0x219)]({'group_id':_0x3912a8[_0x507086(0x327)],'name':_0x3f9b45});}}if(_0x1f990e[_0x507086(0x228)]>0x2dd*0x2+-0x1*0x166d+0x10b3){try{await _0x1cf47d[_0x507086(0x24a)](_0x507086(0x1c2)+'SACTION;');}catch(_0x5d4f16){}for(const _0xf72869 of _0x1f990e){try{await _0x1cf47d[_0x507086(0x2a7)](_0x507086(0x214)+_0x507086(0x1e3)+_0x507086(0x32e)+_0x507086(0x31f)+_0x507086(0x1e1)+_0x507086(0x1fb),[_0xf72869['name'],_0xf72869[_0x507086(0x327)]]),info('[connectio'+_0x507086(0x246)+'on]\x20normal'+_0x507086(0x1f2)+_0x507086(0x296)+_0x507086(0x221)+_0xf72869[_0x507086(0x327)]);}catch(_0x4401be){warn(_0x507086(0x2d0)+_0x507086(0x246)+_0x507086(0x285)+_0x507086(0x2e8)+'\x20group_def'+_0x507086(0x204)+_0xf72869[_0x507086(0x327)]+':\x20'+(_0x4401be?.['message']||_0x4401be));}}try{await _0x1cf47d['exec'](_0x507086(0x279));}catch(_0x3f6aae){}}}catch(_0x14d53e){warn(_0x507086(0x2d0)+_0x507086(0x246)+_0x507086(0x336)+_0x507086(0x32f)+_0x507086(0x254)+_0x507086(0x2d6)+'ed:\x20'+(_0x14d53e?.['message']||_0x14d53e));}}function parseArrayStrict(_0x46082f){const _0x3adf4f=_0x140048;if(_0x46082f===null||_0x46082f===undefined)return[];if(typeof _0x46082f===_0x3adf4f(0x29e)){const _0xeb5674=safeParseJSON(_0x46082f);if(Array[_0x3adf4f(0x230)](_0xeb5674))return _0xeb5674[_0x3adf4f(0x301)](String);return[];}if(Array[_0x3adf4f(0x230)](_0x46082f))return _0x46082f[_0x3adf4f(0x301)](String);return[String(_0x46082f)];}function stringifyArray(_0x16e2dc){const _0x66f10c=_0x140048;return JSON[_0x66f10c(0x268)](Array[_0x66f10c(0x230)](_0x16e2dc)?_0x16e2dc[_0x66f10c(0x301)](String):[]);}async function loadConnectionsCache(){const _0x3294ef=_0x140048;try{const _0x39c0d6=await getDb(),_0x54516a=await _0x39c0d6['all']('SELECT\x20nam'+_0x3294ef(0x1fc)+'d,\x20chat_id'+_0x3294ef(0x34e)+_0x3294ef(0x335)+_0x3294ef(0x30c));connectionsCache[_0x3294ef(0x27d)]();if(!_0x54516a||!_0x54516a['length']){info(_0x3294ef(0x2d0)+_0x3294ef(0x26d)+_0x3294ef(0x29a)+_0x3294ef(0x2c3)+_0x3294ef(0x2df));return;}for(const _0x3125ce of _0x54516a){const _0x44dc09=String(_0x3125ce[_0x3294ef(0x327)]||'');if(!connectionsCache[_0x3294ef(0x280)](_0x44dc09))connectionsCache[_0x3294ef(0x1e9)](_0x44dc09,new Map());const _0x29944c=connectionsCache[_0x3294ef(0x251)](_0x44dc09);_0x29944c[_0x3294ef(0x1e9)](String(_0x3125ce[_0x3294ef(0x2ff)]),{'name':_0x3125ce[_0x3294ef(0x2ff)],'chat_id':parseArrayStrict(_0x3125ce['chat_id']),'creator_id':_0x3125ce['creator_id']});}info(_0x3294ef(0x2d0)+_0x3294ef(0x26d)+_0x3294ef(0x29a)+'\x20loaded\x20('+_0x54516a[_0x3294ef(0x228)]+_0x3294ef(0x2df));}catch(_0x1a7139){warn(_0x3294ef(0x2d0)+_0x3294ef(0x24f)+_0x3294ef(0x1ef)+_0x3294ef(0x23c)+':\x20'+(_0x1a7139?.[_0x3294ef(0x2db)]||_0x1a7139));}}async function loadGroupDefaultsCache(){const _0x5e7436=_0x140048;try{const _0x5a74e1=await getDb(),_0x1afad8=await _0x5a74e1[_0x5e7436(0x32c)](_0x5e7436(0x2b5)+'up_id,\x20nam'+'e\x20FROM\x20gro'+_0x5e7436(0x1e3)+'s');groupDefaultsCache[_0x5e7436(0x27d)]();if(!_0x1afad8||!_0x1afad8[_0x5e7436(0x228)]){info(_0x5e7436(0x2d0)+_0x5e7436(0x276)+'efaults\x20ca'+_0x5e7436(0x2a1)+'\x20(0\x20rows)');return;}for(const _0x2058e6 of _0x1afad8){try{const _0x31add6=String(_0x2058e6[_0x5e7436(0x327)]),_0x26e999=safeParseJSON(_0x2058e6['name']),_0x3a2eb2=Array[_0x5e7436(0x230)](_0x26e999)?_0x26e999[_0x5e7436(0x301)](String):[];groupDefaultsCache[_0x5e7436(0x1e9)](_0x31add6,_0x3a2eb2);}catch(_0x48bbb6){}}info(_0x5e7436(0x2d0)+_0x5e7436(0x276)+_0x5e7436(0x23e)+_0x5e7436(0x2a1)+'\x20('+_0x1afad8[_0x5e7436(0x228)]+_0x5e7436(0x2df));}catch(_0x5ac27e){warn('[connectio'+_0x5e7436(0x349)+_0x5e7436(0x23f)+_0x5e7436(0x2c2)+_0x5e7436(0x1f3)+(_0x5ac27e?.[_0x5e7436(0x2db)]||_0x5ac27e));}}async function loadActiveGroupsCache(){const _0x5835d1=_0x140048;try{const _0x2a2665=await getDb(),_0x2659d1=await _0x2a2665[_0x5835d1(0x32c)](_0x5835d1(0x258)+_0x5835d1(0x2f4)+_0x5835d1(0x31e)+'\x20'+ACTIVE_TABLE);activeGroupByUser['clear']();if(!_0x2659d1||!_0x2659d1[_0x5835d1(0x228)]){info(_0x5835d1(0x2d0)+_0x5835d1(0x2a2)+_0x5835d1(0x334)+'he\x20loaded\x20'+_0x5835d1(0x338));return;}for(const _0x38951a of _0x2659d1){try{activeGroupByUser['set'](String(_0x38951a[_0x5835d1(0x1c9)]),String(_0x38951a['group_id']));}catch(_0x2344cd){}}info(_0x5835d1(0x2d0)+'n]\x20active\x20'+_0x5835d1(0x334)+_0x5835d1(0x2f1)+'('+_0x2659d1['length']+_0x5835d1(0x2df));}catch(_0x566d85){warn(_0x5835d1(0x2d0)+_0x5835d1(0x33a)+_0x5835d1(0x260)+_0x5835d1(0x200)+_0x5835d1(0x2ce)+(_0x566d85?.[_0x5835d1(0x2db)]||_0x566d85));}}export async function refreshCaches(){const _0x3c60e8=_0x140048;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info('[connectio'+_0x3c60e8(0x2ba)+_0x3c60e8(0x2a6)+'plete');}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x138f72){const _0x357c5d=_0x140048;if(!_0x138f72)return null;const _0x20e9df=String(_0x138f72)[_0x357c5d(0x1e6)]();if(!_0x20e9df)return null;return _0x20e9df[_0x357c5d(0x1de)]('@')?_0x20e9df[_0x357c5d(0x1d6)]('@')[0x2fc+0x61*-0x39+0x129d]:_0x20e9df;}export async function ensureSchema(){const _0x5ca8a1=_0x140048;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info('[connectio'+_0x5ca8a1(0x32a)+_0x5ca8a1(0x2e0)+_0x5ca8a1(0x2d1)+_0x5ca8a1(0x23d)+_0x5ca8a1(0x1e0)+'nly,\x20group'+_0x5ca8a1(0x22f)+_0x5ca8a1(0x1ea)+_0x5ca8a1(0x229));}catch(_0x4acf3d){error(_0x4acf3d,'[connectio'+_0x5ca8a1(0x1d1)+_0x5ca8a1(0x1ec)+_0x5ca8a1(0x1f3)+(_0x4acf3d?.['message']||_0x4acf3d));throw _0x4acf3d;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x59be42,_0x10637d){const _0x2d3c5a=_0x140048;try{if(!_0x59be42)return;const _0x836d2a=normalizeUserKeyForStorage(_0x59be42);if(!_0x836d2a)return;if(!_0x10637d){activeGroupByUser[_0x2d3c5a(0x1f5)](_0x836d2a);try{const _0x65ccde=await getDb();await _0x65ccde['run']('DELETE\x20FRO'+'M\x20'+ACTIVE_TABLE+(_0x2d3c5a(0x34d)+'r_key\x20=\x20?'),[_0x836d2a]);}catch(_0x308e55){warn(_0x2d3c5a(0x2d0)+'n]\x20failed\x20'+_0x2d3c5a(0x29b)+'\x20active\x20gr'+'oup\x20deleti'+_0x2d3c5a(0x20d)+(_0x308e55?.[_0x2d3c5a(0x2db)]||_0x308e55));}return;}const _0x2c6309=String(_0x10637d);activeGroupByUser[_0x2d3c5a(0x1e9)](_0x836d2a,_0x2c6309);try{const _0x450193=await getDb();await _0x450193['run'](_0x2d3c5a(0x245)+'O\x20'+ACTIVE_TABLE+(_0x2d3c5a(0x1ca)+_0x2d3c5a(0x2fc)+_0x2d3c5a(0x2f0)+_0x2d3c5a(0x31b)+_0x2d3c5a(0x28a)+'\x20\x20\x20\x20\x20\x20\x20\x20ON'+_0x2d3c5a(0x33e)+_0x2d3c5a(0x2a8)+_0x2d3c5a(0x25f)+_0x2d3c5a(0x248)+'id\x20=\x20exclu'+_0x2d3c5a(0x1f8)+'id'),[_0x836d2a,_0x2c6309]);}catch(_0x550995){warn(_0x2d3c5a(0x2d0)+_0x2d3c5a(0x1f1)+'to\x20persist'+'\x20active\x20gr'+_0x2d3c5a(0x28e)+(_0x550995?.[_0x2d3c5a(0x2db)]||_0x550995));}}catch(_0x35e08a){warn(_0x2d3c5a(0x2d0)+_0x2d3c5a(0x2d7)+_0x2d3c5a(0x2e9)+_0x2d3c5a(0x266)+':\x20'+(_0x35e08a?.['message']||_0x35e08a));}}export function getActiveGroupForUser(_0x2a7c8f){const _0x2791cf=_0x140048;try{if(!_0x2a7c8f)return null;const _0x4b0051=normalizeUserKeyForStorage(_0x2a7c8f);if(!_0x4b0051)return null;return activeGroupByUser[_0x2791cf(0x251)](_0x4b0051)||null;}catch(_0x165d5d){return warn(_0x2791cf(0x2d0)+'n]\x20getActi'+'veGroupFor'+_0x2791cf(0x266)+':\x20'+(_0x165d5d?.[_0x2791cf(0x2db)]||_0x165d5d)),null;}}export async function addConnection(_0xab187c,_0x1eece2,_0x5af726='',_0xa3101d=''){const _0x2ab695=_0x140048;try{await ensureSchema();const _0x40d4b1=await getDb(),_0x90994d=String(_0xa3101d||''),_0x39d78f=await _0x40d4b1[_0x2ab695(0x251)](_0x2ab695(0x34a)+_0x2ab695(0x348)+_0x2ab695(0x232)+_0x2ab695(0x2a9)+_0x2ab695(0x212)+_0x2ab695(0x1e1)+'=\x20?',[String(_0xab187c),_0x90994d]);if(!_0x39d78f){const _0x3f03be=[String(_0x1eece2)];await _0x40d4b1[_0x2ab695(0x2a7)]('INSERT\x20INT'+_0x2ab695(0x1cd)+_0x2ab695(0x303)+'\x20group_id,'+'\x20chat_id,\x20'+_0x2ab695(0x298)+_0x2ab695(0x2f0)+_0x2ab695(0x315)+')',[String(_0xab187c),_0x90994d,stringifyArray(_0x3f03be),String(_0x5af726||'')]),info(_0x2ab695(0x2d0)+_0x2ab695(0x1f0)+':\x20'+_0xab187c+'\x20->\x20'+_0x1eece2+_0x2ab695(0x231)+_0x5af726+')\x20@\x20group='+_0x90994d);if(!connectionsCache[_0x2ab695(0x280)](_0x90994d))connectionsCache[_0x2ab695(0x1e9)](_0x90994d,new Map());const _0x4b269e=connectionsCache['get'](_0x90994d);return _0x4b269e['set'](String(_0xab187c),{'name':String(_0xab187c),'chat_id':_0x3f03be['map'](String),'creator_id':String(_0x5af726||'')}),!![];}else{const _0x571851=parseArrayStrict(_0x39d78f[_0x2ab695(0x234)]);if(!_0x571851[_0x2ab695(0x1de)](String(_0x1eece2)))_0x571851[_0x2ab695(0x219)](String(_0x1eece2));await _0x40d4b1[_0x2ab695(0x2a7)](_0x2ab695(0x326)+'nections\x20S'+_0x2ab695(0x2e2)+_0x2ab695(0x20a)+_0x2ab695(0x293)+_0x2ab695(0x2bb)+_0x2ab695(0x259)+_0x2ab695(0x274)+'\x20?',[stringifyArray(_0x571851),String(_0x5af726||''),String(_0xab187c),_0x90994d]),info('[connectio'+_0x2ab695(0x273)+':\x20'+_0xab187c+'\x20->\x20'+_0x571851[_0x2ab695(0x32d)](',')+_0x2ab695(0x2e1)+_0x90994d);if(!connectionsCache[_0x2ab695(0x280)](_0x90994d))connectionsCache[_0x2ab695(0x1e9)](_0x90994d,new Map());const _0x51a9a1=connectionsCache[_0x2ab695(0x251)](_0x90994d);return _0x51a9a1['set'](String(_0xab187c),{'name':String(_0xab187c),'chat_id':_0x571851[_0x2ab695(0x301)](String),'creator_id':String(_0x5af726||'')}),!![];}}catch(_0x102c76){return error(_0x102c76,_0x2ab695(0x2d0)+'n]\x20addConn'+_0x2ab695(0x255)+_0x2ab695(0x2fb)+_0xab187c+_0x2ab695(0x2c9)+_0xa3101d),![];}}export async function deleteConnectionScoped(_0x4f0c46,_0x10c422=''){const _0x6d2583=_0x140048;try{await ensureSchema();const _0x48da2d=await getDb(),_0x21ee06=await _0x48da2d['run'](_0x6d2583(0x2c6)+_0x6d2583(0x2ec)+_0x6d2583(0x32b)+_0x6d2583(0x306)+'ND\x20group_i'+_0x6d2583(0x2cb),[String(_0x4f0c46),String(_0x10c422||'')]),_0x37e795=_0x21ee06&&(_0x21ee06['changes']===undefined?!![]:!!_0x21ee06[_0x6d2583(0x239)]);info(_0x6d2583(0x2d0)+_0x6d2583(0x2fd)+_0x6d2583(0x31d)+_0x6d2583(0x302)+_0x4f0c46+_0x6d2583(0x2c9)+_0x10c422+_0x6d2583(0x28b)+_0x37e795+')');try{const _0x57cc44=String(_0x10c422||'');if(connectionsCache[_0x6d2583(0x280)](_0x57cc44)){const _0x16f6a6=connectionsCache[_0x6d2583(0x251)](_0x57cc44);if(_0x16f6a6)_0x16f6a6[_0x6d2583(0x1f5)](String(_0x4f0c46));}}catch(_0x2691a9){}return _0x37e795;}catch(_0x5f0017){return error(_0x5f0017,_0x6d2583(0x2d0)+'n]\x20deleteC'+_0x6d2583(0x31d)+_0x6d2583(0x2af)+_0x6d2583(0x1f3)+_0x4f0c46+_0x6d2583(0x2c9)+_0x10c422),![];}}export async function deleteConnectionsByCreatorInGroup(_0x4a0cd9,_0x35fc31=''){const _0x14cfe7=_0x140048;try{await ensureSchema();const _0x1aa414=await getDb(),_0x19baee=await _0x1aa414['run']('DELETE\x20FRO'+_0x14cfe7(0x2ec)+'ons\x20WHERE\x20'+_0x14cfe7(0x298)+_0x14cfe7(0x2a5)+_0x14cfe7(0x297)+'?',[String(_0x4a0cd9),String(_0x35fc31||'')]),_0x448dfc=_0x19baee&&(_0x19baee[_0x14cfe7(0x239)]===undefined?!![]:_0x19baee[_0x14cfe7(0x239)])||-0x2370+-0x10*0x5a+0x2910;info(_0x14cfe7(0x2d0)+_0x14cfe7(0x2fd)+_0x14cfe7(0x275)+_0x14cfe7(0x1d7)+_0x14cfe7(0x2bc)+_0x4a0cd9+_0x14cfe7(0x2c9)+_0x35fc31+_0x14cfe7(0x28b)+_0x448dfc+')');try{const _0x49ab4c=String(_0x35fc31||'');if(connectionsCache['has'](_0x49ab4c)){const _0x1f818a=connectionsCache[_0x14cfe7(0x251)](_0x49ab4c);for(const [_0x82c174,_0xadf4e]of Array[_0x14cfe7(0x2b4)](_0x1f818a['entries']())){if(String(_0xadf4e['creator_id'])===String(_0x4a0cd9))_0x1f818a[_0x14cfe7(0x1f5)](_0x82c174);}}}catch(_0x2aaa92){}return _0x448dfc;}catch(_0x55a028){return error(_0x55a028,'[connectio'+_0x14cfe7(0x2fd)+_0x14cfe7(0x275)+_0x14cfe7(0x1d7)+_0x14cfe7(0x22c)+_0x14cfe7(0x205)+(_0x55a028?.['message']||_0x55a028)),0x6*0xf5+0x1*0x665+-0xc23;}}export async function removeChatIdsFromConnectionScoped(_0x561c65,_0x63f7f0,_0x2f5940=''){const _0x4e2320=_0x140048;try{if(!_0x561c65)return![];await ensureSchema();const _0x372cc1=await getDb(),_0x3e9ecd=await _0x372cc1[_0x4e2320(0x251)]('SELECT\x20cha'+_0x4e2320(0x348)+_0x4e2320(0x232)+_0x4e2320(0x2a9)+_0x4e2320(0x212)+_0x4e2320(0x1e1)+_0x4e2320(0x1fb),[String(_0x561c65),String(_0x2f5940||'')]);if(!_0x3e9ecd)return![];const _0x17c587=parseArrayStrict(_0x3e9ecd['chat_id']),_0xde7d01=Array[_0x4e2320(0x230)](_0x63f7f0)?_0x63f7f0['map'](String):[String(_0x63f7f0)],_0x42a646=_0x17c587[_0x4e2320(0x2b9)](_0x7a935a=>!_0xde7d01[_0x4e2320(0x1de)](_0x7a935a));if(_0x42a646[_0x4e2320(0x228)]===0x1*0x2251+0xc*0xba+-0x1*0x2b09){await _0x372cc1[_0x4e2320(0x2a7)](_0x4e2320(0x2c6)+_0x4e2320(0x2ec)+_0x4e2320(0x32b)+'name\x20=\x20?\x20A'+_0x4e2320(0x22d)+_0x4e2320(0x2cb),[String(_0x561c65),String(_0x2f5940||'')]),info('[connectio'+_0x4e2320(0x24e)+_0x4e2320(0x333)+_0x4e2320(0x1c5)+'Scoped:\x20re'+_0x4e2320(0x243)+'entries\x20fo'+'r\x20'+_0x561c65+_0x4e2320(0x2c9)+_0x2f5940+(_0x4e2320(0x23b)+'ted'));try{const _0x2dbb25=String(_0x2f5940||'');if(connectionsCache['has'](_0x2dbb25))connectionsCache[_0x4e2320(0x251)](_0x2dbb25)[_0x4e2320(0x1f5)](String(_0x561c65));}catch(_0x26fd7a){}return!![];}else{await _0x372cc1[_0x4e2320(0x2a7)](_0x4e2320(0x326)+_0x4e2320(0x314)+_0x4e2320(0x2e2)+_0x4e2320(0x31f)+_0x4e2320(0x225)+_0x4e2320(0x217)+_0x4e2320(0x284),[stringifyArray(_0x42a646),String(_0x561c65),String(_0x2f5940||'')]),info(_0x4e2320(0x2d0)+_0x4e2320(0x24e)+'hatIdsFrom'+_0x4e2320(0x1c5)+_0x4e2320(0x240)+_0x561c65+'@'+_0x2f5940+'\x20now\x20->\x20'+_0x42a646[_0x4e2320(0x32d)](','));try{const _0x1bb40a=String(_0x2f5940||'');if(!connectionsCache[_0x4e2320(0x280)](_0x1bb40a))connectionsCache[_0x4e2320(0x1e9)](_0x1bb40a,new Map());connectionsCache['get'](_0x1bb40a)['set'](String(_0x561c65),{'name':String(_0x561c65),'chat_id':_0x42a646['map'](String),'creator_id':connectionsCache[_0x4e2320(0x251)](_0x1bb40a)['get'](String(_0x561c65))?.[_0x4e2320(0x298)]||''});}catch(_0x28cbb6){}return!![];}}catch(_0xc9bebe){return error(_0xc9bebe,_0x4e2320(0x2d0)+_0x4e2320(0x24e)+_0x4e2320(0x333)+'Connection'+_0x4e2320(0x223)+_0x4e2320(0x205)+(_0xc9bebe?.[_0x4e2320(0x2db)]||_0xc9bebe)),![];}}export async function listConnectionsForGroup(_0x490bbb){const _0x2affb6=_0x140048;try{await ensureSchema();const _0x532255=String(_0x490bbb||'');if(connectionsCache[_0x2affb6(0x280)](_0x532255)){const _0x5bf8a7=connectionsCache[_0x2affb6(0x251)](_0x532255);return Array[_0x2affb6(0x2b4)](_0x5bf8a7[_0x2affb6(0x1fa)]())[_0x2affb6(0x301)](_0x4a86d1=>({'name':_0x4a86d1[_0x2affb6(0x2ff)],'chat_id':Array['isArray'](_0x4a86d1[_0x2affb6(0x234)])?_0x4a86d1[_0x2affb6(0x234)][_0x2affb6(0x301)](String):[],'creator_id':_0x4a86d1['creator_id']}));}const _0x316f78=await getDb(),_0x1e27a8=await _0x316f78['all'](_0x2affb6(0x310)+_0x2affb6(0x27a)+_0x2affb6(0x34e)+_0x2affb6(0x335)+_0x2affb6(0x261)+_0x2affb6(0x2b3)+_0x2affb6(0x1cc)+'RDER\x20BY\x20na'+'me',[_0x532255]);return(_0x1e27a8||[])[_0x2affb6(0x301)](_0x11bc3c=>({'name':_0x11bc3c[_0x2affb6(0x2ff)],'chat_id':parseArrayStrict(_0x11bc3c[_0x2affb6(0x234)]),'creator_id':_0x11bc3c[_0x2affb6(0x298)]}));}catch(_0x17d9d2){return error(_0x17d9d2,_0x2affb6(0x2d0)+_0x2affb6(0x318)+'nectionsFo'+_0x2affb6(0x34f)+_0x2affb6(0x205)+(_0x17d9d2?.[_0x2affb6(0x2db)]||_0x17d9d2)),[];}}export async function listConnectionsForUser(_0x25e0ca,_0x1fc240=null){const _0x4403c3=_0x140048;try{await ensureSchema();const _0x3b08b3=await getDb();if(_0x1fc240){const _0x30daa1=await _0x3b08b3[_0x4403c3(0x32c)](_0x4403c3(0x310)+_0x4403c3(0x27a)+_0x4403c3(0x34e)+_0x4403c3(0x335)+'nnections\x20'+_0x4403c3(0x237)+_0x4403c3(0x293)+_0x4403c3(0x26a)+'_id\x20=\x20?\x20OR'+_0x4403c3(0x320)+'e',[String(_0x25e0ca),String(_0x1fc240)]);return(_0x30daa1||[])[_0x4403c3(0x301)](_0x3bd1b3=>({'name':_0x3bd1b3[_0x4403c3(0x2ff)],'chat_id':parseArrayStrict(_0x3bd1b3['chat_id']),'creator_id':_0x3bd1b3[_0x4403c3(0x298)]}));}else{const _0x291b45=await _0x3b08b3[_0x4403c3(0x32c)](_0x4403c3(0x310)+_0x4403c3(0x27a)+',\x20creator_'+_0x4403c3(0x337)+_0x4403c3(0x335)+_0x4403c3(0x261)+'WHERE\x20crea'+_0x4403c3(0x293)+_0x4403c3(0x1f7)+_0x4403c3(0x1c6)+_0x4403c3(0x2ff),[String(_0x25e0ca)]);return(_0x291b45||[])[_0x4403c3(0x301)](_0xd70a6a=>({'name':_0xd70a6a[_0x4403c3(0x2ff)],'chat_id':parseArrayStrict(_0xd70a6a[_0x4403c3(0x234)]),'creator_id':_0xd70a6a[_0x4403c3(0x298)],'group_id':_0xd70a6a[_0x4403c3(0x327)]}));}}catch(_0x525508){return error(_0x525508,'[connectio'+'n]\x20listCon'+'nectionsFo'+_0x4403c3(0x1d5)+'ed'),[];}}export async function listAllConnections(){const _0x349ee8=_0x140048;try{await ensureSchema();const _0x3c533d=await getDb(),_0x4bbc29=await _0x3c533d[_0x349ee8(0x32c)](_0x349ee8(0x310)+_0x349ee8(0x27a)+',\x20creator_'+_0x349ee8(0x337)+'id\x20FROM\x20co'+_0x349ee8(0x261)+'ORDER\x20BY\x20g'+_0x349ee8(0x1da)+_0x349ee8(0x2ac));return(_0x4bbc29||[])[_0x349ee8(0x301)](_0x2c67db=>({'name':_0x2c67db[_0x349ee8(0x2ff)],'chat_id':parseArrayStrict(_0x2c67db[_0x349ee8(0x234)]),'creator_id':_0x2c67db[_0x349ee8(0x298)],'group_id':_0x2c67db[_0x349ee8(0x327)]}));}catch(_0x232063){return error(_0x232063,_0x349ee8(0x2d0)+_0x349ee8(0x1ee)+_0x349ee8(0x1c5)+_0x349ee8(0x34c)),[];}}export async function getConnectionScoped(_0x52b24f,_0x80c6ec=''){const _0x499f7a=_0x140048;try{await ensureSchema();const _0x3186b7=String(_0x80c6ec||'');if(connectionsCache['has'](_0x3186b7)&&connectionsCache[_0x499f7a(0x251)](_0x3186b7)[_0x499f7a(0x280)](String(_0x52b24f)))return connectionsCache['get'](_0x3186b7)[_0x499f7a(0x251)](String(_0x52b24f))['chat_id'][_0x499f7a(0x319)]();const _0x5bae16=await getDb(),_0x44b5ec=await _0x5bae16[_0x499f7a(0x251)](_0x499f7a(0x34a)+_0x499f7a(0x348)+'connection'+_0x499f7a(0x2a9)+'me\x20=\x20?\x20AND'+'\x20group_id\x20'+_0x499f7a(0x1fb),[String(_0x52b24f),_0x3186b7]);if(!_0x44b5ec)return null;return parseArrayStrict(_0x44b5ec['chat_id']);}catch(_0x3113f6){return error(_0x3113f6,_0x499f7a(0x2d0)+_0x499f7a(0x29d)+_0x499f7a(0x265)+_0x499f7a(0x308)+_0x52b24f+_0x499f7a(0x2c9)+_0x80c6ec+_0x499f7a(0x2b7)),null;}}export async function getConnectionRecordScoped(_0x3e1390,_0x482f82=''){const _0x4eea3b=_0x140048;try{await ensureSchema();const _0x1f4bd8=String(_0x482f82||'');if(connectionsCache[_0x4eea3b(0x280)](_0x1f4bd8)&&connectionsCache[_0x4eea3b(0x251)](_0x1f4bd8)[_0x4eea3b(0x280)](String(_0x3e1390))){const _0x2bbba4=connectionsCache['get'](_0x1f4bd8)[_0x4eea3b(0x251)](String(_0x3e1390));return{'name':_0x2bbba4[_0x4eea3b(0x2ff)],'chat_id':_0x2bbba4[_0x4eea3b(0x234)]['slice'](),'creator_id':_0x2bbba4[_0x4eea3b(0x298)]};}const _0x5e3092=await getDb(),_0x1699b8=await _0x5e3092['get'](_0x4eea3b(0x310)+_0x4eea3b(0x27a)+_0x4eea3b(0x34e)+_0x4eea3b(0x335)+_0x4eea3b(0x261)+_0x4eea3b(0x206)+'\x20=\x20?\x20AND\x20g'+'roup_id\x20=\x20'+'?',[String(_0x3e1390),_0x1f4bd8]);if(!_0x1699b8)return null;return{'name':_0x1699b8[_0x4eea3b(0x2ff)],'chat_id':parseArrayStrict(_0x1699b8[_0x4eea3b(0x234)]),'creator_id':_0x1699b8[_0x4eea3b(0x298)]};}catch(_0x32c36c){return error(_0x32c36c,_0x4eea3b(0x2d0)+_0x4eea3b(0x29d)+_0x4eea3b(0x201)+_0x4eea3b(0x2b8)+_0x3e1390+_0x4eea3b(0x2c9)+_0x482f82+_0x4eea3b(0x2b7)),null;}}export async function getConnectionName(_0x44a628){const _0x2863c3=_0x140048;try{await ensureSchema();for(const [_0x588f3d,_0x42f525]of connectionsCache[_0x2863c3(0x2e3)]()){for(const [_0x5e560a,_0x1799d8]of _0x42f525[_0x2863c3(0x2e3)]()){if(Array[_0x2863c3(0x230)](_0x1799d8[_0x2863c3(0x234)])&&_0x1799d8[_0x2863c3(0x234)]['includes'](String(_0x44a628)))return _0x5e560a;}}const _0x35d2bb=await getDb(),_0x4979fd=await _0x35d2bb[_0x2863c3(0x32c)](_0x2863c3(0x310)+_0x2863c3(0x27a)+_0x2863c3(0x27c)+_0x2863c3(0x277));for(const _0x1d78d0 of _0x4979fd||[]){const _0x6a1fe7=parseArrayStrict(_0x1d78d0[_0x2863c3(0x234)]);if(_0x6a1fe7[_0x2863c3(0x1de)](String(_0x44a628)))return _0x1d78d0[_0x2863c3(0x2ff)];}return null;}catch(_0x2f0f17){return error(_0x2f0f17,_0x2863c3(0x2d0)+'n]\x20getConn'+_0x2863c3(0x292)+'('+_0x44a628+')\x20failed'),null;}}export async function setDefaultGroup(_0x1f4c3b,_0x906d86){const _0x446eac=_0x140048;try{await ensureSchema();const _0x34ca57=await getDb();if(!_0x906d86)throw new Error('groupId\x20re'+'quired\x20for'+_0x446eac(0x224)+_0x446eac(0x30f));if(!_0x1f4c3b||Array[_0x446eac(0x230)](_0x1f4c3b)&&_0x1f4c3b[_0x446eac(0x228)]===-0x1829+-0xb8d*0x2+-0x1*-0x2f43)return await _0x34ca57[_0x446eac(0x2a7)](_0x446eac(0x2c6)+_0x446eac(0x29c)+_0x446eac(0x226)+'RE\x20group_i'+'d\x20=\x20?',[String(_0x906d86)]),groupDefaultsCache[_0x446eac(0x1f5)](String(_0x906d86)),info(_0x446eac(0x2d0)+'n]\x20group\x20d'+_0x446eac(0x2ef)+_0x446eac(0x33d)+_0x906d86),!![];let _0xa4acac=[];if(typeof _0x1f4c3b===_0x446eac(0x29e)&&_0x1f4c3b['toLowerCas'+'e']()===_0x446eac(0x32c)){const _0x57b16f=await listConnectionsForGroup(String(_0x906d86));_0xa4acac=(_0x57b16f||[])[_0x446eac(0x301)](_0x993b00=>_0x993b00[_0x446eac(0x2ff)])[_0x446eac(0x2b9)](Boolean);if(!_0xa4acac['length'])throw new Error(_0x446eac(0x1dd)+_0x446eac(0x1e2)+_0x446eac(0x1d8)+_0x446eac(0x20e));}else{if(Array[_0x446eac(0x230)](_0x1f4c3b))_0xa4acac=_0x1f4c3b['map'](String)[_0x446eac(0x2b9)](Boolean);else{if(typeof _0x1f4c3b===_0x446eac(0x29e)){if(_0x1f4c3b[_0x446eac(0x1de)](','))_0xa4acac=_0x1f4c3b['split'](',')[_0x446eac(0x301)](_0x61f035=>_0x61f035[_0x446eac(0x1e6)]())[_0x446eac(0x2b9)](Boolean);else _0xa4acac=[_0x1f4c3b];}else throw new Error(_0x446eac(0x2c8)+'d\x20namesOrA'+'rray\x20type\x20'+_0x446eac(0x22e)+_0x446eac(0x31a));}}if(!_0xa4acac[_0x446eac(0x228)])throw new Error(_0x446eac(0x1d9)+_0x446eac(0x270)+_0x446eac(0x1e7)+_0x446eac(0x1fe)+_0x446eac(0x344)+_0x446eac(0x2c5));const _0x4024a6=[];for(const _0x199b68 of _0xa4acac){const _0x217a86=await _0x34ca57[_0x446eac(0x251)](_0x446eac(0x209)+_0x446eac(0x1e5)+'tions\x20WHER'+_0x446eac(0x247)+_0x446eac(0x26a)+'_id\x20=\x20?',[String(_0x199b68),String(_0x906d86)]);if(_0x217a86)_0x4024a6[_0x446eac(0x219)](_0x199b68);else warn(_0x446eac(0x2d0)+'n]\x20setDefa'+_0x446eac(0x329)+'skipping\x20n'+_0x446eac(0x2d8)+_0x446eac(0x305)+'on\x20\x22'+_0x199b68+_0x446eac(0x252)+_0x906d86);}if(!_0x4024a6[_0x446eac(0x228)])throw new Error(_0x446eac(0x29f)+_0x446eac(0x1f9)+_0x446eac(0x2d5)+_0x446eac(0x26f)+'ist\x20in\x20thi'+_0x446eac(0x2a3));return await _0x34ca57[_0x446eac(0x2a7)](_0x446eac(0x245)+_0x446eac(0x339)+_0x446eac(0x2f2)+_0x446eac(0x294)+_0x446eac(0x262)+'\x20(?,\x20?)\x0a\x20\x20'+_0x446eac(0x25e)+_0x446eac(0x2cd)+_0x446eac(0x2be)+_0x446eac(0x286)+_0x446eac(0x26e)+_0x446eac(0x331)+'e;',[String(_0x906d86),JSON[_0x446eac(0x268)](_0x4024a6)]),groupDefaultsCache[_0x446eac(0x1e9)](String(_0x906d86),_0x4024a6[_0x446eac(0x319)]()),info(_0x446eac(0x2d0)+_0x446eac(0x276)+_0x446eac(0x2f6)+_0x446eac(0x236)+_0x906d86+'\x20->\x20'+JSON[_0x446eac(0x268)](_0x4024a6)),!![];}catch(_0x515c9c){return error(_0x515c9c,_0x446eac(0x2d0)+_0x446eac(0x24b)+'ultGroup\x20f'+_0x446eac(0x342)+_0x906d86+':\x20'+(_0x515c9c?.[_0x446eac(0x2db)]||_0x515c9c)),![];}}export async function getDefaultForGroup(_0xdd0495){const _0x526983=_0x140048;try{await ensureSchema();if(!_0xdd0495)return null;const _0x3313d9=String(_0xdd0495);if(groupDefaultsCache[_0x526983(0x280)](_0x3313d9)){const _0x2979be=groupDefaultsCache['get'](_0x3313d9);return Array[_0x526983(0x230)](_0x2979be)?_0x2979be[_0x526983(0x301)](String):null;}const _0x4af7b0=await getDb(),_0x5521d9=await _0x4af7b0[_0x526983(0x251)](_0x526983(0x310)+_0x526983(0x341)+_0x526983(0x1e3)+_0x526983(0x1ce)+_0x526983(0x22b),[_0x3313d9]);if(!_0x5521d9||!_0x5521d9['name'])return null;try{const _0x49fb95=JSON[_0x526983(0x295)](_0x5521d9[_0x526983(0x2ff)]);if(Array[_0x526983(0x230)](_0x49fb95))return groupDefaultsCache[_0x526983(0x1e9)](_0x3313d9,_0x49fb95[_0x526983(0x301)](String)),_0x49fb95[_0x526983(0x301)](String);}catch(_0x3a3f87){}return null;}catch(_0x367656){return error(_0x367656,'[connectio'+_0x526983(0x323)+_0x526983(0x2ed)+_0x526983(0x272)+_0x526983(0x332)+_0xdd0495),null;}}export async function getDefault(_0x31b61d){const _0x7e85b4=_0x140048;try{await ensureSchema();const _0x2f44d8=getActiveGroupForUser(String(_0x31b61d));if(!_0x2f44d8)return null;return await getDefaultForGroup(_0x2f44d8);}catch(_0x5989a1){return error(_0x5989a1,_0x7e85b4(0x2d0)+_0x7e85b4(0x323)+_0x7e85b4(0x31c)+'\x20for\x20'+_0x31b61d),null;}}export async function getConnection(_0x297bbf){const _0xcf543f=_0x140048;try{await ensureSchema();const _0x37edaa=await getDb(),_0x2844d5=await _0x37edaa[_0xcf543f(0x32c)](_0xcf543f(0x34a)+'t_id\x20FROM\x20'+_0xcf543f(0x232)+'s\x20WHERE\x20na'+_0xcf543f(0x311),[String(_0x297bbf)]);if(!_0x2844d5||!_0x2844d5[_0xcf543f(0x228)])return null;const _0x419a09=[];for(const _0x48ad3a of _0x2844d5){const _0x1bdfdd=parseArrayStrict(_0x48ad3a[_0xcf543f(0x234)]);for(const _0x10f8de of _0x1bdfdd)if(!_0x419a09[_0xcf543f(0x1de)](_0x10f8de))_0x419a09[_0xcf543f(0x219)](_0x10f8de);}return _0x419a09;}catch(_0x31fc1b){return error(_0x31fc1b,_0xcf543f(0x2d0)+'n]\x20getConn'+_0xcf543f(0x1cb)+_0x297bbf+_0xcf543f(0x2b7)),null;}}export async function getConnectionRecord(_0x55f7ca){const _0x2d7d6b=_0x140048;try{await ensureSchema();const _0x11d964=await getDb(),_0x1e5865=await _0x11d964[_0x2d7d6b(0x251)](_0x2d7d6b(0x310)+_0x2d7d6b(0x27a)+_0x2d7d6b(0x34e)+_0x2d7d6b(0x337)+'id\x20FROM\x20co'+_0x2d7d6b(0x261)+_0x2d7d6b(0x206)+'\x20=\x20?\x20LIMIT'+'\x201',[String(_0x55f7ca)]);if(!_0x1e5865)return null;return{'name':_0x1e5865['name'],'chat_id':parseArrayStrict(_0x1e5865[_0x2d7d6b(0x234)]),'creator_id':_0x1e5865[_0x2d7d6b(0x298)],'group_id':_0x1e5865[_0x2d7d6b(0x327)]};}catch(_0x3f6af6){return error(_0x3f6af6,_0x2d7d6b(0x2d0)+_0x2d7d6b(0x29d)+_0x2d7d6b(0x201)+'rd('+_0x55f7ca+')\x20failed'),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};