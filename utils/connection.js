function _0x1f05(){const _0x256e86=['No\x20connect','ailed\x20for\x20','for\x20setDef','group_id','Array\x20fail','push','DELETE\x20FRO','O\x20group_de','e,\x20chat_id','\x20IF\x20EXISTS','che\x20failed','[connectio','ame','\x20->\x20','EY\x20(name,\x20','ons_new\x20RE','_id\x20TEXT\x20N','up_id\x20colu','ions\x20found','nly,\x20group','id\x20for\x20\x22','ult\x20failed','\x20\x20\x20\x20name\x20T','\x20FROM\x20conn','\x20=\x20?\x20AND\x20g','creator_id','split','\x22\x20@\x20group\x20','rray\x20type\x20','id\x20TEXT\x20NO','exec','\x20setDefaul','5214bpFJTF',',\x20row\x20dele','rdScoped(','LUMN\x20chat_','for\x20','STS\x20','56417EEowUB','rGroup\x20fai','k\x20failed\x20f','ATE\x20TABLE\x20','\x20(creator=','d\x20migratio',')\x20@\x20group=','RE\x20group_i','ded.group_','hat_id\x20TEX','RY\x20KEY,\x0a\x20\x20','on]\x20normal','IF\x20NOT\x20EXI','UPDATE\x20con','e\x20provided','ator_id\x20TE','LL,\x0a\x20\x20\x20\x20\x20\x20','ons\x20->\x20con','ROM\x20connec','\x20CONFLICT(','n]\x20updated','\x20=\x20?\x20LIMIT','name\x20=\x20?\x20A','n]\x20setActi','all','32088VROHDM','\x20user_key\x20','on\x20to\x20new\x20','\x20into\x20conn','\x20\x20\x20\x20group_','\x20COLUMN\x20na','user_key','\x20@\x20group=','ET\x20chat_id','lumn','E\x20group_de','ed(','isArray','n]\x20refresh','24TssuRL','e,\x20group_i','[INFO]','\x20ORDER\x20BY\x20','ons\x20WHERE\x20','\x20=\x20?\x20WHERE','TO\x20connect','led\x20for\x20','NULL,\x0a\x20\x20\x20\x20','n]\x20removeC','\x20\x20\x20\x20\x20ON\x20CO','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)',';\x0a\x20\x20\x20\x20\x20\x20','connection','from','L,\x0a\x20\x20\x20\x20\x20\x20\x20','n]\x20migrate','t\x20connecti','g\x20old\x20rows','entries','n]\x20loadGro','rUser\x20fail','\x20to\x20update','on]\x20insert','entries\x20fo','=\x20?','n]\x20failed\x20','n]\x20listAll','\x20@\x20','message','n]\x20columnE','\x20active\x20gr','\x20(user_key','groups\x20cac','n]\x20listCon','n]\x20group\x20d','ection\x20fai','p_id\x20PK)','plete','5159rMsvbC','run','\x20table\x20con','DEFAULT\x20\x27\x27','tions\x20WHER','skipping\x20n',';\x0a\x20\x20\x20\x20','OT\x20NULL\x20DE','trim','undefined','tor_id\x20=\x20?','ons\x20(name,','che\x20loaded','faults\x20ADD','\x20\x20\x20\x20\x20\x20);\x0a\x20','\x20\x20\x20\x20\x20creat','2981445aGTkSp','INSERT\x20OR\x20','id\x20=\x20?','upDefaults','No\x20valid\x20c','map','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','DROP\x20TABLE','ections_ne','n]\x20active\x20','[WARN]','eConnectio','\x0a\x20\x20\x20\x20\x20\x20CRE','ator_id\x20co','15735waqgXC','user_key)\x20','ed:\x20','e\x20FROM\x20gro','SELECT\x201\x20F','n\x20names\x20ex','NOT\x20NULL\x0a\x20','DER\x20BY\x20nam','WHERE\x20grou','\x20(arrays-o','function','[]\x27,\x0a\x20\x20\x20\x20\x20','\x20rows)','\x20WHERE\x20typ','\x20{\x20db\x20}','changes','id\x20=\x20exclu','oup_id\x20TEX','BEGIN\x20TRAN','Connection','pDefaultsC','SELECT\x20cha','n]\x20getDefa','error','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','E\x20IF\x20NOT\x20E','database.j','\x20group_id\x20','issing\x20cha','nections\x20S','_id,\x20creat','oup_id\x20=\x20?','316DKJbks','he\x20loaded\x20','nsChatIdTo','AND\x20name\x20=','group_defa','O\x20connecti','up_id,\x20nam','p\x20failed\x20f','d\x20=\x20?','ist\x20in\x20thi','nnections;','t_id','\x20DEFAULT\x20\x27','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','ensured\x20an',',\x20group_id','STS\x20connec','UPDATE\x20SET','s\x20group','ailed:\x20','nnections\x20','join','d,\x20chat_id','s\x20failed','string','\x20connectio','_defaults\x20','n]\x20getConn','\x20AND\x20group','\x20(?,\x20?)\x0a\x20\x20','n][migrati','nectionsCa','faults\x20WHE','\x20for\x20','e_groups','ultGroup:\x20','on]\x20readin','XT\x20NOT\x20NUL','ults','\x20loaded\x20(0','ultGroup\x20f','parse','n]\x20deleteC','hatIdsFrom','set','5076310vJFmNK','ded.','group_id)\x0a','SELECT\x20gro','veGroupFor','n]\x20connect','M\x20group_de','\x20loaded\x20(','WHERE\x20crea','xists\x20chec','ons\x20ADD\x20CO','T\x20NULL\x20DEF','\x20table\x20','to\x20persist','user_activ','moved\x20all\x20','\x20name\x20=\x20ex','defaults\x20(','tions\x20(\x0a\x20\x20','delete','w\x20failed\x20f','E\x20name\x20=\x20?','\x20WHERE\x20use','Unsupporte','LUMN\x20creat','onnections','\x0a\x20\x20\x20\x20\x20\x20\x20\x20C','ions_new\x20(','XT\x20PRIMARY','[ERROR]','None\x20of\x20th','Cache\x20fail','COMMIT;','r_key,\x20gro','ectionReco','Scoped:\x20','\x20\x20PRIMARY\x20','2041596ihhHul','n]\x20getActi','etDefaultG','id\x20FROM\x20co','with\x20group','ALTER\x20TABL',',\x20creator_','or_id)\x20VAL','ectionScop','quired\x20for','\x20WHERE\x20nam','ite_master','s\x20schema\x20f','n]\x20created','ized\x20chat_','WHERE\x20name','\x20KEY,\x0a\x20\x20\x20\x20','oup\x20deleti','r_key\x20=\x20?','n]\x20migrati','roup_id,\x20n','XISTS\x20conn','s\x20SET\x20name','efaults\x20ca','led:\x20','n\x20complete','eGroupDefa','to\x20add\x20cha','stringify','has','ByCreatorI','up_id)\x20DO\x20','olumns\x20fai','onnectionS','up_id\x20FROM','FAULT\x20\x27\x27;','E\x20connecti','names\x20prov','to\x20import\x20','tGroup','aults\x20for\x20','d\x20connecti','n]\x20loadCon','s\x20WHERE\x20gr','or\x20','issing\x20gro','e\x20FROM\x20sql','NFLICT(gro','Scoped\x20fai','length','User\x20error','\x20chat_id,\x20','values','get','me\x20=\x20?\x20AND','to\x20add\x20cre','on]\x20failed','issing\x20cre','n]\x20setDefa','\x20NOT\x20NULL\x20','\x20\x20\x20\x20\x20\x20\x20\x20ON','UPDATE\x20gro','clear','ections','\x20to\x20set\x20as','AND\x20group_','AULT\x20\x27[]\x27;','chat_id',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','EXT\x20NOT\x20NU','d\x20namesOrA','\x20group_def','up_default','w\x20(\x0a\x20\x20\x20\x20\x20\x20','\x20(deleted=','me\x20=\x20?','n]\x20addGrou','cluded.nam','n]\x20schema\x20','\x20group_id,','24uXxROK','Scoped:\x20re','ted','id,\x20group_','on-existen','e\x20=\x20?\x20AND\x20','SELECT\x20nam','M\x20connecti','faults\x20(gr','n]\x20loadAct','\x20\x20\x20\x20\x20\x20\x20cre','rd(','filter','database\x20m','slice','\x20now\x20->\x20','name','ided\x20for\x20s','_id)','ultsNameTo','toLowerCas','\x20=\x20?,\x20crea','INSERT\x20INT','T\x20NOT\x20NULL','?,\x20?,\x20?,\x20?','me\x20TEXT\x20NO','REPLACE\x20IN','385WnyZiE','\x20TEXT\x20NOT\x20','nnections','t_id\x20FROM\x20','\x20name\x20=\x20?\x20',')\x20VALUES\x20(','coped\x20fail','includes','efault\x20cle','\x20all','me)\x20VALUES','group_id\x20=','n]\x20ensureS','ND\x20group_i','some','roup_id\x20TE','RDER\x20BY\x20na','ions\x20cache','oup_id,\x20na','-scoped).\x20',')\x20failed','SACTION;','ns;','n]\x20added\x20m','Caches\x20loa','s\x20WHERE\x20na','\x20\x20\x20\x20\x20\x20chat'];_0x1f05=function(){return _0x256e86;};return _0x1f05();}const _0xcfdb91=_0x5f04;(function(_0xec80dd,_0x44537c){const _0x2d31ee=_0x5f04,_0x1c34f2=_0xec80dd();while(!![]){try{const _0x52ad5c=parseInt(_0x2d31ee(0x2a0))/(0x4e2+-0x6f*0x13+0x35c)*(parseInt(_0x2d31ee(0x2c7))/(0x4a2*0x8+-0xfa1+-0x5*0x449))+parseInt(_0x2d31ee(0x174))/(0x201d*0x1+0x1a9a+0xd*-0x484)+parseInt(_0x2d31ee(0x1a2))/(0x4f0+-0xb5d*0x1+-0x1*-0x671)*(-parseInt(_0x2d31ee(0x182))/(0x3e9+-0x1773+0x138f*0x1))+parseInt(_0x2d31ee(0x29a))/(0x8ec+-0x139d+0xab7)*(parseInt(_0x2d31ee(0x164))/(-0x1*-0x204d+0xc2f+-0x2c75))+-parseInt(_0x2d31ee(0x244))/(-0xa3d+-0xc4*0x26+0x275d)*(parseInt(_0x2d31ee(0x1f4))/(-0x3*0x7eb+-0x1b3a+0x3304))+-parseInt(_0x2d31ee(0x1cf))/(0x57*-0x5c+-0x223d+-0x165*-0x2f)+parseInt(_0x2d31ee(0x25f))/(0xb9b+-0xcb1+0x121*0x1)*(parseInt(_0x2d31ee(0x2b9))/(0x2d9*0xd+-0x3c7*0x1+-0x2132));if(_0x52ad5c===_0x44537c)break;else _0x1c34f2['push'](_0x1c34f2['shift']());}catch(_0x37fb23){_0x1c34f2['push'](_0x1c34f2['shift']());}}}(_0x1f05,0x124d7e+0x1c95b+-0x1ab1*0x33));import{info as _0xc3b75e,warn as _0x2b5e99,error as _0x58cb65}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0xcfdb91(0x1dd)+_0xcfdb91(0x1c4);function info(..._0x21eaac){const _0x487daa=_0xcfdb91;try{_0xc3b75e(..._0x21eaac);}catch(_0x8b1fe6){console['log'](_0x487daa(0x2c9),..._0x21eaac);}}function warn(..._0x18a10d){const _0x5bd070=_0xcfdb91;try{_0x2b5e99(..._0x18a10d);}catch(_0xc93d38){console['warn'](_0x5bd070(0x17e),..._0x18a10d);}}function error(..._0x20b320){const _0xb3a9c3=_0xcfdb91;try{_0x58cb65(..._0x20b320);}catch(_0x449b55){console[_0xb3a9c3(0x199)](_0xb3a9c3(0x1ec),..._0x20b320);}}async function getDb(){const _0x398354=_0xcfdb91;if(db&&typeof db[_0x398354(0x298)]===_0x398354(0x18c))return db;try{const _0x49edc4=await import('./database.js');if(_0x49edc4&&_0x49edc4['db'])return db=_0x49edc4['db'],db;throw new Error(_0x398354(0x251)+'odule\x20did\x20'+'not\x20export'+_0x398354(0x190));}catch(_0x10f17d){error(_0x10f17d,_0x398354(0x285)+'n]\x20failed\x20'+_0x398354(0x21a)+_0x398354(0x19c)+'s');throw _0x10f17d;}}function safeParseJSON(_0x5c3b90){const _0x1dc83d=_0xcfdb91;try{return JSON[_0x1dc83d(0x1cb)](_0x5c3b90);}catch(_0x1d3419){return null;}}function asArrayStrict(_0x13bc26){const _0x19b08a=_0xcfdb91;if(_0x13bc26===null||_0x13bc26===undefined)return[];if(typeof _0x13bc26===_0x19b08a(0x1ba)){const _0x9a232e=safeParseJSON(_0x13bc26);if(Array[_0x19b08a(0x2c5)](_0x9a232e))return _0x9a232e['map'](String);return[_0x13bc26];}if(Array[_0x19b08a(0x2c5)](_0x13bc26))return _0x13bc26[_0x19b08a(0x179)](String);return[String(_0x13bc26)];}function toJSONString(_0x31f2f8){const _0x2e28f2=_0xcfdb91;return JSON[_0x2e28f2(0x210)](Array[_0x2e28f2(0x2c5)](_0x31f2f8)?_0x31f2f8[_0x2e28f2(0x179)](String):[]);}async function tableExists(_0x467a21){const _0x43eeb5=_0xcfdb91,_0x405e4=await getDb(),_0x2f3205=await _0x405e4[_0x43eeb5(0x229)](_0x43eeb5(0x24a)+_0x43eeb5(0x222)+_0x43eeb5(0x1ff)+_0x43eeb5(0x18f)+'e=\x27table\x27\x20'+_0x43eeb5(0x1a5)+'\x20?',[String(_0x467a21)]);return!!_0x2f3205;}async function columnExists(_0x26200e,_0x44fa83){const _0x329ed6=_0xcfdb91;try{const _0x4196f8=await getDb(),_0xfab831=await _0x4196f8[_0x329ed6(0x2b8)]('PRAGMA\x20tab'+'le_info('+_0x26200e+')');if(!Array[_0x329ed6(0x2c5)](_0xfab831))return![];return _0xfab831[_0x329ed6(0x26d)](_0x49577b=>String(_0x49577b[_0x329ed6(0x254)])['toLowerCas'+'e']()===String(_0x44fa83)[_0x329ed6(0x258)+'e']());}catch(_0x41246b){return warn('[connectio'+_0x329ed6(0x15b)+_0x329ed6(0x1d8)+_0x329ed6(0x2a2)+_0x329ed6(0x220)+_0x26200e+'.'+_0x44fa83+':\x20'+(_0x41246b?.[_0x329ed6(0x15a)]||_0x41246b)),![];}}async function ensureConnectionsTable(){const _0x2713a0=_0xcfdb91,_0x29002a=await getDb(),_0x2e8627=await tableExists(_0x2713a0(0x2d4)+'s');if(!_0x2e8627){await _0x29002a['exec']('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x2713a0(0x2a3)+_0x2713a0(0x2ac)+_0x2713a0(0x1b2)+_0x2713a0(0x1e1)+'\x20\x20\x20\x20\x20\x20name'+_0x2713a0(0x260)+_0x2713a0(0x2cf)+_0x2713a0(0x2bd)+_0x2713a0(0x297)+'T\x20NULL,\x0a\x20\x20'+_0x2713a0(0x279)+_0x2713a0(0x28a)+'OT\x20NULL,\x0a\x20'+_0x2713a0(0x24e)+_0x2713a0(0x2af)+_0x2713a0(0x1c7)+_0x2713a0(0x2d6)+'\x20PRIMARY\x20K'+_0x2713a0(0x288)+_0x2713a0(0x1d1)+_0x2713a0(0x172)+'\x20\x20\x20'),info(_0x2713a0(0x285)+'n]\x20created'+_0x2713a0(0x166)+'nections\x20('+'name,\x20grou'+_0x2713a0(0x162));return;}const _0x104fd0=await columnExists(_0x2713a0(0x2d4)+'s',_0x2713a0(0x27d)),_0xda0fb3=await columnExists(_0x2713a0(0x2d4)+'s',_0x2713a0(0x237)),_0x29f075=await columnExists(_0x2713a0(0x2d4)+'s',_0x2713a0(0x293));if(!_0xda0fb3||!_0x29f075||!_0x104fd0)try{await _0x29002a[_0x2713a0(0x298)](_0x2713a0(0x1e9)+'REATE\x20TABL'+_0x2713a0(0x19b)+_0x2713a0(0x209)+_0x2713a0(0x17c)+_0x2713a0(0x23d)+'\x20\x20\x20\x20name\x20T'+_0x2713a0(0x239)+_0x2713a0(0x2b0)+_0x2713a0(0x2bd)+_0x2713a0(0x297)+_0x2713a0(0x1da)+'AULT\x20\x27\x27,\x0a\x20'+_0x2713a0(0x1af)+_0x2713a0(0x2a9)+_0x2713a0(0x25b)+'\x20DEFAULT\x20\x27'+_0x2713a0(0x18d)+_0x2713a0(0x173)+'or_id\x20TEXT'+_0x2713a0(0x22f)+_0x2713a0(0x167)+_0x2713a0(0x238)+_0x2713a0(0x1f3)+'KEY\x20(name,'+'\x20group_id)'+_0x2713a0(0x2d2)+_0x2713a0(0x2d3));try{const _0x1e19ce=await _0x29002a[_0x2713a0(0x2b8)](_0x2713a0(0x24a)+'e,\x20chat_id'+_0x2713a0(0x1fa)+'id\x20FROM\x20co'+'nnections');if(Array['isArray'](_0x1e19ce)&&_0x1e19ce[_0x2713a0(0x225)])for(const _0x463f7d of _0x1e19ce){const _0x4e63e3=_0x463f7d[_0x2713a0(0x254)],_0x42c484=typeof _0x463f7d[_0x2713a0(0x237)]===_0x2713a0(0x16d)||_0x463f7d[_0x2713a0(0x237)]===null?'[]':_0x463f7d[_0x2713a0(0x237)],_0x1b3a92=typeof _0x463f7d[_0x2713a0(0x293)]===_0x2713a0(0x16d)||_0x463f7d[_0x2713a0(0x293)]===null?'':_0x463f7d[_0x2713a0(0x293)];try{await _0x29002a[_0x2713a0(0x165)](_0x2713a0(0x175)+_0x2713a0(0x25e)+_0x2713a0(0x2cd)+_0x2713a0(0x1ea)+'name,\x20grou'+'p_id,\x20chat'+_0x2713a0(0x1a0)+_0x2713a0(0x1fb)+'UES\x20(?,\x20?,'+'\x20?,\x20?)',[_0x4e63e3,'',_0x42c484,_0x1b3a92]);}catch(_0x57193b){warn(_0x2713a0(0x285)+_0x2713a0(0x1c0)+_0x2713a0(0x154)+_0x2713a0(0x2bc)+_0x2713a0(0x17c)+_0x2713a0(0x1e3)+_0x2713a0(0x220)+_0x4e63e3+':\x20'+(_0x57193b?.[_0x2713a0(0x15a)]||_0x57193b));}}}catch(_0x3bbd55){warn(_0x2713a0(0x285)+_0x2713a0(0x1c0)+_0x2713a0(0x1c6)+_0x2713a0(0x2d9)+'\x20failed:\x20'+(_0x3bbd55?.[_0x2713a0(0x15a)]||_0x3bbd55));}try{await _0x29002a[_0x2713a0(0x298)](_0x2713a0(0x17b)+_0x2713a0(0x283)+_0x2713a0(0x1bb)+_0x2713a0(0x275));}catch(_0x158398){}await _0x29002a['exec'](_0x2713a0(0x1f9)+_0x2713a0(0x218)+_0x2713a0(0x289)+'NAME\x20TO\x20co'+_0x2713a0(0x1ac)),info('[connectio'+_0x2713a0(0x2d7)+_0x2713a0(0x21d)+_0x2713a0(0x2b1)+'nections\x20('+_0x2713a0(0x1f8)+_0x2713a0(0x256));}catch(_0x4f58a6){warn(_0x2713a0(0x285)+_0x2713a0(0x207)+_0x2713a0(0x2bb)+_0x2713a0(0x2d4)+_0x2713a0(0x200)+_0x2713a0(0x1b5)+(_0x4f58a6?.['message']||_0x4f58a6));if(!_0xda0fb3)try{await _0x29002a['exec'](_0x2713a0(0x1f9)+_0x2713a0(0x218)+_0x2713a0(0x1d9)+_0x2713a0(0x29d)+_0x2713a0(0x297)+_0x2713a0(0x1da)+_0x2713a0(0x236)),info(_0x2713a0(0x285)+'n]\x20added\x20m'+_0x2713a0(0x19e)+'t_id\x20colum'+'n');}catch(_0xc01888){warn(_0xc01888,_0x2713a0(0x285)+_0x2713a0(0x157)+_0x2713a0(0x20f)+_0x2713a0(0x1ad));}if(!_0x29f075)try{await _0x29002a[_0x2713a0(0x298)](_0x2713a0(0x1f9)+_0x2713a0(0x218)+'ons\x20ADD\x20CO'+_0x2713a0(0x1e7)+'or_id\x20TEXT'+_0x2713a0(0x22f)+_0x2713a0(0x167)+';'),info(_0x2713a0(0x285)+'n]\x20added\x20m'+_0x2713a0(0x22d)+_0x2713a0(0x181)+_0x2713a0(0x2c2));}catch(_0x2a3c36){warn(_0x2a3c36,_0x2713a0(0x285)+_0x2713a0(0x157)+_0x2713a0(0x22b)+'ator_id');}if(!_0x104fd0)try{await _0x29002a[_0x2713a0(0x298)]('ALTER\x20TABL'+'E\x20connecti'+'ons\x20ADD\x20CO'+'LUMN\x20group'+_0x2713a0(0x28a)+_0x2713a0(0x16b)+_0x2713a0(0x217)),info('[connectio'+_0x2713a0(0x276)+_0x2713a0(0x221)+_0x2713a0(0x28b)+'mn');}catch(_0x295d8c){warn(_0x295d8c,_0x2713a0(0x285)+_0x2713a0(0x157)+'to\x20add\x20gro'+'up_id');}}}async function ensureGroupDefaultsTable(){const _0x49f143=_0xcfdb91,_0xddf457=await getDb(),_0x9fd488=await tableExists(_0x49f143(0x1a6)+_0x49f143(0x1c8));if(!_0x9fd488){await _0xddf457[_0x49f143(0x298)](_0x49f143(0x180)+_0x49f143(0x2a3)+_0x49f143(0x2ac)+'STS\x20group_'+_0x49f143(0x1e0)+_0x49f143(0x19a)+_0x49f143(0x26e)+_0x49f143(0x1eb)+_0x49f143(0x204)+_0x49f143(0x290)+_0x49f143(0x239)+'LL\x0a\x20\x20\x20\x20\x20\x20)'+_0x49f143(0x16a)),info(_0x49f143(0x285)+_0x49f143(0x201)+'\x20table\x20gro'+_0x49f143(0x23c)+'s');return;}!await columnExists('group_defa'+'ults',_0x49f143(0x27d))&&await addGroupDefaultsColumns();}function _0x5f04(_0x43c756,_0x3a936b){const _0x298d4c=_0x1f05();return _0x5f04=function(_0x448750,_0x5d3c77){_0x448750=_0x448750-(-0xdb5+-0x1*0x242e+0x3337);let _0x2ad940=_0x298d4c[_0x448750];return _0x2ad940;},_0x5f04(_0x43c756,_0x3a936b);}async function addGroupDefaultsColumns(){const _0x4dac8b=_0xcfdb91,_0x3b39a1=await getDb();try{await _0x3b39a1[_0x4dac8b(0x298)](_0x4dac8b(0x1f9)+'E\x20group_de'+_0x4dac8b(0x171)+'\x20COLUMN\x20gr'+_0x4dac8b(0x193)+_0x4dac8b(0x25b)+_0x4dac8b(0x1ae)+'\x27;'),await _0x3b39a1[_0x4dac8b(0x298)]('ALTER\x20TABL'+_0x4dac8b(0x2c3)+'faults\x20ADD'+_0x4dac8b(0x2be)+_0x4dac8b(0x25d)+'T\x20NULL\x20DEF'+_0x4dac8b(0x236));}catch(_0x13caf0){warn(_0x4dac8b(0x285)+_0x4dac8b(0x240)+_0x4dac8b(0x196)+_0x4dac8b(0x214)+_0x4dac8b(0x20c)+(_0x13caf0?.[_0x4dac8b(0x15a)]||_0x13caf0));}}async function ensureActiveGroupsTable(){const _0x3196b6=_0xcfdb91,_0x46e4ab=await getDb(),_0x3eaab6=await tableExists(ACTIVE_TABLE);!_0x3eaab6&&(await _0x46e4ab[_0x3196b6(0x298)](_0x3196b6(0x180)+'ATE\x20TABLE\x20'+_0x3196b6(0x2ac)+_0x3196b6(0x29f)+ACTIVE_TABLE+('\x20(\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x3196b6(0x2ba)+'TEXT\x20PRIMA'+_0x3196b6(0x2aa)+'\x20\x20\x20\x20\x20\x20grou'+'p_id\x20TEXT\x20'+_0x3196b6(0x188)+'\x20\x20\x20\x20\x20);\x0a\x20\x20'+'\x20\x20')),info(_0x3196b6(0x285)+_0x3196b6(0x201)+_0x3196b6(0x1db)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x1fdc33=_0xcfdb91;try{const _0x4740fc=await getDb(),_0x3b939a=await _0x4740fc[_0x1fdc33(0x2b8)](_0x1fdc33(0x24a)+'e,\x20group_i'+_0x1fdc33(0x1b8)+_0x1fdc33(0x291)+'ections');if(!_0x3b939a||_0x3b939a[_0x1fdc33(0x225)]===0x2551*0x1+0x1*-0x3f7+-0x215a)return;const _0x5a0496=[];for(const _0x40342a of _0x3b939a){const _0x3a8cb4=_0x40342a[_0x1fdc33(0x237)],_0x5d9538=safeParseJSON(_0x3a8cb4);if(Array['isArray'](_0x5d9538)){const _0x24b2c3=_0x5d9538['map'](String),_0x11ffe2=toJSONString(_0x24b2c3);if(_0x11ffe2!==_0x3a8cb4)_0x5a0496[_0x1fdc33(0x27f)]({'name':_0x40342a[_0x1fdc33(0x254)],'group_id':_0x40342a[_0x1fdc33(0x27d)]||'','chat_id':_0x11ffe2});continue;}else{let _0x4883b8=[];_0x3a8cb4===null||_0x3a8cb4===undefined||String(_0x3a8cb4)[_0x1fdc33(0x16c)]()===''?_0x4883b8=[]:_0x4883b8=[String(_0x3a8cb4)];const _0x4cbadc=toJSONString(_0x4883b8);_0x5a0496[_0x1fdc33(0x27f)]({'name':_0x40342a[_0x1fdc33(0x254)],'group_id':_0x40342a['group_id']||'','chat_id':_0x4cbadc});}}if(_0x5a0496['length']>0xe3e*-0x1+-0x1*0x162e+-0x3*-0xc24){try{await _0x4740fc[_0x1fdc33(0x298)]('BEGIN\x20TRAN'+'SACTION;');}catch(_0x1ec719){}for(const _0x1ed498 of _0x5a0496){try{await _0x4740fc[_0x1fdc33(0x165)]('UPDATE\x20con'+_0x1fdc33(0x19f)+_0x1fdc33(0x2c1)+'\x20=\x20?\x20WHERE'+'\x20name\x20=\x20?\x20'+_0x1fdc33(0x235)+_0x1fdc33(0x176),[_0x1ed498[_0x1fdc33(0x237)],_0x1ed498[_0x1fdc33(0x254)],_0x1ed498[_0x1fdc33(0x27d)]]),info(_0x1fdc33(0x285)+_0x1fdc33(0x1c0)+_0x1fdc33(0x2ab)+_0x1fdc33(0x202)+_0x1fdc33(0x28e)+_0x1ed498[_0x1fdc33(0x254)]+(_0x1fdc33(0x295)+'\x22')+_0x1ed498['group_id']+'\x22');}catch(_0x713ea2){warn(_0x1fdc33(0x285)+_0x1fdc33(0x1c0)+_0x1fdc33(0x22c)+_0x1fdc33(0x2dd)+'\x20chat_id\x20f'+_0x1fdc33(0x220)+_0x1ed498[_0x1fdc33(0x254)]+'@'+_0x1ed498['group_id']+':\x20'+(_0x713ea2?.[_0x1fdc33(0x15a)]||_0x713ea2));}}try{await _0x4740fc[_0x1fdc33(0x298)](_0x1fdc33(0x1ef));}catch(_0x37a991){}}}catch(_0x93135c){warn(_0x1fdc33(0x285)+_0x1fdc33(0x1c0)+'on]\x20migrat'+_0x1fdc33(0x17f)+_0x1fdc33(0x1a4)+'Array\x20fail'+_0x1fdc33(0x184)+(_0x93135c?.['message']||_0x93135c));}}async function migrateGroupDefaultsNameToArray(){const _0x3118b8=_0xcfdb91;try{const _0x3c9297=await getDb(),_0x38b874=await _0x3c9297['all']('SELECT\x20gro'+'up_id,\x20nam'+_0x3118b8(0x185)+'up_default'+'s');if(!_0x38b874||_0x38b874['length']===-0x16b1+0x1*0x243d+-0x6*0x242)return;const _0x37fa6e=[];for(const _0x4fd22a of _0x38b874){const _0x39f3cd=_0x4fd22a[_0x3118b8(0x254)],_0x3d559b=safeParseJSON(_0x39f3cd);if(Array[_0x3118b8(0x2c5)](_0x3d559b)){const _0x34fde8=toJSONString(_0x3d559b);if(_0x34fde8!==_0x39f3cd)_0x37fa6e[_0x3118b8(0x27f)]({'group_id':_0x4fd22a[_0x3118b8(0x27d)],'name':_0x34fde8});continue;}else{const _0x4d1021=_0x39f3cd===null||_0x39f3cd===undefined||String(_0x39f3cd)[_0x3118b8(0x16c)]()===''?[]:[String(_0x39f3cd)],_0x5c23d5=toJSONString(_0x4d1021);_0x37fa6e['push']({'group_id':_0x4fd22a[_0x3118b8(0x27d)],'name':_0x5c23d5});}}if(_0x37fa6e[_0x3118b8(0x225)]>-0x11*-0x1c1+0x1*-0x1c06+-0x1cb){try{await _0x3c9297[_0x3118b8(0x298)](_0x3118b8(0x194)+_0x3118b8(0x274));}catch(_0x19a06){}for(const _0x1ab66c of _0x37fa6e){try{await _0x3c9297[_0x3118b8(0x165)](_0x3118b8(0x231)+_0x3118b8(0x23c)+_0x3118b8(0x20a)+_0x3118b8(0x2cc)+'\x20group_id\x20'+_0x3118b8(0x156),[_0x1ab66c['name'],_0x1ab66c[_0x3118b8(0x27d)]]),info(_0x3118b8(0x285)+'n][migrati'+_0x3118b8(0x2ab)+'ized\x20group'+_0x3118b8(0x1bc)+_0x3118b8(0x29e)+_0x1ab66c[_0x3118b8(0x27d)]);}catch(_0x5d4228){warn(_0x3118b8(0x285)+_0x3118b8(0x1c0)+_0x3118b8(0x22c)+_0x3118b8(0x2dd)+_0x3118b8(0x23b)+_0x3118b8(0x21c)+_0x1ab66c[_0x3118b8(0x27d)]+':\x20'+(_0x5d4228?.[_0x3118b8(0x15a)]||_0x5d4228));}}try{await _0x3c9297[_0x3118b8(0x298)]('COMMIT;');}catch(_0x7f3fcb){}}}catch(_0x4b620b){warn(_0x3118b8(0x285)+'n][migrati'+'on]\x20migrat'+_0x3118b8(0x20e)+_0x3118b8(0x257)+_0x3118b8(0x27e)+'ed:\x20'+(_0x4b620b?.[_0x3118b8(0x15a)]||_0x4b620b));}}function parseArrayStrict(_0x474f74){const _0x4235c5=_0xcfdb91;if(_0x474f74===null||_0x474f74===undefined)return[];if(typeof _0x474f74===_0x4235c5(0x1ba)){const _0x164dc4=safeParseJSON(_0x474f74);if(Array[_0x4235c5(0x2c5)](_0x164dc4))return _0x164dc4[_0x4235c5(0x179)](String);return[];}if(Array['isArray'](_0x474f74))return _0x474f74['map'](String);return[String(_0x474f74)];}function stringifyArray(_0x94ec3e){const _0xb18561=_0xcfdb91;return JSON[_0xb18561(0x210)](Array[_0xb18561(0x2c5)](_0x94ec3e)?_0x94ec3e[_0xb18561(0x179)](String):[]);}async function loadConnectionsCache(){const _0x24f0eb=_0xcfdb91;try{const _0x2de5d0=await getDb(),_0x347482=await _0x2de5d0['all']('SELECT\x20nam'+_0x24f0eb(0x2c8)+_0x24f0eb(0x1b8)+_0x24f0eb(0x1fa)+_0x24f0eb(0x1f7)+_0x24f0eb(0x261));connectionsCache[_0x24f0eb(0x232)]();if(!_0x347482||!_0x347482[_0x24f0eb(0x225)]){info(_0x24f0eb(0x285)+'n]\x20connect'+_0x24f0eb(0x270)+_0x24f0eb(0x1c9)+_0x24f0eb(0x18e));return;}for(const _0x427541 of _0x347482){const _0x41aac3=String(_0x427541[_0x24f0eb(0x27d)]||'');if(!connectionsCache[_0x24f0eb(0x211)](_0x41aac3))connectionsCache['set'](_0x41aac3,new Map());const _0x6dc676=connectionsCache[_0x24f0eb(0x229)](_0x41aac3);_0x6dc676[_0x24f0eb(0x1ce)](String(_0x427541[_0x24f0eb(0x254)]),{'name':_0x427541['name'],'chat_id':parseArrayStrict(_0x427541[_0x24f0eb(0x237)]),'creator_id':_0x427541[_0x24f0eb(0x293)]});}info(_0x24f0eb(0x285)+_0x24f0eb(0x1d4)+_0x24f0eb(0x270)+_0x24f0eb(0x1d6)+_0x347482['length']+_0x24f0eb(0x18e));}catch(_0x2683f4){warn(_0x24f0eb(0x285)+_0x24f0eb(0x21e)+_0x24f0eb(0x1c1)+_0x24f0eb(0x284)+':\x20'+(_0x2683f4?.['message']||_0x2683f4));}}async function loadGroupDefaultsCache(){const _0x5a39d7=_0xcfdb91;try{const _0x31a4da=await getDb(),_0x36372a=await _0x31a4da[_0x5a39d7(0x2b8)](_0x5a39d7(0x1d2)+_0x5a39d7(0x1a8)+_0x5a39d7(0x185)+_0x5a39d7(0x23c)+'s');groupDefaultsCache[_0x5a39d7(0x232)]();if(!_0x36372a||!_0x36372a['length']){info(_0x5a39d7(0x285)+_0x5a39d7(0x160)+_0x5a39d7(0x20b)+_0x5a39d7(0x170)+'\x20(0\x20rows)');return;}for(const _0x1a90a1 of _0x36372a){try{const _0x4bbeac=String(_0x1a90a1['group_id']),_0x24eac6=safeParseJSON(_0x1a90a1[_0x5a39d7(0x254)]),_0x11f890=Array[_0x5a39d7(0x2c5)](_0x24eac6)?_0x24eac6[_0x5a39d7(0x179)](String):[];groupDefaultsCache['set'](_0x4bbeac,_0x11f890);}catch(_0x1185fc){}}info(_0x5a39d7(0x285)+'n]\x20group\x20d'+'efaults\x20ca'+'che\x20loaded'+'\x20('+_0x36372a['length']+_0x5a39d7(0x18e));}catch(_0x32370e){warn(_0x5a39d7(0x285)+_0x5a39d7(0x2db)+_0x5a39d7(0x177)+_0x5a39d7(0x1ee)+_0x5a39d7(0x184)+(_0x32370e?.['message']||_0x32370e));}}async function loadActiveGroupsCache(){const _0x3bdafa=_0xcfdb91;try{const _0x1ab238=await getDb(),_0x1af431=await _0x1ab238[_0x3bdafa(0x2b8)]('SELECT\x20use'+_0x3bdafa(0x1f0)+_0x3bdafa(0x216)+'\x20'+ACTIVE_TABLE);activeGroupByUser[_0x3bdafa(0x232)]();if(!_0x1af431||!_0x1af431['length']){info('[connectio'+'n]\x20active\x20'+_0x3bdafa(0x15e)+_0x3bdafa(0x1a3)+'(0\x20rows)');return;}for(const _0x83e060 of _0x1af431){try{activeGroupByUser[_0x3bdafa(0x1ce)](String(_0x83e060[_0x3bdafa(0x2bf)]),String(_0x83e060[_0x3bdafa(0x27d)]));}catch(_0x683b99){}}info(_0x3bdafa(0x285)+_0x3bdafa(0x17d)+_0x3bdafa(0x15e)+'he\x20loaded\x20'+'('+_0x1af431[_0x3bdafa(0x225)]+_0x3bdafa(0x18e));}catch(_0x1152a9){warn(_0x3bdafa(0x285)+_0x3bdafa(0x24d)+'iveGroupsC'+'ache\x20faile'+'d:\x20'+(_0x1152a9?.[_0x3bdafa(0x15a)]||_0x1152a9));}}export async function refreshCaches(){const _0x282772=_0xcfdb91;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x282772(0x285)+_0x282772(0x2c6)+'Caches\x20com'+_0x282772(0x163));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x3d8a14){const _0x4d66cb=_0xcfdb91;if(!_0x3d8a14)return null;const _0x143b41=String(_0x3d8a14)[_0x4d66cb(0x16c)]();if(!_0x143b41)return null;return _0x143b41[_0x4d66cb(0x266)]('@')?_0x143b41[_0x4d66cb(0x294)]('@')[0x323*-0x1+-0x2266+0xc83*0x3]:_0x143b41;}export async function ensureSchema(){const _0x2719b1=_0xcfdb91;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info(_0x2719b1(0x285)+_0x2719b1(0x242)+_0x2719b1(0x1b0)+_0x2719b1(0x2a5)+_0x2719b1(0x20d)+_0x2719b1(0x18b)+_0x2719b1(0x28d)+_0x2719b1(0x272)+_0x2719b1(0x277)+_0x2719b1(0x1d0));}catch(_0x2bd308){error(_0x2bd308,_0x2719b1(0x285)+_0x2719b1(0x26b)+'chema\x20fail'+'ed:\x20'+(_0x2bd308?.[_0x2719b1(0x15a)]||_0x2bd308));throw _0x2bd308;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x472b5e,_0x1e6f61){const _0x5a85ab=_0xcfdb91;try{if(!_0x472b5e)return;const _0x1cd28a=normalizeUserKeyForStorage(_0x472b5e);if(!_0x1cd28a)return;if(!_0x1e6f61){activeGroupByUser[_0x5a85ab(0x1e2)](_0x1cd28a);try{const _0xa336af=await getDb();await _0xa336af[_0x5a85ab(0x165)](_0x5a85ab(0x280)+'M\x20'+ACTIVE_TABLE+(_0x5a85ab(0x1e5)+_0x5a85ab(0x206)),[_0x1cd28a]);}catch(_0x1e0efc){warn(_0x5a85ab(0x285)+_0x5a85ab(0x157)+_0x5a85ab(0x1dc)+_0x5a85ab(0x15c)+_0x5a85ab(0x205)+'on:\x20'+(_0x1e0efc?.[_0x5a85ab(0x15a)]||_0x1e0efc));}return;}const _0x2bba0e=String(_0x1e6f61);activeGroupByUser[_0x5a85ab(0x1ce)](_0x1cd28a,_0x2bba0e);try{const _0x3ff4b8=await getDb();await _0x3ff4b8[_0x5a85ab(0x165)]('INSERT\x20INT'+'O\x20'+ACTIVE_TABLE+(_0x5a85ab(0x15d)+_0x5a85ab(0x1b1)+_0x5a85ab(0x264)+'?,\x20?)\x20\x0a\x20\x20\x20'+_0x5a85ab(0x17a)+_0x5a85ab(0x230)+_0x5a85ab(0x2b3)+_0x5a85ab(0x183)+'DO\x20UPDATE\x20'+'SET\x20group_'+_0x5a85ab(0x192)+_0x5a85ab(0x2a8)+'id'),[_0x1cd28a,_0x2bba0e]);}catch(_0x168fba){warn('[connectio'+_0x5a85ab(0x157)+_0x5a85ab(0x1dc)+_0x5a85ab(0x15c)+'oup:\x20'+(_0x168fba?.[_0x5a85ab(0x15a)]||_0x168fba));}}catch(_0x27ea6a){warn(_0x5a85ab(0x285)+_0x5a85ab(0x2b7)+_0x5a85ab(0x1d3)+'User\x20error'+':\x20'+(_0x27ea6a?.['message']||_0x27ea6a));}}export function getActiveGroupForUser(_0x278f51){const _0x101579=_0xcfdb91;try{if(!_0x278f51)return null;const _0x9635a=normalizeUserKeyForStorage(_0x278f51);if(!_0x9635a)return null;return activeGroupByUser[_0x101579(0x229)](_0x9635a)||null;}catch(_0x1a7280){return warn(_0x101579(0x285)+_0x101579(0x1f5)+_0x101579(0x1d3)+_0x101579(0x226)+':\x20'+(_0x1a7280?.[_0x101579(0x15a)]||_0x1a7280)),null;}}export async function addConnection(_0x42b6ad,_0x58bc65,_0x536a0d='',_0x5a8bd9=''){const _0x18d894=_0xcfdb91;try{await ensureSchema();const _0x5825fc=await getDb(),_0x3eed92=String(_0x5a8bd9||''),_0x1b6eb6=await _0x5825fc['get'](_0x18d894(0x197)+_0x18d894(0x262)+_0x18d894(0x2d4)+'s\x20WHERE\x20na'+'me\x20=\x20?\x20AND'+'\x20group_id\x20'+_0x18d894(0x156),[String(_0x42b6ad),_0x3eed92]);if(!_0x1b6eb6){const _0x5160c7=[String(_0x58bc65)];await _0x5825fc[_0x18d894(0x165)](_0x18d894(0x25a)+_0x18d894(0x1a7)+_0x18d894(0x16f)+_0x18d894(0x243)+_0x18d894(0x227)+_0x18d894(0x293)+_0x18d894(0x264)+_0x18d894(0x25c)+')',[String(_0x42b6ad),_0x3eed92,stringifyArray(_0x5160c7),String(_0x536a0d||'')]),info(_0x18d894(0x285)+_0x18d894(0x201)+':\x20'+_0x42b6ad+_0x18d894(0x287)+_0x58bc65+_0x18d894(0x2a4)+_0x536a0d+_0x18d894(0x2a6)+_0x3eed92);if(!connectionsCache[_0x18d894(0x211)](_0x3eed92))connectionsCache[_0x18d894(0x1ce)](_0x3eed92,new Map());const _0x91993e=connectionsCache[_0x18d894(0x229)](_0x3eed92);return _0x91993e[_0x18d894(0x1ce)](String(_0x42b6ad),{'name':String(_0x42b6ad),'chat_id':_0x5160c7[_0x18d894(0x179)](String),'creator_id':String(_0x536a0d||'')}),!![];}else{const _0x404856=parseArrayStrict(_0x1b6eb6[_0x18d894(0x237)]);if(!_0x404856[_0x18d894(0x266)](String(_0x58bc65)))_0x404856[_0x18d894(0x27f)](String(_0x58bc65));await _0x5825fc[_0x18d894(0x165)](_0x18d894(0x2ad)+_0x18d894(0x19f)+'ET\x20chat_id'+_0x18d894(0x259)+_0x18d894(0x16e)+_0x18d894(0x1fe)+_0x18d894(0x249)+_0x18d894(0x26a)+'\x20?',[stringifyArray(_0x404856),String(_0x536a0d||''),String(_0x42b6ad),_0x3eed92]),info('[connectio'+_0x18d894(0x2b4)+':\x20'+_0x42b6ad+_0x18d894(0x287)+_0x404856[_0x18d894(0x1b7)](',')+_0x18d894(0x2c0)+_0x3eed92);if(!connectionsCache[_0x18d894(0x211)](_0x3eed92))connectionsCache['set'](_0x3eed92,new Map());const _0x48d3bc=connectionsCache['get'](_0x3eed92);return _0x48d3bc['set'](String(_0x42b6ad),{'name':String(_0x42b6ad),'chat_id':_0x404856['map'](String),'creator_id':String(_0x536a0d||'')}),!![];}}catch(_0x4a633c){return error(_0x4a633c,'[connectio'+'n]\x20addConn'+_0x18d894(0x161)+_0x18d894(0x2ce)+_0x42b6ad+_0x18d894(0x159)+_0x5a8bd9),![];}}export async function deleteConnectionScoped(_0xc00b56,_0x1d9027=''){const _0xacf1a8=_0xcfdb91;try{await ensureSchema();const _0x306ec5=await getDb(),_0x56327f=await _0x306ec5['run']('DELETE\x20FRO'+_0xacf1a8(0x24b)+'ons\x20WHERE\x20'+_0xacf1a8(0x2b6)+_0xacf1a8(0x26c)+_0xacf1a8(0x1aa),[String(_0xc00b56),String(_0x1d9027||'')]),_0x455b93=_0x56327f&&(_0x56327f[_0xacf1a8(0x191)]===undefined?!![]:!!_0x56327f[_0xacf1a8(0x191)]);info(_0xacf1a8(0x285)+_0xacf1a8(0x1cc)+_0xacf1a8(0x215)+'coped:\x20'+_0xc00b56+_0xacf1a8(0x159)+_0x1d9027+'\x20(deleted='+_0x455b93+')');try{const _0x1c3364=String(_0x1d9027||'');if(connectionsCache['has'](_0x1c3364)){const _0x2b0850=connectionsCache['get'](_0x1c3364);if(_0x2b0850)_0x2b0850['delete'](String(_0xc00b56));}}catch(_0xda9111){}return _0x455b93;}catch(_0x31f9ec){return error(_0x31f9ec,_0xacf1a8(0x285)+_0xacf1a8(0x1cc)+_0xacf1a8(0x215)+_0xacf1a8(0x265)+'ed:\x20'+_0xc00b56+_0xacf1a8(0x159)+_0x1d9027),![];}}export async function deleteConnectionsByCreatorInGroup(_0x26898d,_0x3adfdf=''){const _0x4c3cf3=_0xcfdb91;try{await ensureSchema();const _0xe3076a=await getDb(),_0x15c197=await _0xe3076a[_0x4c3cf3(0x165)]('DELETE\x20FRO'+_0x4c3cf3(0x24b)+'ons\x20WHERE\x20'+_0x4c3cf3(0x293)+'\x20=\x20?\x20AND\x20g'+'roup_id\x20=\x20'+'?',[String(_0x26898d),String(_0x3adfdf||'')]),_0x34e488=_0x15c197&&(_0x15c197['changes']===undefined?!![]:_0x15c197[_0x4c3cf3(0x191)])||-0x2*-0xab7+0xdb*0x1+-0x1*0x1649;info('[connectio'+_0x4c3cf3(0x1cc)+_0x4c3cf3(0x1e8)+_0x4c3cf3(0x212)+'nGroup:\x20'+_0x26898d+_0x4c3cf3(0x159)+_0x3adfdf+_0x4c3cf3(0x23e)+_0x34e488+')');try{const _0x348561=String(_0x3adfdf||'');if(connectionsCache[_0x4c3cf3(0x211)](_0x348561)){const _0x4d0437=connectionsCache[_0x4c3cf3(0x229)](_0x348561);for(const [_0x44a243,_0x35a4f9]of Array['from'](_0x4d0437[_0x4c3cf3(0x2da)]())){if(String(_0x35a4f9[_0x4c3cf3(0x293)])===String(_0x26898d))_0x4d0437['delete'](_0x44a243);}}}catch(_0x10fbb2){}return _0x34e488;}catch(_0x5b8952){return error(_0x5b8952,_0x4c3cf3(0x285)+_0x4c3cf3(0x1cc)+_0x4c3cf3(0x1e8)+_0x4c3cf3(0x212)+'nGroup\x20fai'+_0x4c3cf3(0x20c)+(_0x5b8952?.[_0x4c3cf3(0x15a)]||_0x5b8952)),-0x1*0xf3d+0x1*-0x15ec+0x2529;}}export async function removeChatIdsFromConnectionScoped(_0x24402d,_0x42786f,_0x47f7a6=''){const _0x4f3a3a=_0xcfdb91;try{if(!_0x24402d)return![];await ensureSchema();const _0x1a8393=await getDb(),_0x5e41b5=await _0x1a8393[_0x4f3a3a(0x229)](_0x4f3a3a(0x197)+'t_id\x20FROM\x20'+_0x4f3a3a(0x2d4)+_0x4f3a3a(0x278)+'me\x20=\x20?\x20AND'+_0x4f3a3a(0x19d)+_0x4f3a3a(0x156),[String(_0x24402d),String(_0x47f7a6||'')]);if(!_0x5e41b5)return![];const _0x522800=parseArrayStrict(_0x5e41b5[_0x4f3a3a(0x237)]),_0x4170db=Array[_0x4f3a3a(0x2c5)](_0x42786f)?_0x42786f[_0x4f3a3a(0x179)](String):[String(_0x42786f)],_0x4c157d=_0x522800[_0x4f3a3a(0x250)](_0x3a4c56=>!_0x4170db['includes'](_0x3a4c56));if(_0x4c157d['length']===-0x1*0xb1e+0x4*-0x417+0x1b7a){await _0x1a8393[_0x4f3a3a(0x165)](_0x4f3a3a(0x280)+_0x4f3a3a(0x24b)+_0x4f3a3a(0x2cb)+_0x4f3a3a(0x2b6)+_0x4f3a3a(0x26c)+_0x4f3a3a(0x1aa),[String(_0x24402d),String(_0x47f7a6||'')]),info(_0x4f3a3a(0x285)+_0x4f3a3a(0x2d0)+_0x4f3a3a(0x1cd)+_0x4f3a3a(0x195)+_0x4f3a3a(0x245)+_0x4f3a3a(0x1de)+_0x4f3a3a(0x155)+'r\x20'+_0x24402d+_0x4f3a3a(0x159)+_0x47f7a6+(_0x4f3a3a(0x29b)+_0x4f3a3a(0x246)));try{const _0x343457=String(_0x47f7a6||'');if(connectionsCache[_0x4f3a3a(0x211)](_0x343457))connectionsCache[_0x4f3a3a(0x229)](_0x343457)[_0x4f3a3a(0x1e2)](String(_0x24402d));}catch(_0x19cb8c){}return!![];}else{await _0x1a8393[_0x4f3a3a(0x165)](_0x4f3a3a(0x2ad)+_0x4f3a3a(0x19f)+_0x4f3a3a(0x2c1)+_0x4f3a3a(0x2cc)+_0x4f3a3a(0x263)+_0x4f3a3a(0x235)+_0x4f3a3a(0x176),[stringifyArray(_0x4c157d),String(_0x24402d),String(_0x47f7a6||'')]),info(_0x4f3a3a(0x285)+_0x4f3a3a(0x2d0)+'hatIdsFrom'+'Connection'+_0x4f3a3a(0x1f2)+_0x24402d+'@'+_0x47f7a6+_0x4f3a3a(0x253)+_0x4c157d[_0x4f3a3a(0x1b7)](','));try{const _0x241b9d=String(_0x47f7a6||'');if(!connectionsCache[_0x4f3a3a(0x211)](_0x241b9d))connectionsCache['set'](_0x241b9d,new Map());connectionsCache['get'](_0x241b9d)['set'](String(_0x24402d),{'name':String(_0x24402d),'chat_id':_0x4c157d[_0x4f3a3a(0x179)](String),'creator_id':connectionsCache[_0x4f3a3a(0x229)](_0x241b9d)['get'](String(_0x24402d))?.[_0x4f3a3a(0x293)]||''});}catch(_0x4c202d){}return!![];}}catch(_0x2f6d08){return error(_0x2f6d08,_0x4f3a3a(0x285)+_0x4f3a3a(0x2d0)+_0x4f3a3a(0x1cd)+_0x4f3a3a(0x195)+_0x4f3a3a(0x224)+_0x4f3a3a(0x20c)+(_0x2f6d08?.[_0x4f3a3a(0x15a)]||_0x2f6d08)),![];}}export async function listConnectionsForGroup(_0x70080b){const _0x4d7e48=_0xcfdb91;try{await ensureSchema();const _0x2c86b2=String(_0x70080b||'');if(connectionsCache[_0x4d7e48(0x211)](_0x2c86b2)){const _0x363458=connectionsCache[_0x4d7e48(0x229)](_0x2c86b2);return Array[_0x4d7e48(0x2d5)](_0x363458[_0x4d7e48(0x228)]())[_0x4d7e48(0x179)](_0x264ef5=>({'name':_0x264ef5['name'],'chat_id':Array[_0x4d7e48(0x2c5)](_0x264ef5['chat_id'])?_0x264ef5[_0x4d7e48(0x237)][_0x4d7e48(0x179)](String):[],'creator_id':_0x264ef5[_0x4d7e48(0x293)]}));}const _0x49340d=await getDb(),_0x1b1a7c=await _0x49340d['all'](_0x4d7e48(0x24a)+_0x4d7e48(0x282)+',\x20creator_'+_0x4d7e48(0x1f7)+_0x4d7e48(0x1b6)+_0x4d7e48(0x18a)+'p_id\x20=\x20?\x20O'+_0x4d7e48(0x26f)+'me',[_0x2c86b2]);return(_0x1b1a7c||[])[_0x4d7e48(0x179)](_0x47be9b=>({'name':_0x47be9b[_0x4d7e48(0x254)],'chat_id':parseArrayStrict(_0x47be9b['chat_id']),'creator_id':_0x47be9b[_0x4d7e48(0x293)]}));}catch(_0x35e794){return error(_0x35e794,_0x4d7e48(0x285)+_0x4d7e48(0x15f)+'nectionsFo'+_0x4d7e48(0x2a1)+_0x4d7e48(0x20c)+(_0x35e794?.[_0x4d7e48(0x15a)]||_0x35e794)),[];}}export async function listConnectionsForUser(_0x35f7b4,_0x530572=null){const _0x4516cf=_0xcfdb91;try{await ensureSchema();const _0x38a0d1=await getDb();if(_0x530572){const _0x547bb1=await _0x38a0d1[_0x4516cf(0x2b8)](_0x4516cf(0x24a)+'e,\x20chat_id'+',\x20creator_'+_0x4516cf(0x1f7)+_0x4516cf(0x1b6)+_0x4516cf(0x1d7)+_0x4516cf(0x16e)+'\x20AND\x20group'+'_id\x20=\x20?\x20OR'+_0x4516cf(0x189)+'e',[String(_0x35f7b4),String(_0x530572)]);return(_0x547bb1||[])['map'](_0x4f8518=>({'name':_0x4f8518[_0x4516cf(0x254)],'chat_id':parseArrayStrict(_0x4f8518[_0x4516cf(0x237)]),'creator_id':_0x4f8518[_0x4516cf(0x293)]}));}else{const _0x4d9f16=await _0x38a0d1[_0x4516cf(0x2b8)]('SELECT\x20nam'+_0x4516cf(0x282)+_0x4516cf(0x1fa)+_0x4516cf(0x247)+_0x4516cf(0x1f7)+_0x4516cf(0x1b6)+_0x4516cf(0x1d7)+_0x4516cf(0x16e)+_0x4516cf(0x2ca)+'group_id,\x20'+_0x4516cf(0x254),[String(_0x35f7b4)]);return(_0x4d9f16||[])[_0x4516cf(0x179)](_0x228386=>({'name':_0x228386[_0x4516cf(0x254)],'chat_id':parseArrayStrict(_0x228386[_0x4516cf(0x237)]),'creator_id':_0x228386[_0x4516cf(0x293)],'group_id':_0x228386[_0x4516cf(0x27d)]}));}}catch(_0x13fa28){return error(_0x13fa28,_0x4516cf(0x285)+_0x4516cf(0x15f)+'nectionsFo'+_0x4516cf(0x2dc)+'ed'),[];}}export async function listAllConnections(){const _0x681fe0=_0xcfdb91;try{await ensureSchema();const _0x5454af=await getDb(),_0x4a827e=await _0x5454af[_0x681fe0(0x2b8)](_0x681fe0(0x24a)+_0x681fe0(0x282)+_0x681fe0(0x1fa)+'id,\x20group_'+_0x681fe0(0x1f7)+_0x681fe0(0x1b6)+'ORDER\x20BY\x20g'+_0x681fe0(0x208)+_0x681fe0(0x286));return(_0x4a827e||[])[_0x681fe0(0x179)](_0x1484ff=>({'name':_0x1484ff['name'],'chat_id':parseArrayStrict(_0x1484ff[_0x681fe0(0x237)]),'creator_id':_0x1484ff['creator_id'],'group_id':_0x1484ff[_0x681fe0(0x27d)]}));}catch(_0x545f52){return error(_0x545f52,_0x681fe0(0x285)+_0x681fe0(0x158)+_0x681fe0(0x195)+_0x681fe0(0x1b9)),[];}}export async function getConnectionScoped(_0x1782a5,_0x424f80=''){const _0x4311e9=_0xcfdb91;try{await ensureSchema();const _0x53d124=String(_0x424f80||'');if(connectionsCache[_0x4311e9(0x211)](_0x53d124)&&connectionsCache[_0x4311e9(0x229)](_0x53d124)[_0x4311e9(0x211)](String(_0x1782a5)))return connectionsCache[_0x4311e9(0x229)](_0x53d124)[_0x4311e9(0x229)](String(_0x1782a5))['chat_id'][_0x4311e9(0x252)]();const _0x4c13a4=await getDb(),_0x319b60=await _0x4c13a4['get'](_0x4311e9(0x197)+_0x4311e9(0x262)+_0x4311e9(0x2d4)+_0x4311e9(0x278)+_0x4311e9(0x22a)+'\x20group_id\x20'+_0x4311e9(0x156),[String(_0x1782a5),_0x53d124]);if(!_0x319b60)return null;return parseArrayStrict(_0x319b60[_0x4311e9(0x237)]);}catch(_0x3c7017){return error(_0x3c7017,_0x4311e9(0x285)+_0x4311e9(0x1bd)+_0x4311e9(0x1fc)+_0x4311e9(0x2c4)+_0x1782a5+_0x4311e9(0x159)+_0x424f80+_0x4311e9(0x273)),null;}}export async function getConnectionRecordScoped(_0x311f72,_0x4a3815=''){const _0x31e36f=_0xcfdb91;try{await ensureSchema();const _0x6fa1f0=String(_0x4a3815||'');if(connectionsCache[_0x31e36f(0x211)](_0x6fa1f0)&&connectionsCache[_0x31e36f(0x229)](_0x6fa1f0)[_0x31e36f(0x211)](String(_0x311f72))){const _0x359993=connectionsCache['get'](_0x6fa1f0)['get'](String(_0x311f72));return{'name':_0x359993[_0x31e36f(0x254)],'chat_id':_0x359993[_0x31e36f(0x237)][_0x31e36f(0x252)](),'creator_id':_0x359993[_0x31e36f(0x293)]};}const _0x50be3d=await getDb(),_0x218cf0=await _0x50be3d[_0x31e36f(0x229)](_0x31e36f(0x24a)+_0x31e36f(0x282)+_0x31e36f(0x1fa)+'id\x20FROM\x20co'+_0x31e36f(0x1b6)+'WHERE\x20name'+_0x31e36f(0x292)+'roup_id\x20=\x20'+'?',[String(_0x311f72),_0x6fa1f0]);if(!_0x218cf0)return null;return{'name':_0x218cf0[_0x31e36f(0x254)],'chat_id':parseArrayStrict(_0x218cf0[_0x31e36f(0x237)]),'creator_id':_0x218cf0[_0x31e36f(0x293)]};}catch(_0xbd328c){return error(_0xbd328c,'[connectio'+_0x31e36f(0x1bd)+_0x31e36f(0x1f1)+_0x31e36f(0x29c)+_0x311f72+_0x31e36f(0x159)+_0x4a3815+_0x31e36f(0x273)),null;}}export async function getConnectionName(_0x4fc164){const _0x59fe16=_0xcfdb91;try{await ensureSchema();for(const [_0x170054,_0x3c2d5c]of connectionsCache[_0x59fe16(0x2da)]()){for(const [_0x33222d,_0x43a9c0]of _0x3c2d5c[_0x59fe16(0x2da)]()){if(Array[_0x59fe16(0x2c5)](_0x43a9c0['chat_id'])&&_0x43a9c0[_0x59fe16(0x237)][_0x59fe16(0x266)](String(_0x4fc164)))return _0x33222d;}}const _0x4eeede=await getDb(),_0x62c399=await _0x4eeede[_0x59fe16(0x2b8)]('SELECT\x20nam'+_0x59fe16(0x282)+_0x59fe16(0x291)+_0x59fe16(0x233));for(const _0x36014c of _0x62c399||[]){const _0x2eb6f6=parseArrayStrict(_0x36014c[_0x59fe16(0x237)]);if(_0x2eb6f6[_0x59fe16(0x266)](String(_0x4fc164)))return _0x36014c['name'];}return null;}catch(_0x5784b9){return error(_0x5784b9,_0x59fe16(0x285)+_0x59fe16(0x1bd)+'ectionName'+'('+_0x4fc164+_0x59fe16(0x273)),null;}}export async function setDefaultGroup(_0x4eb8a6,_0x1a3cb2){const _0x9c7268=_0xcfdb91;try{await ensureSchema();const _0x4e6643=await getDb();if(!_0x1a3cb2)throw new Error('groupId\x20re'+_0x9c7268(0x1fd)+_0x9c7268(0x299)+_0x9c7268(0x21b));if(!_0x4eb8a6||Array[_0x9c7268(0x2c5)](_0x4eb8a6)&&_0x4eb8a6[_0x9c7268(0x225)]===0x1a1d+0x1f99+0x2*-0x1cdb)return await _0x4e6643[_0x9c7268(0x165)]('DELETE\x20FRO'+_0x9c7268(0x1d5)+_0x9c7268(0x1c2)+_0x9c7268(0x2a7)+_0x9c7268(0x1aa),[String(_0x1a3cb2)]),groupDefaultsCache[_0x9c7268(0x1e2)](String(_0x1a3cb2)),info(_0x9c7268(0x285)+_0x9c7268(0x160)+_0x9c7268(0x267)+'ared\x20for\x20'+_0x1a3cb2),!![];let _0x5db549=[];if(typeof _0x4eb8a6===_0x9c7268(0x1ba)&&_0x4eb8a6[_0x9c7268(0x258)+'e']()===_0x9c7268(0x2b8)){const _0x2decc1=await listConnectionsForGroup(String(_0x1a3cb2));_0x5db549=(_0x2decc1||[])[_0x9c7268(0x179)](_0x297c37=>_0x297c37[_0x9c7268(0x254)])[_0x9c7268(0x250)](Boolean);if(!_0x5db549[_0x9c7268(0x225)])throw new Error(_0x9c7268(0x27a)+_0x9c7268(0x28c)+_0x9c7268(0x234)+_0x9c7268(0x268));}else{if(Array['isArray'](_0x4eb8a6))_0x5db549=_0x4eb8a6[_0x9c7268(0x179)](String)[_0x9c7268(0x250)](Boolean);else{if(typeof _0x4eb8a6===_0x9c7268(0x1ba)){if(_0x4eb8a6[_0x9c7268(0x266)](','))_0x5db549=_0x4eb8a6['split'](',')[_0x9c7268(0x179)](_0x59d04d=>_0x59d04d['trim']())[_0x9c7268(0x250)](Boolean);else _0x5db549=[_0x4eb8a6];}else throw new Error(_0x9c7268(0x1e6)+_0x9c7268(0x23a)+_0x9c7268(0x296)+_0x9c7268(0x27c)+'aultGroup');}}if(!_0x5db549[_0x9c7268(0x225)])throw new Error(_0x9c7268(0x178)+'onnection\x20'+_0x9c7268(0x219)+_0x9c7268(0x255)+_0x9c7268(0x1f6)+'roup');const _0x1427e5=[];for(const _0x5f412e of _0x5db549){const _0x15e80a=await _0x4e6643[_0x9c7268(0x229)](_0x9c7268(0x186)+_0x9c7268(0x2b2)+_0x9c7268(0x168)+_0x9c7268(0x1e4)+_0x9c7268(0x1be)+'_id\x20=\x20?',[String(_0x5f412e),String(_0x1a3cb2)]);if(_0x15e80a)_0x1427e5[_0x9c7268(0x27f)](_0x5f412e);else warn('[connectio'+'n]\x20setDefa'+_0x9c7268(0x1c5)+_0x9c7268(0x169)+_0x9c7268(0x248)+_0x9c7268(0x2d8)+'on\x20\x22'+_0x5f412e+'\x22\x20in\x20'+_0x1a3cb2);}if(!_0x1427e5['length'])throw new Error(_0x9c7268(0x1ed)+_0x9c7268(0x2ae)+_0x9c7268(0x1bb)+_0x9c7268(0x187)+_0x9c7268(0x1ab)+_0x9c7268(0x1b4));return await _0x4e6643[_0x9c7268(0x165)](_0x9c7268(0x25a)+_0x9c7268(0x281)+_0x9c7268(0x24c)+_0x9c7268(0x271)+_0x9c7268(0x269)+_0x9c7268(0x1bf)+_0x9c7268(0x2d1)+_0x9c7268(0x223)+_0x9c7268(0x213)+_0x9c7268(0x1b3)+_0x9c7268(0x1df)+_0x9c7268(0x241)+'e;',[String(_0x1a3cb2),JSON['stringify'](_0x1427e5)]),groupDefaultsCache['set'](String(_0x1a3cb2),_0x1427e5[_0x9c7268(0x252)]()),info(_0x9c7268(0x285)+_0x9c7268(0x160)+'efault\x20set'+_0x9c7268(0x1c3)+_0x1a3cb2+_0x9c7268(0x287)+JSON[_0x9c7268(0x210)](_0x1427e5)),!![];}catch(_0x2e433e){return error(_0x2e433e,_0x9c7268(0x285)+_0x9c7268(0x22e)+_0x9c7268(0x1ca)+_0x9c7268(0x27b)+_0x1a3cb2+':\x20'+(_0x2e433e?.[_0x9c7268(0x15a)]||_0x2e433e)),![];}}export async function getDefaultForGroup(_0x7076a){const _0x15a779=_0xcfdb91;try{await ensureSchema();if(!_0x7076a)return null;const _0x3ae577=String(_0x7076a);if(groupDefaultsCache[_0x15a779(0x211)](_0x3ae577)){const _0x285364=groupDefaultsCache['get'](_0x3ae577);return Array[_0x15a779(0x2c5)](_0x285364)?_0x285364[_0x15a779(0x179)](String):null;}const _0x195067=await getDb(),_0x2ff565=await _0x195067[_0x15a779(0x229)](_0x15a779(0x24a)+'e\x20FROM\x20gro'+_0x15a779(0x23c)+_0x15a779(0x21f)+_0x15a779(0x1a1),[_0x3ae577]);if(!_0x2ff565||!_0x2ff565[_0x15a779(0x254)])return null;try{const _0x11aed0=JSON[_0x15a779(0x1cb)](_0x2ff565[_0x15a779(0x254)]);if(Array[_0x15a779(0x2c5)](_0x11aed0))return groupDefaultsCache[_0x15a779(0x1ce)](_0x3ae577,_0x11aed0['map'](String)),_0x11aed0[_0x15a779(0x179)](String);}catch(_0x5a2e4c){}return null;}catch(_0xbe03ca){return error(_0xbe03ca,_0x15a779(0x285)+_0x15a779(0x198)+'ultForGrou'+_0x15a779(0x1a9)+_0x15a779(0x220)+_0x7076a),null;}}export async function getDefault(_0x5a78e8){const _0x1547bd=_0xcfdb91;try{await ensureSchema();const _0x385a00=getActiveGroupForUser(String(_0x5a78e8));if(!_0x385a00)return null;return await getDefaultForGroup(_0x385a00);}catch(_0x2256db){return error(_0x2256db,_0x1547bd(0x285)+_0x1547bd(0x198)+_0x1547bd(0x28f)+_0x1547bd(0x1c3)+_0x5a78e8),null;}}export async function getConnection(_0x319c12){const _0x112b7d=_0xcfdb91;try{await ensureSchema();const _0x3af9c2=await getDb(),_0x18f2ba=await _0x3af9c2[_0x112b7d(0x2b8)](_0x112b7d(0x197)+_0x112b7d(0x262)+_0x112b7d(0x2d4)+_0x112b7d(0x278)+_0x112b7d(0x23f),[String(_0x319c12)]);if(!_0x18f2ba||!_0x18f2ba[_0x112b7d(0x225)])return null;const _0x5dee9f=[];for(const _0x34c01b of _0x18f2ba){const _0x32bdf3=parseArrayStrict(_0x34c01b['chat_id']);for(const _0x4e2390 of _0x32bdf3)if(!_0x5dee9f[_0x112b7d(0x266)](_0x4e2390))_0x5dee9f[_0x112b7d(0x27f)](_0x4e2390);}return _0x5dee9f;}catch(_0x5a0f45){return error(_0x5a0f45,_0x112b7d(0x285)+_0x112b7d(0x1bd)+'ection('+_0x319c12+')\x20failed'),null;}}export async function getConnectionRecord(_0x32a136){const _0x21eb64=_0xcfdb91;try{await ensureSchema();const _0x1bb5a0=await getDb(),_0x51503c=await _0x1bb5a0[_0x21eb64(0x229)](_0x21eb64(0x24a)+'e,\x20chat_id'+_0x21eb64(0x1fa)+_0x21eb64(0x247)+_0x21eb64(0x1f7)+_0x21eb64(0x1b6)+_0x21eb64(0x203)+_0x21eb64(0x2b5)+'\x201',[String(_0x32a136)]);if(!_0x51503c)return null;return{'name':_0x51503c['name'],'chat_id':parseArrayStrict(_0x51503c['chat_id']),'creator_id':_0x51503c[_0x21eb64(0x293)],'group_id':_0x51503c[_0x21eb64(0x27d)]};}catch(_0x32c142){return error(_0x32c142,'[connectio'+_0x21eb64(0x1bd)+_0x21eb64(0x1f1)+_0x21eb64(0x24f)+_0x32a136+_0x21eb64(0x273)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};