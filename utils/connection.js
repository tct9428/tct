const _0xc507e3=_0x56b5;(function(_0x440981,_0x4ae493){const _0xe3cd91=_0x56b5,_0x4ea709=_0x440981();while(!![]){try{const _0x526f82=-parseInt(_0xe3cd91(0x1a3))/(0x17e4+0x15ad+-0x30*0xf3)*(parseInt(_0xe3cd91(0x1ce))/(0x624*-0x6+-0x47*-0x61+0x9f3))+parseInt(_0xe3cd91(0x145))/(0x5*0x7cd+0x1f75+0x4673*-0x1)+parseInt(_0xe3cd91(0x21b))/(-0x1*0x97c+0x180c+0xe*-0x10a)*(parseInt(_0xe3cd91(0x25e))/(-0x13f6+-0x99*-0x2f+-0x81c))+parseInt(_0xe3cd91(0x27e))/(0x1*0x32b+0x51*-0x27+-0xb*-0xd6)*(-parseInt(_0xe3cd91(0x127))/(-0x12d+-0x1691+-0x1*-0x17c5))+-parseInt(_0xe3cd91(0x256))/(0x1*0x26b3+-0x61*0x3b+-0x1050)+parseInt(_0xe3cd91(0x131))/(0xb77*0x1+0xa1e+-0x158c)+parseInt(_0xe3cd91(0x13e))/(-0x1ac5+0xd38+0xd97)*(parseInt(_0xe3cd91(0x1ef))/(0x80f+-0x3*-0x780+0x174*-0x15));if(_0x526f82===_0x4ae493)break;else _0x4ea709['push'](_0x4ea709['shift']());}catch(_0x1a5c25){_0x4ea709['push'](_0x4ea709['shift']());}}}(_0x3e6a,-0x3658d+0x1*-0x172787+0x271799*0x1));import{info as _0x8baaf4,warn as _0x25e881,error as _0x58015b}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE='user_activ'+_0xc507e3(0x18c);function info(..._0xd488ea){const _0x5e74b7=_0xc507e3;try{_0x8baaf4(..._0xd488ea);}catch(_0x3ed0ce){console[_0x5e74b7(0x268)](_0x5e74b7(0x17a),..._0xd488ea);}}function warn(..._0x2114ae){const _0x219a5b=_0xc507e3;try{_0x25e881(..._0x2114ae);}catch(_0x4911d3){console[_0x219a5b(0x27d)](_0x219a5b(0x1a6),..._0x2114ae);}}function error(..._0x216301){const _0x460d35=_0xc507e3;try{_0x58015b(..._0x216301);}catch(_0x5be1d4){console[_0x460d35(0x262)](_0x460d35(0x285),..._0x216301);}}async function getDb(){const _0x11ed45=_0xc507e3;if(db&&typeof db[_0x11ed45(0x146)]===_0x11ed45(0x184))return db;try{const _0x1deee1=await import('./database.js');if(_0x1deee1&&_0x1deee1['db'])return db=_0x1deee1['db'],db;throw new Error(_0x11ed45(0x190)+_0x11ed45(0x17b)+_0x11ed45(0x1cd)+'\x20{\x20db\x20}');}catch(_0xa0dc7e){error(_0xa0dc7e,_0x11ed45(0x1e5)+'n]\x20failed\x20'+'to\x20import\x20'+'database.j'+'s');throw _0xa0dc7e;}}function _0x56b5(_0x29b353,_0x17401a){const _0x38c1d7=_0x3e6a();return _0x56b5=function(_0x3045ce,_0x3e6b8d){_0x3045ce=_0x3045ce-(0x5f9*-0x2+-0x1587+0xa7*0x35);let _0x2e46a5=_0x38c1d7[_0x3045ce];return _0x2e46a5;},_0x56b5(_0x29b353,_0x17401a);}function safeParseJSON(_0x51b677){try{return JSON['parse'](_0x51b677);}catch(_0x22917b){return null;}}function asArrayStrict(_0x1d9a3f){const _0x4fc9c2=_0xc507e3;if(_0x1d9a3f===null||_0x1d9a3f===undefined)return[];if(typeof _0x1d9a3f===_0x4fc9c2(0x1b9)){const _0x51b2ac=safeParseJSON(_0x1d9a3f);if(Array['isArray'](_0x51b2ac))return _0x51b2ac[_0x4fc9c2(0x19e)](String);return[_0x1d9a3f];}if(Array[_0x4fc9c2(0x26f)](_0x1d9a3f))return _0x1d9a3f['map'](String);return[String(_0x1d9a3f)];}function toJSONString(_0x2165a0){const _0x25670d=_0xc507e3;return JSON['stringify'](Array[_0x25670d(0x26f)](_0x2165a0)?_0x2165a0[_0x25670d(0x19e)](String):[]);}async function tableExists(_0x270814){const _0x5ea425=_0xc507e3,_0xb1904b=await getDb(),_0x1afc89=await _0xb1904b[_0x5ea425(0x250)](_0x5ea425(0x178)+_0x5ea425(0x11a)+_0x5ea425(0x140)+_0x5ea425(0x228)+_0x5ea425(0x1c8)+'AND\x20name\x20='+'\x20?',[String(_0x270814)]);return!!_0x1afc89;}async function columnExists(_0x5ae7ae,_0x1aabfb){const _0x133958=_0xc507e3;try{const _0x33f51a=await getDb(),_0x28358b=await _0x33f51a[_0x133958(0x1ae)](_0x133958(0x1c0)+_0x133958(0x215)+_0x5ae7ae+')');if(!Array[_0x133958(0x26f)](_0x28358b))return![];return _0x28358b[_0x133958(0x1fd)](_0x2728fb=>String(_0x2728fb['name'])[_0x133958(0x176)+'e']()===String(_0x1aabfb)[_0x133958(0x176)+'e']());}catch(_0x2f811f){return warn(_0x133958(0x1e5)+_0x133958(0x241)+_0x133958(0x20a)+'k\x20failed\x20f'+_0x133958(0x1fc)+_0x5ae7ae+'.'+_0x1aabfb+':\x20'+(_0x2f811f?.[_0x133958(0x28a)]||_0x2f811f)),![];}}async function ensureConnectionsTable(){const _0x48b8b2=_0xc507e3,_0xb4de23=await getDb(),_0x37657f=await tableExists('connection'+'s');if(!_0x37657f){await _0xb4de23[_0x48b8b2(0x146)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x48b8b2(0x120)+_0x48b8b2(0x28c)+_0x48b8b2(0x12e)+'tions\x20(\x0a\x20\x20'+_0x48b8b2(0x192)+'\x20TEXT\x20NOT\x20'+_0x48b8b2(0x16e)+'\x20\x20\x20\x20group_'+_0x48b8b2(0x208)+_0x48b8b2(0x22f)+_0x48b8b2(0x207)+_0x48b8b2(0x212)+_0x48b8b2(0x286)+_0x48b8b2(0x163)+'ator_id\x20TE'+_0x48b8b2(0x24a)+_0x48b8b2(0x1c1)+_0x48b8b2(0x138)+_0x48b8b2(0x227)+_0x48b8b2(0x204)+_0x48b8b2(0x182)+_0x48b8b2(0x15a)),info(_0x48b8b2(0x1e5)+_0x48b8b2(0x185)+'\x20table\x20con'+_0x48b8b2(0x214)+_0x48b8b2(0x150)+_0x48b8b2(0x221));return;}const _0x23b0d4=await columnExists(_0x48b8b2(0x26a)+'s',_0x48b8b2(0x1d8)),_0x6079db=await columnExists('connection'+'s',_0x48b8b2(0x1dd)),_0x4acd5f=await columnExists(_0x48b8b2(0x26a)+'s',_0x48b8b2(0x257));if(!_0x6079db||!_0x4acd5f||!_0x23b0d4)try{await _0xb4de23['exec']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+_0x48b8b2(0x1d4)+_0x48b8b2(0x16d)+'XISTS\x20conn'+_0x48b8b2(0x1b4)+'w\x20(\x0a\x20\x20\x20\x20\x20\x20'+'\x20\x20\x20\x20name\x20T'+_0x48b8b2(0x292)+'LL,\x0a\x20\x20\x20\x20\x20\x20'+_0x48b8b2(0x1af)+'id\x20TEXT\x20NO'+_0x48b8b2(0x274)+'AULT\x20\x27\x27,\x0a\x20'+_0x48b8b2(0x240)+_0x48b8b2(0x1b8)+'T\x20NOT\x20NULL'+_0x48b8b2(0x141)+_0x48b8b2(0x210)+_0x48b8b2(0x22e)+_0x48b8b2(0x20d)+_0x48b8b2(0x1b5)+_0x48b8b2(0x24e)+_0x48b8b2(0x1ba)+_0x48b8b2(0x21d)+_0x48b8b2(0x143)+_0x48b8b2(0x246)+_0x48b8b2(0x142)+_0x48b8b2(0x1b6));try{const _0x17f8e7=await _0xb4de23['all'](_0x48b8b2(0x178)+_0x48b8b2(0x1ab)+',\x20creator_'+_0x48b8b2(0x1d9)+'nnections');if(Array[_0x48b8b2(0x26f)](_0x17f8e7)&&_0x17f8e7[_0x48b8b2(0x1c2)])for(const _0x558d73 of _0x17f8e7){const _0x22f0db=_0x558d73[_0x48b8b2(0x21c)],_0x428e2d=typeof _0x558d73[_0x48b8b2(0x1dd)]===_0x48b8b2(0x258)||_0x558d73[_0x48b8b2(0x1dd)]===null?'[]':_0x558d73[_0x48b8b2(0x1dd)],_0x3c374b=typeof _0x558d73[_0x48b8b2(0x257)]===_0x48b8b2(0x258)||_0x558d73[_0x48b8b2(0x257)]===null?'':_0x558d73['creator_id'];try{await _0xb4de23[_0x48b8b2(0x216)](_0x48b8b2(0x193)+'REPLACE\x20IN'+_0x48b8b2(0x13d)+_0x48b8b2(0x1ca)+_0x48b8b2(0x150)+'p_id,\x20chat'+'_id,\x20creat'+'or_id)\x20VAL'+_0x48b8b2(0x1cb)+'\x20?,\x20?)',[_0x22f0db,'',_0x428e2d,_0x3c374b]);}catch(_0x4eedad){warn('[connectio'+'n][migrati'+_0x48b8b2(0x174)+_0x48b8b2(0x234)+_0x48b8b2(0x1b4)+_0x48b8b2(0x1ac)+_0x48b8b2(0x1fc)+_0x22f0db+':\x20'+(_0x4eedad?.['message']||_0x4eedad));}}}catch(_0x3d7e56){warn('[connectio'+_0x48b8b2(0x1cc)+_0x48b8b2(0x1f8)+'g\x20old\x20rows'+_0x48b8b2(0x152)+(_0x3d7e56?.[_0x48b8b2(0x28a)]||_0x3d7e56));}try{await _0xb4de23[_0x48b8b2(0x146)]('DROP\x20TABLE'+_0x48b8b2(0x21f)+_0x48b8b2(0x17f)+_0x48b8b2(0x1a4));}catch(_0x4cca3a){}await _0xb4de23[_0x48b8b2(0x146)](_0x48b8b2(0x124)+_0x48b8b2(0x1bb)+_0x48b8b2(0x1e1)+'NAME\x20TO\x20co'+'nnections;'),info(_0x48b8b2(0x1e5)+_0x48b8b2(0x1ec)+_0x48b8b2(0x1e8)+'ons\x20->\x20con'+_0x48b8b2(0x214)+_0x48b8b2(0x14c)+_0x48b8b2(0x1e4));}catch(_0x14743e){warn(_0x48b8b2(0x1e5)+_0x48b8b2(0x237)+_0x48b8b2(0x1aa)+_0x48b8b2(0x26a)+_0x48b8b2(0x27c)+_0x48b8b2(0x226)+(_0x14743e?.[_0x48b8b2(0x28a)]||_0x14743e));if(!_0x6079db)try{await _0xb4de23['exec'](_0x48b8b2(0x124)+_0x48b8b2(0x1bb)+'ons\x20ADD\x20CO'+_0x48b8b2(0x283)+_0x48b8b2(0x208)+_0x48b8b2(0x274)+_0x48b8b2(0x1ed)),info(_0x48b8b2(0x1e5)+_0x48b8b2(0x1d6)+'issing\x20cha'+'t_id\x20colum'+'n');}catch(_0x47c75a){warn(_0x47c75a,_0x48b8b2(0x1e5)+'n]\x20failed\x20'+_0x48b8b2(0x1ee)+'t_id');}if(!_0x4acd5f)try{await _0xb4de23[_0x48b8b2(0x146)](_0x48b8b2(0x124)+_0x48b8b2(0x1bb)+_0x48b8b2(0x27b)+_0x48b8b2(0x213)+_0x48b8b2(0x20d)+_0x48b8b2(0x1b5)+_0x48b8b2(0x24e)+';'),info(_0x48b8b2(0x1e5)+_0x48b8b2(0x1d6)+_0x48b8b2(0x24c)+_0x48b8b2(0x242)+_0x48b8b2(0x251));}catch(_0x5b276b){warn(_0x5b276b,'[connectio'+_0x48b8b2(0x211)+'to\x20add\x20cre'+'ator_id');}if(!_0x23b0d4)try{await _0xb4de23['exec'](_0x48b8b2(0x124)+_0x48b8b2(0x1bb)+'ons\x20ADD\x20CO'+_0x48b8b2(0x1eb)+_0x48b8b2(0x212)+_0x48b8b2(0x1a2)+'FAULT\x20\x27\x27;'),info('[connectio'+_0x48b8b2(0x1d6)+_0x48b8b2(0x23d)+_0x48b8b2(0x16c)+'mn');}catch(_0x5eaa48){warn(_0x5eaa48,_0x48b8b2(0x1e5)+_0x48b8b2(0x211)+_0x48b8b2(0x186)+'up_id');}}}async function ensureGroupDefaultsTable(){const _0x51b418=_0xc507e3,_0x571ad4=await getDb(),_0x4154b3=await tableExists(_0x51b418(0x17e)+_0x51b418(0x289));if(!_0x4154b3){await _0x571ad4[_0x51b418(0x146)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x51b418(0x120)+_0x51b418(0x28c)+_0x51b418(0x15e)+_0x51b418(0x19a)+_0x51b418(0x23e)+_0x51b418(0x201)+'XT\x20PRIMARY'+_0x51b418(0x130)+_0x51b418(0x225)+_0x51b418(0x292)+_0x51b418(0x217)+_0x51b418(0x1e6)),info(_0x51b418(0x1e5)+_0x51b418(0x185)+_0x51b418(0x24b)+'up_default'+'s');return;}!await columnExists('group_defa'+_0x51b418(0x289),_0x51b418(0x1d8))&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x54dea2=_0xc507e3,_0x38d74d=await getDb();try{await _0x38d74d[_0x54dea2(0x146)](_0x54dea2(0x124)+_0x54dea2(0x1db)+_0x54dea2(0x11b)+'\x20COLUMN\x20gr'+'oup_id\x20TEX'+_0x54dea2(0x27f)+_0x54dea2(0x141)+'\x27;'),await _0x38d74d['exec'](_0x54dea2(0x124)+_0x54dea2(0x1db)+_0x54dea2(0x11b)+'\x20COLUMN\x20na'+_0x54dea2(0x270)+_0x54dea2(0x274)+_0x54dea2(0x1ed));}catch(_0x5e143b){warn(_0x54dea2(0x1e5)+_0x54dea2(0x144)+_0x54dea2(0x223)+_0x54dea2(0x232)+_0x54dea2(0x14b)+(_0x5e143b?.[_0x54dea2(0x28a)]||_0x5e143b));}}async function ensureActiveGroupsTable(){const _0x5e0b40=_0xc507e3,_0x5cd632=await getDb(),_0x47fdb7=await tableExists(ACTIVE_TABLE);!_0x47fdb7&&(await _0x5cd632[_0x5e0b40(0x146)](_0x5e0b40(0x248)+_0x5e0b40(0x120)+_0x5e0b40(0x28c)+_0x5e0b40(0x269)+ACTIVE_TABLE+('\x20(\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x5e0b40(0x1a5)+'TEXT\x20PRIMA'+_0x5e0b40(0x195)+_0x5e0b40(0x25d)+_0x5e0b40(0x25c)+'NOT\x20NULL\x0a\x20'+_0x5e0b40(0x282)+'\x20\x20')),info(_0x5e0b40(0x1e5)+_0x5e0b40(0x185)+_0x5e0b40(0x132)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x21ebd9=_0xc507e3;try{const _0x30b18b=await getDb(),_0x50f717=await _0x30b18b[_0x21ebd9(0x1ae)](_0x21ebd9(0x178)+_0x21ebd9(0x253)+_0x21ebd9(0x14d)+_0x21ebd9(0x12b)+'ections');if(!_0x50f717||_0x50f717[_0x21ebd9(0x1c2)]===0x7b+0xc12+-0x9*0x165)return;const _0xe93e35=[];for(const _0x2062ff of _0x50f717){const _0x3dfa99=_0x2062ff['chat_id'],_0x44e728=safeParseJSON(_0x3dfa99);if(Array[_0x21ebd9(0x26f)](_0x44e728)){const _0xc96742=_0x44e728['map'](String),_0x201918=toJSONString(_0xc96742);if(_0x201918!==_0x3dfa99)_0xe93e35[_0x21ebd9(0x11c)]({'name':_0x2062ff[_0x21ebd9(0x21c)],'group_id':_0x2062ff[_0x21ebd9(0x1d8)]||'','chat_id':_0x201918});continue;}else{let _0x129dd8=[];_0x3dfa99===null||_0x3dfa99===undefined||String(_0x3dfa99)['trim']()===''?_0x129dd8=[]:_0x129dd8=[String(_0x3dfa99)];const _0x2b420b=toJSONString(_0x129dd8);_0xe93e35[_0x21ebd9(0x11c)]({'name':_0x2062ff['name'],'group_id':_0x2062ff[_0x21ebd9(0x1d8)]||'','chat_id':_0x2b420b});}}if(_0xe93e35[_0x21ebd9(0x1c2)]>0xa04+0x4*0x313+-0x1650){try{await _0x30b18b[_0x21ebd9(0x146)](_0x21ebd9(0x1a9)+_0x21ebd9(0x222));}catch(_0x42b703){}for(const _0xb141df of _0xe93e35){try{await _0x30b18b[_0x21ebd9(0x216)]('UPDATE\x20con'+_0x21ebd9(0x1d7)+_0x21ebd9(0x295)+_0x21ebd9(0x275)+'\x20name\x20=\x20?\x20'+_0x21ebd9(0x1e9)+_0x21ebd9(0x20b),[_0xb141df[_0x21ebd9(0x1dd)],_0xb141df[_0x21ebd9(0x21c)],_0xb141df[_0x21ebd9(0x1d8)]]),info(_0x21ebd9(0x1e5)+'n][migrati'+_0x21ebd9(0x13c)+_0x21ebd9(0x1f7)+'id\x20for\x20\x22'+_0xb141df['name']+('\x22\x20@\x20group\x20'+'\x22')+_0xb141df[_0x21ebd9(0x1d8)]+'\x22');}catch(_0x40588a){warn(_0x21ebd9(0x1e5)+'n][migrati'+_0x21ebd9(0x19c)+_0x21ebd9(0x15f)+_0x21ebd9(0x161)+_0x21ebd9(0x1fc)+_0xb141df[_0x21ebd9(0x21c)]+'@'+_0xb141df['group_id']+':\x20'+(_0x40588a?.[_0x21ebd9(0x28a)]||_0x40588a));}}try{await _0x30b18b['exec']('COMMIT;');}catch(_0x1975b4){}}}catch(_0x103cee){warn(_0x21ebd9(0x1e5)+_0x21ebd9(0x1cc)+'on]\x20migrat'+_0x21ebd9(0x20c)+'nsChatIdTo'+'Array\x20fail'+_0x21ebd9(0x1ff)+(_0x103cee?.['message']||_0x103cee));}}function _0x3e6a(){const _0x1d18a4=['\x20WHERE\x20typ','nGroup:\x20','n]\x20setDefa','plete','\x20CONFLICT(','WHERE\x20grou','\x20\x20\x20\x20\x20creat','T\x20NULL,\x0a\x20\x20','ided\x20for\x20s','chema\x20fail','olumns\x20fai','filter','\x20into\x20conn','ons\x20WHERE\x20','\x20->\x20','n]\x20migrati','Scoped\x20fai','on\x20\x22','WHERE\x20name','up_id,\x20nam','\x20for\x20','issing\x20gro','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','SELECT\x20use','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','n]\x20columnE','ator_id\x20co',')\x20VALUES\x20(','rray\x20type\x20','faults\x20(gr','\x20group_id)','\x20@\x20group=','\x0a\x20\x20\x20\x20\x20\x20CRE','group_id\x20=','XT\x20NOT\x20NUL','\x20table\x20gro','issing\x20cre','ByCreatorI','DEFAULT\x20\x27\x27','onnections','get','lumn','n]\x20setActi','e,\x20group_i','SELECT\x20cha','SELECT\x201\x20F','8936872wHRdFQ','creator_id','undefined','skipping\x20n','set',')\x20@\x20group=','p_id\x20TEXT\x20','\x20\x20\x20\x20\x20\x20grou','5wFmyBY','?,\x20?,\x20?,\x20?','n]\x20schema\x20','DO\x20UPDATE\x20','error','name\x20=\x20?\x20A','changes','\x20\x20\x20\x20\x20ON\x20CO','n]\x20refresh','\x20=\x20?,\x20crea','log','STS\x20','connection','efault\x20set','\x20(?,\x20?)\x0a\x20\x20','clear','Unsupporte','isArray','me\x20TEXT\x20NO','ensured\x20an','includes','moved\x20all\x20','T\x20NULL\x20DEF','\x20=\x20?\x20WHERE','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','up_default','Cache\x20fail','\x20rows)','ultGroup\x20f','ons\x20ADD\x20CO','s\x20schema\x20f','warn','2247642EgnfpT','T\x20NOT\x20NULL','up_id\x20FROM','None\x20of\x20th','\x20\x20\x20\x20\x20);\x0a\x20\x20','LUMN\x20chat_','ection\x20fai','[ERROR]','OT\x20NULL,\x0a\x20','ed(','ections','ults','message','efaults\x20ca','IF\x20NOT\x20EXI','DER\x20BY\x20nam','oup:\x20','rd(','s\x20failed','onnectionS','EXT\x20NOT\x20NU','\x20name\x20=\x20?\x20','\x20loaded\x20(','ET\x20chat_id','t\x20connecti','join','e\x20FROM\x20sql','faults\x20ADD','push','\x20@\x20','ection(','d\x20=\x20?','ATE\x20TABLE\x20','_defaults\x20','entries\x20fo','for\x20','ALTER\x20TABL','nectionsFo','n]\x20getActi','21tAAWFy','coped\x20fail','(0\x20rows)','id\x20=\x20exclu','\x20FROM\x20conn','\x20group_def','e\x20FROM\x20gro','STS\x20connec',',\x20group_id','\x20KEY,\x0a\x20\x20\x20\x20','2480751OeRDXo','\x20table\x20','RDER\x20BY\x20na','\x20(arrays-o','onnection\x20','UPDATE\x20SET','n]\x20connect','\x20PRIMARY\x20K','iveGroupsC','Array\x20fail','on-existen','on]\x20normal','TO\x20connect','20762260EAuzNs','Caches\x20com','ite_master','\x20DEFAULT\x20\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','KEY\x20(name,','n]\x20addGrou','1698054ZxKwOE','exec','-scoped).\x20','split','ons\x20(name,','r_key,\x20gro','led:\x20','with\x20group','d,\x20chat_id','p\x20failed\x20f','ame','name,\x20grou','n]\x20loadGro','\x20failed:\x20','trim','n]\x20ensureS','\x20(deleted=','nnections','ache\x20faile','tGroup','ailed\x20for\x20','\x20\x20\x20','M\x20connecti','s\x20WHERE\x20gr','groupId\x20re','STS\x20group_','\x20to\x20update','\x20chat_id,\x20','\x20chat_id\x20f','me)\x20VALUES','\x20\x20\x20\x20\x20\x20\x20cre','\x20to\x20set\x20as','up_id)\x20DO\x20','s\x20WHERE\x20na',',\x20creator_','ted','\x20group_id\x20','COMMIT;','entries','up_id\x20colu','E\x20IF\x20NOT\x20E','NULL,\x0a\x20\x20\x20\x20','n]\x20active\x20','n]\x20group\x20d','ared\x20for\x20','\x20setDefaul','n]\x20getConn','on]\x20insert','s\x20group','toLowerCas','\x20loaded\x20(0','SELECT\x20nam','n\x20complete','[INFO]','odule\x20did\x20','for\x20setDef','ult\x20failed','group_defa','\x20connectio','\x20(0\x20rows)','\x20name\x20=\x20ex','\x20\x20\x20\x20\x20\x20);\x0a\x20','to\x20persist','function','n]\x20created','to\x20add\x20gro','\x20all','tor_id\x20=\x20?','ectionScop','group_id,\x20','slice','e_groups','ROM\x20connec','upDefaults','\x20\x20\x20\x20\x20\x20\x20\x20ON','database\x20m','has','\x20\x20\x20\x20\x20\x20name','INSERT\x20OR\x20','_id\x20=\x20?\x20OR','RY\x20KEY,\x0a\x20\x20','oup_id\x20=\x20?','Connection','NFLICT(gro','n]\x20addConn','defaults\x20(','ectionReco','on]\x20failed','INSERT\x20INT','map','UPDATE\x20gro','user_key)\x20','O\x20group_de','OT\x20NULL\x20DE','27vLfpLa','ns;','\x20user_key\x20','[WARN]','=\x20?','e\x20provided','BEGIN\x20TRAN','on\x20to\x20new\x20','e,\x20chat_id','w\x20failed\x20f','veGroupFor','all','\x20\x20\x20\x20group_','ded.group_','ded.','Scoped:\x20re','ized\x20group','ections_ne','\x20NOT\x20NULL\x20',';\x0a\x20\x20\x20\x20\x20\x20','nnections\x20','hat_id\x20TEX','string',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','E\x20connecti','me\x20=\x20?','\x20active\x20gr','tions\x20WHER','n]\x20removeC','PRAGMA\x20tab','L,\x0a\x20\x20\x20\x20\x20\x20\x20','length','O\x20connecti','groups\x20cac','hatIdsFrom','stringify','ions\x20found','e=\x27table\x27\x20','cluded.nam','ions_new\x20(','UES\x20(?,\x20?,','n][migrati','not\x20export','32786VYniFP','Scoped:\x20','efault\x20cle','oup\x20deleti','ions\x20cache','user_key','REATE\x20TABL','coped:\x20','n]\x20added\x20m','nections\x20S','group_id','id\x20FROM\x20co','\x20group_id,','E\x20group_de','id,\x20group_','chat_id','d\x20namesOrA',',\x20row\x20dele','n]\x20getDefa','ons_new\x20RE','ND\x20group_i','\x20now\x20->\x20','_id)','[connectio',';\x0a\x20\x20\x20\x20',')\x20failed','d\x20connecti','AND\x20group_','ist\x20in\x20thi','LUMN\x20group','n]\x20migrate','AULT\x20\x27[]\x27;','to\x20add\x20cha','11xfRUdN','che\x20loaded','d:\x20','t_id\x20FROM\x20','values','WHERE\x20crea','delete','n]\x20listAll','ized\x20chat_','on]\x20readin','\x20=\x20?\x20AND\x20g','n]\x20updated','me\x20=\x20?\x20AND','or\x20','some','M\x20group_de','ed:\x20','e\x20=\x20?\x20AND\x20','roup_id\x20TE','DELETE\x20FRO','ultForGrou','group_id)\x0a','ultGroup:\x20','\x20AND\x20group','\x20\x20\x20\x20\x20\x20chat','id\x20TEXT\x20NO','oup_id,\x20na','xists\x20chec','id\x20=\x20?','eConnectio','or_id\x20TEXT','\x20(creator=','he\x20loaded\x20','[]\x27,\x0a\x20\x20\x20\x20\x20','n]\x20failed\x20','_id\x20TEXT\x20N','LUMN\x20creat','nections\x20(','le_info(','run','LL\x0a\x20\x20\x20\x20\x20\x20)','rGroup\x20fai','\x20ORDER\x20BY\x20','n]\x20deleteC','2350204xRYrXS','name','\x20\x20PRIMARY\x20','_id\x20=\x20?','\x20IF\x20EXISTS','n]\x20loadAct','p_id\x20PK)','SACTION;','pDefaultsC','rdScoped(','\x20\x20\x20\x20name\x20T','ailed:\x20','EY\x20(name,\x20'];_0x3e6a=function(){return _0x1d18a4;};return _0x3e6a();}async function migrateGroupDefaultsNameToArray(){const _0x441c2d=_0xc507e3;try{const _0x371048=await getDb(),_0x4bd2e6=await _0x371048[_0x441c2d(0x1ae)]('SELECT\x20gro'+_0x441c2d(0x23b)+_0x441c2d(0x12d)+_0x441c2d(0x277)+'s');if(!_0x4bd2e6||_0x4bd2e6['length']===0x1f2+-0xfd9+0xde7)return;const _0x103167=[];for(const _0x1a6848 of _0x4bd2e6){const _0x239fdb=_0x1a6848[_0x441c2d(0x21c)],_0x404469=safeParseJSON(_0x239fdb);if(Array['isArray'](_0x404469)){const _0x34d92c=toJSONString(_0x404469);if(_0x34d92c!==_0x239fdb)_0x103167[_0x441c2d(0x11c)]({'group_id':_0x1a6848[_0x441c2d(0x1d8)],'name':_0x34d92c});continue;}else{const _0x20c609=_0x239fdb===null||_0x239fdb===undefined||String(_0x239fdb)[_0x441c2d(0x153)]()===''?[]:[String(_0x239fdb)],_0x58ca7c=toJSONString(_0x20c609);_0x103167[_0x441c2d(0x11c)]({'group_id':_0x1a6848[_0x441c2d(0x1d8)],'name':_0x58ca7c});}}if(_0x103167[_0x441c2d(0x1c2)]>0x1*-0x1d0b+-0x1*-0x2335+-0x62a){try{await _0x371048[_0x441c2d(0x146)]('BEGIN\x20TRAN'+_0x441c2d(0x222));}catch(_0x105551){}for(const _0x230a2c of _0x103167){try{await _0x371048['run'](_0x441c2d(0x19f)+_0x441c2d(0x277)+'s\x20SET\x20name'+_0x441c2d(0x275)+_0x441c2d(0x169)+'=\x20?',[_0x230a2c[_0x441c2d(0x21c)],_0x230a2c[_0x441c2d(0x1d8)]]),info('[connectio'+_0x441c2d(0x1cc)+'on]\x20normal'+_0x441c2d(0x1b3)+_0x441c2d(0x121)+_0x441c2d(0x123)+_0x230a2c[_0x441c2d(0x1d8)]);}catch(_0x7d1179){warn(_0x441c2d(0x1e5)+_0x441c2d(0x1cc)+_0x441c2d(0x19c)+'\x20to\x20update'+_0x441c2d(0x12c)+'aults\x20for\x20'+_0x230a2c['group_id']+':\x20'+(_0x7d1179?.[_0x441c2d(0x28a)]||_0x7d1179));}}try{await _0x371048[_0x441c2d(0x146)](_0x441c2d(0x16a));}catch(_0x22e0d4){}}}catch(_0x1b30a6){warn(_0x441c2d(0x1e5)+_0x441c2d(0x1cc)+'on]\x20migrat'+'eGroupDefa'+'ultsNameTo'+_0x441c2d(0x13a)+'ed:\x20'+(_0x1b30a6?.[_0x441c2d(0x28a)]||_0x1b30a6));}}function parseArrayStrict(_0x17644f){const _0x1842ab=_0xc507e3;if(_0x17644f===null||_0x17644f===undefined)return[];if(typeof _0x17644f===_0x1842ab(0x1b9)){const _0x36b07a=safeParseJSON(_0x17644f);if(Array['isArray'](_0x36b07a))return _0x36b07a[_0x1842ab(0x19e)](String);return[];}if(Array[_0x1842ab(0x26f)](_0x17644f))return _0x17644f['map'](String);return[String(_0x17644f)];}function stringifyArray(_0x482e95){const _0x5132a3=_0xc507e3;return JSON[_0x5132a3(0x1c6)](Array['isArray'](_0x482e95)?_0x482e95[_0x5132a3(0x19e)](String):[]);}async function loadConnectionsCache(){const _0x512669=_0xc507e3;try{const _0x55aa34=await getDb(),_0x508d63=await _0x55aa34[_0x512669(0x1ae)](_0x512669(0x178)+_0x512669(0x253)+_0x512669(0x14d)+',\x20creator_'+_0x512669(0x1d9)+_0x512669(0x156));connectionsCache[_0x512669(0x26d)]();if(!_0x508d63||!_0x508d63['length']){info(_0x512669(0x1e5)+_0x512669(0x137)+_0x512669(0x1d2)+_0x512669(0x177)+'\x20rows)');return;}for(const _0x595103 of _0x508d63){const _0x599be9=String(_0x595103[_0x512669(0x1d8)]||'');if(!connectionsCache[_0x512669(0x191)](_0x599be9))connectionsCache[_0x512669(0x25a)](_0x599be9,new Map());const _0x382143=connectionsCache['get'](_0x599be9);_0x382143[_0x512669(0x25a)](String(_0x595103['name']),{'name':_0x595103['name'],'chat_id':parseArrayStrict(_0x595103[_0x512669(0x1dd)]),'creator_id':_0x595103['creator_id']});}info(_0x512669(0x1e5)+_0x512669(0x137)+_0x512669(0x1d2)+_0x512669(0x294)+_0x508d63[_0x512669(0x1c2)]+_0x512669(0x279));}catch(_0x55c759){warn(_0x512669(0x1e5)+'n]\x20loadCon'+'nectionsCa'+'che\x20failed'+':\x20'+(_0x55c759?.['message']||_0x55c759));}}async function loadGroupDefaultsCache(){const _0x338e4c=_0xc507e3;try{const _0x3c103c=await getDb(),_0x5ebcd9=await _0x3c103c['all']('SELECT\x20gro'+_0x338e4c(0x23b)+_0x338e4c(0x12d)+_0x338e4c(0x277)+'s');groupDefaultsCache[_0x338e4c(0x26d)]();if(!_0x5ebcd9||!_0x5ebcd9[_0x338e4c(0x1c2)]){info(_0x338e4c(0x1e5)+_0x338e4c(0x170)+_0x338e4c(0x28b)+_0x338e4c(0x1f0)+_0x338e4c(0x180));return;}for(const _0x31c0cb of _0x5ebcd9){try{const _0x1e86cf=String(_0x31c0cb[_0x338e4c(0x1d8)]),_0x46ebe6=safeParseJSON(_0x31c0cb[_0x338e4c(0x21c)]),_0x448aeb=Array[_0x338e4c(0x26f)](_0x46ebe6)?_0x46ebe6['map'](String):[];groupDefaultsCache[_0x338e4c(0x25a)](_0x1e86cf,_0x448aeb);}catch(_0xb2ded7){}}info(_0x338e4c(0x1e5)+_0x338e4c(0x170)+'efaults\x20ca'+_0x338e4c(0x1f0)+'\x20('+_0x5ebcd9[_0x338e4c(0x1c2)]+_0x338e4c(0x279));}catch(_0x211fc7){warn(_0x338e4c(0x1e5)+_0x338e4c(0x151)+_0x338e4c(0x18e)+_0x338e4c(0x278)+_0x338e4c(0x1ff)+(_0x211fc7?.[_0x338e4c(0x28a)]||_0x211fc7));}}async function loadActiveGroupsCache(){const _0x19eb1b=_0xc507e3;try{const _0x263852=await getDb(),_0x353d65=await _0x263852[_0x19eb1b(0x1ae)](_0x19eb1b(0x23f)+_0x19eb1b(0x14a)+_0x19eb1b(0x280)+'\x20'+ACTIVE_TABLE);activeGroupByUser[_0x19eb1b(0x26d)]();if(!_0x353d65||!_0x353d65[_0x19eb1b(0x1c2)]){info(_0x19eb1b(0x1e5)+_0x19eb1b(0x16f)+'groups\x20cac'+'he\x20loaded\x20'+_0x19eb1b(0x129));return;}for(const _0x4d0738 of _0x353d65){try{activeGroupByUser[_0x19eb1b(0x25a)](String(_0x4d0738[_0x19eb1b(0x1d3)]),String(_0x4d0738['group_id']));}catch(_0x2677b3){}}info(_0x19eb1b(0x1e5)+'n]\x20active\x20'+_0x19eb1b(0x1c4)+_0x19eb1b(0x20f)+'('+_0x353d65[_0x19eb1b(0x1c2)]+_0x19eb1b(0x279));}catch(_0x418b02){warn(_0x19eb1b(0x1e5)+_0x19eb1b(0x220)+_0x19eb1b(0x139)+_0x19eb1b(0x157)+_0x19eb1b(0x1f1)+(_0x418b02?.[_0x19eb1b(0x28a)]||_0x418b02));}}export async function refreshCaches(){const _0x458da2=_0xc507e3;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x458da2(0x1e5)+_0x458da2(0x266)+_0x458da2(0x13f)+_0x458da2(0x22b));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x56765b){const _0x466e77=_0xc507e3;if(!_0x56765b)return null;const _0x11751b=String(_0x56765b)[_0x466e77(0x153)]();if(!_0x11751b)return null;return _0x11751b[_0x466e77(0x272)]('@')?_0x11751b[_0x466e77(0x148)]('@')[0x2110+-0x149b+-0xc75]:_0x11751b;}export async function ensureSchema(){const _0x422b94=_0xc507e3;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info(_0x422b94(0x1e5)+_0x422b94(0x260)+_0x422b94(0x271)+'d\x20migratio'+_0x422b94(0x179)+_0x422b94(0x134)+'nly,\x20group'+_0x422b94(0x147)+'Caches\x20loa'+_0x422b94(0x1b1));}catch(_0x52d75e){error(_0x52d75e,_0x422b94(0x1e5)+_0x422b94(0x154)+_0x422b94(0x231)+_0x422b94(0x1ff)+(_0x52d75e?.[_0x422b94(0x28a)]||_0x52d75e));throw _0x52d75e;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x432518,_0x156524){const _0x1127e3=_0xc507e3;try{if(!_0x432518)return;const _0x204065=normalizeUserKeyForStorage(_0x432518);if(!_0x204065)return;if(!_0x156524){activeGroupByUser[_0x1127e3(0x1f5)](_0x204065);try{const _0x44a8ec=await getDb();await _0x44a8ec[_0x1127e3(0x216)]('DELETE\x20FRO'+'M\x20'+ACTIVE_TABLE+('\x20WHERE\x20use'+'r_key\x20=\x20?'),[_0x204065]);}catch(_0xea55c5){warn(_0x1127e3(0x1e5)+_0x1127e3(0x211)+_0x1127e3(0x183)+_0x1127e3(0x1bd)+_0x1127e3(0x1d1)+'on:\x20'+(_0xea55c5?.[_0x1127e3(0x28a)]||_0xea55c5));}return;}const _0x4d61cc=String(_0x156524);activeGroupByUser[_0x1127e3(0x25a)](_0x204065,_0x4d61cc);try{const _0x16f8a5=await getDb();await _0x16f8a5[_0x1127e3(0x216)](_0x1127e3(0x19d)+'O\x20'+ACTIVE_TABLE+('\x20(user_key'+_0x1127e3(0x12f)+_0x1127e3(0x243)+'?,\x20?)\x20\x0a\x20\x20\x20'+_0x1127e3(0x276)+_0x1127e3(0x18f)+_0x1127e3(0x22c)+_0x1127e3(0x1a0)+_0x1127e3(0x261)+'SET\x20group_'+_0x1127e3(0x12a)+_0x1127e3(0x1b0)+'id'),[_0x204065,_0x4d61cc]);}catch(_0x636fc5){warn('[connectio'+_0x1127e3(0x211)+_0x1127e3(0x183)+'\x20active\x20gr'+_0x1127e3(0x28e)+(_0x636fc5?.['message']||_0x636fc5));}}catch(_0x5750ca){warn(_0x1127e3(0x1e5)+_0x1127e3(0x252)+_0x1127e3(0x1ad)+'User\x20error'+':\x20'+(_0x5750ca?.[_0x1127e3(0x28a)]||_0x5750ca));}}export function getActiveGroupForUser(_0x881e0a){const _0x220555=_0xc507e3;try{if(!_0x881e0a)return null;const _0x14cdd2=normalizeUserKeyForStorage(_0x881e0a);if(!_0x14cdd2)return null;return activeGroupByUser['get'](_0x14cdd2)||null;}catch(_0x2a33c7){return warn(_0x220555(0x1e5)+_0x220555(0x126)+'veGroupFor'+'User\x20error'+':\x20'+(_0x2a33c7?.['message']||_0x2a33c7)),null;}}export async function addConnection(_0x780c8d,_0x332104,_0x370270='',_0xe997af=''){const _0x454d15=_0xc507e3;try{await ensureSchema();const _0x245095=await getDb(),_0x4d1d28=String(_0xe997af||''),_0x48d6e9=await _0x245095[_0x454d15(0x250)]('SELECT\x20cha'+_0x454d15(0x1f2)+_0x454d15(0x26a)+'s\x20WHERE\x20na'+_0x454d15(0x1fb)+_0x454d15(0x169)+'=\x20?',[String(_0x780c8d),_0x4d1d28]);if(!_0x48d6e9){const _0x139e1c=[String(_0x332104)];await _0x245095[_0x454d15(0x216)](_0x454d15(0x19d)+_0x454d15(0x1c3)+_0x454d15(0x149)+_0x454d15(0x1da)+_0x454d15(0x160)+_0x454d15(0x257)+_0x454d15(0x243)+_0x454d15(0x25f)+')',[String(_0x780c8d),_0x4d1d28,stringifyArray(_0x139e1c),String(_0x370270||'')]),info('[connectio'+_0x454d15(0x185)+':\x20'+_0x780c8d+'\x20->\x20'+_0x332104+_0x454d15(0x20e)+_0x370270+_0x454d15(0x25b)+_0x4d1d28);if(!connectionsCache[_0x454d15(0x191)](_0x4d1d28))connectionsCache[_0x454d15(0x25a)](_0x4d1d28,new Map());const _0x3d06b1=connectionsCache[_0x454d15(0x250)](_0x4d1d28);return _0x3d06b1[_0x454d15(0x25a)](String(_0x780c8d),{'name':String(_0x780c8d),'chat_id':_0x139e1c[_0x454d15(0x19e)](String),'creator_id':String(_0x370270||'')}),!![];}else{const _0x1d6404=parseArrayStrict(_0x48d6e9[_0x454d15(0x1dd)]);if(!_0x1d6404[_0x454d15(0x272)](String(_0x332104)))_0x1d6404[_0x454d15(0x11c)](String(_0x332104));await _0x245095[_0x454d15(0x216)]('UPDATE\x20con'+_0x454d15(0x1d7)+_0x454d15(0x295)+_0x454d15(0x267)+_0x454d15(0x188)+'\x20WHERE\x20nam'+_0x454d15(0x200)+_0x454d15(0x249)+'\x20?',[stringifyArray(_0x1d6404),String(_0x370270||''),String(_0x780c8d),_0x4d1d28]),info(_0x454d15(0x1e5)+_0x454d15(0x1fa)+':\x20'+_0x780c8d+_0x454d15(0x236)+_0x1d6404[_0x454d15(0x297)](',')+_0x454d15(0x247)+_0x4d1d28);if(!connectionsCache[_0x454d15(0x191)](_0x4d1d28))connectionsCache[_0x454d15(0x25a)](_0x4d1d28,new Map());const _0x593d02=connectionsCache[_0x454d15(0x250)](_0x4d1d28);return _0x593d02[_0x454d15(0x25a)](String(_0x780c8d),{'name':String(_0x780c8d),'chat_id':_0x1d6404[_0x454d15(0x19e)](String),'creator_id':String(_0x370270||'')}),!![];}}catch(_0x581fa6){return error(_0x581fa6,'[connectio'+_0x454d15(0x199)+_0x454d15(0x284)+'led\x20for\x20'+_0x780c8d+_0x454d15(0x11d)+_0xe997af),![];}}export async function deleteConnectionScoped(_0x257eb1,_0x204c16=''){const _0x238a66=_0xc507e3;try{await ensureSchema();const _0x27fde0=await getDb(),_0x234a27=await _0x27fde0[_0x238a66(0x216)]('DELETE\x20FRO'+'M\x20connecti'+'ons\x20WHERE\x20'+_0x238a66(0x263)+_0x238a66(0x1e2)+_0x238a66(0x11f),[String(_0x257eb1),String(_0x204c16||'')]),_0xa72e92=_0x234a27&&(_0x234a27['changes']===undefined?!![]:!!_0x234a27[_0x238a66(0x264)]);info(_0x238a66(0x1e5)+_0x238a66(0x21a)+_0x238a66(0x291)+_0x238a66(0x1d5)+_0x257eb1+_0x238a66(0x11d)+_0x204c16+_0x238a66(0x155)+_0xa72e92+')');try{const _0x103117=String(_0x204c16||'');if(connectionsCache[_0x238a66(0x191)](_0x103117)){const _0x57b620=connectionsCache[_0x238a66(0x250)](_0x103117);if(_0x57b620)_0x57b620[_0x238a66(0x1f5)](String(_0x257eb1));}}catch(_0x3a8d10){}return _0xa72e92;}catch(_0x3e2f67){return error(_0x3e2f67,_0x238a66(0x1e5)+_0x238a66(0x21a)+_0x238a66(0x291)+_0x238a66(0x128)+_0x238a66(0x1ff)+_0x257eb1+_0x238a66(0x11d)+_0x204c16),![];}}export async function deleteConnectionsByCreatorInGroup(_0x1e608b,_0x31055f=''){const _0x5bdfd3=_0xc507e3;try{await ensureSchema();const _0x389761=await getDb(),_0x530d66=await _0x389761[_0x5bdfd3(0x216)]('DELETE\x20FRO'+_0x5bdfd3(0x15b)+_0x5bdfd3(0x235)+_0x5bdfd3(0x257)+_0x5bdfd3(0x1f9)+'roup_id\x20=\x20'+'?',[String(_0x1e608b),String(_0x31055f||'')]),_0x21c285=_0x530d66&&(_0x530d66[_0x5bdfd3(0x264)]===undefined?!![]:_0x530d66[_0x5bdfd3(0x264)])||0x1*-0x1cae+0x544*0x2+0xca*0x17;info(_0x5bdfd3(0x1e5)+_0x5bdfd3(0x21a)+_0x5bdfd3(0x24f)+_0x5bdfd3(0x24d)+_0x5bdfd3(0x229)+_0x1e608b+'\x20@\x20'+_0x31055f+_0x5bdfd3(0x155)+_0x21c285+')');try{const _0x42de54=String(_0x31055f||'');if(connectionsCache[_0x5bdfd3(0x191)](_0x42de54)){const _0x380920=connectionsCache[_0x5bdfd3(0x250)](_0x42de54);for(const [_0x5def0c,_0xa33672]of Array['from'](_0x380920['entries']())){if(String(_0xa33672[_0x5bdfd3(0x257)])===String(_0x1e608b))_0x380920[_0x5bdfd3(0x1f5)](_0x5def0c);}}}catch(_0x49120e){}return _0x21c285;}catch(_0x3600fc){return error(_0x3600fc,'[connectio'+_0x5bdfd3(0x21a)+_0x5bdfd3(0x24f)+_0x5bdfd3(0x24d)+'nGroup\x20fai'+'led:\x20'+(_0x3600fc?.[_0x5bdfd3(0x28a)]||_0x3600fc)),0x770+-0x198e+0x121e;}}export async function removeChatIdsFromConnectionScoped(_0x25087a,_0x24d3e0,_0x563f7c=''){const _0x3c9a33=_0xc507e3;try{if(!_0x25087a)return![];await ensureSchema();const _0x3af679=await getDb(),_0x5d333e=await _0x3af679[_0x3c9a33(0x250)](_0x3c9a33(0x254)+_0x3c9a33(0x1f2)+_0x3c9a33(0x26a)+_0x3c9a33(0x166)+_0x3c9a33(0x1fb)+_0x3c9a33(0x169)+_0x3c9a33(0x1a7),[String(_0x25087a),String(_0x563f7c||'')]);if(!_0x5d333e)return![];const _0x478647=parseArrayStrict(_0x5d333e['chat_id']),_0x3c9d75=Array[_0x3c9a33(0x26f)](_0x24d3e0)?_0x24d3e0['map'](String):[String(_0x24d3e0)],_0x443b93=_0x478647[_0x3c9a33(0x233)](_0x4b0591=>!_0x3c9d75[_0x3c9a33(0x272)](_0x4b0591));if(_0x443b93[_0x3c9a33(0x1c2)]===-0x91d+-0xc35*0x2+-0x3*-0xb2d){await _0x3af679[_0x3c9a33(0x216)](_0x3c9a33(0x202)+_0x3c9a33(0x15b)+_0x3c9a33(0x235)+'name\x20=\x20?\x20A'+_0x3c9a33(0x1e2)+_0x3c9a33(0x11f),[String(_0x25087a),String(_0x563f7c||'')]),info('[connectio'+'n]\x20removeC'+_0x3c9a33(0x1c5)+_0x3c9a33(0x197)+_0x3c9a33(0x1b2)+_0x3c9a33(0x273)+_0x3c9a33(0x122)+'r\x20'+_0x25087a+'\x20@\x20'+_0x563f7c+(_0x3c9a33(0x1df)+_0x3c9a33(0x168)));try{const _0x173453=String(_0x563f7c||'');if(connectionsCache[_0x3c9a33(0x191)](_0x173453))connectionsCache[_0x3c9a33(0x250)](_0x173453)[_0x3c9a33(0x1f5)](String(_0x25087a));}catch(_0x299800){}return!![];}else{await _0x3af679['run']('UPDATE\x20con'+_0x3c9a33(0x1d7)+_0x3c9a33(0x295)+_0x3c9a33(0x275)+_0x3c9a33(0x293)+'AND\x20group_'+_0x3c9a33(0x20b),[stringifyArray(_0x443b93),String(_0x25087a),String(_0x563f7c||'')]),info('[connectio'+_0x3c9a33(0x1bf)+_0x3c9a33(0x1c5)+_0x3c9a33(0x197)+_0x3c9a33(0x1cf)+_0x25087a+'@'+_0x563f7c+_0x3c9a33(0x1e3)+_0x443b93[_0x3c9a33(0x297)](','));try{const _0x25f1d0=String(_0x563f7c||'');if(!connectionsCache['has'](_0x25f1d0))connectionsCache[_0x3c9a33(0x25a)](_0x25f1d0,new Map());connectionsCache[_0x3c9a33(0x250)](_0x25f1d0)[_0x3c9a33(0x25a)](String(_0x25087a),{'name':String(_0x25087a),'chat_id':_0x443b93[_0x3c9a33(0x19e)](String),'creator_id':connectionsCache[_0x3c9a33(0x250)](_0x25f1d0)[_0x3c9a33(0x250)](String(_0x25087a))?.['creator_id']||''});}catch(_0x591637){}return!![];}}catch(_0x5f0b18){return error(_0x5f0b18,_0x3c9a33(0x1e5)+'n]\x20removeC'+_0x3c9a33(0x1c5)+_0x3c9a33(0x197)+_0x3c9a33(0x238)+_0x3c9a33(0x14b)+(_0x5f0b18?.[_0x3c9a33(0x28a)]||_0x5f0b18)),![];}}export async function listConnectionsForGroup(_0x2ba999){const _0x3ff290=_0xc507e3;try{await ensureSchema();const _0x3c0cc8=String(_0x2ba999||'');if(connectionsCache['has'](_0x3c0cc8)){const _0x375c1d=connectionsCache[_0x3ff290(0x250)](_0x3c0cc8);return Array['from'](_0x375c1d[_0x3ff290(0x1f3)]())[_0x3ff290(0x19e)](_0x53c284=>({'name':_0x53c284[_0x3ff290(0x21c)],'chat_id':Array[_0x3ff290(0x26f)](_0x53c284[_0x3ff290(0x1dd)])?_0x53c284[_0x3ff290(0x1dd)][_0x3ff290(0x19e)](String):[],'creator_id':_0x53c284[_0x3ff290(0x257)]}));}const _0x55d676=await getDb(),_0x8f1492=await _0x55d676[_0x3ff290(0x1ae)](_0x3ff290(0x178)+'e,\x20chat_id'+_0x3ff290(0x167)+_0x3ff290(0x1d9)+_0x3ff290(0x1b7)+_0x3ff290(0x22d)+'p_id\x20=\x20?\x20O'+_0x3ff290(0x133)+'me',[_0x3c0cc8]);return(_0x8f1492||[])['map'](_0x2d833d=>({'name':_0x2d833d['name'],'chat_id':parseArrayStrict(_0x2d833d[_0x3ff290(0x1dd)]),'creator_id':_0x2d833d[_0x3ff290(0x257)]}));}catch(_0x4ab83c){return error(_0x4ab83c,_0x3ff290(0x1e5)+'n]\x20listCon'+_0x3ff290(0x125)+_0x3ff290(0x218)+_0x3ff290(0x14b)+(_0x4ab83c?.[_0x3ff290(0x28a)]||_0x4ab83c)),[];}}export async function listConnectionsForUser(_0x46ed77,_0x14179a=null){const _0x2e2a7b=_0xc507e3;try{await ensureSchema();const _0x5f2908=await getDb();if(_0x14179a){const _0x629def=await _0x5f2908[_0x2e2a7b(0x1ae)](_0x2e2a7b(0x178)+_0x2e2a7b(0x1ab)+_0x2e2a7b(0x167)+_0x2e2a7b(0x1d9)+_0x2e2a7b(0x1b7)+_0x2e2a7b(0x1f4)+_0x2e2a7b(0x188)+_0x2e2a7b(0x206)+_0x2e2a7b(0x194)+_0x2e2a7b(0x28d)+'e',[String(_0x46ed77),String(_0x14179a)]);return(_0x629def||[])[_0x2e2a7b(0x19e)](_0x2caaa3=>({'name':_0x2caaa3['name'],'chat_id':parseArrayStrict(_0x2caaa3[_0x2e2a7b(0x1dd)]),'creator_id':_0x2caaa3[_0x2e2a7b(0x257)]}));}else{const _0x202d53=await _0x5f2908[_0x2e2a7b(0x1ae)](_0x2e2a7b(0x178)+'e,\x20chat_id'+',\x20creator_'+'id,\x20group_'+_0x2e2a7b(0x1d9)+_0x2e2a7b(0x1b7)+_0x2e2a7b(0x1f4)+'tor_id\x20=\x20?'+_0x2e2a7b(0x219)+_0x2e2a7b(0x18a)+_0x2e2a7b(0x21c),[String(_0x46ed77)]);return(_0x202d53||[])['map'](_0x5595ca=>({'name':_0x5595ca[_0x2e2a7b(0x21c)],'chat_id':parseArrayStrict(_0x5595ca[_0x2e2a7b(0x1dd)]),'creator_id':_0x5595ca[_0x2e2a7b(0x257)],'group_id':_0x5595ca[_0x2e2a7b(0x1d8)]}));}}catch(_0x4567f9){return error(_0x4567f9,_0x2e2a7b(0x1e5)+'n]\x20listCon'+'nectionsFo'+'rUser\x20fail'+'ed'),[];}}export async function listAllConnections(){const _0x4725cc=_0xc507e3;try{await ensureSchema();const _0x5b655a=await getDb(),_0x2ac964=await _0x5b655a[_0x4725cc(0x1ae)](_0x4725cc(0x178)+_0x4725cc(0x1ab)+_0x4725cc(0x167)+'id,\x20group_'+_0x4725cc(0x1d9)+_0x4725cc(0x1b7)+'ORDER\x20BY\x20g'+'roup_id,\x20n'+_0x4725cc(0x14f));return(_0x2ac964||[])[_0x4725cc(0x19e)](_0x32be5a=>({'name':_0x32be5a[_0x4725cc(0x21c)],'chat_id':parseArrayStrict(_0x32be5a[_0x4725cc(0x1dd)]),'creator_id':_0x32be5a['creator_id'],'group_id':_0x32be5a[_0x4725cc(0x1d8)]}));}catch(_0x139816){return error(_0x139816,_0x4725cc(0x1e5)+_0x4725cc(0x1f6)+_0x4725cc(0x197)+_0x4725cc(0x290)),[];}}export async function getConnectionScoped(_0x48e02f,_0xd5bf27=''){const _0x1008ba=_0xc507e3;try{await ensureSchema();const _0x9affb1=String(_0xd5bf27||'');if(connectionsCache[_0x1008ba(0x191)](_0x9affb1)&&connectionsCache[_0x1008ba(0x250)](_0x9affb1)[_0x1008ba(0x191)](String(_0x48e02f)))return connectionsCache[_0x1008ba(0x250)](_0x9affb1)['get'](String(_0x48e02f))[_0x1008ba(0x1dd)][_0x1008ba(0x18b)]();const _0x45cf10=await getDb(),_0x525354=await _0x45cf10[_0x1008ba(0x250)](_0x1008ba(0x254)+_0x1008ba(0x1f2)+'connection'+_0x1008ba(0x166)+_0x1008ba(0x1fb)+_0x1008ba(0x169)+_0x1008ba(0x1a7),[String(_0x48e02f),_0x9affb1]);if(!_0x525354)return null;return parseArrayStrict(_0x525354[_0x1008ba(0x1dd)]);}catch(_0x54902e){return error(_0x54902e,_0x1008ba(0x1e5)+'n]\x20getConn'+_0x1008ba(0x189)+_0x1008ba(0x287)+_0x48e02f+'\x20@\x20'+_0xd5bf27+')\x20failed'),null;}}export async function getConnectionRecordScoped(_0x181dbb,_0x426886=''){const _0x5566f9=_0xc507e3;try{await ensureSchema();const _0x528e75=String(_0x426886||'');if(connectionsCache[_0x5566f9(0x191)](_0x528e75)&&connectionsCache[_0x5566f9(0x250)](_0x528e75)[_0x5566f9(0x191)](String(_0x181dbb))){const _0xde6196=connectionsCache[_0x5566f9(0x250)](_0x528e75)[_0x5566f9(0x250)](String(_0x181dbb));return{'name':_0xde6196[_0x5566f9(0x21c)],'chat_id':_0xde6196[_0x5566f9(0x1dd)][_0x5566f9(0x18b)](),'creator_id':_0xde6196[_0x5566f9(0x257)]};}const _0xe1fd3=await getDb(),_0x5379c2=await _0xe1fd3[_0x5566f9(0x250)](_0x5566f9(0x178)+_0x5566f9(0x1ab)+_0x5566f9(0x167)+_0x5566f9(0x1d9)+_0x5566f9(0x1b7)+_0x5566f9(0x23a)+_0x5566f9(0x1f9)+'roup_id\x20=\x20'+'?',[String(_0x181dbb),_0x528e75]);if(!_0x5379c2)return null;return{'name':_0x5379c2[_0x5566f9(0x21c)],'chat_id':parseArrayStrict(_0x5379c2[_0x5566f9(0x1dd)]),'creator_id':_0x5379c2[_0x5566f9(0x257)]};}catch(_0x456e85){return error(_0x456e85,_0x5566f9(0x1e5)+_0x5566f9(0x173)+_0x5566f9(0x19b)+_0x5566f9(0x224)+_0x181dbb+'\x20@\x20'+_0x426886+_0x5566f9(0x1e7)),null;}}export async function getConnectionName(_0x307bb6){const _0x3d765d=_0xc507e3;try{await ensureSchema();for(const [_0x31d3ac,_0x25833e]of connectionsCache['entries']()){for(const [_0x2f3f7a,_0x5e853]of _0x25833e[_0x3d765d(0x16b)]()){if(Array[_0x3d765d(0x26f)](_0x5e853[_0x3d765d(0x1dd)])&&_0x5e853[_0x3d765d(0x1dd)][_0x3d765d(0x272)](String(_0x307bb6)))return _0x2f3f7a;}}const _0x4bdd2c=await getDb(),_0x2240e2=await _0x4bdd2c['all'](_0x3d765d(0x178)+_0x3d765d(0x1ab)+_0x3d765d(0x12b)+_0x3d765d(0x288));for(const _0x2b7750 of _0x2240e2||[]){const _0x3b1160=parseArrayStrict(_0x2b7750[_0x3d765d(0x1dd)]);if(_0x3b1160[_0x3d765d(0x272)](String(_0x307bb6)))return _0x2b7750[_0x3d765d(0x21c)];}return null;}catch(_0x33c4c4){return error(_0x33c4c4,'[connectio'+_0x3d765d(0x173)+'ectionName'+'('+_0x307bb6+')\x20failed'),null;}}export async function setDefaultGroup(_0x1007c8,_0x38cd5c){const _0x3694a2=_0xc507e3;try{await ensureSchema();const _0x5887c1=await getDb();if(!_0x38cd5c)throw new Error(_0x3694a2(0x15d)+'quired\x20for'+_0x3694a2(0x172)+_0x3694a2(0x158));if(!_0x1007c8||Array[_0x3694a2(0x26f)](_0x1007c8)&&_0x1007c8[_0x3694a2(0x1c2)]===-0x300+0x23*0xaf+-0x14ed)return await _0x5887c1['run'](_0x3694a2(0x202)+_0x3694a2(0x1fe)+'faults\x20WHE'+'RE\x20group_i'+_0x3694a2(0x11f),[String(_0x38cd5c)]),groupDefaultsCache[_0x3694a2(0x1f5)](String(_0x38cd5c)),info(_0x3694a2(0x1e5)+'n]\x20group\x20d'+_0x3694a2(0x1d0)+_0x3694a2(0x171)+_0x38cd5c),!![];let _0x41240a=[];if(typeof _0x1007c8===_0x3694a2(0x1b9)&&_0x1007c8[_0x3694a2(0x176)+'e']()===_0x3694a2(0x1ae)){const _0x2459f9=await listConnectionsForGroup(String(_0x38cd5c));_0x41240a=(_0x2459f9||[])[_0x3694a2(0x19e)](_0x18820d=>_0x18820d[_0x3694a2(0x21c)])['filter'](Boolean);if(!_0x41240a[_0x3694a2(0x1c2)])throw new Error('No\x20connect'+_0x3694a2(0x1c7)+_0x3694a2(0x164)+_0x3694a2(0x187));}else{if(Array['isArray'](_0x1007c8))_0x41240a=_0x1007c8[_0x3694a2(0x19e)](String)[_0x3694a2(0x233)](Boolean);else{if(typeof _0x1007c8===_0x3694a2(0x1b9)){if(_0x1007c8['includes'](','))_0x41240a=_0x1007c8[_0x3694a2(0x148)](',')[_0x3694a2(0x19e)](_0xfcb1c=>_0xfcb1c[_0x3694a2(0x153)]())[_0x3694a2(0x233)](Boolean);else _0x41240a=[_0x1007c8];}else throw new Error(_0x3694a2(0x26e)+_0x3694a2(0x1de)+_0x3694a2(0x244)+_0x3694a2(0x17c)+'aultGroup');}}if(!_0x41240a['length'])throw new Error('No\x20valid\x20c'+_0x3694a2(0x135)+'names\x20prov'+_0x3694a2(0x230)+'etDefaultG'+'roup');const _0x252bad=[];for(const _0x417072 of _0x41240a){const _0x4a9bbb=await _0x5887c1['get'](_0x3694a2(0x255)+_0x3694a2(0x18d)+_0x3694a2(0x1be)+'E\x20name\x20=\x20?'+_0x3694a2(0x206)+_0x3694a2(0x21e),[String(_0x417072),String(_0x38cd5c)]);if(_0x4a9bbb)_0x252bad['push'](_0x417072);else warn(_0x3694a2(0x1e5)+_0x3694a2(0x22a)+_0x3694a2(0x205)+_0x3694a2(0x259)+_0x3694a2(0x13b)+_0x3694a2(0x296)+_0x3694a2(0x239)+_0x417072+'\x22\x20in\x20'+_0x38cd5c);}if(!_0x252bad[_0x3694a2(0x1c2)])throw new Error(_0x3694a2(0x281)+_0x3694a2(0x1a8)+_0x3694a2(0x17f)+'n\x20names\x20ex'+_0x3694a2(0x1ea)+_0x3694a2(0x175));return await _0x5887c1[_0x3694a2(0x216)](_0x3694a2(0x19d)+_0x3694a2(0x1a1)+_0x3694a2(0x245)+_0x3694a2(0x209)+_0x3694a2(0x162)+_0x3694a2(0x26c)+_0x3694a2(0x265)+_0x3694a2(0x198)+_0x3694a2(0x165)+_0x3694a2(0x136)+_0x3694a2(0x181)+_0x3694a2(0x1c9)+'e;',[String(_0x38cd5c),JSON[_0x3694a2(0x1c6)](_0x252bad)]),groupDefaultsCache[_0x3694a2(0x25a)](String(_0x38cd5c),_0x252bad[_0x3694a2(0x18b)]()),info(_0x3694a2(0x1e5)+_0x3694a2(0x170)+_0x3694a2(0x26b)+_0x3694a2(0x23c)+_0x38cd5c+'\x20->\x20'+JSON[_0x3694a2(0x1c6)](_0x252bad)),!![];}catch(_0x8a9f65){return error(_0x8a9f65,_0x3694a2(0x1e5)+_0x3694a2(0x22a)+_0x3694a2(0x27a)+_0x3694a2(0x159)+_0x38cd5c+':\x20'+(_0x8a9f65?.['message']||_0x8a9f65)),![];}}export async function getDefaultForGroup(_0x2501ab){const _0x16b86f=_0xc507e3;try{await ensureSchema();if(!_0x2501ab)return null;const _0x33618f=String(_0x2501ab);if(groupDefaultsCache['has'](_0x33618f)){const _0x6cb696=groupDefaultsCache[_0x16b86f(0x250)](_0x33618f);return Array[_0x16b86f(0x26f)](_0x6cb696)?_0x6cb696[_0x16b86f(0x19e)](String):null;}const _0x38ee45=await getDb(),_0xe9f374=await _0x38ee45[_0x16b86f(0x250)](_0x16b86f(0x178)+_0x16b86f(0x12d)+'up_default'+_0x16b86f(0x15c)+_0x16b86f(0x196),[_0x33618f]);if(!_0xe9f374||!_0xe9f374[_0x16b86f(0x21c)])return null;try{const _0x3e0cc9=JSON['parse'](_0xe9f374['name']);if(Array[_0x16b86f(0x26f)](_0x3e0cc9))return groupDefaultsCache['set'](_0x33618f,_0x3e0cc9[_0x16b86f(0x19e)](String)),_0x3e0cc9['map'](String);}catch(_0x5d5846){}return null;}catch(_0x14d8c2){return error(_0x14d8c2,_0x16b86f(0x1e5)+_0x16b86f(0x1e0)+_0x16b86f(0x203)+_0x16b86f(0x14e)+'or\x20'+_0x2501ab),null;}}export async function getDefault(_0xf10c8){const _0x314815=_0xc507e3;try{await ensureSchema();const _0x1ae085=getActiveGroupForUser(String(_0xf10c8));if(!_0x1ae085)return null;return await getDefaultForGroup(_0x1ae085);}catch(_0x1d6456){return error(_0x1d6456,'[connectio'+_0x314815(0x1e0)+_0x314815(0x17d)+'\x20for\x20'+_0xf10c8),null;}}export async function getConnection(_0x16acf0){const _0x23119f=_0xc507e3;try{await ensureSchema();const _0x323655=await getDb(),_0x543fc6=await _0x323655['all'](_0x23119f(0x254)+'t_id\x20FROM\x20'+_0x23119f(0x26a)+_0x23119f(0x166)+_0x23119f(0x1bc),[String(_0x16acf0)]);if(!_0x543fc6||!_0x543fc6[_0x23119f(0x1c2)])return null;const _0x40c86c=[];for(const _0x4f30f0 of _0x543fc6){const _0xc88d8c=parseArrayStrict(_0x4f30f0[_0x23119f(0x1dd)]);for(const _0x32b7ac of _0xc88d8c)if(!_0x40c86c[_0x23119f(0x272)](_0x32b7ac))_0x40c86c[_0x23119f(0x11c)](_0x32b7ac);}return _0x40c86c;}catch(_0x5cfb04){return error(_0x5cfb04,_0x23119f(0x1e5)+_0x23119f(0x173)+_0x23119f(0x11e)+_0x16acf0+_0x23119f(0x1e7)),null;}}export async function getConnectionRecord(_0x8ba17){const _0x83a25=_0xc507e3;try{await ensureSchema();const _0x312ab2=await getDb(),_0x24b9cb=await _0x312ab2[_0x83a25(0x250)](_0x83a25(0x178)+_0x83a25(0x1ab)+_0x83a25(0x167)+_0x83a25(0x1dc)+_0x83a25(0x1d9)+_0x83a25(0x1b7)+_0x83a25(0x23a)+'\x20=\x20?\x20LIMIT'+'\x201',[String(_0x8ba17)]);if(!_0x24b9cb)return null;return{'name':_0x24b9cb['name'],'chat_id':parseArrayStrict(_0x24b9cb[_0x83a25(0x1dd)]),'creator_id':_0x24b9cb[_0x83a25(0x257)],'group_id':_0x24b9cb[_0x83a25(0x1d8)]};}catch(_0x38227d){return error(_0x38227d,_0x83a25(0x1e5)+_0x83a25(0x173)+_0x83a25(0x19b)+_0x83a25(0x28f)+_0x8ba17+_0x83a25(0x1e7)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};