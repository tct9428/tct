const _0x112b85=_0x4d87;(function(_0x149953,_0xe70a16){const _0x5db77d=_0x4d87,_0x60dc31=_0x149953();while(!![]){try{const _0x4cdd17=parseInt(_0x5db77d(0x262))/(0x5*-0x4cc+0x1bb3*0x1+-0x3b6)*(-parseInt(_0x5db77d(0x155))/(0x2*0x453+-0x37+-0x86d))+parseInt(_0x5db77d(0x274))/(-0x4*0x378+-0x793*-0x1+0x650)+-parseInt(_0x5db77d(0x226))/(0x202*-0xb+-0x1d2*0x9+0x267c)*(-parseInt(_0x5db77d(0x1e9))/(-0xf*-0x109+0x20af*-0x1+0x112d))+parseInt(_0x5db77d(0x1e7))/(0x1*0x137c+0x1*0x998+-0x2*0xe87)*(-parseInt(_0x5db77d(0x160))/(0x264b*-0x1+0x20f2+0x560))+parseInt(_0x5db77d(0x164))/(-0x3e8+0x102+0x2ee)+-parseInt(_0x5db77d(0x2c0))/(-0x1f6*-0x11+0xf*0x1b3+0x19*-0x25a)*(-parseInt(_0x5db77d(0x2a9))/(-0x68c+0x19a2+-0x1*0x130c))+-parseInt(_0x5db77d(0x287))/(0x9*0x20b+0x2*0x35+-0x12c2);if(_0x4cdd17===_0xe70a16)break;else _0x60dc31['push'](_0x60dc31['shift']());}catch(_0x1d87ea){_0x60dc31['push'](_0x60dc31['shift']());}}}(_0x15ea,-0x63c8*0x14+0x3f59f+-0xa67*-0x10f));import{info as _0x6f4501,warn as _0x54b40d,error as _0x14b15b}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x112b85(0x1af)+_0x112b85(0x1cf);function info(..._0x586c4e){const _0x373ca2=_0x112b85;try{_0x6f4501(..._0x586c4e);}catch(_0x389bfc){console[_0x373ca2(0x1bb)]('[INFO]',..._0x586c4e);}}function warn(..._0x248389){const _0x553f0d=_0x112b85;try{_0x54b40d(..._0x248389);}catch(_0x579fba){console[_0x553f0d(0x2ad)](_0x553f0d(0x1fc),..._0x248389);}}function error(..._0x143b9e){const _0x1e6073=_0x112b85;try{_0x14b15b(..._0x143b9e);}catch(_0x526a82){console['error'](_0x1e6073(0x276),..._0x143b9e);}}async function getDb(){const _0x133c98=_0x112b85;if(db&&typeof db[_0x133c98(0x1a5)]===_0x133c98(0x1ad))return db;try{const _0x2abc1e=await import('./database.js');if(_0x2abc1e&&_0x2abc1e['db'])return db=_0x2abc1e['db'],db;throw new Error(_0x133c98(0x21f)+_0x133c98(0x1e6)+_0x133c98(0x2bd)+'\x20{\x20db\x20}');}catch(_0xb0a137){error(_0xb0a137,'[connectio'+'n]\x20failed\x20'+_0x133c98(0x1f5)+_0x133c98(0x1dc)+'s');throw _0xb0a137;}}function safeParseJSON(_0x45e26b){const _0x10c93d=_0x112b85;try{return JSON[_0x10c93d(0x27c)](_0x45e26b);}catch(_0x596712){return null;}}function asArrayStrict(_0x4b3be8){const _0x27381e=_0x112b85;if(_0x4b3be8===null||_0x4b3be8===undefined)return[];if(typeof _0x4b3be8==='string'){const _0x169206=safeParseJSON(_0x4b3be8);if(Array[_0x27381e(0x2bf)](_0x169206))return _0x169206[_0x27381e(0x235)](String);return[_0x4b3be8];}if(Array[_0x27381e(0x2bf)](_0x4b3be8))return _0x4b3be8['map'](String);return[String(_0x4b3be8)];}function toJSONString(_0x6b2039){const _0x8e471b=_0x112b85;return JSON[_0x8e471b(0x277)](Array[_0x8e471b(0x2bf)](_0x6b2039)?_0x6b2039[_0x8e471b(0x235)](String):[]);}async function tableExists(_0x48818c){const _0x4fb7a6=_0x112b85,_0x184cdb=await getDb(),_0x2a0dd7=await _0x184cdb[_0x4fb7a6(0x2ac)]('SELECT\x20nam'+'e\x20FROM\x20sql'+_0x4fb7a6(0x29c)+_0x4fb7a6(0x18a)+_0x4fb7a6(0x2b9)+'AND\x20name\x20='+'\x20?',[String(_0x48818c)]);return!!_0x2a0dd7;}async function columnExists(_0x1b1f87,_0x1c7850){const _0x169118=_0x112b85;try{const _0x355c27=await getDb(),_0x453962=await _0x355c27[_0x169118(0x299)](_0x169118(0x18c)+_0x169118(0x1e2)+_0x1b1f87+')');if(!Array[_0x169118(0x2bf)](_0x453962))return![];return _0x453962[_0x169118(0x1c9)](_0x4a211b=>String(_0x4a211b[_0x169118(0x22f)])[_0x169118(0x156)+'e']()===String(_0x1c7850)[_0x169118(0x156)+'e']());}catch(_0x29eca0){return warn(_0x169118(0x1a4)+_0x169118(0x28d)+_0x169118(0x153)+_0x169118(0x279)+_0x169118(0x1ea)+_0x1b1f87+'.'+_0x1c7850+':\x20'+(_0x29eca0?.['message']||_0x29eca0)),![];}}async function ensureConnectionsTable(){const _0x735b09=_0x112b85,_0x174dfa=await getDb(),_0x43cba6=await tableExists(_0x735b09(0x23a)+'s');if(!_0x43cba6){await _0x174dfa[_0x735b09(0x1a5)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x735b09(0x20d)+_0x735b09(0x256)+_0x735b09(0x17d)+_0x735b09(0x1ff)+'\x20\x20\x20\x20\x20\x20name'+_0x735b09(0x189)+_0x735b09(0x207)+_0x735b09(0x1f6)+_0x735b09(0x2b5)+_0x735b09(0x1c4)+_0x735b09(0x1ba)+'_id\x20TEXT\x20N'+_0x735b09(0x20b)+_0x735b09(0x14b)+_0x735b09(0x187)+_0x735b09(0x29b)+_0x735b09(0x18d)+_0x735b09(0x175)+_0x735b09(0x1ee)+_0x735b09(0x1cd)+_0x735b09(0x257)+_0x735b09(0x182)),info('[connectio'+_0x735b09(0x26f)+'\x20table\x20con'+'nections\x20('+_0x735b09(0x1ef)+_0x735b09(0x26a));return;}const _0x521e77=await columnExists(_0x735b09(0x23a)+'s',_0x735b09(0x1ce)),_0x2c4e6d=await columnExists(_0x735b09(0x23a)+'s',_0x735b09(0x1f4)),_0xdb7482=await columnExists(_0x735b09(0x23a)+'s',_0x735b09(0x1b9));if(!_0x2c4e6d||!_0xdb7482||!_0x521e77)try{await _0x174dfa[_0x735b09(0x1a5)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+'REATE\x20TABL'+'E\x20IF\x20NOT\x20E'+'XISTS\x20conn'+_0x735b09(0x27e)+_0x735b09(0x1b0)+_0x735b09(0x2a7)+_0x735b09(0x1d4)+_0x735b09(0x151)+_0x735b09(0x1f6)+_0x735b09(0x2b5)+_0x735b09(0x1b5)+_0x735b09(0x1dd)+_0x735b09(0x163)+_0x735b09(0x2a2)+'T\x20NOT\x20NULL'+_0x735b09(0x18b)+_0x735b09(0x2cb)+_0x735b09(0x25b)+_0x735b09(0x252)+_0x735b09(0x2ab)+'DEFAULT\x20\x27\x27'+_0x735b09(0x14f)+_0x735b09(0x1bf)+_0x735b09(0x289)+_0x735b09(0x21d)+_0x735b09(0x218)+';\x0a\x20\x20\x20\x20\x20\x20');try{const _0x1c3c52=await _0x174dfa['all'](_0x735b09(0x1fb)+_0x735b09(0x1c6)+_0x735b09(0x2b1)+'id\x20FROM\x20co'+_0x735b09(0x22c));if(Array['isArray'](_0x1c3c52)&&_0x1c3c52['length'])for(const _0x3d24d2 of _0x1c3c52){const _0x35e2a1=_0x3d24d2[_0x735b09(0x22f)],_0x4cd204=typeof _0x3d24d2['chat_id']===_0x735b09(0x1be)||_0x3d24d2['chat_id']===null?'[]':_0x3d24d2[_0x735b09(0x1f4)],_0x16e5b9=typeof _0x3d24d2[_0x735b09(0x1b9)]===_0x735b09(0x1be)||_0x3d24d2[_0x735b09(0x1b9)]===null?'':_0x3d24d2[_0x735b09(0x1b9)];try{await _0x174dfa[_0x735b09(0x2bb)](_0x735b09(0x288)+_0x735b09(0x2c2)+_0x735b09(0x16b)+_0x735b09(0x165)+_0x735b09(0x1ef)+'p_id,\x20chat'+_0x735b09(0x294)+'or_id)\x20VAL'+'UES\x20(?,\x20?,'+_0x735b09(0x222),[_0x35e2a1,'',_0x4cd204,_0x16e5b9]);}catch(_0x2bb71c){warn(_0x735b09(0x1a4)+_0x735b09(0x258)+_0x735b09(0x1de)+_0x735b09(0x16c)+_0x735b09(0x27e)+'w\x20failed\x20f'+_0x735b09(0x1ea)+_0x35e2a1+':\x20'+(_0x2bb71c?.[_0x735b09(0x177)]||_0x2bb71c));}}}catch(_0x4d8173){warn('[connectio'+'n][migrati'+_0x735b09(0x22a)+_0x735b09(0x281)+_0x735b09(0x242)+(_0x4d8173?.['message']||_0x4d8173));}try{await _0x174dfa[_0x735b09(0x1a5)](_0x735b09(0x1aa)+_0x735b09(0x24e)+_0x735b09(0x176)+_0x735b09(0x280));}catch(_0x36b5a9){}await _0x174dfa[_0x735b09(0x1a5)]('ALTER\x20TABL'+_0x735b09(0x212)+_0x735b09(0x15b)+_0x735b09(0x26b)+_0x735b09(0x15e)),info(_0x735b09(0x1a4)+'n]\x20migrate'+'d\x20connecti'+'ons\x20->\x20con'+_0x735b09(0x19e)+'with\x20group'+_0x735b09(0x295));}catch(_0x8e3ce1){warn(_0x735b09(0x1a4)+_0x735b09(0x181)+'on\x20to\x20new\x20'+_0x735b09(0x23a)+_0x735b09(0x268)+_0x735b09(0x236)+(_0x8e3ce1?.[_0x735b09(0x177)]||_0x8e3ce1));if(!_0x2c4e6d)try{await _0x174dfa['exec'](_0x735b09(0x2c7)+_0x735b09(0x212)+'ons\x20ADD\x20CO'+'LUMN\x20chat_'+'id\x20TEXT\x20NO'+'T\x20NULL\x20DEF'+_0x735b09(0x190)),info('[connectio'+_0x735b09(0x215)+_0x735b09(0x253)+_0x735b09(0x221)+'n');}catch(_0x2974e5){warn(_0x2974e5,_0x735b09(0x1a4)+'n]\x20failed\x20'+_0x735b09(0x21c)+_0x735b09(0x150));}if(!_0xdb7482)try{await _0x174dfa[_0x735b09(0x1a5)](_0x735b09(0x2c7)+_0x735b09(0x212)+'ons\x20ADD\x20CO'+_0x735b09(0x1f8)+_0x735b09(0x252)+_0x735b09(0x2ab)+_0x735b09(0x271)+';'),info('[connectio'+_0x735b09(0x215)+_0x735b09(0x1cb)+'ator_id\x20co'+_0x735b09(0x201));}catch(_0x2e8bb4){warn(_0x2e8bb4,'[connectio'+_0x735b09(0x2aa)+_0x735b09(0x1a9)+'ator_id');}if(!_0x521e77)try{await _0x174dfa[_0x735b09(0x1a5)]('ALTER\x20TABL'+_0x735b09(0x212)+_0x735b09(0x265)+_0x735b09(0x15a)+_0x735b09(0x243)+'OT\x20NULL\x20DE'+_0x735b09(0x1b4)),info('[connectio'+_0x735b09(0x215)+'issing\x20gro'+_0x735b09(0x2a1)+'mn');}catch(_0x2f2d49){warn(_0x2f2d49,_0x735b09(0x1a4)+_0x735b09(0x2aa)+_0x735b09(0x2ba)+_0x735b09(0x1fd));}}}async function ensureGroupDefaultsTable(){const _0x4ed2d5=_0x112b85,_0x4a80b0=await getDb(),_0x256856=await tableExists(_0x4ed2d5(0x283)+_0x4ed2d5(0x20a));if(!_0x256856){await _0x4a80b0['exec']('\x0a\x20\x20\x20\x20\x20\x20CRE'+'ATE\x20TABLE\x20'+_0x4ed2d5(0x256)+_0x4ed2d5(0x25c)+_0x4ed2d5(0x1d6)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20g'+'roup_id\x20TE'+_0x4ed2d5(0x1b2)+_0x4ed2d5(0x14c)+_0x4ed2d5(0x2a7)+_0x4ed2d5(0x1d4)+_0x4ed2d5(0x173)+';\x0a\x20\x20\x20\x20'),info('[connectio'+_0x4ed2d5(0x26f)+_0x4ed2d5(0x269)+_0x4ed2d5(0x15f)+'s');return;}!await columnExists(_0x4ed2d5(0x283)+_0x4ed2d5(0x20a),'group_id')&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x2f4bcb=_0x112b85,_0x3e93eb=await getDb();try{await _0x3e93eb['exec'](_0x2f4bcb(0x2c7)+_0x2f4bcb(0x255)+_0x2f4bcb(0x2a3)+'\x20COLUMN\x20gr'+_0x2f4bcb(0x29f)+_0x2f4bcb(0x158)+_0x2f4bcb(0x18b)+'\x27;'),await _0x3e93eb[_0x2f4bcb(0x1a5)](_0x2f4bcb(0x2c7)+_0x2f4bcb(0x255)+_0x2f4bcb(0x2a3)+_0x2f4bcb(0x219)+_0x2f4bcb(0x2a8)+_0x2f4bcb(0x1b5)+_0x2f4bcb(0x190));}catch(_0x4ce89f){warn('[connectio'+'n]\x20addGrou'+'pDefaultsC'+_0x2f4bcb(0x234)+_0x2f4bcb(0x264)+(_0x4ce89f?.[_0x2f4bcb(0x177)]||_0x4ce89f));}}async function ensureActiveGroupsTable(){const _0x279c00=_0x112b85,_0x487aba=await getDb(),_0x3729ad=await tableExists(ACTIVE_TABLE);!_0x3729ad&&(await _0x487aba['exec'](_0x279c00(0x1cc)+_0x279c00(0x20d)+_0x279c00(0x256)+_0x279c00(0x16f)+ACTIVE_TABLE+(_0x279c00(0x1b3)+_0x279c00(0x17f)+_0x279c00(0x1f0)+'RY\x20KEY,\x0a\x20\x20'+'\x20\x20\x20\x20\x20\x20grou'+_0x279c00(0x2b3)+_0x279c00(0x251)+_0x279c00(0x22e)+'\x20\x20')),info(_0x279c00(0x1a4)+'n]\x20created'+'\x20table\x20'+ACTIVE_TABLE));}function _0x4d87(_0x19f6bd,_0x25bb1e){const _0x442fd5=_0x15ea();return _0x4d87=function(_0x4f0499,_0x48b27e){_0x4f0499=_0x4f0499-(0x11ba+0x20*-0x16+0x1*-0xdaf);let _0x3640d6=_0x442fd5[_0x4f0499];return _0x3640d6;},_0x4d87(_0x19f6bd,_0x25bb1e);}async function migrateConnectionsChatIdToArray(){const _0x280323=_0x112b85;try{const _0x50465e=await getDb(),_0x5a49cf=await _0x50465e[_0x280323(0x299)](_0x280323(0x1fb)+'e,\x20group_i'+_0x280323(0x297)+_0x280323(0x171)+'ections');if(!_0x5a49cf||_0x5a49cf[_0x280323(0x1f2)]===-0x1*-0x19ab+-0x235a+0x9af)return;const _0x5a1c2a=[];for(const _0x4a2e59 of _0x5a49cf){const _0x407465=_0x4a2e59[_0x280323(0x1f4)],_0x4230c7=safeParseJSON(_0x407465);if(Array[_0x280323(0x2bf)](_0x4230c7)){const _0x520689=_0x4230c7['map'](String),_0x55c483=toJSONString(_0x520689);if(_0x55c483!==_0x407465)_0x5a1c2a['push']({'name':_0x4a2e59['name'],'group_id':_0x4a2e59[_0x280323(0x1ce)]||'','chat_id':_0x55c483});continue;}else{let _0x51f6fc=[];_0x407465===null||_0x407465===undefined||String(_0x407465)[_0x280323(0x23b)]()===''?_0x51f6fc=[]:_0x51f6fc=[String(_0x407465)];const _0x183cd6=toJSONString(_0x51f6fc);_0x5a1c2a[_0x280323(0x2a6)]({'name':_0x4a2e59[_0x280323(0x22f)],'group_id':_0x4a2e59[_0x280323(0x1ce)]||'','chat_id':_0x183cd6});}}if(_0x5a1c2a[_0x280323(0x1f2)]>-0x1aa3+-0x1340+0x2de3){try{await _0x50465e[_0x280323(0x1a5)](_0x280323(0x210)+_0x280323(0x28e));}catch(_0x3c80ab){}for(const _0x21fecb of _0x5a1c2a){try{await _0x50465e[_0x280323(0x2bb)](_0x280323(0x1d5)+'nections\x20S'+_0x280323(0x19c)+_0x280323(0x214)+'\x20name\x20=\x20?\x20'+'AND\x20group_'+'id\x20=\x20?',[_0x21fecb[_0x280323(0x1f4)],_0x21fecb[_0x280323(0x22f)],_0x21fecb[_0x280323(0x1ce)]]),info(_0x280323(0x1a4)+_0x280323(0x258)+_0x280323(0x229)+_0x280323(0x183)+_0x280323(0x174)+_0x21fecb[_0x280323(0x22f)]+('\x22\x20@\x20group\x20'+'\x22')+_0x21fecb['group_id']+'\x22');}catch(_0x11f692){warn(_0x280323(0x1a4)+_0x280323(0x258)+'on]\x20failed'+_0x280323(0x267)+_0x280323(0x206)+'or\x20'+_0x21fecb[_0x280323(0x22f)]+'@'+_0x21fecb[_0x280323(0x1ce)]+':\x20'+(_0x11f692?.['message']||_0x11f692));}}try{await _0x50465e[_0x280323(0x1a5)]('COMMIT;');}catch(_0x1f6ef2){}}}catch(_0x53ed53){warn(_0x280323(0x1a4)+_0x280323(0x258)+_0x280323(0x197)+_0x280323(0x1e3)+_0x280323(0x272)+_0x280323(0x1b6)+'ed:\x20'+(_0x53ed53?.[_0x280323(0x177)]||_0x53ed53));}}async function migrateGroupDefaultsNameToArray(){const _0x44c01b=_0x112b85;try{const _0x2e254d=await getDb(),_0x575b5a=await _0x2e254d['all']('SELECT\x20gro'+'up_id,\x20nam'+_0x44c01b(0x266)+'up_default'+'s');if(!_0x575b5a||_0x575b5a[_0x44c01b(0x1f2)]===-0x10c3*0x1+0xc14+-0x6d*-0xb)return;const _0x2f2654=[];for(const _0x15d164 of _0x575b5a){const _0x208bd5=_0x15d164['name'],_0x19c3c5=safeParseJSON(_0x208bd5);if(Array[_0x44c01b(0x2bf)](_0x19c3c5)){const _0x4a6811=toJSONString(_0x19c3c5);if(_0x4a6811!==_0x208bd5)_0x2f2654[_0x44c01b(0x2a6)]({'group_id':_0x15d164[_0x44c01b(0x1ce)],'name':_0x4a6811});continue;}else{const _0x192c49=_0x208bd5===null||_0x208bd5===undefined||String(_0x208bd5)[_0x44c01b(0x23b)]()===''?[]:[String(_0x208bd5)],_0x51f40b=toJSONString(_0x192c49);_0x2f2654[_0x44c01b(0x2a6)]({'group_id':_0x15d164[_0x44c01b(0x1ce)],'name':_0x51f40b});}}if(_0x2f2654[_0x44c01b(0x1f2)]>-0x25f0+0x267c+-0x8c){try{await _0x2e254d[_0x44c01b(0x1a5)](_0x44c01b(0x210)+_0x44c01b(0x28e));}catch(_0x4a675c){}for(const _0x37a070 of _0x2f2654){try{await _0x2e254d[_0x44c01b(0x2bb)](_0x44c01b(0x1ec)+'up_default'+_0x44c01b(0x213)+_0x44c01b(0x214)+_0x44c01b(0x25f)+_0x44c01b(0x28a),[_0x37a070['name'],_0x37a070[_0x44c01b(0x1ce)]]),info(_0x44c01b(0x1a4)+_0x44c01b(0x258)+_0x44c01b(0x229)+_0x44c01b(0x1d7)+_0x44c01b(0x249)+_0x44c01b(0x17b)+_0x37a070[_0x44c01b(0x1ce)]);}catch(_0x31b2d5){warn(_0x44c01b(0x1a4)+_0x44c01b(0x258)+_0x44c01b(0x204)+_0x44c01b(0x267)+_0x44c01b(0x223)+_0x44c01b(0x28f)+_0x37a070[_0x44c01b(0x1ce)]+':\x20'+(_0x31b2d5?.[_0x44c01b(0x177)]||_0x31b2d5));}}try{await _0x2e254d[_0x44c01b(0x1a5)](_0x44c01b(0x231));}catch(_0x11c85d){}}}catch(_0x3e14e6){warn(_0x44c01b(0x1a4)+_0x44c01b(0x258)+_0x44c01b(0x197)+_0x44c01b(0x28c)+_0x44c01b(0x1a7)+_0x44c01b(0x1b6)+_0x44c01b(0x1b1)+(_0x3e14e6?.[_0x44c01b(0x177)]||_0x3e14e6));}}function parseArrayStrict(_0x18c82c){const _0x49070f=_0x112b85;if(_0x18c82c===null||_0x18c82c===undefined)return[];if(typeof _0x18c82c===_0x49070f(0x1e1)){const _0x3a2925=safeParseJSON(_0x18c82c);if(Array['isArray'](_0x3a2925))return _0x3a2925[_0x49070f(0x235)](String);return[];}if(Array[_0x49070f(0x2bf)](_0x18c82c))return _0x18c82c[_0x49070f(0x235)](String);return[String(_0x18c82c)];}function stringifyArray(_0xef1a3){const _0x2d813c=_0x112b85;return JSON['stringify'](Array[_0x2d813c(0x2bf)](_0xef1a3)?_0xef1a3[_0x2d813c(0x235)](String):[]);}async function loadConnectionsCache(){const _0x3817e0=_0x112b85;try{const _0x4e1bbf=await getDb(),_0x404171=await _0x4e1bbf[_0x3817e0(0x299)](_0x3817e0(0x1fb)+_0x3817e0(0x1bd)+_0x3817e0(0x297)+_0x3817e0(0x2b1)+'id\x20FROM\x20co'+_0x3817e0(0x22c));connectionsCache['clear']();if(!_0x404171||!_0x404171[_0x3817e0(0x1f2)]){info(_0x3817e0(0x1a4)+_0x3817e0(0x282)+'ions\x20cache'+'\x20loaded\x20(0'+'\x20rows)');return;}for(const _0x310257 of _0x404171){const _0x27fa1c=String(_0x310257[_0x3817e0(0x1ce)]||'');if(!connectionsCache[_0x3817e0(0x247)](_0x27fa1c))connectionsCache[_0x3817e0(0x23f)](_0x27fa1c,new Map());const _0x3b3380=connectionsCache[_0x3817e0(0x2ac)](_0x27fa1c);_0x3b3380[_0x3817e0(0x23f)](String(_0x310257['name']),{'name':_0x310257[_0x3817e0(0x22f)],'chat_id':parseArrayStrict(_0x310257['chat_id']),'creator_id':_0x310257['creator_id']});}info('[connectio'+_0x3817e0(0x282)+_0x3817e0(0x24c)+_0x3817e0(0x1f3)+_0x404171['length']+_0x3817e0(0x191));}catch(_0x635950){warn(_0x3817e0(0x1a4)+_0x3817e0(0x2a4)+'nectionsCa'+_0x3817e0(0x224)+':\x20'+(_0x635950?.[_0x3817e0(0x177)]||_0x635950));}}async function loadGroupDefaultsCache(){const _0x3d5a9a=_0x112b85;try{const _0x6e6afa=await getDb(),_0xfadaf3=await _0x6e6afa['all']('SELECT\x20gro'+'up_id,\x20nam'+_0x3d5a9a(0x266)+_0x3d5a9a(0x15f)+'s');groupDefaultsCache[_0x3d5a9a(0x27a)]();if(!_0xfadaf3||!_0xfadaf3[_0x3d5a9a(0x1f2)]){info(_0x3d5a9a(0x1a4)+_0x3d5a9a(0x186)+_0x3d5a9a(0x1d8)+'che\x20loaded'+'\x20(0\x20rows)');return;}for(const _0x4bd5d0 of _0xfadaf3){try{const _0x562ba2=String(_0x4bd5d0[_0x3d5a9a(0x1ce)]),_0xb7b159=safeParseJSON(_0x4bd5d0[_0x3d5a9a(0x22f)]),_0x3c6b91=Array[_0x3d5a9a(0x2bf)](_0xb7b159)?_0xb7b159['map'](String):[];groupDefaultsCache[_0x3d5a9a(0x23f)](_0x562ba2,_0x3c6b91);}catch(_0x18ecb1){}}info(_0x3d5a9a(0x1a4)+'n]\x20group\x20d'+_0x3d5a9a(0x1d8)+_0x3d5a9a(0x1c0)+'\x20('+_0xfadaf3[_0x3d5a9a(0x1f2)]+_0x3d5a9a(0x191));}catch(_0x7e0ec4){warn('[connectio'+_0x3d5a9a(0x157)+_0x3d5a9a(0x1ae)+_0x3d5a9a(0x273)+_0x3d5a9a(0x1b1)+(_0x7e0ec4?.[_0x3d5a9a(0x177)]||_0x7e0ec4));}}async function loadActiveGroupsCache(){const _0x651305=_0x112b85;try{const _0x155dbc=await getDb(),_0x59244d=await _0x155dbc[_0x651305(0x299)](_0x651305(0x1d3)+_0x651305(0x168)+_0x651305(0x250)+'\x20'+ACTIVE_TABLE);activeGroupByUser['clear']();if(!_0x59244d||!_0x59244d['length']){info('[connectio'+'n]\x20active\x20'+_0x651305(0x24a)+_0x651305(0x29a)+_0x651305(0x2c6));return;}for(const _0xa1e5cd of _0x59244d){try{activeGroupByUser[_0x651305(0x23f)](String(_0xa1e5cd[_0x651305(0x290)]),String(_0xa1e5cd['group_id']));}catch(_0x51615e){}}info(_0x651305(0x1a4)+'n]\x20active\x20'+_0x651305(0x24a)+_0x651305(0x29a)+'('+_0x59244d[_0x651305(0x1f2)]+_0x651305(0x191));}catch(_0x535dff){warn(_0x651305(0x1a4)+_0x651305(0x240)+_0x651305(0x286)+_0x651305(0x162)+_0x651305(0x19a)+(_0x535dff?.[_0x651305(0x177)]||_0x535dff));}}export async function refreshCaches(){const _0xfbed4d=_0x112b85;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0xfbed4d(0x1a4)+_0xfbed4d(0x180)+_0xfbed4d(0x26e)+_0xfbed4d(0x298));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x3c16e5){const _0x3e469c=_0x112b85;if(!_0x3c16e5)return null;const _0x94635f=String(_0x3c16e5)[_0x3e469c(0x23b)]();if(!_0x94635f)return null;return _0x94635f[_0x3e469c(0x2a5)]('@')?_0x94635f[_0x3e469c(0x192)]('@')[-0x1a2c+0x1124+0x908]:_0x94635f;}export async function ensureSchema(){const _0x286aaa=_0x112b85;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info('[connectio'+'n]\x20schema\x20'+_0x286aaa(0x15d)+_0x286aaa(0x1ed)+'n\x20complete'+_0x286aaa(0x17a)+'nly,\x20group'+'-scoped).\x20'+_0x286aaa(0x1c2)+'ded.');}catch(_0x45a290){error(_0x45a290,_0x286aaa(0x1a4)+_0x286aaa(0x159)+_0x286aaa(0x248)+_0x286aaa(0x1b1)+(_0x45a290?.[_0x286aaa(0x177)]||_0x45a290));throw _0x45a290;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x45628e,_0x262e57){const _0x303fbd=_0x112b85;try{if(!_0x45628e)return;const _0x4e97e9=normalizeUserKeyForStorage(_0x45628e);if(!_0x4e97e9)return;if(!_0x262e57){activeGroupByUser[_0x303fbd(0x16d)](_0x4e97e9);try{const _0x3c41b4=await getDb();await _0x3c41b4['run']('DELETE\x20FRO'+'M\x20'+ACTIVE_TABLE+(_0x303fbd(0x1a0)+_0x303fbd(0x1a6)),[_0x4e97e9]);}catch(_0x31109b){warn('[connectio'+_0x303fbd(0x2aa)+_0x303fbd(0x1a2)+_0x303fbd(0x14e)+_0x303fbd(0x199)+_0x303fbd(0x1c3)+(_0x31109b?.[_0x303fbd(0x177)]||_0x31109b));}return;}const _0x4167aa=String(_0x262e57);activeGroupByUser[_0x303fbd(0x23f)](_0x4e97e9,_0x4167aa);try{const _0x46e362=await getDb();await _0x46e362[_0x303fbd(0x2bb)](_0x303fbd(0x16e)+'O\x20'+ACTIVE_TABLE+(_0x303fbd(0x1c5)+_0x303fbd(0x2b7)+_0x303fbd(0x16a)+_0x303fbd(0x20c)+_0x303fbd(0x1d2)+_0x303fbd(0x246)+_0x303fbd(0x1ac)+_0x303fbd(0x291)+_0x303fbd(0x1f1)+_0x303fbd(0x1f7)+_0x303fbd(0x245)+_0x303fbd(0x202)+'id'),[_0x4e97e9,_0x4167aa]);}catch(_0x42a0a2){warn(_0x303fbd(0x1a4)+_0x303fbd(0x2aa)+_0x303fbd(0x1a2)+_0x303fbd(0x14e)+'oup:\x20'+(_0x42a0a2?.[_0x303fbd(0x177)]||_0x42a0a2));}}catch(_0x544496){warn(_0x303fbd(0x1a4)+_0x303fbd(0x24f)+_0x303fbd(0x263)+'User\x20error'+':\x20'+(_0x544496?.[_0x303fbd(0x177)]||_0x544496));}}export function getActiveGroupForUser(_0x2596b1){const _0x2a0f36=_0x112b85;try{if(!_0x2596b1)return null;const _0x4aa33f=normalizeUserKeyForStorage(_0x2596b1);if(!_0x4aa33f)return null;return activeGroupByUser[_0x2a0f36(0x2ac)](_0x4aa33f)||null;}catch(_0x3b5b64){return warn('[connectio'+_0x2a0f36(0x1db)+'veGroupFor'+_0x2a0f36(0x19f)+':\x20'+(_0x3b5b64?.[_0x2a0f36(0x177)]||_0x3b5b64)),null;}}export async function addConnection(_0x3cd1d4,_0x41b223,_0xf403da='',_0x18f6bc=''){const _0x372d43=_0x112b85;try{await ensureSchema();const _0x9c47f4=await getDb(),_0x4ef096=String(_0x18f6bc||''),_0x10d627=await _0x9c47f4[_0x372d43(0x2ac)](_0x372d43(0x170)+'t_id\x20FROM\x20'+_0x372d43(0x23a)+_0x372d43(0x1c1)+_0x372d43(0x196)+_0x372d43(0x25f)+'=\x20?',[String(_0x3cd1d4),_0x4ef096]);if(!_0x10d627){const _0x294767=[String(_0x41b223)];await _0x9c47f4[_0x372d43(0x2bb)](_0x372d43(0x16e)+'O\x20connecti'+_0x372d43(0x167)+_0x372d43(0x211)+_0x372d43(0x22b)+_0x372d43(0x1b9)+_0x372d43(0x16a)+_0x372d43(0x1e0)+')',[String(_0x3cd1d4),_0x4ef096,stringifyArray(_0x294767),String(_0xf403da||'')]),info(_0x372d43(0x1a4)+_0x372d43(0x26f)+':\x20'+_0x3cd1d4+_0x372d43(0x239)+_0x41b223+_0x372d43(0x2c4)+_0xf403da+_0x372d43(0x1e8)+_0x4ef096);if(!connectionsCache['has'](_0x4ef096))connectionsCache[_0x372d43(0x23f)](_0x4ef096,new Map());const _0x32614d=connectionsCache[_0x372d43(0x2ac)](_0x4ef096);return _0x32614d[_0x372d43(0x23f)](String(_0x3cd1d4),{'name':String(_0x3cd1d4),'chat_id':_0x294767[_0x372d43(0x235)](String),'creator_id':String(_0xf403da||'')}),!![];}else{const _0x2aa82c=parseArrayStrict(_0x10d627[_0x372d43(0x1f4)]);if(!_0x2aa82c[_0x372d43(0x2a5)](String(_0x41b223)))_0x2aa82c[_0x372d43(0x2a6)](String(_0x41b223));await _0x9c47f4[_0x372d43(0x2bb)]('UPDATE\x20con'+'nections\x20S'+_0x372d43(0x19c)+_0x372d43(0x19b)+_0x372d43(0x20f)+_0x372d43(0x21e)+'e\x20=\x20?\x20AND\x20'+'group_id\x20='+'\x20?',[stringifyArray(_0x2aa82c),String(_0xf403da||''),String(_0x3cd1d4),_0x4ef096]),info('[connectio'+_0x372d43(0x233)+':\x20'+_0x3cd1d4+_0x372d43(0x239)+_0x2aa82c[_0x372d43(0x2b6)](',')+_0x372d43(0x169)+_0x4ef096);if(!connectionsCache['has'](_0x4ef096))connectionsCache[_0x372d43(0x23f)](_0x4ef096,new Map());const _0x5f1782=connectionsCache[_0x372d43(0x2ac)](_0x4ef096);return _0x5f1782[_0x372d43(0x23f)](String(_0x3cd1d4),{'name':String(_0x3cd1d4),'chat_id':_0x2aa82c[_0x372d43(0x235)](String),'creator_id':String(_0xf403da||'')}),!![];}}catch(_0x4dd76c){return error(_0x4dd76c,_0x372d43(0x1a4)+'n]\x20addConn'+'ection\x20fai'+_0x372d43(0x21b)+_0x3cd1d4+_0x372d43(0x1e5)+_0x18f6bc),![];}}export async function deleteConnectionScoped(_0x2cc1b8,_0x4f1d3c=''){const _0x5cda8d=_0x112b85;try{await ensureSchema();const _0x4a6418=await getDb(),_0x7c79ee=await _0x4a6418[_0x5cda8d(0x2bb)]('DELETE\x20FRO'+_0x5cda8d(0x293)+_0x5cda8d(0x200)+_0x5cda8d(0x261)+_0x5cda8d(0x2b4)+_0x5cda8d(0x254),[String(_0x2cc1b8),String(_0x4f1d3c||'')]),_0x488d53=_0x7c79ee&&(_0x7c79ee['changes']===undefined?!![]:!!_0x7c79ee[_0x5cda8d(0x1ab)]);info(_0x5cda8d(0x1a4)+_0x5cda8d(0x24d)+_0x5cda8d(0x194)+'coped:\x20'+_0x2cc1b8+_0x5cda8d(0x1e5)+_0x4f1d3c+'\x20(deleted='+_0x488d53+')');try{const _0x47d027=String(_0x4f1d3c||'');if(connectionsCache[_0x5cda8d(0x247)](_0x47d027)){const _0x50b1ab=connectionsCache[_0x5cda8d(0x2ac)](_0x47d027);if(_0x50b1ab)_0x50b1ab[_0x5cda8d(0x16d)](String(_0x2cc1b8));}}catch(_0x437547){}return _0x488d53;}catch(_0x322ead){return error(_0x322ead,_0x5cda8d(0x1a4)+_0x5cda8d(0x24d)+_0x5cda8d(0x194)+'coped\x20fail'+'ed:\x20'+_0x2cc1b8+_0x5cda8d(0x1e5)+_0x4f1d3c),![];}}export async function deleteConnectionsByCreatorInGroup(_0x1f3bd3,_0x1f2cac=''){const _0x4c9873=_0x112b85;try{await ensureSchema();const _0x21aa7b=await getDb(),_0x1ad523=await _0x21aa7b[_0x4c9873(0x2bb)]('DELETE\x20FRO'+_0x4c9873(0x293)+_0x4c9873(0x200)+_0x4c9873(0x1b9)+_0x4c9873(0x2cc)+_0x4c9873(0x296)+'?',[String(_0x1f3bd3),String(_0x1f2cac||'')]),_0x21fc81=_0x1ad523&&(_0x1ad523[_0x4c9873(0x1ab)]===undefined?!![]:_0x1ad523['changes'])||-0x1b4e+0x28*0xb2+-0x1*0x82;info(_0x4c9873(0x1a4)+_0x4c9873(0x24d)+_0x4c9873(0x27b)+_0x4c9873(0x275)+_0x4c9873(0x1b8)+_0x1f3bd3+'\x20@\x20'+_0x1f2cac+_0x4c9873(0x244)+_0x21fc81+')');try{const _0x5466f3=String(_0x1f2cac||'');if(connectionsCache[_0x4c9873(0x247)](_0x5466f3)){const _0x3f4251=connectionsCache[_0x4c9873(0x2ac)](_0x5466f3);for(const [_0x111478,_0x24b575]of Array['from'](_0x3f4251[_0x4c9873(0x14d)]())){if(String(_0x24b575[_0x4c9873(0x1b9)])===String(_0x1f3bd3))_0x3f4251[_0x4c9873(0x16d)](_0x111478);}}}catch(_0xe2a45f){}return _0x21fc81;}catch(_0x2c784e){return error(_0x2c784e,'[connectio'+_0x4c9873(0x24d)+_0x4c9873(0x27b)+_0x4c9873(0x275)+_0x4c9873(0x2b0)+'led:\x20'+(_0x2c784e?.[_0x4c9873(0x177)]||_0x2c784e)),0x295*-0xb+-0x14e*0xb+0x2ac1;}}export async function removeChatIdsFromConnectionScoped(_0x328f5c,_0x30a894,_0x22c6e4=''){const _0x4ff1ed=_0x112b85;try{if(!_0x328f5c)return![];await ensureSchema();const _0x406050=await getDb(),_0x21372d=await _0x406050[_0x4ff1ed(0x2ac)]('SELECT\x20cha'+_0x4ff1ed(0x26d)+_0x4ff1ed(0x23a)+_0x4ff1ed(0x1c1)+_0x4ff1ed(0x196)+_0x4ff1ed(0x25f)+_0x4ff1ed(0x28a),[String(_0x328f5c),String(_0x22c6e4||'')]);if(!_0x21372d)return![];const _0x2376b7=parseArrayStrict(_0x21372d[_0x4ff1ed(0x1f4)]),_0x5e3893=Array[_0x4ff1ed(0x2bf)](_0x30a894)?_0x30a894[_0x4ff1ed(0x235)](String):[String(_0x30a894)],_0x1d8261=_0x2376b7[_0x4ff1ed(0x161)](_0x4946a0=>!_0x5e3893[_0x4ff1ed(0x2a5)](_0x4946a0));if(_0x1d8261['length']===-0x24e7+-0x1571*-0x1+0xf76){await _0x406050[_0x4ff1ed(0x2bb)](_0x4ff1ed(0x172)+'M\x20connecti'+_0x4ff1ed(0x200)+_0x4ff1ed(0x261)+_0x4ff1ed(0x2b4)+_0x4ff1ed(0x254),[String(_0x328f5c),String(_0x22c6e4||'')]),info(_0x4ff1ed(0x1a4)+_0x4ff1ed(0x2b8)+_0x4ff1ed(0x2c9)+_0x4ff1ed(0x241)+_0x4ff1ed(0x228)+_0x4ff1ed(0x23e)+'entries\x20fo'+'r\x20'+_0x328f5c+_0x4ff1ed(0x1e5)+_0x22c6e4+(',\x20row\x20dele'+_0x4ff1ed(0x18f)));try{const _0x2aa9ad=String(_0x22c6e4||'');if(connectionsCache['has'](_0x2aa9ad))connectionsCache[_0x4ff1ed(0x2ac)](_0x2aa9ad)[_0x4ff1ed(0x16d)](String(_0x328f5c));}catch(_0x5d3766){}return!![];}else{await _0x406050['run'](_0x4ff1ed(0x1d5)+_0x4ff1ed(0x1d1)+_0x4ff1ed(0x19c)+'\x20=\x20?\x20WHERE'+_0x4ff1ed(0x1bc)+_0x4ff1ed(0x203)+_0x4ff1ed(0x2c3),[stringifyArray(_0x1d8261),String(_0x328f5c),String(_0x22c6e4||'')]),info(_0x4ff1ed(0x1a4)+_0x4ff1ed(0x2b8)+_0x4ff1ed(0x2c9)+_0x4ff1ed(0x241)+'Scoped:\x20'+_0x328f5c+'@'+_0x22c6e4+'\x20now\x20->\x20'+_0x1d8261[_0x4ff1ed(0x2b6)](','));try{const _0x5ef5e2=String(_0x22c6e4||'');if(!connectionsCache[_0x4ff1ed(0x247)](_0x5ef5e2))connectionsCache[_0x4ff1ed(0x23f)](_0x5ef5e2,new Map());connectionsCache['get'](_0x5ef5e2)[_0x4ff1ed(0x23f)](String(_0x328f5c),{'name':String(_0x328f5c),'chat_id':_0x1d8261[_0x4ff1ed(0x235)](String),'creator_id':connectionsCache[_0x4ff1ed(0x2ac)](_0x5ef5e2)['get'](String(_0x328f5c))?.['creator_id']||''});}catch(_0x332657){}return!![];}}catch(_0x3e2bd3){return error(_0x3e2bd3,'[connectio'+'n]\x20removeC'+_0x4ff1ed(0x2c9)+_0x4ff1ed(0x241)+_0x4ff1ed(0x185)+_0x4ff1ed(0x264)+(_0x3e2bd3?.[_0x4ff1ed(0x177)]||_0x3e2bd3)),![];}}export async function listConnectionsForGroup(_0x356d7a){const _0x46c1ca=_0x112b85;try{await ensureSchema();const _0x344d32=String(_0x356d7a||'');if(connectionsCache[_0x46c1ca(0x247)](_0x344d32)){const _0x151365=connectionsCache[_0x46c1ca(0x2ac)](_0x344d32);return Array['from'](_0x151365['values']())[_0x46c1ca(0x235)](_0xdd6c75=>({'name':_0xdd6c75[_0x46c1ca(0x22f)],'chat_id':Array['isArray'](_0xdd6c75[_0x46c1ca(0x1f4)])?_0xdd6c75[_0x46c1ca(0x1f4)][_0x46c1ca(0x235)](String):[],'creator_id':_0xdd6c75[_0x46c1ca(0x1b9)]}));}const _0x2254be=await getDb(),_0x556ae3=await _0x2254be[_0x46c1ca(0x299)](_0x46c1ca(0x1fb)+_0x46c1ca(0x1c6)+_0x46c1ca(0x2b1)+_0x46c1ca(0x208)+_0x46c1ca(0x1eb)+_0x46c1ca(0x238)+_0x46c1ca(0x26c)+'RDER\x20BY\x20na'+'me',[_0x344d32]);return(_0x556ae3||[])[_0x46c1ca(0x235)](_0x437abd=>({'name':_0x437abd[_0x46c1ca(0x22f)],'chat_id':parseArrayStrict(_0x437abd[_0x46c1ca(0x1f4)]),'creator_id':_0x437abd[_0x46c1ca(0x1b9)]}));}catch(_0xc3c80b){return error(_0xc3c80b,'[connectio'+_0x46c1ca(0x184)+_0x46c1ca(0x1d0)+_0x46c1ca(0x205)+'led:\x20'+(_0xc3c80b?.['message']||_0xc3c80b)),[];}}export async function listConnectionsForUser(_0x4b7ffb,_0xbb0d2f=null){const _0x38d219=_0x112b85;try{await ensureSchema();const _0xad6677=await getDb();if(_0xbb0d2f){const _0x2a0648=await _0xad6677[_0x38d219(0x299)](_0x38d219(0x1fb)+_0x38d219(0x1c6)+_0x38d219(0x2b1)+_0x38d219(0x208)+_0x38d219(0x1eb)+_0x38d219(0x29e)+'tor_id\x20=\x20?'+'\x20AND\x20group'+_0x38d219(0x1e4)+_0x38d219(0x19d)+'e',[String(_0x4b7ffb),String(_0xbb0d2f)]);return(_0x2a0648||[])['map'](_0x4fd5da=>({'name':_0x4fd5da[_0x38d219(0x22f)],'chat_id':parseArrayStrict(_0x4fd5da[_0x38d219(0x1f4)]),'creator_id':_0x4fd5da[_0x38d219(0x1b9)]}));}else{const _0x4a1db3=await _0xad6677[_0x38d219(0x299)]('SELECT\x20nam'+_0x38d219(0x1c6)+_0x38d219(0x2b1)+'id,\x20group_'+'id\x20FROM\x20co'+_0x38d219(0x1eb)+_0x38d219(0x29e)+'tor_id\x20=\x20?'+_0x38d219(0x260)+_0x38d219(0x209)+_0x38d219(0x22f),[String(_0x4b7ffb)]);return(_0x4a1db3||[])[_0x38d219(0x235)](_0x2a8301=>({'name':_0x2a8301['name'],'chat_id':parseArrayStrict(_0x2a8301[_0x38d219(0x1f4)]),'creator_id':_0x2a8301['creator_id'],'group_id':_0x2a8301[_0x38d219(0x1ce)]}));}}catch(_0x42796f){return error(_0x42796f,_0x38d219(0x1a4)+_0x38d219(0x184)+_0x38d219(0x1d0)+_0x38d219(0x216)+'ed'),[];}}export async function listAllConnections(){const _0x183a7c=_0x112b85;try{await ensureSchema();const _0x5c299a=await getDb(),_0x4fe782=await _0x5c299a[_0x183a7c(0x299)](_0x183a7c(0x1fb)+_0x183a7c(0x1c6)+_0x183a7c(0x2b1)+'id,\x20group_'+_0x183a7c(0x208)+_0x183a7c(0x1eb)+_0x183a7c(0x27d)+'roup_id,\x20n'+_0x183a7c(0x227));return(_0x4fe782||[])[_0x183a7c(0x235)](_0x2a840f=>({'name':_0x2a840f[_0x183a7c(0x22f)],'chat_id':parseArrayStrict(_0x2a840f[_0x183a7c(0x1f4)]),'creator_id':_0x2a840f[_0x183a7c(0x1b9)],'group_id':_0x2a840f['group_id']}));}catch(_0x483ecb){return error(_0x483ecb,_0x183a7c(0x1a4)+'n]\x20listAll'+'Connection'+_0x183a7c(0x1a3)),[];}}export async function getConnectionScoped(_0x3396bf,_0x526147=''){const _0x2a8d60=_0x112b85;try{await ensureSchema();const _0x2ec36b=String(_0x526147||'');if(connectionsCache['has'](_0x2ec36b)&&connectionsCache['get'](_0x2ec36b)['has'](String(_0x3396bf)))return connectionsCache[_0x2a8d60(0x2ac)](_0x2ec36b)[_0x2a8d60(0x2ac)](String(_0x3396bf))['chat_id'][_0x2a8d60(0x25a)]();const _0x1a36e5=await getDb(),_0x397a8c=await _0x1a36e5[_0x2a8d60(0x2ac)](_0x2a8d60(0x170)+_0x2a8d60(0x26d)+_0x2a8d60(0x23a)+_0x2a8d60(0x1c1)+'me\x20=\x20?\x20AND'+_0x2a8d60(0x25f)+'=\x20?',[String(_0x3396bf),_0x2ec36b]);if(!_0x397a8c)return null;return parseArrayStrict(_0x397a8c['chat_id']);}catch(_0x1f43f7){return error(_0x1f43f7,'[connectio'+'n]\x20getConn'+_0x2a8d60(0x24b)+_0x2a8d60(0x292)+_0x3396bf+'\x20@\x20'+_0x526147+_0x2a8d60(0x225)),null;}}function _0x15ea(){const _0x1cc24d=['\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','SELECT\x20use','EXT\x20NOT\x20NU','UPDATE\x20con','defaults\x20(','ized\x20group','efaults\x20ca','No\x20valid\x20c','quired\x20for','n]\x20getActi','database.j','AULT\x20\x27\x27,\x0a\x20','on]\x20insert','on\x20\x22','?,\x20?,\x20?,\x20?','string','le_info(','eConnectio','_id\x20=\x20?\x20OR','\x20@\x20','odule\x20did\x20','1387014sCAyMR',')\x20@\x20group=','65ezSYzK','or\x20','nnections\x20','UPDATE\x20gro','d\x20migratio','EY\x20(name,\x20','name,\x20grou','TEXT\x20PRIMA','DO\x20UPDATE\x20','length','\x20loaded\x20(','chat_id','to\x20import\x20','\x20\x20\x20\x20group_','SET\x20group_','LUMN\x20creat','SELECT\x201\x20F','onnection\x20','SELECT\x20nam','[WARN]','up_id','t\x20connecti','tions\x20(\x0a\x20\x20','ons\x20WHERE\x20','lumn','ded.group_','AND\x20group_','on]\x20failed','rGroup\x20fai','\x20chat_id\x20f','NULL,\x0a\x20\x20\x20\x20','id\x20FROM\x20co','group_id,\x20','ults','OT\x20NULL,\x0a\x20','?,\x20?)\x20\x0a\x20\x20\x20','ATE\x20TABLE\x20','E\x20name\x20=\x20?','tor_id\x20=\x20?','BEGIN\x20TRAN','\x20group_id,','E\x20connecti','s\x20SET\x20name','\x20=\x20?\x20WHERE','n]\x20added\x20m','rUser\x20fail','ions\x20found','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','\x20COLUMN\x20na','s\x20group','led\x20for\x20','to\x20add\x20cha','\x20group_id)','\x20WHERE\x20nam','database\x20m','ailed\x20for\x20','t_id\x20colum','\x20?,\x20?)','\x20group_def','che\x20failed',')\x20failed','70004aHxTZr','ame','Scoped:\x20re','on]\x20normal','on]\x20readin','\x20chat_id,\x20','nnections','names\x20prov','\x20\x20\x20\x20\x20);\x0a\x20\x20','name','for\x20setDef','COMMIT;','\x22\x20in\x20','n]\x20updated','olumns\x20fai','map','ailed:\x20','\x20AND\x20group','WHERE\x20grou','\x20->\x20','connection','trim','ections','ult\x20failed','moved\x20all\x20','set','n]\x20loadAct','Connection','\x20failed:\x20','_id\x20TEXT\x20N','\x20(deleted=','id\x20=\x20exclu','\x20\x20\x20\x20\x20\x20\x20\x20ON','has','chema\x20fail','_defaults\x20','groups\x20cac','ectionScop','ions\x20cache','n]\x20deleteC','\x20IF\x20EXISTS','n]\x20setActi','up_id\x20FROM','NOT\x20NULL\x0a\x20','or_id\x20TEXT','issing\x20cha','d\x20=\x20?','E\x20group_de','IF\x20NOT\x20EXI','\x20\x20\x20\x20\x20\x20);\x0a\x20','n][migrati','e\x20provided','slice','\x20\x20\x20\x20\x20creat','STS\x20group_','p\x20failed\x20f','me\x20=\x20?','\x20group_id\x20','\x20ORDER\x20BY\x20','name\x20=\x20?\x20A','190574FntKZf','veGroupFor','led:\x20','ons\x20ADD\x20CO','e\x20FROM\x20gro','\x20to\x20update','s\x20schema\x20f','\x20table\x20gro','p_id\x20PK)','NAME\x20TO\x20co','p_id\x20=\x20?\x20O','t_id\x20FROM\x20','Caches\x20com','n]\x20created','WHERE\x20name','DEFAULT\x20\x27\x27','nsChatIdTo','Cache\x20fail','1373436INfYqi','ByCreatorI','[ERROR]','stringify','ultForGrou','k\x20failed\x20f','clear','onnections','parse','ORDER\x20BY\x20g','ections_ne','\x20(?,\x20?)\x0a\x20\x20','ns;','g\x20old\x20rows','n]\x20connect','group_defa','n]\x20getDefa','UPDATE\x20SET','iveGroupsC','4438082eJkxZc','INSERT\x20OR\x20','KEY\x20(name,','=\x20?','rdScoped(','eGroupDefa','n]\x20columnE','SACTION;','aults\x20for\x20','user_key','user_key)\x20','ed(','M\x20connecti','_id,\x20creat','_id)','roup_id\x20=\x20','d,\x20chat_id','plete','all','he\x20loaded\x20','XT\x20NOT\x20NUL','ite_master','efault\x20set','WHERE\x20crea','oup_id\x20TEX','ROM\x20connec','up_id\x20colu','hat_id\x20TEX','faults\x20ADD','n]\x20loadCon','includes','push','\x20\x20\x20\x20name\x20T','me\x20TEXT\x20NO','1081100pNXQTc','n]\x20failed\x20','\x20NOT\x20NULL\x20','get','warn','s\x20WHERE\x20gr','skipping\x20n','nGroup\x20fai',',\x20creator_','rd(','p_id\x20TEXT\x20','ND\x20group_i','id\x20TEXT\x20NO','join',',\x20group_id','n]\x20removeC','e=\x27table\x27\x20','to\x20add\x20gro','run','Unsupporte','not\x20export','up_id)\x20DO\x20','isArray','27eKgSIC','ection(','REPLACE\x20IN','id\x20=\x20?','\x20(creator=','d\x20namesOrA','(0\x20rows)','ALTER\x20TABL','n]\x20getConn','hatIdsFrom','oup_id,\x20na','[]\x27,\x0a\x20\x20\x20\x20\x20','\x20=\x20?\x20AND\x20g','\x20\x20\x20\x20\x20\x20\x20cre','\x20KEY,\x0a\x20\x20\x20\x20','entries','\x20active\x20gr',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','t_id','LL,\x0a\x20\x20\x20\x20\x20\x20','None\x20of\x20th','xists\x20chec','tGroup','2lHCFuz','toLowerCas','n]\x20loadGro','T\x20NOT\x20NULL','n]\x20ensureS','LUMN\x20group','ons_new\x20RE','me)\x20VALUES','ensured\x20an','nnections;','up_default','21tUxfIM','filter','ache\x20faile','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','5985344MuBcjJ','ions_new\x20(','id,\x20group_','ons\x20(name,','r_key,\x20gro','\x20@\x20group=',')\x20VALUES\x20(','TO\x20connect','\x20into\x20conn','delete','INSERT\x20INT','STS\x20','SELECT\x20cha','\x20FROM\x20conn','DELETE\x20FRO','LL\x0a\x20\x20\x20\x20\x20\x20)','id\x20for\x20\x22','\x20PRIMARY\x20K','\x20connectio','message','cluded.nam','faults\x20(gr','\x20(arrays-o','for\x20','No\x20connect','STS\x20connec','RE\x20group_i','\x20user_key\x20','n]\x20refresh','n]\x20migrati','\x20\x20\x20','ized\x20chat_','n]\x20listCon','Scoped\x20fai','n]\x20group\x20d','ator_id\x20TE','ultGroup:\x20','\x20TEXT\x20NOT\x20','\x20WHERE\x20typ','\x20DEFAULT\x20\x27','PRAGMA\x20tab','L,\x0a\x20\x20\x20\x20\x20\x20\x20','O\x20group_de','ted','AULT\x20\x27[]\x27;','\x20rows)','split','tions\x20WHER','onnectionS','\x20=\x20?\x20LIMIT','me\x20=\x20?\x20AND','on]\x20migrat','\x20all','oup\x20deleti','d:\x20','\x20=\x20?,\x20crea','ET\x20chat_id','DER\x20BY\x20nam','nections\x20(','User\x20error','\x20WHERE\x20use','ectionReco','to\x20persist','s\x20failed','[connectio','exec','r_key\x20=\x20?','ultsNameTo','ectionName','to\x20add\x20cre','DROP\x20TABLE','changes','\x20CONFLICT(','function','upDefaults','user_activ','w\x20(\x0a\x20\x20\x20\x20\x20\x20','ed:\x20','XT\x20PRIMARY','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','FAULT\x20\x27\x27;','T\x20NULL\x20DEF','Array\x20fail','\x20for\x20','nGroup:\x20','creator_id','\x20\x20\x20\x20\x20\x20chat','log','\x20name\x20=\x20?\x20','e,\x20group_i','undefined','\x20\x20PRIMARY\x20','che\x20loaded','s\x20WHERE\x20na','Caches\x20loa','on:\x20','T\x20NULL,\x0a\x20\x20','\x20(user_key','e,\x20chat_id','n]\x20setDefa','M\x20group_de','some','\x20setDefaul','issing\x20cre','\x0a\x20\x20\x20\x20\x20\x20CRE','group_id)\x0a','group_id','e_groups','nectionsFo','nections\x20S'];_0x15ea=function(){return _0x1cc24d;};return _0x15ea();}export async function getConnectionRecordScoped(_0x5e518f,_0x282c73=''){const _0x83e9a8=_0x112b85;try{await ensureSchema();const _0xd5340f=String(_0x282c73||'');if(connectionsCache['has'](_0xd5340f)&&connectionsCache['get'](_0xd5340f)[_0x83e9a8(0x247)](String(_0x5e518f))){const _0x57a803=connectionsCache['get'](_0xd5340f)['get'](String(_0x5e518f));return{'name':_0x57a803['name'],'chat_id':_0x57a803['chat_id'][_0x83e9a8(0x25a)](),'creator_id':_0x57a803[_0x83e9a8(0x1b9)]};}const _0x4023a5=await getDb(),_0x2ccd66=await _0x4023a5[_0x83e9a8(0x2ac)](_0x83e9a8(0x1fb)+'e,\x20chat_id'+_0x83e9a8(0x2b1)+_0x83e9a8(0x208)+_0x83e9a8(0x1eb)+_0x83e9a8(0x270)+_0x83e9a8(0x2cc)+'roup_id\x20=\x20'+'?',[String(_0x5e518f),_0xd5340f]);if(!_0x2ccd66)return null;return{'name':_0x2ccd66[_0x83e9a8(0x22f)],'chat_id':parseArrayStrict(_0x2ccd66[_0x83e9a8(0x1f4)]),'creator_id':_0x2ccd66[_0x83e9a8(0x1b9)]};}catch(_0x503a21){return error(_0x503a21,'[connectio'+_0x83e9a8(0x2c8)+_0x83e9a8(0x1a1)+_0x83e9a8(0x28b)+_0x5e518f+_0x83e9a8(0x1e5)+_0x282c73+_0x83e9a8(0x225)),null;}}export async function getConnectionName(_0x5be19a){const _0x4ee06b=_0x112b85;try{await ensureSchema();for(const [_0x54f3e2,_0x5ae5dc]of connectionsCache[_0x4ee06b(0x14d)]()){for(const [_0x563462,_0x4ee4e7]of _0x5ae5dc[_0x4ee06b(0x14d)]()){if(Array['isArray'](_0x4ee4e7[_0x4ee06b(0x1f4)])&&_0x4ee4e7['chat_id'][_0x4ee06b(0x2a5)](String(_0x5be19a)))return _0x563462;}}const _0x100d5e=await getDb(),_0x5d7bf2=await _0x100d5e[_0x4ee06b(0x299)]('SELECT\x20nam'+'e,\x20chat_id'+_0x4ee06b(0x171)+_0x4ee06b(0x23c));for(const _0x501c2c of _0x5d7bf2||[]){const _0x3ecdc0=parseArrayStrict(_0x501c2c[_0x4ee06b(0x1f4)]);if(_0x3ecdc0[_0x4ee06b(0x2a5)](String(_0x5be19a)))return _0x501c2c[_0x4ee06b(0x22f)];}return null;}catch(_0x704668){return error(_0x704668,_0x4ee06b(0x1a4)+'n]\x20getConn'+_0x4ee06b(0x1a8)+'('+_0x5be19a+')\x20failed'),null;}}export async function setDefaultGroup(_0x215e08,_0x54b897){const _0x166221=_0x112b85;try{await ensureSchema();const _0x5703ad=await getDb();if(!_0x54b897)throw new Error('groupId\x20re'+_0x166221(0x1da)+_0x166221(0x1ca)+_0x166221(0x154));if(!_0x215e08||Array['isArray'](_0x215e08)&&_0x215e08[_0x166221(0x1f2)]===-0x12*0x1ae+0x1308+0xb34)return await _0x5703ad['run'](_0x166221(0x172)+_0x166221(0x1c8)+'faults\x20WHE'+_0x166221(0x17e)+'d\x20=\x20?',[String(_0x54b897)]),groupDefaultsCache[_0x166221(0x16d)](String(_0x54b897)),info(_0x166221(0x1a4)+_0x166221(0x186)+'efault\x20cle'+'ared\x20for\x20'+_0x54b897),!![];let _0x43e259=[];if(typeof _0x215e08===_0x166221(0x1e1)&&_0x215e08[_0x166221(0x156)+'e']()===_0x166221(0x299)){const _0x3199ad=await listConnectionsForGroup(String(_0x54b897));_0x43e259=(_0x3199ad||[])['map'](_0x53d2e7=>_0x53d2e7['name'])['filter'](Boolean);if(!_0x43e259[_0x166221(0x1f2)])throw new Error(_0x166221(0x17c)+_0x166221(0x217)+'\x20to\x20set\x20as'+_0x166221(0x198));}else{if(Array[_0x166221(0x2bf)](_0x215e08))_0x43e259=_0x215e08[_0x166221(0x235)](String)[_0x166221(0x161)](Boolean);else{if(typeof _0x215e08==='string'){if(_0x215e08[_0x166221(0x2a5)](','))_0x43e259=_0x215e08[_0x166221(0x192)](',')[_0x166221(0x235)](_0x3eda7d=>_0x3eda7d[_0x166221(0x23b)]())['filter'](Boolean);else _0x43e259=[_0x215e08];}else throw new Error(_0x166221(0x2bc)+_0x166221(0x2c5)+'rray\x20type\x20'+_0x166221(0x230)+'aultGroup');}}if(!_0x43e259['length'])throw new Error(_0x166221(0x1d9)+_0x166221(0x1fa)+_0x166221(0x22d)+'ided\x20for\x20s'+'etDefaultG'+'roup');const _0x140675=[];for(const _0x2840b0 of _0x43e259){const _0x15de85=await _0x5703ad[_0x166221(0x2ac)](_0x166221(0x1f9)+_0x166221(0x2a0)+_0x166221(0x193)+_0x166221(0x20e)+_0x166221(0x237)+'_id\x20=\x20?',[String(_0x2840b0),String(_0x54b897)]);if(_0x15de85)_0x140675['push'](_0x2840b0);else warn(_0x166221(0x1a4)+_0x166221(0x1c7)+_0x166221(0x188)+_0x166221(0x2af)+'on-existen'+_0x166221(0x1fe)+_0x166221(0x1df)+_0x2840b0+_0x166221(0x232)+_0x54b897);}if(!_0x140675['length'])throw new Error(_0x166221(0x152)+_0x166221(0x259)+'\x20connectio'+'n\x20names\x20ex'+'ist\x20in\x20thi'+_0x166221(0x21a));return await _0x5703ad[_0x166221(0x2bb)]('INSERT\x20INT'+_0x166221(0x18e)+_0x166221(0x179)+_0x166221(0x2ca)+_0x166221(0x15c)+_0x166221(0x27f)+'\x20\x20\x20\x20\x20ON\x20CO'+'NFLICT(gro'+_0x166221(0x2be)+_0x166221(0x285)+'\x20name\x20=\x20ex'+_0x166221(0x178)+'e;',[String(_0x54b897),JSON[_0x166221(0x277)](_0x140675)]),groupDefaultsCache[_0x166221(0x23f)](String(_0x54b897),_0x140675[_0x166221(0x25a)]()),info(_0x166221(0x1a4)+_0x166221(0x186)+_0x166221(0x29d)+_0x166221(0x1b7)+_0x54b897+_0x166221(0x239)+JSON[_0x166221(0x277)](_0x140675)),!![];}catch(_0x5018d6){return error(_0x5018d6,_0x166221(0x1a4)+_0x166221(0x1c7)+'ultGroup\x20f'+_0x166221(0x220)+_0x54b897+':\x20'+(_0x5018d6?.[_0x166221(0x177)]||_0x5018d6)),![];}}export async function getDefaultForGroup(_0x4a7620){const _0x2bff8e=_0x112b85;try{await ensureSchema();if(!_0x4a7620)return null;const _0x14039a=String(_0x4a7620);if(groupDefaultsCache[_0x2bff8e(0x247)](_0x14039a)){const _0x3cddbb=groupDefaultsCache['get'](_0x14039a);return Array[_0x2bff8e(0x2bf)](_0x3cddbb)?_0x3cddbb['map'](String):null;}const _0x3444a8=await getDb(),_0x51822b=await _0x3444a8[_0x2bff8e(0x2ac)](_0x2bff8e(0x1fb)+_0x2bff8e(0x266)+_0x2bff8e(0x15f)+_0x2bff8e(0x2ae)+'oup_id\x20=\x20?',[_0x14039a]);if(!_0x51822b||!_0x51822b[_0x2bff8e(0x22f)])return null;try{const _0x18402f=JSON[_0x2bff8e(0x27c)](_0x51822b[_0x2bff8e(0x22f)]);if(Array[_0x2bff8e(0x2bf)](_0x18402f))return groupDefaultsCache[_0x2bff8e(0x23f)](_0x14039a,_0x18402f['map'](String)),_0x18402f[_0x2bff8e(0x235)](String);}catch(_0x29e573){}return null;}catch(_0x215f70){return error(_0x215f70,_0x2bff8e(0x1a4)+_0x2bff8e(0x284)+_0x2bff8e(0x278)+_0x2bff8e(0x25d)+_0x2bff8e(0x1ea)+_0x4a7620),null;}}export async function getDefault(_0x1e6c17){const _0x4f3391=_0x112b85;try{await ensureSchema();const _0x1b458e=getActiveGroupForUser(String(_0x1e6c17));if(!_0x1b458e)return null;return await getDefaultForGroup(_0x1b458e);}catch(_0x547f0f){return error(_0x547f0f,'[connectio'+_0x4f3391(0x284)+_0x4f3391(0x23d)+_0x4f3391(0x1b7)+_0x1e6c17),null;}}export async function getConnection(_0x202ce6){const _0x1ccd57=_0x112b85;try{await ensureSchema();const _0x136265=await getDb(),_0x15450c=await _0x136265['all']('SELECT\x20cha'+_0x1ccd57(0x26d)+_0x1ccd57(0x23a)+_0x1ccd57(0x1c1)+_0x1ccd57(0x25e),[String(_0x202ce6)]);if(!_0x15450c||!_0x15450c['length'])return null;const _0x4f2bd1=[];for(const _0x589e74 of _0x15450c){const _0x226c19=parseArrayStrict(_0x589e74[_0x1ccd57(0x1f4)]);for(const _0x160b58 of _0x226c19)if(!_0x4f2bd1[_0x1ccd57(0x2a5)](_0x160b58))_0x4f2bd1[_0x1ccd57(0x2a6)](_0x160b58);}return _0x4f2bd1;}catch(_0x5deab4){return error(_0x5deab4,'[connectio'+_0x1ccd57(0x2c8)+_0x1ccd57(0x2c1)+_0x202ce6+_0x1ccd57(0x225)),null;}}export async function getConnectionRecord(_0x2a6a11){const _0x2ae4d3=_0x112b85;try{await ensureSchema();const _0x18bb5a=await getDb(),_0x468298=await _0x18bb5a[_0x2ae4d3(0x2ac)](_0x2ae4d3(0x1fb)+_0x2ae4d3(0x1c6)+_0x2ae4d3(0x2b1)+_0x2ae4d3(0x166)+_0x2ae4d3(0x208)+_0x2ae4d3(0x1eb)+'WHERE\x20name'+_0x2ae4d3(0x195)+'\x201',[String(_0x2a6a11)]);if(!_0x468298)return null;return{'name':_0x468298[_0x2ae4d3(0x22f)],'chat_id':parseArrayStrict(_0x468298['chat_id']),'creator_id':_0x468298[_0x2ae4d3(0x1b9)],'group_id':_0x468298[_0x2ae4d3(0x1ce)]};}catch(_0x58baa1){return error(_0x58baa1,_0x2ae4d3(0x1a4)+_0x2ae4d3(0x2c8)+'ectionReco'+_0x2ae4d3(0x2b2)+_0x2a6a11+_0x2ae4d3(0x225)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};