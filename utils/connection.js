const _0x157d04=_0x38e8;(function(_0x271216,_0x5c5534){const _0x249ea4=_0x38e8,_0x29cbf7=_0x271216();while(!![]){try{const _0x2b0af8=-parseInt(_0x249ea4(0x2ee))/(-0xe58+-0x67*0x4e+0x2dbb)+-parseInt(_0x249ea4(0x2ad))/(-0x5d*0x3b+-0x24c1+0x3a32)+-parseInt(_0x249ea4(0x1be))/(-0x5*-0x521+0x7*0xd+-0x1*0x19fd)*(-parseInt(_0x249ea4(0x269))/(0x538*-0x4+0x23b5+-0xed1*0x1))+-parseInt(_0x249ea4(0x28b))/(-0xa7*0x16+0x1a4b+0xda*-0xe)*(-parseInt(_0x249ea4(0x293))/(0x1*0x1655+0x888+0x62b*-0x5))+parseInt(_0x249ea4(0x1a7))/(-0x16ca+0x3dd+0x12f4)*(-parseInt(_0x249ea4(0x24b))/(-0x975+0xa*-0x338+0x29ad))+parseInt(_0x249ea4(0x22e))/(-0x215*-0x3+0x13ef+-0x1a25)+-parseInt(_0x249ea4(0x221))/(0xecd*0x1+-0xf2b+0x68)*(-parseInt(_0x249ea4(0x2a0))/(-0x10*-0x166+-0x1*0x117a+-0x4db));if(_0x2b0af8===_0x5c5534)break;else _0x29cbf7['push'](_0x29cbf7['shift']());}catch(_0x55c068){_0x29cbf7['push'](_0x29cbf7['shift']());}}}(_0x41ae,0x687dc+0xfee1*0x9+-0x3b*0x1141));import{info as _0x4694c1,warn as _0x413082,error as _0x1302f7}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x157d04(0x220)+_0x157d04(0x278);function info(..._0x24ac41){const _0x51fd40=_0x157d04;try{_0x4694c1(..._0x24ac41);}catch(_0x108db3){console[_0x51fd40(0x258)]('[INFO]',..._0x24ac41);}}function warn(..._0x49cbd5){const _0x268534=_0x157d04;try{_0x413082(..._0x49cbd5);}catch(_0x39a2cf){console[_0x268534(0x1f0)](_0x268534(0x2ec),..._0x49cbd5);}}function error(..._0x2871df){const _0x2bdaa0=_0x157d04;try{_0x1302f7(..._0x2871df);}catch(_0x4b4417){console[_0x2bdaa0(0x287)](_0x2bdaa0(0x1cc),..._0x2871df);}}async function getDb(){const _0x489bad=_0x157d04;if(db&&typeof db[_0x489bad(0x2d2)]===_0x489bad(0x24d))return db;try{const _0x17a734=await import('./database.js');if(_0x17a734&&_0x17a734['db'])return db=_0x17a734['db'],db;throw new Error(_0x489bad(0x264)+'odule\x20did\x20'+_0x489bad(0x1c6)+_0x489bad(0x25e));}catch(_0xa8dcfe){error(_0xa8dcfe,'[connectio'+_0x489bad(0x27f)+_0x489bad(0x2e5)+'database.j'+'s');throw _0xa8dcfe;}}function safeParseJSON(_0x400240){const _0x7190ea=_0x157d04;try{return JSON[_0x7190ea(0x203)](_0x400240);}catch(_0x469d08){return null;}}function asArrayStrict(_0x1b7bc5){const _0xc26633=_0x157d04;if(_0x1b7bc5===null||_0x1b7bc5===undefined)return[];if(typeof _0x1b7bc5===_0xc26633(0x196)){const _0x43a6d6=safeParseJSON(_0x1b7bc5);if(Array[_0xc26633(0x1bf)](_0x43a6d6))return _0x43a6d6['map'](String);return[_0x1b7bc5];}if(Array[_0xc26633(0x1bf)](_0x1b7bc5))return _0x1b7bc5[_0xc26633(0x245)](String);return[String(_0x1b7bc5)];}function toJSONString(_0x4ba10d){const _0x2b816b=_0x157d04;return JSON[_0x2b816b(0x215)](Array[_0x2b816b(0x1bf)](_0x4ba10d)?_0x4ba10d['map'](String):[]);}async function tableExists(_0x5292a0){const _0x2c5768=_0x157d04,_0xe6550b=await getDb(),_0x20a177=await _0xe6550b[_0x2c5768(0x1d8)]('SELECT\x20nam'+'e\x20FROM\x20sql'+_0x2c5768(0x266)+'\x20WHERE\x20typ'+_0x2c5768(0x214)+_0x2c5768(0x1c1)+'\x20?',[String(_0x5292a0)]);return!!_0x20a177;}async function columnExists(_0x15c3da,_0x40c4f2){const _0x38084b=_0x157d04;try{const _0x53585a=await getDb(),_0x5589b1=await _0x53585a[_0x38084b(0x233)](_0x38084b(0x302)+_0x38084b(0x226)+_0x15c3da+')');if(!Array[_0x38084b(0x1bf)](_0x5589b1))return![];return _0x5589b1[_0x38084b(0x28a)](_0x11af4e=>String(_0x11af4e[_0x38084b(0x26c)])[_0x38084b(0x216)+'e']()===String(_0x40c4f2)[_0x38084b(0x216)+'e']());}catch(_0x2890df){return warn(_0x38084b(0x2db)+_0x38084b(0x2ac)+_0x38084b(0x2e7)+_0x38084b(0x2ed)+'or\x20'+_0x15c3da+'.'+_0x40c4f2+':\x20'+(_0x2890df?.['message']||_0x2890df)),![];}}async function ensureConnectionsTable(){const _0x303b46=_0x157d04,_0x5840fd=await getDb(),_0x49f67f=await tableExists(_0x303b46(0x1b9)+'s');if(!_0x49f67f){await _0x5840fd[_0x303b46(0x2d2)](_0x303b46(0x26a)+'ATE\x20TABLE\x20'+_0x303b46(0x2ea)+'STS\x20connec'+'tions\x20(\x0a\x20\x20'+_0x303b46(0x27b)+'\x20TEXT\x20NOT\x20'+_0x303b46(0x29e)+_0x303b46(0x241)+_0x303b46(0x26b)+_0x303b46(0x1f2)+_0x303b46(0x31c)+_0x303b46(0x1de)+_0x303b46(0x23f)+_0x303b46(0x268)+_0x303b46(0x1f5)+'XT\x20NOT\x20NUL'+_0x303b46(0x288)+_0x303b46(0x20f)+'EY\x20(name,\x20'+_0x303b46(0x2c4)+_0x303b46(0x2e2)+_0x303b46(0x24c)),info(_0x303b46(0x2db)+'n]\x20created'+'\x20table\x20con'+_0x303b46(0x276)+_0x303b46(0x300)+_0x303b46(0x1a1));return;}const _0x201efd=await columnExists(_0x303b46(0x1b9)+'s',_0x303b46(0x24a)),_0x5cdd3a=await columnExists(_0x303b46(0x1b9)+'s',_0x303b46(0x2c9)),_0x206ebe=await columnExists(_0x303b46(0x1b9)+'s',_0x303b46(0x2c2));if(!_0x5cdd3a||!_0x206ebe||!_0x201efd)try{await _0x5840fd[_0x303b46(0x2d2)](_0x303b46(0x244)+_0x303b46(0x2b7)+'E\x20IF\x20NOT\x20E'+'XISTS\x20conn'+_0x303b46(0x24f)+_0x303b46(0x317)+_0x303b46(0x297)+_0x303b46(0x2f6)+'LL,\x0a\x20\x20\x20\x20\x20\x20'+_0x303b46(0x241)+_0x303b46(0x26b)+_0x303b46(0x207)+_0x303b46(0x201)+_0x303b46(0x2e1)+'hat_id\x20TEX'+_0x303b46(0x1e5)+_0x303b46(0x1fa)+_0x303b46(0x1a9)+_0x303b46(0x1fb)+_0x303b46(0x1d7)+_0x303b46(0x1c0)+_0x303b46(0x1e4)+_0x303b46(0x2f4)+'\x20\x20PRIMARY\x20'+_0x303b46(0x263)+_0x303b46(0x1ad)+_0x303b46(0x21a)+';\x0a\x20\x20\x20\x20\x20\x20');try{const _0x248b42=await _0x5840fd[_0x303b46(0x233)](_0x303b46(0x246)+_0x303b46(0x20c)+_0x303b46(0x20b)+'id\x20FROM\x20co'+'nnections');if(Array[_0x303b46(0x1bf)](_0x248b42)&&_0x248b42[_0x303b46(0x1cb)])for(const _0x2060fb of _0x248b42){const _0x1c669a=_0x2060fb[_0x303b46(0x26c)],_0x82e270=typeof _0x2060fb[_0x303b46(0x2c9)]==='undefined'||_0x2060fb['chat_id']===null?'[]':_0x2060fb[_0x303b46(0x2c9)],_0x58befc=typeof _0x2060fb['creator_id']===_0x303b46(0x21b)||_0x2060fb[_0x303b46(0x2c2)]===null?'':_0x2060fb[_0x303b46(0x2c2)];try{await _0x5840fd[_0x303b46(0x261)]('INSERT\x20OR\x20'+_0x303b46(0x2b2)+_0x303b46(0x2e0)+_0x303b46(0x1ef)+'name,\x20grou'+_0x303b46(0x19b)+_0x303b46(0x2e4)+_0x303b46(0x308)+_0x303b46(0x1fe)+_0x303b46(0x30f),[_0x1c669a,'',_0x82e270,_0x58befc]);}catch(_0x356d42){warn(_0x303b46(0x2db)+_0x303b46(0x2e8)+_0x303b46(0x1e6)+'\x20into\x20conn'+'ections_ne'+_0x303b46(0x281)+'or\x20'+_0x1c669a+':\x20'+(_0x356d42?.[_0x303b46(0x1b0)]||_0x356d42));}}}catch(_0x4f45f3){warn('[connectio'+'n][migrati'+_0x303b46(0x1ce)+'g\x20old\x20rows'+_0x303b46(0x1a4)+(_0x4f45f3?.[_0x303b46(0x1b0)]||_0x4f45f3));}try{await _0x5840fd[_0x303b46(0x2d2)]('DROP\x20TABLE'+_0x303b46(0x29b)+'\x20connectio'+_0x303b46(0x26e));}catch(_0x2345df){}await _0x5840fd[_0x303b46(0x2d2)](_0x303b46(0x307)+_0x303b46(0x255)+_0x303b46(0x27d)+_0x303b46(0x1ba)+_0x303b46(0x228)),info(_0x303b46(0x2db)+'n]\x20migrate'+_0x303b46(0x1e3)+'ons\x20->\x20con'+_0x303b46(0x276)+_0x303b46(0x2cd)+_0x303b46(0x30d));}catch(_0x5c1042){warn(_0x303b46(0x2db)+_0x303b46(0x227)+_0x303b46(0x2bc)+_0x303b46(0x1b9)+_0x303b46(0x19c)+'ailed:\x20'+(_0x5c1042?.[_0x303b46(0x1b0)]||_0x5c1042));if(!_0x5cdd3a)try{await _0x5840fd[_0x303b46(0x2d2)](_0x303b46(0x307)+_0x303b46(0x255)+_0x303b46(0x21c)+_0x303b46(0x1b1)+_0x303b46(0x26b)+'T\x20NULL\x20DEF'+_0x303b46(0x2dd)),info(_0x303b46(0x2db)+_0x303b46(0x2eb)+_0x303b46(0x2a3)+_0x303b46(0x2a4)+'n');}catch(_0x3ad4c2){warn(_0x3ad4c2,_0x303b46(0x2db)+'n]\x20failed\x20'+_0x303b46(0x218)+_0x303b46(0x30b));}if(!_0x206ebe)try{await _0x5840fd[_0x303b46(0x2d2)](_0x303b46(0x307)+_0x303b46(0x255)+'ons\x20ADD\x20CO'+'LUMN\x20creat'+_0x303b46(0x1d7)+'\x20NOT\x20NULL\x20'+_0x303b46(0x1e4)+';'),info(_0x303b46(0x2db)+_0x303b46(0x2eb)+_0x303b46(0x260)+_0x303b46(0x2f2)+_0x303b46(0x205));}catch(_0xd3ad25){warn(_0xd3ad25,_0x303b46(0x2db)+_0x303b46(0x27f)+_0x303b46(0x290)+'ator_id');}if(!_0x201efd)try{await _0x5840fd[_0x303b46(0x2d2)]('ALTER\x20TABL'+_0x303b46(0x255)+_0x303b46(0x21c)+_0x303b46(0x2ca)+_0x303b46(0x1de)+'OT\x20NULL\x20DE'+_0x303b46(0x22f)),info('[connectio'+_0x303b46(0x2eb)+'issing\x20gro'+_0x303b46(0x2ab)+'mn');}catch(_0x333542){warn(_0x333542,_0x303b46(0x2db)+_0x303b46(0x27f)+_0x303b46(0x1f6)+_0x303b46(0x243));}}}async function ensureGroupDefaultsTable(){const _0x87d459=_0x157d04,_0x11f9d9=await getDb(),_0x2a55b9=await tableExists(_0x87d459(0x296)+_0x87d459(0x2da));if(!_0x2a55b9){await _0x11f9d9['exec'](_0x87d459(0x26a)+'ATE\x20TABLE\x20'+_0x87d459(0x2ea)+'STS\x20group_'+_0x87d459(0x254)+_0x87d459(0x2aa)+'roup_id\x20TE'+_0x87d459(0x2c5)+_0x87d459(0x20a)+_0x87d459(0x297)+_0x87d459(0x2f6)+_0x87d459(0x27c)+_0x87d459(0x29f)),info(_0x87d459(0x2db)+_0x87d459(0x29c)+_0x87d459(0x2c1)+_0x87d459(0x217)+'s');return;}!await columnExists(_0x87d459(0x296)+'ults',_0x87d459(0x24a))&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x1cf2eb=_0x157d04,_0x43706e=await getDb();try{await _0x43706e[_0x1cf2eb(0x2d2)](_0x1cf2eb(0x307)+_0x1cf2eb(0x208)+_0x1cf2eb(0x311)+_0x1cf2eb(0x313)+_0x1cf2eb(0x2bb)+_0x1cf2eb(0x1e5)+'\x20DEFAULT\x20\x27'+'\x27;'),await _0x43706e[_0x1cf2eb(0x2d2)]('ALTER\x20TABL'+_0x1cf2eb(0x208)+_0x1cf2eb(0x311)+_0x1cf2eb(0x31b)+_0x1cf2eb(0x253)+_0x1cf2eb(0x207)+'AULT\x20\x27[]\x27;');}catch(_0x16a839){warn(_0x1cf2eb(0x2db)+_0x1cf2eb(0x210)+_0x1cf2eb(0x272)+_0x1cf2eb(0x2ef)+_0x1cf2eb(0x2cb)+(_0x16a839?.[_0x1cf2eb(0x1b0)]||_0x16a839));}}async function ensureActiveGroupsTable(){const _0x5cea32=_0x157d04,_0x251217=await getDb(),_0x1bd0dc=await tableExists(ACTIVE_TABLE);!_0x1bd0dc&&(await _0x251217[_0x5cea32(0x2d2)](_0x5cea32(0x26a)+_0x5cea32(0x30e)+_0x5cea32(0x2ea)+_0x5cea32(0x21e)+ACTIVE_TABLE+(_0x5cea32(0x2d9)+'\x20user_key\x20'+_0x5cea32(0x20e)+_0x5cea32(0x295)+'\x20\x20\x20\x20\x20\x20grou'+_0x5cea32(0x2bd)+_0x5cea32(0x2b4)+_0x5cea32(0x2b5)+'\x20\x20')),info(_0x5cea32(0x2db)+'n]\x20created'+_0x5cea32(0x1d0)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x457b0c=_0x157d04;try{const _0x3f4485=await getDb(),_0x5bb636=await _0x3f4485[_0x457b0c(0x233)](_0x457b0c(0x246)+_0x457b0c(0x2b0)+_0x457b0c(0x31a)+'\x20FROM\x20conn'+_0x457b0c(0x21d));if(!_0x5bb636||_0x5bb636[_0x457b0c(0x1cb)]===-0x1814+-0x11b*0x17+0x3181)return;const _0x1716c0=[];for(const _0x9143d of _0x5bb636){const _0x2630cf=_0x9143d[_0x457b0c(0x2c9)],_0x75087c=safeParseJSON(_0x2630cf);if(Array[_0x457b0c(0x1bf)](_0x75087c)){const _0xeba957=_0x75087c[_0x457b0c(0x245)](String),_0x502979=toJSONString(_0xeba957);if(_0x502979!==_0x2630cf)_0x1716c0[_0x457b0c(0x22a)]({'name':_0x9143d[_0x457b0c(0x26c)],'group_id':_0x9143d[_0x457b0c(0x24a)]||'','chat_id':_0x502979});continue;}else{let _0x2659fc=[];_0x2630cf===null||_0x2630cf===undefined||String(_0x2630cf)[_0x457b0c(0x1c7)]()===''?_0x2659fc=[]:_0x2659fc=[String(_0x2630cf)];const _0x390ab3=toJSONString(_0x2659fc);_0x1716c0[_0x457b0c(0x22a)]({'name':_0x9143d['name'],'group_id':_0x9143d[_0x457b0c(0x24a)]||'','chat_id':_0x390ab3});}}if(_0x1716c0['length']>-0x1c3+0xe1*0x10+0xc4d*-0x1){try{await _0x3f4485['exec']('BEGIN\x20TRAN'+'SACTION;');}catch(_0x4734b9){}for(const _0x166e93 of _0x1716c0){try{await _0x3f4485['run'](_0x457b0c(0x2af)+_0x457b0c(0x2fd)+_0x457b0c(0x1c9)+'\x20=\x20?\x20WHERE'+_0x457b0c(0x212)+_0x457b0c(0x2cf)+_0x457b0c(0x19f),[_0x166e93[_0x457b0c(0x2c9)],_0x166e93['name'],_0x166e93[_0x457b0c(0x24a)]]),info(_0x457b0c(0x2db)+_0x457b0c(0x2e8)+_0x457b0c(0x2b8)+_0x457b0c(0x2f0)+_0x457b0c(0x219)+_0x166e93[_0x457b0c(0x26c)]+(_0x457b0c(0x1c5)+'\x22')+_0x166e93[_0x457b0c(0x24a)]+'\x22');}catch(_0x22b198){warn('[connectio'+_0x457b0c(0x2e8)+'on]\x20failed'+_0x457b0c(0x2c6)+_0x457b0c(0x1b7)+'or\x20'+_0x166e93[_0x457b0c(0x26c)]+'@'+_0x166e93['group_id']+':\x20'+(_0x22b198?.['message']||_0x22b198));}}try{await _0x3f4485[_0x457b0c(0x2d2)](_0x457b0c(0x1d3));}catch(_0x3086eb){}}}catch(_0x1a16b2){warn(_0x457b0c(0x2db)+_0x457b0c(0x2e8)+_0x457b0c(0x211)+'eConnectio'+'nsChatIdTo'+_0x457b0c(0x292)+_0x457b0c(0x2a7)+(_0x1a16b2?.[_0x457b0c(0x1b0)]||_0x1a16b2));}}async function migrateGroupDefaultsNameToArray(){const _0x61b624=_0x157d04;try{const _0x4aab89=await getDb(),_0x1dc97e=await _0x4aab89[_0x61b624(0x233)]('SELECT\x20gro'+'up_id,\x20nam'+_0x61b624(0x1ae)+'up_default'+'s');if(!_0x1dc97e||_0x1dc97e[_0x61b624(0x1cb)]===-0x2*-0x95e+-0x188a*0x1+0x1*0x5ce)return;const _0x227171=[];for(const _0xf41d36 of _0x1dc97e){const _0x357616=_0xf41d36[_0x61b624(0x26c)],_0x40dba0=safeParseJSON(_0x357616);if(Array[_0x61b624(0x1bf)](_0x40dba0)){const _0x55f2a1=toJSONString(_0x40dba0);if(_0x55f2a1!==_0x357616)_0x227171[_0x61b624(0x22a)]({'group_id':_0xf41d36['group_id'],'name':_0x55f2a1});continue;}else{const _0x33440a=_0x357616===null||_0x357616===undefined||String(_0x357616)[_0x61b624(0x1c7)]()===''?[]:[String(_0x357616)],_0x210996=toJSONString(_0x33440a);_0x227171[_0x61b624(0x22a)]({'group_id':_0xf41d36[_0x61b624(0x24a)],'name':_0x210996});}}if(_0x227171['length']>0x1d91*0x1+0x1698+-0x3429){try{await _0x4aab89[_0x61b624(0x2d2)](_0x61b624(0x280)+'SACTION;');}catch(_0x37835d){}for(const _0x27dd15 of _0x227171){try{await _0x4aab89[_0x61b624(0x261)](_0x61b624(0x2d0)+_0x61b624(0x217)+_0x61b624(0x2e9)+'\x20=\x20?\x20WHERE'+_0x61b624(0x19d)+_0x61b624(0x274),[_0x27dd15[_0x61b624(0x26c)],_0x27dd15[_0x61b624(0x24a)]]),info(_0x61b624(0x2db)+_0x61b624(0x2e8)+_0x61b624(0x2b8)+_0x61b624(0x1f4)+_0x61b624(0x1b8)+_0x61b624(0x2c3)+_0x27dd15[_0x61b624(0x24a)]);}catch(_0x345996){warn(_0x61b624(0x2db)+_0x61b624(0x2e8)+'on]\x20failed'+_0x61b624(0x2c6)+_0x61b624(0x2b3)+'aults\x20for\x20'+_0x27dd15[_0x61b624(0x24a)]+':\x20'+(_0x345996?.[_0x61b624(0x1b0)]||_0x345996));}}try{await _0x4aab89['exec'](_0x61b624(0x1d3));}catch(_0x5741d8){}}}catch(_0x4fe05a){warn(_0x61b624(0x2db)+'n][migrati'+_0x61b624(0x211)+_0x61b624(0x1da)+_0x61b624(0x1ab)+_0x61b624(0x292)+_0x61b624(0x2a7)+(_0x4fe05a?.['message']||_0x4fe05a));}}function parseArrayStrict(_0x46e5b0){const _0x3460f3=_0x157d04;if(_0x46e5b0===null||_0x46e5b0===undefined)return[];if(typeof _0x46e5b0===_0x3460f3(0x196)){const _0x52a967=safeParseJSON(_0x46e5b0);if(Array[_0x3460f3(0x1bf)](_0x52a967))return _0x52a967[_0x3460f3(0x245)](String);return[];}if(Array[_0x3460f3(0x1bf)](_0x46e5b0))return _0x46e5b0['map'](String);return[String(_0x46e5b0)];}function stringifyArray(_0x48933b){const _0x94d3d7=_0x157d04;return JSON[_0x94d3d7(0x215)](Array[_0x94d3d7(0x1bf)](_0x48933b)?_0x48933b[_0x94d3d7(0x245)](String):[]);}async function loadConnectionsCache(){const _0x371833=_0x157d04;try{const _0x3e8215=await getDb(),_0x55f245=await _0x3e8215[_0x371833(0x233)](_0x371833(0x246)+_0x371833(0x2b0)+_0x371833(0x31a)+_0x371833(0x20b)+_0x371833(0x230)+'nnections');connectionsCache[_0x371833(0x2bf)]();if(!_0x55f245||!_0x55f245[_0x371833(0x1cb)]){info(_0x371833(0x2db)+'n]\x20connect'+_0x371833(0x30c)+_0x371833(0x1b2)+_0x371833(0x2a6));return;}for(const _0x47267d of _0x55f245){const _0x4df6f0=String(_0x47267d['group_id']||'');if(!connectionsCache[_0x371833(0x2d8)](_0x4df6f0))connectionsCache[_0x371833(0x1dc)](_0x4df6f0,new Map());const _0x9ff500=connectionsCache[_0x371833(0x1d8)](_0x4df6f0);_0x9ff500['set'](String(_0x47267d[_0x371833(0x26c)]),{'name':_0x47267d[_0x371833(0x26c)],'chat_id':parseArrayStrict(_0x47267d[_0x371833(0x2c9)]),'creator_id':_0x47267d[_0x371833(0x2c2)]});}info(_0x371833(0x2db)+'n]\x20connect'+_0x371833(0x30c)+_0x371833(0x2d1)+_0x55f245['length']+_0x371833(0x2a6));}catch(_0x294652){warn(_0x371833(0x2db)+_0x371833(0x2f3)+_0x371833(0x1ee)+_0x371833(0x249)+':\x20'+(_0x294652?.[_0x371833(0x1b0)]||_0x294652));}}async function loadGroupDefaultsCache(){const _0x4261bf=_0x157d04;try{const _0x3737d3=await getDb(),_0x159c13=await _0x3737d3[_0x4261bf(0x233)]('SELECT\x20gro'+_0x4261bf(0x267)+'e\x20FROM\x20gro'+_0x4261bf(0x217)+'s');groupDefaultsCache['clear']();if(!_0x159c13||!_0x159c13[_0x4261bf(0x1cb)]){info('[connectio'+_0x4261bf(0x26f)+'efaults\x20ca'+_0x4261bf(0x242)+_0x4261bf(0x234));return;}for(const _0x2f55fe of _0x159c13){try{const _0x4e093d=String(_0x2f55fe[_0x4261bf(0x24a)]),_0x595970=safeParseJSON(_0x2f55fe[_0x4261bf(0x26c)]),_0x33ceed=Array[_0x4261bf(0x1bf)](_0x595970)?_0x595970['map'](String):[];groupDefaultsCache[_0x4261bf(0x1dc)](_0x4e093d,_0x33ceed);}catch(_0x1e1012){}}info(_0x4261bf(0x2db)+_0x4261bf(0x26f)+_0x4261bf(0x25a)+_0x4261bf(0x242)+'\x20('+_0x159c13['length']+_0x4261bf(0x2a6));}catch(_0x55c0d1){warn(_0x4261bf(0x2db)+_0x4261bf(0x1dd)+_0x4261bf(0x265)+_0x4261bf(0x1ed)+_0x4261bf(0x2a7)+(_0x55c0d1?.[_0x4261bf(0x1b0)]||_0x55c0d1));}}async function loadActiveGroupsCache(){const _0x36633f=_0x157d04;try{const _0x5606fe=await getDb(),_0x44f029=await _0x5606fe[_0x36633f(0x233)](_0x36633f(0x2f5)+_0x36633f(0x1b5)+_0x36633f(0x1d5)+'\x20'+ACTIVE_TABLE);activeGroupByUser['clear']();if(!_0x44f029||!_0x44f029[_0x36633f(0x1cb)]){info('[connectio'+_0x36633f(0x31d)+'groups\x20cac'+_0x36633f(0x2f1)+_0x36633f(0x2d4));return;}for(const _0x21c59f of _0x44f029){try{activeGroupByUser[_0x36633f(0x1dc)](String(_0x21c59f['user_key']),String(_0x21c59f[_0x36633f(0x24a)]));}catch(_0x35b478){}}info(_0x36633f(0x2db)+'n]\x20active\x20'+_0x36633f(0x23c)+'he\x20loaded\x20'+'('+_0x44f029[_0x36633f(0x1cb)]+'\x20rows)');}catch(_0x1a90cc){warn(_0x36633f(0x2db)+_0x36633f(0x2fa)+_0x36633f(0x27a)+'ache\x20faile'+'d:\x20'+(_0x1a90cc?.[_0x36633f(0x1b0)]||_0x1a90cc));}}export async function refreshCaches(){const _0x4548e1=_0x157d04;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x4548e1(0x2db)+_0x4548e1(0x199)+_0x4548e1(0x273)+_0x4548e1(0x2b9));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function _0x41ae(){const _0x408e32=['to\x20add\x20cha','id\x20for\x20\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','undefined','ons\x20ADD\x20CO','ections','STS\x20','ared\x20for\x20','user_activ','1290RSrmyB','ded.group_','id,\x20group_','n]\x20getActi','ROM\x20connec','le_info(','n]\x20migrati','nnections;','Caches\x20loa','push','\x20chat_id,\x20','on-existen','NFLICT(gro','7772688RKztAf','FAULT\x20\x27\x27;','id\x20FROM\x20co','ORDER\x20BY\x20g','me\x20=\x20?','all','\x20(0\x20rows)','cluded.nam','nectionsFo','M\x20connecti','groupId\x20re','me)\x20VALUES','tor_id\x20=\x20?','or\x20','groups\x20cac',',\x20group_id','WHERE\x20name','OT\x20NULL,\x0a\x20','nGroup:\x20','\x20\x20\x20\x20group_','che\x20loaded','up_id','\x0a\x20\x20\x20\x20\x20\x20\x20\x20C','map','SELECT\x20nam','n]\x20setActi','group_id,\x20','che\x20failed','group_id','40pVwtdA','\x20\x20\x20','function','\x20(?,\x20?)\x0a\x20\x20','ections_ne','\x20=\x20?,\x20crea','rUser\x20fail','\x20ORDER\x20BY\x20','me\x20TEXT\x20NO','defaults\x20(','E\x20connecti','SELECT\x20cha','rGroup\x20fai','log','\x22\x20in\x20','efaults\x20ca','ist\x20in\x20thi','on\x20\x22','veGroupFor','\x20{\x20db\x20}','oup:\x20','issing\x20cre','run','faults\x20(gr','KEY\x20(name,','database\x20m','upDefaults','ite_master','up_id,\x20nam','\x20\x20\x20\x20\x20\x20\x20cre','5084eGTliG','\x0a\x20\x20\x20\x20\x20\x20CRE','id\x20TEXT\x20NO','name','ided\x20for\x20s','ns;','n]\x20group\x20d','rray\x20type\x20','\x20=\x20?\x20AND\x20g','pDefaultsC','Caches\x20com','=\x20?',')\x20failed','nections\x20(','E\x20name\x20=\x20?','e_groups','ectionName','iveGroupsC','\x20\x20\x20\x20\x20\x20name','LL\x0a\x20\x20\x20\x20\x20\x20)','ons_new\x20RE','n]\x20setDefa','n]\x20failed\x20','BEGIN\x20TRAN','w\x20failed\x20f','name\x20=\x20?\x20A','ons\x20(name,','\x20name\x20=\x20ex','n]\x20getConn','ted','error','L,\x0a\x20\x20\x20\x20\x20\x20\x20','SELECT\x201\x20F','some','620fBlLVR','delete','\x20=\x20?\x20LIMIT','\x20(deleted=','Scoped:\x20re','to\x20add\x20cre','n]\x20deleteC','Array\x20fail','58218WDhAGc','ame','RY\x20KEY,\x0a\x20\x20','group_defa','\x20\x20\x20\x20name\x20T','tGroup','n]\x20schema\x20','SET\x20group_','\x20IF\x20EXISTS','n]\x20created','entries\x20fo','NULL,\x0a\x20\x20\x20\x20',';\x0a\x20\x20\x20\x20','9581CwyhyN','includes','ection(','issing\x20cha','t_id\x20colum','onnectionS','\x20rows)','ed:\x20','Scoped\x20fai','me\x20=\x20?\x20AND','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','up_id\x20colu','n]\x20columnE','2790226FLDshr','onnections','UPDATE\x20con','e,\x20group_i','ND\x20group_i','REPLACE\x20IN','\x20group_def','NOT\x20NULL\x0a\x20','\x20\x20\x20\x20\x20);\x0a\x20\x20','n]\x20removeC','REATE\x20TABL','on]\x20normal','plete','User\x20error','oup_id\x20TEX','on\x20to\x20new\x20','p_id\x20TEXT\x20','\x20connectio','clear','ection\x20fai','\x20table\x20gro','creator_id','for\x20','group_id)\x0a','XT\x20PRIMARY','\x20to\x20update','\x20group_id,','O\x20group_de','chat_id','LUMN\x20group','led:\x20','RE\x20group_i','with\x20group','O\x20connecti','AND\x20group_','UPDATE\x20gro','\x20loaded\x20(','exec','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','(0\x20rows)','slice','coped:\x20','oup_id,\x20na','has','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','ults','[connectio','\x20@\x20group=','AULT\x20\x27[]\x27;','M\x20group_de','n]\x20addConn','TO\x20connect','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','\x20\x20\x20\x20\x20\x20);\x0a\x20','\x20(user_key','_id,\x20creat','to\x20import\x20',')\x20VALUES\x20(','xists\x20chec','n][migrati','s\x20SET\x20name','IF\x20NOT\x20EXI','n]\x20added\x20m','[WARN]','k\x20failed\x20f','432386qsHtuA','olumns\x20fai','ized\x20chat_','he\x20loaded\x20','ator_id\x20co','n]\x20loadCon',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','SELECT\x20use','EXT\x20NOT\x20NU',')\x20@\x20group=','UPDATE\x20SET','d\x20namesOrA','n]\x20loadAct','WHERE\x20grou','ded.','nections\x20S','oup\x20deleti',',\x20row\x20dele','name,\x20grou','ectionReco','PRAGMA\x20tab','No\x20connect','n]\x20ensureS','ions\x20found','e\x20=\x20?\x20AND\x20','ALTER\x20TABL','or_id)\x20VAL','rd(','roup','t_id','ions\x20cache','_id)','ATE\x20TABLE\x20','\x20?,\x20?)','to\x20persist','faults\x20ADD','Unsupporte','\x20COLUMN\x20gr','\x20=\x20?\x20WHERE','for\x20setDef','group_id\x20=','w\x20(\x0a\x20\x20\x20\x20\x20\x20','t_id\x20FROM\x20','s\x20group','d,\x20chat_id','\x20COLUMN\x20na','\x20\x20\x20\x20\x20\x20chat','n]\x20active\x20','string','up_id)\x20DO\x20','\x20FROM\x20conn','n]\x20refresh','faults\x20WHE','p_id,\x20chat','s\x20schema\x20f','\x20group_id\x20','filter','id\x20=\x20?','\x20\x20\x20\x20\x20\x20\x20\x20ON','p_id\x20PK)','ed(','_id\x20=\x20?\x20OR','\x20failed:\x20','n]\x20listCon','Connection','1330903SgyApI','nnections\x20','[]\x27,\x0a\x20\x20\x20\x20\x20','tions\x20WHER','ultsNameTo','nly,\x20group','\x20group_id)','e\x20FROM\x20gro','_id\x20=\x20?','message','LUMN\x20chat_','\x20loaded\x20(0','ultGroup:\x20','changes','r_key,\x20gro','Scoped:\x20','\x20chat_id\x20f','_defaults\x20','connection','NAME\x20TO\x20co','from','\x20for\x20','?,\x20?)\x20\x0a\x20\x20\x20','3195IBzlvp','isArray','\x20NOT\x20NULL\x20','AND\x20name\x20=','etDefaultG','moved\x20all\x20','s\x20WHERE\x20gr','\x22\x20@\x20group\x20','not\x20export','trim','WHERE\x20crea','ET\x20chat_id','\x20\x20\x20\x20\x20ON\x20CO','length','[ERROR]','INSERT\x20INT','on]\x20readin','values','\x20table\x20','roup_id\x20=\x20','p\x20failed\x20f','COMMIT;','-scoped).\x20','up_id\x20FROM','quired\x20for','or_id\x20TEXT','get','hatIdsFrom','eGroupDefa','roup_id,\x20n','set','n]\x20loadGro','_id\x20TEXT\x20N','ultGroup\x20f','ailed\x20for\x20','n\x20complete','split','d\x20connecti','DEFAULT\x20\x27\x27','T\x20NOT\x20NULL','on]\x20insert','d\x20migratio','s\x20WHERE\x20na','entries','\x20@\x20','names\x20prov','\x20->\x20','Cache\x20fail','nectionsCa','ions_new\x20(','warn','ons\x20WHERE\x20','T\x20NULL,\x0a\x20\x20','\x20WHERE\x20use','ized\x20group','ator_id\x20TE','to\x20add\x20gro','DELETE\x20FRO','ByCreatorI','oup_id\x20=\x20?','\x20DEFAULT\x20\x27','\x20\x20\x20\x20\x20creat','d\x20=\x20?','e\x20provided','UES\x20(?,\x20?,','\x20(creator=','led\x20for\x20','AULT\x20\x27\x27,\x0a\x20','s\x20failed','parse','DO\x20UPDATE\x20','lumn','None\x20of\x20th','T\x20NULL\x20DEF','E\x20group_de','\x20now\x20->\x20','\x20KEY,\x0a\x20\x20\x20\x20',',\x20creator_','e,\x20chat_id','join','TEXT\x20PRIMA','\x20PRIMARY\x20K','n]\x20addGrou','on]\x20migrat','\x20name\x20=\x20?\x20','user_key)\x20','e=\x27table\x27\x20','stringify','toLowerCas','up_default'];_0x41ae=function(){return _0x408e32;};return _0x41ae();}function normalizeUserKeyForStorage(_0x465646){const _0x7daf32=_0x157d04;if(!_0x465646)return null;const _0x1d3b20=String(_0x465646)['trim']();if(!_0x1d3b20)return null;return _0x1d3b20[_0x7daf32(0x2a1)]('@')?_0x1d3b20[_0x7daf32(0x1e2)]('@')[0xea0+0x1f+-0xebf]:_0x1d3b20;}export async function ensureSchema(){const _0x1693ef=_0x157d04;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info(_0x1693ef(0x2db)+_0x1693ef(0x299)+'ensured\x20an'+_0x1693ef(0x1e7)+_0x1693ef(0x1e1)+'\x20(arrays-o'+_0x1693ef(0x1ac)+_0x1693ef(0x1d4)+_0x1693ef(0x229)+_0x1693ef(0x2fc));}catch(_0x48d636){error(_0x48d636,_0x1693ef(0x2db)+_0x1693ef(0x304)+'chema\x20fail'+_0x1693ef(0x2a7)+(_0x48d636?.['message']||_0x48d636));throw _0x48d636;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x113885,_0x3b0c78){const _0x290c8e=_0x157d04;try{if(!_0x113885)return;const _0x5758f4=normalizeUserKeyForStorage(_0x113885);if(!_0x5758f4)return;if(!_0x3b0c78){activeGroupByUser[_0x290c8e(0x28c)](_0x5758f4);try{const _0x5b6bc9=await getDb();await _0x5b6bc9[_0x290c8e(0x261)](_0x290c8e(0x1f7)+'M\x20'+ACTIVE_TABLE+(_0x290c8e(0x1f3)+'r_key\x20=\x20?'),[_0x5758f4]);}catch(_0x38d641){warn(_0x290c8e(0x2db)+_0x290c8e(0x27f)+_0x290c8e(0x310)+'\x20active\x20gr'+_0x290c8e(0x2fe)+'on:\x20'+(_0x38d641?.[_0x290c8e(0x1b0)]||_0x38d641));}return;}const _0x464ddb=String(_0x3b0c78);activeGroupByUser[_0x290c8e(0x1dc)](_0x5758f4,_0x464ddb);try{const _0x3177be=await getDb();await _0x3177be[_0x290c8e(0x261)](_0x290c8e(0x1cd)+'O\x20'+ACTIVE_TABLE+(_0x290c8e(0x2e3)+_0x290c8e(0x23d)+_0x290c8e(0x2e6)+_0x290c8e(0x1bd)+_0x290c8e(0x2d3)+_0x290c8e(0x1a0)+'\x20CONFLICT('+_0x290c8e(0x213)+_0x290c8e(0x204)+_0x290c8e(0x29a)+'id\x20=\x20exclu'+_0x290c8e(0x222)+'id'),[_0x5758f4,_0x464ddb]);}catch(_0x44f84f){warn(_0x290c8e(0x2db)+_0x290c8e(0x27f)+'to\x20persist'+'\x20active\x20gr'+_0x290c8e(0x25f)+(_0x44f84f?.['message']||_0x44f84f));}}catch(_0x432c33){warn(_0x290c8e(0x2db)+_0x290c8e(0x247)+_0x290c8e(0x25d)+_0x290c8e(0x2ba)+':\x20'+(_0x432c33?.['message']||_0x432c33));}}export function getActiveGroupForUser(_0x1308e0){const _0x57970f=_0x157d04;try{if(!_0x1308e0)return null;const _0x3829c3=normalizeUserKeyForStorage(_0x1308e0);if(!_0x3829c3)return null;return activeGroupByUser[_0x57970f(0x1d8)](_0x3829c3)||null;}catch(_0x4f093b){return warn(_0x57970f(0x2db)+_0x57970f(0x224)+'veGroupFor'+_0x57970f(0x2ba)+':\x20'+(_0x4f093b?.[_0x57970f(0x1b0)]||_0x4f093b)),null;}}export async function addConnection(_0x2c3823,_0x4a94fe,_0x340d40='',_0x4c4501=''){const _0x824b0a=_0x157d04;try{await ensureSchema();const _0x1a7df4=await getDb(),_0x28a28a=String(_0x4c4501||''),_0x1678b4=await _0x1a7df4['get'](_0x824b0a(0x256)+'t_id\x20FROM\x20'+_0x824b0a(0x1b9)+'s\x20WHERE\x20na'+'me\x20=\x20?\x20AND'+_0x824b0a(0x19d)+'=\x20?',[String(_0x2c3823),_0x28a28a]);if(!_0x1678b4){const _0x164846=[String(_0x4a94fe)];await _0x1a7df4[_0x824b0a(0x261)](_0x824b0a(0x1cd)+_0x824b0a(0x2ce)+_0x824b0a(0x283)+_0x824b0a(0x2c7)+_0x824b0a(0x22b)+_0x824b0a(0x2c2)+_0x824b0a(0x2e6)+'?,\x20?,\x20?,\x20?'+')',[String(_0x2c3823),_0x28a28a,stringifyArray(_0x164846),String(_0x340d40||'')]),info(_0x824b0a(0x2db)+_0x824b0a(0x29c)+':\x20'+_0x2c3823+'\x20->\x20'+_0x4a94fe+_0x824b0a(0x1ff)+_0x340d40+_0x824b0a(0x2f7)+_0x28a28a);if(!connectionsCache[_0x824b0a(0x2d8)](_0x28a28a))connectionsCache[_0x824b0a(0x1dc)](_0x28a28a,new Map());const _0x1559f6=connectionsCache[_0x824b0a(0x1d8)](_0x28a28a);return _0x1559f6[_0x824b0a(0x1dc)](String(_0x2c3823),{'name':String(_0x2c3823),'chat_id':_0x164846[_0x824b0a(0x245)](String),'creator_id':String(_0x340d40||'')}),!![];}else{const _0x305638=parseArrayStrict(_0x1678b4[_0x824b0a(0x2c9)]);if(!_0x305638[_0x824b0a(0x2a1)](String(_0x4a94fe)))_0x305638['push'](String(_0x4a94fe));await _0x1a7df4[_0x824b0a(0x261)](_0x824b0a(0x2af)+_0x824b0a(0x2fd)+'ET\x20chat_id'+_0x824b0a(0x250)+_0x824b0a(0x23a)+'\x20WHERE\x20nam'+_0x824b0a(0x306)+_0x824b0a(0x316)+'\x20?',[stringifyArray(_0x305638),String(_0x340d40||''),String(_0x2c3823),_0x28a28a]),info(_0x824b0a(0x2db)+'n]\x20updated'+':\x20'+_0x2c3823+_0x824b0a(0x1ec)+_0x305638['join'](',')+_0x824b0a(0x2dc)+_0x28a28a);if(!connectionsCache['has'](_0x28a28a))connectionsCache[_0x824b0a(0x1dc)](_0x28a28a,new Map());const _0x19d4a7=connectionsCache['get'](_0x28a28a);return _0x19d4a7['set'](String(_0x2c3823),{'name':String(_0x2c3823),'chat_id':_0x305638[_0x824b0a(0x245)](String),'creator_id':String(_0x340d40||'')}),!![];}}catch(_0x4f296b){return error(_0x4f296b,'[connectio'+_0x824b0a(0x2df)+_0x824b0a(0x2c0)+_0x824b0a(0x200)+_0x2c3823+_0x824b0a(0x1ea)+_0x4c4501),![];}}export async function deleteConnectionScoped(_0x2343a8,_0x11b071=''){const _0xbb1477=_0x157d04;try{await ensureSchema();const _0x4978dd=await getDb(),_0x13b78b=await _0x4978dd[_0xbb1477(0x261)]('DELETE\x20FRO'+_0xbb1477(0x237)+_0xbb1477(0x1f1)+'name\x20=\x20?\x20A'+_0xbb1477(0x2b1)+_0xbb1477(0x1fc),[String(_0x2343a8),String(_0x11b071||'')]),_0x194171=_0x13b78b&&(_0x13b78b['changes']===undefined?!![]:!!_0x13b78b[_0xbb1477(0x1b4)]);info(_0xbb1477(0x2db)+_0xbb1477(0x291)+_0xbb1477(0x2a5)+_0xbb1477(0x2d6)+_0x2343a8+'\x20@\x20'+_0x11b071+_0xbb1477(0x28e)+_0x194171+')');try{const _0x235ecf=String(_0x11b071||'');if(connectionsCache['has'](_0x235ecf)){const _0x4ea42e=connectionsCache[_0xbb1477(0x1d8)](_0x235ecf);if(_0x4ea42e)_0x4ea42e['delete'](String(_0x2343a8));}}catch(_0x310e60){}return _0x194171;}catch(_0x2e3ddf){return error(_0x2e3ddf,'[connectio'+_0xbb1477(0x291)+_0xbb1477(0x2a5)+'coped\x20fail'+_0xbb1477(0x2a7)+_0x2343a8+_0xbb1477(0x1ea)+_0x11b071),![];}}export async function deleteConnectionsByCreatorInGroup(_0x3bd743,_0x5f59c5=''){const _0x373f0c=_0x157d04;try{await ensureSchema();const _0x1cee15=await getDb(),_0x328544=await _0x1cee15[_0x373f0c(0x261)](_0x373f0c(0x1f7)+_0x373f0c(0x237)+_0x373f0c(0x1f1)+_0x373f0c(0x2c2)+_0x373f0c(0x271)+_0x373f0c(0x1d1)+'?',[String(_0x3bd743),String(_0x5f59c5||'')]),_0x2f534f=_0x328544&&(_0x328544[_0x373f0c(0x1b4)]===undefined?!![]:_0x328544[_0x373f0c(0x1b4)])||-0x2*0x4fe+0x409+0x5f3;info(_0x373f0c(0x2db)+_0x373f0c(0x291)+_0x373f0c(0x2ae)+'ByCreatorI'+_0x373f0c(0x240)+_0x3bd743+_0x373f0c(0x1ea)+_0x5f59c5+'\x20(deleted='+_0x2f534f+')');try{const _0xf9c7a1=String(_0x5f59c5||'');if(connectionsCache[_0x373f0c(0x2d8)](_0xf9c7a1)){const _0x44498e=connectionsCache['get'](_0xf9c7a1);for(const [_0x1c7cbd,_0x1a6fc0]of Array['from'](_0x44498e[_0x373f0c(0x1e9)]())){if(String(_0x1a6fc0['creator_id'])===String(_0x3bd743))_0x44498e[_0x373f0c(0x28c)](_0x1c7cbd);}}}catch(_0x2659ff){}return _0x2f534f;}catch(_0x39a816){return error(_0x39a816,_0x373f0c(0x2db)+_0x373f0c(0x291)+_0x373f0c(0x2ae)+_0x373f0c(0x1f8)+'nGroup\x20fai'+_0x373f0c(0x2cb)+(_0x39a816?.[_0x373f0c(0x1b0)]||_0x39a816)),-0x11f3*0x1+0x34c+0xea7;}}export async function removeChatIdsFromConnectionScoped(_0x498f16,_0x1f66e5,_0x419ae2=''){const _0x41269e=_0x157d04;try{if(!_0x498f16)return![];await ensureSchema();const _0x35e2f9=await getDb(),_0x1f5730=await _0x35e2f9[_0x41269e(0x1d8)](_0x41269e(0x256)+_0x41269e(0x318)+'connection'+'s\x20WHERE\x20na'+_0x41269e(0x2a9)+_0x41269e(0x19d)+'=\x20?',[String(_0x498f16),String(_0x419ae2||'')]);if(!_0x1f5730)return![];const _0x4fd65b=parseArrayStrict(_0x1f5730[_0x41269e(0x2c9)]),_0x1ef06c=Array[_0x41269e(0x1bf)](_0x1f66e5)?_0x1f66e5[_0x41269e(0x245)](String):[String(_0x1f66e5)],_0x2049cc=_0x4fd65b[_0x41269e(0x19e)](_0x512390=>!_0x1ef06c[_0x41269e(0x2a1)](_0x512390));if(_0x2049cc['length']===-0x224*0x1+0x1032+-0xe0e){await _0x35e2f9[_0x41269e(0x261)](_0x41269e(0x1f7)+_0x41269e(0x237)+_0x41269e(0x1f1)+_0x41269e(0x282)+_0x41269e(0x2b1)+'d\x20=\x20?',[String(_0x498f16),String(_0x419ae2||'')]),info(_0x41269e(0x2db)+_0x41269e(0x2b6)+_0x41269e(0x1d9)+_0x41269e(0x1a6)+_0x41269e(0x28f)+_0x41269e(0x1c3)+_0x41269e(0x29d)+'r\x20'+_0x498f16+_0x41269e(0x1ea)+_0x419ae2+(_0x41269e(0x2ff)+_0x41269e(0x286)));try{const _0xeaea84=String(_0x419ae2||'');if(connectionsCache[_0x41269e(0x2d8)](_0xeaea84))connectionsCache[_0x41269e(0x1d8)](_0xeaea84)[_0x41269e(0x28c)](String(_0x498f16));}catch(_0x527c8a){}return!![];}else{await _0x35e2f9['run'](_0x41269e(0x2af)+_0x41269e(0x2fd)+_0x41269e(0x1c9)+_0x41269e(0x314)+_0x41269e(0x212)+'AND\x20group_'+_0x41269e(0x19f),[stringifyArray(_0x2049cc),String(_0x498f16),String(_0x419ae2||'')]),info(_0x41269e(0x2db)+'n]\x20removeC'+'hatIdsFrom'+_0x41269e(0x1a6)+_0x41269e(0x1b6)+_0x498f16+'@'+_0x419ae2+_0x41269e(0x209)+_0x2049cc[_0x41269e(0x20d)](','));try{const _0x4e6556=String(_0x419ae2||'');if(!connectionsCache[_0x41269e(0x2d8)](_0x4e6556))connectionsCache[_0x41269e(0x1dc)](_0x4e6556,new Map());connectionsCache[_0x41269e(0x1d8)](_0x4e6556)['set'](String(_0x498f16),{'name':String(_0x498f16),'chat_id':_0x2049cc[_0x41269e(0x245)](String),'creator_id':connectionsCache[_0x41269e(0x1d8)](_0x4e6556)[_0x41269e(0x1d8)](String(_0x498f16))?.[_0x41269e(0x2c2)]||''});}catch(_0x76f9a6){}return!![];}}catch(_0x3aaecf){return error(_0x3aaecf,'[connectio'+_0x41269e(0x2b6)+_0x41269e(0x1d9)+_0x41269e(0x1a6)+_0x41269e(0x2a8)+_0x41269e(0x2cb)+(_0x3aaecf?.['message']||_0x3aaecf)),![];}}export async function listConnectionsForGroup(_0x336111){const _0x307deb=_0x157d04;try{await ensureSchema();const _0x639210=String(_0x336111||'');if(connectionsCache[_0x307deb(0x2d8)](_0x639210)){const _0x4f0c46=connectionsCache['get'](_0x639210);return Array[_0x307deb(0x1bb)](_0x4f0c46[_0x307deb(0x1cf)]())['map'](_0x13ccd7=>({'name':_0x13ccd7[_0x307deb(0x26c)],'chat_id':Array[_0x307deb(0x1bf)](_0x13ccd7[_0x307deb(0x2c9)])?_0x13ccd7[_0x307deb(0x2c9)][_0x307deb(0x245)](String):[],'creator_id':_0x13ccd7[_0x307deb(0x2c2)]}));}const _0x522a2e=await getDb(),_0x168e17=await _0x522a2e[_0x307deb(0x233)]('SELECT\x20nam'+_0x307deb(0x20c)+_0x307deb(0x20b)+_0x307deb(0x230)+'nnections\x20'+_0x307deb(0x2fb)+'p_id\x20=\x20?\x20O'+'RDER\x20BY\x20na'+'me',[_0x639210]);return(_0x168e17||[])[_0x307deb(0x245)](_0x1ae770=>({'name':_0x1ae770[_0x307deb(0x26c)],'chat_id':parseArrayStrict(_0x1ae770['chat_id']),'creator_id':_0x1ae770[_0x307deb(0x2c2)]}));}catch(_0x117355){return error(_0x117355,'[connectio'+'n]\x20listCon'+'nectionsFo'+_0x307deb(0x257)+_0x307deb(0x2cb)+(_0x117355?.[_0x307deb(0x1b0)]||_0x117355)),[];}}export async function listConnectionsForUser(_0x58e705,_0xaad8dd=null){const _0x2f1c2d=_0x157d04;try{await ensureSchema();const _0x18ab20=await getDb();if(_0xaad8dd){const _0x38535e=await _0x18ab20['all'](_0x2f1c2d(0x246)+_0x2f1c2d(0x20c)+_0x2f1c2d(0x20b)+'id\x20FROM\x20co'+_0x2f1c2d(0x1a8)+_0x2f1c2d(0x1c8)+_0x2f1c2d(0x23a)+'\x20AND\x20group'+_0x2f1c2d(0x1a3)+'DER\x20BY\x20nam'+'e',[String(_0x58e705),String(_0xaad8dd)]);return(_0x38535e||[])[_0x2f1c2d(0x245)](_0x54a8f6=>({'name':_0x54a8f6[_0x2f1c2d(0x26c)],'chat_id':parseArrayStrict(_0x54a8f6[_0x2f1c2d(0x2c9)]),'creator_id':_0x54a8f6['creator_id']}));}else{const _0x2c0ca2=await _0x18ab20[_0x2f1c2d(0x233)](_0x2f1c2d(0x246)+_0x2f1c2d(0x20c)+',\x20creator_'+'id,\x20group_'+_0x2f1c2d(0x230)+'nnections\x20'+_0x2f1c2d(0x1c8)+_0x2f1c2d(0x23a)+_0x2f1c2d(0x252)+_0x2f1c2d(0x248)+_0x2f1c2d(0x26c),[String(_0x58e705)]);return(_0x2c0ca2||[])[_0x2f1c2d(0x245)](_0x1de287=>({'name':_0x1de287[_0x2f1c2d(0x26c)],'chat_id':parseArrayStrict(_0x1de287[_0x2f1c2d(0x2c9)]),'creator_id':_0x1de287[_0x2f1c2d(0x2c2)],'group_id':_0x1de287[_0x2f1c2d(0x24a)]}));}}catch(_0x5270cf){return error(_0x5270cf,_0x2f1c2d(0x2db)+_0x2f1c2d(0x1a5)+_0x2f1c2d(0x236)+_0x2f1c2d(0x251)+'ed'),[];}}export async function listAllConnections(){const _0x4bd5a0=_0x157d04;try{await ensureSchema();const _0x4ca1ea=await getDb(),_0x3ab290=await _0x4ca1ea[_0x4bd5a0(0x233)]('SELECT\x20nam'+_0x4bd5a0(0x20c)+',\x20creator_'+_0x4bd5a0(0x223)+_0x4bd5a0(0x230)+_0x4bd5a0(0x1a8)+_0x4bd5a0(0x231)+_0x4bd5a0(0x1db)+_0x4bd5a0(0x294));return(_0x3ab290||[])[_0x4bd5a0(0x245)](_0x245537=>({'name':_0x245537['name'],'chat_id':parseArrayStrict(_0x245537[_0x4bd5a0(0x2c9)]),'creator_id':_0x245537['creator_id'],'group_id':_0x245537[_0x4bd5a0(0x24a)]}));}catch(_0x3c9151){return error(_0x3c9151,_0x4bd5a0(0x2db)+'n]\x20listAll'+_0x4bd5a0(0x1a6)+_0x4bd5a0(0x202)),[];}}export async function getConnectionScoped(_0x57a9e3,_0x289842=''){const _0x2f40a6=_0x157d04;try{await ensureSchema();const _0x18ca22=String(_0x289842||'');if(connectionsCache[_0x2f40a6(0x2d8)](_0x18ca22)&&connectionsCache['get'](_0x18ca22)['has'](String(_0x57a9e3)))return connectionsCache[_0x2f40a6(0x1d8)](_0x18ca22)[_0x2f40a6(0x1d8)](String(_0x57a9e3))[_0x2f40a6(0x2c9)]['slice']();const _0x43f895=await getDb(),_0x146c8e=await _0x43f895['get'](_0x2f40a6(0x256)+_0x2f40a6(0x318)+'connection'+'s\x20WHERE\x20na'+'me\x20=\x20?\x20AND'+_0x2f40a6(0x19d)+_0x2f40a6(0x274),[String(_0x57a9e3),_0x18ca22]);if(!_0x146c8e)return null;return parseArrayStrict(_0x146c8e[_0x2f40a6(0x2c9)]);}catch(_0x4886d0){return error(_0x4886d0,_0x2f40a6(0x2db)+_0x2f40a6(0x285)+'ectionScop'+_0x2f40a6(0x1a2)+_0x57a9e3+'\x20@\x20'+_0x289842+_0x2f40a6(0x275)),null;}}export async function getConnectionRecordScoped(_0x5b6463,_0x190dbf=''){const _0x3d7e0b=_0x157d04;try{await ensureSchema();const _0x45b1bc=String(_0x190dbf||'');if(connectionsCache['has'](_0x45b1bc)&&connectionsCache['get'](_0x45b1bc)[_0x3d7e0b(0x2d8)](String(_0x5b6463))){const _0x2a128a=connectionsCache[_0x3d7e0b(0x1d8)](_0x45b1bc)[_0x3d7e0b(0x1d8)](String(_0x5b6463));return{'name':_0x2a128a[_0x3d7e0b(0x26c)],'chat_id':_0x2a128a[_0x3d7e0b(0x2c9)]['slice'](),'creator_id':_0x2a128a[_0x3d7e0b(0x2c2)]};}const _0x3a2b76=await getDb(),_0x41a2de=await _0x3a2b76[_0x3d7e0b(0x1d8)](_0x3d7e0b(0x246)+_0x3d7e0b(0x20c)+',\x20creator_'+'id\x20FROM\x20co'+'nnections\x20'+_0x3d7e0b(0x23e)+_0x3d7e0b(0x271)+'roup_id\x20=\x20'+'?',[String(_0x5b6463),_0x45b1bc]);if(!_0x41a2de)return null;return{'name':_0x41a2de[_0x3d7e0b(0x26c)],'chat_id':parseArrayStrict(_0x41a2de[_0x3d7e0b(0x2c9)]),'creator_id':_0x41a2de[_0x3d7e0b(0x2c2)]};}catch(_0x1ad6fd){return error(_0x1ad6fd,_0x3d7e0b(0x2db)+_0x3d7e0b(0x285)+_0x3d7e0b(0x301)+'rdScoped('+_0x5b6463+'\x20@\x20'+_0x190dbf+_0x3d7e0b(0x275)),null;}}export async function getConnectionName(_0xf02599){const _0x32b2b8=_0x157d04;try{await ensureSchema();for(const [_0x596fb8,_0x4b5e7e]of connectionsCache[_0x32b2b8(0x1e9)]()){for(const [_0x10cbd6,_0x3f66ce]of _0x4b5e7e[_0x32b2b8(0x1e9)]()){if(Array[_0x32b2b8(0x1bf)](_0x3f66ce[_0x32b2b8(0x2c9)])&&_0x3f66ce[_0x32b2b8(0x2c9)][_0x32b2b8(0x2a1)](String(_0xf02599)))return _0x10cbd6;}}const _0x12338c=await getDb(),_0x28e4c3=await _0x12338c[_0x32b2b8(0x233)](_0x32b2b8(0x246)+_0x32b2b8(0x20c)+_0x32b2b8(0x198)+'ections');for(const _0x32c6e4 of _0x28e4c3||[]){const _0x259bde=parseArrayStrict(_0x32c6e4['chat_id']);if(_0x259bde['includes'](String(_0xf02599)))return _0x32c6e4[_0x32b2b8(0x26c)];}return null;}catch(_0x3845f1){return error(_0x3845f1,'[connectio'+_0x32b2b8(0x285)+_0x32b2b8(0x279)+'('+_0xf02599+_0x32b2b8(0x275)),null;}}function _0x38e8(_0x1fc888,_0x17ad5b){_0x1fc888=_0x1fc888-(0x1*0x1b77+0x1f9e+-0x167*0x29);const _0xb3f14f=_0x41ae();let _0x124d65=_0xb3f14f[_0x1fc888];return _0x124d65;}export async function setDefaultGroup(_0x490ea0,_0x1ac7dd){const _0x3469a6=_0x157d04;try{await ensureSchema();const _0x581a18=await getDb();if(!_0x1ac7dd)throw new Error(_0x3469a6(0x238)+_0x3469a6(0x1d6)+'\x20setDefaul'+_0x3469a6(0x298));if(!_0x490ea0||Array[_0x3469a6(0x1bf)](_0x490ea0)&&_0x490ea0['length']===-0x1*0x21ab+0x1479+0x3*0x466)return await _0x581a18[_0x3469a6(0x261)](_0x3469a6(0x1f7)+_0x3469a6(0x2de)+_0x3469a6(0x19a)+_0x3469a6(0x2cc)+_0x3469a6(0x1fc),[String(_0x1ac7dd)]),groupDefaultsCache[_0x3469a6(0x28c)](String(_0x1ac7dd)),info('[connectio'+_0x3469a6(0x26f)+'efault\x20cle'+_0x3469a6(0x21f)+_0x1ac7dd),!![];let _0x26de05=[];if(typeof _0x490ea0===_0x3469a6(0x196)&&_0x490ea0[_0x3469a6(0x216)+'e']()===_0x3469a6(0x233)){const _0x369a0e=await listConnectionsForGroup(String(_0x1ac7dd));_0x26de05=(_0x369a0e||[])['map'](_0x4da36b=>_0x4da36b[_0x3469a6(0x26c)])[_0x3469a6(0x19e)](Boolean);if(!_0x26de05[_0x3469a6(0x1cb)])throw new Error(_0x3469a6(0x303)+_0x3469a6(0x305)+'\x20to\x20set\x20as'+'\x20all');}else{if(Array[_0x3469a6(0x1bf)](_0x490ea0))_0x26de05=_0x490ea0[_0x3469a6(0x245)](String)['filter'](Boolean);else{if(typeof _0x490ea0===_0x3469a6(0x196)){if(_0x490ea0['includes'](','))_0x26de05=_0x490ea0[_0x3469a6(0x1e2)](',')[_0x3469a6(0x245)](_0x2c8b6e=>_0x2c8b6e['trim']())[_0x3469a6(0x19e)](Boolean);else _0x26de05=[_0x490ea0];}else throw new Error(_0x3469a6(0x312)+_0x3469a6(0x2f9)+_0x3469a6(0x270)+_0x3469a6(0x315)+'aultGroup');}}if(!_0x26de05[_0x3469a6(0x1cb)])throw new Error('No\x20valid\x20c'+'onnection\x20'+_0x3469a6(0x1eb)+_0x3469a6(0x26d)+_0x3469a6(0x1c2)+_0x3469a6(0x30a));const _0x2a713e=[];for(const _0x1c534b of _0x26de05){const _0x10e6a0=await _0x581a18[_0x3469a6(0x1d8)](_0x3469a6(0x289)+_0x3469a6(0x225)+_0x3469a6(0x1aa)+_0x3469a6(0x277)+'\x20AND\x20group'+_0x3469a6(0x1af),[String(_0x1c534b),String(_0x1ac7dd)]);if(_0x10e6a0)_0x2a713e[_0x3469a6(0x22a)](_0x1c534b);else warn(_0x3469a6(0x2db)+_0x3469a6(0x27e)+_0x3469a6(0x1b3)+'skipping\x20n'+_0x3469a6(0x22c)+'t\x20connecti'+_0x3469a6(0x25c)+_0x1c534b+_0x3469a6(0x259)+_0x1ac7dd);}if(!_0x2a713e[_0x3469a6(0x1cb)])throw new Error(_0x3469a6(0x206)+_0x3469a6(0x1fd)+_0x3469a6(0x2be)+'n\x20names\x20ex'+_0x3469a6(0x25b)+_0x3469a6(0x319));return await _0x581a18[_0x3469a6(0x261)]('INSERT\x20INT'+_0x3469a6(0x2c8)+_0x3469a6(0x262)+_0x3469a6(0x2d7)+_0x3469a6(0x239)+_0x3469a6(0x24e)+_0x3469a6(0x1ca)+_0x3469a6(0x22d)+_0x3469a6(0x197)+_0x3469a6(0x2f8)+_0x3469a6(0x284)+_0x3469a6(0x235)+'e;',[String(_0x1ac7dd),JSON['stringify'](_0x2a713e)]),groupDefaultsCache[_0x3469a6(0x1dc)](String(_0x1ac7dd),_0x2a713e[_0x3469a6(0x2d5)]()),info('[connectio'+_0x3469a6(0x26f)+'efault\x20set'+_0x3469a6(0x1bc)+_0x1ac7dd+_0x3469a6(0x1ec)+JSON[_0x3469a6(0x215)](_0x2a713e)),!![];}catch(_0x5396da){return error(_0x5396da,_0x3469a6(0x2db)+_0x3469a6(0x27e)+_0x3469a6(0x1df)+_0x3469a6(0x1e0)+_0x1ac7dd+':\x20'+(_0x5396da?.[_0x3469a6(0x1b0)]||_0x5396da)),![];}}export async function getDefaultForGroup(_0x86e3da){const _0x47520a=_0x157d04;try{await ensureSchema();if(!_0x86e3da)return null;const _0x329a77=String(_0x86e3da);if(groupDefaultsCache[_0x47520a(0x2d8)](_0x329a77)){const _0x165bb2=groupDefaultsCache[_0x47520a(0x1d8)](_0x329a77);return Array[_0x47520a(0x1bf)](_0x165bb2)?_0x165bb2[_0x47520a(0x245)](String):null;}const _0x57d602=await getDb(),_0x2461f3=await _0x57d602[_0x47520a(0x1d8)]('SELECT\x20nam'+_0x47520a(0x1ae)+_0x47520a(0x217)+_0x47520a(0x1c4)+_0x47520a(0x1f9),[_0x329a77]);if(!_0x2461f3||!_0x2461f3[_0x47520a(0x26c)])return null;try{const _0x5dba1d=JSON[_0x47520a(0x203)](_0x2461f3[_0x47520a(0x26c)]);if(Array[_0x47520a(0x1bf)](_0x5dba1d))return groupDefaultsCache['set'](_0x329a77,_0x5dba1d[_0x47520a(0x245)](String)),_0x5dba1d[_0x47520a(0x245)](String);}catch(_0x2b7bf8){}return null;}catch(_0x3c4b4b){return error(_0x3c4b4b,_0x47520a(0x2db)+'n]\x20getDefa'+'ultForGrou'+_0x47520a(0x1d2)+_0x47520a(0x23b)+_0x86e3da),null;}}export async function getDefault(_0x454db5){const _0x3c278e=_0x157d04;try{await ensureSchema();const _0x3a3fd4=getActiveGroupForUser(String(_0x454db5));if(!_0x3a3fd4)return null;return await getDefaultForGroup(_0x3a3fd4);}catch(_0x3b897f){return error(_0x3b897f,_0x3c278e(0x2db)+'n]\x20getDefa'+'ult\x20failed'+_0x3c278e(0x1bc)+_0x454db5),null;}}export async function getConnection(_0xc16e35){const _0x1b870a=_0x157d04;try{await ensureSchema();const _0xb952b6=await getDb(),_0x3b8912=await _0xb952b6[_0x1b870a(0x233)]('SELECT\x20cha'+_0x1b870a(0x318)+_0x1b870a(0x1b9)+_0x1b870a(0x1e8)+_0x1b870a(0x232),[String(_0xc16e35)]);if(!_0x3b8912||!_0x3b8912['length'])return null;const _0x1d427c=[];for(const _0x2098b3 of _0x3b8912){const _0x200279=parseArrayStrict(_0x2098b3[_0x1b870a(0x2c9)]);for(const _0x70738b of _0x200279)if(!_0x1d427c[_0x1b870a(0x2a1)](_0x70738b))_0x1d427c[_0x1b870a(0x22a)](_0x70738b);}return _0x1d427c;}catch(_0x2fce20){return error(_0x2fce20,'[connectio'+_0x1b870a(0x285)+_0x1b870a(0x2a2)+_0xc16e35+_0x1b870a(0x275)),null;}}export async function getConnectionRecord(_0x33ac87){const _0x326377=_0x157d04;try{await ensureSchema();const _0x9138f0=await getDb(),_0x59dfee=await _0x9138f0[_0x326377(0x1d8)](_0x326377(0x246)+_0x326377(0x20c)+_0x326377(0x20b)+_0x326377(0x223)+_0x326377(0x230)+_0x326377(0x1a8)+_0x326377(0x23e)+_0x326377(0x28d)+'\x201',[String(_0x33ac87)]);if(!_0x59dfee)return null;return{'name':_0x59dfee[_0x326377(0x26c)],'chat_id':parseArrayStrict(_0x59dfee[_0x326377(0x2c9)]),'creator_id':_0x59dfee[_0x326377(0x2c2)],'group_id':_0x59dfee[_0x326377(0x24a)]};}catch(_0x8afbe2){return error(_0x8afbe2,_0x326377(0x2db)+_0x326377(0x285)+'ectionReco'+_0x326377(0x309)+_0x33ac87+')\x20failed'),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};