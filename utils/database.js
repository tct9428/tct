const _0x5d3e18=_0x5a51;(function(_0x2b4f19,_0x10eea5){const _0x555fc8=_0x5a51,_0x119bee=_0x2b4f19();while(!![]){try{const _0x40e13f=parseInt(_0x555fc8(0x1ac))/(-0x2330+0x19ff+0xb*0xd6)*(-parseInt(_0x555fc8(0x1bb))/(-0x1b51+-0x1*0x1c61+0x37b4))+-parseInt(_0x555fc8(0x13d))/(0x129e+-0x2359+-0x1*-0x10be)*(parseInt(_0x555fc8(0x115))/(0x1808+-0x25bb+0xdb7))+-parseInt(_0x555fc8(0x16d))/(0x1*0xa1c+-0x698+-0x5*0xb3)*(-parseInt(_0x555fc8(0x18b))/(0xcb*0x29+-0x976*0x4+0x3*0x1c9))+parseInt(_0x555fc8(0x1ce))/(0x13b0+0x15c8+-0x2971)+parseInt(_0x555fc8(0x1a8))/(-0x4d*-0x16+0x1c66+0x2*-0x117e)+-parseInt(_0x555fc8(0xe8))/(-0x76*-0x36+-0x1d3f*0x1+-0x4*-0x119)+parseInt(_0x555fc8(0x185))/(0x13ef+0xad3+-0x2*0xf5c);if(_0x40e13f===_0x10eea5)break;else _0x119bee['push'](_0x119bee['shift']());}catch(_0x278d0a){_0x119bee['push'](_0x119bee['shift']());}}}(_0x4218,0x1*0xa8b14+-0x5a9c*-0x5+0xea*-0x4d5));function _0x5a51(_0x893117,_0x48392f){_0x893117=_0x893117-(0x2657*-0x1+-0x41*0x8d+-0x4afe*-0x1);const _0x411ccb=_0x4218();let _0x22b17f=_0x411ccb[_0x893117];return _0x22b17f;}import _0x5da740 from'fs-extra';import _0x4f5a71 from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;let usingNative=![],setStmt=null,deleteStmt=null,logStmt=null,dbReady=![],writeQueue=[],queueBytes=-0x55*-0x2b+-0xaa6+-0x3a1,maxTotalBytes=0x9f+-0x149f*0x1+0x1400,isFlushing=![],lastFlushTime=-0x21a6+0x6ff*0x3+0xca9,flushTimer=null,lastDiskSaveTime=-0x13a6+0x79f*-0x3+-0x2a83*-0x1;const DISK_SAVE_THROTTLE_MS=0xdcd+-0x12a5+-0x35*-0x50;let cache=null;function estimateQueueItemSize(_0x1165cf){const _0x4946d9=_0x5a51,_0x531adc=-0x2*0xe6e+0x3*0x797+0x667;switch(_0x1165cf['type']){case _0x4946d9(0x1a5):return Buffer[_0x4946d9(0x1ab)](_0x1165cf[_0x4946d9(0x13a)],'utf8')+Buffer[_0x4946d9(0x1ab)](_0x1165cf[_0x4946d9(0x1a7)],_0x4946d9(0x12c))+_0x531adc;case _0x4946d9(0x1c4):return Buffer['byteLength'](_0x1165cf[_0x4946d9(0x13a)],'utf8')+_0x531adc;case _0x4946d9(0x130):return-0x2*0xbd4+0x1*-0x8bc+0x1*0x212c+Buffer[_0x4946d9(0x1ab)](_0x1165cf['data']?.[_0x4946d9(0x180)]||'',_0x4946d9(0x12c));default:return 0x1ecb+-0x218b+0x340;}}class MemoryCache{constructor(_0x2b32fa){const _0x4bfe24=_0x5a51;this['maxBytes']=_0x2b32fa,this[_0x4bfe24(0x11d)]=0x302*-0xa+-0x7*-0x1ba+0x11fe,this[_0x4bfe24(0x1b8)]=new Map(),this[_0x4bfe24(0x116)]={'prev':null,'next':null},this['tail']={'prev':null,'next':null},this['head'][_0x4bfe24(0x1cd)]=this['tail'],this[_0x4bfe24(0x141)]['prev']=this[_0x4bfe24(0x116)];}static[_0x5d3e18(0x178)+'ze'](_0x41cc88,_0x36c96e){const _0xfa4724=_0x5d3e18,_0x463be4=Buffer['byteLength'](String(_0x41cc88),'utf8'),_0x187dbb=Buffer[_0xfa4724(0x1ab)](_0x36c96e??'',_0xfa4724(0x12c));return _0x463be4+_0x187dbb+(-0x1*-0xc25+-0x2020+0x143b);}[_0x5d3e18(0x1da)+'e'](_0x26a5ef){const _0x16f4e6=_0x5d3e18;_0x26a5ef[_0x16f4e6(0x1d3)][_0x16f4e6(0x1cd)]=_0x26a5ef[_0x16f4e6(0x1cd)],_0x26a5ef['next'][_0x16f4e6(0x1d3)]=_0x26a5ef['prev'];}[_0x5d3e18(0xfd)](_0x5dfdf0){const _0x567e38=_0x5d3e18;_0x5dfdf0['prev']=this['tail'][_0x567e38(0x1d3)],_0x5dfdf0[_0x567e38(0x1cd)]=this[_0x567e38(0x141)],this['tail']['prev'][_0x567e38(0x1cd)]=_0x5dfdf0,this[_0x567e38(0x141)][_0x567e38(0x1d3)]=_0x5dfdf0;}[_0x5d3e18(0x11a)+'l'](_0xccbc11){const _0x44a414=_0x5d3e18;this[_0x44a414(0x1da)+'e'](_0xccbc11),this[_0x44a414(0xfd)](_0xccbc11);}[_0x5d3e18(0x147)](_0x33a21d){const _0x4791c5=_0x5d3e18;return this[_0x4791c5(0x1b8)][_0x4791c5(0x147)](_0x33a21d);}[_0x5d3e18(0x1b6)](_0x2999a4){const _0x12497c=_0x5d3e18,_0xc3ed22=this[_0x12497c(0x1b8)][_0x12497c(0x1b6)](_0x2999a4);if(!_0xc3ed22)return undefined;return this[_0x12497c(0x11a)+'l'](_0xc3ed22),_0xc3ed22[_0x12497c(0x1a7)];}[_0x5d3e18(0x1a5)](_0x3155b4,_0x268038,_0x16ddb1){const _0x9eb13a=_0x5d3e18,_0x3cb010=this[_0x9eb13a(0x1b8)]['get'](_0x3155b4),_0x18c3fe=MemoryCache[_0x9eb13a(0x178)+'ze'](_0x3155b4,_0x16ddb1);if(_0x18c3fe>this[_0x9eb13a(0x16a)]){if(_0x3cb010)this['delete'](_0x3155b4);return;}if(_0x3cb010)this[_0x9eb13a(0x11d)]-=_0x3cb010['size'],_0x3cb010[_0x9eb13a(0x1a7)]=_0x268038,_0x3cb010[_0x9eb13a(0xf1)]=_0x16ddb1,_0x3cb010[_0x9eb13a(0x1d8)]=_0x18c3fe,this[_0x9eb13a(0x11d)]+=_0x18c3fe,this[_0x9eb13a(0x11a)+'l'](_0x3cb010);else{const _0x36cef2={'key':_0x3155b4,'value':_0x268038,'serialized':_0x16ddb1,'size':_0x18c3fe,'prev':null,'next':null};this[_0x9eb13a(0x1b8)][_0x9eb13a(0x1a5)](_0x3155b4,_0x36cef2),this[_0x9eb13a(0xfd)](_0x36cef2),this[_0x9eb13a(0x11d)]+=_0x18c3fe;}while(this[_0x9eb13a(0x11d)]>this['maxBytes']){const _0x3d2a81=this['head'][_0x9eb13a(0x1cd)];if(_0x3d2a81===this[_0x9eb13a(0x141)])break;this[_0x9eb13a(0x1c4)](_0x3d2a81[_0x9eb13a(0x13a)]);}}['delete'](_0x3b167a){const _0x479247=_0x5d3e18,_0x30f67e=this[_0x479247(0x1b8)][_0x479247(0x1b6)](_0x3b167a);if(!_0x30f67e)return;this[_0x479247(0x1da)+'e'](_0x30f67e),this['map']['delete'](_0x3b167a),this[_0x479247(0x11d)]-=_0x30f67e['size'];}}function enforceMemoryLimit(){const _0x4c13cd=_0x5d3e18;while(cache&&cache[_0x4c13cd(0x11d)]+queueBytes>maxTotalBytes&&writeQueue[_0x4c13cd(0x118)]>0x5c0+-0xce9+0x729){const _0x26bd20=writeQueue[_0x4c13cd(0x1df)]();if(_0x26bd20[_0x4c13cd(0x1d8)])queueBytes-=_0x26bd20[_0x4c13cd(0x1d8)];_0x26bd20[_0x4c13cd(0x113)]!==_0x4c13cd(0x130)&&warn('Write\x20queu'+'e\x20memory\x20p'+_0x4c13cd(0x16e)+_0x4c13cd(0x1cb)+_0x4c13cd(0x169)+_0x4c13cd(0x161)+_0x26bd20[_0x4c13cd(0x113)]);}}function normalizeBindParams(_0x504bf6){const _0x4e4abd=_0x5d3e18;if(!_0x504bf6||_0x504bf6['length']===-0x1c02+-0x1*0x18e0+0x34e2)return undefined;if(_0x504bf6[_0x4e4abd(0x118)]===-0x1f24+0x58d+0xfc*0x1a&&Array[_0x4e4abd(0x17f)](_0x504bf6[-0x97*-0x35+-0x12c2+-0xc81]))return _0x504bf6[0x4b*0x26+-0x574*-0x1+-0x1096];if(_0x504bf6['length']===-0x8e4+0x1037+0x2*-0x3a9&&typeof _0x504bf6[-0xb3*-0x11+0xc76+-0x17*0x10f]==='object'&&_0x504bf6[-0x95*-0x9+0x26*0x80+-0x183d]!==null&&!Array[_0x4e4abd(0x17f)](_0x504bf6[-0x6a1*0x3+-0x5f0+0x1*0x19d3]))return _0x504bf6[0x12c3*0x2+-0x1297*0x2+-0x58];return _0x504bf6;}function isTableAlreadyExistsError(_0x3e35a7){const _0x3dcd84=_0x5d3e18,_0x9c3e=_0x3e35a7&&(_0x3e35a7[_0x3dcd84(0x180)]||String(_0x3e35a7))||'';return/table .* already exists/i['test'](_0x9c3e)||/\balready exists\b/i[_0x3dcd84(0x168)](_0x9c3e);}function isUniqueConstraintError(_0x1e056c){const _0x475109=_0x5d3e18,_0x2b0900=_0x1e056c&&(_0x1e056c['message']||String(_0x1e056c))||'';return/UNIQUE constraint failed/i['test'](_0x2b0900)||/UNIQUE constraint/i[_0x475109(0x168)](_0x2b0900);}function looksLikeSimpleInsert(_0x17f5b0){const _0x3e89d8=_0x5d3e18;if(!_0x17f5b0||typeof _0x17f5b0!==_0x3e89d8(0x17e))return![];return/^\s*INSERT\s+INTO\s+/i[_0x3e89d8(0x168)](_0x17f5b0)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x3e89d8(0x168)](_0x17f5b0);}function getUniquePolicy(){const _0x414bb8=_0x5d3e18;try{const _0x13242f=getConfig();return String(_0x13242f?.[_0x414bb8(0x197)+_0x414bb8(0x1b1)+_0x414bb8(0x167)]||_0x414bb8(0x104))[_0x414bb8(0x158)+'e']()[_0x414bb8(0xf6)]();}catch(_0x134e9a){return _0x414bb8(0x104);}}let dbInitializingPromise=null;function isDbClosedError(_0x5eb37d){const _0x29510b=_0x5d3e18;if(!_0x5eb37d)return![];const _0x1bfcef=String(_0x5eb37d[_0x29510b(0x180)]||_0x5eb37d||'');if(/database is closed/i[_0x29510b(0x168)](_0x1bfcef))return!![];if(/SQLITE_MISUSE/i['test'](_0x1bfcef))return!![];return![];}async function scheduleReinitializeAfterError(_0x32e721){const _0x266d7e=_0x5d3e18;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;return warn(_0x266d7e(0x16c)+_0x266d7e(0x192)+_0x266d7e(0xf0)+_0x266d7e(0x110)+_0x266d7e(0x15a)+(_0x32e721?.[_0x266d7e(0x180)]||_0x32e721)),dbInitializingPromise=((async()=>{const _0x902dad=_0x266d7e;await new Promise(_0x1452c4=>setTimeout(_0x1452c4,0x1912+-0x1b*0xe5+0x5*0x161));try{await initializeDatabase(),info('DB\x20reiniti'+_0x902dad(0x1bf)+'omatically'+_0x902dad(0x17d)+'or.');}catch(_0x5b9696){error(_0x902dad(0x152)+'DB\x20reiniti'+_0x902dad(0x1db)+_0x902dad(0x175),_0x5b9696),setTimeout(()=>scheduleReinitializeAfterError(_0x5b9696),0x3009+0x1*-0x17c6+0xecd);}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function createNativeAdapter(_0x503981){return{'_underlying':_0x503981,async 'exec'(_0x5f9f44){const _0x46a52b=_0x5a51;try{await _0x503981[_0x46a52b(0x1dd)](_0x5f9f44);}catch(_0x54af4a){if(isTableAlreadyExistsError(_0x54af4a))return;throw _0x54af4a;}},async 'get'(_0x44caea,..._0x3a3833){const _0x2142f5=_0x5a51;return await _0x503981[_0x2142f5(0x1b6)](_0x44caea,normalizeBindParams(_0x3a3833));},async 'all'(_0x101e5e,..._0x42fe59){const _0x2286b7=_0x5a51;return await _0x503981[_0x2286b7(0x107)](_0x101e5e,normalizeBindParams(_0x42fe59));},async 'run'(_0x2b455d,..._0x5dae46){const _0x3059d6=_0x5a51;return await _0x503981[_0x3059d6(0x12e)](_0x2b455d,normalizeBindParams(_0x5dae46));},async 'prepare'(_0x37d36f){const _0x47c4c6=await _0x503981['prepare'](_0x37d36f);return{async 'run'(..._0x493a08){const _0x4cd850=_0x5a51;return await _0x47c4c6[_0x4cd850(0x12e)](normalizeBindParams(_0x493a08));},async 'finalize'(){const _0x1743de=_0x5a51;await _0x47c4c6[_0x1743de(0xe1)]();}};},async 'close'(){const _0x147e7f=_0x5a51;await _0x503981[_0x147e7f(0x117)]();},'export'(){return undefined;}};}function createSQLjsAdapter(_0x4e6932){const _0x330a30=_0x4e6932;return{'_underlying':_0x330a30,async 'exec'(_0x1d9121){const _0x12e46e=_0x5a51;try{_0x330a30[_0x12e46e(0x12e)](_0x1d9121);}catch(_0x453546){if(isTableAlreadyExistsError(_0x453546))return;throw _0x453546;}},async 'get'(_0x573e5d,..._0x10a239){const _0x18e109=_0x5a51,_0x352cd6=_0x330a30[_0x18e109(0x172)](_0x573e5d);try{const _0x5e72cc=normalizeBindParams(_0x10a239);if(_0x5e72cc!==undefined)_0x352cd6[_0x18e109(0x1bd)](_0x5e72cc);if(_0x352cd6[_0x18e109(0xdc)]())return _0x352cd6[_0x18e109(0xfc)+'t']();return undefined;}finally{_0x352cd6[_0x18e109(0x1dc)]();}},async 'all'(_0x356374,..._0x76e9b1){const _0x3d9953=_0x5a51,_0xe94dcd=_0x330a30[_0x3d9953(0x172)](_0x356374),_0x5825e7=[];try{const _0x2dcdb6=normalizeBindParams(_0x76e9b1);if(_0x2dcdb6!==undefined)_0xe94dcd[_0x3d9953(0x1bd)](_0x2dcdb6);while(_0xe94dcd[_0x3d9953(0xdc)]())_0x5825e7['push'](_0xe94dcd[_0x3d9953(0xfc)+'t']());return _0x5825e7;}finally{_0xe94dcd[_0x3d9953(0x1dc)]();}},async 'run'(_0x4c25d5,..._0x1b73eb){const _0xe4de7b=_0x5a51,_0x3e9ff9=normalizeBindParams(_0x1b73eb);if(_0x3e9ff9===undefined)_0x330a30['run'](_0x4c25d5);else{const _0x44f866=_0x330a30['prepare'](_0x4c25d5);try{_0x44f866[_0xe4de7b(0x1bd)](_0x3e9ff9),_0x44f866[_0xe4de7b(0x12e)]();}finally{_0x44f866[_0xe4de7b(0x1dc)]();}}return{'changes':_0x330a30['getRowsMod'+_0xe4de7b(0x10a)]?_0x330a30[_0xe4de7b(0x1a2)+'ified']():-0x1*0xd2b+0xa3*-0xd+0x1572};},async 'prepare'(_0x1d1ece){const _0xedb14e=_0x5a51,_0x36ae17=_0x330a30[_0xedb14e(0x172)](_0x1d1ece);return{async 'run'(..._0x42240f){const _0x2f1f9d=_0xedb14e,_0x186f4f=normalizeBindParams(_0x42240f);if(_0x186f4f!==undefined)_0x36ae17['bind'](_0x186f4f);return _0x36ae17[_0x2f1f9d(0x12e)](),_0x36ae17[_0x2f1f9d(0x150)](),{'changes':0x0};},async 'finalize'(){const _0x3c14ef=_0xedb14e;_0x36ae17[_0x3c14ef(0x1dc)]();}};},'export'(){const _0x415d4b=_0x5a51;return _0x330a30[_0x415d4b(0x174)]();},async 'close'(){const _0x4fb888=_0x5a51;if(_0x330a30[_0x4fb888(0x117)])_0x330a30[_0x4fb888(0x117)]();}};}function _0x4218(){const _0x33ab1b=['DB_CACHE_M','QUE\x20INDEX\x20','tail','EFAULT\x20\x27[]','Loaded\x20DB\x20','pathExists','move','t_updated\x20','has','exit','M\x20key_valu','SACTION;','g\x20database','SIGTERM','MARY\x20KEY,\x20','KEY,\x0a\x20\x20\x20\x20\x20','unshift','reset',',\x20module,\x20','Automatic\x20','ailable\x20or','apply\x20migr','O\x20logs\x20(ts','INSERT\x20OR\x20','ES\x20(?,\x20?,\x20','toLowerCas','Shutting\x20d','ror:\x20','\x20creator_i','AULT\x20\x27[]\x27,','Database','=\x205000;','BEGIN\x20TRAN','GER\x20PRIMAR','Type:\x20','Flush\x20tran','Native\x20sql','(name,\x20gro','stringify','\x20\x20\x20\x20\x20\x20\x20\x20\x20u','OLICY','test','est\x20item.\x20','maxBytes','EXISTS\x20key','Scheduling','5XAOxom','ressure:\x20D','splice','data','SELECT\x20val','prepare','XISTS\x20conn','export','failed:','XISTS\x20acti','s\x20(ts\x20INTE','estimateSi','own\x20DB...','PRAGMA\x20bus','uccessfull','database.s','\x20after\x20err','string','isArray','message','T\x20NULL);','s\x20(group_i','Migrations','DB_PATH','9119400GliGpF','\x20KEY,\x20valu','ge_count\x20I','LL\x20DEFAULT','ule\x20TEXT,\x20','d\x20in\x20flush','641118sJuFPW','\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','OR:\x20','\x20TEXT,\x0a\x20\x20\x20','AULT\x200,\x0a\x20\x20','DB_NAME','\x20DB\x20reinit','ue_store\x20(','ve_stats\x20(','from','readFile','DB_UNIQUE_','\x20active_st','cwd','key,\x20value','saction\x20fa','NTERVAL','\x20failed,\x20f','DB_FLUSH_I','ore\x20WHERE\x20','join','from\x20','getRowsMod','XT\x20PRIMARY','ve\x20sqlite3','set','=\x20WAL;','value','4097992sswniV','atements','splay_name','byteLength','6564cEOBFM','AX_BYTES','\x20applied\x20s','timestamp','re\x20(key\x20TE','CONFLICT_P','retries','XT,\x0a\x20\x20\x20\x20\x20\x20','tive_stats','d\x20TEXT\x20NOT','get','ations:','map','module','REATE\x20TABL','82fGNJKx','writeFile','bind','ame\x20TEXT\x20N','alized\x20aut','copy','default','ing\x20back.','CREATE\x20TAB','delete','\x20NULL\x20DEFA','\x20\x20\x20\x20\x20messa','ROLLBACK;','t_key);','y\x20SQL.js\x20D','k\x20to\x20SQL.j','ropped\x20old','alling\x20bac','next','2632189YRgZhF','IF\x20NOT\x20EXI','y_value_st','Failed\x20to\x20','rnal_mode\x20','prev','NOT\x20NULL,\x0a','\x20to\x20disk:','open','ensureDir','size','PROJECT_RO','_removeNod','alization\x20','free','exec','ULT\x20\x27\x27,\x0a\x20\x20','shift','id,\x20timefr','REPLACE\x20IN','IMARY\x20KEY\x20','EXISTS\x20log','step','\x20\x20\x20\x20\x20','\x20\x20\x20\x20\x20\x20\x20\x20di','ion\x20proces','T\x20NULL\x20DEF','finalize','EXISTS\x20gro','ame,\x20bucke','\x0a\x20\x20\x20\x20\x20\x20\x20\x20C','IZE','\x20DETECTED\x20','INTEGER\x0a\x20\x20','5805414ceAOjp','ats(chat_j','B\x20INIT\x20ERR','name\x20TEXT\x20','slice','E\x20IF\x20NOT\x20E','catch','once','ialization','serialized','ERE\x20key\x20=\x20','Backup\x20fai','n\x20complete','at\x20','trim','y_timeout\x20','level\x20TEXT','finally','NOT\x20NULL\x20D','TEXT);','getAsObjec','_addToTail','INSERT\x20INT','now','\x20error:','ULL,\x0a\x20\x20\x20\x20\x20','e\x20TEXT);','nitializat','ignore','FORCE_SQLJ','e_store\x20WH','all','LE\x20IF\x20NOT\x20','TO\x20key_val','ified','r_key\x20TEXT','w\x20in-memor','ite\x20not\x20av','COMMIT;','SIGINT','\x20due\x20to\x20er','DB\x20shutdow','DB\x20get\x20err','type','STS\x20idx_ac','148oXLtsk','head','close','length','OT\x20NULL,\x0a\x20','_moveToTai','sage)\x20VALU','ue\x20FROM\x20ke','bytes','CREATE\x20UNI','.db','id\x20TEXT\x20NO','.corrupt.','\x20\x20\x20\x20timefr','\x20\x20\x20\x20\x20\x20\x20\x20\x20b','push','level,\x20mes','\x20driver.','r_active_g','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x20\x20\x20\x20);\x0a\x20\x20','level','resolve','utf8','up_id)\x0a\x20\x20\x20','run','.tmp','log','ser_jid\x20TE','CRITICAL\x20D','Database\x20i','EXISTS\x20use','\x20\x20\x20\x20\x20\x20\x20las','Item\x20faile','Auto-flush','qlite','led','key','SELECT\x201','\x20\x20\x20\x20\x20chat_','38547NyaTfb','\x20id\x20INTEGE'];_0x4218=function(){return _0x33ab1b;};return _0x4218();}export async function initializeDatabase(){const _0x25b435=_0x5d3e18;info(_0x25b435(0x133)+_0x25b435(0x103)+_0x25b435(0xdf)+'s\x20started.'+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x55952f=getConfig();maxTotalBytes=_0x55952f[_0x25b435(0x13f)+_0x25b435(0x1ad)]||(-0x667*-0x5+-0x1a4c+-0x585)*(0x213d+-0x1e99+0x15c)*(0x1015+0x160f*0x1+-0x2224),cache=new MemoryCache(maxTotalBytes);const _0x3a9d3a=_0x55952f[_0x25b435(0x1d9)+'OT']||process['cwd'](),_0x22e82d=_0x4f5a71[_0x25b435(0x12b)](_0x3a9d3a,_0x55952f[_0x25b435(0x184)]||'.db');await _0x5da740[_0x25b435(0x1d7)](_0x22e82d);const _0x213e3b=_0x55952f[_0x25b435(0x191)]||'database.s'+_0x25b435(0x138),_0x2f5590=_0x4f5a71[_0x25b435(0x1a0)](_0x22e82d,_0x213e3b);let _0x2159af=![];try{if(!_0x55952f[_0x25b435(0x105)+'S']){const _0x216b69=await import('sqlite3'),_0x13f49e=(await import('sqlite'))[_0x25b435(0x1d6)];if(_0x216b69&&_0x13f49e){const _0x340cf1=_0x216b69['default']||_0x216b69,_0x2b6ba4=await _0x13f49e({'filename':_0x2f5590,'driver':_0x340cf1['Database']});await _0x2b6ba4[_0x25b435(0x1dd)]('PRAGMA\x20jou'+_0x25b435(0x1d2)+_0x25b435(0x1a6)),await _0x2b6ba4[_0x25b435(0x1dd)](_0x25b435(0x17a)+_0x25b435(0xf7)+_0x25b435(0x15e)),adapter=createNativeAdapter(_0x2b6ba4),db=adapter,usingNative=!![],_0x2159af=!![],info('Using\x20nati'+_0x25b435(0x1a4)+_0x25b435(0x126));}}}catch(_0xa56b62){warn(_0x25b435(0x163)+_0x25b435(0x10d)+_0x25b435(0x153)+_0x25b435(0x19d)+_0x25b435(0x1cc)+_0x25b435(0x1ca)+'s.');}if(!_0x2159af){const _0x500069=await import('sql.js'),_0x2fe09b=_0x500069[_0x25b435(0x1c1)]||_0x500069,_0x561639=await _0x2fe09b();let _0x5b6891,_0x3206a0=![];if(await _0x5da740['pathExists'](_0x2f5590))try{const _0x969dbe=await _0x5da740[_0x25b435(0x196)](_0x2f5590),_0x5dce08=new Uint8Array(_0x969dbe);_0x5b6891=new _0x561639[(_0x25b435(0x15d))](_0x5dce08),_0x5b6891[_0x25b435(0x1dd)](_0x25b435(0x13b)),_0x3206a0=!![],info(_0x25b435(0x143)+_0x25b435(0x1a1)+_0x2f5590);}catch(_0x368b89){error('CORRUPT\x20DB'+_0x25b435(0xe6)+_0x25b435(0xf5)+_0x2f5590+('.\x20Resettin'+_0x25b435(0x14b)+'.'),_0x368b89),await _0x5da740['move'](_0x2f5590,_0x2f5590+_0x25b435(0x121)+Date[_0x25b435(0xff)]())[_0x25b435(0xee)](()=>{}),_0x5b6891=new _0x561639[(_0x25b435(0x15d))]();}else _0x5b6891=new _0x561639[(_0x25b435(0x15d))](),info('Created\x20ne'+_0x25b435(0x10c)+_0x25b435(0x1c9)+'B');adapter=createSQLjsAdapter(_0x5b6891),db=adapter,usingNative=![];}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[];const _0x529de3=_0x55952f[_0x25b435(0x19e)+_0x25b435(0x19c)]||-0xfb5+-0x12e8+0x1*0x2a6d;flushTimer=setInterval(()=>{flushQueue()['catch'](_0x5c5b26=>error('Flush\x20erro'+'r:',_0x5c5b26));},_0x529de3);}catch(_0x29dee4){error(_0x25b435(0x132)+_0x25b435(0xea)+_0x25b435(0x18e)+_0x29dee4[_0x25b435(0x180)],_0x29dee4);throw _0x29dee4;}}async function prepareStatements(){const _0x1e616a=_0x5d3e18;if(!adapter)return;try{if(setStmt)await setStmt['finalize']();}catch(_0x268ec4){}try{if(deleteStmt)await deleteStmt[_0x1e616a(0xe1)]();}catch(_0x5639e6){}try{if(logStmt)await logStmt[_0x1e616a(0xe1)]();}catch(_0x5e0764){}try{setStmt=await adapter[_0x1e616a(0x172)](_0x1e616a(0x156)+_0x1e616a(0x1e1)+_0x1e616a(0x109)+_0x1e616a(0x193)+_0x1e616a(0x19a)+')\x20VALUES\x20('+'?,\x20?)'),deleteStmt=await adapter[_0x1e616a(0x172)]('DELETE\x20FRO'+_0x1e616a(0x149)+_0x1e616a(0x106)+_0x1e616a(0xf2)+'?'),logStmt=await adapter[_0x1e616a(0x172)](_0x1e616a(0xfe)+_0x1e616a(0x155)+_0x1e616a(0x151)+_0x1e616a(0x125)+_0x1e616a(0x11b)+_0x1e616a(0x157)+'?,\x20?)');}catch(_0x586da7){error(_0x1e616a(0x1d1)+'prepare\x20st'+_0x1e616a(0x1a9),_0x586da7);}}async function applyMigrations(){const _0x447270=_0x5d3e18;if(!adapter)return;try{await adapter[_0x447270(0x1dd)](_0x447270(0x1c3)+_0x447270(0x108)+_0x447270(0x16b)+'_value_sto'+_0x447270(0x1b0)+_0x447270(0x1a3)+_0x447270(0x186)+_0x447270(0x102)),await adapter[_0x447270(0x1dd)]('CREATE\x20TAB'+_0x447270(0x108)+_0x447270(0xdb)+_0x447270(0x177)+_0x447270(0x160)+'Y\x20KEY,\x20mod'+_0x447270(0x189)+_0x447270(0xf8)+',\x20message\x20'+_0x447270(0xfb)),await adapter[_0x447270(0x1dd)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+_0x447270(0x1ba)+'E\x20IF\x20NOT\x20E'+_0x447270(0x173)+'ections\x20(\x0a'+_0x447270(0x128)+_0x447270(0xeb)+_0x447270(0x1d4)+_0x447270(0x128)+'group_id\x20T'+'EXT\x20NOT\x20NU'+_0x447270(0x188)+'\x20\x27\x27,\x0a\x20\x20\x20\x20\x20'+_0x447270(0x13c)+'id\x20TEXT\x20NO'+_0x447270(0xe0)+_0x447270(0x15c)+_0x447270(0x18d)+_0x447270(0x15b)+_0x447270(0x1b5)+_0x447270(0x1c5)+_0x447270(0x1de)+'\x20\x20\x20\x20\x20\x20\x20\x20PR'+_0x447270(0xda)+_0x447270(0x164)+_0x447270(0x12d)+_0x447270(0x129)+_0x447270(0x18c)),await adapter['exec'](_0x447270(0x1c3)+_0x447270(0x108)+_0x447270(0xe2)+'up_default'+_0x447270(0x182)+'d\x20TEXT\x20PRI'+_0x447270(0x14d)+_0x447270(0xeb)+_0x447270(0xfa)+_0x447270(0x142)+'\x27);'),await adapter[_0x447270(0x1dd)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+_0x447270(0x134)+_0x447270(0x127)+'roups\x20(use'+_0x447270(0x10b)+'\x20PRIMARY\x20K'+'EY,\x20group_'+_0x447270(0x120)+_0x447270(0x181)),await adapter[_0x447270(0x1dd)](_0x447270(0xe4)+_0x447270(0x1ba)+_0x447270(0xed)+_0x447270(0x176)+_0x447270(0x194)+_0x447270(0x18d)+_0x447270(0x13e)+'R\x20PRIMARY\x20'+_0x447270(0x14e)+'\x20\x20\x20\x20\x20chat_'+'jid\x20TEXT\x20N'+_0x447270(0x119)+_0x447270(0x166)+_0x447270(0x131)+_0x447270(0x1b3)+_0x447270(0x122)+_0x447270(0x1be)+_0x447270(0x119)+_0x447270(0x123)+'ucket_key\x20'+'TEXT\x20NOT\x20N'+_0x447270(0x101)+_0x447270(0x1c6)+_0x447270(0x187)+'NTEGER\x20DEF'+_0x447270(0x190)+_0x447270(0xde)+_0x447270(0x1aa)+_0x447270(0x18f)+_0x447270(0x135)+_0x447270(0x146)+_0x447270(0xe7)+'\x20\x20\x20\x20\x20\x20);\x0a\x20'+_0x447270(0xdd)),await adapter[_0x447270(0x1dd)](_0x447270(0x11e)+_0x447270(0x140)+_0x447270(0x1cf)+_0x447270(0x114)+_0x447270(0x1b4)+'_unique\x20ON'+_0x447270(0x198)+_0x447270(0xe9)+_0x447270(0x1e0)+_0x447270(0xe3)+_0x447270(0x1c8)),debug(_0x447270(0x183)+_0x447270(0x1ae)+_0x447270(0x17b)+'y.');}catch(_0x36b645){error(_0x447270(0x1d1)+_0x447270(0x154)+_0x447270(0x1b7),_0x36b645);throw _0x36b645;}}async function flushQueue(){const _0x3dd973=_0x5d3e18;if(isFlushing){if(Date[_0x3dd973(0xff)]()-lastFlushTime>-0x1f*0x340+-0x3902+0xd85a)isFlushing=![];else return;}if(!dbReady||writeQueue[_0x3dd973(0x118)]===0x1*0xc69+-0x65*0x1f+-0x2*0x17)return;const _0x2a7b1c=writeQueue[0xbd5+0x12d0+-0x3*0xa37];if(_0x2a7b1c&&_0x2a7b1c[_0x3dd973(0x1b2)]>0x10*0x24b+0x1beb+-0x409b&&Date['now']()-_0x2a7b1c[_0x3dd973(0x1af)]<0x10*0x4+-0x1*0x187d+0x23*0x107)return;if(!setStmt||!deleteStmt)await prepareStatements();isFlushing=!![],lastFlushTime=Date[_0x3dd973(0xff)]();const _0x24e0c3=getConfig(),_0x27bf9f=_0x24e0c3['DB_BATCH_S'+'IZE']||-0xd7b+-0x1*-0x137e+-0x5d1,_0x5b0193=writeQueue[_0x3dd973(0x16f)](0x3c0+-0x188d+0x429*0x5,_0x27bf9f),_0x29f3ba=_0x5b0193['reduce']((_0xbd21c2,_0x207b76)=>_0xbd21c2+(_0x207b76['size']||-0x49*0x1a+-0x18a+0x8f4),0x198d+-0x21ce+0x1*0x841);try{if(adapter['exec'])await adapter[_0x3dd973(0x1dd)](_0x3dd973(0x15f)+_0x3dd973(0x14a));for(const _0x1dc552 of _0x5b0193){try{switch(_0x1dc552[_0x3dd973(0x113)]){case'set':await setStmt['run'](_0x1dc552[_0x3dd973(0x13a)],_0x1dc552[_0x3dd973(0x1a7)]);break;case _0x3dd973(0x1c4):await deleteStmt[_0x3dd973(0x12e)](_0x1dc552[_0x3dd973(0x13a)]);break;case _0x3dd973(0x130):if(logStmt)await logStmt[_0x3dd973(0x12e)](_0x1dc552['data']['ts'],_0x1dc552['data'][_0x3dd973(0x1b9)],_0x1dc552[_0x3dd973(0x170)][_0x3dd973(0x12a)],_0x1dc552['data'][_0x3dd973(0x180)]);break;}}catch(_0x34d7bf){error(_0x3dd973(0x136)+_0x3dd973(0x18a)+':\x20'+_0x1dc552['type'],_0x34d7bf);}}if(adapter[_0x3dd973(0x1dd)])await adapter[_0x3dd973(0x1dd)](_0x3dd973(0x10e));queueBytes=Math['max'](0x25ae+0x1e15+-0x43c3,queueBytes-_0x29f3ba);if(!usingNative){const _0x5b93cc=Date['now']();(writeQueue[_0x3dd973(0x118)]===0x1*-0x1556+0x177a*-0x1+0x2cd0||_0x5b93cc-lastDiskSaveTime>DISK_SAVE_THROTTLE_MS)&&(await persistDatabaseToFile(),lastDiskSaveTime=_0x5b93cc);}}catch(_0x25a6d4){error(_0x3dd973(0x162)+_0x3dd973(0x19b)+'iled,\x20roll'+_0x3dd973(0x1c2),_0x25a6d4);try{if(adapter['exec'])await adapter[_0x3dd973(0x1dd)](_0x3dd973(0x1c7));}catch(_0x5673f1){}writeQueue[_0x3dd973(0x14f)](..._0x5b0193);}finally{isFlushing=![];}}async function persistDatabaseToFile(_0x2a6c20=![]){const _0x4977e4=_0x5d3e18;if(usingNative||!adapter)return;const _0x1627a3=getConfig(),_0x5428a8=_0x4f5a71[_0x4977e4(0x12b)](_0x1627a3[_0x4977e4(0x1d9)+'OT']||process[_0x4977e4(0x199)](),_0x1627a3[_0x4977e4(0x184)]||_0x4977e4(0x11f)),_0x4ff27c=_0x4f5a71[_0x4977e4(0x1a0)](_0x5428a8,_0x1627a3[_0x4977e4(0x191)]||_0x4977e4(0x17c)+_0x4977e4(0x138)),_0x32fd6a=_0x4ff27c+_0x4977e4(0x12f);try{const _0x381ef4=adapter['export']();if(!_0x381ef4)return;await _0x5da740[_0x4977e4(0x1bc)](_0x32fd6a,Buffer[_0x4977e4(0x195)](_0x381ef4)),await _0x5da740[_0x4977e4(0x145)](_0x32fd6a,_0x4ff27c,{'overwrite':!![]});}catch(_0x3ab306){error(_0x4977e4(0x1d1)+'persist\x20DB'+_0x4977e4(0x1d5),_0x3ab306);}}export async function get(_0x67cab6){const _0x4ca1b7=_0x5d3e18;if(!dbReady){if(dbInitializingPromise)await dbInitializingPromise;else{if(!dbReady)await new Promise(_0x574689=>setTimeout(_0x574689,-0x1*-0x2233+0x226d+0x1*-0x42ac));}}try{if(cache&&cache[_0x4ca1b7(0x147)](_0x67cab6))return cache['get'](_0x67cab6);}catch(_0x3b535c){}if(!adapter)return undefined;try{const _0x223e2e=await adapter[_0x4ca1b7(0x1b6)](_0x4ca1b7(0x171)+_0x4ca1b7(0x11c)+_0x4ca1b7(0x1d0)+_0x4ca1b7(0x19f)+'key\x20=\x20?',_0x67cab6);if(_0x223e2e&&_0x223e2e[_0x4ca1b7(0x1a7)]!=null){const _0xe378d5=JSON['parse'](_0x223e2e[_0x4ca1b7(0x1a7)]);if(cache)cache[_0x4ca1b7(0x1a5)](_0x67cab6,_0xe378d5,_0x223e2e[_0x4ca1b7(0x1a7)]);return _0xe378d5;}}catch(_0x45bd46){if(isDbClosedError(_0x45bd46))return scheduleReinitializeAfterError(_0x45bd46),undefined;error(_0x4ca1b7(0x112)+'or\x20for\x20'+_0x67cab6+':',_0x45bd46);}return undefined;}export function set(_0x3d8b9b,_0xf9d9b0){const _0x5452cf=_0x5d3e18;if(_0xf9d9b0===undefined){del(_0x3d8b9b);return;}let _0x4ca63f;try{_0x4ca63f=JSON[_0x5452cf(0x165)](_0xf9d9b0);}catch(_0x462307){return;}if(cache)cache[_0x5452cf(0x1a5)](_0x3d8b9b,_0xf9d9b0,_0x4ca63f);const _0x53fb30={'type':_0x5452cf(0x1a5),'key':_0x3d8b9b,'value':_0x4ca63f,'retries':0x0,'timestamp':Date[_0x5452cf(0xff)]()};_0x53fb30[_0x5452cf(0x1d8)]=estimateQueueItemSize(_0x53fb30),queueBytes+=_0x53fb30[_0x5452cf(0x1d8)],writeQueue[_0x5452cf(0x124)](_0x53fb30),enforceMemoryLimit(),writeQueue[_0x5452cf(0x118)]>=(getConfig()['DB_BATCH_S'+_0x5452cf(0xe5)]||0x605+-0x6d8+-0x3*-0x57)&&flushQueue()[_0x5452cf(0xee)](_0x3e8784=>error(_0x5452cf(0x137)+_0x5452cf(0x100),_0x3e8784));}export function del(_0x37a6b3){const _0x481458=_0x5d3e18;if(cache)cache[_0x481458(0x1c4)](_0x37a6b3);const _0x597836={'type':'delete','key':_0x37a6b3,'retries':0x0,'timestamp':Date[_0x481458(0xff)]()};_0x597836['size']=estimateQueueItemSize(_0x597836),queueBytes+=_0x597836[_0x481458(0x1d8)],writeQueue[_0x481458(0x124)](_0x597836),enforceMemoryLimit();}export function logToDB(module,_0xdae68a,_0x1bc380){const _0x11dfd9=_0x5d3e18,_0xaa262e={'ts':Date['now'](),'module':module,'level':_0xdae68a,'message':String(_0x1bc380)[_0x11dfd9(0xec)](0xb1e*0x2+-0xe29+-0x813,0x17*0x2b+-0x1987*0x1+-0x2ae*-0xb)},_0x46a814={'type':_0x11dfd9(0x130),'data':_0xaa262e,'retries':0x0,'timestamp':Date[_0x11dfd9(0xff)]()};_0x46a814['size']=estimateQueueItemSize(_0x46a814),queueBytes+=_0x46a814[_0x11dfd9(0x1d8)],writeQueue[_0x11dfd9(0x124)](_0x46a814),enforceMemoryLimit();}export async function shutdownDatabase(){const _0x122959=_0x5d3e18;info(_0x122959(0x159)+_0x122959(0x179)),dbReady=![];if(flushTimer)clearInterval(flushTimer);await flushQueue(),await persistDatabaseToFile(!![]);if(adapter){try{await adapter[_0x122959(0x117)]();}catch(_0x4c5642){}adapter=null,db=null;}info(_0x122959(0x111)+_0x122959(0xf4)+'.');}async function backupDB(_0x56c45c){const _0x56acab=_0x5d3e18;try{await _0x5da740[_0x56acab(0x144)](_0x56c45c)&&await _0x5da740[_0x56acab(0x1c0)](_0x56c45c,_0x56c45c+'.bak',{'overwrite':!![]});}catch(_0x311997){error(_0x56acab(0xf3)+_0x56acab(0x139),_0x311997);}}process[_0x5d3e18(0xef)](_0x5d3e18(0x10f),()=>{const _0x88c5b0=_0x5d3e18;shutdownDatabase()[_0x88c5b0(0xf9)](()=>process['exit'](-0xfb3*-0x2+0x4b*0x49+0x1*-0x34c9));}),process[_0x5d3e18(0xef)](_0x5d3e18(0x14c),()=>{const _0x221b53=_0x5d3e18;shutdownDatabase()[_0x221b53(0xf9)](()=>process[_0x221b53(0x148)](-0x1dd9+0x172*-0x1+-0x1*-0x1f4b));});export{adapter as _adapter};