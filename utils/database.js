const _0xfbf890=_0x16a8;(function(_0x47879e,_0x1bde35){const _0x2bb5b3=_0x16a8,_0x3206fd=_0x47879e();while(!![]){try{const _0x414d3c=-parseInt(_0x2bb5b3(0x2ce))/(-0x8*0xf7+-0x2*-0x12fd+-0x5*0x60d)+parseInt(_0x2bb5b3(0x317))/(-0x256a+-0x3*0xb3e+0x4726)+-parseInt(_0x2bb5b3(0x2b3))/(0xb*-0x163+-0xb*0x1f3+0x24b5)*(parseInt(_0x2bb5b3(0x2b1))/(0x4*0x365+-0x135+0x1*-0xc5b))+parseInt(_0x2bb5b3(0x31e))/(-0x20*-0xa3+-0xd*0x17f+-0x1d*0x8)+parseInt(_0x2bb5b3(0x23d))/(-0xbf6+-0x1253+-0x1*-0x1e4f)*(-parseInt(_0x2bb5b3(0x1de))/(-0x18+-0xd09+-0x1a5*-0x8))+parseInt(_0x2bb5b3(0x26d))/(-0x793+-0x988+0x1123)*(-parseInt(_0x2bb5b3(0x273))/(-0x8*0x2a2+-0x469*0x1+0x1982))+parseInt(_0x2bb5b3(0x29b))/(0x1b*-0x43+-0x20f7+0x17*0x1be);if(_0x414d3c===_0x1bde35)break;else _0x3206fd['push'](_0x3206fd['shift']());}catch(_0x2ed78b){_0x3206fd['push'](_0x3206fd['shift']());}}}(_0x2e18,0x24cb7*0x3+-0x756f2+0x4b0b3));import _0x4b8ed9 from'fs-extra';import _0x35eaea from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;let usingNative=![],setStmt=null,deleteStmt=null,dbReady=![],writeQueue=[],queueBytes=0x145a+-0x67f+0xddb*-0x1,maxTotalBytes=0x5f3+-0x1*0x1adf+-0x14ec*-0x1,isFlushing=![],flushTimer=null,cache=null;function estimateQueueItemSize(_0x48e392){const _0x269504=_0x16a8,_0x3b42ff=-0x1*0x23e4+-0x702+0x2b36;switch(_0x48e392[_0x269504(0x1ce)]){case'set':return Buffer['byteLength'](_0x48e392[_0x269504(0x36f)],'utf8')+Buffer[_0x269504(0x216)](_0x48e392['value'],'utf8')+_0x3b42ff;case'delete':return Buffer[_0x269504(0x216)](_0x48e392['key'],'utf8')+_0x3b42ff;default:return 0x1196+0x10c3+-0x21d9;}}class MemoryCache{constructor(_0x4901c1){const _0xd5e9db=_0x16a8;this[_0xd5e9db(0x1fa)]=_0x4901c1,this[_0xd5e9db(0x1dd)]=-0xb0b+0x334+0x7d7*0x1,this[_0xd5e9db(0x1fb)]=new Map(),this[_0xd5e9db(0x28b)]={'prev':null,'next':null},this[_0xd5e9db(0x21e)]={'prev':null,'next':null},this[_0xd5e9db(0x28b)][_0xd5e9db(0x207)]=this[_0xd5e9db(0x21e)],this[_0xd5e9db(0x21e)]['prev']=this[_0xd5e9db(0x28b)];}static[_0xfbf890(0x27e)+'ze'](_0x78bffe,_0x356df5){const _0x570924=_0xfbf890,_0x69a688=Buffer[_0x570924(0x216)](String(_0x78bffe),'utf8'),_0x11209b=Buffer[_0x570924(0x216)](_0x356df5??'',_0x570924(0x2b6));return _0x69a688+_0x11209b+(0x1506+0x2*0x277+-0x19b4);}[_0xfbf890(0x2f0)+'e'](_0x42dcd8){const _0x866aaf=_0xfbf890;_0x42dcd8[_0x866aaf(0x1f2)][_0x866aaf(0x207)]=_0x42dcd8[_0x866aaf(0x207)],_0x42dcd8[_0x866aaf(0x207)][_0x866aaf(0x1f2)]=_0x42dcd8[_0x866aaf(0x1f2)];}[_0xfbf890(0x2de)](_0x560677){const _0x350337=_0xfbf890;_0x560677[_0x350337(0x1f2)]=this[_0x350337(0x21e)]['prev'],_0x560677[_0x350337(0x207)]=this[_0x350337(0x21e)],this['tail']['prev'][_0x350337(0x207)]=_0x560677,this[_0x350337(0x21e)][_0x350337(0x1f2)]=_0x560677;}[_0xfbf890(0x300)+'l'](_0x175703){const _0x440073=_0xfbf890;this['_removeNod'+'e'](_0x175703),this[_0x440073(0x2de)](_0x175703);}[_0xfbf890(0x2bd)](_0x1d4d2a){const _0xbf427f=_0xfbf890;return this['map'][_0xbf427f(0x2bd)](_0x1d4d2a);}[_0xfbf890(0x2a9)](_0x1cac92){const _0x4b2914=_0xfbf890,_0x21a514=this[_0x4b2914(0x1fb)][_0x4b2914(0x2a9)](_0x1cac92);if(!_0x21a514)return undefined;return this[_0x4b2914(0x300)+'l'](_0x21a514),_0x21a514[_0x4b2914(0x2c9)];}[_0xfbf890(0x224)](_0x37f926,_0x3a432e,_0x317f6b){const _0x1f1419=_0xfbf890,_0x2d6467=this[_0x1f1419(0x1fb)][_0x1f1419(0x2a9)](_0x37f926),_0x3eb4fd=MemoryCache['estimateSi'+'ze'](_0x37f926,_0x317f6b);if(_0x3eb4fd>this['maxBytes']){warn(_0x1f1419(0x305)+_0x1f1419(0x234)+_0x1f1419(0x2bc)+_0x1f1419(0x357)+_0x37f926+_0x1f1419(0x35f)+_0x3eb4fd+('\x20bytes\x20>\x20m'+_0x1f1419(0x322))+this[_0x1f1419(0x1fa)]+')');if(_0x2d6467)this[_0x1f1419(0x2ef)](_0x37f926);return;}if(_0x2d6467)this['bytes']-=_0x2d6467['size'],_0x2d6467[_0x1f1419(0x2c9)]=_0x3a432e,_0x2d6467[_0x1f1419(0x336)]=_0x317f6b,_0x2d6467[_0x1f1419(0x370)]=_0x3eb4fd,this[_0x1f1419(0x1dd)]+=_0x3eb4fd,this[_0x1f1419(0x300)+'l'](_0x2d6467);else{const _0x730e18={'key':_0x37f926,'value':_0x3a432e,'serialized':_0x317f6b,'size':_0x3eb4fd,'prev':null,'next':null};this[_0x1f1419(0x1fb)][_0x1f1419(0x224)](_0x37f926,_0x730e18),this['_addToTail'](_0x730e18),this[_0x1f1419(0x1dd)]+=_0x3eb4fd;}while(this['bytes']>this[_0x1f1419(0x1fa)]){const _0x1ad796=this['head']['next'];if(_0x1ad796===this[_0x1f1419(0x21e)])break;this[_0x1f1419(0x2ef)](_0x1ad796[_0x1f1419(0x36f)]);}}[_0xfbf890(0x2ef)](_0x161b4c){const _0x55312d=_0xfbf890,_0x1d170a=this['map']['get'](_0x161b4c);if(!_0x1d170a)return;this[_0x55312d(0x2f0)+'e'](_0x1d170a),this[_0x55312d(0x1fb)][_0x55312d(0x2ef)](_0x161b4c),this[_0x55312d(0x1dd)]-=_0x1d170a[_0x55312d(0x370)];}}function enforceMemoryLimit(){const _0x5570e8=_0xfbf890;while(cache&&cache[_0x5570e8(0x1dd)]+queueBytes>maxTotalBytes&&writeQueue[_0x5570e8(0x29a)]>-0x16aa+-0x1d*-0x91+0x63d){const _0x58e365=writeQueue[_0x5570e8(0x248)]();if(_0x58e365[_0x5570e8(0x370)])queueBytes-=_0x58e365[_0x5570e8(0x370)];warn('Write\x20queu'+_0x5570e8(0x226)+'ressure:\x20D'+_0x5570e8(0x269)+_0x5570e8(0x21d)+_0x5570e8(0x35b)+_0x58e365['type']+_0x5570e8(0x2c0)+(_0x58e365[_0x5570e8(0x36f)]||_0x5570e8(0x20f)));}}function normalizeBindParams(_0x189cb5){const _0x5cdbfe=_0xfbf890;if(!_0x189cb5||_0x189cb5[_0x5cdbfe(0x29a)]===-0x679*0x1+-0x8c1+-0x2*-0x79d)return undefined;if(_0x189cb5[_0x5cdbfe(0x29a)]===0xb8+0x1e4+0x1*-0x29b&&Array[_0x5cdbfe(0x2cd)](_0x189cb5[0x2*-0x464+-0x1f*-0x37+0x21f]))return _0x189cb5[-0x642+0x1add+-0x149b];if(_0x189cb5[_0x5cdbfe(0x29a)]===-0xd*0x2c2+-0x1*-0x29c+0xb15*0x3&&typeof _0x189cb5[0x43*-0x7b+0x1*-0x173+0x21a4]===_0x5cdbfe(0x2a2)&&_0x189cb5[0x42c+-0xddf+0x9b3]!==null&&!Array[_0x5cdbfe(0x2cd)](_0x189cb5[-0x266+0x3*0x535+-0xd39]))return _0x189cb5[-0xa30+0x1*-0x1372+0x1da2];return _0x189cb5;}function isTableAlreadyExistsError(_0x59ad01){const _0x24c0e9=_0xfbf890;try{const _0x190415=_0x59ad01&&(_0x59ad01[_0x24c0e9(0x1ee)]||String(_0x59ad01))||'';return/table .* already exists/i[_0x24c0e9(0x2b8)](_0x190415)||/\balready exists\b/i[_0x24c0e9(0x2b8)](_0x190415);}catch(_0x116dbc){return![];}}function isUniqueConstraintError(_0x3a9bf6){const _0x3741d8=_0xfbf890;try{const _0x10868f=_0x3a9bf6&&(_0x3a9bf6['message']||String(_0x3a9bf6))||'';return/UNIQUE constraint failed/i[_0x3741d8(0x2b8)](_0x10868f)||/UNIQUE constraint/i[_0x3741d8(0x2b8)](_0x10868f);}catch(_0x499267){return![];}}function looksLikeSimpleInsert(_0x114a82){const _0x55ba4d=_0xfbf890;if(!_0x114a82||typeof _0x114a82!==_0x55ba4d(0x215))return![];return/^\s*INSERT\s+INTO\s+/i[_0x55ba4d(0x2b8)](_0x114a82)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x55ba4d(0x2b8)](_0x114a82);}function getUniquePolicy(){const _0x2c4c9d=_0xfbf890;try{const _0x584f3a=getConfig(),_0x5bdc01=_0x584f3a&&_0x584f3a['DB_UNIQUE_'+'CONFLICT_P'+_0x2c4c9d(0x2a4)]||'ignore';return String(_0x5bdc01)[_0x2c4c9d(0x2a3)+'e']()[_0x2c4c9d(0x26a)]();}catch(_0x10875e){return _0x2c4c9d(0x258);}}let dbInitializingPromise=null,reinitBackoffMs=0x1*0x1d9e+0x1f57*0x1+-0x390d;const MAX_REINIT_BACKOFF_MS=(-0xb56*0x3+-0x20b5+0x42f3)*(0x389*-0x1+-0xf8b+0x16fc);function isDbClosedError(_0x18f6d6){const _0x316b11=_0xfbf890;if(!_0x18f6d6)return![];const _0x3ea11a=String(_0x18f6d6['message']||_0x18f6d6||'');if(/database is closed/i[_0x316b11(0x2b8)](_0x3ea11a))return!![];if(/SQLITE_MISUSE/i[_0x316b11(0x2b8)](_0x3ea11a))return!![];if(_0x18f6d6&&typeof _0x18f6d6[_0x316b11(0x342)]==='string'&&_0x18f6d6['code']['toUpperCas'+'e']()[_0x316b11(0x2e7)](_0x316b11(0x297)))return/SQLITE_MISUSE|SQLITE_IOERR|SQLITE_MISUSE/i[_0x316b11(0x2b8)](_0x18f6d6[_0x316b11(0x342)]);return![];}async function scheduleReinitializeAfterError(_0x4f7a05){const _0x595783=_0xfbf890;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;const _0x42e828=Math[_0x595783(0x251)](reinitBackoffMs,MAX_REINIT_BACKOFF_MS);return warn(_0x595783(0x35d)+_0x595783(0x1e8)+_0x595783(0x33a)+_0x595783(0x2a5)+_0x42e828+('ms\x20due\x20to\x20'+'error:\x20')+(_0x4f7a05?.[_0x595783(0x1ee)]||_0x4f7a05)),dbInitializingPromise=((async()=>{const _0x34867f=_0x595783;await new Promise(_0x40c049=>setTimeout(_0x40c049,_0x42e828));try{await initializeDatabase(),info(_0x34867f(0x2b0)+_0x34867f(0x2ac)+_0x34867f(0x339)+_0x34867f(0x2e6)+_0x34867f(0x1e7)),reinitBackoffMs=0x17*-0x11+0x438+0x137;}catch(_0x2ecc34){error('Automatic\x20'+_0x34867f(0x2b0)+'alization\x20'+'failed:',_0x2ecc34),reinitBackoffMs=Math['min'](MAX_REINIT_BACKOFF_MS,reinitBackoffMs*(-0x3*-0x679+-0x1*-0x264b+-0x39b4));try{await scheduleReinitializeAfterError(_0x2ecc34);}catch(_0x239aa0){}}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function createNativeAdapter(_0x48b755){return{'_underlying':_0x48b755,async 'exec'(_0x59321e){const _0x34bb17=_0x16a8;try{await _0x48b755[_0x34bb17(0x298)](_0x59321e);return;}catch(_0x1df40d){if(isTableAlreadyExistsError(_0x1df40d)){warn(_0x34bb17(0x2fd)+_0x34bb17(0x2df)+'able\x20alrea'+_0x34bb17(0x2a8)+_0x34bb17(0x311)+_0x34bb17(0x2bf)+_0x34bb17(0x220)+String(_0x59321e)[_0x34bb17(0x1df)](0xc1d*0x2+0xfa2+-0x27dc,0x11cf*0x1+0x1*-0x8cd+-0x772));return;}if(isUniqueConstraintError(_0x1df40d)){const _0x2997e8=getUniquePolicy();if(_0x2997e8===_0x34bb17(0x258)){debug(_0x34bb17(0x2f6)+_0x34bb17(0x36e)+'raint\x20erro'+_0x34bb17(0x292)+_0x34bb17(0x2ab)+_0x34bb17(0x2b9)+_0x34bb17(0x25c)+_0x34bb17(0x210)+String(_0x59321e)[_0x34bb17(0x1df)](0x1*0x19bd+0x10*-0x257+0xbb3,-0x2202+-0x1*0x3c0+0x59e*0x7));return;}if(_0x2997e8==='replace'&&looksLikeSimpleInsert(_0x59321e)){const _0xcba621=_0x59321e[_0x34bb17(0x326)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x34bb17(0x268)+'TO');try{await _0x48b755[_0x34bb17(0x298)](_0xcba621);return;}catch(_0x131506){throw _0x131506;}}}throw _0x1df40d;}},async 'get'(_0x47e7da,..._0x432440){const _0x409ce2=_0x16a8;try{const _0x2fd336=normalizeBindParams(_0x432440);if(_0x2fd336===undefined)return await _0x48b755[_0x409ce2(0x2a9)](_0x47e7da);return await _0x48b755[_0x409ce2(0x2a9)](_0x47e7da,_0x2fd336);}catch(_0x3d756f){throw _0x3d756f;}},async 'all'(_0x486895,..._0x1aa858){const _0x55929b=_0x16a8;try{const _0x2be571=normalizeBindParams(_0x1aa858);if(_0x2be571===undefined)return await _0x48b755['all'](_0x486895);return await _0x48b755[_0x55929b(0x1f0)](_0x486895,_0x2be571);}catch(_0x268cce){throw _0x268cce;}},async 'run'(_0x3fe272,..._0xd0dc1e){const _0x4cee89=_0x16a8;try{const _0x415a23=normalizeBindParams(_0xd0dc1e);let _0x420bb8;return _0x415a23===undefined?_0x420bb8=await _0x48b755['run'](_0x3fe272):_0x420bb8=await _0x48b755[_0x4cee89(0x24d)](_0x3fe272,_0x415a23),_0x420bb8;}catch(_0x5388bb){if(isUniqueConstraintError(_0x5388bb)){const _0x1f4f93=getUniquePolicy();if(_0x1f4f93===_0x4cee89(0x258))return debug('Ignored\x20UN'+_0x4cee89(0x36e)+'raint\x20erro'+_0x4cee89(0x292)+_0x4cee89(0x2ab)+_0x4cee89(0x2fa)+'g\x20(native)'+':\x20'+String(_0x3fe272)[_0x4cee89(0x1df)](0x5b*0x6a+0xae7*-0x2+-0xfe0,-0xfff+-0x120d*0x1+-0x1*-0x239c)),undefined;if(_0x1f4f93===_0x4cee89(0x326)&&looksLikeSimpleInsert(_0x3fe272)){const _0x591359=_0x3fe272[_0x4cee89(0x326)](/^\s*INSERT\s+INTO/i,_0x4cee89(0x304)+_0x4cee89(0x268)+'TO'),_0x4e7980=normalizeBindParams(_0xd0dc1e);try{let _0x4f0525;if(_0x4e7980===undefined)_0x4f0525=await _0x48b755[_0x4cee89(0x24d)](_0x591359);else _0x4f0525=await _0x48b755[_0x4cee89(0x24d)](_0x591359,_0x4e7980);return info(_0x4cee89(0x26e)+'eeded\x20usin'+_0x4cee89(0x2bb)+'R\x20REPLACE\x20'+_0x4cee89(0x30f)),_0x4f0525;}catch(_0x112eb2){throw _0x112eb2;}}}throw _0x5388bb;}},async 'prepare'(_0x221df2){const _0x4e711d=_0x16a8,_0x22dc09=await _0x48b755[_0x4e711d(0x291)](_0x221df2);return{async 'run'(..._0x18883c){const _0x1e8e4f=_0x4e711d,_0x515c14=normalizeBindParams(_0x18883c);try{let _0x5ae6ed;if(_0x515c14===undefined)_0x5ae6ed=await _0x22dc09[_0x1e8e4f(0x24d)]();else _0x5ae6ed=await _0x22dc09[_0x1e8e4f(0x24d)](_0x515c14);return _0x5ae6ed;}catch(_0x3f8272){if(isUniqueConstraintError(_0x3f8272)){const _0x459137=getUniquePolicy();if(_0x459137===_0x1e8e4f(0x258))return debug(_0x1e8e4f(0x2f6)+_0x1e8e4f(0x36e)+'raint\x20erro'+_0x1e8e4f(0x292)+_0x1e8e4f(0x1fd)+_0x1e8e4f(0x283)+_0x1e8e4f(0x22c)+_0x1e8e4f(0x2c3)+_0x221df2),undefined;if(_0x459137===_0x1e8e4f(0x326)&&looksLikeSimpleInsert(_0x221df2)){const _0x132ee4=_0x221df2['replace'](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x1e8e4f(0x268)+'TO'),_0x2bf631=await _0x48b755[_0x1e8e4f(0x291)](_0x132ee4);try{let _0x425ab0;if(_0x515c14===undefined)_0x425ab0=await _0x2bf631[_0x1e8e4f(0x24d)]();else _0x425ab0=await _0x2bf631[_0x1e8e4f(0x24d)](_0x515c14);return await _0x2bf631[_0x1e8e4f(0x303)](),info(_0x1e8e4f(0x26e)+_0x1e8e4f(0x32e)+_0x1e8e4f(0x2bb)+_0x1e8e4f(0x318)+_0x1e8e4f(0x274)+'ed\x20stateme'+_0x1e8e4f(0x221)+').'),_0x425ab0;}catch(_0x5dec15){try{await _0x2bf631['finalize']();}catch(_0xd3db28){}throw _0x5dec15;}}}throw _0x3f8272;}},async 'finalize'(){const _0x27ef76=_0x4e711d;try{await _0x22dc09[_0x27ef76(0x303)]();}catch(_0x59d6f2){}}};},async 'close'(){try{await _0x48b755['close']();}catch(_0x68ca9f){}},'export'(){return undefined;}};}function createSQLjsAdapter(_0x3efb5d){const _0xe92791=_0x3efb5d;return{'_underlying':_0xe92791,async 'exec'(_0x1e747){const _0x41b753=_0x16a8;try{_0xe92791[_0x41b753(0x24d)](_0x1e747);return;}catch(_0x3824ef){if(isTableAlreadyExistsError(_0x3824ef)){warn(_0x41b753(0x2fd)+_0x41b753(0x2df)+_0x41b753(0x256)+_0x41b753(0x2a8)+'\x20while\x20exe'+'cuting\x20(sq'+_0x41b753(0x1d9)+String(_0x1e747)[_0x41b753(0x1df)](0x7*0x41f+0xcc8+0x29a1*-0x1,-0x8ae+-0x20fe+0x2b3c));return;}if(isUniqueConstraintError(_0x3824ef)){const _0x56e104=getUniquePolicy();if(_0x56e104==='ignore'){debug(_0x41b753(0x2f6)+_0x41b753(0x36e)+_0x41b753(0x34d)+_0x41b753(0x292)+_0x41b753(0x2ab)+_0x41b753(0x2b9)+_0x41b753(0x28c)+_0x41b753(0x1f5)+String(_0x1e747)[_0x41b753(0x1df)](0x70e+0x607*0x1+-0xd15*0x1,-0x1*0x161+-0x49*0x85+0x28de));return;}if(_0x56e104===_0x41b753(0x326)&&looksLikeSimpleInsert(_0x1e747)){const _0x5be8f3=_0x1e747[_0x41b753(0x326)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO');try{_0xe92791[_0x41b753(0x24d)](_0x5be8f3);return;}catch(_0x7fe163){throw _0x7fe163;}}}throw _0x3824ef;}},async 'get'(_0x5744c3,..._0x505020){const _0x49eeb3=_0x16a8;try{const _0x56f9d9=_0xe92791[_0x49eeb3(0x291)](_0x5744c3);try{const _0x5cafe8=normalizeBindParams(_0x505020);if(_0x5cafe8!==undefined)_0x56f9d9[_0x49eeb3(0x332)](_0x5cafe8);if(_0x56f9d9['step']()){const _0x5a150d=_0x56f9d9[_0x49eeb3(0x33c)+'t']();return _0x56f9d9[_0x49eeb3(0x20b)](),_0x5a150d;}else return _0x56f9d9[_0x49eeb3(0x20b)](),undefined;}catch(_0x25a934){try{_0x56f9d9[_0x49eeb3(0x20b)]();}catch(_0x5917b0){}if(isUniqueConstraintError(_0x25a934)){const _0x29ffac=getUniquePolicy();if(_0x29ffac===_0x49eeb3(0x258))return debug(_0x49eeb3(0x2f6)+'IQUE\x20const'+_0x49eeb3(0x34d)+_0x49eeb3(0x2ba)+_0x49eeb3(0x27c)+'cy=ignore)'+':\x20'+_0x5744c3),undefined;}throw _0x25a934;}}catch(_0x1c5225){throw _0x1c5225;}},async 'all'(_0x314975,..._0x60c7d6){const _0x3c545b=_0x16a8;try{const _0x360124=_0xe92791['prepare'](_0x314975),_0x48e205=[];try{const _0x651c97=normalizeBindParams(_0x60c7d6);if(_0x651c97!==undefined)_0x360124[_0x3c545b(0x332)](_0x651c97);while(_0x360124['step']())_0x48e205[_0x3c545b(0x2f9)](_0x360124[_0x3c545b(0x33c)+'t']());return _0x360124[_0x3c545b(0x20b)](),_0x48e205;}catch(_0x1d28ad){try{_0x360124[_0x3c545b(0x20b)]();}catch(_0x500c9d){}if(isUniqueConstraintError(_0x1d28ad)){const _0x4c4c52=getUniquePolicy();if(_0x4c4c52==='ignore')return debug(_0x3c545b(0x2f6)+_0x3c545b(0x36e)+_0x3c545b(0x34d)+_0x3c545b(0x344)+_0x3c545b(0x225)+_0x3c545b(0x206)+':\x20'+_0x314975),_0x48e205;}throw _0x1d28ad;}}catch(_0x2a4bc3){throw _0x2a4bc3;}},async 'run'(_0x1e9213,..._0x1c4427){const _0x1354d8=_0x16a8;try{const _0x1d38b2=normalizeBindParams(_0x1c4427);if(_0x1d38b2===undefined){_0xe92791[_0x1354d8(0x24d)](_0x1e9213);const _0x4384df=typeof _0xe92791[_0x1354d8(0x287)+_0x1354d8(0x22b)]===_0x1354d8(0x295)?_0xe92791[_0x1354d8(0x287)+'ified']():undefined;return _0x4384df!==undefined?{'changes':_0x4384df}:undefined;}else{const _0x1eb51b=_0xe92791[_0x1354d8(0x291)](_0x1e9213);try{_0x1eb51b[_0x1354d8(0x332)](_0x1d38b2),_0x1eb51b[_0x1354d8(0x24d)](),_0x1eb51b[_0x1354d8(0x20b)]();const _0x7add3b=typeof _0xe92791[_0x1354d8(0x287)+'ified']===_0x1354d8(0x295)?_0xe92791[_0x1354d8(0x287)+_0x1354d8(0x22b)]():undefined;return _0x7add3b!==undefined?{'changes':_0x7add3b}:undefined;}catch(_0x1e2efa){try{_0x1eb51b[_0x1354d8(0x20b)]();}catch(_0x2dcfab){}if(isUniqueConstraintError(_0x1e2efa)){const _0x4d2b8a=getUniquePolicy();if(_0x4d2b8a===_0x1354d8(0x258))return debug(_0x1354d8(0x2f6)+_0x1354d8(0x36e)+_0x1354d8(0x34d)+'r\x20(policy='+_0x1354d8(0x2ab)+_0x1354d8(0x2fa)+_0x1354d8(0x2ed)+String(_0x1e9213)[_0x1354d8(0x1df)](-0x1c4a+0x85f*0x1+0x1*0x13eb,0x1*0x3c4+-0x8*0xef+0x544)),undefined;if(_0x4d2b8a===_0x1354d8(0x326)&&looksLikeSimpleInsert(_0x1e9213)){const _0x263f3a=_0x1e9213['replace'](/^\s*INSERT\s+INTO/i,_0x1354d8(0x304)+_0x1354d8(0x268)+'TO'),_0x33f995=_0xe92791[_0x1354d8(0x291)](_0x263f3a);try{_0x33f995['bind'](_0x1d38b2),_0x33f995[_0x1354d8(0x24d)](),_0x33f995[_0x1354d8(0x20b)](),info('Retry\x20succ'+_0x1354d8(0x32e)+_0x1354d8(0x2bb)+_0x1354d8(0x318)+_0x1354d8(0x286)+_0x1354d8(0x293));const _0x9d5983=typeof _0xe92791[_0x1354d8(0x287)+'ified']===_0x1354d8(0x295)?_0xe92791[_0x1354d8(0x287)+'ified']():undefined;return _0x9d5983!==undefined?{'changes':_0x9d5983}:undefined;}catch(_0x56de33){try{_0x33f995[_0x1354d8(0x20b)]();}catch(_0x3d25d3){}throw _0x56de33;}}}throw _0x1e2efa;}}}catch(_0x19f08a){throw _0x19f08a;}},async 'prepare'(_0x29010a){try{const _0x38aef5=_0xe92791['prepare'](_0x29010a);return{async 'run'(..._0x3a511d){const _0x556fb5=_0x16a8;try{const _0x1c0f64=normalizeBindParams(_0x3a511d);if(_0x1c0f64!==undefined)_0x38aef5[_0x556fb5(0x332)](_0x1c0f64);_0x38aef5[_0x556fb5(0x24d)]();try{_0x38aef5[_0x556fb5(0x308)]();}catch(_0x17cd9a){}const _0x44d706=typeof _0xe92791[_0x556fb5(0x287)+_0x556fb5(0x22b)]===_0x556fb5(0x295)?_0xe92791[_0x556fb5(0x287)+_0x556fb5(0x22b)]():undefined;return _0x44d706!==undefined?{'changes':_0x44d706}:undefined;}catch(_0x105698){if(isUniqueConstraintError(_0x105698)){const _0x1eb09e=getUniquePolicy();if(_0x1eb09e===_0x556fb5(0x258))return debug(_0x556fb5(0x2f6)+_0x556fb5(0x36e)+_0x556fb5(0x34d)+_0x556fb5(0x36a)+'red\x20statem'+'ent\x20(polic'+_0x556fb5(0x1d8)+'\x20'+_0x29010a),undefined;if(_0x1eb09e===_0x556fb5(0x326)&&looksLikeSimpleInsert(_0x29010a)){const _0x47d860=_0x29010a[_0x556fb5(0x326)](/^\s*INSERT\s+INTO/i,_0x556fb5(0x304)+_0x556fb5(0x268)+'TO'),_0x49c5e4=_0xe92791[_0x556fb5(0x291)](_0x47d860);try{const _0xa674fe=normalizeBindParams(_0x3a511d);if(_0xa674fe!==undefined)_0x49c5e4['bind'](_0xa674fe);_0x49c5e4[_0x556fb5(0x24d)](),_0x49c5e4[_0x556fb5(0x20b)](),info(_0x556fb5(0x26e)+'eeded\x20usin'+_0x556fb5(0x2bb)+_0x556fb5(0x318)+'for\x20prepar'+_0x556fb5(0x213)+_0x556fb5(0x348)+').');const _0x5e9c23=typeof _0xe92791[_0x556fb5(0x287)+_0x556fb5(0x22b)]===_0x556fb5(0x295)?_0xe92791[_0x556fb5(0x287)+_0x556fb5(0x22b)]():undefined;return _0x5e9c23!==undefined?{'changes':_0x5e9c23}:undefined;}catch(_0x4b6ccd){try{_0x49c5e4[_0x556fb5(0x20b)]();}catch(_0x463ea9){}throw _0x4b6ccd;}}}throw _0x105698;}},async 'finalize'(){const _0x319f4f=_0x16a8;try{_0x38aef5[_0x319f4f(0x20b)]();}catch(_0x554969){}}};}catch(_0x25d55e){throw _0x25d55e;}},'export'(){const _0x139468=_0x16a8;try{return _0xe92791[_0x139468(0x2eb)]();}catch(_0xa1838f){throw _0xa1838f;}},async 'close'(){const _0x3dc6c2=_0x16a8;try{if(typeof _0xe92791[_0x3dc6c2(0x2a7)]===_0x3dc6c2(0x295))_0xe92791[_0x3dc6c2(0x2a7)]();else{if(typeof _0xe92791[_0x3dc6c2(0x20b)]===_0x3dc6c2(0x295))_0xe92791[_0x3dc6c2(0x20b)]();}}catch(_0x51f5a2){}}};}export async function initializeDatabase(){const _0x52bb97=_0xfbf890;info('Database\x20i'+_0x52bb97(0x1ec)+_0x52bb97(0x32b)+_0x52bb97(0x320)+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x4fe067=getConfig();maxTotalBytes=_0x4fe067[_0x52bb97(0x204)+_0x52bb97(0x1d0)]||(-0x1436+-0xb6*-0x4+0x8*0x232)*(-0x210b+0x81d+0x1cee)*(0x331*0x8+-0x112+-0x1476),cache=new MemoryCache(maxTotalBytes||(-0x3af*-0x1+-0x1*0x2bd+-0xc0)*(-0xc74+0x18c2*-0x1+0x2936)*(0x1*0x1025+0x21bc*-0x1+0x1597));const _0x48f3b2=_0x4fe067[_0x52bb97(0x2f7)+'OT']||process[_0x52bb97(0x309)](),_0x260056=_0x35eaea['resolve'](_0x48f3b2,_0x4fe067[_0x52bb97(0x264)]||_0x52bb97(0x316));await _0x4b8ed9[_0x52bb97(0x23e)](_0x260056);const _0x19c5c5=_0x4fe067[_0x52bb97(0x2c4)]||_0x52bb97(0x365)+_0x52bb97(0x351),_0x183f25=_0x35eaea['join'](_0x260056,_0x19c5c5);let _0x5c0815=![];try{let _0x15cf85=null,_0x31c507=null;try{_0x15cf85=await import('sqlite3'),_0x31c507=(await import('sqlite'))[_0x52bb97(0x1d3)];}catch(_0x48453e){_0x15cf85=null,_0x31c507=null;}if(_0x15cf85&&_0x31c507){await backupDB(_0x183f25);const _0x353f39=_0x15cf85['default']||_0x15cf85,_0xe61e4c=await _0x31c507({'filename':_0x183f25,'driver':_0x353f39[_0x52bb97(0x257)]});try{await _0xe61e4c['exec'](_0x52bb97(0x2d7)+_0x52bb97(0x36c)+_0x52bb97(0x323));}catch(_0xf35c18){}try{await _0xe61e4c[_0x52bb97(0x298)]('PRAGMA\x20syn'+_0x52bb97(0x236)+'\x20NORMAL;');}catch(_0xb6169a){}try{await _0xe61e4c[_0x52bb97(0x298)](_0x52bb97(0x2f3)+_0x52bb97(0x34f)+_0x52bb97(0x23b));}catch(_0x38ceb6){}try{await _0xe61e4c[_0x52bb97(0x298)](_0x52bb97(0x25e)+_0x52bb97(0x22a)+'=\x20ON;');}catch(_0x5d3210){}adapter=createNativeAdapter(_0xe61e4c),db=adapter,usingNative=!![],_0x5c0815=!![],info('Using\x20nati'+_0x52bb97(0x2ae)+_0x52bb97(0x227));}}catch(_0x274259){warn(_0x52bb97(0x350)+_0x52bb97(0x2f8)+_0x52bb97(0x1db)+_0x52bb97(0x275)+_0x52bb97(0x2ea)+_0x52bb97(0x353)+(_0x274259?.[_0x52bb97(0x1ee)]||_0x274259)),_0x5c0815=![],adapter=null,db=null,usingNative=![];}if(!_0x5c0815)try{const _0x28e192=await import('sql.js'),_0x1492aa=_0x28e192['default']||_0x28e192,_0x3a196c=await _0x1492aa({'locateFile':_0x4c1253=>{const _0x55ca41=_0x52bb97,_0x2d0ef5=_0x4fe067[_0x55ca41(0x327)+_0x55ca41(0x28f)];if(_0x2d0ef5)return _0x2d0ef5;return _0x35eaea['join'](process[_0x55ca41(0x309)](),_0x55ca41(0x35a)+'es',_0x55ca41(0x2f2),_0x55ca41(0x20d),_0x4c1253);}});let _0x29096c;if(await _0x4b8ed9[_0x52bb97(0x2ca)](_0x183f25)){const _0x33e8de=await _0x4b8ed9[_0x52bb97(0x249)](_0x183f25),_0x15a93a=new Uint8Array(_0x33e8de);_0x29096c=new _0x3a196c['Database'](_0x15a93a),info(_0x52bb97(0x2c1)+_0x52bb97(0x230)+_0x52bb97(0x237)+'m\x20'+_0x183f25);}else _0x29096c=new _0x3a196c[(_0x52bb97(0x257))](),info('Created\x20ne'+'w\x20in-memor'+'y\x20SQL.js\x20D'+_0x52bb97(0x2aa)+_0x52bb97(0x35e));adapter=createSQLjsAdapter(_0x29096c),db=adapter,usingNative=![],info(_0x52bb97(0x1ea)+_0x52bb97(0x270)+_0x52bb97(0x2b4));}catch(_0x1fbf22){error('SQL.js\x20fal'+_0x52bb97(0x2c8)+_0x52bb97(0x259),_0x1fbf22);throw _0x1fbf22;}try{if(adapter&&typeof adapter[_0x52bb97(0x298)]===_0x52bb97(0x295))await adapter['exec'](_0x52bb97(0x25e)+'eign_keys\x20'+'=\x20ON;');}catch(_0x1590ed){}try{if(adapter&&typeof adapter[_0x52bb97(0x298)]===_0x52bb97(0x295))await adapter[_0x52bb97(0x298)]('PRAGMA\x20bus'+'y_timeout\x20'+_0x52bb97(0x23b));}catch(_0x43fee7){}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[],queueBytes=queueBytes||-0x18de+0x10db*0x2+-0x11b*0x8;const _0x12a7f8=_0x4fe067['DB_FLUSH_I'+'NTERVAL']||-0x31*0x37+-0x6bf+-0x1a*-0xf7;flushTimer=setInterval(()=>{const _0x4ece34=_0x52bb97;flushQueue()[_0x4ece34(0x27a)](_0x20ac89=>error('Unhandled\x20'+'error\x20duri'+'ng\x20schedul'+_0x4ece34(0x219)+'eue:',_0x20ac89));},_0x12a7f8),info(_0x52bb97(0x241)+_0x52bb97(0x28a)+'\x20('+(usingNative?'native\x20sql'+'ite3':_0x52bb97(0x34b))+(_0x52bb97(0x24e)+'\x20file:\x20')+_0x183f25);try{(function _0x3a5c0f(){setTimeout(async()=>{const _0x40ccb1=_0x16a8;try{if(!dbReady||!adapter)return _0x3a5c0f();if(adapter&&typeof adapter['get']===_0x40ccb1(0x295))try{await adapter[_0x40ccb1(0x2a9)]('SELECT\x201\x20a'+_0x40ccb1(0x2f5));}catch(_0x5595f1){throw _0x5595f1;}else{if(adapter&&typeof adapter['exec']===_0x40ccb1(0x295))try{await adapter['exec'](_0x40ccb1(0x2e1));}catch(_0x565646){throw _0x565646;}}}catch(_0x2c0213){isDbClosedError(_0x2c0213)?(warn('DB\x20health\x20'+'ping\x20detec'+_0x40ccb1(0x1ed)+_0x40ccb1(0x364)+_0x40ccb1(0x229)+_0x40ccb1(0x20c)),await scheduleReinitializeAfterError(_0x2c0213)):debug(_0x40ccb1(0x2ec)+'ping\x20error'+_0x40ccb1(0x2be)+_0x40ccb1(0x2e0),_0x2c0213?.[_0x40ccb1(0x1ee)]||_0x2c0213);}finally{_0x3a5c0f();}},(0x173*0x4+0x1fed+0x3*-0xc7f)*(-0x10d*-0x1a+0xcf*0x9+-0x1eb1));}());}catch(_0x45b45e){}}catch(_0x563d7a){error('DB\x20init\x20er'+_0x52bb97(0x212)+(_0x563d7a?.[_0x52bb97(0x1ee)]||_0x563d7a),_0x563d7a);throw _0x563d7a;}}function _0x16a8(_0x59fb5e,_0x4405cd){const _0x4e14b9=_0x2e18();return _0x16a8=function(_0x3fd430,_0x4b473e){_0x3fd430=_0x3fd430-(0x18d1+0xebc+-0x25c1);let _0x48875d=_0x4e14b9[_0x3fd430];return _0x48875d;},_0x16a8(_0x59fb5e,_0x4405cd);}async function prepareStatements(){const _0xe09faf=_0xfbf890;if(!adapter)throw new Error(_0xe09faf(0x306)+_0xe09faf(0x24f)+_0xe09faf(0x1f8)+_0xe09faf(0x362)+_0xe09faf(0x260));if(setStmt){try{await setStmt[_0xe09faf(0x303)]();}catch(_0x30b69a){}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0xe09faf(0x303)]();}catch(_0x5c5e1d){}deleteStmt=null;}try{setStmt=await adapter[_0xe09faf(0x291)](_0xe09faf(0x304)+_0xe09faf(0x268)+_0xe09faf(0x1d7)+'ue_store\x20('+_0xe09faf(0x310)+')\x20VALUES\x20('+_0xe09faf(0x313)),deleteStmt=await adapter[_0xe09faf(0x291)]('DELETE\x20FRO'+_0xe09faf(0x282)+_0xe09faf(0x2b5)+'ERE\x20key\x20=\x20'+'?'),info('Prepared\x20D'+'B\x20statemen'+_0xe09faf(0x1fc)+'lete).');}catch(_0x303150){if(isDbClosedError(_0x303150)){warn('prepareSta'+_0xe09faf(0x272)+_0xe09faf(0x33b)+_0xe09faf(0x2d0)+_0xe09faf(0x321));throw _0x303150;}error(_0xe09faf(0x244)+_0xe09faf(0x223)+_0xe09faf(0x2a6)+'s:',_0x303150);throw _0x303150;}}async function applyMigrations(){const _0x34c17e=_0xfbf890;if(!adapter)throw new Error(_0x34c17e(0x306)+'t\x20availabl'+_0x34c17e(0x25d)+_0x34c17e(0x2fb)+_0x34c17e(0x312));await adapter[_0x34c17e(0x298)](_0x34c17e(0x235)+_0x34c17e(0x355)+'EXISTS\x20key'+_0x34c17e(0x1fe)+_0x34c17e(0x2d6)+_0x34c17e(0x314)+_0x34c17e(0x255)+_0x34c17e(0x23c)),await adapter[_0x34c17e(0x298)](_0x34c17e(0x235)+_0x34c17e(0x355)+_0x34c17e(0x345)+_0x34c17e(0x2ad)+_0x34c17e(0x2d5)+_0x34c17e(0x32f)+'ule\x20TEXT,\x20'+_0x34c17e(0x242)+_0x34c17e(0x324)+_0x34c17e(0x24a)),await adapter[_0x34c17e(0x298)]('\x0a\x20\x20\x20\x20CREAT'+'E\x20TABLE\x20IF'+_0x34c17e(0x271)+_0x34c17e(0x331)+_0x34c17e(0x328)+_0x34c17e(0x247)+'T\x20NOT\x20NULL'+_0x34c17e(0x1e0)+_0x34c17e(0x280)+_0x34c17e(0x2c6)+_0x34c17e(0x238)+_0x34c17e(0x33f)+_0x34c17e(0x21b)+_0x34c17e(0x2c6)+'\x20DEFAULT\x20\x27'+_0x34c17e(0x26f)+_0x34c17e(0x2dd)+_0x34c17e(0x1e5)+_0x34c17e(0x25f)+_0x34c17e(0x252)+_0x34c17e(0x263)+'Y\x20KEY\x20(nam'+_0x34c17e(0x319)+_0x34c17e(0x217)+'\x20\x20'),await adapter['exec'](_0x34c17e(0x1ef)+_0x34c17e(0x254)+'\x20NOT\x20EXIST'+_0x34c17e(0x346)+'faults\x20(\x0a\x20'+'\x20\x20\x20\x20\x20group'+_0x34c17e(0x1d2)+_0x34c17e(0x1e4)+',\x0a\x20\x20\x20\x20\x20\x20na'+_0x34c17e(0x361)+_0x34c17e(0x289)+'AULT\x20\x27[]\x27\x0a'+_0x34c17e(0x341)),await adapter[_0x34c17e(0x298)](_0x34c17e(0x1ef)+'E\x20TABLE\x20IF'+_0x34c17e(0x271)+_0x34c17e(0x281)+_0x34c17e(0x30e)+_0x34c17e(0x33e)+_0x34c17e(0x284)+_0x34c17e(0x314)+_0x34c17e(0x211)+_0x34c17e(0x1f9)+_0x34c17e(0x1d5)+_0x34c17e(0x27f)+';\x0a\x20\x20'),await adapter['exec'](_0x34c17e(0x1ef)+_0x34c17e(0x254)+_0x34c17e(0x271)+_0x34c17e(0x349)+_0x34c17e(0x296)+_0x34c17e(0x1dc)+_0x34c17e(0x2d5)+_0x34c17e(0x23a)+_0x34c17e(0x2db)+_0x34c17e(0x1e5)+_0x34c17e(0x231)+_0x34c17e(0x21f)+_0x34c17e(0x2c2)+_0x34c17e(0x1d6)+_0x34c17e(0x2af)+_0x34c17e(0x228)+_0x34c17e(0x250)+_0x34c17e(0x35c)+_0x34c17e(0x330)+_0x34c17e(0x1f7)+_0x34c17e(0x20a)+_0x34c17e(0x2fe)+'EFAULT\x200,\x0a'+_0x34c17e(0x25a)+_0x34c17e(0x240)+_0x34c17e(0x1cd)+_0x34c17e(0x1d1)+'ted\x20INTEGE'+_0x34c17e(0x301)+'\x20'),await adapter[_0x34c17e(0x298)](_0x34c17e(0x27b)+'QUE\x20INDEX\x20'+'IF\x20NOT\x20EXI'+_0x34c17e(0x354)+_0x34c17e(0x218)+_0x34c17e(0x26c)+_0x34c17e(0x368)+_0x34c17e(0x267)+'id,\x20timefr'+_0x34c17e(0x307)+'t_key);');}async function flushQueue(){const _0x73f6e1=_0xfbf890;if(!dbReady||isFlushing||writeQueue[_0x73f6e1(0x29a)]===-0x1061+-0x287*0xe+-0x3*-0x1141)return;const _0x37936b=writeQueue[0x461+-0x160c+-0x1*-0x11ab];if(_0x37936b&&_0x37936b['retries']>-0x5*-0x62b+-0x174a+-0x78d&&Date[_0x73f6e1(0x2fc)]()-_0x37936b[_0x73f6e1(0x22d)]<0xfb*-0xb+-0x16a9+0x1695*0x2)return;if(!setStmt||!deleteStmt)try{if(!adapter)throw new Error(_0x73f6e1(0x200)+_0x73f6e1(0x34c)+'\x20to\x20prepar'+_0x73f6e1(0x209)+'ts.');await prepareStatements();}catch(_0x3498b7){if(isDbClosedError(_0x3498b7)){warn('DB\x20closed\x20'+_0x73f6e1(0x31b)+_0x73f6e1(0x1eb)+_0x73f6e1(0x2e2)+_0x73f6e1(0x1f6)+_0x73f6e1(0x2e5)),await scheduleReinitializeAfterError(_0x3498b7);return;}else{error(_0x73f6e1(0x244)+'prepare\x20st'+_0x73f6e1(0x2cc)+_0x73f6e1(0x2cf)+_0x73f6e1(0x22f),_0x3498b7);return;}}isFlushing=!![];const _0x3387c5=getConfig(),_0x459164=_0x3387c5[_0x73f6e1(0x205)+'IZE']||-0x7fa+-0x1*0x157f+0x1dab,_0x4dd23c=writeQueue[_0x73f6e1(0x2cb)](0x1*-0x1b0d+-0x905*0x1+0x1b*0x156,_0x459164),_0x1f1056=_0x4dd23c[_0x73f6e1(0x337)]((_0x4896b2,_0x7a1c3d)=>_0x4896b2+(_0x7a1c3d[_0x73f6e1(0x370)]||0x228a*0x1+-0x1*-0x1a65+0x13*-0x335),0xa*-0x359+0x2*-0x1166+-0x3*-0x16c2);try{if(adapter&&typeof adapter[_0x73f6e1(0x298)]===_0x73f6e1(0x295))await adapter[_0x73f6e1(0x298)](_0x73f6e1(0x22e)+_0x73f6e1(0x369));for(const _0x2aff0b of _0x4dd23c){try{switch(_0x2aff0b['type']){case _0x73f6e1(0x224):if(!setStmt)throw new Error('setStmt\x20mi'+_0x73f6e1(0x261));await setStmt['run'](_0x2aff0b[_0x73f6e1(0x36f)],_0x2aff0b[_0x73f6e1(0x2c9)]);break;case _0x73f6e1(0x2ef):if(!deleteStmt)throw new Error(_0x73f6e1(0x21a)+_0x73f6e1(0x294));await deleteStmt['run'](_0x2aff0b[_0x73f6e1(0x36f)]);break;default:warn('Unknown\x20qu'+'eue\x20item\x20t'+_0x73f6e1(0x2d3)+_0x73f6e1(0x29e)+_0x2aff0b[_0x73f6e1(0x1ce)]);}}catch(_0x16991d){if(isDbClosedError(_0x16991d))throw _0x16991d;error(_0x73f6e1(0x244)+_0x73f6e1(0x1d4)+_0x73f6e1(0x2a0)+_0x73f6e1(0x28d)+_0x73f6e1(0x288)+_0x73f6e1(0x2e3)+_0x73f6e1(0x2e9)+JSON[_0x73f6e1(0x2d8)](_0x2aff0b)+(_0x73f6e1(0x31a)+'\x20')+(_0x16991d?.[_0x73f6e1(0x1ee)]||_0x16991d));throw _0x16991d;}}if(adapter&&typeof adapter[_0x73f6e1(0x298)]===_0x73f6e1(0x295))await adapter['exec'](_0x73f6e1(0x253));if(!usingNative)try{await persistDatabaseToFile();}catch(_0x133297){error(_0x73f6e1(0x244)+_0x73f6e1(0x279)+_0x73f6e1(0x315)+_0x73f6e1(0x29d),_0x133297);}queueBytes=Math['max'](0x256b+0x89b*-0x1+0x734*-0x4,queueBytes-_0x1f1056),reinitBackoffMs=-0x1c40+0xec1*0x1+0x1167;}catch(_0x42331c){if(isDbClosedError(_0x42331c)){error('DB\x20appears'+_0x73f6e1(0x1cc)+_0x73f6e1(0x232)+'\x20flush.\x20Wi'+'ll\x20attempt'+'\x20reinitial'+_0x73f6e1(0x245),_0x42331c);try{if(adapter&&typeof adapter[_0x73f6e1(0x298)]===_0x73f6e1(0x295))await adapter[_0x73f6e1(0x298)]('ROLLBACK;');}catch(_0x2f066a){}writeQueue[_0x73f6e1(0x1f4)](..._0x4dd23c),await scheduleReinitializeAfterError(_0x42331c);}else{error(_0x73f6e1(0x343)+_0x73f6e1(0x347)+'\x20failed,\x20r'+_0x73f6e1(0x1e1)+_0x73f6e1(0x338)+'ng\x20for\x20ret'+'ry.',_0x42331c);try{if(adapter&&typeof adapter[_0x73f6e1(0x298)]===_0x73f6e1(0x295))await adapter['exec']('ROLLBACK;');}catch(_0x18f782){error(_0x73f6e1(0x1cf)+_0x73f6e1(0x1f1),_0x18f782);}const _0x2ccefa=Date[_0x73f6e1(0x2fc)](),_0x955d0f=[];for(const _0x338dc6 of _0x4dd23c){_0x338dc6[_0x73f6e1(0x2b2)]=(_0x338dc6[_0x73f6e1(0x2b2)]||0x13e8+0x0+-0x13e8*0x1)+(-0x37c*-0x7+-0x22*0x40+-0xfe3),_0x338dc6['timestamp']=_0x2ccefa;if(_0x338dc6[_0x73f6e1(0x2b2)]<-0x1*-0x201d+-0x2363+-0x4*-0xd2)_0x955d0f[_0x73f6e1(0x2f9)](_0x338dc6);else error(_0x73f6e1(0x367)+'DB\x20item\x20di'+_0x73f6e1(0x325)+'ter\x20multip'+'le\x20failure'+_0x73f6e1(0x20e)+JSON[_0x73f6e1(0x2d8)](_0x338dc6));}if(_0x955d0f[_0x73f6e1(0x29a)]>0x1f19+0x1660+-0x1b*0x1fb)writeQueue[_0x73f6e1(0x1f4)](..._0x955d0f);queueBytes=Math[_0x73f6e1(0x2da)](-0x4dc+-0x139*-0x2+0x26a*0x1,queueBytes-_0x1f1056+_0x955d0f[_0x73f6e1(0x337)]((_0x57b802,_0x26c353)=>_0x57b802+(_0x26c353[_0x73f6e1(0x370)]||0x1*-0xeb9+0x2e3*-0x7+0x22ee),-0x256b+-0x1e3e+0x43a9));}}finally{isFlushing=![];}}async function persistDatabaseToFile(){const _0x531666=_0xfbf890,_0x13c8af=getConfig(),_0x388af6=_0x13c8af[_0x531666(0x2f7)+'OT']||process[_0x531666(0x309)](),_0xc15bd=_0x35eaea[_0x531666(0x278)](_0x388af6,_0x13c8af[_0x531666(0x264)]||'.db'),_0x45a59a=_0x13c8af['DB_NAME']||_0x531666(0x365)+_0x531666(0x351),_0x455332=_0x35eaea[_0x531666(0x262)](_0xc15bd,_0x45a59a);if(usingNative)return;if(!adapter){warn(_0x531666(0x329)+_0x531666(0x1da)+_0x531666(0x202)+'\x20missing,\x20'+'skipping\x20p'+_0x531666(0x27d));return;}try{const _0x5a0f4d=adapter['export']();if(!_0x5a0f4d)return;const _0x3ee9b3=_0x455332+_0x531666(0x33d);await _0x4b8ed9[_0x531666(0x352)](_0x3ee9b3,Buffer[_0x531666(0x333)](_0x5a0f4d)),await _0x4b8ed9['move'](_0x3ee9b3,_0x455332,{'overwrite':!![]}),info(_0x531666(0x302)+_0x531666(0x34a)+'o\x20'+_0x455332);}catch(_0x5281cd){if(isDbClosedError(_0x5281cd)){warn('persistDat'+'abaseToFil'+_0x531666(0x356)+_0x531666(0x340)+_0x531666(0x1f3)+_0x531666(0x2c5)+'init.'),await scheduleReinitializeAfterError(_0x5281cd);return;}throw _0x5281cd;}}function _0x2e18(){const _0x3f5b1f=['CRITICAL:\x20','\x20active_st','SACTION;','r\x20in\x20prepa','mtimeMs','rnal_mode\x20','shing\x20queu','IQUE\x20const','key','size','\x20to\x20be\x20clo','EXT,\x0a\x20\x20\x20\x20\x20','type','Rollback\x20f','AX_BYTES','\x20last_upda','_id\x20TEXT\x20P','open','process\x20DB','\x20TEXT\x20NOT\x20','\x20\x20\x20\x20timefr','TO\x20key_val','y=ignore):','l.js):\x20','abaseToFil','ailed,\x20wil','\x20\x20\x20id\x20INTE','bytes','21CLxQKV','slice',',\x0a\x20\x20\x20\x20\x20\x20gr','olling\x20bac','essfully.','ed:\x20','RIMARY\x20KEY','d\x20TEXT\x20NOT','it.\x20Key:\x20','or.','\x20DB\x20reinit','ose:','Using\x20SQL.','aring\x20stat','nitializat','ted\x20closed','message','\x0a\x20\x20\x20\x20CREAT','all','ailed:','prev','ed\x20DB.\x20Sch','unshift','s):\x20','heduling\x20r','\x0a\x20\x20\x20\x20\x20\x20mes','e\x20for\x20prep','\x20\x20group_id','maxBytes','map','ts\x20(set/de','ignore)\x20in','_value_sto','Error\x20duri','No\x20adapter','pts:','e:\x20adapter','h\x20complete','DB_CACHE_M','DB_BATCH_S','cy=ignore)','next','dy\x20for\x20get','e\x20statemen','sage_count','free','it.','dist','s.\x20Item:\x20','N/A','e):\x20','\x20KEY,\x0a\x20\x20\x20\x20','ror:\x20','ed\x20stateme','exit','string','byteLength','d)\x0a\x20\x20\x20\x20);\x0a','tive_stats','ed\x20flushQu','deleteStmt','hat_id\x20TEX','leted\x20succ','est\x20item.\x20','tail','\x20\x20\x20user_ji','tive):\x20','nt\x20(native','get()\x20fail','prepare\x20DB','set','ll()\x20(poli','e\x20memory\x20p','\x20driver.','OT\x20NULL,\x0a\x20','uling\x20rein','eign_keys\x20','ified','statement\x20','timestamp','BEGIN\x20TRAN','hQueue:','file\x20into\x20','\x20NULL,\x0a\x20\x20\x20','sed\x20during','ng\x20flushQu','ache\x20for\x20o','CREATE\x20TAB','chronous\x20=','SQL.js\x20fro','\x20DEFAULT\x20\x27','\x22\x20from\x20DB:','Y\x20KEY,\x0a\x20\x20\x20','=\x2010000;','e\x20TEXT);','599052sEXQVm','ensureDir','stat','lay_name\x20T','Database\x20i','level\x20TEXT','.bak','Failed\x20to\x20','ization.','file\x20durin','\x20\x20name\x20TEX','shift','readFile','TEXT);','red\x20by\x20set','():','run',').\x20Backing','t\x20availabl','\x20\x20\x20\x20\x20bucke','min','ULT\x20\x27\x27,\x0a\x20\x20','COMMIT;','E\x20TABLE\x20IF','\x20KEY,\x20valu','able\x20alrea','Database','ignore','ed:','\x20\x20\x20\x20\x20\x20disp','ring\x20shutd','ing\x20(nativ','e\x20for\x20appl','PRAGMA\x20for','\x20NULL\x20DEFA','nts()','ssing','join','\x20\x20\x20\x20PRIMAR','DB_PATH','e...','onnection\x20','ats(chat_j','REPLACE\x20IN','ropped\x20old','trim','ng\x20final\x20f','_unique\x20ON','607704PldJPs','Retry\x20succ','[]\x27,\x0a\x20\x20\x20\x20\x20','js\x20(WASM)\x20','\x20NOT\x20EXIST','tements\x20fa','9UfrofY','for\x20prepar','l\x20attempt\x20','ocess\x20init','Error\x20fina','resolve','persist\x20DB','catch','CREATE\x20UNI','et()\x20(poli','ersist.','estimateSi','NULL\x0a\x20\x20\x20\x20)','oup_id\x20TEX','S\x20user_act','M\x20key_valu','\x20prepared\x20','ser_key\x20TE','Final\x20flus','for\x20run()\x20','getRowsMod','ed\x20by\x20tran','T\x20NULL\x20DEF','nitialized','head','ing\x20(sql.j','l\x20be\x20handl','dirname','_PATH','red\x20by\x20del','prepare','r\x20(policy=','(sql.js).','\x20missing','function','tats\x20(\x0a\x20\x20\x20','SQLITE','exec','Database\x20c','length','11563800nQEzge','\x22\x20is\x20not\x20s','r\x20commit:','\x20flush:\x20','lush\x20attem','\x20item,\x20wil','DB\x20not\x20rea','object','toLowerCas','OLICY','\x20in\x20','\x20statement','close','dy\x20exists)','get','B\x20(no\x20file','ignore)\x20wh','alized\x20aut','s\x20(ts\x20INTE','ve\x20sqlite3','ame\x20TEXT\x20N','DB\x20reiniti','12kOvWtz','retries','318327uPlXwL','adapter.','e_store\x20WH','utf8','lizing\x20del','test','ile\x20execut','r\x20during\x20g','g\x20INSERT\x20O','versized\x20i','has','\x20(non-fata','cuting\x20(na',',\x20Key:\x20','Loaded\x20DB\x20','d\x20TEXT,\x0a\x20\x20','(native):\x20','DB_NAME','eduling\x20re','T\x20NOT\x20NULL','ackup\x20crea','lback\x20fail','value','pathExists','splice','atements\x20b','isArray','356317KojnmY','efore\x20flus','se\x20DB\x20is\x20c','Database\x20s','g\x20shutdown','ype\x20during','ed\x20JSON\x20fo','GER\x20PRIMAR','re\x20(key\x20TE','PRAGMA\x20jou','stringify','parse\x20stor','max','\x20\x20\x20chat_ji','ng\x20final\x20d','\x20creator_i','_addToTail','L\x20error\x20(t','l):','SELECT\x201;','ements.\x20Sc','saction\x20ro','key\x20=\x20?','einit.','\x20after\x20err','includes','own:','llback:\x20','SQL.js\x20fal','export','DB\x20health\x20','g:\x20','atabase\x20cl','delete','_removeNod','finally','sql.js','PRAGMA\x20bus','ed\x20because','s\x20ok','Ignored\x20UN','PROJECT_RO','ite\x20init\x20f','push','ile\x20runnin','yMigration','now','Ignored\x20SQ','\x20INTEGER\x20D','parse','_moveToTai','R\x0a\x20\x20\x20\x20);\x0a\x20','Database\x20p','finalize','INSERT\x20OR\x20','Skipping\x20c','adapter\x20no','ame,\x20bucke','reset','cwd','eue\x20trigge','Stmt\x20durin','e;\x20skippin','isting\x20DB\x20','ive_groups','(native).','key,\x20value','\x20while\x20exe','s()','?,\x20?)','XT\x20PRIMARY','\x20file\x20afte','.db','276320oZwwhz','R\x20REPLACE\x20','e,\x20group_i',',\x20itemErr:','while\x20prep','key\x20\x22','eteStmt\x20du','170475abOkJo','iated.\x20Flu','s\x20started.','losed.','ax\x20','=\x20WAL;',',\x20message\x20','scarded\x20af','replace','SQLJS_WASM','ons\x20(\x0a\x20\x20\x20\x20','persistDat','g\x20persist.','ion\x20proces','Database\x20b','Error\x20pers','eeded\x20usin','Y\x20KEY,\x20mod','\x20NOT\x20NULL,','S\x20connecti','bind','from','\x22:\x20','\x20operation','serialized','reduce','k.\x20Prepari','omatically','ialization','iled\x20becau','getAsObjec','.tmp','\x20(\x0a\x20\x20\x20\x20\x20\x20u','\x27,\x0a\x20\x20\x20\x20\x20\x20c','ue\x20to\x20clos','\x20\x20\x20\x20);\x0a\x20\x20','code','DB\x20flush\x20t','r\x20during\x20a','EXISTS\x20log','S\x20group_de','ransaction','nt\x20(sql.js','S\x20active_s','ersisted\x20t','SQL.js','\x20available','raint\x20erro','IZE','y_timeout\x20','Native\x20sql','qlite','writeFile','lback.\x20','STS\x20idx_ac','LE\x20IF\x20NOT\x20','e\x20failed\x20d','tem\x20\x22','once','hutdown\x20pr','node_modul','Type:\x20','t_key\x20TEXT','Scheduling','\x20present)','\x22\x20(','ackup\x20fail','me\x20TEXT\x20NO','areStateme','extname','\x20DB;\x20sched','database.s','SIGTERM'];_0x2e18=function(){return _0x3f5b1f;};return _0x2e18();}export async function get(_0x319ef0){const _0x8233d6=_0xfbf890;try{if(cache&&cache[_0x8233d6(0x2bd)](_0x319ef0))return cache['get'](_0x319ef0);}catch(_0x2488ec){}if(!dbReady||!adapter)return warn(_0x8233d6(0x2a1)+_0x8233d6(0x208)+_0x8233d6(0x335)+'.'),undefined;try{const _0x3ed1ff=await adapter[_0x8233d6(0x2a9)]('SELECT\x20val'+'ue\x20FROM\x20ke'+'y_value_st'+'ore\x20WHERE\x20'+_0x8233d6(0x2e4),_0x319ef0);if(_0x3ed1ff&&_0x3ed1ff['value']!=null)try{const _0x3e9d8d=JSON[_0x8233d6(0x2ff)](_0x3ed1ff[_0x8233d6(0x2c9)]);try{cache['set'](_0x319ef0,_0x3e9d8d,_0x3ed1ff[_0x8233d6(0x2c9)]);}catch(_0x2854f6){}return _0x3e9d8d;}catch(_0x34c58e){return error(_0x8233d6(0x244)+_0x8233d6(0x2d9)+_0x8233d6(0x2d4)+'r\x20key\x20\x22'+_0x319ef0+_0x8233d6(0x334)+(_0x34c58e?.[_0x8233d6(0x1ee)]||_0x34c58e)),undefined;}}catch(_0x28d5cb){isDbClosedError(_0x28d5cb)?(warn(_0x8233d6(0x222)+_0x8233d6(0x2f4)+'\x20DB\x20is\x20clo'+'sed.\x20Sched'+'uling\x20rein'+_0x8233d6(0x1e6)+_0x319ef0),await scheduleReinitializeAfterError(_0x28d5cb)):error(_0x8233d6(0x244)+'get\x20key\x20\x22'+_0x319ef0+(_0x8233d6(0x239)+'\x20')+(_0x28d5cb?.['message']||_0x28d5cb),_0x28d5cb);}return undefined;}export function set(_0x685bb9,_0x421ca3){const _0x2c002c=_0xfbf890;if(_0x421ca3===undefined){del(_0x685bb9);return;}let _0x5e1314;try{_0x5e1314=JSON[_0x2c002c(0x2d8)](_0x421ca3);}catch(_0x47d322){error('Value\x20for\x20'+_0x2c002c(0x31c)+_0x685bb9+(_0x2c002c(0x29c)+'erializabl'+_0x2c002c(0x30c)+_0x2c002c(0x32a)),_0x47d322);return;}try{cache[_0x2c002c(0x224)](_0x685bb9,_0x421ca3,_0x5e1314);}catch(_0x417f09){}const _0xb4e8bb={'type':_0x2c002c(0x224),'key':_0x685bb9,'value':_0x5e1314,'retries':0x0,'timestamp':Date[_0x2c002c(0x2fc)]()};_0xb4e8bb[_0x2c002c(0x370)]=estimateQueueItemSize(_0xb4e8bb),queueBytes+=_0xb4e8bb[_0x2c002c(0x370)],writeQueue['push'](_0xb4e8bb),enforceMemoryLimit(),writeQueue[_0x2c002c(0x29a)]>=getConfig()[_0x2c002c(0x205)+_0x2c002c(0x34e)]&&flushQueue()['catch'](_0x2faab4=>{const _0xaffab9=_0x2c002c;error(_0xaffab9(0x1ff)+'ng\x20flushQu'+_0xaffab9(0x30a)+_0xaffab9(0x24b)+_0xaffab9(0x24c),_0x2faab4);});}export function del(_0x56da09){const _0x4a198b=_0xfbf890;try{cache[_0x4a198b(0x2ef)](_0x56da09);}catch(_0x2d7515){}const _0x2fecce={'type':_0x4a198b(0x2ef),'key':_0x56da09,'retries':0x0,'timestamp':Date[_0x4a198b(0x2fc)]()};_0x2fecce['size']=estimateQueueItemSize(_0x2fecce),queueBytes+=_0x2fecce['size'],writeQueue['push'](_0x2fecce),enforceMemoryLimit(),writeQueue[_0x4a198b(0x29a)]>=getConfig()[_0x4a198b(0x205)+'IZE']&&flushQueue()[_0x4a198b(0x27a)](_0x4f22c4=>{const _0xce2fb2=_0x4a198b;error('Error\x20duri'+_0xce2fb2(0x233)+_0xce2fb2(0x30a)+_0xce2fb2(0x290)+_0xce2fb2(0x24c),_0x4f22c4);});}export async function shutdownDatabase(){const _0x2ae44a=_0xfbf890;info('Database\x20s'+_0x2ae44a(0x359)+_0x2ae44a(0x276)+_0x2ae44a(0x31f)+_0x2ae44a(0x36d)+_0x2ae44a(0x265)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);try{await flushQueue(),await flushQueue(),info(_0x2ae44a(0x285)+_0x2ae44a(0x203)+'d.');}catch(_0x18c39a){error('Error\x20duri'+_0x2ae44a(0x26b)+_0x2ae44a(0x29f)+_0x2ae44a(0x201),_0x18c39a);}if(setStmt){try{await setStmt['finalize']();}catch(_0x12469e){warn(_0x2ae44a(0x277)+'lizing\x20set'+_0x2ae44a(0x30b)+_0x2ae44a(0x2d2)+':',_0x12469e);}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x2ae44a(0x303)]();}catch(_0x5c50c8){warn(_0x2ae44a(0x277)+_0x2ae44a(0x2b7)+_0x2ae44a(0x31d)+_0x2ae44a(0x25b)+_0x2ae44a(0x2e8),_0x5c50c8);}deleteStmt=null;}try{await persistDatabaseToFile();}catch(_0x504aa7){error(_0x2ae44a(0x32d)+_0x2ae44a(0x30d)+_0x2ae44a(0x246)+_0x2ae44a(0x2d2)+':',_0x504aa7);}if(adapter){try{await adapter[_0x2ae44a(0x2a7)](),info(_0x2ae44a(0x299)+_0x2ae44a(0x266)+'closed\x20cle'+'anly.');}catch(_0x319a43){error(_0x2ae44a(0x1ff)+_0x2ae44a(0x2dc)+_0x2ae44a(0x2ee)+_0x2ae44a(0x1e9),_0x319a43);}adapter=null,db=null;}info(_0x2ae44a(0x2d1)+'hutdown\x20pr'+'ocess\x20comp'+_0x2ae44a(0x21c)+_0x2ae44a(0x1e2));}async function backupDB(_0x17a46d){const _0x4061c5=_0xfbf890;try{if(!await _0x4b8ed9[_0x4061c5(0x2ca)](_0x17a46d))return;const _0x4d96dd=_0x35eaea[_0x4061c5(0x28e)](_0x17a46d),_0x1cbd0a=_0x35eaea['basename'](_0x17a46d,_0x35eaea[_0x4061c5(0x363)](_0x17a46d)),_0x577762=_0x35eaea['join'](_0x4d96dd,_0x1cbd0a+_0x4061c5(0x243)),_0x1d4da7=await _0x4b8ed9[_0x4061c5(0x2ca)](_0x577762)?await _0x4b8ed9[_0x4061c5(0x23f)](_0x577762):null,_0x5dc34c=_0x1d4da7?Date[_0x4061c5(0x2fc)]()-_0x1d4da7[_0x4061c5(0x36b)]:Infinity;_0x5dc34c>(0x1588*0x1+-0x300+-0x1270)*(-0x4*-0x7f1+0x1936+0x12ea*-0x3)*(-0x434*0x2+-0x4*0x270+0x1264)*(0x10a6*0x1+0xded+-0x1aab)&&(await _0x4b8ed9['copy'](_0x17a46d,_0x577762,{'overwrite':!![]}),info(_0x4061c5(0x32c)+_0x4061c5(0x2c7)+'ted\x20at\x20'+_0x577762));}catch(_0x40d57f){error(_0x4061c5(0x32c)+_0x4061c5(0x360)+_0x4061c5(0x1e3)+(_0x40d57f?.[_0x4061c5(0x1ee)]||_0x40d57f),_0x40d57f);}}process[_0xfbf890(0x358)]('SIGINT',()=>{const _0x46bb99=_0xfbf890;shutdownDatabase()[_0x46bb99(0x2f1)](()=>process[_0x46bb99(0x214)](-0x167c+0x2222+-0xba6));}),process[_0xfbf890(0x358)](_0xfbf890(0x366),()=>{const _0x16f090=_0xfbf890;shutdownDatabase()[_0x16f090(0x2f1)](()=>process[_0x16f090(0x214)](-0x2504+-0xe45+0x2b3*0x13));});export{adapter as _adapter};