const _0x54c5cf=_0x88ca;(function(_0x1ce6b3,_0x2927ba){const _0x9b78bf=_0x88ca,_0xbee4d0=_0x1ce6b3();while(!![]){try{const _0x3f977e=parseInt(_0x9b78bf(0x18b))/(-0x1426+-0xa3a+-0x4d*-0x65)+-parseInt(_0x9b78bf(0x217))/(0x14*0x5b+-0x26bc+-0x1*-0x1fa2)*(-parseInt(_0x9b78bf(0x167))/(-0x1393+-0x1075+-0x240b*-0x1))+-parseInt(_0x9b78bf(0x2a1))/(-0x573+0x7bb*-0x4+0x2463)+parseInt(_0x9b78bf(0x1f3))/(0xfac+-0x1*-0x1c18+-0x2bbf)*(-parseInt(_0x9b78bf(0x18c))/(-0x8e4*0x2+0x1f92+-0xdc4))+-parseInt(_0x9b78bf(0x211))/(-0x5*0x1a4+-0x13*0xef+-0x22a*-0xc)+-parseInt(_0x9b78bf(0x1fa))/(-0x1*-0xca8+-0x1749+-0x1*-0xaa9)*(parseInt(_0x9b78bf(0x1a0))/(0x79*0x1a+0x107*0x17+0x11f1*-0x2))+-parseInt(_0x9b78bf(0x2d7))/(-0x1447+0x1068+0x3e9)*(parseInt(_0x9b78bf(0x185))/(-0x1*0x9de+0x1027+-0x63e));if(_0x3f977e===_0x2927ba)break;else _0xbee4d0['push'](_0xbee4d0['shift']());}catch(_0x357b7c){_0xbee4d0['push'](_0xbee4d0['shift']());}}}(_0x31bc,0xff6+0x2bf2e+0x171b4));import _0x543e7b from'fs-extra';import _0x1ad352 from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;let usingNative=![],setStmt=null,deleteStmt=null,dbReady=![],writeQueue=[],queueBytes=0x842+0x5*-0x7b5+0x1*0x1e47,maxTotalBytes=-0x703*-0x1+-0x1578+0x1*0xe75,isFlushing=![],lastFlushTime=0x18f5+-0x33*-0x7d+0x1*-0x31dc,flushTimer=null,cache=null;function estimateQueueItemSize(_0x19addb){const _0x54b998=_0x88ca,_0x548c2a=0xbf9*-0x2+0x22a7+0x1*-0xa65;switch(_0x19addb['type']){case _0x54b998(0x1f0):return Buffer[_0x54b998(0x2b3)](_0x19addb['key'],_0x54b998(0x13b))+Buffer[_0x54b998(0x2b3)](_0x19addb[_0x54b998(0x1dc)],_0x54b998(0x13b))+_0x548c2a;case _0x54b998(0x224):return Buffer[_0x54b998(0x2b3)](_0x19addb[_0x54b998(0x2b2)],'utf8')+_0x548c2a;default:return 0x2064+0x1f7b*0x1+-0x3f5f;}}class MemoryCache{constructor(_0x3c1cc4){const _0x4aa43e=_0x88ca;this[_0x4aa43e(0x199)]=_0x3c1cc4,this['bytes']=-0x1992+-0x1*0x188c+0x321e,this[_0x4aa43e(0x1bd)]=new Map(),this[_0x4aa43e(0x173)]={'prev':null,'next':null},this['tail']={'prev':null,'next':null},this[_0x4aa43e(0x173)]['next']=this[_0x4aa43e(0x13e)],this[_0x4aa43e(0x13e)][_0x4aa43e(0x1d5)]=this[_0x4aa43e(0x173)];}static[_0x54c5cf(0x21e)+'ze'](_0x24a016,_0x5e28d9){const _0x12f622=_0x54c5cf,_0x341474=Buffer[_0x12f622(0x2b3)](String(_0x24a016),_0x12f622(0x13b)),_0x3aa237=Buffer[_0x12f622(0x2b3)](_0x5e28d9??'',_0x12f622(0x13b));return _0x341474+_0x3aa237+(-0x2312*-0x1+-0x1296+-0x103c);}[_0x54c5cf(0x15b)+'e'](_0x3d0ca0){const _0x516f8c=_0x54c5cf;_0x3d0ca0[_0x516f8c(0x1d5)][_0x516f8c(0x1ac)]=_0x3d0ca0[_0x516f8c(0x1ac)],_0x3d0ca0[_0x516f8c(0x1ac)][_0x516f8c(0x1d5)]=_0x3d0ca0['prev'];}[_0x54c5cf(0x1a1)](_0x5971c6){const _0x1f6d4f=_0x54c5cf;_0x5971c6[_0x1f6d4f(0x1d5)]=this['tail'][_0x1f6d4f(0x1d5)],_0x5971c6[_0x1f6d4f(0x1ac)]=this['tail'],this[_0x1f6d4f(0x13e)][_0x1f6d4f(0x1d5)]['next']=_0x5971c6,this[_0x1f6d4f(0x13e)][_0x1f6d4f(0x1d5)]=_0x5971c6;}[_0x54c5cf(0x2a5)+'l'](_0x37cb74){const _0x565046=_0x54c5cf;this['_removeNod'+'e'](_0x37cb74),this[_0x565046(0x1a1)](_0x37cb74);}[_0x54c5cf(0x1e7)](_0x1b1aef){const _0x305c0b=_0x54c5cf;return this[_0x305c0b(0x1bd)][_0x305c0b(0x1e7)](_0x1b1aef);}[_0x54c5cf(0x189)](_0x4b96df){const _0x447217=_0x54c5cf,_0x42e5d1=this[_0x447217(0x1bd)][_0x447217(0x189)](_0x4b96df);if(!_0x42e5d1)return undefined;return this['_moveToTai'+'l'](_0x42e5d1),_0x42e5d1[_0x447217(0x1dc)];}[_0x54c5cf(0x1f0)](_0x1f5450,_0x4071db,_0x1cccb1){const _0x4a4999=_0x54c5cf,_0x5a9135=this[_0x4a4999(0x1bd)]['get'](_0x1f5450),_0x196065=MemoryCache[_0x4a4999(0x21e)+'ze'](_0x1f5450,_0x1cccb1);if(_0x196065>this[_0x4a4999(0x199)]){warn('Skipping\x20c'+_0x4a4999(0x276)+_0x4a4999(0x29a)+_0x4a4999(0x1df)+_0x1f5450+_0x4a4999(0x1ab)+_0x196065+(_0x4a4999(0x1c2)+_0x4a4999(0x28b))+this[_0x4a4999(0x199)]+')');if(_0x5a9135)this[_0x4a4999(0x224)](_0x1f5450);return;}if(_0x5a9135)this['bytes']-=_0x5a9135[_0x4a4999(0x201)],_0x5a9135['value']=_0x4071db,_0x5a9135[_0x4a4999(0x268)]=_0x1cccb1,_0x5a9135[_0x4a4999(0x201)]=_0x196065,this[_0x4a4999(0x2b4)]+=_0x196065,this[_0x4a4999(0x2a5)+'l'](_0x5a9135);else{const _0x314eb7={'key':_0x1f5450,'value':_0x4071db,'serialized':_0x1cccb1,'size':_0x196065,'prev':null,'next':null};this[_0x4a4999(0x1bd)][_0x4a4999(0x1f0)](_0x1f5450,_0x314eb7),this['_addToTail'](_0x314eb7),this[_0x4a4999(0x2b4)]+=_0x196065;}while(this[_0x4a4999(0x2b4)]>this[_0x4a4999(0x199)]){const _0x5e929b=this[_0x4a4999(0x173)][_0x4a4999(0x1ac)];if(_0x5e929b===this['tail'])break;this[_0x4a4999(0x224)](_0x5e929b['key']);}}[_0x54c5cf(0x224)](_0x3ffb9e){const _0x327b64=_0x54c5cf,_0x1d7062=this[_0x327b64(0x1bd)][_0x327b64(0x189)](_0x3ffb9e);if(!_0x1d7062)return;this['_removeNod'+'e'](_0x1d7062),this['map']['delete'](_0x3ffb9e),this[_0x327b64(0x2b4)]-=_0x1d7062[_0x327b64(0x201)];}}function enforceMemoryLimit(){const _0xe455e9=_0x54c5cf;while(cache&&cache[_0xe455e9(0x2b4)]+queueBytes>maxTotalBytes&&writeQueue['length']>0x1*-0x1389+-0x124b+0x24*0x10d){const _0x3d81ee=writeQueue['shift']();if(_0x3d81ee[_0xe455e9(0x201)])queueBytes-=_0x3d81ee[_0xe455e9(0x201)];warn(_0xe455e9(0x177)+_0xe455e9(0x180)+_0xe455e9(0x1e9)+_0xe455e9(0x267)+_0xe455e9(0x1d7)+_0xe455e9(0x1d0)+_0x3d81ee[_0xe455e9(0x22c)]+_0xe455e9(0x14f)+(_0x3d81ee[_0xe455e9(0x2b2)]||_0xe455e9(0x25f)));}}function normalizeBindParams(_0x3e9774){const _0xc8a15b=_0x54c5cf;if(!_0x3e9774||_0x3e9774[_0xc8a15b(0x2c3)]===0xb31*-0x3+-0x1*-0xe21+0x1372*0x1)return undefined;if(_0x3e9774['length']===0x1e85+-0x2254+0x3d0&&Array['isArray'](_0x3e9774[0x3d*0x57+0x6*-0x1ef+-0x921]))return _0x3e9774[0x4ed+-0x2*-0x1086+-0x25f9];if(_0x3e9774[_0xc8a15b(0x2c3)]===-0x1*0x1979+-0x92c*-0x1+0x104e&&typeof _0x3e9774[0xfa8+0x217a+-0x3122]===_0xc8a15b(0x295)&&_0x3e9774[-0x271*-0x10+0xb*-0x167+0x17a3*-0x1]!==null&&!Array['isArray'](_0x3e9774[0x39*0x27+0x2*-0x776+0x63d]))return _0x3e9774[-0x2017+-0x2*0x873+0x30fd];return _0x3e9774;}function isTableAlreadyExistsError(_0x3be33a){const _0x10e8ea=_0x54c5cf;try{const _0x380873=_0x3be33a&&(_0x3be33a[_0x10e8ea(0x1a5)]||String(_0x3be33a))||'';return/table .* already exists/i[_0x10e8ea(0x1f1)](_0x380873)||/\balready exists\b/i[_0x10e8ea(0x1f1)](_0x380873);}catch(_0x5a9ce1){return![];}}function isUniqueConstraintError(_0x33cb75){const _0x402708=_0x54c5cf;try{const _0x43bdc4=_0x33cb75&&(_0x33cb75['message']||String(_0x33cb75))||'';return/UNIQUE constraint failed/i[_0x402708(0x1f1)](_0x43bdc4)||/UNIQUE constraint/i[_0x402708(0x1f1)](_0x43bdc4);}catch(_0x40965c){return![];}}function looksLikeSimpleInsert(_0x1c04cd){const _0x2b369e=_0x54c5cf;if(!_0x1c04cd||typeof _0x1c04cd!==_0x2b369e(0x235))return![];return/^\s*INSERT\s+INTO\s+/i[_0x2b369e(0x1f1)](_0x1c04cd)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x2b369e(0x1f1)](_0x1c04cd);}function getUniquePolicy(){const _0x36ecfc=_0x54c5cf;try{const _0x189b20=getConfig(),_0x23c9d7=_0x189b20&&_0x189b20[_0x36ecfc(0x14b)+_0x36ecfc(0x23d)+_0x36ecfc(0x149)]||'ignore';return String(_0x23c9d7)[_0x36ecfc(0x209)+'e']()[_0x36ecfc(0x2a0)]();}catch(_0xbd409b){return _0x36ecfc(0x22b);}}let dbInitializingPromise=null,reinitBackoffMs=0x1*-0x1b16+-0x1f97*0x1+-0x3e95*-0x1;const MAX_REINIT_BACKOFF_MS=(0xe+-0x143*-0x2+-0x258)*(0x16f*0x7+-0x1*-0x1822+-0x1e43);function isDbClosedError(_0x1f889b){const _0x4de9e8=_0x54c5cf;if(!_0x1f889b)return![];const _0x1860ef=String(_0x1f889b[_0x4de9e8(0x1a5)]||_0x1f889b||'');if(/database is closed/i[_0x4de9e8(0x1f1)](_0x1860ef))return!![];if(/SQLITE_MISUSE/i['test'](_0x1860ef))return!![];if(_0x1f889b&&typeof _0x1f889b['code']===_0x4de9e8(0x235)&&_0x1f889b[_0x4de9e8(0x156)][_0x4de9e8(0x239)+'e']()[_0x4de9e8(0x171)](_0x4de9e8(0x2b9)))return/SQLITE_MISUSE|SQLITE_IOERR|SQLITE_MISUSE/i['test'](_0x1f889b[_0x4de9e8(0x156)]);return![];}async function scheduleReinitializeAfterError(_0x35a7c5){const _0x4a1634=_0x54c5cf;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;const _0x338a03=Math[_0x4a1634(0x2be)](reinitBackoffMs,MAX_REINIT_BACKOFF_MS);return warn(_0x4a1634(0x228)+_0x4a1634(0x21b)+_0x4a1634(0x2d4)+'\x20in\x20'+_0x338a03+(_0x4a1634(0x1c8)+_0x4a1634(0x22e))+(_0x35a7c5?.[_0x4a1634(0x1a5)]||_0x35a7c5)),dbInitializingPromise=((async()=>{const _0xae9beb=_0x4a1634;await new Promise(_0x293a31=>setTimeout(_0x293a31,_0x338a03));try{await initializeDatabase(),info('DB\x20reiniti'+_0xae9beb(0x24e)+_0xae9beb(0x297)+_0xae9beb(0x2ce)+_0xae9beb(0x2b7)),reinitBackoffMs=0x120c+-0x3*-0x514+0x8*-0x3ac;}catch(_0x29bc61){error(_0xae9beb(0x233)+'DB\x20reiniti'+'alization\x20'+'failed:',_0x29bc61),reinitBackoffMs=Math[_0xae9beb(0x2be)](MAX_REINIT_BACKOFF_MS,reinitBackoffMs*(0x1f54+0x1cec+-0x1*0x3c3e));try{await scheduleReinitializeAfterError(_0x29bc61);}catch(_0x4b8ff8){}}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function createNativeAdapter(_0x26218e){return{'_underlying':_0x26218e,async 'exec'(_0x17558f){const _0x5b292b=_0x88ca;try{await _0x26218e[_0x5b292b(0x28a)](_0x17558f);return;}catch(_0x368033){if(isTableAlreadyExistsError(_0x368033)){warn(_0x5b292b(0x221)+_0x5b292b(0x1af)+'able\x20alrea'+_0x5b292b(0x215)+_0x5b292b(0x1ba)+_0x5b292b(0x13d)+_0x5b292b(0x21a)+String(_0x17558f)[_0x5b292b(0x176)](0x1dd9+-0xf53+-0xe86,0x10c5+-0xef*-0x9+-0x179c));return;}if(isUniqueConstraintError(_0x368033)){const _0x23630b=getUniquePolicy();if(_0x23630b===_0x5b292b(0x22b)){debug(_0x5b292b(0x2bf)+_0x5b292b(0x155)+_0x5b292b(0x1f9)+_0x5b292b(0x2ba)+_0x5b292b(0x1e2)+_0x5b292b(0x296)+'ing\x20(nativ'+'e):\x20'+String(_0x17558f)['slice'](-0x169f+0x2*0x8b+0x1589,0x1e09+0x3*0x1db+0x1*-0x220a));return;}if(_0x23630b===_0x5b292b(0x15e)&&looksLikeSimpleInsert(_0x17558f)){const _0x18c887=_0x17558f[_0x5b292b(0x15e)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO');try{await _0x26218e[_0x5b292b(0x28a)](_0x18c887);return;}catch(_0x5c6cb2){throw _0x5c6cb2;}}}throw _0x368033;}},async 'get'(_0x267bfe,..._0x2cf816){try{const _0x6c3e01=normalizeBindParams(_0x2cf816);if(_0x6c3e01===undefined)return await _0x26218e['get'](_0x267bfe);return await _0x26218e['get'](_0x267bfe,_0x6c3e01);}catch(_0x32be4d){throw _0x32be4d;}},async 'all'(_0x32ba74,..._0x2fabd9){const _0x525061=_0x88ca;try{const _0xad7b3=normalizeBindParams(_0x2fabd9);if(_0xad7b3===undefined)return await _0x26218e[_0x525061(0x16b)](_0x32ba74);return await _0x26218e['all'](_0x32ba74,_0xad7b3);}catch(_0x23aef9){throw _0x23aef9;}},async 'run'(_0x5ea2e5,..._0x8eae15){const _0xbf32bc=_0x88ca;try{const _0x3b1cec=normalizeBindParams(_0x8eae15);let _0x4d2e99;return _0x3b1cec===undefined?_0x4d2e99=await _0x26218e[_0xbf32bc(0x161)](_0x5ea2e5):_0x4d2e99=await _0x26218e[_0xbf32bc(0x161)](_0x5ea2e5,_0x3b1cec),_0x4d2e99;}catch(_0xd84876){if(isUniqueConstraintError(_0xd84876)){const _0x3eedd2=getUniquePolicy();if(_0x3eedd2===_0xbf32bc(0x22b))return debug(_0xbf32bc(0x2bf)+'IQUE\x20const'+_0xbf32bc(0x1f9)+'r\x20(policy='+_0xbf32bc(0x1e2)+_0xbf32bc(0x166)+_0xbf32bc(0x28d)+':\x20'+String(_0x5ea2e5)[_0xbf32bc(0x176)](0x2355+0x1740+-0x3a95,0x1951*-0x1+0x203d+-0xe*0x62)),undefined;if(_0x3eedd2===_0xbf32bc(0x15e)&&looksLikeSimpleInsert(_0x5ea2e5)){const _0x3417cd=_0x5ea2e5['replace'](/^\s*INSERT\s+INTO/i,_0xbf32bc(0x1a4)+_0xbf32bc(0x284)+'TO'),_0x416789=normalizeBindParams(_0x8eae15);try{let _0x2f8216;if(_0x416789===undefined)_0x2f8216=await _0x26218e[_0xbf32bc(0x161)](_0x3417cd);else _0x2f8216=await _0x26218e['run'](_0x3417cd,_0x416789);return info('Retry\x20succ'+_0xbf32bc(0x190)+_0xbf32bc(0x153)+'R\x20REPLACE\x20'+_0xbf32bc(0x256)),_0x2f8216;}catch(_0x1675cf){throw _0x1675cf;}}}throw _0xd84876;}},async 'prepare'(_0x58a2f4){const _0x2872c6=_0x88ca,_0x13c63c=await _0x26218e[_0x2872c6(0x253)](_0x58a2f4);return{async 'run'(..._0x46b019){const _0x29d66a=_0x2872c6,_0x3ccd6b=normalizeBindParams(_0x46b019);try{let _0x481a02;if(_0x3ccd6b===undefined)_0x481a02=await _0x13c63c[_0x29d66a(0x161)]();else _0x481a02=await _0x13c63c['run'](_0x3ccd6b);return _0x481a02;}catch(_0x11c890){if(isUniqueConstraintError(_0x11c890)){const _0x3ca974=getUniquePolicy();if(_0x3ca974===_0x29d66a(0x22b))return debug(_0x29d66a(0x2bf)+_0x29d66a(0x155)+'raint\x20erro'+_0x29d66a(0x2ba)+_0x29d66a(0x2cd)+_0x29d66a(0x138)+'statement\x20'+_0x29d66a(0x270)+_0x58a2f4),undefined;if(_0x3ca974===_0x29d66a(0x15e)&&looksLikeSimpleInsert(_0x58a2f4)){const _0x3febee=_0x58a2f4['replace'](/^\s*INSERT\s+INTO/i,_0x29d66a(0x1a4)+'REPLACE\x20IN'+'TO'),_0x33e77d=await _0x26218e['prepare'](_0x3febee);try{let _0x1548aa;if(_0x3ccd6b===undefined)_0x1548aa=await _0x33e77d[_0x29d66a(0x161)]();else _0x1548aa=await _0x33e77d[_0x29d66a(0x161)](_0x3ccd6b);return await _0x33e77d['finalize'](),info('Retry\x20succ'+_0x29d66a(0x190)+_0x29d66a(0x153)+_0x29d66a(0x259)+_0x29d66a(0x274)+_0x29d66a(0x269)+'nt\x20(native'+').'),_0x1548aa;}catch(_0x1ad4c6){try{await _0x33e77d[_0x29d66a(0x237)]();}catch(_0x269fa1){}throw _0x1ad4c6;}}}throw _0x11c890;}},async 'finalize'(){try{await _0x13c63c['finalize']();}catch(_0x52d20d){}}};},async 'close'(){const _0x454e40=_0x88ca;try{await _0x26218e[_0x454e40(0x2d9)]();}catch(_0x2ceb3b){}},'export'(){return undefined;}};}function createSQLjsAdapter(_0x20b6e5){const _0x220f44=_0x20b6e5;return{'_underlying':_0x220f44,async 'exec'(_0x178589){const _0x49cdeb=_0x88ca;try{_0x220f44[_0x49cdeb(0x161)](_0x178589);return;}catch(_0x8efab5){if(isTableAlreadyExistsError(_0x8efab5)){warn(_0x49cdeb(0x221)+_0x49cdeb(0x1af)+_0x49cdeb(0x1ed)+_0x49cdeb(0x215)+'\x20while\x20exe'+_0x49cdeb(0x2ae)+_0x49cdeb(0x2d1)+String(_0x178589)[_0x49cdeb(0x176)](-0xefe+0xd59+0x1*0x1a5,0x955*0x4+0xc1*0x1f+-0x3b23));return;}if(isUniqueConstraintError(_0x8efab5)){const _0xebfc92=getUniquePolicy();if(_0xebfc92==='ignore'){debug('Ignored\x20UN'+_0x49cdeb(0x155)+_0x49cdeb(0x1f9)+_0x49cdeb(0x2ba)+_0x49cdeb(0x1e2)+_0x49cdeb(0x296)+_0x49cdeb(0x1a6)+_0x49cdeb(0x1b8)+String(_0x178589)[_0x49cdeb(0x176)](-0x2478+-0x58c+0x2a04,0xcd+0x36d*0x1+-0x16*0x1f));return;}if(_0xebfc92===_0x49cdeb(0x15e)&&looksLikeSimpleInsert(_0x178589)){const _0x326c56=_0x178589[_0x49cdeb(0x15e)](/^\s*INSERT\s+INTO/i,_0x49cdeb(0x1a4)+'REPLACE\x20IN'+'TO');try{_0x220f44[_0x49cdeb(0x161)](_0x326c56);return;}catch(_0x403e53){throw _0x403e53;}}}throw _0x8efab5;}},async 'get'(_0x526da1,..._0x1d5d48){const _0x1acd43=_0x88ca;try{const _0x39fbdc=_0x220f44['prepare'](_0x526da1);try{const _0x171570=normalizeBindParams(_0x1d5d48);if(_0x171570!==undefined)_0x39fbdc[_0x1acd43(0x272)](_0x171570);if(_0x39fbdc['step']()){const _0xee4704=_0x39fbdc[_0x1acd43(0x152)+'t']();return _0x39fbdc[_0x1acd43(0x188)](),_0xee4704;}else return _0x39fbdc[_0x1acd43(0x188)](),undefined;}catch(_0x10a7b7){try{_0x39fbdc[_0x1acd43(0x188)]();}catch(_0x19c3f4){}if(isUniqueConstraintError(_0x10a7b7)){const _0x5b3dcb=getUniquePolicy();if(_0x5b3dcb===_0x1acd43(0x22b))return debug(_0x1acd43(0x2bf)+_0x1acd43(0x155)+_0x1acd43(0x1f9)+_0x1acd43(0x1ec)+'et()\x20(poli'+_0x1acd43(0x1b2)+':\x20'+_0x526da1),undefined;}throw _0x10a7b7;}}catch(_0x42aed6){throw _0x42aed6;}},async 'all'(_0x5d8e61,..._0x44f660){const _0x274aa8=_0x88ca;try{const _0x26407d=_0x220f44[_0x274aa8(0x253)](_0x5d8e61),_0x4715a9=[];try{const _0x21507e=normalizeBindParams(_0x44f660);if(_0x21507e!==undefined)_0x26407d[_0x274aa8(0x272)](_0x21507e);while(_0x26407d[_0x274aa8(0x204)]())_0x4715a9[_0x274aa8(0x15a)](_0x26407d['getAsObjec'+'t']());return _0x26407d[_0x274aa8(0x188)](),_0x4715a9;}catch(_0x3933ea){try{_0x26407d[_0x274aa8(0x188)]();}catch(_0x528d2c){}if(isUniqueConstraintError(_0x3933ea)){const _0x992fb5=getUniquePolicy();if(_0x992fb5==='ignore')return debug(_0x274aa8(0x2bf)+_0x274aa8(0x155)+_0x274aa8(0x1f9)+_0x274aa8(0x186)+'ll()\x20(poli'+'cy=ignore)'+':\x20'+_0x5d8e61),_0x4715a9;}throw _0x3933ea;}}catch(_0x4f41e7){throw _0x4f41e7;}},async 'run'(_0x4b3fe6,..._0x5bc102){const _0x371703=_0x88ca;try{const _0x4b1493=normalizeBindParams(_0x5bc102);if(_0x4b1493===undefined){_0x220f44[_0x371703(0x161)](_0x4b3fe6);const _0x180887=typeof _0x220f44['getRowsMod'+'ified']===_0x371703(0x16f)?_0x220f44[_0x371703(0x1da)+_0x371703(0x168)]():undefined;return _0x180887!==undefined?{'changes':_0x180887}:undefined;}else{const _0x460ece=_0x220f44['prepare'](_0x4b3fe6);try{_0x460ece[_0x371703(0x272)](_0x4b1493),_0x460ece[_0x371703(0x161)](),_0x460ece['free']();const _0x455254=typeof _0x220f44['getRowsMod'+'ified']===_0x371703(0x16f)?_0x220f44[_0x371703(0x1da)+_0x371703(0x168)]():undefined;return _0x455254!==undefined?{'changes':_0x455254}:undefined;}catch(_0x5658c6){try{_0x460ece[_0x371703(0x188)]();}catch(_0x796ad){}if(isUniqueConstraintError(_0x5658c6)){const _0x3f7f47=getUniquePolicy();if(_0x3f7f47===_0x371703(0x22b))return debug(_0x371703(0x2bf)+_0x371703(0x155)+_0x371703(0x1f9)+_0x371703(0x2ba)+_0x371703(0x1e2)+_0x371703(0x166)+'g:\x20'+String(_0x4b3fe6)['slice'](-0x1b2a+0x2000+-0x4d6,-0x1f*-0x10d+-0x5*-0x39a+-0x3105)),undefined;if(_0x3f7f47===_0x371703(0x15e)&&looksLikeSimpleInsert(_0x4b3fe6)){const _0x311a62=_0x4b3fe6[_0x371703(0x15e)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO'),_0x12369c=_0x220f44['prepare'](_0x311a62);try{_0x12369c[_0x371703(0x272)](_0x4b1493),_0x12369c[_0x371703(0x161)](),_0x12369c[_0x371703(0x188)](),info(_0x371703(0x24d)+_0x371703(0x190)+_0x371703(0x153)+_0x371703(0x259)+_0x371703(0x157)+_0x371703(0x26a));const _0x2c37b4=typeof _0x220f44[_0x371703(0x1da)+'ified']===_0x371703(0x16f)?_0x220f44[_0x371703(0x1da)+'ified']():undefined;return _0x2c37b4!==undefined?{'changes':_0x2c37b4}:undefined;}catch(_0x55d499){try{_0x12369c[_0x371703(0x188)]();}catch(_0x102ffc){}throw _0x55d499;}}}throw _0x5658c6;}}}catch(_0x3c305f){throw _0x3c305f;}},async 'prepare'(_0x574ee1){const _0x483f83=_0x88ca;try{const _0x5a9e0f=_0x220f44[_0x483f83(0x253)](_0x574ee1);return{async 'run'(..._0x47088a){const _0x3465ac=_0x483f83;try{const _0x36930c=normalizeBindParams(_0x47088a);if(_0x36930c!==undefined)_0x5a9e0f[_0x3465ac(0x272)](_0x36930c);_0x5a9e0f['run']();try{_0x5a9e0f[_0x3465ac(0x20a)]();}catch(_0x2a87a1){}const _0x8181b8=typeof _0x220f44[_0x3465ac(0x1da)+_0x3465ac(0x168)]===_0x3465ac(0x16f)?_0x220f44[_0x3465ac(0x1da)+'ified']():undefined;return _0x8181b8!==undefined?{'changes':_0x8181b8}:undefined;}catch(_0x1b0296){if(isUniqueConstraintError(_0x1b0296)){const _0x10d83e=getUniquePolicy();if(_0x10d83e==='ignore')return debug(_0x3465ac(0x2bf)+_0x3465ac(0x155)+_0x3465ac(0x1f9)+_0x3465ac(0x298)+_0x3465ac(0x22d)+_0x3465ac(0x16c)+_0x3465ac(0x275)+'\x20'+_0x574ee1),undefined;if(_0x10d83e===_0x3465ac(0x15e)&&looksLikeSimpleInsert(_0x574ee1)){const _0x11dabe=_0x574ee1[_0x3465ac(0x15e)](/^\s*INSERT\s+INTO/i,_0x3465ac(0x1a4)+_0x3465ac(0x284)+'TO'),_0x51c4bb=_0x220f44['prepare'](_0x11dabe);try{const _0x5ab922=normalizeBindParams(_0x47088a);if(_0x5ab922!==undefined)_0x51c4bb['bind'](_0x5ab922);_0x51c4bb[_0x3465ac(0x161)](),_0x51c4bb[_0x3465ac(0x188)](),info(_0x3465ac(0x24d)+'eeded\x20usin'+_0x3465ac(0x153)+_0x3465ac(0x259)+_0x3465ac(0x274)+_0x3465ac(0x269)+'nt\x20(sql.js'+').');const _0x269dec=typeof _0x220f44[_0x3465ac(0x1da)+_0x3465ac(0x168)]===_0x3465ac(0x16f)?_0x220f44[_0x3465ac(0x1da)+_0x3465ac(0x168)]():undefined;return _0x269dec!==undefined?{'changes':_0x269dec}:undefined;}catch(_0x2b5da8){try{_0x51c4bb[_0x3465ac(0x188)]();}catch(_0x40f701){}throw _0x2b5da8;}}}throw _0x1b0296;}},async 'finalize'(){const _0x3a14e9=_0x483f83;try{_0x5a9e0f[_0x3a14e9(0x188)]();}catch(_0x4f747c){}}};}catch(_0x455bc5){throw _0x455bc5;}},'export'(){const _0x2ddde9=_0x88ca;try{return _0x220f44[_0x2ddde9(0x18f)]();}catch(_0x1b783f){throw _0x1b783f;}},async 'close'(){const _0x311d34=_0x88ca;try{if(typeof _0x220f44[_0x311d34(0x2d9)]===_0x311d34(0x16f))_0x220f44[_0x311d34(0x2d9)]();else{if(typeof _0x220f44['free']==='function')_0x220f44[_0x311d34(0x188)]();}}catch(_0x364dc2){}}};}export async function initializeDatabase(){const _0x15974a=_0x54c5cf;info('Database\x20i'+_0x15974a(0x1d2)+_0x15974a(0x214)+'s\x20started.'+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0xb75dcb=getConfig();maxTotalBytes=_0xb75dcb[_0x15974a(0x218)+'AX_BYTES']||(0x1638+0x22e6+-0x38ec)*(-0x995*0x2+-0x1*-0x1f45+-0x81b)*(-0x1de4+-0x7*0x4ca+-0x2*-0x21b5),cache=new MemoryCache(maxTotalBytes||(0x601*-0x1+0x1*-0x54b+-0x1*-0xb7e)*(0x1d8e+0x6f0+-0x1*0x207e)*(-0xeff+0x1fa2*-0x1+0x32a1));const _0x5bbd9b=_0xb75dcb['PROJECT_RO'+'OT']||process[_0x15974a(0x1ff)](),_0x1dcaad=_0x1ad352['resolve'](_0x5bbd9b,_0xb75dcb[_0x15974a(0x1b4)]||_0x15974a(0x154));await _0x543e7b[_0x15974a(0x19f)](_0x1dcaad);const _0x377e82=_0xb75dcb['DB_NAME']||'database.s'+_0x15974a(0x241),_0x55bd93=_0x1ad352['join'](_0x1dcaad,_0x377e82);let _0x422a50=![];try{let _0x203956=null,_0x51af3a=null;try{_0x203956=await import('sqlite3'),_0x51af3a=(await import('sqlite'))[_0x15974a(0x220)];}catch(_0x4406b2){_0x203956=null,_0x51af3a=null;}if(_0x203956&&_0x51af3a){await backupDB(_0x55bd93);const _0x4c9313=_0x203956[_0x15974a(0x2a7)]||_0x203956,_0x231b68=await _0x51af3a({'filename':_0x55bd93,'driver':_0x4c9313[_0x15974a(0x26f)]});try{await _0x231b68[_0x15974a(0x28a)](_0x15974a(0x194)+_0x15974a(0x139)+_0x15974a(0x17a));}catch(_0x32e477){}try{await _0x231b68[_0x15974a(0x28a)]('PRAGMA\x20syn'+_0x15974a(0x1a3)+_0x15974a(0x18e));}catch(_0x46877c){}try{await _0x231b68[_0x15974a(0x28a)]('PRAGMA\x20bus'+'y_timeout\x20'+_0x15974a(0x17f));}catch(_0x48eeff){}try{await _0x231b68[_0x15974a(0x28a)](_0x15974a(0x265)+'eign_keys\x20'+_0x15974a(0x131));}catch(_0xd1d163){}adapter=createNativeAdapter(_0x231b68),db=adapter,usingNative=!![],_0x422a50=!![],info(_0x15974a(0x25e)+_0x15974a(0x1b5)+_0x15974a(0x144));}}catch(_0x51e5b3){warn(_0x15974a(0x1a2)+_0x15974a(0x148)+_0x15974a(0x1b6)+_0x15974a(0x1e3)+_0x15974a(0x2b6)+'lback.\x20'+(_0x51e5b3?.[_0x15974a(0x1a5)]||_0x51e5b3)),_0x422a50=![],adapter=null,db=null,usingNative=![];}if(!_0x422a50)try{const _0x47158a=await import('sql.js'),_0x38c887=_0x47158a[_0x15974a(0x2a7)]||_0x47158a,_0x790373=await _0x38c887({'locateFile':_0xd874a2=>{const _0x4ccb0f=_0x15974a,_0x794dc9=_0xb75dcb['SQLJS_WASM'+_0x4ccb0f(0x20e)];if(_0x794dc9)return _0x794dc9;return _0x1ad352['join'](process[_0x4ccb0f(0x1ff)](),_0x4ccb0f(0x1ef)+'es','sql.js',_0x4ccb0f(0x2aa),_0xd874a2);}});let _0x496c39;if(await _0x543e7b['pathExists'](_0x55bd93)){const _0x272890=await _0x543e7b[_0x15974a(0x1c0)](_0x55bd93),_0x83c48a=new Uint8Array(_0x272890);_0x496c39=new _0x790373['Database'](_0x83c48a),info(_0x15974a(0x18a)+_0x15974a(0x2d5)+_0x15974a(0x2c1)+'m\x20'+_0x55bd93);}else _0x496c39=new _0x790373[(_0x15974a(0x26f))](),info(_0x15974a(0x20f)+'w\x20in-memor'+_0x15974a(0x232)+_0x15974a(0x24c)+_0x15974a(0x206));adapter=createSQLjsAdapter(_0x496c39),db=adapter,usingNative=![],info(_0x15974a(0x16d)+_0x15974a(0x260)+_0x15974a(0x1a7));}catch(_0x5396c6){error(_0x15974a(0x2b6)+_0x15974a(0x15c)+_0x15974a(0x196),_0x5396c6);throw _0x5396c6;}try{if(adapter&&typeof adapter['exec']===_0x15974a(0x16f))await adapter[_0x15974a(0x28a)](_0x15974a(0x265)+_0x15974a(0x292)+_0x15974a(0x131));}catch(_0x444117){}try{if(adapter&&typeof adapter[_0x15974a(0x28a)]==='function')await adapter['exec'](_0x15974a(0x13f)+_0x15974a(0x1de)+_0x15974a(0x17f));}catch(_0x20d26f){}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[],queueBytes=queueBytes||0x2*0xffb+0x9*0x1a5+0x2ec3*-0x1;const _0x459a46=_0xb75dcb[_0x15974a(0x1e8)+_0x15974a(0x170)]||0x1480+0x6*0x30b+-0x1d2*0x11;flushTimer=setInterval(()=>{const _0x5b91c0=_0x15974a;flushQueue()[_0x5b91c0(0x2d0)](_0xf3b051=>error(_0x5b91c0(0x234)+_0x5b91c0(0x21d)+_0x5b91c0(0x2bd)+'ed\x20flushQu'+_0x5b91c0(0x1f5),_0xf3b051));},_0x459a46),info('Database\x20i'+'nitialized'+'\x20('+(usingNative?_0x15974a(0x1aa)+'ite3':'SQL.js')+(_0x15974a(0x1f7)+'\x20file:\x20')+_0x55bd93);try{(function _0x276268(){setTimeout(async()=>{const _0x52a52e=_0x88ca;try{if(!dbReady||!adapter)return _0x276268();if(adapter&&typeof adapter[_0x52a52e(0x189)]==='function')try{await adapter['get'](_0x52a52e(0x1b3)+_0x52a52e(0x226));}catch(_0x756247){throw _0x756247;}else{if(adapter&&typeof adapter[_0x52a52e(0x28a)]==='function')try{await adapter['exec'](_0x52a52e(0x1e4));}catch(_0x2ff887){throw _0x2ff887;}}}catch(_0x1f2924){isDbClosedError(_0x1f2924)?(warn(_0x52a52e(0x225)+_0x52a52e(0x28f)+_0x52a52e(0x1f8)+_0x52a52e(0x242)+_0x52a52e(0x27a)+_0x52a52e(0x192)),await scheduleReinitializeAfterError(_0x1f2924)):debug(_0x52a52e(0x225)+_0x52a52e(0x290)+'\x20(non-fata'+_0x52a52e(0x287),_0x1f2924?.[_0x52a52e(0x1a5)]||_0x1f2924);}finally{_0x276268();}},(0xfa9*-0x1+0x107*-0xd+0x40*0x75)*(-0x1afa+-0x3*-0xa5e+-0x38));}());}catch(_0x3df14c){}}catch(_0x3f4c0f){error(_0x15974a(0x261)+_0x15974a(0x183)+(_0x3f4c0f?.[_0x15974a(0x1a5)]||_0x3f4c0f),_0x3f4c0f);throw _0x3f4c0f;}}async function prepareStatements(){const _0x30be4e=_0x54c5cf;if(!adapter)throw new Error('adapter\x20no'+_0x30be4e(0x2af)+_0x30be4e(0x2d3)+_0x30be4e(0x1ad)+_0x30be4e(0x22f));if(setStmt){try{await setStmt[_0x30be4e(0x237)]();}catch(_0x43c808){}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x30be4e(0x237)]();}catch(_0x3b84d6){}deleteStmt=null;}try{setStmt=await adapter['prepare'](_0x30be4e(0x1a4)+_0x30be4e(0x284)+_0x30be4e(0x135)+_0x30be4e(0x27e)+_0x30be4e(0x23a)+_0x30be4e(0x286)+'?,\x20?)'),deleteStmt=await adapter[_0x30be4e(0x253)](_0x30be4e(0x29f)+_0x30be4e(0x29b)+'e_store\x20WH'+'ERE\x20key\x20=\x20'+'?'),info(_0x30be4e(0x1bb)+_0x30be4e(0x1b0)+'ts\x20(set/de'+'lete).');}catch(_0x3739c1){if(isDbClosedError(_0x3739c1)){warn(_0x30be4e(0x132)+'tements\x20fa'+_0x30be4e(0x19c)+_0x30be4e(0x17c)+_0x30be4e(0x13a));throw _0x3739c1;}error('Failed\x20to\x20'+_0x30be4e(0x160)+_0x30be4e(0x2c8)+'s:',_0x3739c1);throw _0x3739c1;}}async function applyMigrations(){const _0x4a58cd=_0x54c5cf;if(!adapter)throw new Error(_0x4a58cd(0x16e)+_0x4a58cd(0x2af)+_0x4a58cd(0x246)+_0x4a58cd(0x141)+_0x4a58cd(0x133));await adapter[_0x4a58cd(0x28a)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20key'+'_value_sto'+'re\x20(key\x20TE'+'XT\x20PRIMARY'+_0x4a58cd(0x231)+'e\x20TEXT);'),await adapter[_0x4a58cd(0x28a)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20log'+'s\x20(ts\x20INTE'+_0x4a58cd(0x145)+_0x4a58cd(0x2d2)+_0x4a58cd(0x1cf)+_0x4a58cd(0x15d)+_0x4a58cd(0x174)+_0x4a58cd(0x1c7)),await adapter[_0x4a58cd(0x28a)](_0x4a58cd(0x14c)+'E\x20TABLE\x20IF'+'\x20NOT\x20EXIST'+_0x4a58cd(0x1c9)+_0x4a58cd(0x147)+_0x4a58cd(0x1db)+_0x4a58cd(0x13c)+_0x4a58cd(0x2a8)+_0x4a58cd(0x27d)+_0x4a58cd(0x13c)+_0x4a58cd(0x172)+'\x27,\x0a\x20\x20\x20\x20\x20\x20c'+_0x4a58cd(0x14d)+_0x4a58cd(0x13c)+_0x4a58cd(0x172)+_0x4a58cd(0x1d8)+'\x20creator_i'+_0x4a58cd(0x2a9)+_0x4a58cd(0x187)+'ULT\x20\x27\x27,\x0a\x20\x20'+'\x20\x20\x20\x20PRIMAR'+'Y\x20KEY\x20(nam'+_0x4a58cd(0x243)+_0x4a58cd(0x278)+'\x20\x20'),await adapter[_0x4a58cd(0x28a)](_0x4a58cd(0x14c)+_0x4a58cd(0x136)+_0x4a58cd(0x2c4)+_0x4a58cd(0x27f)+_0x4a58cd(0x213)+_0x4a58cd(0x20b)+_0x4a58cd(0x23c)+_0x4a58cd(0x16a)+_0x4a58cd(0x1c5)+_0x4a58cd(0x22a)+_0x4a58cd(0x150)+_0x4a58cd(0x143)+_0x4a58cd(0x277)),await adapter[_0x4a58cd(0x28a)](_0x4a58cd(0x14c)+_0x4a58cd(0x136)+_0x4a58cd(0x2c4)+_0x4a58cd(0x207)+_0x4a58cd(0x25c)+_0x4a58cd(0x1bf)+'ser_key\x20TE'+_0x4a58cd(0x2ab)+_0x4a58cd(0x2bb)+_0x4a58cd(0x19b)+_0x4a58cd(0x19d)+_0x4a58cd(0x2ad)+_0x4a58cd(0x29c)),await adapter[_0x4a58cd(0x28a)](_0x4a58cd(0x14c)+_0x4a58cd(0x136)+_0x4a58cd(0x2c4)+'S\x20active_s'+_0x4a58cd(0x289)+_0x4a58cd(0x279)+_0x4a58cd(0x145)+'Y\x20KEY,\x0a\x20\x20\x20'+'\x20\x20\x20chat_ji'+_0x4a58cd(0x2a9)+_0x4a58cd(0x264)+_0x4a58cd(0x142)+'d\x20TEXT,\x0a\x20\x20'+'\x20\x20\x20\x20timefr'+_0x4a58cd(0x1b1)+_0x4a58cd(0x146)+'\x20\x20\x20\x20\x20bucke'+_0x4a58cd(0x29e)+'\x20NOT\x20NULL,'+_0x4a58cd(0x1bc)+_0x4a58cd(0x238)+_0x4a58cd(0x294)+_0x4a58cd(0x203)+'\x20\x20\x20\x20\x20\x20disp'+_0x4a58cd(0x244)+_0x4a58cd(0x219)+_0x4a58cd(0x288)+_0x4a58cd(0x19e)+_0x4a58cd(0x236)+'\x20'),await adapter[_0x4a58cd(0x28a)](_0x4a58cd(0x1d4)+_0x4a58cd(0x2cc)+_0x4a58cd(0x1e5)+_0x4a58cd(0x195)+_0x4a58cd(0x1cb)+'_unique\x20ON'+_0x4a58cd(0x1d3)+_0x4a58cd(0x179)+_0x4a58cd(0x24b)+_0x4a58cd(0x249)+_0x4a58cd(0x193));}async function flushQueue(){const _0x8d7088=_0x54c5cf;if(isFlushing){if(Date[_0x8d7088(0x23f)]()-lastFlushTime>0xa7e+-0x10aa+0x2d3c)warn(_0x8d7088(0x15f)+_0x8d7088(0x227)+_0x8d7088(0x1a9)+'cing\x20reset'+_0x8d7088(0x2cf)),isFlushing=![];else return;}if(!dbReady||writeQueue[_0x8d7088(0x2c3)]===0x1264*-0x1+0x1e9e+-0xa*0x139)return;const _0x47e457=writeQueue[0x2*-0x309+0x1903+-0x12f1];if(_0x47e457&&_0x47e457[_0x8d7088(0x1f6)]>-0x3*-0x5d9+0x4*0x72b+-0x2e37*0x1&&Date[_0x8d7088(0x23f)]()-_0x47e457['timestamp']<-0x7b*0x9+0x37e*0x8+-0xbe5*0x1)return;if(!setStmt||!deleteStmt)try{if(!adapter)throw new Error(_0x8d7088(0x2a3)+_0x8d7088(0x27c)+_0x8d7088(0x283)+'e\x20statemen'+_0x8d7088(0x251));await prepareStatements();}catch(_0x20202a){if(isDbClosedError(_0x20202a)){warn(_0x8d7088(0x2c6)+_0x8d7088(0x1cd)+_0x8d7088(0x182)+_0x8d7088(0x258)+_0x8d7088(0x1f4)+_0x8d7088(0x184)),await scheduleReinitializeAfterError(_0x20202a);return;}else{error(_0x8d7088(0x1e0)+_0x8d7088(0x1c6)+_0x8d7088(0x2c9)+_0x8d7088(0x280)+_0x8d7088(0x245),_0x20202a);return;}}isFlushing=!![],lastFlushTime=Date[_0x8d7088(0x23f)]();const _0x39a102=getConfig(),_0x298ed6=_0x39a102[_0x8d7088(0x2c2)+_0x8d7088(0x205)]||-0x16d5+0x1*0x1e9e+-0x797,_0x5d8cae=writeQueue[_0x8d7088(0x18d)](-0x1a33+-0x601*0x6+0x1*0x3e39,_0x298ed6),_0x26aaca=_0x5d8cae[_0x8d7088(0x25b)]((_0x1df660,_0x2123cc)=>_0x1df660+(_0x2123cc[_0x8d7088(0x201)]||-0x2e*-0xb2+0x1594+0x2*-0x1ac8),-0x20*0x6a+-0x217*-0x9+0x1*-0x58f);try{if(adapter&&typeof adapter[_0x8d7088(0x28a)]==='function')await adapter[_0x8d7088(0x28a)]('BEGIN\x20TRAN'+'SACTION;');for(const _0x2a5c3f of _0x5d8cae){try{switch(_0x2a5c3f[_0x8d7088(0x22c)]){case'set':if(!setStmt)throw new Error(_0x8d7088(0x1fb)+'ssing');await setStmt[_0x8d7088(0x161)](_0x2a5c3f[_0x8d7088(0x2b2)],_0x2a5c3f[_0x8d7088(0x1dc)]);break;case _0x8d7088(0x224):if(!deleteStmt)throw new Error(_0x8d7088(0x216)+_0x8d7088(0x1fe));await deleteStmt[_0x8d7088(0x161)](_0x2a5c3f[_0x8d7088(0x2b2)]);break;default:warn(_0x8d7088(0x134)+_0x8d7088(0x1ee)+'ype\x20during'+_0x8d7088(0x158)+_0x2a5c3f[_0x8d7088(0x22c)]);}}catch(_0x4e95b3){if(isDbClosedError(_0x4e95b3))throw _0x4e95b3;error(_0x8d7088(0x1e0)+'process\x20DB'+_0x8d7088(0x2c0)+_0x8d7088(0x21c)+_0x8d7088(0x223)+'saction\x20ro'+'llback:\x20'+JSON[_0x8d7088(0x28e)](_0x2a5c3f)+(',\x20itemErr:'+'\x20')+(_0x4e95b3?.[_0x8d7088(0x1a5)]||_0x4e95b3));throw _0x4e95b3;}}if(adapter&&typeof adapter[_0x8d7088(0x28a)]==='function')await adapter[_0x8d7088(0x28a)](_0x8d7088(0x151));if(!usingNative)try{await persistDatabaseToFile();}catch(_0x12129c){error('Failed\x20to\x20'+_0x8d7088(0x1ea)+_0x8d7088(0x252)+_0x8d7088(0x29d),_0x12129c);}queueBytes=Math[_0x8d7088(0x2a2)](0x223*-0x5+0x1425+-0x976,queueBytes-_0x26aaca),reinitBackoffMs=0xa02+0x2164*0x1+-0x277e;}catch(_0x29c76f){if(isDbClosedError(_0x29c76f)){error(_0x8d7088(0x175)+'\x20to\x20be\x20clo'+_0x8d7088(0x2c5)+_0x8d7088(0x24f)+_0x8d7088(0x137)+_0x8d7088(0x262)+_0x8d7088(0x229),_0x29c76f);try{if(adapter&&typeof adapter['exec']===_0x8d7088(0x16f))await adapter['exec'](_0x8d7088(0x2bc));}catch(_0x38cd10){}writeQueue['unshift'](..._0x5d8cae),await scheduleReinitializeAfterError(_0x29c76f);}else{error('DB\x20flush\x20t'+_0x8d7088(0x250)+'\x20failed,\x20r'+'olling\x20bac'+_0x8d7088(0x1d1)+'ng\x20for\x20ret'+_0x8d7088(0x19a),_0x29c76f);try{if(adapter&&typeof adapter['exec']===_0x8d7088(0x16f))await adapter['exec'](_0x8d7088(0x2bc));}catch(_0x181d89){error(_0x8d7088(0x21f)+_0x8d7088(0x212),_0x181d89);}const _0x3e16ae=Date['now'](),_0x2babfd=[];for(const _0x30cb95 of _0x5d8cae){_0x30cb95[_0x8d7088(0x1f6)]=(_0x30cb95['retries']||0x98+-0xbf6*-0x3+-0x142*0x1d)+(-0x1657+-0x1c8a+0x32e2),_0x30cb95['timestamp']=_0x3e16ae;if(_0x30cb95[_0x8d7088(0x1f6)]<0xd*-0x2d2+0x17e4+0xcc8)_0x2babfd[_0x8d7088(0x15a)](_0x30cb95);else error(_0x8d7088(0x257)+_0x8d7088(0x159)+_0x8d7088(0x2d6)+_0x8d7088(0x1ae)+_0x8d7088(0x2a6)+'s.\x20Item:\x20'+JSON[_0x8d7088(0x28e)](_0x30cb95));}if(_0x2babfd['length']>-0xc09*-0x2+-0x20dc*-0x1+-0x2b6*0x15)writeQueue[_0x8d7088(0x1c4)](..._0x2babfd);queueBytes=Math['max'](0x2264+0x1a97+-0x3cfb,queueBytes-_0x26aaca+_0x2babfd[_0x8d7088(0x25b)]((_0x5bd9ce,_0x320315)=>_0x5bd9ce+(_0x320315[_0x8d7088(0x201)]||0xb42+0x20*-0xc1+0xcde),-0x3*0xc7+0xcb*0x2b+-0x1fc4));}}finally{isFlushing=![];}}async function persistDatabaseToFile(){const _0x84dfcc=_0x54c5cf,_0x1f1577=getConfig(),_0x2ab137=_0x1f1577[_0x84dfcc(0x2da)+'OT']||process[_0x84dfcc(0x1ff)](),_0x4ccbf6=_0x1ad352[_0x84dfcc(0x198)](_0x2ab137,_0x1f1577[_0x84dfcc(0x1b4)]||_0x84dfcc(0x154)),_0x1a92c8=_0x1f1577[_0x84dfcc(0x140)]||_0x84dfcc(0x1e6)+_0x84dfcc(0x241),_0x591ff7=_0x1ad352[_0x84dfcc(0x255)](_0x4ccbf6,_0x1a92c8);if(usingNative)return;if(!adapter){warn('persistDat'+_0x84dfcc(0x1c1)+_0x84dfcc(0x282)+'\x20missing,\x20'+_0x84dfcc(0x2ca)+_0x84dfcc(0x163));return;}try{const _0x9a1d97=adapter[_0x84dfcc(0x18f)]();if(!_0x9a1d97)return;const _0x49150d=_0x591ff7+_0x84dfcc(0x1d6);await _0x543e7b[_0x84dfcc(0x1fd)](_0x49150d,Buffer['from'](_0x9a1d97)),await _0x543e7b[_0x84dfcc(0x240)](_0x49150d,_0x591ff7,{'overwrite':!![]}),info('Database\x20p'+_0x84dfcc(0x1be)+'o\x20'+_0x591ff7);}catch(_0xa251c0){if(isDbClosedError(_0xa251c0)){warn(_0x84dfcc(0x271)+_0x84dfcc(0x1c1)+'e\x20failed\x20d'+'ue\x20to\x20clos'+_0x84dfcc(0x178)+_0x84dfcc(0x17e)+_0x84dfcc(0x2b1)),await scheduleReinitializeAfterError(_0xa251c0);return;}throw _0xa251c0;}}export async function get(_0x213b5a){const _0x5b8ef8=_0x54c5cf;try{if(cache&&cache[_0x5b8ef8(0x1e7)](_0x213b5a))return cache[_0x5b8ef8(0x189)](_0x213b5a);}catch(_0x53a976){}if(!dbReady||!adapter)return warn(_0x5b8ef8(0x2b8)+'dy\x20for\x20get'+'\x20operation'+'.'),undefined;try{const _0x190757=await adapter[_0x5b8ef8(0x189)](_0x5b8ef8(0x291)+_0x5b8ef8(0x26b)+_0x5b8ef8(0x1dd)+_0x5b8ef8(0x191)+'key\x20=\x20?',_0x213b5a);if(_0x190757&&_0x190757[_0x5b8ef8(0x1dc)]!=null)try{const _0x41ef77=JSON[_0x5b8ef8(0x25a)](_0x190757[_0x5b8ef8(0x1dc)]);try{cache[_0x5b8ef8(0x1f0)](_0x213b5a,_0x41ef77,_0x190757['value']);}catch(_0x4f7d97){}return _0x41ef77;}catch(_0x133dbc){return error(_0x5b8ef8(0x1e0)+'parse\x20stor'+'ed\x20JSON\x20fo'+'r\x20key\x20\x22'+_0x213b5a+_0x5b8ef8(0x2c7)+(_0x133dbc?.[_0x5b8ef8(0x1a5)]||_0x133dbc)),undefined;}}catch(_0x4d7fe3){isDbClosedError(_0x4d7fe3)?(warn(_0x5b8ef8(0x208)+_0x5b8ef8(0x162)+_0x5b8ef8(0x263)+_0x5b8ef8(0x1ca)+_0x5b8ef8(0x27a)+_0x5b8ef8(0x25d)+_0x213b5a),await scheduleReinitializeAfterError(_0x4d7fe3)):error(_0x5b8ef8(0x1e0)+_0x5b8ef8(0x14a)+_0x213b5a+('\x22\x20from\x20DB:'+'\x20')+(_0x4d7fe3?.[_0x5b8ef8(0x1a5)]||_0x4d7fe3),_0x4d7fe3);}return undefined;}export function set(_0x434a35,_0x31e9e9){const _0x11a11a=_0x54c5cf;if(_0x31e9e9===undefined){del(_0x434a35);return;}let _0xa05de0;try{_0xa05de0=JSON[_0x11a11a(0x28e)](_0x31e9e9);}catch(_0x3f421e){error('Value\x20for\x20'+_0x11a11a(0x254)+_0x434a35+(_0x11a11a(0x1ce)+_0x11a11a(0x285)+_0x11a11a(0x26e)+'g\x20persist.'),_0x3f421e);return;}try{cache['set'](_0x434a35,_0x31e9e9,_0xa05de0);}catch(_0x327443){}const _0x308091={'type':_0x11a11a(0x1f0),'key':_0x434a35,'value':_0xa05de0,'retries':0x0,'timestamp':Date[_0x11a11a(0x23f)]()};_0x308091[_0x11a11a(0x201)]=estimateQueueItemSize(_0x308091),queueBytes+=_0x308091[_0x11a11a(0x201)],writeQueue[_0x11a11a(0x15a)](_0x308091),enforceMemoryLimit(),writeQueue[_0x11a11a(0x2c3)]>=getConfig()[_0x11a11a(0x2c2)+_0x11a11a(0x205)]&&flushQueue()['catch'](_0xeb1c71=>{const _0x21b348=_0x11a11a;error(_0x21b348(0x20c)+_0x21b348(0x17d)+_0x21b348(0x2ac)+_0x21b348(0x1d9)+_0x21b348(0x26c),_0xeb1c71);});}function _0x88ca(_0x20c092,_0x3a1c95){_0x20c092=_0x20c092-(-0x9a*0x3+0x1df1+-0x1af2);const _0x55da53=_0x31bc();let _0x39b9e4=_0x55da53[_0x20c092];return _0x39b9e4;}export function del(_0xe53b6b){const _0x2d6b95=_0x54c5cf;try{cache[_0x2d6b95(0x224)](_0xe53b6b);}catch(_0x2199f8){}const _0x4f710e={'type':_0x2d6b95(0x224),'key':_0xe53b6b,'retries':0x0,'timestamp':Date[_0x2d6b95(0x23f)]()};_0x4f710e['size']=estimateQueueItemSize(_0x4f710e),queueBytes+=_0x4f710e[_0x2d6b95(0x201)],writeQueue['push'](_0x4f710e),enforceMemoryLimit(),writeQueue[_0x2d6b95(0x2c3)]>=getConfig()[_0x2d6b95(0x2c2)+_0x2d6b95(0x205)]&&flushQueue()[_0x2d6b95(0x2d0)](_0x431991=>{const _0x3abf56=_0x2d6b95;error(_0x3abf56(0x20c)+_0x3abf56(0x17d)+_0x3abf56(0x2ac)+_0x3abf56(0x23b)+_0x3abf56(0x26c),_0x431991);});}function _0x31bc(){const _0x4815e7=['ache\x20for\x20o','\x20\x20\x20\x20);\x0a\x20\x20','d)\x0a\x20\x20\x20\x20);\x0a','\x20\x20\x20id\x20INTE','uling\x20rein','lizing\x20del','\x20available','oup_id\x20TEX','ue_store\x20(','S\x20group_de','efore\x20flus','exit','e:\x20adapter','\x20to\x20prepar','REPLACE\x20IN','erializabl',')\x20VALUES\x20(','l):','\x20last_upda','tats\x20(\x0a\x20\x20\x20','exec','ax\x20','h\x20complete','g\x20(native)','stringify','ping\x20detec','ping\x20error','SELECT\x20val','eign_keys\x20','closed\x20cle','\x20INTEGER\x20D','object','ile\x20execut','omatically','r\x20in\x20prepa','essfully.','versized\x20i','M\x20key_valu',';\x0a\x20\x20','r\x20commit:','t_key\x20TEXT','DELETE\x20FRO','trim','339304HVjMgL','max','No\x20adapter','once','_moveToTai','le\x20failure','default',',\x0a\x20\x20\x20\x20\x20\x20gr','d\x20TEXT\x20NOT','dist','XT\x20PRIMARY','eue\x20trigge','NULL\x0a\x20\x20\x20\x20)','cuting\x20(sq','t\x20availabl','ng\x20final\x20f','init.','key','byteLength','bytes','ng\x20final\x20d','SQL.js\x20fal','or.','DB\x20not\x20rea','SQLITE','r\x20(policy=','\x20KEY,\x0a\x20\x20\x20\x20','ROLLBACK;','ng\x20schedul','min','Ignored\x20UN','\x20item,\x20wil','SQL.js\x20fro','DB_BATCH_S','length','\x20NOT\x20EXIST','sed\x20during','DB\x20closed\x20','\x22:\x20','\x20statement','atements\x20b','skipping\x20p','stat','QUE\x20INDEX\x20','ignore)\x20in','\x20after\x20err','\x20of\x20lock.','catch','l.js):\x20','Y\x20KEY,\x20mod','e\x20for\x20prep','ialization','file\x20into\x20','scarded\x20af','2503870csFXxT','ted\x20at\x20','close','PROJECT_RO','=\x20ON;','prepareSta','s()','Unknown\x20qu','TO\x20key_val','E\x20TABLE\x20IF','ll\x20attempt','\x20prepared\x20','rnal_mode\x20','losed.','utf8','T\x20NOT\x20NULL','cuting\x20(na','tail','PRAGMA\x20bus','DB_NAME','yMigration','\x20\x20\x20user_ji','AULT\x20\x27[]\x27\x0a','\x20driver.','GER\x20PRIMAR','OT\x20NULL,\x0a\x20','ons\x20(\x0a\x20\x20\x20\x20','ite\x20init\x20f','OLICY','get\x20key\x20\x22','DB_UNIQUE_','\x0a\x20\x20\x20\x20CREAT','hat_id\x20TEX','leted\x20succ',',\x20Key:\x20','T\x20NULL\x20DEF','COMMIT;','getAsObjec','g\x20INSERT\x20O','.db','IQUE\x20const','code','for\x20run()\x20','\x20flush:\x20','DB\x20item\x20di','push','_removeNod','lback\x20fail','level\x20TEXT','replace','⚠️\x20DB\x20Flush','prepare\x20DB','run','ed\x20because','ersist.','Database\x20b','pts:','ile\x20runnin','3TFeLhc','ified','finally','RIMARY\x20KEY','all','ent\x20(polic','Using\x20SQL.','adapter\x20no','function','NTERVAL','includes','\x20DEFAULT\x20\x27','head',',\x20message\x20','DB\x20appears','slice','Write\x20queu','ed\x20DB.\x20Sch','ats(chat_j','=\x20WAL;','Database\x20s','se\x20DB\x20is\x20c','ng\x20flushQu','eduling\x20re','=\x2010000;','e\x20memory\x20p','Database\x20c','aring\x20stat','ror:\x20','einit.','11MMLzNi','r\x20during\x20a','\x20NULL\x20DEFA','free','get','Loaded\x20DB\x20','554977kUIoKb','90ebSLBO','splice','\x20NORMAL;','export','eeded\x20usin','ore\x20WHERE\x20','it.','t_key);','PRAGMA\x20jou','STS\x20idx_ac','ed:','file\x20durin','resolve','maxBytes','ry.','\x20\x20group_id','iled\x20becau','\x20TEXT\x20NOT\x20','ted\x20INTEGE','ensureDir','54ppTtvU','_addToTail','Native\x20sql','chronous\x20=','INSERT\x20OR\x20','message','ing\x20(sql.j','adapter.','ackup\x20fail','\x20>10s!\x20For','native\x20sql','\x22\x20(','next','areStateme','ter\x20multip','L\x20error\x20(t','B\x20statemen','ame\x20TEXT\x20N','cy=ignore)','SELECT\x201\x20a','DB_PATH','ve\x20sqlite3','ailed,\x20wil','onnection\x20','s):\x20','atabase\x20cl','\x20while\x20exe','Prepared\x20D','\x0a\x20\x20\x20\x20\x20\x20mes','map','ersisted\x20t','\x20(\x0a\x20\x20\x20\x20\x20\x20u','readFile','abaseToFil','\x20bytes\x20>\x20m','Error\x20fina','unshift',',\x0a\x20\x20\x20\x20\x20\x20na','prepare\x20st','TEXT);','ms\x20due\x20to\x20','S\x20connecti','sed.\x20Sched','tive_stats','Final\x20flus','while\x20prep','\x22\x20is\x20not\x20s','ule\x20TEXT,\x20','Type:\x20','k.\x20Prepari','nitializat','\x20active_st','CREATE\x20UNI','prev','.tmp','est\x20item.\x20','[]\x27,\x0a\x20\x20\x20\x20\x20','red\x20by\x20set','getRowsMod','\x20\x20name\x20TEX','value','y_value_st','y_timeout\x20','tem\x20\x22','Failed\x20to\x20','extname','ignore)\x20wh','l\x20attempt\x20','SELECT\x201;','IF\x20NOT\x20EXI','database.s','has','DB_FLUSH_I','ressure:\x20D','persist\x20DB','own:','r\x20during\x20g','able\x20alrea','eue\x20item\x20t','node_modul','set','test','isting\x20DB\x20','81595efivwp','heduling\x20r','eue:','retries',').\x20Backing','ted\x20closed','raint\x20erro','249416sXUzfH','setStmt\x20mi','basename','writeFile','\x20missing','cwd','shing\x20queu','size','ocess\x20init','EFAULT\x200,\x0a','step','IZE','\x20present)','S\x20user_act','get()\x20fail','toLowerCas','reset','\x20\x20\x20\x20\x20group','Error\x20duri','hutdown\x20pr','_PATH','Created\x20ne','ring\x20shutd','236628NjmnQv','ailed:','faults\x20(\x0a\x20','ion\x20proces','dy\x20exists)','deleteStmt','1049262IUhKtv','DB_CACHE_M','EXT,\x0a\x20\x20\x20\x20\x20','tive):\x20','\x20DB\x20reinit','l\x20be\x20handl','error\x20duri','estimateSi','Rollback\x20f','open','Ignored\x20SQ','e...','ed\x20by\x20tran','delete','DB\x20health\x20','s\x20ok','\x20stuck\x20for','Scheduling','ization.','me\x20TEXT\x20NO','ignore','type','red\x20statem','error:\x20','nts()','.bak','\x20KEY,\x20valu','y\x20SQL.js\x20D','Automatic\x20','Unhandled\x20','string','R\x0a\x20\x20\x20\x20);\x0a\x20','finalize','sage_count','toUpperCas','key,\x20value','red\x20by\x20del','_id\x20TEXT\x20P','CONFLICT_P','dirname','now','move','qlite','\x20DB;\x20sched','e,\x20group_i','lay_name\x20T','hQueue:','e\x20for\x20appl','copy','SIGTERM','ame,\x20bucke','pathExists','id,\x20timefr','B\x20(no\x20file','Retry\x20succ','alized\x20aut','\x20flush.\x20Wi','ransaction','ts.','\x20file\x20afte','prepare','key\x20\x22','join','(native).','CRITICAL:\x20','ements.\x20Sc','R\x20REPLACE\x20','parse','reduce','ive_groups','it.\x20Key:\x20','Using\x20nati','N/A','js\x20(WASM)\x20','DB\x20init\x20er','\x20reinitial','\x20DB\x20is\x20clo','\x20NULL,\x0a\x20\x20\x20','PRAGMA\x20for','anly.','ropped\x20old','serialized','ed\x20stateme','(sql.js).','ue\x20FROM\x20ke','():','g\x20shutdown','e;\x20skippin','Database','(native):\x20','persistDat','bind','eteStmt\x20du','for\x20prepar','y=ignore):'];_0x31bc=function(){return _0x4815e7;};return _0x31bc();}export async function shutdownDatabase(){const _0x2cc594=_0x54c5cf;info(_0x2cc594(0x17b)+_0x2cc594(0x20d)+_0x2cc594(0x202)+'iated.\x20Flu'+_0x2cc594(0x200)+_0x2cc594(0x222)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);try{await flushQueue(),await flushQueue(),info(_0x2cc594(0x1cc)+_0x2cc594(0x28c)+'d.');}catch(_0x6b31e0){error('Error\x20duri'+_0x2cc594(0x2b0)+'lush\x20attem'+_0x2cc594(0x165),_0x6b31e0);}if(setStmt){try{await setStmt[_0x2cc594(0x237)]();}catch(_0x1ee3ac){warn('Error\x20fina'+'lizing\x20set'+'Stmt\x20durin'+_0x2cc594(0x26d)+':',_0x1ee3ac);}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x2cc594(0x237)]();}catch(_0x3487c8){warn(_0x2cc594(0x1c3)+_0x2cc594(0x27b)+_0x2cc594(0x273)+_0x2cc594(0x210)+_0x2cc594(0x1eb),_0x3487c8);}deleteStmt=null;}try{await persistDatabaseToFile();}catch(_0x3a0588){error('Error\x20pers'+_0x2cc594(0x1f2)+_0x2cc594(0x197)+_0x2cc594(0x26d)+':',_0x3a0588);}if(adapter){try{await adapter[_0x2cc594(0x2d9)](),info(_0x2cc594(0x181)+_0x2cc594(0x1b7)+_0x2cc594(0x293)+_0x2cc594(0x266));}catch(_0x2fcf81){error(_0x2cc594(0x20c)+_0x2cc594(0x2b5)+_0x2cc594(0x1b9)+'ose:',_0x2fcf81);}adapter=null,db=null;}info(_0x2cc594(0x17b)+'hutdown\x20pr'+'ocess\x20comp'+_0x2cc594(0x14e)+_0x2cc594(0x299));}async function backupDB(_0x305a56){const _0x1411b1=_0x54c5cf;try{if(!await _0x543e7b[_0x1411b1(0x24a)](_0x305a56))return;const _0x3e7ea5=_0x1ad352[_0x1411b1(0x23e)](_0x305a56),_0x5bcd9c=_0x1ad352[_0x1411b1(0x1fc)](_0x305a56,_0x1ad352[_0x1411b1(0x1e1)](_0x305a56)),_0x146c09=_0x1ad352[_0x1411b1(0x255)](_0x3e7ea5,_0x5bcd9c+_0x1411b1(0x230)),_0x5befdc=await _0x543e7b[_0x1411b1(0x24a)](_0x146c09)?await _0x543e7b[_0x1411b1(0x2cb)](_0x146c09):null,_0x389e8b=_0x5befdc?Date['now']()-_0x5befdc['mtimeMs']:Infinity;_0x389e8b>(0x1*-0x221b+0xa17+0x2*0xc0e)*(0x1b37+-0xf49+0x3e6*-0x3)*(0x1a22+-0x1*-0xdfd+-0x27e3*0x1)*(-0x68b+0x9*-0x19f+0x5*0x502)&&(await _0x543e7b[_0x1411b1(0x247)](_0x305a56,_0x146c09,{'overwrite':!![]}),info(_0x1411b1(0x164)+'ackup\x20crea'+_0x1411b1(0x2d8)+_0x146c09));}catch(_0x1bb723){error(_0x1411b1(0x164)+_0x1411b1(0x1a8)+'ed:\x20'+(_0x1bb723?.[_0x1411b1(0x1a5)]||_0x1bb723),_0x1bb723);}}process[_0x54c5cf(0x2a4)]('SIGINT',()=>{const _0x397d68=_0x54c5cf;shutdownDatabase()[_0x397d68(0x169)](()=>process[_0x397d68(0x281)](-0x17*-0x2+-0x16e4+-0x16b6*-0x1));}),process[_0x54c5cf(0x2a4)](_0x54c5cf(0x248),()=>{const _0xe1c16c=_0x54c5cf;shutdownDatabase()[_0xe1c16c(0x169)](()=>process[_0xe1c16c(0x281)](0xe9d+-0x1e44+0xfa7));});export{adapter as _adapter};