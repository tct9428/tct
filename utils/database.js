const _0xf51dba=_0x1567;(function(_0x527e0e,_0x2c1ca2){const _0x32912f=_0x1567,_0x2392da=_0x527e0e();while(!![]){try{const _0x5862ff=parseInt(_0x32912f(0x16e))/(0x4*-0x890+0x118f+0x10b2)*(parseInt(_0x32912f(0x209))/(0x1786+0x1fbb*-0x1+0x3*0x2bd))+-parseInt(_0x32912f(0x1ce))/(-0x1*-0x35+-0x1785+0x1753)+-parseInt(_0x32912f(0x25c))/(-0x836*0x3+0x1*-0xffb+0xd8b*0x3)+-parseInt(_0x32912f(0x2d5))/(-0x15b2+-0x1a*-0x3c+0x81*0x1f)+parseInt(_0x32912f(0x1a1))/(0x83*-0x46+-0x1030+0x3408)*(parseInt(_0x32912f(0x217))/(-0x1*0x7c7+-0x17b3+0x1*0x1f81))+-parseInt(_0x32912f(0x1bb))/(0x8*0x162+-0xc*-0x28a+-0x2980)+-parseInt(_0x32912f(0x14a))/(0xce8+0x9f6+-0x16d5)*(-parseInt(_0x32912f(0x181))/(0x4c1*-0x1+-0x84b*-0x2+-0xbcb*0x1));if(_0x5862ff===_0x2c1ca2)break;else _0x2392da['push'](_0x2392da['shift']());}catch(_0x4add71){_0x2392da['push'](_0x2392da['shift']());}}}(_0x20b2,-0x17b09+-0xf3fc+0x193*0x2ff));import _0x3dddb5 from'fs-extra';import _0x1657dd from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;let usingNative=![],setStmt=null,deleteStmt=null,dbReady=![],writeQueue=[],queueBytes=0x1*0x419+-0x40+-0x3d9,maxTotalBytes=0x2*-0x98f+0x27*-0xf0+-0x1*-0x37ae,isFlushing=![],flushTimer=null,cache=null;function estimateQueueItemSize(_0x493e93){const _0x54264d=_0x1567,_0x22423a=0x1*-0x1c35+-0x320+-0x1*-0x1fa5;switch(_0x493e93[_0x54264d(0x156)]){case'set':return Buffer[_0x54264d(0x18a)](_0x493e93[_0x54264d(0x253)],'utf8')+Buffer['byteLength'](_0x493e93[_0x54264d(0x22a)],_0x54264d(0x28b))+_0x22423a;case _0x54264d(0x1d7):return Buffer['byteLength'](_0x493e93[_0x54264d(0x253)],_0x54264d(0x28b))+_0x22423a;default:return 0x41c*0x1+0x122e+0x2*-0xae5;}}class MemoryCache{constructor(_0x5742a5){const _0x1dcd07=_0x1567;this['maxBytes']=_0x5742a5,this[_0x1dcd07(0x297)]=-0x20a8+0x135*0x19+0x1*0x27b,this[_0x1dcd07(0x21a)]=new Map(),this[_0x1dcd07(0x1eb)]={'prev':null,'next':null},this[_0x1dcd07(0x15a)]={'prev':null,'next':null},this[_0x1dcd07(0x1eb)][_0x1dcd07(0x191)]=this[_0x1dcd07(0x15a)],this[_0x1dcd07(0x15a)][_0x1dcd07(0x22c)]=this['head'];}static[_0xf51dba(0x1d5)+'ze'](_0x4d348c,_0x4bc28b){const _0x2003e9=_0xf51dba,_0x3095ec=Buffer[_0x2003e9(0x18a)](String(_0x4d348c),_0x2003e9(0x28b)),_0x29f68b=Buffer[_0x2003e9(0x18a)](_0x4bc28b??'','utf8');return _0x3095ec+_0x29f68b+(-0x1b3b*0x1+0x1b75+-0x1*-0x6);}[_0xf51dba(0x25b)+'e'](_0x47930b){const _0x5c54c4=_0xf51dba;_0x47930b[_0x5c54c4(0x22c)]['next']=_0x47930b[_0x5c54c4(0x191)],_0x47930b['next'][_0x5c54c4(0x22c)]=_0x47930b[_0x5c54c4(0x22c)];}[_0xf51dba(0x2c7)](_0x4ccec3){const _0x3bb761=_0xf51dba;_0x4ccec3[_0x3bb761(0x22c)]=this['tail']['prev'],_0x4ccec3[_0x3bb761(0x191)]=this[_0x3bb761(0x15a)],this['tail']['prev'][_0x3bb761(0x191)]=_0x4ccec3,this[_0x3bb761(0x15a)][_0x3bb761(0x22c)]=_0x4ccec3;}[_0xf51dba(0x2b3)+'l'](_0x593066){const _0x232145=_0xf51dba;this['_removeNod'+'e'](_0x593066),this[_0x232145(0x2c7)](_0x593066);}[_0xf51dba(0x291)](_0x4e642c){const _0x465ec7=_0xf51dba;return this[_0x465ec7(0x21a)][_0x465ec7(0x291)](_0x4e642c);}[_0xf51dba(0x1a3)](_0x173e23){const _0x6e9924=_0xf51dba,_0xecb559=this[_0x6e9924(0x21a)][_0x6e9924(0x1a3)](_0x173e23);if(!_0xecb559)return undefined;return this[_0x6e9924(0x2b3)+'l'](_0xecb559),_0xecb559[_0x6e9924(0x22a)];}['set'](_0x424c05,_0x7cd63a,_0x183a2c){const _0x429d06=_0xf51dba,_0xf76829=this[_0x429d06(0x21a)]['get'](_0x424c05),_0x341f40=MemoryCache['estimateSi'+'ze'](_0x424c05,_0x183a2c);if(_0x341f40>this[_0x429d06(0x27f)]){warn(_0x429d06(0x20f)+_0x429d06(0x26b)+'versized\x20i'+_0x429d06(0x162)+_0x424c05+_0x429d06(0x246)+_0x341f40+(_0x429d06(0x286)+'ax\x20')+this[_0x429d06(0x27f)]+')');if(_0xf76829)this['delete'](_0x424c05);return;}if(_0xf76829)this[_0x429d06(0x297)]-=_0xf76829['size'],_0xf76829[_0x429d06(0x22a)]=_0x7cd63a,_0xf76829[_0x429d06(0x282)]=_0x183a2c,_0xf76829[_0x429d06(0x1bd)]=_0x341f40,this[_0x429d06(0x297)]+=_0x341f40,this[_0x429d06(0x2b3)+'l'](_0xf76829);else{const _0xc9828={'key':_0x424c05,'value':_0x7cd63a,'serialized':_0x183a2c,'size':_0x341f40,'prev':null,'next':null};this[_0x429d06(0x21a)][_0x429d06(0x23f)](_0x424c05,_0xc9828),this[_0x429d06(0x2c7)](_0xc9828),this[_0x429d06(0x297)]+=_0x341f40;}while(this[_0x429d06(0x297)]>this[_0x429d06(0x27f)]){const _0x2b9c66=this['head'][_0x429d06(0x191)];if(_0x2b9c66===this[_0x429d06(0x15a)])break;this['delete'](_0x2b9c66['key']);}}[_0xf51dba(0x1d7)](_0x20957c){const _0x3a4814=_0xf51dba,_0x3f2371=this['map']['get'](_0x20957c);if(!_0x3f2371)return;this[_0x3a4814(0x25b)+'e'](_0x3f2371),this[_0x3a4814(0x21a)][_0x3a4814(0x1d7)](_0x20957c),this[_0x3a4814(0x297)]-=_0x3f2371['size'];}}function enforceMemoryLimit(){const _0x5700ef=_0xf51dba;while(cache&&cache[_0x5700ef(0x297)]+queueBytes>maxTotalBytes&&writeQueue[_0x5700ef(0x1e8)]>0x1*0x11a+-0x1c3c+0x1b22){const _0x3f5f83=writeQueue[_0x5700ef(0x18d)]();if(_0x3f5f83[_0x5700ef(0x1bd)])queueBytes-=_0x3f5f83[_0x5700ef(0x1bd)];warn(_0x5700ef(0x2a7)+_0x5700ef(0x23d)+_0x5700ef(0x2c2)+'ropped\x20old'+_0x5700ef(0x1ba)+_0x5700ef(0x186)+_0x3f5f83[_0x5700ef(0x156)]+',\x20Key:\x20'+(_0x3f5f83[_0x5700ef(0x253)]||_0x5700ef(0x259)));}}function normalizeBindParams(_0x513849){const _0x5bc0a2=_0xf51dba;if(!_0x513849||_0x513849[_0x5bc0a2(0x1e8)]===0x748*-0x4+0x5b*-0x1d+-0x1*-0x276f)return undefined;if(_0x513849[_0x5bc0a2(0x1e8)]===-0x1130+0x15f8+-0x4c7&&Array[_0x5bc0a2(0x2ae)](_0x513849[-0xb3e*0x1+0x33a*0x1+0x804]))return _0x513849[-0xb21+0x7c*0x3b+-0x3*0x5d1];if(_0x513849[_0x5bc0a2(0x1e8)]===-0x169*-0x13+-0xb2b*0x3+0x6b7&&typeof _0x513849[-0x12b4+-0x1cfc+0x2fb0]==='object'&&_0x513849[-0x108c+0x89e+-0xe*-0x91]!==null&&!Array[_0x5bc0a2(0x2ae)](_0x513849[-0x83*-0xf+-0x24b+0x6a*-0xd]))return _0x513849[0x140f+-0x1089+-0x386];return _0x513849;}function isTableAlreadyExistsError(_0x292d8b){const _0x40ff2a=_0xf51dba;try{const _0x4ec758=_0x292d8b&&(_0x292d8b[_0x40ff2a(0x1bc)]||String(_0x292d8b))||'';return/table .* already exists/i['test'](_0x4ec758)||/\balready exists\b/i[_0x40ff2a(0x266)](_0x4ec758);}catch(_0x59b9f7){return![];}}function isUniqueConstraintError(_0x191dec){const _0x4801d1=_0xf51dba;try{const _0x55b98a=_0x191dec&&(_0x191dec[_0x4801d1(0x1bc)]||String(_0x191dec))||'';return/UNIQUE constraint failed/i['test'](_0x55b98a)||/UNIQUE constraint/i[_0x4801d1(0x266)](_0x55b98a);}catch(_0x15a76f){return![];}}function looksLikeSimpleInsert(_0x534026){const _0x3c4cf4=_0xf51dba;if(!_0x534026||typeof _0x534026!==_0x3c4cf4(0x142))return![];return/^\s*INSERT\s+INTO\s+/i[_0x3c4cf4(0x266)](_0x534026)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x3c4cf4(0x266)](_0x534026);}function getUniquePolicy(){const _0x3533ac=_0xf51dba;try{const _0x3dd4cd=getConfig(),_0x5dee6f=_0x3dd4cd&&_0x3dd4cd['DB_UNIQUE_'+_0x3533ac(0x2b8)+'OLICY']||_0x3533ac(0x192);return String(_0x5dee6f)[_0x3533ac(0x298)+'e']()['trim']();}catch(_0x1b3d68){return _0x3533ac(0x192);}}let dbInitializingPromise=null,reinitBackoffMs=-0x2103+-0x1bf*0x11+-0x6a9*-0xa;const MAX_REINIT_BACKOFF_MS=(0x197*0x4+-0x1dd+-0x443)*(0x107*-0xb+0x1471+0xa*-0x86);function _0x20b2(){const _0x377f40=['finally','onnection\x20','DB\x20flush\x20t','lizing\x20set','process\x20DB','ive_groups','\x20NOT\x20EXIST','e;\x20skippin','ts.','\x20NOT\x20NULL,','length','uling\x20rein','le\x20failure','head','\x20to\x20prepar','olling\x20bac','or.','DB\x20init\x20er','ue_store\x20(','heduling\x20r','error:\x20','PRAGMA\x20jou','\x22:\x20','e...','\x20NORMAL;','timestamp','\x20KEY,\x0a\x20\x20\x20\x20','L\x20error\x20(t','TO\x20key_val','skipping\x20p','Error\x20fina','unshift','SIGTERM','iled\x20becau','SACTION;','file\x20into\x20','nts()','max','ng\x20for\x20ret','open','(native).','join','shing\x20queu','3026cpghBz','\x20in\x20','IQUE\x20const','?,\x20?)','exit','ror:\x20','Skipping\x20c','DB\x20not\x20rea','\x27,\x0a\x20\x20\x20\x20\x20\x20c','ted\x20at\x20','iated.\x20Flu',')\x20VALUES\x20(','adapter.','cuting\x20(na','98tijgsy','B\x20(no\x20file','nitializat','map','raint\x20erro','dist','\x20NULL\x20DEFA','SQL.js\x20fro','retries','s()','M\x20key_valu','ted\x20closed','chronous\x20=','ensureDir','\x20\x20\x20\x20\x20bucke','ng\x20schedul','rnal_mode\x20','E\x20TABLE\x20IF','SQL.js\x20fal','value','now','prev','T\x20NULL\x20DEF','ing\x20(sql.j','abaseToFil','Database\x20c','s.\x20Item:\x20','einit.','from','sed\x20during','dirname','\x20after\x20err','function','e\x20statemen','ite\x20init\x20f','g:\x20','RIMARY\x20KEY','ailed:','e\x20memory\x20p','DB\x20reiniti','set','ser_key\x20TE','atabase\x20cl','Scheduling','re\x20(key\x20TE','s\x20(ts\x20INTE','tements\x20fa','\x22\x20(','SELECT\x201;','closed\x20cle','_unique\x20ON','ed\x20stateme','Y\x20KEY\x20(nam','close','\x20\x20\x20\x20timefr','scarded\x20af','\x20\x20\x20\x20\x20group','file\x20durin','run','ed\x20JSON\x20fo','key','DB\x20appears','saction\x20ro','\x20DB;\x20sched','pts:','CREATE\x20TAB','N/A','Database\x20i','_removeNod','979104LNitLy','cwd','getRowsMod','Ignored\x20UN','\x20\x20\x20id\x20INTE','NULL\x0a\x20\x20\x20\x20)','\x20DEFAULT\x20\x27','eue\x20trigge','push','ed:\x20','test','IF\x20NOT\x20EXI','\x20active_st','sed.\x20Sched','\x20creator_i','ache\x20for\x20o','QUE\x20INDEX\x20','ll()\x20(poli','NTERVAL','nt\x20(native','hat_id\x20TEX','ailed,\x20wil','losed.','finalize','SIGINT','eign_keys\x20','\x20flush:\x20','S\x20group_de','ue\x20to\x20clos','leted\x20succ','parse\x20stor','Failed\x20to\x20','et()\x20(poli','Stmt\x20durin','lay_name\x20T','maxBytes','key,\x20value','eue\x20item\x20t','serialized','hQueue:','\x20item,\x20wil','SQLITE','\x20bytes\x20>\x20m','nt\x20(sql.js',',\x0a\x20\x20\x20\x20\x20\x20na',',\x0a\x20\x20\x20\x20\x20\x20gr','\x20to\x20be\x20clo','utf8','database.s','d)\x0a\x20\x20\x20\x20);\x0a','ackup\x20fail','tive_stats','\x20file\x20afte','has','h\x20complete','ng\x20final\x20f','ame\x20TEXT\x20N','ent\x20(polic','=\x2010000;','bytes','toLowerCas','js\x20(WASM)\x20','yMigration','for\x20prepar','get()\x20fail','deleteStmt','e):\x20','XT\x20PRIMARY','GER\x20PRIMAR','\x20\x20\x20\x20);\x0a\x20\x20','cuting\x20(sq','g\x20(native)','e_store\x20WH','Database','():','Write\x20queu','DB_FLUSH_I','atements\x20b','DB_CACHE_M','ed:','anly.','dy\x20for\x20get','isArray','resolve','ements.\x20Sc','r\x20(policy=','\x20available','_moveToTai','Native\x20sql','Automatic\x20','_value_sto','me\x20TEXT\x20NO','CONFLICT_P','nitialized','r\x20during\x20g','get\x20key\x20\x22','red\x20by\x20set','ignore)\x20wh','prepareSta','\x20NULL,\x0a\x20\x20\x20','Retry\x20succ','Unhandled\x20','ressure:\x20D','T\x20NOT\x20NULL','ocess\x20init','stringify',',\x20message\x20','_addToTail','ed\x20by\x20tran','able\x20alrea','S\x20active_s','Loaded\x20DB\x20','all','prepare\x20st','w\x20in-memor','ile\x20runnin','aring\x20stat','slice','Error\x20pers','AULT\x20\x27[]\x27\x0a','replace','1484955ydpjuO','ng\x20final\x20d','\x20while\x20exe','=\x20ON;','Unknown\x20qu','init.','failed:','persistDat','default','red\x20by\x20del','persist\x20DB','areStateme','string','basename','ue\x20FROM\x20ke','SQL.js','DB\x20closed\x20','Database\x20b','\x20failed,\x20r','ms\x20due\x20to\x20','9AndMvx','ose:','writeFile','Database\x20s','parse','it.','PRAGMA\x20for','S\x20user_act','l):','pathExists','DELETE\x20FRO','SQLJS_WASM','type','ame,\x20bucke','Value\x20for\x20','REPLACE\x20IN','tail',',\x20itemErr:','LE\x20IF\x20NOT\x20','INSERT\x20OR\x20','node_modul','\x20\x20group_id','PRAGMA\x20bus','lush\x20attem','tem\x20\x22','(sql.js).','\x20present)','\x20DB\x20is\x20clo','ed\x20flushQu','min','BEGIN\x20TRAN','ve\x20sqlite3','S\x20connecti','level\x20TEXT','e\x20TEXT);','B\x20statemen','179iPpHEu','ed\x20because','bind','sage_count','Error\x20duri','code','qlite','EFAULT\x200,\x0a','readFile','move','AX_BYTES','ted\x20INTEGE','ROLLBACK;','copy','catch','Rollback\x20f','r\x20during\x20a','Database\x20p','\x20reinitial','6095770auTHXs','key\x20=\x20?','ile\x20execut','e\x20for\x20prep','Final\x20flus','Type:\x20','EXISTS\x20key','eduling\x20re','ter\x20multip','byteLength','eeded\x20usin','DB\x20item\x20di','shift','CRITICAL:\x20','e\x20for\x20appl','prepare','next','ignore','\x20\x20\x20chat_ji','Ignored\x20SQ','own:','lback.\x20','e,\x20group_i','export','tive):\x20','s):\x20','lizing\x20del','DB_BATCH_S','tats\x20(\x0a\x20\x20\x20','id,\x20timefr','Created\x20ne','hutdown\x20pr','38292KkMPzn','g\x20INSERT\x20O','get',').\x20Backing','k.\x20Prepari','SELECT\x201\x20a','t_key);','ping\x20error','dy\x20exists)','EXT,\x0a\x20\x20\x20\x20\x20','IZE','alization\x20','DB\x20health\x20','for\x20run()\x20','ing\x20(nativ','ts\x20(set/de','reset','exec','free','while\x20prep','t_key\x20TEXT','s\x20started.','reduce','ping\x20detec','d\x20TEXT\x20NOT','est\x20item.\x20','732400aSCalt','message','size','\x20\x20\x20user_ji','[]\x27,\x0a\x20\x20\x20\x20\x20','key\x20\x22','No\x20adapter','R\x20REPLACE\x20','e\x20failed\x20d','d\x20TEXT,\x0a\x20\x20','\x0a\x20\x20\x20\x20CREAT','ization.','r\x20commit:','ified','ULT\x20\x27\x27,\x0a\x20\x20','\x0a\x20\x20\x20\x20\x20\x20mes','ule\x20TEXT,\x20','cy=ignore)','stat','560481mCzTmT','ERE\x20key\x20=\x20','.db','\x20driver.','_id\x20TEXT\x20P','ersist.','t\x20availabl','estimateSi','red\x20statem','delete','sql.js','DB_PATH','\x20flush.\x20Wi','\x20(\x0a\x20\x20\x20\x20\x20\x20u','\x22\x20is\x20not\x20s','adapter\x20no'];_0x20b2=function(){return _0x377f40;};return _0x20b2();}function isDbClosedError(_0x346736){const _0x5d50ad=_0xf51dba;if(!_0x346736)return![];const _0x23676a=String(_0x346736['message']||_0x346736||'');if(/database is closed/i[_0x5d50ad(0x266)](_0x23676a))return!![];if(/SQLITE_MISUSE/i[_0x5d50ad(0x266)](_0x23676a))return!![];if(_0x346736&&typeof _0x346736[_0x5d50ad(0x173)]===_0x5d50ad(0x142)&&_0x346736[_0x5d50ad(0x173)]['toUpperCas'+'e']()['includes'](_0x5d50ad(0x285)))return/SQLITE_MISUSE|SQLITE_IOERR|SQLITE_MISUSE/i[_0x5d50ad(0x266)](_0x346736[_0x5d50ad(0x173)]);return![];}async function scheduleReinitializeAfterError(_0x817409){const _0x10efc1=_0xf51dba;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;const _0x53f23f=Math[_0x10efc1(0x167)](reinitBackoffMs,MAX_REINIT_BACKOFF_MS);return warn(_0x10efc1(0x242)+'\x20DB\x20reinit'+'ialization'+_0x10efc1(0x20a)+_0x53f23f+(_0x10efc1(0x149)+_0x10efc1(0x1f2))+(_0x817409?.[_0x10efc1(0x1bc)]||_0x817409)),dbInitializingPromise=((async()=>{const _0x53bf59=_0x10efc1;await new Promise(_0x30f5e3=>setTimeout(_0x30f5e3,_0x53f23f));try{await initializeDatabase(),info('DB\x20reiniti'+'alized\x20aut'+'omatically'+_0x53bf59(0x236)+_0x53bf59(0x1ee)),reinitBackoffMs=0x246+0x17ea+-0x1648;}catch(_0x810d0e){error(_0x53bf59(0x2b5)+_0x53bf59(0x23e)+_0x53bf59(0x1ac)+_0x53bf59(0x2db),_0x810d0e),reinitBackoffMs=Math[_0x53bf59(0x167)](MAX_REINIT_BACKOFF_MS,reinitBackoffMs*(0x1b19+-0x169f+-0x478));try{await scheduleReinitializeAfterError(_0x810d0e);}catch(_0x1d1400){}}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function createNativeAdapter(_0x3b7d53){return{'_underlying':_0x3b7d53,async 'exec'(_0x22a34b){const _0x3265d3=_0x1567;try{await _0x3b7d53['exec'](_0x22a34b);return;}catch(_0x1f3061){if(isTableAlreadyExistsError(_0x1f3061)){warn(_0x3265d3(0x194)+_0x3265d3(0x1f9)+'able\x20alrea'+'dy\x20exists)'+_0x3265d3(0x2d7)+_0x3265d3(0x216)+_0x3265d3(0x199)+String(_0x22a34b)[_0x3265d3(0x2d1)](0x6a0+-0x1ef4+0x12*0x15a,0x13f2+0x1e4c+-0x1*0x30ae));return;}if(isUniqueConstraintError(_0x1f3061)){const _0xca88e0=getUniquePolicy();if(_0xca88e0===_0x3265d3(0x192)){debug(_0x3265d3(0x25f)+_0x3265d3(0x20b)+'raint\x20erro'+_0x3265d3(0x2b1)+_0x3265d3(0x2bd)+_0x3265d3(0x183)+_0x3265d3(0x1af)+_0x3265d3(0x29e)+String(_0x22a34b)[_0x3265d3(0x2d1)](-0x3*0x57c+-0xd1b+0x1d8f,0x6b*0x2f+-0xa58+-0x7*0x11b));return;}if(_0xca88e0===_0x3265d3(0x2d4)&&looksLikeSimpleInsert(_0x22a34b)){const _0x125363=_0x22a34b[_0x3265d3(0x2d4)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x3265d3(0x159)+'TO');try{await _0x3b7d53[_0x3265d3(0x1b2)](_0x125363);return;}catch(_0x2dc12c){throw _0x2dc12c;}}}throw _0x1f3061;}},async 'get'(_0x4d56a3,..._0x427176){const _0xb04266=_0x1567;try{const _0x2b3f88=normalizeBindParams(_0x427176);if(_0x2b3f88===undefined)return await _0x3b7d53[_0xb04266(0x1a3)](_0x4d56a3);return await _0x3b7d53[_0xb04266(0x1a3)](_0x4d56a3,_0x2b3f88);}catch(_0xe8b4f5){throw _0xe8b4f5;}},async 'all'(_0x8bf224,..._0x28102b){const _0x2ef2db=_0x1567;try{const _0x8bbd9e=normalizeBindParams(_0x28102b);if(_0x8bbd9e===undefined)return await _0x3b7d53['all'](_0x8bf224);return await _0x3b7d53[_0x2ef2db(0x2cc)](_0x8bf224,_0x8bbd9e);}catch(_0x715884){throw _0x715884;}},async 'run'(_0x3c2275,..._0x3cd6ef){const _0x381afa=_0x1567;try{const _0x30e933=normalizeBindParams(_0x3cd6ef);let _0x134a10;return _0x30e933===undefined?_0x134a10=await _0x3b7d53[_0x381afa(0x251)](_0x3c2275):_0x134a10=await _0x3b7d53['run'](_0x3c2275,_0x30e933),_0x134a10;}catch(_0x23318d){if(isUniqueConstraintError(_0x23318d)){const _0x828c2f=getUniquePolicy();if(_0x828c2f===_0x381afa(0x192))return debug('Ignored\x20UN'+'IQUE\x20const'+_0x381afa(0x21b)+_0x381afa(0x2b1)+'ignore)\x20wh'+_0x381afa(0x2cf)+_0x381afa(0x2a3)+':\x20'+String(_0x3c2275)[_0x381afa(0x2d1)](0x6df+0x3*-0xba7+0x1c16,-0x15c*0x3+0x2*0x669+-0x72e)),undefined;if(_0x828c2f===_0x381afa(0x2d4)&&looksLikeSimpleInsert(_0x3c2275)){const _0x3bca16=_0x3c2275[_0x381afa(0x2d4)](/^\s*INSERT\s+INTO/i,_0x381afa(0x15d)+'REPLACE\x20IN'+'TO'),_0x986186=normalizeBindParams(_0x3cd6ef);try{let _0x4440c7;if(_0x986186===undefined)_0x4440c7=await _0x3b7d53[_0x381afa(0x251)](_0x3bca16);else _0x4440c7=await _0x3b7d53[_0x381afa(0x251)](_0x3bca16,_0x986186);return info(_0x381afa(0x2c0)+_0x381afa(0x18b)+_0x381afa(0x1a2)+_0x381afa(0x1c2)+_0x381afa(0x206)),_0x4440c7;}catch(_0x1467b){throw _0x1467b;}}}throw _0x23318d;}},async 'prepare'(_0x29a19f){const _0x3e185d=_0x1567,_0x1609c4=await _0x3b7d53[_0x3e185d(0x190)](_0x29a19f);return{async 'run'(..._0x44d5d2){const _0xf715dd=_0x3e185d,_0x1cdccb=normalizeBindParams(_0x44d5d2);try{let _0x457b6d;if(_0x1cdccb===undefined)_0x457b6d=await _0x1609c4['run']();else _0x457b6d=await _0x1609c4[_0xf715dd(0x251)](_0x1cdccb);return _0x457b6d;}catch(_0x5edd7c){if(isUniqueConstraintError(_0x5edd7c)){const _0xe74cd7=getUniquePolicy();if(_0xe74cd7===_0xf715dd(0x192))return debug(_0xf715dd(0x25f)+_0xf715dd(0x20b)+_0xf715dd(0x21b)+_0xf715dd(0x2b1)+'ignore)\x20in'+'\x20prepared\x20'+'statement\x20'+'(native):\x20'+_0x29a19f),undefined;if(_0xe74cd7===_0xf715dd(0x2d4)&&looksLikeSimpleInsert(_0x29a19f)){const _0x34dd14=_0x29a19f['replace'](/^\s*INSERT\s+INTO/i,_0xf715dd(0x15d)+'REPLACE\x20IN'+'TO'),_0x25a08d=await _0x3b7d53['prepare'](_0x34dd14);try{let _0x2fc0c7;if(_0x1cdccb===undefined)_0x2fc0c7=await _0x25a08d[_0xf715dd(0x251)]();else _0x2fc0c7=await _0x25a08d[_0xf715dd(0x251)](_0x1cdccb);return await _0x25a08d[_0xf715dd(0x273)](),info(_0xf715dd(0x2c0)+'eeded\x20usin'+_0xf715dd(0x1a2)+_0xf715dd(0x1c2)+_0xf715dd(0x29b)+_0xf715dd(0x24a)+_0xf715dd(0x26f)+').'),_0x2fc0c7;}catch(_0x424d3f){try{await _0x25a08d[_0xf715dd(0x273)]();}catch(_0x2ee474){}throw _0x424d3f;}}}throw _0x5edd7c;}},async 'finalize'(){const _0x3da436=_0x3e185d;try{await _0x1609c4[_0x3da436(0x273)]();}catch(_0x16cc3f){}}};},async 'close'(){const _0x287eb3=_0x1567;try{await _0x3b7d53[_0x287eb3(0x24c)]();}catch(_0x45e930){}},'export'(){return undefined;}};}function createSQLjsAdapter(_0x427efb){const _0x125811=_0x427efb;return{'_underlying':_0x125811,async 'exec'(_0x1c484e){const _0x3565e6=_0x1567;try{_0x125811[_0x3565e6(0x251)](_0x1c484e);return;}catch(_0x460913){if(isTableAlreadyExistsError(_0x460913)){warn(_0x3565e6(0x194)+'L\x20error\x20(t'+_0x3565e6(0x2c9)+_0x3565e6(0x1a9)+_0x3565e6(0x2d7)+_0x3565e6(0x2a2)+'l.js):\x20'+String(_0x1c484e)[_0x3565e6(0x2d1)](-0x1*0x103d+0x783+0x8ba,-0x1d*-0x105+0xd04+0x2905*-0x1));return;}if(isUniqueConstraintError(_0x460913)){const _0x26c11e=getUniquePolicy();if(_0x26c11e===_0x3565e6(0x192)){debug('Ignored\x20UN'+'IQUE\x20const'+_0x3565e6(0x21b)+'r\x20(policy='+'ignore)\x20wh'+'ile\x20execut'+_0x3565e6(0x22e)+_0x3565e6(0x19a)+String(_0x1c484e)['slice'](0x17bc+0x2640+-0x3dfc*0x1,-0x11b*0x12+0x1*0x22d2+-0xd5c));return;}if(_0x26c11e===_0x3565e6(0x2d4)&&looksLikeSimpleInsert(_0x1c484e)){const _0x4e8f5c=_0x1c484e[_0x3565e6(0x2d4)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x3565e6(0x159)+'TO');try{_0x125811[_0x3565e6(0x251)](_0x4e8f5c);return;}catch(_0x5c9bd4){throw _0x5c9bd4;}}}throw _0x460913;}},async 'get'(_0x2ea585,..._0xb8a654){const _0x37ad45=_0x1567;try{const _0x3857ea=_0x125811[_0x37ad45(0x190)](_0x2ea585);try{const _0x3b3890=normalizeBindParams(_0xb8a654);if(_0x3b3890!==undefined)_0x3857ea[_0x37ad45(0x170)](_0x3b3890);if(_0x3857ea['step']()){const _0x3169f8=_0x3857ea['getAsObjec'+'t']();return _0x3857ea[_0x37ad45(0x1b3)](),_0x3169f8;}else return _0x3857ea[_0x37ad45(0x1b3)](),undefined;}catch(_0x220d7c){try{_0x3857ea['free']();}catch(_0x5004e5){}if(isUniqueConstraintError(_0x220d7c)){const _0x53b790=getUniquePolicy();if(_0x53b790===_0x37ad45(0x192))return debug('Ignored\x20UN'+_0x37ad45(0x20b)+_0x37ad45(0x21b)+_0x37ad45(0x2ba)+_0x37ad45(0x27c)+_0x37ad45(0x1cc)+':\x20'+_0x2ea585),undefined;}throw _0x220d7c;}}catch(_0x2b1aa7){throw _0x2b1aa7;}},async 'all'(_0x15cf93,..._0x1fa4e9){const _0x58956b=_0x1567;try{const _0x2fbacd=_0x125811['prepare'](_0x15cf93),_0x31c4f8=[];try{const _0x3a84cc=normalizeBindParams(_0x1fa4e9);if(_0x3a84cc!==undefined)_0x2fbacd[_0x58956b(0x170)](_0x3a84cc);while(_0x2fbacd['step']())_0x31c4f8[_0x58956b(0x264)](_0x2fbacd['getAsObjec'+'t']());return _0x2fbacd[_0x58956b(0x1b3)](),_0x31c4f8;}catch(_0x48f1cd){try{_0x2fbacd[_0x58956b(0x1b3)]();}catch(_0x41335c){}if(isUniqueConstraintError(_0x48f1cd)){const _0x97cc4a=getUniquePolicy();if(_0x97cc4a===_0x58956b(0x192))return debug(_0x58956b(0x25f)+_0x58956b(0x20b)+_0x58956b(0x21b)+_0x58956b(0x17e)+_0x58956b(0x26d)+_0x58956b(0x1cc)+':\x20'+_0x15cf93),_0x31c4f8;}throw _0x48f1cd;}}catch(_0x31adf2){throw _0x31adf2;}},async 'run'(_0x2ccbdd,..._0x2eb870){const _0x1edb94=_0x1567;try{const _0x378018=normalizeBindParams(_0x2eb870);if(_0x378018===undefined){_0x125811[_0x1edb94(0x251)](_0x2ccbdd);const _0x4d9fdc=typeof _0x125811['getRowsMod'+_0x1edb94(0x1c8)]===_0x1edb94(0x237)?_0x125811[_0x1edb94(0x25e)+_0x1edb94(0x1c8)]():undefined;return _0x4d9fdc!==undefined?{'changes':_0x4d9fdc}:undefined;}else{const _0x28ba17=_0x125811[_0x1edb94(0x190)](_0x2ccbdd);try{_0x28ba17[_0x1edb94(0x170)](_0x378018),_0x28ba17[_0x1edb94(0x251)](),_0x28ba17['free']();const _0x563aa4=typeof _0x125811['getRowsMod'+'ified']==='function'?_0x125811[_0x1edb94(0x25e)+_0x1edb94(0x1c8)]():undefined;return _0x563aa4!==undefined?{'changes':_0x563aa4}:undefined;}catch(_0x436ab2){try{_0x28ba17[_0x1edb94(0x1b3)]();}catch(_0x598044){}if(isUniqueConstraintError(_0x436ab2)){const _0x10d5af=getUniquePolicy();if(_0x10d5af===_0x1edb94(0x192))return debug(_0x1edb94(0x25f)+'IQUE\x20const'+_0x1edb94(0x21b)+_0x1edb94(0x2b1)+_0x1edb94(0x2bd)+_0x1edb94(0x2cf)+_0x1edb94(0x23a)+String(_0x2ccbdd)[_0x1edb94(0x2d1)](-0xa75*0x1+0xb3*-0xb+0x1226,0x1272*-0x1+-0x455*0x2+0x14*0x16f)),undefined;if(_0x10d5af===_0x1edb94(0x2d4)&&looksLikeSimpleInsert(_0x2ccbdd)){const _0x2edb3c=_0x2ccbdd[_0x1edb94(0x2d4)](/^\s*INSERT\s+INTO/i,_0x1edb94(0x15d)+_0x1edb94(0x159)+'TO'),_0x296395=_0x125811[_0x1edb94(0x190)](_0x2edb3c);try{_0x296395[_0x1edb94(0x170)](_0x378018),_0x296395['run'](),_0x296395[_0x1edb94(0x1b3)](),info(_0x1edb94(0x2c0)+_0x1edb94(0x18b)+_0x1edb94(0x1a2)+_0x1edb94(0x1c2)+_0x1edb94(0x1ae)+_0x1edb94(0x163));const _0x38b4c5=typeof _0x125811[_0x1edb94(0x25e)+_0x1edb94(0x1c8)]==='function'?_0x125811[_0x1edb94(0x25e)+_0x1edb94(0x1c8)]():undefined;return _0x38b4c5!==undefined?{'changes':_0x38b4c5}:undefined;}catch(_0x4351f7){try{_0x296395[_0x1edb94(0x1b3)]();}catch(_0x4a2ba5){}throw _0x4351f7;}}}throw _0x436ab2;}}}catch(_0x1d9ee9){throw _0x1d9ee9;}},async 'prepare'(_0xc2a44d){const _0x2b7b54=_0x1567;try{const _0x1c1ac6=_0x125811[_0x2b7b54(0x190)](_0xc2a44d);return{async 'run'(..._0x5230d0){const _0xf389ae=_0x2b7b54;try{const _0x47f0f7=normalizeBindParams(_0x5230d0);if(_0x47f0f7!==undefined)_0x1c1ac6[_0xf389ae(0x170)](_0x47f0f7);_0x1c1ac6[_0xf389ae(0x251)]();try{_0x1c1ac6[_0xf389ae(0x1b1)]();}catch(_0x2a6d9c){}const _0x1f1876=typeof _0x125811[_0xf389ae(0x25e)+_0xf389ae(0x1c8)]===_0xf389ae(0x237)?_0x125811['getRowsMod'+'ified']():undefined;return _0x1f1876!==undefined?{'changes':_0x1f1876}:undefined;}catch(_0x44ee2d){if(isUniqueConstraintError(_0x44ee2d)){const _0x31dcf8=getUniquePolicy();if(_0x31dcf8===_0xf389ae(0x192))return debug(_0xf389ae(0x25f)+_0xf389ae(0x20b)+_0xf389ae(0x21b)+'r\x20in\x20prepa'+_0xf389ae(0x1d6)+_0xf389ae(0x295)+'y=ignore):'+'\x20'+_0xc2a44d),undefined;if(_0x31dcf8===_0xf389ae(0x2d4)&&looksLikeSimpleInsert(_0xc2a44d)){const _0x4832be=_0xc2a44d['replace'](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0xf389ae(0x159)+'TO'),_0x493c73=_0x125811[_0xf389ae(0x190)](_0x4832be);try{const _0x3a4a55=normalizeBindParams(_0x5230d0);if(_0x3a4a55!==undefined)_0x493c73[_0xf389ae(0x170)](_0x3a4a55);_0x493c73[_0xf389ae(0x251)](),_0x493c73[_0xf389ae(0x1b3)](),info(_0xf389ae(0x2c0)+_0xf389ae(0x18b)+_0xf389ae(0x1a2)+_0xf389ae(0x1c2)+_0xf389ae(0x29b)+_0xf389ae(0x24a)+_0xf389ae(0x287)+').');const _0x33e3c3=typeof _0x125811[_0xf389ae(0x25e)+_0xf389ae(0x1c8)]===_0xf389ae(0x237)?_0x125811[_0xf389ae(0x25e)+_0xf389ae(0x1c8)]():undefined;return _0x33e3c3!==undefined?{'changes':_0x33e3c3}:undefined;}catch(_0x364ce7){try{_0x493c73[_0xf389ae(0x1b3)]();}catch(_0x72cafa){}throw _0x364ce7;}}}throw _0x44ee2d;}},async 'finalize'(){const _0x434f0e=_0x2b7b54;try{_0x1c1ac6[_0x434f0e(0x1b3)]();}catch(_0x41eae1){}}};}catch(_0x4847f3){throw _0x4847f3;}},'export'(){const _0x33a2b2=_0x1567;try{return _0x125811[_0x33a2b2(0x198)]();}catch(_0x27a43d){throw _0x27a43d;}},async 'close'(){const _0x58d520=_0x1567;try{if(typeof _0x125811[_0x58d520(0x24c)]===_0x58d520(0x237))_0x125811[_0x58d520(0x24c)]();else{if(typeof _0x125811[_0x58d520(0x1b3)]===_0x58d520(0x237))_0x125811[_0x58d520(0x1b3)]();}}catch(_0x1d3341){}}};}export async function initializeDatabase(){const _0xede29=_0xf51dba;info(_0xede29(0x25a)+_0xede29(0x219)+'ion\x20proces'+_0xede29(0x1b6)+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x3ac0d5=getConfig();maxTotalBytes=_0x3ac0d5[_0xede29(0x2aa)+_0xede29(0x178)]||(0xd75+-0x30d*-0x1+-0x1050)*(0xa3*-0x11+-0x11c3*0x1+0x2096)*(-0x1*-0x12d1+-0x1f66+0x1095),cache=new MemoryCache(maxTotalBytes||(0x300*-0xd+0x67c+0x2*0x105b)*(-0xbf*0x32+0x1f*-0x141+0x1*0x502d)*(0x350+0x31e+-0x26e));const _0x2a67ee=_0x3ac0d5['PROJECT_RO'+'OT']||process[_0xede29(0x25d)](),_0x1de2c8=_0x1657dd[_0xede29(0x2af)](_0x2a67ee,_0x3ac0d5['DB_PATH']||'.db');await _0x3dddb5[_0xede29(0x224)](_0x1de2c8);const _0x2820fd=_0x3ac0d5['DB_NAME']||'database.s'+_0xede29(0x174),_0x41d94b=_0x1657dd[_0xede29(0x207)](_0x1de2c8,_0x2820fd);let _0x4ed2da=![];try{let _0x529bf4=null,_0x3debc4=null;try{_0x529bf4=await import('sqlite3'),_0x3debc4=(await import('sqlite'))[_0xede29(0x205)];}catch(_0x3dcbd3){_0x529bf4=null,_0x3debc4=null;}if(_0x529bf4&&_0x3debc4){await backupDB(_0x41d94b);const _0x4290dc=_0x529bf4[_0xede29(0x2dd)]||_0x529bf4,_0x2e280c=await _0x3debc4({'filename':_0x41d94b,'driver':_0x4290dc[_0xede29(0x2a5)]});try{await _0x2e280c['exec'](_0xede29(0x1f3)+_0xede29(0x227)+'=\x20WAL;');}catch(_0xa134c2){}try{await _0x2e280c['exec']('PRAGMA\x20syn'+_0xede29(0x223)+_0xede29(0x1f6));}catch(_0x285110){}try{await _0x2e280c[_0xede29(0x1b2)](_0xede29(0x160)+'y_timeout\x20'+'=\x2010000;');}catch(_0x506a3d){}try{await _0x2e280c[_0xede29(0x1b2)](_0xede29(0x150)+'eign_keys\x20'+_0xede29(0x2d8));}catch(_0x442422){}adapter=createNativeAdapter(_0x2e280c),db=adapter,usingNative=!![],_0x4ed2da=!![],info('Using\x20nati'+_0xede29(0x169)+_0xede29(0x1d1));}}catch(_0x118d25){warn(_0xede29(0x2b4)+_0xede29(0x239)+_0xede29(0x271)+'l\x20attempt\x20'+_0xede29(0x229)+_0xede29(0x196)+(_0x118d25?.[_0xede29(0x1bc)]||_0x118d25)),_0x4ed2da=![],adapter=null,db=null,usingNative=![];}if(!_0x4ed2da)try{const _0xef246c=await import('sql.js'),_0x3dde06=_0xef246c[_0xede29(0x2dd)]||_0xef246c,_0x43af19=await _0x3dde06({'locateFile':_0x10f5fc=>{const _0x4b46c1=_0xede29,_0x37466c=_0x3ac0d5[_0x4b46c1(0x155)+'_PATH'];if(_0x37466c)return _0x37466c;return _0x1657dd[_0x4b46c1(0x207)](process[_0x4b46c1(0x25d)](),_0x4b46c1(0x15e)+'es',_0x4b46c1(0x1d8),_0x4b46c1(0x21c),_0x10f5fc);}});let _0x4e4ef9;if(await _0x3dddb5[_0xede29(0x153)](_0x41d94b)){const _0x53e64f=await _0x3dddb5[_0xede29(0x176)](_0x41d94b),_0x2f4b62=new Uint8Array(_0x53e64f);_0x4e4ef9=new _0x43af19[(_0xede29(0x2a5))](_0x2f4b62),info(_0xede29(0x2cb)+_0xede29(0x201)+_0xede29(0x21e)+'m\x20'+_0x41d94b);}else _0x4e4ef9=new _0x43af19['Database'](),info(_0xede29(0x19f)+_0xede29(0x2ce)+'y\x20SQL.js\x20D'+_0xede29(0x218)+_0xede29(0x164));adapter=createSQLjsAdapter(_0x4e4ef9),db=adapter,usingNative=![],info('Using\x20SQL.'+_0xede29(0x299)+_0xede29(0x215));}catch(_0x28d1fe){error(_0xede29(0x229)+'lback\x20fail'+_0xede29(0x2ab),_0x28d1fe);throw _0x28d1fe;}try{if(adapter&&typeof adapter[_0xede29(0x1b2)]===_0xede29(0x237))await adapter[_0xede29(0x1b2)](_0xede29(0x150)+_0xede29(0x275)+_0xede29(0x2d8));}catch(_0x4a65fb){}try{if(adapter&&typeof adapter[_0xede29(0x1b2)]===_0xede29(0x237))await adapter[_0xede29(0x1b2)](_0xede29(0x160)+'y_timeout\x20'+_0xede29(0x296));}catch(_0x59eac7){}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[],queueBytes=queueBytes||-0x3f7*-0x3+-0x12a*0x11+0x7e5;const _0x2b589c=_0x3ac0d5[_0xede29(0x2a8)+_0xede29(0x26e)]||0x74+-0xd96+-0xe*-0x17f;flushTimer=setInterval(()=>{const _0x4bf27a=_0xede29;flushQueue()[_0x4bf27a(0x17c)](_0x22cd06=>error(_0x4bf27a(0x2c1)+'error\x20duri'+_0x4bf27a(0x226)+_0x4bf27a(0x166)+'eue:',_0x22cd06));},_0x2b589c),info(_0xede29(0x25a)+_0xede29(0x2b9)+'\x20('+(usingNative?'native\x20sql'+'ite3':_0xede29(0x145))+(_0xede29(0x1a4)+'\x20file:\x20')+_0x41d94b);try{(function _0x54e420(){setTimeout(async()=>{const _0xf2f2a7=_0x1567;try{if(!dbReady||!adapter)return _0x54e420();if(adapter&&typeof adapter[_0xf2f2a7(0x1a3)]===_0xf2f2a7(0x237))try{await adapter[_0xf2f2a7(0x1a3)](_0xf2f2a7(0x1a6)+'s\x20ok');}catch(_0x1ce959){throw _0x1ce959;}else{if(adapter&&typeof adapter[_0xf2f2a7(0x1b2)]==='function')try{await adapter[_0xf2f2a7(0x1b2)](_0xf2f2a7(0x247));}catch(_0x30529a){throw _0x30529a;}}}catch(_0x59e14a){isDbClosedError(_0x59e14a)?(warn(_0xf2f2a7(0x1ad)+_0xf2f2a7(0x1b8)+_0xf2f2a7(0x222)+_0xf2f2a7(0x256)+_0xf2f2a7(0x1e9)+_0xf2f2a7(0x14f)),await scheduleReinitializeAfterError(_0x59e14a)):debug(_0xf2f2a7(0x1ad)+_0xf2f2a7(0x1a8)+'\x20(non-fata'+_0xf2f2a7(0x152),_0x59e14a?.[_0xf2f2a7(0x1bc)]||_0x59e14a);}finally{_0x54e420();}},(-0x1b13+-0x2401*0x1+-0x3f5*-0x10)*(-0x15a+0x201b*0x1+-0x4f*0x57));}());}catch(_0x24a8fc){}}catch(_0x2e20d7){error(_0xede29(0x1ef)+_0xede29(0x20e)+(_0x2e20d7?.[_0xede29(0x1bc)]||_0x2e20d7),_0x2e20d7);throw _0x2e20d7;}}async function prepareStatements(){const _0x282cfb=_0xf51dba;if(!adapter)throw new Error(_0x282cfb(0x1dd)+'t\x20availabl'+_0x282cfb(0x184)+_0x282cfb(0x141)+_0x282cfb(0x202));if(setStmt){try{await setStmt['finalize']();}catch(_0x4a1e4a){}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x282cfb(0x273)]();}catch(_0x3499a9){}deleteStmt=null;}try{setStmt=await adapter[_0x282cfb(0x190)](_0x282cfb(0x15d)+_0x282cfb(0x159)+_0x282cfb(0x1fa)+_0x282cfb(0x1f0)+_0x282cfb(0x280)+_0x282cfb(0x214)+_0x282cfb(0x20c)),deleteStmt=await adapter['prepare'](_0x282cfb(0x154)+_0x282cfb(0x221)+_0x282cfb(0x2a4)+_0x282cfb(0x1cf)+'?'),info('Prepared\x20D'+_0x282cfb(0x16d)+_0x282cfb(0x1b0)+'lete).');}catch(_0x11b946){if(isDbClosedError(_0x11b946)){warn(_0x282cfb(0x2be)+_0x282cfb(0x245)+_0x282cfb(0x1ff)+'se\x20DB\x20is\x20c'+_0x282cfb(0x272));throw _0x11b946;}error(_0x282cfb(0x27b)+'prepare\x20DB'+'\x20statement'+'s:',_0x11b946);throw _0x11b946;}}async function applyMigrations(){const _0x57862f=_0xf51dba;if(!adapter)throw new Error(_0x57862f(0x1dd)+_0x57862f(0x1d4)+_0x57862f(0x18f)+_0x57862f(0x29a)+_0x57862f(0x220));await adapter['exec'](_0x57862f(0x258)+_0x57862f(0x15c)+_0x57862f(0x187)+_0x57862f(0x2b6)+_0x57862f(0x243)+_0x57862f(0x29f)+'\x20KEY,\x20valu'+_0x57862f(0x16c)),await adapter['exec'](_0x57862f(0x258)+'LE\x20IF\x20NOT\x20'+'EXISTS\x20log'+_0x57862f(0x244)+_0x57862f(0x2a0)+'Y\x20KEY,\x20mod'+_0x57862f(0x1cb)+_0x57862f(0x16b)+_0x57862f(0x2c6)+'TEXT);'),await adapter['exec'](_0x57862f(0x1c5)+'E\x20TABLE\x20IF'+_0x57862f(0x1e4)+_0x57862f(0x16a)+'ons\x20(\x0a\x20\x20\x20\x20'+'\x20\x20name\x20TEX'+'T\x20NOT\x20NULL'+_0x57862f(0x289)+'oup_id\x20TEX'+_0x57862f(0x2c3)+_0x57862f(0x262)+_0x57862f(0x211)+_0x57862f(0x270)+'T\x20NOT\x20NULL'+_0x57862f(0x262)+_0x57862f(0x1bf)+_0x57862f(0x26a)+'d\x20TEXT\x20NOT'+_0x57862f(0x21d)+_0x57862f(0x1c9)+'\x20\x20\x20\x20PRIMAR'+_0x57862f(0x24b)+_0x57862f(0x197)+_0x57862f(0x28d)+'\x20\x20'),await adapter[_0x57862f(0x1b2)](_0x57862f(0x1c5)+_0x57862f(0x228)+_0x57862f(0x1e4)+_0x57862f(0x277)+'faults\x20(\x0a\x20'+_0x57862f(0x24f)+_0x57862f(0x1d2)+_0x57862f(0x23b)+_0x57862f(0x288)+_0x57862f(0x2b7)+_0x57862f(0x22d)+_0x57862f(0x2d3)+_0x57862f(0x2a1)),await adapter[_0x57862f(0x1b2)](_0x57862f(0x1c5)+_0x57862f(0x228)+'\x20NOT\x20EXIST'+_0x57862f(0x151)+_0x57862f(0x1e3)+_0x57862f(0x1db)+_0x57862f(0x240)+'XT\x20PRIMARY'+_0x57862f(0x1f8)+_0x57862f(0x15f)+'\x20TEXT\x20NOT\x20'+_0x57862f(0x261)+';\x0a\x20\x20'),await adapter[_0x57862f(0x1b2)]('\x0a\x20\x20\x20\x20CREAT'+_0x57862f(0x228)+_0x57862f(0x1e4)+_0x57862f(0x2ca)+_0x57862f(0x19d)+_0x57862f(0x260)+'GER\x20PRIMAR'+'Y\x20KEY,\x0a\x20\x20\x20'+_0x57862f(0x193)+_0x57862f(0x1b9)+_0x57862f(0x2bf)+_0x57862f(0x1be)+_0x57862f(0x1c4)+_0x57862f(0x24d)+_0x57862f(0x294)+'OT\x20NULL,\x0a\x20'+_0x57862f(0x225)+_0x57862f(0x1b5)+_0x57862f(0x1e7)+_0x57862f(0x1ca)+_0x57862f(0x171)+'\x20INTEGER\x20D'+_0x57862f(0x175)+'\x20\x20\x20\x20\x20\x20disp'+_0x57862f(0x27e)+_0x57862f(0x1aa)+'\x20last_upda'+_0x57862f(0x179)+'R\x0a\x20\x20\x20\x20);\x0a\x20'+'\x20'),await adapter[_0x57862f(0x1b2)]('CREATE\x20UNI'+_0x57862f(0x26c)+_0x57862f(0x267)+'STS\x20idx_ac'+_0x57862f(0x28f)+_0x57862f(0x249)+_0x57862f(0x268)+'ats(chat_j'+_0x57862f(0x19e)+_0x57862f(0x157)+_0x57862f(0x1a7));}async function flushQueue(){const _0x2a3c88=_0xf51dba;if(!dbReady||isFlushing||writeQueue[_0x2a3c88(0x1e8)]===0x2316+-0x178d+-0xb89)return;const _0x198f09=writeQueue[0x1fe2+-0xc1*0xb+0x21*-0xb7];if(_0x198f09&&_0x198f09['retries']>-0x15c+-0x128b+0x13e7&&Date[_0x2a3c88(0x22b)]()-_0x198f09[_0x2a3c88(0x1f7)]<-0x1a21+-0x268f+0x4c68)return;if(!setStmt||!deleteStmt)try{if(!adapter)throw new Error(_0x2a3c88(0x1c1)+_0x2a3c88(0x2b2)+_0x2a3c88(0x1ec)+_0x2a3c88(0x238)+_0x2a3c88(0x1e6));await prepareStatements();}catch(_0x4e8ed3){if(isDbClosedError(_0x4e8ed3)){warn(_0x2a3c88(0x146)+_0x2a3c88(0x1b4)+_0x2a3c88(0x2d0)+_0x2a3c88(0x2b0)+_0x2a3c88(0x1f1)+_0x2a3c88(0x232)),await scheduleReinitializeAfterError(_0x4e8ed3);return;}else{error(_0x2a3c88(0x27b)+_0x2a3c88(0x2cd)+_0x2a3c88(0x2a9)+'efore\x20flus'+_0x2a3c88(0x283),_0x4e8ed3);return;}}isFlushing=!![];const _0x2218ae=getConfig(),_0x26d344=_0x2218ae['DB_BATCH_S'+_0x2a3c88(0x1ab)]||-0x18c7+-0x1257+0x2b50,_0x1d1bb5=writeQueue['splice'](0x123e+0x1e9b*0x1+0xcd*-0x3d,_0x26d344),_0x13b9a7=_0x1d1bb5['reduce']((_0x490517,_0x503923)=>_0x490517+(_0x503923['size']||0x1b5b+0xe9b+-0x29f6),-0x2359+0x8e9+0x24*0xbc);try{if(adapter&&typeof adapter[_0x2a3c88(0x1b2)]===_0x2a3c88(0x237))await adapter['exec'](_0x2a3c88(0x168)+_0x2a3c88(0x200));for(const _0x52f6db of _0x1d1bb5){try{switch(_0x52f6db[_0x2a3c88(0x156)]){case _0x2a3c88(0x23f):if(!setStmt)throw new Error('setStmt\x20mi'+'ssing');await setStmt[_0x2a3c88(0x251)](_0x52f6db['key'],_0x52f6db['value']);break;case _0x2a3c88(0x1d7):if(!deleteStmt)throw new Error(_0x2a3c88(0x29d)+'\x20missing');await deleteStmt[_0x2a3c88(0x251)](_0x52f6db[_0x2a3c88(0x253)]);break;default:warn(_0x2a3c88(0x2d9)+_0x2a3c88(0x281)+'ype\x20during'+_0x2a3c88(0x276)+_0x52f6db[_0x2a3c88(0x156)]);}}catch(_0x5da1b2){if(isDbClosedError(_0x5da1b2))throw _0x5da1b2;error(_0x2a3c88(0x27b)+_0x2a3c88(0x1e2)+_0x2a3c88(0x284)+'l\x20be\x20handl'+_0x2a3c88(0x2c8)+_0x2a3c88(0x255)+'llback:\x20'+JSON[_0x2a3c88(0x2c5)](_0x52f6db)+(_0x2a3c88(0x15b)+'\x20')+(_0x5da1b2?.[_0x2a3c88(0x1bc)]||_0x5da1b2));throw _0x5da1b2;}}if(adapter&&typeof adapter[_0x2a3c88(0x1b2)]===_0x2a3c88(0x237))await adapter[_0x2a3c88(0x1b2)]('COMMIT;');if(!usingNative)try{await persistDatabaseToFile();}catch(_0x1c9d24){error(_0x2a3c88(0x27b)+_0x2a3c88(0x2df)+_0x2a3c88(0x290)+_0x2a3c88(0x1c7),_0x1c9d24);}queueBytes=Math[_0x2a3c88(0x203)](-0x1914+0x26a*0x3+0x11d6,queueBytes-_0x13b9a7),reinitBackoffMs=0x652*0x2+0x2*0xdc2+-0x2440;}catch(_0x2546f2){if(isDbClosedError(_0x2546f2)){error(_0x2a3c88(0x254)+_0x2a3c88(0x28a)+_0x2a3c88(0x234)+_0x2a3c88(0x1da)+'ll\x20attempt'+_0x2a3c88(0x180)+_0x2a3c88(0x1c6),_0x2546f2);try{if(adapter&&typeof adapter[_0x2a3c88(0x1b2)]===_0x2a3c88(0x237))await adapter[_0x2a3c88(0x1b2)]('ROLLBACK;');}catch(_0xc4993e){}writeQueue['unshift'](..._0x1d1bb5),await scheduleReinitializeAfterError(_0x2546f2);}else{error(_0x2a3c88(0x1e0)+'ransaction'+_0x2a3c88(0x148)+_0x2a3c88(0x1ed)+_0x2a3c88(0x1a5)+_0x2a3c88(0x204)+'ry.',_0x2546f2);try{if(adapter&&typeof adapter[_0x2a3c88(0x1b2)]===_0x2a3c88(0x237))await adapter[_0x2a3c88(0x1b2)](_0x2a3c88(0x17a));}catch(_0x1ce62e){error(_0x2a3c88(0x17d)+_0x2a3c88(0x23c),_0x1ce62e);}const _0x85fb0a=Date[_0x2a3c88(0x22b)](),_0xa5dad7=[];for(const _0x1c0125 of _0x1d1bb5){_0x1c0125['retries']=(_0x1c0125[_0x2a3c88(0x21f)]||0x24e1+-0x4c*-0x32+-0x33b9)+(0x1ae*-0x8+0x3b4+0x9bd),_0x1c0125[_0x2a3c88(0x1f7)]=_0x85fb0a;if(_0x1c0125['retries']<-0x2e1+0x2632+-0xbc5*0x3)_0xa5dad7[_0x2a3c88(0x264)](_0x1c0125);else error(_0x2a3c88(0x18e)+_0x2a3c88(0x18c)+_0x2a3c88(0x24e)+_0x2a3c88(0x189)+_0x2a3c88(0x1ea)+_0x2a3c88(0x231)+JSON['stringify'](_0x1c0125));}if(_0xa5dad7[_0x2a3c88(0x1e8)]>0x1d13+-0x2*0x91d+-0xad9)writeQueue[_0x2a3c88(0x1fd)](..._0xa5dad7);queueBytes=Math['max'](-0x21f7+0x2460+-0x1*0x269,queueBytes-_0x13b9a7+_0xa5dad7[_0x2a3c88(0x1b7)]((_0x41f5fe,_0x305708)=>_0x41f5fe+(_0x305708['size']||0x190b+-0x53*0x59+-0x3d0*-0x1),-0x25f*-0x9+-0x1fc2+-0x1*-0xa6b));}}finally{isFlushing=![];}}async function persistDatabaseToFile(){const _0x423c35=_0xf51dba,_0x5a3ff3=getConfig(),_0x19a0dc=_0x5a3ff3['PROJECT_RO'+'OT']||process[_0x423c35(0x25d)](),_0x3fb8d5=_0x1657dd[_0x423c35(0x2af)](_0x19a0dc,_0x5a3ff3[_0x423c35(0x1d9)]||_0x423c35(0x1d0)),_0x4eacd9=_0x5a3ff3['DB_NAME']||_0x423c35(0x28c)+_0x423c35(0x174),_0x237335=_0x1657dd[_0x423c35(0x207)](_0x3fb8d5,_0x4eacd9);if(usingNative)return;if(!adapter){warn(_0x423c35(0x2dc)+_0x423c35(0x22f)+'e:\x20adapter'+'\x20missing,\x20'+_0x423c35(0x1fb)+_0x423c35(0x1d3));return;}try{const _0x31f7b2=adapter['export']();if(!_0x31f7b2)return;const _0x563a64=_0x237335+'.tmp';await _0x3dddb5[_0x423c35(0x14c)](_0x563a64,Buffer[_0x423c35(0x233)](_0x31f7b2)),await _0x3dddb5[_0x423c35(0x177)](_0x563a64,_0x237335,{'overwrite':!![]}),info(_0x423c35(0x17f)+'ersisted\x20t'+'o\x20'+_0x237335);}catch(_0x3c103b){if(isDbClosedError(_0x3c103b)){warn(_0x423c35(0x2dc)+_0x423c35(0x22f)+_0x423c35(0x1c3)+_0x423c35(0x278)+'ed\x20DB.\x20Sch'+_0x423c35(0x188)+_0x423c35(0x2da)),await scheduleReinitializeAfterError(_0x3c103b);return;}throw _0x3c103b;}}export async function get(_0x465baf){const _0x1523b8=_0xf51dba;try{if(cache&&cache[_0x1523b8(0x291)](_0x465baf))return cache[_0x1523b8(0x1a3)](_0x465baf);}catch(_0x174d25){}if(!dbReady||!adapter)return warn(_0x1523b8(0x210)+_0x1523b8(0x2ad)+'\x20operation'+'.'),undefined;try{const _0x13e343=await adapter['get']('SELECT\x20val'+_0x1523b8(0x144)+'y_value_st'+'ore\x20WHERE\x20'+_0x1523b8(0x182),_0x465baf);if(_0x13e343&&_0x13e343[_0x1523b8(0x22a)]!=null)try{const _0x32f5b1=JSON[_0x1523b8(0x14e)](_0x13e343[_0x1523b8(0x22a)]);try{cache[_0x1523b8(0x23f)](_0x465baf,_0x32f5b1,_0x13e343[_0x1523b8(0x22a)]);}catch(_0x57511a){}return _0x32f5b1;}catch(_0x476e3c){return error('Failed\x20to\x20'+_0x1523b8(0x27a)+_0x1523b8(0x252)+'r\x20key\x20\x22'+_0x465baf+_0x1523b8(0x1f4)+(_0x476e3c?.[_0x1523b8(0x1bc)]||_0x476e3c)),undefined;}}catch(_0x31cfa6){isDbClosedError(_0x31cfa6)?(warn(_0x1523b8(0x29c)+_0x1523b8(0x16f)+_0x1523b8(0x165)+_0x1523b8(0x269)+_0x1523b8(0x1e9)+'it.\x20Key:\x20'+_0x465baf),await scheduleReinitializeAfterError(_0x31cfa6)):error(_0x1523b8(0x27b)+_0x1523b8(0x2bb)+_0x465baf+('\x22\x20from\x20DB:'+'\x20')+(_0x31cfa6?.[_0x1523b8(0x1bc)]||_0x31cfa6),_0x31cfa6);}return undefined;}export function set(_0x22389f,_0x5f6e49){const _0x498862=_0xf51dba;if(_0x5f6e49===undefined){del(_0x22389f);return;}let _0x218001;try{_0x218001=JSON[_0x498862(0x2c5)](_0x5f6e49);}catch(_0x1e3381){error(_0x498862(0x158)+_0x498862(0x1c0)+_0x22389f+(_0x498862(0x1dc)+'erializabl'+_0x498862(0x1e5)+'g\x20persist.'),_0x1e3381);return;}try{cache[_0x498862(0x23f)](_0x22389f,_0x5f6e49,_0x218001);}catch(_0x11e0e9){}const _0x3d8f5a={'type':'set','key':_0x22389f,'value':_0x218001,'retries':0x0,'timestamp':Date['now']()};_0x3d8f5a['size']=estimateQueueItemSize(_0x3d8f5a),queueBytes+=_0x3d8f5a[_0x498862(0x1bd)],writeQueue[_0x498862(0x264)](_0x3d8f5a),enforceMemoryLimit(),writeQueue[_0x498862(0x1e8)]>=getConfig()[_0x498862(0x19c)+'IZE']&&flushQueue()['catch'](_0x1f6042=>{const _0x3a47ae=_0x498862;error(_0x3a47ae(0x172)+'ng\x20flushQu'+'eue\x20trigge'+_0x3a47ae(0x2bc)+'():',_0x1f6042);});}export function del(_0x4990ff){const _0x43f8bd=_0xf51dba;try{cache[_0x43f8bd(0x1d7)](_0x4990ff);}catch(_0x2517e2){}const _0x5d7e24={'type':_0x43f8bd(0x1d7),'key':_0x4990ff,'retries':0x0,'timestamp':Date[_0x43f8bd(0x22b)]()};_0x5d7e24[_0x43f8bd(0x1bd)]=estimateQueueItemSize(_0x5d7e24),queueBytes+=_0x5d7e24[_0x43f8bd(0x1bd)],writeQueue[_0x43f8bd(0x264)](_0x5d7e24),enforceMemoryLimit(),writeQueue[_0x43f8bd(0x1e8)]>=getConfig()['DB_BATCH_S'+_0x43f8bd(0x1ab)]&&flushQueue()[_0x43f8bd(0x17c)](_0x558198=>{const _0x30d9e0=_0x43f8bd;error(_0x30d9e0(0x172)+'ng\x20flushQu'+_0x30d9e0(0x263)+_0x30d9e0(0x2de)+_0x30d9e0(0x2a6),_0x558198);});}export async function shutdownDatabase(){const _0x101af7=_0xf51dba;info(_0x101af7(0x14d)+_0x101af7(0x1a0)+_0x101af7(0x2c4)+_0x101af7(0x213)+_0x101af7(0x208)+_0x101af7(0x1f5)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);try{await flushQueue(),await flushQueue(),info(_0x101af7(0x185)+_0x101af7(0x292)+'d.');}catch(_0x2697e1){error(_0x101af7(0x172)+_0x101af7(0x293)+_0x101af7(0x161)+_0x101af7(0x257),_0x2697e1);}if(setStmt){try{await setStmt['finalize']();}catch(_0x83e92c){warn('Error\x20fina'+_0x101af7(0x1e1)+_0x101af7(0x27d)+'g\x20shutdown'+':',_0x83e92c);}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x101af7(0x273)]();}catch(_0x1cced9){warn(_0x101af7(0x1fc)+_0x101af7(0x19b)+'eteStmt\x20du'+'ring\x20shutd'+_0x101af7(0x195),_0x1cced9);}deleteStmt=null;}try{await persistDatabaseToFile();}catch(_0x5a9201){error(_0x101af7(0x2d2)+'isting\x20DB\x20'+_0x101af7(0x250)+'g\x20shutdown'+':',_0x5a9201);}if(adapter){try{await adapter[_0x101af7(0x24c)](),info(_0x101af7(0x230)+_0x101af7(0x1df)+_0x101af7(0x248)+_0x101af7(0x2ac));}catch(_0xc33b1d){error(_0x101af7(0x172)+_0x101af7(0x2d6)+_0x101af7(0x241)+_0x101af7(0x14b),_0xc33b1d);}adapter=null,db=null;}info('Database\x20s'+'hutdown\x20pr'+'ocess\x20comp'+_0x101af7(0x279)+'essfully.');}function _0x1567(_0x3e39ea,_0x452ccf){const _0x3f8a6e=_0x20b2();return _0x1567=function(_0x30f135,_0x59f184){_0x30f135=_0x30f135-(-0x1814+0x897+0x10be);let _0x34b0bd=_0x3f8a6e[_0x30f135];return _0x34b0bd;},_0x1567(_0x3e39ea,_0x452ccf);}async function backupDB(_0x3d3b37){const _0x25be66=_0xf51dba;try{if(!await _0x3dddb5[_0x25be66(0x153)](_0x3d3b37))return;const _0x581a6f=_0x1657dd[_0x25be66(0x235)](_0x3d3b37),_0x49f4b1=_0x1657dd[_0x25be66(0x143)](_0x3d3b37,_0x1657dd['extname'](_0x3d3b37)),_0x5ac9b4=_0x1657dd[_0x25be66(0x207)](_0x581a6f,_0x49f4b1+'.bak'),_0x3a3335=await _0x3dddb5[_0x25be66(0x153)](_0x5ac9b4)?await _0x3dddb5[_0x25be66(0x1cd)](_0x5ac9b4):null,_0x31a5ad=_0x3a3335?Date['now']()-_0x3a3335['mtimeMs']:Infinity;_0x31a5ad>(0x7a*-0x2b+-0xddf*0x1+-0x1*-0x2275)*(-0x2f9+-0xd3*-0x9+-0x7*0x9a)*(0x188c+-0x1*0x7ad+-0x10a3)*(0x333+0x1*0x104f+0x1*-0xf9a)&&(await _0x3dddb5[_0x25be66(0x17b)](_0x3d3b37,_0x5ac9b4,{'overwrite':!![]}),info(_0x25be66(0x147)+'ackup\x20crea'+_0x25be66(0x212)+_0x5ac9b4));}catch(_0x3fef82){error('Database\x20b'+_0x25be66(0x28e)+_0x25be66(0x265)+(_0x3fef82?.[_0x25be66(0x1bc)]||_0x3fef82),_0x3fef82);}}process['once'](_0xf51dba(0x274),()=>{const _0x21904f=_0xf51dba;shutdownDatabase()[_0x21904f(0x1de)](()=>process['exit'](0x2*0x125b+-0x14cb*0x1+-0xfeb));}),process['once'](_0xf51dba(0x1fe),()=>{const _0x3ef7a5=_0xf51dba;shutdownDatabase()[_0x3ef7a5(0x1de)](()=>process[_0x3ef7a5(0x20d)](0x2125*0x1+0x1af2*-0x1+0x211*-0x3));});export{adapter as _adapter};