const _0x46df66=_0x3c96;(function(_0x2439e2,_0xda41a7){const _0x5ad457=_0x3c96,_0x558534=_0x2439e2();while(!![]){try{const _0x629c7a=-parseInt(_0x5ad457(0x1c5))/(-0x127a+-0x422+0x169d)*(-parseInt(_0x5ad457(0x1f7))/(-0x1*-0x17d+-0x3*-0xf3+-0x454))+parseInt(_0x5ad457(0x284))/(-0x6ad*-0x1+0xf78+-0x1622)+-parseInt(_0x5ad457(0x2ec))/(-0x1dd1*-0x1+0x84*0x17+-0x29a9)+parseInt(_0x5ad457(0x2f2))/(-0x2*-0x12ef+-0x4*-0x4e8+-0x3979)*(parseInt(_0x5ad457(0x2df))/(0xc9*-0x29+-0x25e9+0x4620))+-parseInt(_0x5ad457(0x1fd))/(-0xb*-0x2b6+0x25*0xc5+-0x2a6*0x16)+parseInt(_0x5ad457(0x19a))/(-0x9*-0x23b+-0x1e78+-0x1*-0xa6d)*(parseInt(_0x5ad457(0x1a5))/(-0x13b1*0x1+0x13a+0x1280))+-parseInt(_0x5ad457(0x26f))/(0xd0b+0x2388+-0x3089);if(_0x629c7a===_0xda41a7)break;else _0x558534['push'](_0x558534['shift']());}catch(_0x308968){_0x558534['push'](_0x558534['shift']());}}}(_0x415d,-0xf8f46+0xcb08*-0x1+0x1ae0ca));function _0x3c96(_0x7b3700,_0x26abaf){const _0x2aac2c=_0x415d();return _0x3c96=function(_0x7928a1,_0x4e4cfc){_0x7928a1=_0x7928a1-(0x1*-0x925+0x475+0x626);let _0x16551a=_0x2aac2c[_0x7928a1];return _0x16551a;},_0x3c96(_0x7b3700,_0x26abaf);}import _0x2bc17e from'fs-extra';import _0x39cf85 from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;let usingNative=![],setStmt=null,deleteStmt=null,dbReady=![],writeQueue=[],queueBytes=0x1915+0x1*-0x14c6+-0x44f,maxTotalBytes=-0x4ad+-0x743+0xbf0,isFlushing=![],flushTimer=null,cache=null;function estimateQueueItemSize(_0x5b67e1){const _0x973581=_0x3c96,_0x2da034=-0x614*-0x6+-0xebf+-0x1569;switch(_0x5b67e1[_0x973581(0x280)]){case _0x973581(0x1fb):return Buffer[_0x973581(0x187)](_0x5b67e1[_0x973581(0x1c4)],_0x973581(0x206))+Buffer[_0x973581(0x187)](_0x5b67e1['value'],_0x973581(0x206))+_0x2da034;case'delete':return Buffer['byteLength'](_0x5b67e1[_0x973581(0x1c4)],'utf8')+_0x2da034;default:return-0x1141+-0x8a0+-0x1a61*-0x1;}}class MemoryCache{constructor(_0x121915){const _0x586727=_0x3c96;this[_0x586727(0x27b)]=_0x121915,this[_0x586727(0x294)]=0x64d*0x4+-0x13b2*-0x1+-0x2ce6,this[_0x586727(0x1cc)]=new Map(),this[_0x586727(0x247)]={'prev':null,'next':null},this[_0x586727(0x241)]={'prev':null,'next':null},this[_0x586727(0x247)][_0x586727(0x185)]=this[_0x586727(0x241)],this[_0x586727(0x241)][_0x586727(0x1a3)]=this['head'];}static[_0x46df66(0x22f)+'ze'](_0x2c8a92,_0x17bafd){const _0x1e3dc3=_0x46df66,_0x238863=Buffer['byteLength'](String(_0x2c8a92),_0x1e3dc3(0x206)),_0x112c99=Buffer[_0x1e3dc3(0x187)](_0x17bafd??'',_0x1e3dc3(0x206));return _0x238863+_0x112c99+(-0xc*0x2cf+-0x10d*-0x5+0x1cb3);}['_removeNod'+'e'](_0x477538){const _0x1eef44=_0x46df66;_0x477538[_0x1eef44(0x1a3)][_0x1eef44(0x185)]=_0x477538['next'],_0x477538[_0x1eef44(0x185)][_0x1eef44(0x1a3)]=_0x477538[_0x1eef44(0x1a3)];}[_0x46df66(0x180)](_0x259356){const _0x178504=_0x46df66;_0x259356[_0x178504(0x1a3)]=this['tail']['prev'],_0x259356[_0x178504(0x185)]=this['tail'],this[_0x178504(0x241)][_0x178504(0x1a3)]['next']=_0x259356,this[_0x178504(0x241)]['prev']=_0x259356;}[_0x46df66(0x220)+'l'](_0x144332){const _0x59619f=_0x46df66;this['_removeNod'+'e'](_0x144332),this[_0x59619f(0x180)](_0x144332);}['has'](_0x3496d4){const _0x5b0fac=_0x46df66;return this['map'][_0x5b0fac(0x18c)](_0x3496d4);}[_0x46df66(0x2ad)](_0x1a7300){const _0x1623e0=_0x46df66,_0x30260c=this[_0x1623e0(0x1cc)]['get'](_0x1a7300);if(!_0x30260c)return undefined;return this[_0x1623e0(0x220)+'l'](_0x30260c),_0x30260c[_0x1623e0(0x28f)];}['set'](_0x4ec8f5,_0x317515,_0x58ac40){const _0x53bece=_0x46df66,_0x13cf38=this[_0x53bece(0x1cc)]['get'](_0x4ec8f5),_0x4e0468=MemoryCache[_0x53bece(0x22f)+'ze'](_0x4ec8f5,_0x58ac40);if(_0x4e0468>this[_0x53bece(0x27b)]){warn('Skipping\x20c'+_0x53bece(0x210)+_0x53bece(0x307)+'tem\x20\x22'+_0x4ec8f5+_0x53bece(0x27e)+_0x4e0468+(_0x53bece(0x2b4)+'ax\x20')+this[_0x53bece(0x27b)]+')');if(_0x13cf38)this[_0x53bece(0x293)](_0x4ec8f5);return;}if(_0x13cf38)this[_0x53bece(0x294)]-=_0x13cf38[_0x53bece(0x1ce)],_0x13cf38[_0x53bece(0x28f)]=_0x317515,_0x13cf38[_0x53bece(0x283)]=_0x58ac40,_0x13cf38['size']=_0x4e0468,this[_0x53bece(0x294)]+=_0x4e0468,this[_0x53bece(0x220)+'l'](_0x13cf38);else{const _0x2c365d={'key':_0x4ec8f5,'value':_0x317515,'serialized':_0x58ac40,'size':_0x4e0468,'prev':null,'next':null};this[_0x53bece(0x1cc)][_0x53bece(0x1fb)](_0x4ec8f5,_0x2c365d),this[_0x53bece(0x180)](_0x2c365d),this['bytes']+=_0x4e0468;}while(this[_0x53bece(0x294)]>this['maxBytes']){const _0x5b6f19=this[_0x53bece(0x247)][_0x53bece(0x185)];if(_0x5b6f19===this[_0x53bece(0x241)])break;this[_0x53bece(0x293)](_0x5b6f19['key']);}}[_0x46df66(0x293)](_0x2cea0c){const _0x53462a=_0x46df66,_0x624d5a=this['map'][_0x53462a(0x2ad)](_0x2cea0c);if(!_0x624d5a)return;this[_0x53462a(0x194)+'e'](_0x624d5a),this[_0x53462a(0x1cc)][_0x53462a(0x293)](_0x2cea0c),this[_0x53462a(0x294)]-=_0x624d5a['size'];}}function enforceMemoryLimit(){const _0x32fb12=_0x46df66;while(cache&&cache[_0x32fb12(0x294)]+queueBytes>maxTotalBytes&&writeQueue[_0x32fb12(0x260)]>-0x23e9*-0x1+-0x2*-0xc41+-0x3c6b*0x1){const _0x182c7b=writeQueue[_0x32fb12(0x18a)]();if(_0x182c7b[_0x32fb12(0x1ce)])queueBytes-=_0x182c7b[_0x32fb12(0x1ce)];warn(_0x32fb12(0x227)+'e\x20memory\x20p'+_0x32fb12(0x275)+_0x32fb12(0x244)+'est\x20item.\x20'+'Type:\x20'+_0x182c7b[_0x32fb12(0x280)]+_0x32fb12(0x1e8)+(_0x182c7b[_0x32fb12(0x1c4)]||_0x32fb12(0x1e7)));}}function normalizeBindParams(_0x4ea40c){const _0x575c52=_0x46df66;if(!_0x4ea40c||_0x4ea40c['length']===-0x2*-0xfcd+0x4*-0x5e2+-0x812)return undefined;if(_0x4ea40c[_0x575c52(0x260)]===0x96a*-0x1+0x1*-0x4d1+0x2*0x71e&&Array[_0x575c52(0x205)](_0x4ea40c[0xe25+0x233d*-0x1+-0x4*-0x546]))return _0x4ea40c[-0xfc1+0x6*0xa1+0x1*0xbfb];if(_0x4ea40c[_0x575c52(0x260)]===-0x603+-0x213f+0x1b5*0x17&&typeof _0x4ea40c[0x1876+-0x1bb6*-0x1+-0xe*0x3ba]==='object'&&_0x4ea40c[-0x1f4b*0x1+-0x14ea+0x3435]!==null&&!Array[_0x575c52(0x205)](_0x4ea40c[-0xbb*0x1d+0x10ce+-0x461*-0x1]))return _0x4ea40c[-0x14d7+0xb*-0x2d1+0x6*0x8a3];return _0x4ea40c;}function isTableAlreadyExistsError(_0x26cae9){const _0x50ecc4=_0x46df66;try{const _0x5174cc=_0x26cae9&&(_0x26cae9[_0x50ecc4(0x20e)]||String(_0x26cae9))||'';return/table .* already exists/i[_0x50ecc4(0x1c1)](_0x5174cc)||/\balready exists\b/i['test'](_0x5174cc);}catch(_0x574bf0){return![];}}function isUniqueConstraintError(_0x3c1948){const _0x497c9a=_0x46df66;try{const _0x14d3fe=_0x3c1948&&(_0x3c1948[_0x497c9a(0x20e)]||String(_0x3c1948))||'';return/UNIQUE constraint failed/i[_0x497c9a(0x1c1)](_0x14d3fe)||/UNIQUE constraint/i[_0x497c9a(0x1c1)](_0x14d3fe);}catch(_0x550bca){return![];}}function looksLikeSimpleInsert(_0x368611){const _0x1cd0df=_0x46df66;if(!_0x368611||typeof _0x368611!==_0x1cd0df(0x1af))return![];return/^\s*INSERT\s+INTO\s+/i[_0x1cd0df(0x1c1)](_0x368611)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x1cd0df(0x1c1)](_0x368611);}function getUniquePolicy(){const _0xc00bc1=_0x46df66;try{const _0x48128a=getConfig(),_0x206ba5=_0x48128a&&_0x48128a[_0xc00bc1(0x2ea)+_0xc00bc1(0x2ee)+'OLICY']||_0xc00bc1(0x1c7);return String(_0x206ba5)['toLowerCas'+'e']()['trim']();}catch(_0x5b84ea){return _0xc00bc1(0x1c7);}}let dbInitializingPromise=null,reinitBackoffMs=0x1*-0xb34+0x13e2+-0x4c6;const MAX_REINIT_BACKOFF_MS=(0x20cf+-0x11*-0xf1+-0x3094)*(0xff6+0x4*0x244+0x151e*-0x1);function isDbClosedError(_0x5894eb){const _0x1a320a=_0x46df66;if(!_0x5894eb)return![];const _0x3ae0bc=String(_0x5894eb[_0x1a320a(0x20e)]||_0x5894eb||'');if(/database is closed/i[_0x1a320a(0x1c1)](_0x3ae0bc))return!![];if(/SQLITE_MISUSE/i[_0x1a320a(0x1c1)](_0x3ae0bc))return!![];if(_0x5894eb&&typeof _0x5894eb['code']===_0x1a320a(0x1af)&&_0x5894eb[_0x1a320a(0x1b1)][_0x1a320a(0x1fa)+'e']()['includes'](_0x1a320a(0x2c1)))return/SQLITE_MISUSE|SQLITE_IOERR|SQLITE_MISUSE/i[_0x1a320a(0x1c1)](_0x5894eb['code']);return![];}async function scheduleReinitializeAfterError(_0x900bf6){const _0x469956=_0x46df66;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;const _0x2d7a1c=Math[_0x469956(0x1b5)](reinitBackoffMs,MAX_REINIT_BACKOFF_MS);return warn(_0x469956(0x209)+_0x469956(0x2bc)+_0x469956(0x22c)+_0x469956(0x2e8)+_0x2d7a1c+(_0x469956(0x23c)+_0x469956(0x21d))+(_0x900bf6?.[_0x469956(0x20e)]||_0x900bf6)),dbInitializingPromise=((async()=>{const _0x2281db=_0x469956;await new Promise(_0x45ff47=>setTimeout(_0x45ff47,_0x2d7a1c));try{await initializeDatabase(),info('DB\x20reiniti'+_0x2281db(0x17d)+_0x2281db(0x1e2)+_0x2281db(0x261)+_0x2281db(0x22a)),reinitBackoffMs=-0xb0f+-0x32a+0x1221;}catch(_0x575f87){error(_0x2281db(0x215)+_0x2281db(0x23a)+_0x2281db(0x258)+_0x2281db(0x2c7),_0x575f87),reinitBackoffMs=Math[_0x2281db(0x1b5)](MAX_REINIT_BACKOFF_MS,reinitBackoffMs*(0x1*-0x2471+0x148f+0xfe4));try{await scheduleReinitializeAfterError(_0x575f87);}catch(_0x561bd9){}}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function _0x415d(){const _0x47b69b=['B\x20(no\x20file','ive_groups','unshift','ted\x20closed','cuting\x20(sq','Database\x20b','Retry\x20succ','1164354nieyvn','\x20while\x20exe','\x20\x20name\x20TEX','resolve','eue\x20item\x20t','NULL\x0a\x20\x20\x20\x20)','\x20failed,\x20r','\x20item,\x20wil','ll\x20attempt','\x20in\x20','g\x20INSERT\x20O','DB_UNIQUE_','e\x20TEXT);','66228AyjXdj','s):\x20','CONFLICT_P','ocess\x20comp','finally','\x20to\x20prepar','15ZkTOss','\x20NULL\x20DEFA','export','ype\x20during','reset','l\x20be\x20handl','from','g\x20persist.','abaseToFil','h\x20complete','\x20DB;\x20sched','Failed\x20to\x20','LE\x20IF\x20NOT\x20','me\x20TEXT\x20NO','areStateme','et()\x20(poli','process\x20DB','exit','SIGTERM','t\x20availabl','e\x20failed\x20d','versized\x20i','_PATH','g:\x20','ve\x20sqlite3','dist','\x22\x20is\x20not\x20s','file\x20into\x20','cwd','ed\x20by\x20tran','l\x20attempt\x20','CREATE\x20TAB',';\x0a\x20\x20','d)\x0a\x20\x20\x20\x20);\x0a','Y\x20KEY,\x20mod','ll()\x20(poli','\x20active_st','anly.','heduling\x20r','EXT,\x0a\x20\x20\x20\x20\x20','ng\x20final\x20d',',\x20message\x20','sql.js','step','writeFile','\x20to\x20be\x20clo','eue:','catch','alized\x20aut','.db','e):\x20','_addToTail','nt\x20(native','ite\x20init\x20f','L\x20error\x20(t','S\x20user_act','next','ng\x20flushQu','byteLength','reduce','ons\x20(\x0a\x20\x20\x20\x20','shift','push','has','\x20NORMAL;','Database\x20c','retries','S\x20connecti','prepare\x20st','ignore)\x20wh','deleteStmt','_removeNod','\x20\x20\x20\x20\x20group','ion\x20proces','CREATE\x20UNI','database.s','ed\x20flushQu','15632pidpTL','native\x20sql','IQUE\x20const','\x20TEXT\x20NOT\x20','prepare\x20DB','\x20\x20\x20id\x20INTE','iated.\x20Flu','eteStmt\x20du','lback\x20fail','prev','ERE\x20key\x20=\x20','4446bTJQpa','DB_FLUSH_I','\x20reinitial','ssing','move','DB_PATH','(sql.js).','=\x2010000;','SELECT\x201;','se\x20DB\x20is\x20c','string','adapter\x20no','code','SELECT\x20val','persist\x20DB','T\x20NULL\x20DEF','min','g\x20(native)','ULT\x20\x27\x27,\x0a\x20\x20','\x20NOT\x20EXIST','INSERT\x20OR\x20','yMigration','PRAGMA\x20jou','open','S\x20active_s','prepare','ed\x20stateme','DB\x20appears','test','stringify','run','key','7LIUawA','\x20missing','ignore','B\x20statemen','dy\x20exists)','Error\x20fina','SQLJS_WASM','map','AX_BYTES','size','sed\x20during','Loaded\x20DB\x20','[]\x27,\x0a\x20\x20\x20\x20\x20','DB_NAME','SACTION;','e...','lay_name\x20T','able\x20alrea','TO\x20key_val','chronous\x20=','pathExists','bind','\x20\x20\x20\x20timefr','function','ements.\x20Sc','\x22\x20from\x20DB:','le\x20failure','getRowsMod','ts.','omatically','RIMARY\x20KEY','get\x20key\x20\x22','own:','R\x0a\x20\x20\x20\x20);\x0a\x20','N/A',',\x20Key:\x20','ile\x20execut','\x20\x20\x20user_ji','ter\x20multip','EXISTS\x20key','\x20(non-fata','DB\x20closed\x20','COMMIT;','ue\x20to\x20clos','\x20statement','g\x20shutdown','faults\x20(\x0a\x20','hat_id\x20TEX','PRAGMA\x20for','ile\x20runnin','14294ALuMPi','free','R\x20REPLACE\x20','toUpperCas','set','Database\x20s','5497408kQhNia','\x27,\x0a\x20\x20\x20\x20\x20\x20c','ailed:','all','s\x20started.','iled\x20becau','\x20NULL,\x0a\x20\x20\x20','ed\x20because','isArray','utf8','hutdown\x20pr','ization.','Scheduling','Database\x20i','eeded\x20usin','ring\x20shutd','Database','message','ROLLBACK;','ache\x20for\x20o','essfully.','eduling\x20re','finalize','?,\x20?)','Automatic\x20','hQueue:','tive_stats','E\x20TABLE\x20IF','PROJECT_RO','REPLACE\x20IN','raint\x20erro','w\x20in-memor','error:\x20','Using\x20SQL.','nts()','_moveToTai','olling\x20bac','losed.','\x22:\x20','slice','exec','red\x20by\x20set','Write\x20queu','level\x20TEXT','red\x20statem','or.','\x20\x20\x20\x20PRIMAR','ialization','for\x20prepar','SQL.js\x20fal','estimateSi','PRAGMA\x20bus','e:\x20adapter','ry.','getAsObjec','replace','saction\x20ro','d\x20TEXT\x20NOT','e;\x20skippin','r\x20(policy=','einit.','DB\x20reiniti','atements\x20b','ms\x20due\x20to\x20','_id\x20TEXT\x20P','nitializat','onnection\x20','EFAULT\x200,\x0a','tail','r\x20in\x20prepa','r\x20commit:','ropped\x20old','BEGIN\x20TRAN','No\x20adapter','head','ng\x20final\x20f','prepareSta','while\x20prep','Unknown\x20qu','ted\x20INTEGE','ocess\x20init','aring\x20stat','DB\x20not\x20rea','DB\x20item\x20di',').\x20Backing','NTERVAL','Database\x20p','red\x20by\x20del','tats\x20(\x0a\x20\x20\x20','persistDat','mtimeMs','alization\x20','_unique\x20ON','it.','\x20\x20\x20\x20\x20bucke','js\x20(WASM)\x20','ame\x20TEXT\x20N','ser_key\x20TE','llback:\x20','length','\x20after\x20err','Native\x20sql','():','S\x20group_de','now','k.\x20Prepari','y_timeout\x20','eign_keys\x20','ping\x20error','PRAGMA\x20syn','extname','EXISTS\x20log','eue\x20trigge','\x20DB\x20is\x20clo','5302370lNMOdG','l.js):\x20','ackup\x20crea','once','error\x20duri','\x0a\x20\x20\x20\x20CREAT','ressure:\x20D','DB\x20health\x20','\x20file:\x20','e\x20for\x20prep','readFile','s.\x20Item:\x20','maxBytes','rnal_mode\x20','XT\x20PRIMARY','\x22\x20(','basename','type','\x20INTEGER\x20D','cy=ignore)','serialized','1273332kQpMNN','default','STS\x20idx_ac','ror:\x20','\x20file\x20afte','ent\x20(polic','AULT\x20\x27[]\x27\x0a','t_key);','efore\x20flus','uling\x20rein','ed\x20DB.\x20Sch','value','max','ite3',',\x0a\x20\x20\x20\x20\x20\x20na','delete','bytes','adapter.','l):','get()\x20fail','=\x20ON;','\x20last_upda','close','DB_CACHE_M','\x20creator_i','ping\x20detec','\x20\x20\x20chat_ji','sed.\x20Sched','CRITICAL:\x20','QUE\x20INDEX\x20','ts\x20(set/de','timestamp','lizing\x20del','lush\x20attem','Ignored\x20UN','parse','qlite','\x20DEFAULT\x20\x27','.tmp','Error\x20pers','DELETE\x20FRO','get','Ignored\x20SQ','setStmt\x20mi','dirname','Prepared\x20D','isting\x20DB\x20','Value\x20for\x20','\x20bytes\x20>\x20m','s()','Error\x20duri','Rollback\x20f','ue\x20FROM\x20ke','e\x20statemen','Created\x20ne','=\x20WAL;','\x20DB\x20reinit','id,\x20timefr','T\x20NOT\x20NULL','node_modul','(native).','SQLITE','\x20(\x0a\x20\x20\x20\x20\x20\x20u','s\x20ok','nitialized','erializabl','DB_BATCH_S','failed:','re\x20(key\x20TE','lback.\x20','\x20KEY,\x0a\x20\x20\x20\x20','scarded\x20af','SIGINT','shing\x20queu','ified','tive):\x20','ailed,\x20wil','r\x20key\x20\x22','join','IZE','closed\x20cle','\x20flush:\x20','\x20driver.','ed:'];_0x415d=function(){return _0x47b69b;};return _0x415d();}function createNativeAdapter(_0x2990f6){return{'_underlying':_0x2990f6,async 'exec'(_0x4370ae){const _0x269322=_0x3c96;try{await _0x2990f6[_0x269322(0x225)](_0x4370ae);return;}catch(_0x21c928){if(isTableAlreadyExistsError(_0x21c928)){warn(_0x269322(0x2ae)+_0x269322(0x183)+_0x269322(0x1d6)+_0x269322(0x1c9)+_0x269322(0x2e0)+'cuting\x20(na'+_0x269322(0x2cf)+String(_0x4370ae)[_0x269322(0x224)](0x2692+0xa7*-0x7+-0x2201,0xeb*-0x1+-0x11c1*0x2+-0x799*-0x5));return;}if(isUniqueConstraintError(_0x21c928)){const _0x4492ac=getUniquePolicy();if(_0x4492ac===_0x269322(0x1c7)){debug(_0x269322(0x2a6)+_0x269322(0x19c)+_0x269322(0x21b)+_0x269322(0x238)+'ignore)\x20wh'+_0x269322(0x1e9)+'ing\x20(nativ'+_0x269322(0x17f)+String(_0x4370ae)[_0x269322(0x224)](-0x1f6+-0xf2e+0x1124,0x879+0x1796+-0x1e7f));return;}if(_0x4492ac===_0x269322(0x234)&&looksLikeSimpleInsert(_0x4370ae)){const _0xc8b938=_0x4370ae['replace'](/^\s*INSERT\s+INTO/i,_0x269322(0x1b9)+_0x269322(0x21a)+'TO');try{await _0x2990f6['exec'](_0xc8b938);return;}catch(_0x35107d){throw _0x35107d;}}}throw _0x21c928;}},async 'get'(_0x419d6a,..._0xbb64d1){const _0x104bbd=_0x3c96;try{const _0x440dbd=normalizeBindParams(_0xbb64d1);if(_0x440dbd===undefined)return await _0x2990f6[_0x104bbd(0x2ad)](_0x419d6a);return await _0x2990f6['get'](_0x419d6a,_0x440dbd);}catch(_0x35f847){throw _0x35f847;}},async 'all'(_0x383373,..._0x2a5dc3){const _0x56360c=_0x3c96;try{const _0x305532=normalizeBindParams(_0x2a5dc3);if(_0x305532===undefined)return await _0x2990f6[_0x56360c(0x200)](_0x383373);return await _0x2990f6[_0x56360c(0x200)](_0x383373,_0x305532);}catch(_0x5773e6){throw _0x5773e6;}},async 'run'(_0xf482cb,..._0x4c73de){const _0x297685=_0x3c96;try{const _0x57776c=normalizeBindParams(_0x4c73de);let _0x5357dd;return _0x57776c===undefined?_0x5357dd=await _0x2990f6[_0x297685(0x1c3)](_0xf482cb):_0x5357dd=await _0x2990f6[_0x297685(0x1c3)](_0xf482cb,_0x57776c),_0x5357dd;}catch(_0x3bbbe3){if(isUniqueConstraintError(_0x3bbbe3)){const _0x3f51e4=getUniquePolicy();if(_0x3f51e4===_0x297685(0x1c7))return debug('Ignored\x20UN'+_0x297685(0x19c)+_0x297685(0x21b)+'r\x20(policy='+_0x297685(0x192)+_0x297685(0x1f6)+_0x297685(0x1b6)+':\x20'+String(_0xf482cb)[_0x297685(0x224)](0x30*0x24+-0x6e2+-0x11*-0x2,-0x469*-0x7+-0x7*0x55b+0x417*0x2)),undefined;if(_0x3f51e4===_0x297685(0x234)&&looksLikeSimpleInsert(_0xf482cb)){const _0x1cd4aa=_0xf482cb[_0x297685(0x234)](/^\s*INSERT\s+INTO/i,_0x297685(0x1b9)+_0x297685(0x21a)+'TO'),_0x14beb4=normalizeBindParams(_0x4c73de);try{let _0xbb17af;if(_0x14beb4===undefined)_0xbb17af=await _0x2990f6['run'](_0x1cd4aa);else _0xbb17af=await _0x2990f6[_0x297685(0x1c3)](_0x1cd4aa,_0x14beb4);return info(_0x297685(0x2de)+_0x297685(0x20b)+'g\x20INSERT\x20O'+_0x297685(0x1f9)+_0x297685(0x2c0)),_0xbb17af;}catch(_0x17f47a){throw _0x17f47a;}}}throw _0x3bbbe3;}},async 'prepare'(_0x4aab52){const _0x5cca62=await _0x2990f6['prepare'](_0x4aab52);return{async 'run'(..._0x3d4988){const _0x440951=_0x3c96,_0xe7740b=normalizeBindParams(_0x3d4988);try{let _0x5106ec;if(_0xe7740b===undefined)_0x5106ec=await _0x5cca62[_0x440951(0x1c3)]();else _0x5106ec=await _0x5cca62[_0x440951(0x1c3)](_0xe7740b);return _0x5106ec;}catch(_0x13be8d){if(isUniqueConstraintError(_0x13be8d)){const _0x2dae57=getUniquePolicy();if(_0x2dae57===_0x440951(0x1c7))return debug(_0x440951(0x2a6)+'IQUE\x20const'+_0x440951(0x21b)+_0x440951(0x238)+'ignore)\x20in'+'\x20prepared\x20'+'statement\x20'+'(native):\x20'+_0x4aab52),undefined;if(_0x2dae57===_0x440951(0x234)&&looksLikeSimpleInsert(_0x4aab52)){const _0x11cfef=_0x4aab52[_0x440951(0x234)](/^\s*INSERT\s+INTO/i,_0x440951(0x1b9)+_0x440951(0x21a)+'TO'),_0x1ab349=await _0x2990f6['prepare'](_0x11cfef);try{let _0x129cd6;if(_0xe7740b===undefined)_0x129cd6=await _0x1ab349[_0x440951(0x1c3)]();else _0x129cd6=await _0x1ab349[_0x440951(0x1c3)](_0xe7740b);return await _0x1ab349[_0x440951(0x213)](),info('Retry\x20succ'+_0x440951(0x20b)+_0x440951(0x2e9)+_0x440951(0x1f9)+_0x440951(0x22d)+_0x440951(0x1bf)+_0x440951(0x181)+').'),_0x129cd6;}catch(_0x3946c1){try{await _0x1ab349[_0x440951(0x213)]();}catch(_0x32b129){}throw _0x3946c1;}}}throw _0x13be8d;}},async 'finalize'(){try{await _0x5cca62['finalize']();}catch(_0xbac203){}}};},async 'close'(){const _0x1ea925=_0x3c96;try{await _0x2990f6[_0x1ea925(0x29a)]();}catch(_0x49d3ac){}},'export'(){return undefined;}};}function createSQLjsAdapter(_0x2998b5){const _0x399506=_0x2998b5;return{'_underlying':_0x399506,async 'exec'(_0x7266fa){const _0x572d57=_0x3c96;try{_0x399506[_0x572d57(0x1c3)](_0x7266fa);return;}catch(_0x3bd252){if(isTableAlreadyExistsError(_0x3bd252)){warn('Ignored\x20SQ'+_0x572d57(0x183)+_0x572d57(0x1d6)+_0x572d57(0x1c9)+_0x572d57(0x2e0)+_0x572d57(0x2dc)+_0x572d57(0x270)+String(_0x7266fa)[_0x572d57(0x224)](0xb82*0x3+-0x1563+0x3b*-0x39,-0x1*-0xb9+0x1222+-0x114b));return;}if(isUniqueConstraintError(_0x3bd252)){const _0x56dbbe=getUniquePolicy();if(_0x56dbbe==='ignore'){debug(_0x572d57(0x2a6)+_0x572d57(0x19c)+_0x572d57(0x21b)+_0x572d57(0x238)+_0x572d57(0x192)+'ile\x20execut'+'ing\x20(sql.j'+_0x572d57(0x2ed)+String(_0x7266fa)[_0x572d57(0x224)](0xfd8+-0x19c+-0xe3c,0x211a+0x212+0x867*-0x4));return;}if(_0x56dbbe===_0x572d57(0x234)&&looksLikeSimpleInsert(_0x7266fa)){const _0x5d6314=_0x7266fa[_0x572d57(0x234)](/^\s*INSERT\s+INTO/i,_0x572d57(0x1b9)+_0x572d57(0x21a)+'TO');try{_0x399506['run'](_0x5d6314);return;}catch(_0x5fe1ba){throw _0x5fe1ba;}}}throw _0x3bd252;}},async 'get'(_0x37e132,..._0x32c707){const _0x1c8f90=_0x3c96;try{const _0x484cca=_0x399506[_0x1c8f90(0x1be)](_0x37e132);try{const _0x3b881e=normalizeBindParams(_0x32c707);if(_0x3b881e!==undefined)_0x484cca[_0x1c8f90(0x1da)](_0x3b881e);if(_0x484cca['step']()){const _0x4d3704=_0x484cca['getAsObjec'+'t']();return _0x484cca[_0x1c8f90(0x1f8)](),_0x4d3704;}else return _0x484cca['free'](),undefined;}catch(_0x9c6cc7){try{_0x484cca['free']();}catch(_0x3f6912){}if(isUniqueConstraintError(_0x9c6cc7)){const _0x4d65e2=getUniquePolicy();if(_0x4d65e2===_0x1c8f90(0x1c7))return debug('Ignored\x20UN'+'IQUE\x20const'+'raint\x20erro'+'r\x20during\x20g'+_0x1c8f90(0x301)+_0x1c8f90(0x282)+':\x20'+_0x37e132),undefined;}throw _0x9c6cc7;}}catch(_0x177fdd){throw _0x177fdd;}},async 'all'(_0x4e9b67,..._0x24df3e){const _0x2bb66e=_0x3c96;try{const _0x324c1e=_0x399506['prepare'](_0x4e9b67),_0xd30504=[];try{const _0x494120=normalizeBindParams(_0x24df3e);if(_0x494120!==undefined)_0x324c1e[_0x2bb66e(0x1da)](_0x494120);while(_0x324c1e[_0x2bb66e(0x178)]())_0xd30504[_0x2bb66e(0x18b)](_0x324c1e[_0x2bb66e(0x233)+'t']());return _0x324c1e[_0x2bb66e(0x1f8)](),_0xd30504;}catch(_0x28af82){try{_0x324c1e[_0x2bb66e(0x1f8)]();}catch(_0x4bf0af){}if(isUniqueConstraintError(_0x28af82)){const _0x18b179=getUniquePolicy();if(_0x18b179===_0x2bb66e(0x1c7))return debug(_0x2bb66e(0x2a6)+_0x2bb66e(0x19c)+_0x2bb66e(0x21b)+'r\x20during\x20a'+_0x2bb66e(0x315)+_0x2bb66e(0x282)+':\x20'+_0x4e9b67),_0xd30504;}throw _0x28af82;}}catch(_0x3fe80a){throw _0x3fe80a;}},async 'run'(_0x1d8434,..._0x3c823a){const _0x333e61=_0x3c96;try{const _0x12d50f=normalizeBindParams(_0x3c823a);if(_0x12d50f===undefined){_0x399506[_0x333e61(0x1c3)](_0x1d8434);const _0x156c60=typeof _0x399506[_0x333e61(0x1e0)+'ified']===_0x333e61(0x1dc)?_0x399506[_0x333e61(0x1e0)+_0x333e61(0x2ce)]():undefined;return _0x156c60!==undefined?{'changes':_0x156c60}:undefined;}else{const _0x3e68a1=_0x399506[_0x333e61(0x1be)](_0x1d8434);try{_0x3e68a1[_0x333e61(0x1da)](_0x12d50f),_0x3e68a1['run'](),_0x3e68a1['free']();const _0x5ca5ae=typeof _0x399506['getRowsMod'+_0x333e61(0x2ce)]===_0x333e61(0x1dc)?_0x399506[_0x333e61(0x1e0)+_0x333e61(0x2ce)]():undefined;return _0x5ca5ae!==undefined?{'changes':_0x5ca5ae}:undefined;}catch(_0xc46e0a){try{_0x3e68a1['free']();}catch(_0x500290){}if(isUniqueConstraintError(_0xc46e0a)){const _0x41a8d5=getUniquePolicy();if(_0x41a8d5===_0x333e61(0x1c7))return debug(_0x333e61(0x2a6)+_0x333e61(0x19c)+_0x333e61(0x21b)+'r\x20(policy='+_0x333e61(0x192)+_0x333e61(0x1f6)+_0x333e61(0x309)+String(_0x1d8434)[_0x333e61(0x224)](0x17a7+0x5d*-0x1b+-0xdd8,-0x1e*0x1+-0x1b31*0x1+0x1cdf)),undefined;if(_0x41a8d5==='replace'&&looksLikeSimpleInsert(_0x1d8434)){const _0x381f78=_0x1d8434[_0x333e61(0x234)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x333e61(0x21a)+'TO'),_0x28938e=_0x399506[_0x333e61(0x1be)](_0x381f78);try{_0x28938e[_0x333e61(0x1da)](_0x12d50f),_0x28938e[_0x333e61(0x1c3)](),_0x28938e[_0x333e61(0x1f8)](),info(_0x333e61(0x2de)+_0x333e61(0x20b)+'g\x20INSERT\x20O'+_0x333e61(0x1f9)+'for\x20run()\x20'+_0x333e61(0x1ab));const _0x565427=typeof _0x399506['getRowsMod'+_0x333e61(0x2ce)]==='function'?_0x399506[_0x333e61(0x1e0)+_0x333e61(0x2ce)]():undefined;return _0x565427!==undefined?{'changes':_0x565427}:undefined;}catch(_0x7d1ad6){try{_0x28938e[_0x333e61(0x1f8)]();}catch(_0x2cd8fe){}throw _0x7d1ad6;}}}throw _0xc46e0a;}}}catch(_0x104e58){throw _0x104e58;}},async 'prepare'(_0x29b091){const _0x15915e=_0x3c96;try{const _0xe68b5=_0x399506[_0x15915e(0x1be)](_0x29b091);return{async 'run'(..._0x3e0fc3){const _0x1c566d=_0x15915e;try{const _0x21d75a=normalizeBindParams(_0x3e0fc3);if(_0x21d75a!==undefined)_0xe68b5[_0x1c566d(0x1da)](_0x21d75a);_0xe68b5['run']();try{_0xe68b5[_0x1c566d(0x2f6)]();}catch(_0x3e8df2){}const _0x3296c8=typeof _0x399506[_0x1c566d(0x1e0)+'ified']==='function'?_0x399506['getRowsMod'+_0x1c566d(0x2ce)]():undefined;return _0x3296c8!==undefined?{'changes':_0x3296c8}:undefined;}catch(_0x4bc5aa){if(isUniqueConstraintError(_0x4bc5aa)){const _0xdcdc75=getUniquePolicy();if(_0xdcdc75===_0x1c566d(0x1c7))return debug(_0x1c566d(0x2a6)+'IQUE\x20const'+_0x1c566d(0x21b)+_0x1c566d(0x242)+_0x1c566d(0x229)+_0x1c566d(0x289)+'y=ignore):'+'\x20'+_0x29b091),undefined;if(_0xdcdc75===_0x1c566d(0x234)&&looksLikeSimpleInsert(_0x29b091)){const _0x13986e=_0x29b091[_0x1c566d(0x234)](/^\s*INSERT\s+INTO/i,'INSERT\x20OR\x20'+_0x1c566d(0x21a)+'TO'),_0x266f2e=_0x399506[_0x1c566d(0x1be)](_0x13986e);try{const _0x54164d=normalizeBindParams(_0x3e0fc3);if(_0x54164d!==undefined)_0x266f2e[_0x1c566d(0x1da)](_0x54164d);_0x266f2e['run'](),_0x266f2e[_0x1c566d(0x1f8)](),info(_0x1c566d(0x2de)+'eeded\x20usin'+_0x1c566d(0x2e9)+_0x1c566d(0x1f9)+_0x1c566d(0x22d)+'ed\x20stateme'+'nt\x20(sql.js'+').');const _0x43ccb2=typeof _0x399506[_0x1c566d(0x1e0)+_0x1c566d(0x2ce)]===_0x1c566d(0x1dc)?_0x399506[_0x1c566d(0x1e0)+_0x1c566d(0x2ce)]():undefined;return _0x43ccb2!==undefined?{'changes':_0x43ccb2}:undefined;}catch(_0x40d7ab){try{_0x266f2e['free']();}catch(_0x734af5){}throw _0x40d7ab;}}}throw _0x4bc5aa;}},async 'finalize'(){try{_0xe68b5['free']();}catch(_0x318ed1){}}};}catch(_0x3a9920){throw _0x3a9920;}},'export'(){try{return _0x399506['export']();}catch(_0x74c8dc){throw _0x74c8dc;}},async 'close'(){const _0x151e5f=_0x3c96;try{if(typeof _0x399506[_0x151e5f(0x29a)]===_0x151e5f(0x1dc))_0x399506[_0x151e5f(0x29a)]();else{if(typeof _0x399506['free']===_0x151e5f(0x1dc))_0x399506[_0x151e5f(0x1f8)]();}}catch(_0x1375a6){}}};}export async function initializeDatabase(){const _0x2d8f5c=_0x46df66;info('Database\x20i'+_0x2d8f5c(0x23e)+_0x2d8f5c(0x196)+_0x2d8f5c(0x201)+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x3761f7=getConfig();maxTotalBytes=_0x3761f7[_0x2d8f5c(0x29b)+_0x2d8f5c(0x1cd)]||(-0xd98*-0x1+-0x361+-0xa05)*(-0xd96+-0x1279*-0x1+-0xe3*0x1)*(-0xb99+0x29*0xb6+0x1*-0xd8d),cache=new MemoryCache(maxTotalBytes||(0xca3+-0x915+-0x1*0x35c)*(0x27*0xef+0x1*-0x1d23+-0x346)*(-0x28*-0x53+0x208b+-0x2983*0x1));const _0x3f754c=_0x3761f7[_0x2d8f5c(0x219)+'OT']||process[_0x2d8f5c(0x30e)](),_0x4c6ec6=_0x39cf85[_0x2d8f5c(0x2e2)](_0x3f754c,_0x3761f7[_0x2d8f5c(0x1aa)]||_0x2d8f5c(0x17e));await _0x2bc17e['ensureDir'](_0x4c6ec6);const _0x269974=_0x3761f7[_0x2d8f5c(0x1d2)]||'database.s'+_0x2d8f5c(0x2a8),_0x4eeada=_0x39cf85['join'](_0x4c6ec6,_0x269974);let _0x5bdcaa=![];try{let _0x58b9b8=null,_0x4c8add=null;try{_0x58b9b8=await import('sqlite3'),_0x4c8add=(await import('sqlite'))[_0x2d8f5c(0x1bc)];}catch(_0x161b9e){_0x58b9b8=null,_0x4c8add=null;}if(_0x58b9b8&&_0x4c8add){await backupDB(_0x4eeada);const _0x2d7ec6=_0x58b9b8['default']||_0x58b9b8,_0xa94185=await _0x4c8add({'filename':_0x4eeada,'driver':_0x2d7ec6['Database']});try{await _0xa94185[_0x2d8f5c(0x225)](_0x2d8f5c(0x1bb)+_0x2d8f5c(0x27c)+_0x2d8f5c(0x2bb));}catch(_0x2f519d){}try{await _0xa94185['exec'](_0x2d8f5c(0x26a)+_0x2d8f5c(0x1d8)+_0x2d8f5c(0x18d));}catch(_0x1666e5){}try{await _0xa94185['exec']('PRAGMA\x20bus'+_0x2d8f5c(0x267)+_0x2d8f5c(0x1ac));}catch(_0x16e88a){}try{await _0xa94185[_0x2d8f5c(0x225)](_0x2d8f5c(0x1f5)+_0x2d8f5c(0x268)+_0x2d8f5c(0x298));}catch(_0x207f90){}adapter=createNativeAdapter(_0xa94185),db=adapter,usingNative=!![],_0x5bdcaa=!![],info('Using\x20nati'+_0x2d8f5c(0x30a)+_0x2d8f5c(0x2d6));}}catch(_0x18eb4c){warn(_0x2d8f5c(0x262)+_0x2d8f5c(0x182)+_0x2d8f5c(0x2d0)+_0x2d8f5c(0x310)+'SQL.js\x20fal'+_0x2d8f5c(0x2c9)+(_0x18eb4c?.[_0x2d8f5c(0x20e)]||_0x18eb4c)),_0x5bdcaa=![],adapter=null,db=null,usingNative=![];}if(!_0x5bdcaa)try{const _0x47d331=await import('sql.js'),_0x85c0da=_0x47d331[_0x2d8f5c(0x285)]||_0x47d331,_0x58c883=await _0x85c0da({'locateFile':_0x5ff5dc=>{const _0x95d4b7=_0x2d8f5c,_0x7555c1=_0x3761f7[_0x95d4b7(0x1cb)+_0x95d4b7(0x308)];if(_0x7555c1)return _0x7555c1;return _0x39cf85['join'](process[_0x95d4b7(0x30e)](),_0x95d4b7(0x2bf)+'es',_0x95d4b7(0x177),_0x95d4b7(0x30b),_0x5ff5dc);}});let _0x1d7ef0;if(await _0x2bc17e[_0x2d8f5c(0x1d9)](_0x4eeada)){const _0x124370=await _0x2bc17e[_0x2d8f5c(0x279)](_0x4eeada),_0x2fdff8=new Uint8Array(_0x124370);_0x1d7ef0=new _0x58c883[(_0x2d8f5c(0x20d))](_0x2fdff8),info(_0x2d8f5c(0x1d0)+_0x2d8f5c(0x30d)+'SQL.js\x20fro'+'m\x20'+_0x4eeada);}else _0x1d7ef0=new _0x58c883[(_0x2d8f5c(0x20d))](),info(_0x2d8f5c(0x2ba)+_0x2d8f5c(0x21c)+'y\x20SQL.js\x20D'+_0x2d8f5c(0x2d8)+'\x20present)');adapter=createSQLjsAdapter(_0x1d7ef0),db=adapter,usingNative=![],info(_0x2d8f5c(0x21e)+_0x2d8f5c(0x25c)+_0x2d8f5c(0x295));}catch(_0x1cab15){error(_0x2d8f5c(0x22e)+_0x2d8f5c(0x1a2)+_0x2d8f5c(0x2d7),_0x1cab15);throw _0x1cab15;}try{if(adapter&&typeof adapter[_0x2d8f5c(0x225)]===_0x2d8f5c(0x1dc))await adapter['exec'](_0x2d8f5c(0x1f5)+_0x2d8f5c(0x268)+_0x2d8f5c(0x298));}catch(_0x2c9fd6){}try{if(adapter&&typeof adapter[_0x2d8f5c(0x225)]===_0x2d8f5c(0x1dc))await adapter[_0x2d8f5c(0x225)](_0x2d8f5c(0x230)+_0x2d8f5c(0x267)+'=\x2010000;');}catch(_0x362a54){}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[],queueBytes=queueBytes||-0xa*-0xd1+-0x4*-0x7b+-0x50b*0x2;const _0x3ad936=_0x3761f7[_0x2d8f5c(0x1a6)+_0x2d8f5c(0x252)]||-0x9b9*-0x2+0x1a*-0x7a+0xc2;flushTimer=setInterval(()=>{const _0x500f30=_0x2d8f5c;flushQueue()[_0x500f30(0x17c)](_0x4e8446=>error('Unhandled\x20'+_0x500f30(0x273)+'ng\x20schedul'+_0x500f30(0x199)+_0x500f30(0x17b),_0x4e8446));},_0x3ad936),info(_0x2d8f5c(0x20a)+_0x2d8f5c(0x2c4)+'\x20('+(usingNative?_0x2d8f5c(0x19b)+_0x2d8f5c(0x291):'SQL.js')+(_0x2d8f5c(0x251)+_0x2d8f5c(0x277))+_0x4eeada);try{(function _0x374ee1(){setTimeout(async()=>{const _0x5c5c30=_0x3c96;try{if(!dbReady||!adapter)return _0x374ee1();if(adapter&&typeof adapter[_0x5c5c30(0x2ad)]===_0x5c5c30(0x1dc))try{await adapter[_0x5c5c30(0x2ad)]('SELECT\x201\x20a'+_0x5c5c30(0x2c3));}catch(_0x48518d){throw _0x48518d;}else{if(adapter&&typeof adapter[_0x5c5c30(0x225)]==='function')try{await adapter[_0x5c5c30(0x225)](_0x5c5c30(0x1ad));}catch(_0x2d45fe){throw _0x2d45fe;}}}catch(_0x54ab87){isDbClosedError(_0x54ab87)?(warn(_0x5c5c30(0x276)+_0x5c5c30(0x29d)+_0x5c5c30(0x2db)+_0x5c5c30(0x2fc)+_0x5c5c30(0x28d)+_0x5c5c30(0x25a)),await scheduleReinitializeAfterError(_0x54ab87)):debug(_0x5c5c30(0x276)+_0x5c5c30(0x269)+_0x5c5c30(0x1ed)+_0x5c5c30(0x296),_0x54ab87?.[_0x5c5c30(0x20e)]||_0x54ab87);}finally{_0x374ee1();}},(-0x1b85+0xc34+0x3*0x52f)*(0x382+0x59*0x1d+-0x25*0x43));}());}catch(_0x47dd94){}}catch(_0x4110f2){error('DB\x20init\x20er'+_0x2d8f5c(0x287)+(_0x4110f2?.['message']||_0x4110f2),_0x4110f2);throw _0x4110f2;}}async function prepareStatements(){const _0x4f770a=_0x46df66;if(!adapter)throw new Error(_0x4f770a(0x1b0)+_0x4f770a(0x305)+_0x4f770a(0x278)+_0x4f770a(0x300)+_0x4f770a(0x21f));if(setStmt){try{await setStmt[_0x4f770a(0x213)]();}catch(_0x541e29){}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x4f770a(0x213)]();}catch(_0x3bb24a){}deleteStmt=null;}try{setStmt=await adapter[_0x4f770a(0x1be)](_0x4f770a(0x1b9)+_0x4f770a(0x21a)+_0x4f770a(0x1d7)+'ue_store\x20('+'key,\x20value'+')\x20VALUES\x20('+_0x4f770a(0x214)),deleteStmt=await adapter['prepare'](_0x4f770a(0x2ac)+'M\x20key_valu'+'e_store\x20WH'+_0x4f770a(0x1a4)+'?'),info(_0x4f770a(0x2b1)+_0x4f770a(0x1c8)+_0x4f770a(0x2a2)+'lete).');}catch(_0x3f2839){if(isDbClosedError(_0x3f2839)){warn(_0x4f770a(0x249)+'tements\x20fa'+_0x4f770a(0x202)+_0x4f770a(0x1ae)+_0x4f770a(0x222));throw _0x3f2839;}error(_0x4f770a(0x2fd)+_0x4f770a(0x19e)+_0x4f770a(0x1f1)+'s:',_0x3f2839);throw _0x3f2839;}}async function applyMigrations(){const _0x810e0c=_0x46df66;if(!adapter)throw new Error('adapter\x20no'+_0x810e0c(0x305)+'e\x20for\x20appl'+_0x810e0c(0x1ba)+_0x810e0c(0x2b5));await adapter[_0x810e0c(0x225)]('CREATE\x20TAB'+_0x810e0c(0x2fe)+_0x810e0c(0x1ec)+'_value_sto'+_0x810e0c(0x2c8)+'XT\x20PRIMARY'+'\x20KEY,\x20valu'+_0x810e0c(0x2eb)),await adapter[_0x810e0c(0x225)](_0x810e0c(0x311)+_0x810e0c(0x2fe)+_0x810e0c(0x26c)+'s\x20(ts\x20INTE'+'GER\x20PRIMAR'+_0x810e0c(0x314)+'ule\x20TEXT,\x20'+_0x810e0c(0x228)+_0x810e0c(0x176)+'TEXT);'),await adapter[_0x810e0c(0x225)](_0x810e0c(0x274)+_0x810e0c(0x218)+_0x810e0c(0x1b8)+_0x810e0c(0x190)+_0x810e0c(0x189)+_0x810e0c(0x2e1)+'T\x20NOT\x20NULL'+',\x0a\x20\x20\x20\x20\x20\x20gr'+'oup_id\x20TEX'+_0x810e0c(0x2be)+'\x20DEFAULT\x20\x27'+_0x810e0c(0x1fe)+_0x810e0c(0x1f4)+_0x810e0c(0x2be)+_0x810e0c(0x2a9)+_0x810e0c(0x1d1)+_0x810e0c(0x29c)+'d\x20TEXT\x20NOT'+_0x810e0c(0x2f3)+_0x810e0c(0x1b7)+_0x810e0c(0x22b)+'Y\x20KEY\x20(nam'+'e,\x20group_i'+_0x810e0c(0x313)+'\x20\x20'),await adapter[_0x810e0c(0x225)](_0x810e0c(0x274)+'E\x20TABLE\x20IF'+_0x810e0c(0x1b8)+_0x810e0c(0x264)+_0x810e0c(0x1f3)+_0x810e0c(0x195)+_0x810e0c(0x23d)+_0x810e0c(0x1e3)+_0x810e0c(0x292)+_0x810e0c(0x2ff)+_0x810e0c(0x1b4)+_0x810e0c(0x28a)+'\x20\x20\x20\x20);\x0a\x20\x20'),await adapter[_0x810e0c(0x225)](_0x810e0c(0x274)+_0x810e0c(0x218)+'\x20NOT\x20EXIST'+_0x810e0c(0x184)+_0x810e0c(0x2d9)+_0x810e0c(0x2c2)+_0x810e0c(0x25e)+_0x810e0c(0x27d)+_0x810e0c(0x2ca)+'\x20\x20group_id'+_0x810e0c(0x19d)+_0x810e0c(0x2e4)+_0x810e0c(0x312)),await adapter[_0x810e0c(0x225)]('\x0a\x20\x20\x20\x20CREAT'+_0x810e0c(0x218)+_0x810e0c(0x1b8)+_0x810e0c(0x1bd)+_0x810e0c(0x255)+_0x810e0c(0x19f)+'GER\x20PRIMAR'+'Y\x20KEY,\x0a\x20\x20\x20'+_0x810e0c(0x29e)+_0x810e0c(0x236)+_0x810e0c(0x203)+_0x810e0c(0x1ea)+'d\x20TEXT,\x0a\x20\x20'+_0x810e0c(0x1db)+_0x810e0c(0x25d)+'OT\x20NULL,\x0a\x20'+_0x810e0c(0x25b)+'t_key\x20TEXT'+'\x20NOT\x20NULL,'+'\x0a\x20\x20\x20\x20\x20\x20mes'+'sage_count'+_0x810e0c(0x281)+_0x810e0c(0x240)+'\x20\x20\x20\x20\x20\x20disp'+_0x810e0c(0x1d5)+_0x810e0c(0x319)+_0x810e0c(0x299)+_0x810e0c(0x24c)+_0x810e0c(0x1e6)+'\x20'),await adapter[_0x810e0c(0x225)](_0x810e0c(0x197)+_0x810e0c(0x2a1)+'IF\x20NOT\x20EXI'+_0x810e0c(0x286)+_0x810e0c(0x217)+_0x810e0c(0x259)+_0x810e0c(0x316)+'ats(chat_j'+_0x810e0c(0x2bd)+'ame,\x20bucke'+_0x810e0c(0x28b));}async function flushQueue(){const _0x2bd410=_0x46df66;if(!dbReady||isFlushing||writeQueue['length']===0x2387+-0x23*0xb+-0x2206)return;const _0x6f2536=writeQueue[-0x1*0x1201+-0x2*0x21d+-0x163b*-0x1];if(_0x6f2536&&_0x6f2536[_0x2bd410(0x18f)]>0x15ad+-0x111c+-0x491&&Date[_0x2bd410(0x265)]()-_0x6f2536[_0x2bd410(0x2a3)]<-0x1f11+-0x9f2+0x34bb)return;if(!setStmt||!deleteStmt)try{if(!adapter)throw new Error(_0x2bd410(0x246)+'\x20available'+_0x2bd410(0x2f1)+_0x2bd410(0x2b9)+_0x2bd410(0x1e1));await prepareStatements();}catch(_0x3d18cb){if(isDbClosedError(_0x3d18cb)){warn(_0x2bd410(0x1ee)+_0x2bd410(0x24a)+_0x2bd410(0x24e)+_0x2bd410(0x1dd)+_0x2bd410(0x318)+_0x2bd410(0x239)),await scheduleReinitializeAfterError(_0x3d18cb);return;}else{error('Failed\x20to\x20'+_0x2bd410(0x191)+_0x2bd410(0x23b)+_0x2bd410(0x28c)+_0x2bd410(0x216),_0x3d18cb);return;}}isFlushing=!![];const _0x1adfeb=getConfig(),_0x123e67=_0x1adfeb[_0x2bd410(0x2c6)+_0x2bd410(0x2d3)]||-0x398+0xdf3+0x3*-0x363,_0x3bf5a0=writeQueue['splice'](-0xbb6+0x630+0x586,_0x123e67),_0x397fc3=_0x3bf5a0[_0x2bd410(0x188)]((_0x33c16d,_0x5cd5e0)=>_0x33c16d+(_0x5cd5e0['size']||-0x2*0x5b5+0xe*-0x9b+0x2*0x9f2),-0xe59+-0x70+0x5*0x2f5);try{if(adapter&&typeof adapter['exec']===_0x2bd410(0x1dc))await adapter['exec'](_0x2bd410(0x245)+_0x2bd410(0x1d3));for(const _0x56bf97 of _0x3bf5a0){try{switch(_0x56bf97['type']){case _0x2bd410(0x1fb):if(!setStmt)throw new Error(_0x2bd410(0x2af)+_0x2bd410(0x1a8));await setStmt[_0x2bd410(0x1c3)](_0x56bf97['key'],_0x56bf97[_0x2bd410(0x28f)]);break;case'delete':if(!deleteStmt)throw new Error(_0x2bd410(0x193)+_0x2bd410(0x1c6));await deleteStmt[_0x2bd410(0x1c3)](_0x56bf97['key']);break;default:warn(_0x2bd410(0x24b)+_0x2bd410(0x2e3)+_0x2bd410(0x2f5)+_0x2bd410(0x2d5)+_0x56bf97['type']);}}catch(_0x43d256){if(isDbClosedError(_0x43d256))throw _0x43d256;error(_0x2bd410(0x2fd)+_0x2bd410(0x302)+_0x2bd410(0x2e6)+_0x2bd410(0x2f7)+_0x2bd410(0x30f)+_0x2bd410(0x235)+_0x2bd410(0x25f)+JSON[_0x2bd410(0x1c2)](_0x56bf97)+(',\x20itemErr:'+'\x20')+(_0x43d256?.[_0x2bd410(0x20e)]||_0x43d256));throw _0x43d256;}}if(adapter&&typeof adapter[_0x2bd410(0x225)]==='function')await adapter[_0x2bd410(0x225)](_0x2bd410(0x1ef));if(!usingNative)try{await persistDatabaseToFile();}catch(_0x288b82){error(_0x2bd410(0x2fd)+_0x2bd410(0x1b3)+_0x2bd410(0x288)+_0x2bd410(0x243),_0x288b82);}queueBytes=Math[_0x2bd410(0x290)](-0xb1+0xf9e+-0xeed,queueBytes-_0x397fc3),reinitBackoffMs=-0x1c2f+-0x191b+0x3932;}catch(_0x11cd39){if(isDbClosedError(_0x11cd39)){error(_0x2bd410(0x1c0)+_0x2bd410(0x17a)+_0x2bd410(0x1cf)+'\x20flush.\x20Wi'+_0x2bd410(0x2e7)+_0x2bd410(0x1a7)+_0x2bd410(0x208),_0x11cd39);try{if(adapter&&typeof adapter['exec']==='function')await adapter[_0x2bd410(0x225)](_0x2bd410(0x20f));}catch(_0x1b27b4){}writeQueue[_0x2bd410(0x2da)](..._0x3bf5a0),await scheduleReinitializeAfterError(_0x11cd39);}else{error('DB\x20flush\x20t'+'ransaction'+_0x2bd410(0x2e5)+_0x2bd410(0x221)+_0x2bd410(0x266)+'ng\x20for\x20ret'+_0x2bd410(0x232),_0x11cd39);try{if(adapter&&typeof adapter[_0x2bd410(0x225)]==='function')await adapter[_0x2bd410(0x225)](_0x2bd410(0x20f));}catch(_0x4424ff){error(_0x2bd410(0x2b7)+_0x2bd410(0x1ff),_0x4424ff);}const _0x57ade2=Date['now'](),_0x37ca86=[];for(const _0x2bde82 of _0x3bf5a0){_0x2bde82['retries']=(_0x2bde82['retries']||-0x18fd+0x8fe+0x1c7*0x9)+(-0xca7+-0x30b+0x1*0xfb3),_0x2bde82[_0x2bd410(0x2a3)]=_0x57ade2;if(_0x2bde82[_0x2bd410(0x18f)]<-0x9d5*0x1+0x1b9e+-0x11c7)_0x37ca86[_0x2bd410(0x18b)](_0x2bde82);else error(_0x2bd410(0x2a0)+_0x2bd410(0x250)+_0x2bd410(0x2cb)+_0x2bd410(0x1eb)+_0x2bd410(0x1df)+_0x2bd410(0x27a)+JSON[_0x2bd410(0x1c2)](_0x2bde82));}if(_0x37ca86['length']>0x41*0x94+-0x6cc+-0x1ec8)writeQueue[_0x2bd410(0x2da)](..._0x37ca86);queueBytes=Math['max'](-0x135d*0x1+0x1*0x179e+-0x441,queueBytes-_0x397fc3+_0x37ca86[_0x2bd410(0x188)]((_0x16c83a,_0x5ababa)=>_0x16c83a+(_0x5ababa[_0x2bd410(0x1ce)]||-0x565*-0x1+0x4d8+-0xa3d*0x1),0xe9c+0x5*-0x629+0x1031));}}finally{isFlushing=![];}}async function persistDatabaseToFile(){const _0x8d02f8=_0x46df66,_0x3ef390=getConfig(),_0x187a45=_0x3ef390[_0x8d02f8(0x219)+'OT']||process[_0x8d02f8(0x30e)](),_0x5a0c3d=_0x39cf85[_0x8d02f8(0x2e2)](_0x187a45,_0x3ef390['DB_PATH']||_0x8d02f8(0x17e)),_0x350e61=_0x3ef390[_0x8d02f8(0x1d2)]||_0x8d02f8(0x198)+_0x8d02f8(0x2a8),_0x1602fd=_0x39cf85[_0x8d02f8(0x2d2)](_0x5a0c3d,_0x350e61);if(usingNative)return;if(!adapter){warn(_0x8d02f8(0x256)+'abaseToFil'+_0x8d02f8(0x231)+'\x20missing,\x20'+'skipping\x20p'+'ersist.');return;}try{const _0x1f75ba=adapter[_0x8d02f8(0x2f4)]();if(!_0x1f75ba)return;const _0x2ef7c9=_0x1602fd+_0x8d02f8(0x2aa);await _0x2bc17e[_0x8d02f8(0x179)](_0x2ef7c9,Buffer[_0x8d02f8(0x2f8)](_0x1f75ba)),await _0x2bc17e[_0x8d02f8(0x1a9)](_0x2ef7c9,_0x1602fd,{'overwrite':!![]}),info(_0x8d02f8(0x253)+'ersisted\x20t'+'o\x20'+_0x1602fd);}catch(_0x59b774){if(isDbClosedError(_0x59b774)){warn(_0x8d02f8(0x256)+_0x8d02f8(0x2fa)+_0x8d02f8(0x306)+_0x8d02f8(0x1f0)+_0x8d02f8(0x28e)+_0x8d02f8(0x212)+'init.'),await scheduleReinitializeAfterError(_0x59b774);return;}throw _0x59b774;}}export async function get(_0x5b76cd){const _0x3200e9=_0x46df66;try{if(cache&&cache[_0x3200e9(0x18c)](_0x5b76cd))return cache['get'](_0x5b76cd);}catch(_0x4a7dcb){}if(!dbReady||!adapter)return warn(_0x3200e9(0x24f)+'dy\x20for\x20get'+'\x20operation'+'.'),undefined;try{const _0x58330c=await adapter[_0x3200e9(0x2ad)](_0x3200e9(0x1b2)+_0x3200e9(0x2b8)+'y_value_st'+'ore\x20WHERE\x20'+'key\x20=\x20?',_0x5b76cd);if(_0x58330c&&_0x58330c['value']!=null)try{const _0x3cc41e=JSON[_0x3200e9(0x2a7)](_0x58330c['value']);try{cache[_0x3200e9(0x1fb)](_0x5b76cd,_0x3cc41e,_0x58330c[_0x3200e9(0x28f)]);}catch(_0x58700c){}return _0x3cc41e;}catch(_0x7f18ae){return error(_0x3200e9(0x2fd)+'parse\x20stor'+'ed\x20JSON\x20fo'+_0x3200e9(0x2d1)+_0x5b76cd+_0x3200e9(0x223)+(_0x7f18ae?.[_0x3200e9(0x20e)]||_0x7f18ae)),undefined;}}catch(_0x211464){isDbClosedError(_0x211464)?(warn(_0x3200e9(0x297)+_0x3200e9(0x204)+_0x3200e9(0x26e)+_0x3200e9(0x29f)+_0x3200e9(0x28d)+'it.\x20Key:\x20'+_0x5b76cd),await scheduleReinitializeAfterError(_0x211464)):error(_0x3200e9(0x2fd)+_0x3200e9(0x1e4)+_0x5b76cd+(_0x3200e9(0x1de)+'\x20')+(_0x211464?.['message']||_0x211464),_0x211464);}return undefined;}export function set(_0x4fdb6b,_0x20e3f9){const _0x37e7d8=_0x46df66;if(_0x20e3f9===undefined){del(_0x4fdb6b);return;}let _0xe5254;try{_0xe5254=JSON[_0x37e7d8(0x1c2)](_0x20e3f9);}catch(_0x219518){error(_0x37e7d8(0x2b3)+'key\x20\x22'+_0x4fdb6b+(_0x37e7d8(0x30c)+_0x37e7d8(0x2c5)+_0x37e7d8(0x237)+_0x37e7d8(0x2f9)),_0x219518);return;}try{cache['set'](_0x4fdb6b,_0x20e3f9,_0xe5254);}catch(_0x3ed9d3){}const _0x4ada6b={'type':_0x37e7d8(0x1fb),'key':_0x4fdb6b,'value':_0xe5254,'retries':0x0,'timestamp':Date[_0x37e7d8(0x265)]()};_0x4ada6b['size']=estimateQueueItemSize(_0x4ada6b),queueBytes+=_0x4ada6b[_0x37e7d8(0x1ce)],writeQueue['push'](_0x4ada6b),enforceMemoryLimit(),writeQueue[_0x37e7d8(0x260)]>=getConfig()[_0x37e7d8(0x2c6)+_0x37e7d8(0x2d3)]&&flushQueue()[_0x37e7d8(0x17c)](_0x3af9ab=>{const _0x39d4ca=_0x37e7d8;error('Error\x20duri'+_0x39d4ca(0x186)+'eue\x20trigge'+_0x39d4ca(0x226)+_0x39d4ca(0x263),_0x3af9ab);});}export function del(_0x482f05){const _0x318651=_0x46df66;try{cache[_0x318651(0x293)](_0x482f05);}catch(_0xb9e964){}const _0x39251f={'type':_0x318651(0x293),'key':_0x482f05,'retries':0x0,'timestamp':Date[_0x318651(0x265)]()};_0x39251f[_0x318651(0x1ce)]=estimateQueueItemSize(_0x39251f),queueBytes+=_0x39251f[_0x318651(0x1ce)],writeQueue[_0x318651(0x18b)](_0x39251f),enforceMemoryLimit(),writeQueue['length']>=getConfig()[_0x318651(0x2c6)+_0x318651(0x2d3)]&&flushQueue()['catch'](_0x2ba970=>{const _0x25b947=_0x318651;error(_0x25b947(0x2b6)+'ng\x20flushQu'+_0x25b947(0x26d)+_0x25b947(0x254)+_0x25b947(0x263),_0x2ba970);});}export async function shutdownDatabase(){const _0x34f722=_0x46df66;info(_0x34f722(0x1fc)+_0x34f722(0x207)+_0x34f722(0x24d)+_0x34f722(0x1a0)+_0x34f722(0x2cd)+_0x34f722(0x1d4)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);try{await flushQueue(),await flushQueue(),info('Final\x20flus'+_0x34f722(0x2fb)+'d.');}catch(_0x298cd2){error(_0x34f722(0x2b6)+_0x34f722(0x248)+_0x34f722(0x2a5)+'pts:',_0x298cd2);}if(setStmt){try{await setStmt['finalize']();}catch(_0x1817bd){warn(_0x34f722(0x1ca)+'lizing\x20set'+'Stmt\x20durin'+_0x34f722(0x1f2)+':',_0x1817bd);}setStmt=null;}if(deleteStmt){try{await deleteStmt['finalize']();}catch(_0x5cd661){warn(_0x34f722(0x1ca)+_0x34f722(0x2a4)+_0x34f722(0x1a1)+_0x34f722(0x20c)+_0x34f722(0x1e5),_0x5cd661);}deleteStmt=null;}try{await persistDatabaseToFile();}catch(_0xc13e62){error(_0x34f722(0x2ab)+_0x34f722(0x2b2)+'file\x20durin'+_0x34f722(0x1f2)+':',_0xc13e62);}if(adapter){try{await adapter[_0x34f722(0x29a)](),info(_0x34f722(0x18e)+_0x34f722(0x23f)+_0x34f722(0x2d4)+_0x34f722(0x317));}catch(_0xbdc883){error(_0x34f722(0x2b6)+_0x34f722(0x31a)+'atabase\x20cl'+'ose:',_0xbdc883);}adapter=null,db=null;}info('Database\x20s'+_0x34f722(0x207)+_0x34f722(0x2ef)+'leted\x20succ'+_0x34f722(0x211));}async function backupDB(_0x19287e){const _0x4fe3b7=_0x46df66;try{if(!await _0x2bc17e[_0x4fe3b7(0x1d9)](_0x19287e))return;const _0x30d143=_0x39cf85[_0x4fe3b7(0x2b0)](_0x19287e),_0x4cbfad=_0x39cf85[_0x4fe3b7(0x27f)](_0x19287e,_0x39cf85[_0x4fe3b7(0x26b)](_0x19287e)),_0x4113e8=_0x39cf85[_0x4fe3b7(0x2d2)](_0x30d143,_0x4cbfad+'.bak'),_0x34862f=await _0x2bc17e[_0x4fe3b7(0x1d9)](_0x4113e8)?await _0x2bc17e['stat'](_0x4113e8):null,_0x12d661=_0x34862f?Date[_0x4fe3b7(0x265)]()-_0x34862f[_0x4fe3b7(0x257)]:Infinity;_0x12d661>(-0xf16+0x12f5+0x1*-0x3c7)*(-0x5*-0x79d+0xf00+0x19*-0x21d)*(-0x16ba+0xb53+-0x3e1*-0x3)*(0x952*-0x3+0x1489*0x1+0xb55)&&(await _0x2bc17e['copy'](_0x19287e,_0x4113e8,{'overwrite':!![]}),info('Database\x20b'+_0x4fe3b7(0x271)+'ted\x20at\x20'+_0x4113e8));}catch(_0x48c40e){error(_0x4fe3b7(0x2dd)+'ackup\x20fail'+'ed:\x20'+(_0x48c40e?.[_0x4fe3b7(0x20e)]||_0x48c40e),_0x48c40e);}}process[_0x46df66(0x272)](_0x46df66(0x2cc),()=>{const _0x17b9be=_0x46df66;shutdownDatabase()[_0x17b9be(0x2f0)](()=>process[_0x17b9be(0x303)](0x1e32+-0x1*0x1c19+0xb3*-0x3));}),process['once'](_0x46df66(0x304),()=>{const _0x2fa4fd=_0x46df66;shutdownDatabase()[_0x2fa4fd(0x2f0)](()=>process['exit'](0x1d*0x39+-0x117a+-0x7*-0x193));});export{adapter as _adapter};