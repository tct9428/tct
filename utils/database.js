const _0x19a6f9=_0x3093;(function(_0x2cc6ed,_0xbe28a7){const _0x114526=_0x3093,_0x2c534d=_0x2cc6ed();while(!![]){try{const _0x2a472e=parseInt(_0x114526(0x215))/(0x1222+-0x1f4f*-0x1+0x2*-0x18b8)+parseInt(_0x114526(0xf2))/(0x6*-0x1e9+0x129d+0x1f*-0x3b)*(parseInt(_0x114526(0x12a))/(0x78c+0x6f6*0x3+-0x1c6b))+parseInt(_0x114526(0x159))/(0x2a5*-0x2+-0x2*-0xce9+0x194*-0xd)+-parseInt(_0x114526(0x18b))/(0x1*-0xbaa+0x355*0xb+-0x18f8)+parseInt(_0x114526(0xfe))/(-0x1281+-0x3a4*0x3+0x1*0x1d73)+parseInt(_0x114526(0x16e))/(-0x1*-0x18a1+0x131d+0x24d*-0x13)*(parseInt(_0x114526(0x1d8))/(0x555+0x66e*0x3+0x5*-0x4eb))+-parseInt(_0x114526(0x279))/(-0xe0b+0x1*-0x1dfb+0x2c0f*0x1);if(_0x2a472e===_0xbe28a7)break;else _0x2c534d['push'](_0x2c534d['shift']());}catch(_0x55abe5){_0x2c534d['push'](_0x2c534d['shift']());}}}(_0x31bd,-0x3503*-0x1+0xc0025+-0x908d));import _0x1cd368 from'fs-extra';import _0x191ed9 from'path';import{getConfig}from'./config.js';import{info,error,debug,warn}from'./logger.js';export let db=null;export let adapter=null;function _0x3093(_0x1e5906,_0xde06bf){_0x1e5906=_0x1e5906-(0x1*-0x23d0+-0x892*-0x1+0x1c30);const _0x1b3c7f=_0x31bd();let _0xbb91ce=_0x1b3c7f[_0x1e5906];return _0xbb91ce;}let usingNative=![],setStmt=null,deleteStmt=null,dbReady=![],writeQueue=[],queueBytes=-0x1d78*0x1+-0xce*-0x26+0x4*-0x47,maxTotalBytes=0x269e+0x17c9+-0x3e67,isFlushing=![],flushTimer=null,cache=null;function estimateQueueItemSize(_0x487d62){const _0x36bbce=_0x3093,_0x49498d=0x203a+-0x1*-0x5cf+-0x25b9;switch(_0x487d62[_0x36bbce(0x1eb)]){case'set':return Buffer[_0x36bbce(0x1c1)](_0x487d62['key'],'utf8')+Buffer[_0x36bbce(0x1c1)](_0x487d62['value'],_0x36bbce(0x19b))+_0x49498d;case _0x36bbce(0x20e):return Buffer['byteLength'](_0x487d62[_0x36bbce(0x1a3)],'utf8')+_0x49498d;default:return 0x1410+0x1c9d+-0x302d;}}class MemoryCache{constructor(_0x324556){const _0x425f5e=_0x3093;this[_0x425f5e(0xf5)]=_0x324556,this[_0x425f5e(0x121)]=-0x1*0x506+0x5*0x1e7+-0x3*0x17f,this[_0x425f5e(0x204)]=new Map(),this[_0x425f5e(0x1a8)]={'prev':null,'next':null},this['tail']={'prev':null,'next':null},this[_0x425f5e(0x1a8)]['next']=this[_0x425f5e(0x1da)],this[_0x425f5e(0x1da)]['prev']=this['head'];}static[_0x19a6f9(0x19c)+'ze'](_0x1307c9,_0x4f59bb){const _0x35ef2a=_0x19a6f9,_0x39ee1b=Buffer[_0x35ef2a(0x1c1)](String(_0x1307c9),'utf8'),_0xeaeb92=Buffer['byteLength'](_0x4f59bb??'',_0x35ef2a(0x19b));return _0x39ee1b+_0xeaeb92+(-0x24*0x41+0x2*-0x73a+0x17d8);}[_0x19a6f9(0x27a)+'e'](_0x16a514){const _0x4b5987=_0x19a6f9;_0x16a514[_0x4b5987(0x195)][_0x4b5987(0x1e7)]=_0x16a514[_0x4b5987(0x1e7)],_0x16a514[_0x4b5987(0x1e7)][_0x4b5987(0x195)]=_0x16a514[_0x4b5987(0x195)];}['_addToTail'](_0xf32992){const _0x15e1ab=_0x19a6f9;_0xf32992['prev']=this['tail']['prev'],_0xf32992[_0x15e1ab(0x1e7)]=this[_0x15e1ab(0x1da)],this[_0x15e1ab(0x1da)]['prev'][_0x15e1ab(0x1e7)]=_0xf32992,this[_0x15e1ab(0x1da)][_0x15e1ab(0x195)]=_0xf32992;}[_0x19a6f9(0x129)+'l'](_0x439a5b){const _0x1cb1b4=_0x19a6f9;this[_0x1cb1b4(0x27a)+'e'](_0x439a5b),this[_0x1cb1b4(0x1d3)](_0x439a5b);}[_0x19a6f9(0x1e5)](_0x13c66e){const _0x2d5a4e=_0x19a6f9;return this[_0x2d5a4e(0x204)][_0x2d5a4e(0x1e5)](_0x13c66e);}[_0x19a6f9(0x183)](_0x33627d){const _0x1e154f=_0x19a6f9,_0x5c8275=this[_0x1e154f(0x204)][_0x1e154f(0x183)](_0x33627d);if(!_0x5c8275)return undefined;return this[_0x1e154f(0x129)+'l'](_0x5c8275),_0x5c8275['value'];}[_0x19a6f9(0x237)](_0x445d9c,_0x6b46c7,_0x46fc56){const _0x525c72=_0x19a6f9,_0x1ca6be=this['map'][_0x525c72(0x183)](_0x445d9c),_0x5e2f99=MemoryCache['estimateSi'+'ze'](_0x445d9c,_0x46fc56);if(_0x5e2f99>this['maxBytes']){warn(_0x525c72(0x14f)+_0x525c72(0x206)+_0x525c72(0x16a)+_0x525c72(0x243)+_0x445d9c+_0x525c72(0x1fd)+_0x5e2f99+('\x20bytes\x20>\x20m'+'ax\x20')+this[_0x525c72(0xf5)]+')');if(_0x1ca6be)this[_0x525c72(0x20e)](_0x445d9c);return;}if(_0x1ca6be)this[_0x525c72(0x121)]-=_0x1ca6be[_0x525c72(0x1a1)],_0x1ca6be[_0x525c72(0x1bb)]=_0x6b46c7,_0x1ca6be[_0x525c72(0x14e)]=_0x46fc56,_0x1ca6be['size']=_0x5e2f99,this['bytes']+=_0x5e2f99,this[_0x525c72(0x129)+'l'](_0x1ca6be);else{const _0xb01cdf={'key':_0x445d9c,'value':_0x6b46c7,'serialized':_0x46fc56,'size':_0x5e2f99,'prev':null,'next':null};this['map'][_0x525c72(0x237)](_0x445d9c,_0xb01cdf),this[_0x525c72(0x1d3)](_0xb01cdf),this[_0x525c72(0x121)]+=_0x5e2f99;}while(this[_0x525c72(0x121)]>this[_0x525c72(0xf5)]){const _0x276bbf=this['head'][_0x525c72(0x1e7)];if(_0x276bbf===this[_0x525c72(0x1da)])break;this[_0x525c72(0x20e)](_0x276bbf['key']);}}[_0x19a6f9(0x20e)](_0x2d7104){const _0x5af405=_0x19a6f9,_0x5a9f10=this['map'][_0x5af405(0x183)](_0x2d7104);if(!_0x5a9f10)return;this['_removeNod'+'e'](_0x5a9f10),this[_0x5af405(0x204)]['delete'](_0x2d7104),this[_0x5af405(0x121)]-=_0x5a9f10[_0x5af405(0x1a1)];}}function enforceMemoryLimit(){const _0x206338=_0x19a6f9;while(cache&&cache[_0x206338(0x121)]+queueBytes>maxTotalBytes&&writeQueue[_0x206338(0x101)]>0x2103+-0x279*-0x9+-0x36*0x106){const _0x31f118=writeQueue[_0x206338(0x177)]();if(_0x31f118[_0x206338(0x1a1)])queueBytes-=_0x31f118[_0x206338(0x1a1)];warn(_0x206338(0x1f0)+_0x206338(0x1aa)+_0x206338(0x193)+'ropped\x20old'+_0x206338(0x1b1)+_0x206338(0x245)+_0x31f118[_0x206338(0x1eb)]+',\x20Key:\x20'+(_0x31f118[_0x206338(0x1a3)]||_0x206338(0x1bf)));}}function normalizeBindParams(_0x1a22c2){const _0x17acf3=_0x19a6f9;if(!_0x1a22c2||_0x1a22c2[_0x17acf3(0x101)]===0x2e7*-0x4+0x15*0x7f+-0x1*-0x131)return undefined;if(_0x1a22c2[_0x17acf3(0x101)]===0x175f+-0x1482+0xc*-0x3d&&Array[_0x17acf3(0x1cb)](_0x1a22c2[0x2069+-0x22f7+-0x6*-0x6d]))return _0x1a22c2[0x1fb5+0x1dd6+0x1*-0x3d8b];if(_0x1a22c2[_0x17acf3(0x101)]===0x4d*-0x67+0x21a9*0x1+-0x2ad&&typeof _0x1a22c2[0x1a1f+-0x1*-0xd43+-0x2762]===_0x17acf3(0x182)&&_0x1a22c2[-0x2*0x59b+0x26c7+-0x1b91]!==null&&!Array[_0x17acf3(0x1cb)](_0x1a22c2[0x1*-0x255c+0x133d+0x1*0x121f]))return _0x1a22c2[-0x43*-0x45+0x2278+-0x3487];return _0x1a22c2;}function isTableAlreadyExistsError(_0x27ca16){const _0x1674a3=_0x19a6f9;try{const _0x35e7d4=_0x27ca16&&(_0x27ca16[_0x1674a3(0x25a)]||String(_0x27ca16))||'';return/table .* already exists/i[_0x1674a3(0x202)](_0x35e7d4)||/\balready exists\b/i['test'](_0x35e7d4);}catch(_0x166279){return![];}}function _0x31bd(){const _0x50f168=['ms\x20due\x20to\x20','\x22\x20is\x20not\x20s','ed\x20because','erializabl','l.js):\x20','able\x20alrea','DB\x20reiniti','dy\x20for\x20get','sed\x20during','serialized','Skipping\x20c','REPLACE\x20IN','error:\x20','red\x20by\x20set','Error\x20fina','ons\x20(\x0a\x20\x20\x20\x20','ackup\x20crea','DB_CACHE_M','s\x20ok','dist','2006852cFRgrQ','.db','le\x20failure','skipping\x20p','ts\x20(set/de','r\x20key\x20\x22','timestamp','string','SELECT\x201\x20a','ed\x20JSON\x20fo','OT\x20NULL,\x0a\x20','adapter\x20no','SQL.js\x20fro','S\x20connecti','\x20\x20\x20\x20PRIMAR','run','ser_key\x20TE','versized\x20i','isting\x20DB\x20','anly.','DB_FLUSH_I','325367ZudugH','toLowerCas','tive):\x20','setStmt\x20mi','y_timeout\x20','EXT,\x0a\x20\x20\x20\x20\x20','cy=ignore)','atements\x20b','default','shift','chronous\x20=','native\x20sql','basename','ll()\x20(poli','ror:\x20','ignore)\x20in','y_value_st','SQL.js\x20fal','r\x20commit:','ocess\x20comp','object','get','cwd','ring\x20shutd','\x20to\x20be\x20clo','mtimeMs','\x20reinitial','(sql.js).','Database\x20i','2306040RQPidf','Unhandled\x20','hQueue:','slice','Failed\x20to\x20','ve\x20sqlite3','ite3','uling\x20rein','ressure:\x20D','close','prev','statement\x20','\x20KEY,\x0a\x20\x20\x20\x20','DB\x20init\x20er','toUpperCas','.tmp','utf8','estimateSi',',\x20itemErr:','AULT\x20\x27[]\x27\x0a','nitializat','STS\x20idx_ac','size','ose:','key','eign_keys\x20','DB\x20appears','lay_name\x20T','prepare','head','ng\x20for\x20ret','e\x20memory\x20p','ted\x20at\x20','CREATE\x20UNI','\x20last_upda','e\x20failed\x20d','e\x20for\x20prep','PRAGMA\x20jou','est\x20item.\x20','ping\x20error','ed:\x20','dy\x20exists)','\x20file:\x20','_unique\x20ON','TO\x20key_val','dirname','\x20\x20name\x20TEX','min','value','sql.js','GER\x20PRIMAR','losed.','N/A','Final\x20flus','byteLength','ssing','ll\x20attempt','\x0a\x20\x20\x20\x20CREAT','reduce','\x20failed,\x20r','nitialized','exec',',\x0a\x20\x20\x20\x20\x20\x20gr','ore\x20WHERE\x20','isArray','lizing\x20set','Y\x20KEY,\x20mod','copy','tements\x20fa','nt\x20(sql.js','s):\x20','\x20while\x20exe','_addToTail','DB\x20not\x20rea','get\x20key\x20\x22','Using\x20nati','\x20creator_i','248EaJBDz','ified','tail','ization.','se\x20DB\x20is\x20c','ue\x20to\x20clos','ule\x20TEXT,\x20','=\x20ON;','it.','IQUE\x20const','E\x20TABLE\x20IF','Error\x20pers','tive_stats','has','ersist.','next','get()\x20fail','yMigration','failed:','type','\x20TEXT\x20NOT\x20','reset','init.','eduling\x20re','Write\x20queu','T\x20NOT\x20NULL','ignore','iled\x20becau','hutdown\x20pr',')\x20VALUES\x20(','_id\x20TEXT\x20P','.bak','it.\x20Key:\x20','now','atabase\x20cl','finalize','extname','\x22\x20(','Ignored\x20SQ','lizing\x20del','ats(chat_j','ame\x20TEXT\x20N','test','saction\x20ro','map','ted\x20closed','ache\x20for\x20o','e\x20for\x20appl','\x20\x20group_id','rnal_mode\x20','l\x20be\x20handl','omatically','red\x20statem','M\x20key_valu','delete','Stmt\x20durin','\x20KEY,\x20valu','join','export','Y\x20KEY\x20(nam','closed\x20cle','599986ihwDLt','from','DB_NAME','oup_id\x20TEX','Prepared\x20D','resolve','ROLLBACK;','\x22\x20from\x20DB:','once','faults\x20(\x0a\x20','code','Database\x20c','?,\x20?)','for\x20prepar','SACTION;','\x20(\x0a\x20\x20\x20\x20\x20\x20u','getRowsMod','SIGINT','Ignored\x20UN','k.\x20Prepari','\x20DEFAULT\x20\x27','QUE\x20INDEX\x20','\x20driver.','node_modul','s()','step','lete).','raint\x20erro','PRAGMA\x20for','=\x2010000;','r\x20during\x20g','PROJECT_RO','ping\x20detec','eue:','set','onnection\x20','database.s','replace','ile\x20runnin','\x20NORMAL;','stat','e...','ype\x20during','me\x20TEXT\x20NO','sed.\x20Sched','\x20item,\x20wil','tem\x20\x22','B\x20statemen','Type:\x20','ailed:','lush\x20attem','cuting\x20(na','eeded\x20usin','\x20\x20\x20id\x20INTE','stringify','olling\x20bac','\x20NULL,\x0a\x20\x20\x20','file\x20into\x20','free','g\x20INSERT\x20O','SQL.js','\x20to\x20prepar','r\x20(policy=','OLICY','CREATE\x20TAB','\x20\x20\x20\x20\x20\x20disp',',\x20message\x20','\x20statement','No\x20adapter','message','scarded\x20af','COMMIT;','DB\x20health\x20','R\x20REPLACE\x20','process\x20DB','\x20\x20\x20\x20\x20bucke','deleteStmt','PRAGMA\x20bus','prepare\x20DB','T\x20NULL\x20DEF','alization\x20','tats\x20(\x0a\x20\x20\x20','ive_groups','abaseToFil','function','catch','ERE\x20key\x20=\x20','Database','ng\x20flushQu','g:\x20','ements.\x20Sc','\x20active_st','\x20\x20\x20user_ji','EXISTS\x20log','ocess\x20init','ULT\x20\x27\x27,\x0a\x20\x20','ersisted\x20t','shing\x20queu','bind','ted\x20INTEGE','22732938zYlITT','_removeNod','ts.','id,\x20timefr','g\x20shutdown','efore\x20flus','max','ry.','CRITICAL:\x20','IZE','move','e_store\x20WH','ng\x20schedul','SELECT\x201;','Retry\x20succ','h\x20complete','key\x20=\x20?','unshift','\x20NOT\x20EXIST','_PATH','pathExists','et()\x20(poli','prepareSta','includes','Database\x20s','CONFLICT_P','ed\x20flushQu','ion\x20proces','e):\x20','DB_UNIQUE_','\x20prepared\x20','\x20missing,\x20','30xsIcoS','key\x20\x22','Database\x20p','maxBytes','\x20in\x20','B\x20(no\x20file','\x20present)','pts:','Error\x20duri','DB_BATCH_S','sage_count','getAsObjec','2418300oIDbfO','r\x20during\x20a','Rollback\x20f','length','S\x20user_act','():','\x20\x20\x20chat_ji','d\x20TEXT\x20NOT','persistDat','ile\x20execut','Using\x20SQL.','ed:','NULL\x0a\x20\x20\x20\x20)','Native\x20sql','ed\x20stateme','push','ignore)\x20wh','s.\x20Item:\x20','own:','Y\x20KEY,\x0a\x20\x20\x20','\x20\x20\x20\x20timefr','DB\x20item\x20di','nt\x20(native','ransaction','Database\x20b','R\x0a\x20\x20\x20\x20);\x0a\x20','\x20(non-fata','\x20operation','ter\x20multip','ackup\x20fail','PRAGMA\x20syn','red\x20by\x20del','s\x20started.','t_key\x20TEXT','aring\x20stat','bytes','INSERT\x20OR\x20','finally','level\x20TEXT',',\x0a\x20\x20\x20\x20\x20\x20na','parse','ng\x20final\x20f','r\x20in\x20prepa','_moveToTai','160893pgxbYS','\x20NOT\x20NULL,','e:\x20adapter','\x20after\x20err','file\x20durin','js\x20(WASM)\x20','S\x20active_s','DB_PATH','parse\x20stor','\x20\x20\x20\x20\x20group','l):','ensureDir','Created\x20ne','leted\x20succ','XT\x20PRIMARY','DB\x20closed\x20','\x20flush:\x20','\x20flush.\x20Wi','g\x20persist.','prepare\x20st','\x20DB\x20reinit','all','S\x20group_de','eteStmt\x20du','BEGIN\x20TRAN','\x20file\x20afte','retries'];_0x31bd=function(){return _0x50f168;};return _0x31bd();}function isUniqueConstraintError(_0x1dd2f6){const _0x1acba2=_0x19a6f9;try{const _0x317ccf=_0x1dd2f6&&(_0x1dd2f6['message']||String(_0x1dd2f6))||'';return/UNIQUE constraint failed/i[_0x1acba2(0x202)](_0x317ccf)||/UNIQUE constraint/i[_0x1acba2(0x202)](_0x317ccf);}catch(_0x11d0f3){return![];}}function looksLikeSimpleInsert(_0x2e493c){const _0x39e71f=_0x19a6f9;if(!_0x2e493c||typeof _0x2e493c!==_0x39e71f(0x160))return![];return/^\s*INSERT\s+INTO\s+/i[_0x39e71f(0x202)](_0x2e493c)&&!/INSERT\s+OR\s+(REPLACE|IGNORE)/i[_0x39e71f(0x202)](_0x2e493c);}function getUniquePolicy(){const _0x2eb41c=_0x19a6f9;try{const _0x1d2633=getConfig(),_0x316be4=_0x1d2633&&_0x1d2633[_0x2eb41c(0x296)+_0x2eb41c(0x292)+_0x2eb41c(0x254)]||_0x2eb41c(0x1f2);return String(_0x316be4)[_0x2eb41c(0x16f)+'e']()['trim']();}catch(_0x1245f6){return _0x2eb41c(0x1f2);}}let dbInitializingPromise=null,reinitBackoffMs=-0x5*-0x691+-0x1*0x118b+0x5e*-0x1f;const MAX_REINIT_BACKOFF_MS=(0x5*-0x2c3+0x1683+-0x878)*(0x10ae+0x4b*-0x3e+-0x2e*-0x1e);function isDbClosedError(_0x37d191){const _0x415e0e=_0x19a6f9;if(!_0x37d191)return![];const _0x239a20=String(_0x37d191['message']||_0x37d191||'');if(/database is closed/i[_0x415e0e(0x202)](_0x239a20))return!![];if(/SQLITE_MISUSE/i[_0x415e0e(0x202)](_0x239a20))return!![];if(_0x37d191&&typeof _0x37d191[_0x415e0e(0x21f)]===_0x415e0e(0x160)&&_0x37d191[_0x415e0e(0x21f)][_0x415e0e(0x199)+'e']()[_0x415e0e(0x290)]('SQLITE'))return/SQLITE_MISUSE|SQLITE_IOERR|SQLITE_MISUSE/i[_0x415e0e(0x202)](_0x37d191['code']);return![];}async function scheduleReinitializeAfterError(_0x5879a2){const _0x802ec=_0x19a6f9;dbReady=![];if(dbInitializingPromise)return dbInitializingPromise;const _0x7cff8e=Math[_0x802ec(0x1ba)](reinitBackoffMs,MAX_REINIT_BACKOFF_MS);return warn('Scheduling'+_0x802ec(0x13e)+'ialization'+_0x802ec(0xf6)+_0x7cff8e+(_0x802ec(0x145)+_0x802ec(0x151))+(_0x5879a2?.[_0x802ec(0x25a)]||_0x5879a2)),dbInitializingPromise=((async()=>{const _0x401a23=_0x802ec;await new Promise(_0x1fd0b1=>setTimeout(_0x1fd0b1,_0x7cff8e));try{await initializeDatabase(),info(_0x401a23(0x14b)+'alized\x20aut'+_0x401a23(0x20b)+_0x401a23(0x12d)+'or.'),reinitBackoffMs=0x265d+0xa8e+-0x2d03;}catch(_0x2cd55d){error('Automatic\x20'+_0x401a23(0x14b)+_0x401a23(0x265)+_0x401a23(0x1ea),_0x2cd55d),reinitBackoffMs=Math[_0x401a23(0x1ba)](MAX_REINIT_BACKOFF_MS,reinitBackoffMs*(0x1b1*0xb+0x1281+0x2*-0x128d));try{await scheduleReinitializeAfterError(_0x2cd55d);}catch(_0x48736b){}}finally{dbInitializingPromise=null;}})()),dbInitializingPromise;}function createNativeAdapter(_0x1b818e){return{'_underlying':_0x1b818e,async 'exec'(_0x4ecfe0){const _0xd880ac=_0x3093;try{await _0x1b818e[_0xd880ac(0x1c8)](_0x4ecfe0);return;}catch(_0x155168){if(isTableAlreadyExistsError(_0x155168)){warn(_0xd880ac(0x1fe)+'L\x20error\x20(t'+_0xd880ac(0x14a)+_0xd880ac(0x1b4)+'\x20while\x20exe'+_0xd880ac(0x248)+_0xd880ac(0x170)+String(_0x4ecfe0)[_0xd880ac(0x18e)](-0x1aab+0x2664+-0x1*0xbb9,0x1db3+-0x1*0x8e9+0xd6*-0x17));return;}if(isUniqueConstraintError(_0x155168)){const _0x2cc25f=getUniquePolicy();if(_0x2cc25f===_0xd880ac(0x1f2)){debug(_0xd880ac(0x227)+'IQUE\x20const'+_0xd880ac(0x230)+_0xd880ac(0x253)+'ignore)\x20wh'+_0xd880ac(0x107)+'ing\x20(nativ'+_0xd880ac(0x295)+String(_0x4ecfe0)[_0xd880ac(0x18e)](0xf3a+-0x963*-0x3+0x1d*-0x17f,-0x2c*-0xa+-0x3*-0x297+-0x7ed));return;}if(_0x2cc25f===_0xd880ac(0x23a)&&looksLikeSimpleInsert(_0x4ecfe0)){const _0x10de8c=_0x4ecfe0[_0xd880ac(0x23a)](/^\s*INSERT\s+INTO/i,_0xd880ac(0x122)+_0xd880ac(0x150)+'TO');try{await _0x1b818e['exec'](_0x10de8c);return;}catch(_0x1093bb){throw _0x1093bb;}}}throw _0x155168;}},async 'get'(_0x526795,..._0x1c8226){const _0x773ede=_0x3093;try{const _0x296943=normalizeBindParams(_0x1c8226);if(_0x296943===undefined)return await _0x1b818e[_0x773ede(0x183)](_0x526795);return await _0x1b818e[_0x773ede(0x183)](_0x526795,_0x296943);}catch(_0x27e4c7){throw _0x27e4c7;}},async 'all'(_0x156f5e,..._0x30ce04){const _0x2eea5b=_0x3093;try{const _0x3b1387=normalizeBindParams(_0x30ce04);if(_0x3b1387===undefined)return await _0x1b818e[_0x2eea5b(0x13f)](_0x156f5e);return await _0x1b818e[_0x2eea5b(0x13f)](_0x156f5e,_0x3b1387);}catch(_0x4e5111){throw _0x4e5111;}},async 'run'(_0x4911b5,..._0x5f007e){const _0x1b43bc=_0x3093;try{const _0x36d3bc=normalizeBindParams(_0x5f007e);let _0x4b24d1;return _0x36d3bc===undefined?_0x4b24d1=await _0x1b818e['run'](_0x4911b5):_0x4b24d1=await _0x1b818e[_0x1b43bc(0x168)](_0x4911b5,_0x36d3bc),_0x4b24d1;}catch(_0x11dbd8){if(isUniqueConstraintError(_0x11dbd8)){const _0x5db96a=getUniquePolicy();if(_0x5db96a===_0x1b43bc(0x1f2))return debug(_0x1b43bc(0x227)+_0x1b43bc(0x1e1)+_0x1b43bc(0x230)+_0x1b43bc(0x253)+_0x1b43bc(0x10e)+_0x1b43bc(0x23b)+'g\x20(native)'+':\x20'+String(_0x4911b5)[_0x1b43bc(0x18e)](0x1*0x7b0+0x3a+0x3f5*-0x2,-0x5*-0x661+-0x7b*0x21+0x6d*-0x22)),undefined;if(_0x5db96a===_0x1b43bc(0x23a)&&looksLikeSimpleInsert(_0x4911b5)){const _0x3e54c8=_0x4911b5['replace'](/^\s*INSERT\s+INTO/i,_0x1b43bc(0x122)+'REPLACE\x20IN'+'TO'),_0x52f103=normalizeBindParams(_0x5f007e);try{let _0x55bc5b;if(_0x52f103===undefined)_0x55bc5b=await _0x1b818e[_0x1b43bc(0x168)](_0x3e54c8);else _0x55bc5b=await _0x1b818e[_0x1b43bc(0x168)](_0x3e54c8,_0x52f103);return info('Retry\x20succ'+_0x1b43bc(0x249)+'g\x20INSERT\x20O'+_0x1b43bc(0x25e)+'(native).'),_0x55bc5b;}catch(_0x169d25){throw _0x169d25;}}}throw _0x11dbd8;}},async 'prepare'(_0x4d0647){const _0x417c03=_0x3093,_0x57afbb=await _0x1b818e[_0x417c03(0x1a7)](_0x4d0647);return{async 'run'(..._0x330f91){const _0x18f682=_0x417c03,_0x448777=normalizeBindParams(_0x330f91);try{let _0x4b17a9;if(_0x448777===undefined)_0x4b17a9=await _0x57afbb[_0x18f682(0x168)]();else _0x4b17a9=await _0x57afbb[_0x18f682(0x168)](_0x448777);return _0x4b17a9;}catch(_0x3fbd03){if(isUniqueConstraintError(_0x3fbd03)){const _0x593719=getUniquePolicy();if(_0x593719===_0x18f682(0x1f2))return debug('Ignored\x20UN'+'IQUE\x20const'+'raint\x20erro'+_0x18f682(0x253)+_0x18f682(0x17d)+_0x18f682(0x297)+_0x18f682(0x196)+'(native):\x20'+_0x4d0647),undefined;if(_0x593719==='replace'&&looksLikeSimpleInsert(_0x4d0647)){const _0x5615b0=_0x4d0647[_0x18f682(0x23a)](/^\s*INSERT\s+INTO/i,_0x18f682(0x122)+_0x18f682(0x150)+'TO'),_0x22b41c=await _0x1b818e['prepare'](_0x5615b0);try{let _0x1c8c82;if(_0x448777===undefined)_0x1c8c82=await _0x22b41c['run']();else _0x1c8c82=await _0x22b41c[_0x18f682(0x168)](_0x448777);return await _0x22b41c['finalize'](),info(_0x18f682(0x287)+'eeded\x20usin'+'g\x20INSERT\x20O'+_0x18f682(0x25e)+_0x18f682(0x222)+_0x18f682(0x10c)+_0x18f682(0x114)+').'),_0x1c8c82;}catch(_0x857319){try{await _0x22b41c[_0x18f682(0x1fb)]();}catch(_0x3bbbd5){}throw _0x857319;}}}throw _0x3fbd03;}},async 'finalize'(){const _0x2bbdb0=_0x417c03;try{await _0x57afbb[_0x2bbdb0(0x1fb)]();}catch(_0x5c9431){}}};},async 'close'(){const _0x6756fa=_0x3093;try{await _0x1b818e[_0x6756fa(0x194)]();}catch(_0x463c01){}},'export'(){return undefined;}};}function createSQLjsAdapter(_0x4d8934){const _0x14c5f5=_0x4d8934;return{'_underlying':_0x14c5f5,async 'exec'(_0x2a560a){const _0xaf619f=_0x3093;try{_0x14c5f5[_0xaf619f(0x168)](_0x2a560a);return;}catch(_0x148c81){if(isTableAlreadyExistsError(_0x148c81)){warn('Ignored\x20SQ'+'L\x20error\x20(t'+'able\x20alrea'+_0xaf619f(0x1b4)+_0xaf619f(0x1d2)+'cuting\x20(sq'+_0xaf619f(0x149)+String(_0x2a560a)[_0xaf619f(0x18e)](0x232a+0xae4*-0x3+0x16*-0x1d,-0x117+-0x21d9+-0x10*-0x248));return;}if(isUniqueConstraintError(_0x148c81)){const _0xd75aaa=getUniquePolicy();if(_0xd75aaa===_0xaf619f(0x1f2)){debug(_0xaf619f(0x227)+_0xaf619f(0x1e1)+_0xaf619f(0x230)+_0xaf619f(0x253)+_0xaf619f(0x10e)+_0xaf619f(0x107)+'ing\x20(sql.j'+_0xaf619f(0x1d1)+String(_0x2a560a)[_0xaf619f(0x18e)](0x4*0x53e+0x1968+-0x2e60,-0x5*0x219+-0x1991+0x259e));return;}if(_0xd75aaa==='replace'&&looksLikeSimpleInsert(_0x2a560a)){const _0x4eb0c4=_0x2a560a[_0xaf619f(0x23a)](/^\s*INSERT\s+INTO/i,_0xaf619f(0x122)+_0xaf619f(0x150)+'TO');try{_0x14c5f5['run'](_0x4eb0c4);return;}catch(_0x13346c){throw _0x13346c;}}}throw _0x148c81;}},async 'get'(_0x321dc8,..._0x2a1adc){const _0x530a03=_0x3093;try{const _0x4f7765=_0x14c5f5[_0x530a03(0x1a7)](_0x321dc8);try{const _0x29c252=normalizeBindParams(_0x2a1adc);if(_0x29c252!==undefined)_0x4f7765[_0x530a03(0x277)](_0x29c252);if(_0x4f7765[_0x530a03(0x22e)]()){const _0x27403b=_0x4f7765['getAsObjec'+'t']();return _0x4f7765['free'](),_0x27403b;}else return _0x4f7765['free'](),undefined;}catch(_0x509e43){try{_0x4f7765[_0x530a03(0x24f)]();}catch(_0x2024bb){}if(isUniqueConstraintError(_0x509e43)){const _0x26c1b8=getUniquePolicy();if(_0x26c1b8===_0x530a03(0x1f2))return debug(_0x530a03(0x227)+_0x530a03(0x1e1)+_0x530a03(0x230)+_0x530a03(0x233)+_0x530a03(0x28e)+_0x530a03(0x174)+':\x20'+_0x321dc8),undefined;}throw _0x509e43;}}catch(_0x46bff2){throw _0x46bff2;}},async 'all'(_0x299d6e,..._0x552aba){const _0x500ddb=_0x3093;try{const _0x5e719d=_0x14c5f5[_0x500ddb(0x1a7)](_0x299d6e),_0x2d7927=[];try{const _0x2c7e5f=normalizeBindParams(_0x552aba);if(_0x2c7e5f!==undefined)_0x5e719d['bind'](_0x2c7e5f);while(_0x5e719d['step']())_0x2d7927[_0x500ddb(0x10d)](_0x5e719d[_0x500ddb(0xfd)+'t']());return _0x5e719d[_0x500ddb(0x24f)](),_0x2d7927;}catch(_0x212929){try{_0x5e719d[_0x500ddb(0x24f)]();}catch(_0x3c567b){}if(isUniqueConstraintError(_0x212929)){const _0x45827c=getUniquePolicy();if(_0x45827c===_0x500ddb(0x1f2))return debug('Ignored\x20UN'+_0x500ddb(0x1e1)+_0x500ddb(0x230)+_0x500ddb(0xff)+_0x500ddb(0x17b)+_0x500ddb(0x174)+':\x20'+_0x299d6e),_0x2d7927;}throw _0x212929;}}catch(_0x3751e1){throw _0x3751e1;}},async 'run'(_0x483868,..._0x506509){const _0x1f16c9=_0x3093;try{const _0x58df50=normalizeBindParams(_0x506509);if(_0x58df50===undefined){_0x14c5f5[_0x1f16c9(0x168)](_0x483868);const _0x3f6223=typeof _0x14c5f5[_0x1f16c9(0x225)+_0x1f16c9(0x1d9)]===_0x1f16c9(0x269)?_0x14c5f5[_0x1f16c9(0x225)+_0x1f16c9(0x1d9)]():undefined;return _0x3f6223!==undefined?{'changes':_0x3f6223}:undefined;}else{const _0x2882f1=_0x14c5f5['prepare'](_0x483868);try{_0x2882f1[_0x1f16c9(0x277)](_0x58df50),_0x2882f1[_0x1f16c9(0x168)](),_0x2882f1[_0x1f16c9(0x24f)]();const _0x27ef30=typeof _0x14c5f5[_0x1f16c9(0x225)+_0x1f16c9(0x1d9)]===_0x1f16c9(0x269)?_0x14c5f5[_0x1f16c9(0x225)+_0x1f16c9(0x1d9)]():undefined;return _0x27ef30!==undefined?{'changes':_0x27ef30}:undefined;}catch(_0x293a49){try{_0x2882f1[_0x1f16c9(0x24f)]();}catch(_0x52d1ce){}if(isUniqueConstraintError(_0x293a49)){const _0x48e082=getUniquePolicy();if(_0x48e082===_0x1f16c9(0x1f2))return debug(_0x1f16c9(0x227)+_0x1f16c9(0x1e1)+_0x1f16c9(0x230)+_0x1f16c9(0x253)+_0x1f16c9(0x10e)+_0x1f16c9(0x23b)+_0x1f16c9(0x26e)+String(_0x483868)['slice'](0x78d+0x1841+-0x17*0x162,0x837+0x23a5+0x1*-0x2a4c)),undefined;if(_0x48e082===_0x1f16c9(0x23a)&&looksLikeSimpleInsert(_0x483868)){const _0x2c3bee=_0x483868[_0x1f16c9(0x23a)](/^\s*INSERT\s+INTO/i,_0x1f16c9(0x122)+'REPLACE\x20IN'+'TO'),_0x2d2165=_0x14c5f5[_0x1f16c9(0x1a7)](_0x2c3bee);try{_0x2d2165[_0x1f16c9(0x277)](_0x58df50),_0x2d2165[_0x1f16c9(0x168)](),_0x2d2165['free'](),info(_0x1f16c9(0x287)+_0x1f16c9(0x249)+'g\x20INSERT\x20O'+_0x1f16c9(0x25e)+'for\x20run()\x20'+_0x1f16c9(0x189));const _0x48a0b9=typeof _0x14c5f5[_0x1f16c9(0x225)+'ified']===_0x1f16c9(0x269)?_0x14c5f5[_0x1f16c9(0x225)+'ified']():undefined;return _0x48a0b9!==undefined?{'changes':_0x48a0b9}:undefined;}catch(_0x3f5708){try{_0x2d2165[_0x1f16c9(0x24f)]();}catch(_0xdbf936){}throw _0x3f5708;}}}throw _0x293a49;}}}catch(_0x45cd57){throw _0x45cd57;}},async 'prepare'(_0x12ac57){const _0x3400ff=_0x3093;try{const _0x84029e=_0x14c5f5[_0x3400ff(0x1a7)](_0x12ac57);return{async 'run'(..._0x576d2d){const _0x2af1de=_0x3400ff;try{const _0x4eb850=normalizeBindParams(_0x576d2d);if(_0x4eb850!==undefined)_0x84029e[_0x2af1de(0x277)](_0x4eb850);_0x84029e[_0x2af1de(0x168)]();try{_0x84029e[_0x2af1de(0x1ed)]();}catch(_0x1b2cb5){}const _0x3eccde=typeof _0x14c5f5['getRowsMod'+_0x2af1de(0x1d9)]===_0x2af1de(0x269)?_0x14c5f5[_0x2af1de(0x225)+'ified']():undefined;return _0x3eccde!==undefined?{'changes':_0x3eccde}:undefined;}catch(_0x3503f8){if(isUniqueConstraintError(_0x3503f8)){const _0xfa291=getUniquePolicy();if(_0xfa291===_0x2af1de(0x1f2))return debug(_0x2af1de(0x227)+_0x2af1de(0x1e1)+'raint\x20erro'+_0x2af1de(0x128)+_0x2af1de(0x20c)+'ent\x20(polic'+'y=ignore):'+'\x20'+_0x12ac57),undefined;if(_0xfa291===_0x2af1de(0x23a)&&looksLikeSimpleInsert(_0x12ac57)){const _0x1b1b08=_0x12ac57[_0x2af1de(0x23a)](/^\s*INSERT\s+INTO/i,_0x2af1de(0x122)+_0x2af1de(0x150)+'TO'),_0x2363f2=_0x14c5f5['prepare'](_0x1b1b08);try{const _0x2d0a64=normalizeBindParams(_0x576d2d);if(_0x2d0a64!==undefined)_0x2363f2[_0x2af1de(0x277)](_0x2d0a64);_0x2363f2[_0x2af1de(0x168)](),_0x2363f2[_0x2af1de(0x24f)](),info(_0x2af1de(0x287)+_0x2af1de(0x249)+_0x2af1de(0x250)+_0x2af1de(0x25e)+_0x2af1de(0x222)+'ed\x20stateme'+_0x2af1de(0x1d0)+').');const _0x3dddee=typeof _0x14c5f5[_0x2af1de(0x225)+_0x2af1de(0x1d9)]===_0x2af1de(0x269)?_0x14c5f5['getRowsMod'+_0x2af1de(0x1d9)]():undefined;return _0x3dddee!==undefined?{'changes':_0x3dddee}:undefined;}catch(_0x49b8b7){try{_0x2363f2['free']();}catch(_0x328f58){}throw _0x49b8b7;}}}throw _0x3503f8;}},async 'finalize'(){const _0x593ecd=_0x3400ff;try{_0x84029e[_0x593ecd(0x24f)]();}catch(_0x406d3d){}}};}catch(_0x1f9156){throw _0x1f9156;}},'export'(){const _0x5074c5=_0x3093;try{return _0x14c5f5[_0x5074c5(0x212)]();}catch(_0x2dab82){throw _0x2dab82;}},async 'close'(){const _0x240803=_0x3093;try{if(typeof _0x14c5f5[_0x240803(0x194)]==='function')_0x14c5f5[_0x240803(0x194)]();else{if(typeof _0x14c5f5[_0x240803(0x24f)]===_0x240803(0x269))_0x14c5f5[_0x240803(0x24f)]();}}catch(_0xcf38f0){}}};}export async function initializeDatabase(){const _0x2e458a=_0x19a6f9;info(_0x2e458a(0x18a)+_0x2e458a(0x19f)+_0x2e458a(0x294)+_0x2e458a(0x11e)+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x1d5d15=getConfig();maxTotalBytes=_0x1d5d15[_0x2e458a(0x156)+'AX_BYTES']||(-0x2675*-0x1+-0x1c06+0xa3d*-0x1)*(0xaed+0x45b+-0xb48)*(-0x2187+0x8f5*0x4+0x1b3),cache=new MemoryCache(maxTotalBytes||(0x4*0x421+-0x2*-0x1f0+-0x1432)*(0x1*0x169c+0x16a7+-0xdc1*0x3)*(0x119*-0x5+0xc*0xdf+-0x1*0xf7));const _0x7f02aa=_0x1d5d15[_0x2e458a(0x234)+'OT']||process[_0x2e458a(0x184)](),_0x58ae11=_0x191ed9[_0x2e458a(0x21a)](_0x7f02aa,_0x1d5d15['DB_PATH']||_0x2e458a(0x15a));await _0x1cd368[_0x2e458a(0x135)](_0x58ae11);const _0x33159c=_0x1d5d15['DB_NAME']||_0x2e458a(0x239)+'qlite',_0x9ea9ab=_0x191ed9[_0x2e458a(0x211)](_0x58ae11,_0x33159c);let _0x32ccc5=![];try{let _0x2c27fe=null,_0x4f6a5f=null;try{_0x2c27fe=await import('sqlite3'),_0x4f6a5f=(await import('sqlite'))['open'];}catch(_0xb7e23c){_0x2c27fe=null,_0x4f6a5f=null;}if(_0x2c27fe&&_0x4f6a5f){await backupDB(_0x9ea9ab);const _0x273b66=_0x2c27fe[_0x2e458a(0x176)]||_0x2c27fe,_0x4af494=await _0x4f6a5f({'filename':_0x9ea9ab,'driver':_0x273b66[_0x2e458a(0x26c)]});try{await _0x4af494[_0x2e458a(0x1c8)](_0x2e458a(0x1b0)+_0x2e458a(0x209)+'=\x20WAL;');}catch(_0x5bf7c5){}try{await _0x4af494['exec'](_0x2e458a(0x11c)+_0x2e458a(0x178)+_0x2e458a(0x23c));}catch(_0x1d5f57){}try{await _0x4af494['exec'](_0x2e458a(0x262)+_0x2e458a(0x172)+_0x2e458a(0x232));}catch(_0x2b6226){}try{await _0x4af494['exec'](_0x2e458a(0x231)+_0x2e458a(0x1a4)+_0x2e458a(0x1df));}catch(_0x52e130){}adapter=createNativeAdapter(_0x4af494),db=adapter,usingNative=!![],_0x32ccc5=!![],info(_0x2e458a(0x1d6)+_0x2e458a(0x190)+_0x2e458a(0x22b));}}catch(_0x3951e1){warn(_0x2e458a(0x10b)+'ite\x20init\x20f'+'ailed,\x20wil'+'l\x20attempt\x20'+'SQL.js\x20fal'+'lback.\x20'+(_0x3951e1?.[_0x2e458a(0x25a)]||_0x3951e1)),_0x32ccc5=![],adapter=null,db=null,usingNative=![];}if(!_0x32ccc5)try{const _0x7cfe31=await import('sql.js'),_0x32f553=_0x7cfe31[_0x2e458a(0x176)]||_0x7cfe31,_0x25a4ec=await _0x32f553({'locateFile':_0x38ffbc=>{const _0x5480b6=_0x2e458a,_0x1a9e23=_0x1d5d15['SQLJS_WASM'+_0x5480b6(0x28c)];if(_0x1a9e23)return _0x1a9e23;return _0x191ed9[_0x5480b6(0x211)](process['cwd'](),_0x5480b6(0x22c)+'es',_0x5480b6(0x1bc),_0x5480b6(0x158),_0x38ffbc);}});let _0x3e1200;if(await _0x1cd368['pathExists'](_0x9ea9ab)){const _0x5f50f5=await _0x1cd368['readFile'](_0x9ea9ab),_0x2af61=new Uint8Array(_0x5f50f5);_0x3e1200=new _0x25a4ec[(_0x2e458a(0x26c))](_0x2af61),info('Loaded\x20DB\x20'+_0x2e458a(0x24e)+_0x2e458a(0x165)+'m\x20'+_0x9ea9ab);}else _0x3e1200=new _0x25a4ec[(_0x2e458a(0x26c))](),info(_0x2e458a(0x136)+'w\x20in-memor'+'y\x20SQL.js\x20D'+_0x2e458a(0xf7)+_0x2e458a(0xf8));adapter=createSQLjsAdapter(_0x3e1200),db=adapter,usingNative=![],info(_0x2e458a(0x108)+_0x2e458a(0x12f)+'adapter.');}catch(_0xfc07c4){error(_0x2e458a(0x17f)+'lback\x20fail'+_0x2e458a(0x109),_0xfc07c4);throw _0xfc07c4;}try{if(adapter&&typeof adapter[_0x2e458a(0x1c8)]===_0x2e458a(0x269))await adapter[_0x2e458a(0x1c8)]('PRAGMA\x20for'+_0x2e458a(0x1a4)+_0x2e458a(0x1df));}catch(_0x77dddc){}try{if(adapter&&typeof adapter['exec']==='function')await adapter[_0x2e458a(0x1c8)]('PRAGMA\x20bus'+_0x2e458a(0x172)+_0x2e458a(0x232));}catch(_0x14179d){}await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=writeQueue||[],queueBytes=queueBytes||-0x29*0x57+0x1*0x25b1+-0x17c2;const _0x576677=_0x1d5d15[_0x2e458a(0x16d)+'NTERVAL']||-0x1484+0x2564+-0x910;flushTimer=setInterval(()=>{const _0x44589e=_0x2e458a;flushQueue()['catch'](_0x54857f=>error(_0x44589e(0x18c)+'error\x20duri'+_0x44589e(0x285)+_0x44589e(0x293)+_0x44589e(0x236),_0x54857f));},_0x576677),info('Database\x20i'+_0x2e458a(0x1c7)+'\x20('+(usingNative?_0x2e458a(0x179)+_0x2e458a(0x191):_0x2e458a(0x251))+(').\x20Backing'+_0x2e458a(0x1b5))+_0x9ea9ab);try{(function _0x44d127(){setTimeout(async()=>{const _0x34a575=_0x3093;try{if(!dbReady||!adapter)return _0x44d127();if(adapter&&typeof adapter[_0x34a575(0x183)]===_0x34a575(0x269))try{await adapter[_0x34a575(0x183)](_0x34a575(0x161)+_0x34a575(0x157));}catch(_0x176027){throw _0x176027;}else{if(adapter&&typeof adapter[_0x34a575(0x1c8)]===_0x34a575(0x269))try{await adapter[_0x34a575(0x1c8)](_0x34a575(0x286));}catch(_0x2ce891){throw _0x2ce891;}}}catch(_0x2b5360){isDbClosedError(_0x2b5360)?(warn(_0x34a575(0x25d)+_0x34a575(0x235)+_0x34a575(0x205)+'\x20DB;\x20sched'+_0x34a575(0x192)+_0x34a575(0x1e0)),await scheduleReinitializeAfterError(_0x2b5360)):debug(_0x34a575(0x25d)+_0x34a575(0x1b2)+_0x34a575(0x118)+_0x34a575(0x134),_0x2b5360?.['message']||_0x2b5360);}finally{_0x44d127();}},(-0x2db+-0x51e+0x835)*(0x21ae+0xf26*-0x1+-0xea0));}());}catch(_0x2b8de3){}}catch(_0x1abac7){error(_0x2e458a(0x198)+_0x2e458a(0x17c)+(_0x1abac7?.['message']||_0x1abac7),_0x1abac7);throw _0x1abac7;}}async function prepareStatements(){const _0x1884e1=_0x19a6f9;if(!adapter)throw new Error(_0x1884e1(0x164)+'t\x20availabl'+_0x1884e1(0x1af)+'areStateme'+'nts()');if(setStmt){try{await setStmt['finalize']();}catch(_0x468506){}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x1884e1(0x1fb)]();}catch(_0x5e397d){}deleteStmt=null;}try{setStmt=await adapter[_0x1884e1(0x1a7)](_0x1884e1(0x122)+'REPLACE\x20IN'+_0x1884e1(0x1b7)+'ue_store\x20('+'key,\x20value'+_0x1884e1(0x1f5)+_0x1884e1(0x221)),deleteStmt=await adapter[_0x1884e1(0x1a7)]('DELETE\x20FRO'+_0x1884e1(0x20d)+_0x1884e1(0x284)+_0x1884e1(0x26b)+'?'),info(_0x1884e1(0x219)+_0x1884e1(0x244)+_0x1884e1(0x15d)+_0x1884e1(0x22f));}catch(_0x44deb8){if(isDbClosedError(_0x44deb8)){warn(_0x1884e1(0x28f)+_0x1884e1(0x1cf)+_0x1884e1(0x1f3)+_0x1884e1(0x1dc)+_0x1884e1(0x1be));throw _0x44deb8;}error(_0x1884e1(0x18f)+_0x1884e1(0x263)+_0x1884e1(0x258)+'s:',_0x44deb8);throw _0x44deb8;}}async function applyMigrations(){const _0x2ec4c5=_0x19a6f9;if(!adapter)throw new Error('adapter\x20no'+'t\x20availabl'+_0x2ec4c5(0x207)+_0x2ec4c5(0x1e9)+_0x2ec4c5(0x22d));await adapter[_0x2ec4c5(0x1c8)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20key'+'_value_sto'+'re\x20(key\x20TE'+'XT\x20PRIMARY'+_0x2ec4c5(0x210)+'e\x20TEXT);'),await adapter[_0x2ec4c5(0x1c8)](_0x2ec4c5(0x255)+'LE\x20IF\x20NOT\x20'+_0x2ec4c5(0x272)+'s\x20(ts\x20INTE'+_0x2ec4c5(0x1bd)+_0x2ec4c5(0x1cd)+_0x2ec4c5(0x1de)+_0x2ec4c5(0x124)+_0x2ec4c5(0x257)+'TEXT);'),await adapter[_0x2ec4c5(0x1c8)](_0x2ec4c5(0x1c4)+_0x2ec4c5(0x1e2)+'\x20NOT\x20EXIST'+_0x2ec4c5(0x166)+_0x2ec4c5(0x154)+_0x2ec4c5(0x1b9)+_0x2ec4c5(0x1f1)+_0x2ec4c5(0x1c9)+_0x2ec4c5(0x218)+'T\x20NOT\x20NULL'+_0x2ec4c5(0x229)+'\x27,\x0a\x20\x20\x20\x20\x20\x20c'+'hat_id\x20TEX'+_0x2ec4c5(0x1f1)+_0x2ec4c5(0x229)+'[]\x27,\x0a\x20\x20\x20\x20\x20'+_0x2ec4c5(0x1d7)+_0x2ec4c5(0x105)+'\x20NULL\x20DEFA'+_0x2ec4c5(0x274)+_0x2ec4c5(0x167)+_0x2ec4c5(0x213)+'e,\x20group_i'+'d)\x0a\x20\x20\x20\x20);\x0a'+'\x20\x20'),await adapter[_0x2ec4c5(0x1c8)](_0x2ec4c5(0x1c4)+_0x2ec4c5(0x1e2)+_0x2ec4c5(0x28b)+_0x2ec4c5(0x140)+_0x2ec4c5(0x21e)+_0x2ec4c5(0x133)+_0x2ec4c5(0x1f6)+'RIMARY\x20KEY'+_0x2ec4c5(0x125)+_0x2ec4c5(0x240)+_0x2ec4c5(0x264)+_0x2ec4c5(0x19e)+'\x20\x20\x20\x20);\x0a\x20\x20'),await adapter['exec'](_0x2ec4c5(0x1c4)+_0x2ec4c5(0x1e2)+_0x2ec4c5(0x28b)+_0x2ec4c5(0x102)+_0x2ec4c5(0x267)+_0x2ec4c5(0x224)+_0x2ec4c5(0x169)+_0x2ec4c5(0x138)+_0x2ec4c5(0x197)+_0x2ec4c5(0x208)+_0x2ec4c5(0x1ec)+_0x2ec4c5(0x10a)+';\x0a\x20\x20'),await adapter[_0x2ec4c5(0x1c8)]('\x0a\x20\x20\x20\x20CREAT'+_0x2ec4c5(0x1e2)+_0x2ec4c5(0x28b)+_0x2ec4c5(0x130)+_0x2ec4c5(0x266)+_0x2ec4c5(0x24a)+_0x2ec4c5(0x1bd)+_0x2ec4c5(0x111)+_0x2ec4c5(0x104)+_0x2ec4c5(0x105)+_0x2ec4c5(0x24d)+_0x2ec4c5(0x271)+'d\x20TEXT,\x0a\x20\x20'+_0x2ec4c5(0x112)+_0x2ec4c5(0x201)+_0x2ec4c5(0x163)+_0x2ec4c5(0x260)+_0x2ec4c5(0x11f)+_0x2ec4c5(0x12b)+'\x0a\x20\x20\x20\x20\x20\x20mes'+_0x2ec4c5(0xfc)+'\x20INTEGER\x20D'+'EFAULT\x200,\x0a'+_0x2ec4c5(0x256)+_0x2ec4c5(0x1a6)+_0x2ec4c5(0x173)+_0x2ec4c5(0x1ad)+_0x2ec4c5(0x278)+_0x2ec4c5(0x117)+'\x20'),await adapter[_0x2ec4c5(0x1c8)](_0x2ec4c5(0x1ac)+_0x2ec4c5(0x22a)+'IF\x20NOT\x20EXI'+_0x2ec4c5(0x1a0)+_0x2ec4c5(0x1e4)+_0x2ec4c5(0x1b6)+_0x2ec4c5(0x270)+_0x2ec4c5(0x200)+_0x2ec4c5(0x27c)+'ame,\x20bucke'+'t_key);');}async function flushQueue(){const _0x3020c6=_0x19a6f9;if(!dbReady||isFlushing||writeQueue['length']===0x1b0b+0x1d2f+0x2*-0x1c1d)return;const _0x1b52b2=writeQueue[0x1a10+-0x234b+0x11*0x8b];if(_0x1b52b2&&_0x1b52b2[_0x3020c6(0x144)]>0x51*0x47+0xdb*-0xf+-0x9a2&&Date[_0x3020c6(0x1f9)]()-_0x1b52b2[_0x3020c6(0x15f)]<-0x7cc+-0xe5*0x1+0x5f*0x37)return;if(!setStmt||!deleteStmt)try{if(!adapter)throw new Error(_0x3020c6(0x259)+'\x20available'+_0x3020c6(0x252)+'e\x20statemen'+_0x3020c6(0x27b));await prepareStatements();}catch(_0x12ffa2){if(isDbClosedError(_0x12ffa2)){warn(_0x3020c6(0x139)+'while\x20prep'+_0x3020c6(0x120)+_0x3020c6(0x26f)+'heduling\x20r'+'einit.'),await scheduleReinitializeAfterError(_0x12ffa2);return;}else{error(_0x3020c6(0x18f)+_0x3020c6(0x13d)+_0x3020c6(0x175)+_0x3020c6(0x27e)+_0x3020c6(0x18d),_0x12ffa2);return;}}isFlushing=!![];const _0x1edc20=getConfig(),_0x42157e=_0x1edc20['DB_BATCH_S'+_0x3020c6(0x282)]||-0x977*-0x2+0x14c0+-0x277c,_0x557ce4=writeQueue['splice'](0x2062+0x26ce+-0x22*0x218,_0x42157e),_0x517591=_0x557ce4['reduce']((_0x2d3431,_0x18c974)=>_0x2d3431+(_0x18c974[_0x3020c6(0x1a1)]||0x45*-0x7f+-0x1ed6+-0x4111*-0x1),-0x2520+-0xd10+-0x1*-0x3230);try{if(adapter&&typeof adapter[_0x3020c6(0x1c8)]==='function')await adapter['exec'](_0x3020c6(0x142)+_0x3020c6(0x223));for(const _0x578d0e of _0x557ce4){try{switch(_0x578d0e[_0x3020c6(0x1eb)]){case _0x3020c6(0x237):if(!setStmt)throw new Error(_0x3020c6(0x171)+_0x3020c6(0x1c2));await setStmt['run'](_0x578d0e[_0x3020c6(0x1a3)],_0x578d0e['value']);break;case _0x3020c6(0x20e):if(!deleteStmt)throw new Error(_0x3020c6(0x261)+'\x20missing');await deleteStmt[_0x3020c6(0x168)](_0x578d0e[_0x3020c6(0x1a3)]);break;default:warn('Unknown\x20qu'+'eue\x20item\x20t'+_0x3020c6(0x23f)+_0x3020c6(0x13a)+_0x578d0e[_0x3020c6(0x1eb)]);}}catch(_0x32ff4a){if(isDbClosedError(_0x32ff4a))throw _0x32ff4a;error(_0x3020c6(0x18f)+_0x3020c6(0x25f)+_0x3020c6(0x242)+_0x3020c6(0x20a)+'ed\x20by\x20tran'+_0x3020c6(0x203)+'llback:\x20'+JSON['stringify'](_0x578d0e)+(_0x3020c6(0x19d)+'\x20')+(_0x32ff4a?.[_0x3020c6(0x25a)]||_0x32ff4a));throw _0x32ff4a;}}if(adapter&&typeof adapter[_0x3020c6(0x1c8)]===_0x3020c6(0x269))await adapter[_0x3020c6(0x1c8)](_0x3020c6(0x25c));if(!usingNative)try{await persistDatabaseToFile();}catch(_0x270a96){error(_0x3020c6(0x18f)+'persist\x20DB'+_0x3020c6(0x143)+_0x3020c6(0x180),_0x270a96);}queueBytes=Math[_0x3020c6(0x27f)](-0x443*-0x6+0x25a+-0xdf6*0x2,queueBytes-_0x517591),reinitBackoffMs=0x160f+-0x12a*0x1f+0x11ef*0x1;}catch(_0x3c9f48){if(isDbClosedError(_0x3c9f48)){error(_0x3020c6(0x1a5)+_0x3020c6(0x186)+_0x3020c6(0x14d)+_0x3020c6(0x13b)+_0x3020c6(0x1c3)+_0x3020c6(0x188)+_0x3020c6(0x1db),_0x3c9f48);try{if(adapter&&typeof adapter[_0x3020c6(0x1c8)]===_0x3020c6(0x269))await adapter['exec'](_0x3020c6(0x21b));}catch(_0x111116){}writeQueue[_0x3020c6(0x28a)](..._0x557ce4),await scheduleReinitializeAfterError(_0x3c9f48);}else{error('DB\x20flush\x20t'+_0x3020c6(0x115)+_0x3020c6(0x1c6)+_0x3020c6(0x24c)+_0x3020c6(0x228)+_0x3020c6(0x1a9)+_0x3020c6(0x280),_0x3c9f48);try{if(adapter&&typeof adapter['exec']===_0x3020c6(0x269))await adapter[_0x3020c6(0x1c8)](_0x3020c6(0x21b));}catch(_0x8453b6){error(_0x3020c6(0x100)+_0x3020c6(0x246),_0x8453b6);}const _0x41e59a=Date[_0x3020c6(0x1f9)](),_0x1b5593=[];for(const _0x2271a9 of _0x557ce4){_0x2271a9[_0x3020c6(0x144)]=(_0x2271a9[_0x3020c6(0x144)]||0xdea+0x39*-0x8b+-0x1109*-0x1)+(-0xaf7+0x372*-0x1+0xe6a),_0x2271a9[_0x3020c6(0x15f)]=_0x41e59a;if(_0x2271a9['retries']<-0x1*0x4a9+-0x46*0xd+0x839)_0x1b5593[_0x3020c6(0x10d)](_0x2271a9);else error(_0x3020c6(0x281)+_0x3020c6(0x113)+_0x3020c6(0x25b)+_0x3020c6(0x11a)+_0x3020c6(0x15b)+_0x3020c6(0x10f)+JSON['stringify'](_0x2271a9));}if(_0x1b5593['length']>-0xe*0x1a6+-0x3*0x96b+0x3355)writeQueue[_0x3020c6(0x28a)](..._0x1b5593);queueBytes=Math[_0x3020c6(0x27f)](0x972+0x2*-0xa41+-0x30*-0x3b,queueBytes-_0x517591+_0x1b5593[_0x3020c6(0x1c5)]((_0x89b7dd,_0x5f3ff1)=>_0x89b7dd+(_0x5f3ff1[_0x3020c6(0x1a1)]||0xbee*0x1+0x2539+-0x3127),0x3*0x50e+0x685+0x3d*-0x5b));}}finally{isFlushing=![];}}async function persistDatabaseToFile(){const _0x16d4a=_0x19a6f9,_0x175f9d=getConfig(),_0x3351a8=_0x175f9d[_0x16d4a(0x234)+'OT']||process['cwd'](),_0x9e71bf=_0x191ed9[_0x16d4a(0x21a)](_0x3351a8,_0x175f9d[_0x16d4a(0x131)]||_0x16d4a(0x15a)),_0xb4c8b=_0x175f9d[_0x16d4a(0x217)]||'database.s'+'qlite',_0x3fee83=_0x191ed9[_0x16d4a(0x211)](_0x9e71bf,_0xb4c8b);if(usingNative)return;if(!adapter){warn(_0x16d4a(0x106)+_0x16d4a(0x268)+_0x16d4a(0x12c)+_0x16d4a(0x298)+_0x16d4a(0x15c)+_0x16d4a(0x1e6));return;}try{const _0x4732ca=adapter[_0x16d4a(0x212)]();if(!_0x4732ca)return;const _0x197c56=_0x3fee83+_0x16d4a(0x19a);await _0x1cd368['writeFile'](_0x197c56,Buffer[_0x16d4a(0x216)](_0x4732ca)),await _0x1cd368[_0x16d4a(0x283)](_0x197c56,_0x3fee83,{'overwrite':!![]}),info(_0x16d4a(0xf4)+_0x16d4a(0x275)+'o\x20'+_0x3fee83);}catch(_0x37af65){if(isDbClosedError(_0x37af65)){warn(_0x16d4a(0x106)+_0x16d4a(0x268)+_0x16d4a(0x1ae)+_0x16d4a(0x1dd)+'ed\x20DB.\x20Sch'+_0x16d4a(0x1ef)+_0x16d4a(0x1ee)),await scheduleReinitializeAfterError(_0x37af65);return;}throw _0x37af65;}}export async function get(_0x30820f){const _0x665807=_0x19a6f9;try{if(cache&&cache[_0x665807(0x1e5)](_0x30820f))return cache[_0x665807(0x183)](_0x30820f);}catch(_0x54e8f1){}if(!dbReady||!adapter)return warn(_0x665807(0x1d4)+_0x665807(0x14c)+_0x665807(0x119)+'.'),undefined;try{const _0x2e9a0d=await adapter['get']('SELECT\x20val'+'ue\x20FROM\x20ke'+_0x665807(0x17e)+_0x665807(0x1ca)+_0x665807(0x289),_0x30820f);if(_0x2e9a0d&&_0x2e9a0d[_0x665807(0x1bb)]!=null)try{const _0x2c7b8e=JSON[_0x665807(0x126)](_0x2e9a0d['value']);try{cache[_0x665807(0x237)](_0x30820f,_0x2c7b8e,_0x2e9a0d[_0x665807(0x1bb)]);}catch(_0x41043d){}return _0x2c7b8e;}catch(_0x35f911){return error(_0x665807(0x18f)+_0x665807(0x132)+_0x665807(0x162)+_0x665807(0x15e)+_0x30820f+'\x22:\x20'+(_0x35f911?.[_0x665807(0x25a)]||_0x35f911)),undefined;}}catch(_0x39838f){isDbClosedError(_0x39838f)?(warn(_0x665807(0x1e8)+_0x665807(0x147)+'\x20DB\x20is\x20clo'+_0x665807(0x241)+_0x665807(0x192)+_0x665807(0x1f8)+_0x30820f),await scheduleReinitializeAfterError(_0x39838f)):error('Failed\x20to\x20'+_0x665807(0x1d5)+_0x30820f+(_0x665807(0x21c)+'\x20')+(_0x39838f?.[_0x665807(0x25a)]||_0x39838f),_0x39838f);}return undefined;}export function set(_0x4ad9f1,_0x5f3ca7){const _0x101429=_0x19a6f9;if(_0x5f3ca7===undefined){del(_0x4ad9f1);return;}let _0x244780;try{_0x244780=JSON[_0x101429(0x24b)](_0x5f3ca7);}catch(_0x42a4ee){error('Value\x20for\x20'+_0x101429(0xf3)+_0x4ad9f1+(_0x101429(0x146)+_0x101429(0x148)+'e;\x20skippin'+_0x101429(0x13c)),_0x42a4ee);return;}try{cache[_0x101429(0x237)](_0x4ad9f1,_0x5f3ca7,_0x244780);}catch(_0x5ee52d){}const _0xf184dc={'type':_0x101429(0x237),'key':_0x4ad9f1,'value':_0x244780,'retries':0x0,'timestamp':Date[_0x101429(0x1f9)]()};_0xf184dc[_0x101429(0x1a1)]=estimateQueueItemSize(_0xf184dc),queueBytes+=_0xf184dc['size'],writeQueue[_0x101429(0x10d)](_0xf184dc),enforceMemoryLimit(),writeQueue[_0x101429(0x101)]>=getConfig()[_0x101429(0xfb)+'IZE']&&flushQueue()[_0x101429(0x26a)](_0x4a867b=>{const _0x37cd35=_0x101429;error(_0x37cd35(0xfa)+_0x37cd35(0x26d)+'eue\x20trigge'+_0x37cd35(0x152)+'():',_0x4a867b);});}export function del(_0x553842){const _0x17bb94=_0x19a6f9;try{cache['delete'](_0x553842);}catch(_0x4700f9){}const _0x1b941e={'type':_0x17bb94(0x20e),'key':_0x553842,'retries':0x0,'timestamp':Date[_0x17bb94(0x1f9)]()};_0x1b941e['size']=estimateQueueItemSize(_0x1b941e),queueBytes+=_0x1b941e[_0x17bb94(0x1a1)],writeQueue[_0x17bb94(0x10d)](_0x1b941e),enforceMemoryLimit(),writeQueue['length']>=getConfig()[_0x17bb94(0xfb)+'IZE']&&flushQueue()['catch'](_0x18bcd4=>{const _0x89dfd1=_0x17bb94;error(_0x89dfd1(0xfa)+_0x89dfd1(0x26d)+'eue\x20trigge'+_0x89dfd1(0x11d)+_0x89dfd1(0x103),_0x18bcd4);});}export async function shutdownDatabase(){const _0x5410a3=_0x19a6f9;info(_0x5410a3(0x291)+_0x5410a3(0x1f4)+_0x5410a3(0x273)+'iated.\x20Flu'+_0x5410a3(0x276)+_0x5410a3(0x23e)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);try{await flushQueue(),await flushQueue(),info(_0x5410a3(0x1c0)+_0x5410a3(0x288)+'d.');}catch(_0x1c7c7a){error(_0x5410a3(0xfa)+_0x5410a3(0x127)+_0x5410a3(0x247)+_0x5410a3(0xf9),_0x1c7c7a);}if(setStmt){try{await setStmt[_0x5410a3(0x1fb)]();}catch(_0x231417){warn(_0x5410a3(0x153)+_0x5410a3(0x1cc)+_0x5410a3(0x20f)+_0x5410a3(0x27d)+':',_0x231417);}setStmt=null;}if(deleteStmt){try{await deleteStmt[_0x5410a3(0x1fb)]();}catch(_0x187f28){warn(_0x5410a3(0x153)+_0x5410a3(0x1ff)+_0x5410a3(0x141)+_0x5410a3(0x185)+_0x5410a3(0x110),_0x187f28);}deleteStmt=null;}try{await persistDatabaseToFile();}catch(_0x37cda7){error(_0x5410a3(0x1e3)+_0x5410a3(0x16b)+_0x5410a3(0x12e)+_0x5410a3(0x27d)+':',_0x37cda7);}if(adapter){try{await adapter['close'](),info(_0x5410a3(0x220)+_0x5410a3(0x238)+_0x5410a3(0x214)+_0x5410a3(0x16c));}catch(_0x560c5f){error(_0x5410a3(0xfa)+'ng\x20final\x20d'+_0x5410a3(0x1fa)+_0x5410a3(0x1a2),_0x560c5f);}adapter=null,db=null;}info('Database\x20s'+'hutdown\x20pr'+_0x5410a3(0x181)+_0x5410a3(0x137)+'essfully.');}async function backupDB(_0x12ce56){const _0x43412c=_0x19a6f9;try{if(!await _0x1cd368[_0x43412c(0x28d)](_0x12ce56))return;const _0x45c5cb=_0x191ed9[_0x43412c(0x1b8)](_0x12ce56),_0x12160e=_0x191ed9[_0x43412c(0x17a)](_0x12ce56,_0x191ed9[_0x43412c(0x1fc)](_0x12ce56)),_0x38acba=_0x191ed9[_0x43412c(0x211)](_0x45c5cb,_0x12160e+_0x43412c(0x1f7)),_0x362d07=await _0x1cd368[_0x43412c(0x28d)](_0x38acba)?await _0x1cd368[_0x43412c(0x23d)](_0x38acba):null,_0x28cc86=_0x362d07?Date[_0x43412c(0x1f9)]()-_0x362d07[_0x43412c(0x187)]:Infinity;_0x28cc86>(0xf7*0x22+-0x1da+0x1edc*-0x1)*(-0x1d2*0x12+0x1*-0xcb5+-0x2db5*-0x1)*(0x11c5+-0x1*0x21a6+0x101d)*(-0x1*-0x48d+0x1d6b+-0x1e10)&&(await _0x1cd368[_0x43412c(0x1ce)](_0x12ce56,_0x38acba,{'overwrite':!![]}),info(_0x43412c(0x116)+_0x43412c(0x155)+_0x43412c(0x1ab)+_0x38acba));}catch(_0x4595ff){error(_0x43412c(0x116)+_0x43412c(0x11b)+_0x43412c(0x1b3)+(_0x4595ff?.[_0x43412c(0x25a)]||_0x4595ff),_0x4595ff);}}process[_0x19a6f9(0x21d)](_0x19a6f9(0x226),()=>{const _0x211acb=_0x19a6f9;shutdownDatabase()[_0x211acb(0x123)](()=>process['exit'](0x192d+-0x10d9+-0x854));}),process['once']('SIGTERM',()=>{const _0x512d0a=_0x19a6f9;shutdownDatabase()[_0x512d0a(0x123)](()=>process['exit'](-0x5f8+0xd9a+-0x7a2));});export{adapter as _adapter};