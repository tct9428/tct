const _0x26d59d=_0x3b77;(function(_0x189b01,_0x5e6dc7){const _0x5a01e2=_0x3b77,_0x5c2a14=_0x189b01();while(!![]){try{const _0xdc76a6=-parseInt(_0x5a01e2(0x1a0))/(0x677*-0x5+-0x39e+0x23f2)+parseInt(_0x5a01e2(0x80))/(0x7b*-0xe+0x2*0x2a1+0x17a)+-parseInt(_0x5a01e2(0x123))/(0x25f3+0x250a+-0x4afa)+-parseInt(_0x5a01e2(0x154))/(0x81*0x47+0x1*0x5fc+-0x29bf)*(parseInt(_0x5a01e2(0xbd))/(-0x757*-0x1+0xe19+-0x156b))+-parseInt(_0x5a01e2(0x105))/(0x2419*0x1+-0x410+-0x37*0x95)+parseInt(_0x5a01e2(0x109))/(0x1*0xdc7+0x2f*-0xb4+0x134c)*(-parseInt(_0x5a01e2(0x195))/(-0xdc8+0x1379*0x1+-0x5a9))+parseInt(_0x5a01e2(0x1b9))/(0x10c*-0x1a+0x1d*0x11a+-0x1*0x4b1);if(_0xdc76a6===_0x5e6dc7)break;else _0x5c2a14['push'](_0x5c2a14['shift']());}catch(_0x4a619d){_0x5c2a14['push'](_0x5c2a14['shift']());}}}(_0x5b51,0x777a*-0x18+0x5c33*0x16+0x601bb*0x2));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x26d59d(0x75);export const version=_0x26d59d(0x124);export const priority=0xef*-0x7+0x1112+-0x1*0xa2f;export const commands=[_0x26d59d(0x75),_0x26d59d(0x189)];let botRef=null,sendApi=null;const DEFAULTS={'TIME_ZONE':_0x26d59d(0xd9),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(-0x13e6+-0x6d7*0x5+0x3637)*(0x35*0x43+-0xb4b+0x4*0x55)};let CONFIG={...DEFAULTS};function normalizeJid(_0xe23359){const _0x400692=_0x26d59d;return _0xe23359?String(_0xe23359)[_0x400692(0xab)]():'';}function sleep(_0x2f38e1){return new Promise(_0x24460e=>setTimeout(_0x24460e,_0x2f38e1));}function toLowerRoman(_0x5b2c1f){const _0x25ff48=_0x26d59d,_0x3f4ebf=[[-0x2055+-0x1ded*0x1+0x422a,'M'],[0x25*-0x23+0x8c8+-0x35,'CM'],[0x26b3+-0x194e+-0x1*0xb71,'D'],[-0xba*0x5+0x1f9c+-0x2a*0xa1,'CD'],[-0x1736*0x1+-0x8fa+0x2094,'C'],[0x133*-0x5+-0x4*0x67f+0x2055,'XC'],[0x1417+0x2*-0x509+-0x9d3,'L'],[-0x34*-0x47+0x1371+-0x21b5*0x1,'XL'],[-0xb*0x133+-0x491+-0x4*-0x473,'X'],[0x1*0x70+-0x1*0x21c1+0x215a*0x1,'IX'],[0x646+-0x2*-0x12c7+-0x2bcf,'V'],[0x1a32*-0x1+-0x1f45+0x397b,'IV'],[-0x11b*-0x11+0x23f9+-0x1241*0x3,'I']];let _0x197ef2=_0x5b2c1f,_0x37c068='';for(const [_0x24fb64,_0x4a2efb]of _0x3f4ebf)while(_0x197ef2>=_0x24fb64){_0x37c068+=_0x4a2efb,_0x197ef2-=_0x24fb64;}return _0x37c068[_0x25ff48(0x1b0)+'e']();}function romanParen(_0x39f983){return'('+toLowerRoman(_0x39f983)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x1abcda){const _0x4f826b=_0x26d59d,_0x4a6006=_0x1abcda?.[_0x4f826b(0xa9)];if(!_0x4a6006)return null;const _0x31b12b=_0x4a6006['id']||_0x4a6006[_0x4f826b(0x1b3)+'t']||'',_0x4ec768=_0x4a6006['remoteJid']||'';return _0x4ec768+'::'+_0x31b12b;}function isMsgProcessed(_0x46505b){const _0x45bd4d=_0x26d59d;return _0x46505b&&processedMessageKeys[_0x45bd4d(0x152)](_0x46505b);}function markMsgProcessed(_0xd2fd1){const _0x43ca2a=_0x26d59d;if(!_0xd2fd1)return;if(processedMessageKeys[_0x43ca2a(0x152)](_0xd2fd1))clearTimeout(processedMessageKeys['get'](_0xd2fd1));const _0xfde4d3=setTimeout(()=>processedMessageKeys[_0x43ca2a(0xf4)](_0xd2fd1),CONFIG['DEDUPE_TTL'+_0x43ca2a(0x165)]);processedMessageKeys[_0x43ca2a(0x14b)](_0xd2fd1,_0xfde4d3);}async function ensureSchema(){const _0x22b791=_0x26d59d;try{await db[_0x22b791(0x1b5)](_0x22b791(0xb1)+_0x22b791(0x16f)+_0x22b791(0xbc)+_0x22b791(0xb4)+_0x22b791(0x14d)+_0x22b791(0x13a)+_0x22b791(0x18e)+_0x22b791(0x17f)+_0x22b791(0x7c)+_0x22b791(0x19d)+_0x22b791(0x19b)+'me(\x27%s\x27,\x27n'+_0x22b791(0x1b8)),await db[_0x22b791(0x1b5)](_0x22b791(0xb8)+_0x22b791(0x10e)+'IF\x20NOT\x20EXI'+_0x22b791(0xda)+_0x22b791(0x18b)+'\x20\x20\x20\x20\x20\x20\x20id\x20'+_0x22b791(0x135)+_0x22b791(0x96)+'AUTOINCREM'+_0x22b791(0x1c2)+_0x22b791(0xeb)+_0x22b791(0x15e)+'\x20NULL,\x0a\x20\x20\x20'+_0x22b791(0xdf)+_0x22b791(0x6b)+_0x22b791(0x1a7)+_0x22b791(0x113)+_0x22b791(0x1ae)+_0x22b791(0x164)+_0x22b791(0x172)+_0x22b791(0xfe)+_0x22b791(0x72)+_0x22b791(0x155)+'yearly\x27\x0a\x20\x20'+_0x22b791(0x17d)+_0x22b791(0xa1)+_0x22b791(0x164)+_0x22b791(0xc4)+_0x22b791(0x1bc)+'Y-MM-DD,\x20w'+_0x22b791(0xf6)+_0x22b791(0x1c0)+'hly:\x20YYYY-'+_0x22b791(0x74)+':\x20YYYY\x0a\x20\x20\x20'+_0x22b791(0xd4)+_0x22b791(0x194)+_0x22b791(0x131)+_0x22b791(0x139)+_0x22b791(0xb2)+_0x22b791(0x14e)+_0x22b791(0x11c)+_0x22b791(0xcd)+_0x22b791(0x128)+'pdated\x20INT'+_0x22b791(0x19d)+'LT\x20(strfti'+_0x22b791(0xac)+'ow\x27)),\x0a\x20\x20\x20'+_0x22b791(0xc3)+_0x22b791(0xf3)+_0x22b791(0x103)+_0x22b791(0xe6)+_0x22b791(0xd8)+_0x22b791(0xf0)+_0x22b791(0x173)),await db['exec'](_0x22b791(0xe7)+'EX\x20IF\x20NOT\x20'+_0x22b791(0x112)+_0x22b791(0x100)+'ats_chat_t'+_0x22b791(0x81)+_0x22b791(0x14a)+_0x22b791(0x1bb)+_0x22b791(0x160)+_0x22b791(0x73)+';'),await db[_0x22b791(0x1b5)]('CREATE\x20IND'+_0x22b791(0xcc)+_0x22b791(0x112)+_0x22b791(0x100)+_0x22b791(0x10c)+_0x22b791(0x192)+_0x22b791(0x171)+_0x22b791(0x1c3)+_0x22b791(0x6e)),await db[_0x22b791(0x1b5)](_0x22b791(0xb8)+_0x22b791(0x10e)+_0x22b791(0x1b6)+_0x22b791(0xda)+_0x22b791(0x19c)+'rd_message'+_0x22b791(0x117)+_0x22b791(0x13c)+_0x22b791(0x116)+_0x22b791(0x88)+_0x22b791(0x16a)+_0x22b791(0x8f)+_0x22b791(0x1a1)+_0x22b791(0xc2)),info('[active]\x20s'+_0x22b791(0x1c1)+_0x22b791(0x18c));}catch(_0x4f8b96){error(_0x4f8b96,_0x22b791(0x153)+_0x22b791(0x136)+'a\x20failed');throw _0x4f8b96;}}export async function trackMessage(_0x14deae){const _0xa42db3=_0x26d59d;try{if(!_0x14deae||!_0x14deae[_0xa42db3(0xa9)]||!_0x14deae[_0xa42db3(0x169)])return;const _0x7c3928=makeDedupeKey(_0x14deae);if(!_0x7c3928)return;if(isMsgProcessed(_0x7c3928))return;markMsgProcessed(_0x7c3928);if(_0x14deae[_0xa42db3(0xa9)][_0xa42db3(0x115)])return;const _0x462d4c=_0x14deae[_0xa42db3(0xa9)][_0xa42db3(0x1be)];if(!_0x462d4c||!_0x462d4c[_0xa42db3(0x156)](_0xa42db3(0x176)))return;const _0x4cd7d6=_0x14deae[_0xa42db3(0xa9)][_0xa42db3(0x1b3)+'t']||_0x14deae['key'][_0xa42db3(0xb3)]||'';if(!_0x4cd7d6)return;const _0x48a3d0=normalizeJid(_0x4cd7d6),_0x4bec17=DateTime['now']()['setZone'](CONFIG[_0xa42db3(0xd1)]),_0x256937=_0x4bec17[_0xa42db3(0x106)](_0xa42db3(0xd2));try{const _0x508faf=await db[_0xa42db3(0xca)](_0xa42db3(0xbe)+_0xa42db3(0xe2)+_0xa42db3(0x193)+'\x20\x20\x20\x20\x20\x20\x20SET'+_0xa42db3(0x16d)+'ount\x20=\x20mes'+_0xa42db3(0x114)+_0xa42db3(0xd0)+'lay_name\x20='+_0xa42db3(0xa7)+_0xa42db3(0xb6)+_0xa42db3(0x146)+'HERE\x20chat_'+_0xa42db3(0xff)+_0xa42db3(0xa5)+_0xa42db3(0x181)+'imeframe\x20='+_0xa42db3(0xaf)+_0xa42db3(0x177)+_0xa42db3(0x1a3)+_0xa42db3(0x148),[_0x14deae[_0xa42db3(0x107)]||_0x14deae['senderName']||'',Math[_0xa42db3(0x85)](_0x4bec17['toSeconds']()),_0x462d4c,_0x48a3d0,_0x256937]);(!_0x508faf||!_0x508faf[_0xa42db3(0x89)])&&await db['run']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xa42db3(0x183)+'TO\x20active_'+_0xa42db3(0xd7)+_0xa42db3(0xe5)+_0xa42db3(0xcf)+_0xa42db3(0xc8)+'cket_key,\x20'+_0xa42db3(0x12e)+_0xa42db3(0xbf)+_0xa42db3(0xc0)+'ast_update'+'d)\x0a\x20\x20\x20\x20\x20\x20\x20'+'\x20\x20\x20VALUES\x20'+_0xa42db3(0x77)+_0xa42db3(0x147)+_0xa42db3(0xdd)+_0xa42db3(0x108),[_0x462d4c,_0x48a3d0,_0x256937,_0x14deae[_0xa42db3(0x107)]||_0x14deae[_0xa42db3(0x168)]||'',Math['floor'](_0x4bec17[_0xa42db3(0xe8)]())]);}catch(_0x324936){warn(_0xa42db3(0x19f)+_0xa42db3(0x166)+_0xa42db3(0x101)+':\x20'+(_0x324936?.['message']||_0x324936));}}catch(_0x87a35e){warn(_0xa42db3(0x19f)+_0xa42db3(0x166)+'e\x20unexpect'+_0xa42db3(0x86)+(_0x87a35e?.['message']||_0x87a35e));}}async function performRollups(){const _0x20ea49=_0x26d59d;try{const _0x148a4b=DateTime[_0x20ea49(0x17e)]()[_0x20ea49(0xa0)](CONFIG[_0x20ea49(0xd1)]),_0x4797e0=_0x148a4b[_0x20ea49(0x18d)]({'days':CONFIG[_0x20ea49(0x9c)+'O_WEEK_DAY'+'S']})[_0x20ea49(0x145)]('day'),_0x242b1a=_0x4797e0['toFormat'](_0x20ea49(0xd2)),_0x271447=await db[_0x20ea49(0xc1)](_0x20ea49(0x7e)+_0x20ea49(0xdc)+_0x20ea49(0x142)+_0x20ea49(0x13f)+_0x20ea49(0x178)+_0x20ea49(0xfd)+_0x20ea49(0x1a5)+_0x20ea49(0xea)+'ve_stats\x20W'+_0x20ea49(0x8a)+_0x20ea49(0x69)+'ily\x27\x20AND\x20b'+_0x20ea49(0x170)+_0x20ea49(0x17a),[_0x242b1a]);if(_0x271447&&_0x271447[_0x20ea49(0xad)]){const _0x869cd6=new Map();for(const _0x3c468d of _0x271447){const _0x345229=DateTime['fromFormat'](_0x3c468d[_0x20ea49(0x98)],_0x20ea49(0xd2),{'zone':CONFIG[_0x20ea49(0xd1)]}),_0x903af7=_0x345229[_0x20ea49(0x129)]+'-'+String(_0x345229[_0x20ea49(0x1b4)])[_0x20ea49(0xa8)](0xc1d*-0x2+-0x1749+0xf*0x32b,'0'),_0x3b2386=_0x3c468d[_0x20ea49(0x15a)]+'||'+_0x3c468d[_0x20ea49(0x76)]+_0x20ea49(0x143)+_0x903af7;if(!_0x869cd6['has'](_0x3b2386))_0x869cd6[_0x20ea49(0x14b)](_0x3b2386,{'chat_jid':_0x3c468d['chat_jid'],'user_jid':_0x3c468d[_0x20ea49(0x76)],'timeframe':'weekly','bucket_key':_0x903af7,'message_count':0x0,'display_name':_0x3c468d['display_na'+'me']||''});const _0x264905=_0x869cd6['get'](_0x3b2386);_0x264905[_0x20ea49(0x12e)+_0x20ea49(0x13d)]+=Number(_0x3c468d[_0x20ea49(0x12e)+_0x20ea49(0x13d)]||0xb*-0x265+0x2616+-0x1f*0x61);}for(const _0xa9ebda of _0x869cd6[_0x20ea49(0x1bd)]()){const _0x2075f3=await db[_0x20ea49(0xb5)](_0x20ea49(0x199)+_0x20ea49(0x12b)+_0x20ea49(0x17b)+_0x20ea49(0x78)+_0x20ea49(0x1a6)+'\x20user_jid\x20'+_0x20ea49(0x16b)+_0x20ea49(0xe9)+_0x20ea49(0xb9)+_0x20ea49(0x177)+_0x20ea49(0x15b)+_0x20ea49(0x141),[_0xa9ebda[_0x20ea49(0x15a)],_0xa9ebda['user_jid'],_0xa9ebda[_0x20ea49(0x98)]]);!_0x2075f3?await db[_0x20ea49(0xca)](_0x20ea49(0x150)+_0x20ea49(0xde)+'tats\x20(chat'+'_jid,\x20user'+_0x20ea49(0xc9)+_0x20ea49(0x79)+_0x20ea49(0x1a2)+_0x20ea49(0x9a)+_0x20ea49(0xcb)+_0x20ea49(0xe3)+_0x20ea49(0xba)+_0x20ea49(0x10f)+'?,\x20?,\x20\x27wee'+_0x20ea49(0x175)+_0x20ea49(0xbb),[_0xa9ebda[_0x20ea49(0x15a)],_0xa9ebda[_0x20ea49(0x76)],_0xa9ebda['bucket_key'],_0xa9ebda['message_co'+_0x20ea49(0x13d)],_0xa9ebda[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b[_0x20ea49(0xe8)]())]):await db[_0x20ea49(0xca)](_0x20ea49(0x16e)+_0x20ea49(0x159)+_0x20ea49(0x14c)+_0x20ea49(0x1c4)+_0x20ea49(0x12e)+_0x20ea49(0x102)+_0x20ea49(0x8e)+_0x20ea49(0x190)+_0x20ea49(0x15f)+_0x20ea49(0xc5)+_0x20ea49(0xb7),[_0xa9ebda[_0x20ea49(0x12e)+_0x20ea49(0x13d)],_0xa9ebda[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b['toSeconds']()),_0x2075f3['id']]);}try{const _0x407b04=_0x271447[_0x20ea49(0x1ac)](_0x47090b=>_0x47090b['id']);for(let _0x2ce50b=0x329*-0xb+-0x584*-0x4+-0xcb3*-0x1;_0x2ce50b<_0x407b04[_0x20ea49(0xad)];_0x2ce50b+=-0xd89+0x1*0x4e1+0x61*0x1c){const _0x3b04a9=_0x407b04['slice'](_0x2ce50b,_0x2ce50b+(-0x141*-0x8+-0x6b*-0x4c+-0x27d8)),_0x15b5d0=_0x20ea49(0x191)+'M\x20active_s'+'tats\x20WHERE'+_0x20ea49(0xed)+_0x3b04a9[_0x20ea49(0x1ac)](()=>'?')[_0x20ea49(0x12f)](',')+')';await db[_0x20ea49(0xca)](_0x15b5d0,_0x3b04a9);}}catch(_0x292e3d){warn(_0x20ea49(0x12d)+'elete\x20old\x20'+_0x20ea49(0x11f)+_0x20ea49(0x162)+(_0x292e3d?.[_0x20ea49(0x169)]||_0x292e3d));}}const _0x6c4443=_0x148a4b[_0x20ea49(0x18d)]({'days':CONFIG[_0x20ea49(0x9c)+_0x20ea49(0x180)+'YS']})['toSeconds'](),_0x1c2307=await db['all'](_0x20ea49(0x7e)+_0x20ea49(0xdc)+_0x20ea49(0x142)+'\x20bucket_ke'+_0x20ea49(0x178)+'_count,\x20di'+_0x20ea49(0x1a5)+'\x20FROM\x20acti'+_0x20ea49(0x174)+'HERE\x20timef'+'rame\x20=\x20\x27we'+_0x20ea49(0xa3));if(_0x1c2307&&_0x1c2307['length']){const _0x1642a3=new Map();for(const _0x47d4cd of _0x1c2307){const _0x3fd9f6=String(_0x47d4cd[_0x20ea49(0x98)]||'')[_0x20ea49(0x90)]('-'),_0x599b30=Number(_0x3fd9f6[0x12ea+0x657*-0x4+0x672])||-0x955+0xe57+0x2b0,_0x2b07fd=Number(_0x3fd9f6[0x1161*-0x2+-0x1*-0x8c4+0x19ff])||-0x16*0x4+-0x1*-0x26a9+0x4ca*-0x8,_0x2b93d4=DateTime[_0x20ea49(0x87)]({'weekYear':_0x599b30,'weekNumber':_0x2b07fd,'weekday':0x1},{'zone':CONFIG[_0x20ea49(0xd1)]});if(_0x2b93d4[_0x20ea49(0xe8)]()>_0x6c4443)continue;const _0x59ea26=_0x2b93d4[_0x20ea49(0x119)]+'-'+String(_0x2b93d4[_0x20ea49(0xef)])[_0x20ea49(0xa8)](-0x104f*0x1+-0x1*0x1bc8+0x2c19,'0'),_0x1ed3dc=_0x47d4cd[_0x20ea49(0x15a)]+'||'+_0x47d4cd[_0x20ea49(0x76)]+(_0x20ea49(0xf9)+'|')+_0x59ea26;if(!_0x1642a3[_0x20ea49(0x152)](_0x1ed3dc))_0x1642a3[_0x20ea49(0x14b)](_0x1ed3dc,{'chat_jid':_0x47d4cd[_0x20ea49(0x15a)],'user_jid':_0x47d4cd['user_jid'],'timeframe':_0x20ea49(0x126),'bucket_key':_0x59ea26,'message_count':0x0,'display_name':_0x47d4cd[_0x20ea49(0x15d)+'me']||'','sourceIds':[]});const _0x4b2ce4=_0x1642a3[_0x20ea49(0xb5)](_0x1ed3dc);_0x4b2ce4[_0x20ea49(0x12e)+'unt']+=Number(_0x47d4cd['message_co'+_0x20ea49(0x13d)]||0x2*-0x4c1+-0x3*-0x796+-0x20*0x6a),_0x4b2ce4[_0x20ea49(0x10a)][_0x20ea49(0xe4)](_0x47d4cd['id']);}for(const _0x3c4d2b of _0x1642a3[_0x20ea49(0x1bd)]()){const _0x3a5e81=await db[_0x20ea49(0xb5)](_0x20ea49(0x199)+_0x20ea49(0x12b)+_0x20ea49(0x17b)+_0x20ea49(0x78)+_0x20ea49(0x1a6)+'\x20user_jid\x20'+_0x20ea49(0x16b)+_0x20ea49(0xe9)+_0x20ea49(0xce)+'AND\x20bucket'+_0x20ea49(0x9b)+_0x20ea49(0x1b2),[_0x3c4d2b[_0x20ea49(0x15a)],_0x3c4d2b[_0x20ea49(0x76)],_0x3c4d2b[_0x20ea49(0x98)]]);!_0x3a5e81?await db[_0x20ea49(0xca)](_0x20ea49(0x150)+_0x20ea49(0xde)+_0x20ea49(0x1bf)+_0x20ea49(0x188)+_0x20ea49(0xc9)+_0x20ea49(0x79)+'ket_key,\x20m'+'essage_cou'+'nt,\x20displa'+_0x20ea49(0xe3)+_0x20ea49(0xba)+_0x20ea49(0x10f)+_0x20ea49(0x187)+_0x20ea49(0x8c)+'?,\x20?,\x20?)',[_0x3c4d2b[_0x20ea49(0x15a)],_0x3c4d2b[_0x20ea49(0x76)],_0x3c4d2b['bucket_key'],_0x3c4d2b['message_co'+_0x20ea49(0x13d)],_0x3c4d2b[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b[_0x20ea49(0xe8)]())]):await db['run'](_0x20ea49(0x16e)+_0x20ea49(0x159)+'SET\x20messag'+'e_count\x20=\x20'+_0x20ea49(0x12e)+_0x20ea49(0x102)+_0x20ea49(0x8e)+_0x20ea49(0x190)+'t_updated\x20'+'=\x20?\x20WHERE\x20'+_0x20ea49(0xb7),[_0x3c4d2b[_0x20ea49(0x12e)+'unt'],_0x3c4d2b[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b[_0x20ea49(0xe8)]()),_0x3a5e81['id']]);if(Array[_0x20ea49(0x13b)](_0x3c4d2b[_0x20ea49(0x10a)])&&_0x3c4d2b[_0x20ea49(0x10a)][_0x20ea49(0xad)])for(let _0x284193=0x11e+-0x21d1*-0x1+-0x22ef;_0x284193<_0x3c4d2b[_0x20ea49(0x10a)]['length'];_0x284193+=0xd07+-0xb69+0x56){const _0x2337a4=_0x3c4d2b['sourceIds'][_0x20ea49(0x133)](_0x284193,_0x284193+(-0x5c1*-0x3+-0x355*-0x5+0x42*-0x7c)),_0xc46b9e='DELETE\x20FRO'+_0x20ea49(0x97)+'tats\x20WHERE'+_0x20ea49(0xed)+_0x2337a4[_0x20ea49(0x1ac)](()=>'?')[_0x20ea49(0x12f)](',')+')';await db['run'](_0xc46b9e,_0x2337a4);}}}const _0xc9a467=_0x148a4b[_0x20ea49(0x18d)]({'days':CONFIG['ROLLOVER_T'+_0x20ea49(0x130)+'S']})[_0x20ea49(0xe8)](),_0x422dd0=await db['all'](_0x20ea49(0x7e)+_0x20ea49(0xdc)+'\x20user_jid,'+_0x20ea49(0x13f)+_0x20ea49(0x178)+_0x20ea49(0xfd)+_0x20ea49(0x1a5)+'\x20FROM\x20acti'+_0x20ea49(0x174)+_0x20ea49(0x8a)+_0x20ea49(0x19e)+_0x20ea49(0x163));if(_0x422dd0&&_0x422dd0['length']){const _0xdf1e31=new Map();for(const _0x23511a of _0x422dd0){const _0x108f17=String(_0x23511a[_0x20ea49(0x98)]||'')['split']('-'),_0x544500=Number(_0x108f17[0x261a+0x8f0+-0x12*0x29d])||-0x2*-0x1177+0x1ceb+-0x3827,_0x59c724=DateTime[_0x20ea49(0x87)]({'year':_0x544500,'month':0x1,'day':0x1},{'zone':CONFIG[_0x20ea49(0xd1)]});if(_0x59c724[_0x20ea49(0xe8)]()>_0xc9a467)continue;const _0x2af0c8=''+_0x544500,_0x579abe=_0x23511a[_0x20ea49(0x15a)]+'||'+_0x23511a[_0x20ea49(0x76)]+_0x20ea49(0x6c)+_0x2af0c8;if(!_0xdf1e31[_0x20ea49(0x152)](_0x579abe))_0xdf1e31['set'](_0x579abe,{'chat_jid':_0x23511a[_0x20ea49(0x15a)],'user_jid':_0x23511a[_0x20ea49(0x76)],'timeframe':_0x20ea49(0x1c5),'bucket_key':_0x2af0c8,'message_count':0x0,'display_name':_0x23511a[_0x20ea49(0x15d)+'me']||'','sourceIds':[]});const _0x52d82a=_0xdf1e31[_0x20ea49(0xb5)](_0x579abe);_0x52d82a[_0x20ea49(0x12e)+_0x20ea49(0x13d)]+=Number(_0x23511a[_0x20ea49(0x12e)+_0x20ea49(0x13d)]||0x3fb+0x20d*-0xa+0x1087),_0x52d82a['sourceIds'][_0x20ea49(0xe4)](_0x23511a['id']);}for(const _0x51fd86 of _0xdf1e31[_0x20ea49(0x1bd)]()){const _0xbfd6cd=await db[_0x20ea49(0xb5)](_0x20ea49(0x199)+_0x20ea49(0x12b)+_0x20ea49(0x17b)+_0x20ea49(0x78)+_0x20ea49(0x1a6)+_0x20ea49(0x7f)+_0x20ea49(0x16b)+_0x20ea49(0xe9)+'\x27yearly\x27\x20A'+'ND\x20bucket_'+_0x20ea49(0x15b)+'MIT\x201',[_0x51fd86['chat_jid'],_0x51fd86[_0x20ea49(0x76)],_0x51fd86[_0x20ea49(0x98)]]);!_0xbfd6cd?await db['run']('INSERT\x20INT'+_0x20ea49(0xde)+_0x20ea49(0x1bf)+_0x20ea49(0x188)+_0x20ea49(0xc9)+_0x20ea49(0x79)+_0x20ea49(0x1a2)+_0x20ea49(0x9a)+_0x20ea49(0xcb)+_0x20ea49(0xe3)+_0x20ea49(0xba)+')\x20VALUES\x20('+'?,\x20?,\x20\x27yea'+_0x20ea49(0xf2)+_0x20ea49(0xbb),[_0x51fd86[_0x20ea49(0x15a)],_0x51fd86[_0x20ea49(0x76)],_0x51fd86['bucket_key'],_0x51fd86[_0x20ea49(0x12e)+_0x20ea49(0x13d)],_0x51fd86[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b[_0x20ea49(0xe8)]())]):await db[_0x20ea49(0xca)](_0x20ea49(0x16e)+_0x20ea49(0x159)+_0x20ea49(0x14c)+_0x20ea49(0x1c4)+'message_co'+_0x20ea49(0x102)+_0x20ea49(0x8e)+_0x20ea49(0x190)+_0x20ea49(0x15f)+_0x20ea49(0xc5)+'id\x20=\x20?',[_0x51fd86[_0x20ea49(0x12e)+_0x20ea49(0x13d)],_0x51fd86[_0x20ea49(0x15d)+'me']||'',Math[_0x20ea49(0x85)](_0x148a4b[_0x20ea49(0xe8)]()),_0xbfd6cd['id']]);if(Array[_0x20ea49(0x13b)](_0x51fd86['sourceIds'])&&_0x51fd86[_0x20ea49(0x10a)][_0x20ea49(0xad)])for(let _0x2945a0=0x95f*-0x1+-0x7*0x52f+-0xf38*-0x3;_0x2945a0<_0x51fd86[_0x20ea49(0x10a)][_0x20ea49(0xad)];_0x2945a0+=-0x7cf*0x5+-0x1c77+-0x1*-0x4576){const _0x605d24=_0x51fd86[_0x20ea49(0x10a)]['slice'](_0x2945a0,_0x2945a0+(0x104b+-0x86*-0x25+-0x21b5)),_0x11cc76=_0x20ea49(0x191)+_0x20ea49(0x97)+_0x20ea49(0x137)+_0x20ea49(0xed)+_0x605d24[_0x20ea49(0x1ac)](()=>'?')[_0x20ea49(0x12f)](',')+')';await db['run'](_0x11cc76,_0x605d24);}}}try{const _0x1e5f66=DateTime[_0x20ea49(0x17e)]()[_0x20ea49(0xa0)](CONFIG[_0x20ea49(0xd1)])[_0x20ea49(0x18d)]({'days':CONFIG[_0x20ea49(0x11d)+'KEEP_DAYS']})[_0x20ea49(0x106)](_0x20ea49(0xd2));await db[_0x20ea49(0xca)]('DELETE\x20FRO'+_0x20ea49(0x97)+_0x20ea49(0x137)+_0x20ea49(0x7d)+'\x20=\x20\x27daily\x27'+_0x20ea49(0x16c)+_0x20ea49(0xaa),[_0x1e5f66]);}catch(_0x1582f0){warn('[active]\x20p'+_0x20ea49(0xf5)+_0x20ea49(0x162)+(_0x1582f0?.[_0x20ea49(0x169)]||_0x1582f0));}info(_0x20ea49(0xfc)+_0x20ea49(0xf7)+'plete');}catch(_0x1e8211){error(_0x1e8211,'[active]\x20p'+_0x20ea49(0x10d)+_0x20ea49(0x8d)+':\x20'+(_0x1e8211?.[_0x20ea49(0x169)]||_0x1e8211));}}function _0x3b77(_0xe40c01,_0xe789db){_0xe40c01=_0xe40c01-(0x1*0x1c6f+0x2270+-0x3e76);const _0x4f3ed6=_0x5b51();let _0x2b945f=_0x4f3ed6[_0xe40c01];return _0x2b945f;}function parsePeriodArg(_0x2f94de){const _0xb97594=_0x26d59d;if(!_0x2f94de)return null;const _0x2f36f6=String(_0x2f94de)[_0xb97594(0xab)]()[_0xb97594(0x1b0)+'e']()[_0xb97594(0x11e)](/^(\d+)\s*([dwmy])$/);if(!_0x2f36f6)return null;return{'amount':Number(_0x2f36f6[0x20*0x100+0x2*0x4ef+-0x7*0x5fb]),'unit':_0x2f36f6[-0xab+-0x7*-0x345+-0x1636]};}function computeCutoffSeconds(_0x11759c,_0x4b0b3c){const _0x4a348b=_0x26d59d,_0x37438f=DateTime[_0x4a348b(0x17e)]()[_0x4a348b(0xa0)](CONFIG[_0x4a348b(0xd1)]);let _0x51e57c;if(_0x4b0b3c==='d')_0x51e57c=_0x37438f[_0x4a348b(0x18d)]({'days':_0x11759c});else{if(_0x4b0b3c==='w')_0x51e57c=_0x37438f['minus']({'weeks':_0x11759c});else{if(_0x4b0b3c==='m')_0x51e57c=_0x37438f[_0x4a348b(0x18d)]({'months':_0x11759c});else{if(_0x4b0b3c==='y')_0x51e57c=_0x37438f[_0x4a348b(0x18d)]({'years':_0x11759c});else _0x51e57c=_0x37438f[_0x4a348b(0x18d)]({'days':_0x11759c});}}}return Math[_0x4a348b(0x85)](_0x51e57c[_0x4a348b(0xe8)]());}async function buildLeaderboardForChat(_0x15ee77,_0x1142af,_0x598f8f=CONFIG[_0x26d59d(0x120)+_0x26d59d(0x161)]){const _0x1dae14=_0x26d59d;try{const _0x90b958=DateTime['fromSecond'+'s'](_0x1142af)[_0x1dae14(0xa0)](CONFIG[_0x1dae14(0xd1)]),_0x4b919e=_0x90b958['toFormat'](_0x1dae14(0xd2)),_0x33b238=await db[_0x1dae14(0xc1)]('\x0a\x20\x20\x20\x20\x20\x20SEL'+_0x1dae14(0x158)+'id,\x20displa'+_0x1dae14(0x132)+_0x1dae14(0x17c)+_0x1dae14(0x95)+_0x1dae14(0x1b1)+_0x1dae14(0x1af)+_0x1dae14(0xee)+_0x1dae14(0x93)+_0x1dae14(0x12b)+_0x1dae14(0x1ad)+'\x20\x20\x20\x20WHERE\x20'+_0x1dae14(0x140)+_0x1dae14(0xc7)+_0x1dae14(0x15c)+_0x1dae14(0x186)+_0x1dae14(0x13f)+_0x1dae14(0x7b)+_0x1dae14(0xe0)+_0x1dae14(0x184)+_0x1dae14(0x18a),[_0x15ee77,_0x4b919e]),_0x3b3499=new Map();for(const _0x2b7373 of _0x33b238||[]){const _0x776c0f=normalizeJid(_0x2b7373[_0x1dae14(0x76)]);_0x3b3499[_0x1dae14(0x14b)](_0x776c0f,{'user_jid':_0x776c0f,'display_name':_0x2b7373[_0x1dae14(0x15d)+'me']||_0x776c0f[_0x1dae14(0x90)]('@')[-0x12be+-0x2575+-0x3833*-0x1],'count':Number(_0x2b7373[_0x1dae14(0x110)]||-0x2401*0x1+0xc14*0x1+-0x19*-0xf5),'last_ts':Number(_0x2b7373[_0x1dae14(0xa4)]||0x21*-0xff+0x2529+-0x44a)});}const _0x4c8b29=await db['all']('SELECT\x20use'+_0x1dae14(0xcf)+_0x1dae14(0xc8)+_0x1dae14(0x7a)+'message_co'+_0x1dae14(0xbf)+_0x1dae14(0x138)+'OM\x20active_'+_0x1dae14(0x99)+_0x1dae14(0x12c)+_0x1dae14(0x181)+_0x1dae14(0x157)+_0x1dae14(0x84)+_0x1dae14(0xb0)+_0x1dae14(0x14f)+')',[_0x15ee77]);for(const _0x25dec7 of _0x4c8b29||[]){let _0x4f860a=![];try{if(_0x25dec7[_0x1dae14(0x134)]==='weekly'){const _0x5ddba9=String(_0x25dec7[_0x1dae14(0x98)]||'')['split']('-'),_0x3ac3d0=Number(_0x5ddba9[0x1645*-0x1+-0x41+-0x5d*-0x3e])||-0x1*-0x3b+0x149*-0x9+-0x18*-0xcb,_0x5c3aa2=Number(_0x5ddba9[-0x1295+0x2*0xced+-0x5*0x174])||0x1644+-0x1*0x584+-0x1*0x10bf,_0x262943=DateTime[_0x1dae14(0x87)]({'weekYear':_0x3ac3d0,'weekNumber':_0x5c3aa2,'weekday':0x1},{'zone':CONFIG['TIME_ZONE']});if(_0x262943[_0x1dae14(0xe8)]()>=_0x1142af)_0x4f860a=!![];}else{if(_0x25dec7[_0x1dae14(0x134)]===_0x1dae14(0x126)){const _0x6c7bf0=String(_0x25dec7[_0x1dae14(0x98)]||'')[_0x1dae14(0x90)]('-'),_0x4b2d0c=Number(_0x6c7bf0[0x17c7+0xe43+-0x43a*0x9])||0x2ae*-0x6+0x2134+-0x96e,_0x5da7f5=Number(_0x6c7bf0[-0xd*0x148+0x1c15+-0xb6c])||-0xbfc+-0x1de2+-0x3*-0xdf5,_0x8999e1=DateTime[_0x1dae14(0x87)]({'year':_0x4b2d0c,'month':_0x5da7f5,'day':0x1},{'zone':CONFIG[_0x1dae14(0xd1)]});if(_0x8999e1[_0x1dae14(0xe8)]()>=_0x1142af)_0x4f860a=!![];}else{if(_0x25dec7[_0x1dae14(0x134)]==='yearly'){const _0x7f69ad=Number(String(_0x25dec7[_0x1dae14(0x98)]||'')['split']('-')[0x17d0+-0x123c+-0x594])||-0xf67*-0x1+-0x5da+-0x19*0x13,_0x3a7297=DateTime[_0x1dae14(0x87)]({'year':_0x7f69ad,'month':0x1,'day':0x1},{'zone':CONFIG[_0x1dae14(0xd1)]});if(_0x3a7297[_0x1dae14(0xe8)]()>=_0x1142af)_0x4f860a=!![];}else _0x4f860a=!![];}}}catch(_0x18e91c){_0x4f860a=!![];}if(!_0x4f860a)continue;const _0x525a16=normalizeJid(_0x25dec7['user_jid']);if(!_0x3b3499['has'](_0x525a16))_0x3b3499[_0x1dae14(0x14b)](_0x525a16,{'user_jid':_0x525a16,'display_name':_0x25dec7[_0x1dae14(0x15d)+'me']||_0x525a16['split']('@')[0x223*-0x3+-0x1*0x1957+0x1fc0],'count':0x0,'last_ts':0x0});_0x3b3499[_0x1dae14(0xb5)](_0x525a16)[_0x1dae14(0x167)]+=Number(_0x25dec7['message_co'+_0x1dae14(0x13d)]||-0x1d3*-0x12+-0x21b8+0xe2);}const _0x23501a=Array[_0x1dae14(0xb3)](_0x3b3499[_0x1dae14(0x1bd)]())[_0x1dae14(0x118)]((_0x5f1d06,_0x504dbc)=>_0x504dbc[_0x1dae14(0x167)]-_0x5f1d06[_0x1dae14(0x167)]||_0x504dbc['last_ts']-_0x5f1d06[_0x1dae14(0xa4)]);return _0x23501a[_0x1dae14(0x133)](-0xa*-0x14+0x221b+-0x22e3,_0x598f8f);}catch(_0x47ec96){return warn('[active]\x20b'+_0x1dae14(0x185)+'board\x20erro'+_0x1dae14(0x1ba)+(_0x47ec96?.['message']||_0x47ec96)),[];}}async function getGroupParticipants(_0x4d4a3f,_0x314612){const _0x10ddcc=_0x26d59d;try{if(!_0x4d4a3f||typeof _0x4d4a3f[_0x10ddcc(0x198)+'ata']!==_0x10ddcc(0x151))return[];const _0x5bf97e=await _0x4d4a3f['groupMetad'+'ata'](_0x314612),_0x33118c=Array[_0x10ddcc(0x13b)](_0x5bf97e?.[_0x10ddcc(0x1b3)+'ts'])?_0x5bf97e['participan'+'ts']:Object[_0x10ddcc(0x1bd)](_0x5bf97e?.[_0x10ddcc(0x1b3)+'ts']||{}),_0x48cb0b=_0x33118c[_0x10ddcc(0x1ac)](_0x339a9d=>_0x339a9d['id'])[_0x10ddcc(0x11b)](Boolean)[_0x10ddcc(0x1ac)](normalizeJid);return _0x48cb0b;}catch(_0x4502ed){return warn(_0x10ddcc(0x1a4)+'etGroupPar'+'ticipants\x20'+_0x10ddcc(0x1ab)+'\x20'+_0x314612+':\x20'+(_0x4502ed?.['message']||_0x4502ed)),[];}}function _0x5b51(){const _0x3fd3c6=['stats\x20(cha','e,\x20bucket_','UTC','STS\x20active','e\x20members\x20','\x20chat_jid,',',\x20?,\x20?)\x0a\x20\x20','O\x20active_s','\x20\x20\x20\x20\x20user_','\x20\x20\x20GROUP\x20B','t><d|w|m|y','PDATE\x20acti','y_name,\x20la','push','t_jid,\x20use',',\x20timefram','CREATE\x20IND','toSeconds','meframe\x20=\x20','\x20FROM\x20acti','\x20\x20\x20chat_ji','Found\x20','\x20id\x20IN\x20(','d)\x20AS\x20last','month','key)\x0a\x20\x20\x20\x20\x20','ailed:\x20','rly\x27,\x20?,\x20?','E(chat_jid','delete','rune\x20daily','eekly:\x20YYY','ollups\x20com','members\x20in','||monthly|','ers\x20in\x20the','group\x20part','[active]\x20r','_count,\x20di','-\x20\x27daily\x27|','jid\x20=\x20?\x20AN','_active_st','e\x20DB\x20error','unt\x20+\x20?,\x20d',',\x20user_jid','sock','2353080CMTIBI','toFormat','pushName','\x20\x20\x20\x20\x20\x20','3734143XBXPDz','sourceIds','ive\x20<amoun','ats_chat_u','erformRoll','ATE\x20TABLE\x20',')\x20VALUES\x20(','cnt','members\x20fo','EXISTS\x20idx','\x20\x20\x20\x20\x20\x20\x20tim','sage_count','fromMe','\x20TEXT\x20PRIM','s\x20(\x0a\x20\x20\x20\x20\x20\x20','sort','year','\x20last\x20','filter','EXT\x20DEFAUL','MAX_DAILY_','match','daily\x20rows','USERS_LIMI',':\x0a\x0a','object','993198UEsuky','1.1.1','leaned\x20up','monthly','he\x20last\x20','\x20\x20\x20\x20last_u','weekYear','text','FROM\x20activ','E\x20chat_jid','[active]\x20d','message_co','join','O_YEAR_DAY','NTEGER\x20DEF','y_name,\x20SU','slice','timeframe','INTEGER\x20PR','nsureSchem','tats\x20WHERE','ay_name\x20FR','AULT\x200,\x0a\x20\x20','ion\x20INTEGE','isArray','\x20\x20chat_jid','unt','[active]\x20i','\x20bucket_ke','chat_jid\x20=','MIT\x201','\x20user_jid,','||weekly||','\x20messages\x0a','startOf','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','ily\x27,\x20?,\x201','\x20\x20\x20\x20','es:\x20active','e_stats(ch','set','SET\x20messag','ions\x20(vers','lay_name\x20T','\x27,\x27yearly\x27','INSERT\x20INT','function','has','[active]\x20e','124EKBBac','monthly\x27|\x27','endsWith','imeframe\x20I','ECT\x20user_j','ive_stats\x20','chat_jid','key\x20=\x20?\x20LI','eframe\x20=\x20\x27','display_na','d\x20TEXT\x20NOT','t_updated\x20','meframe,\x20b','T_RETURN','\x20failed:\x20','nthly\x27','T\x20NOT\x20NULL','_MS','rackMessag','count','senderName','message','\x20\x20\x20\x20\x20\x20\x20mes','=\x20?\x20AND\x20ti','\x20AND\x20bucke','\x20message_c','UPDATE\x20act','LE\x20IF\x20NOT\x20','ucket_key\x20','ive_stats(',',\x20\x20\x20\x20\x20\x20\x20\x20-','\x20);\x0a\x20\x20\x20\x20','ve_stats\x20W','kly\x27,\x20?,\x20?','@g.us','ND\x20bucket_','y,\x20message','No\x20inactiv','<=\x20?','e_stats\x20WH','M(message_','\x20\x20\x20\x20\x20\x20buck','now','KEY,\x20migra','O_MONTH_DA','\x20=\x20?\x20AND\x20t','[active]\x20s','\x20INSERT\x20IN','Y\x20user_jid','uildLeader','daily\x27\x20AND','?,\x20?,\x20\x27mon','_jid,\x20user','inactive','\x0a\x20\x20\x20\x20','_stats\x20(\x0a\x20','red','minus','R\x20PRIMARY\x20','und\x20in\x20the','e\x20=\x20?,\x20las','DELETE\x20FRO','ser\x20ON\x20act','ve_stats\x0a\x20','ge_count\x20I','8ZapBzd','nMessage\x20f','ailed\x20to\x20r','groupMetad','SELECT\x20id\x20','e\x201w,\x20inac','LT\x20(strfti','_leaderboa','EGER\x20DEFAU','rame\x20=\x20\x27mo','[active]\x20t','255498lzLKGK','XT\x0a\x20\x20\x20\x20\x20\x20)','ket_key,\x20m','key\x20=\x20?\x0a\x20\x20','[active]\x20g','splay_name','id\x20=\x20?\x20AND','OT\x20NULL,\x0a\x20','es\x0a\x0a','ctive\x20<amo','[active]\x20o','failed\x20for','map','e_stats\x0a\x20\x20','eframe\x20TEX','ast_update','toLowerCas','cnt,\x20MAX(l','IMIT\x201','participan','weekNumber','exec','IF\x20NOT\x20EXI','|y>\x0aExampl','ow\x27)));','20064960fIxiCs','r:\x20','at_jid,\x20ti','daily:\x20YYY','values','remoteJid','tats\x20(chat','Y-WW,\x20mont','chema\x20ensu','ENT,\x0a\x20\x20\x20\x20\x20','chat_jid,\x20','e_count\x20=\x20','yearly','rame\x20=\x20\x27da','\x20no\x20messag','jid\x20TEXT\x20N','||yearly||','unit','user_jid);','No\x20active\x20','tive\x207d','\x201d,\x20activ','\x27weekly\x27|\x27','ucket_key)','MM,\x20yearly','active','user_jid','(?,\x20?,\x20\x27da','ERE\x20chat_j','frame,\x20buc','cket_key,\x20','y\x20>=\x20?\x0a\x20\x20\x20','ted_at\x20INT','\x20timeframe','SELECT\x20id,','\x20user_jid\x20','236430QKVhSH','f\x20ON\x20activ','failed:\x20','ACTIVE','N\x20(\x27weekly','floor','ed:\x20','fromObject','ARY\x20KEY,\x0a\x20','changes','HERE\x20timef','unt><d|w|m','thly\x27,\x20?,\x20','ups\x20failed','isplay_nam','sage_id\x20TE','split','string','icipants.','_ts\x0a\x20\x20\x20\x20\x20\x20','clear','count)\x20AS\x20','IMARY\x20KEY\x20','M\x20active_s','bucket_key','stats\x20WHER','essage_cou','_key\x20=\x20?\x20L','ROLLOVER_T','end\x20usage\x20','[active]\x20f','sendMessag','setZone','et_key\x20TEX','Usage:\x20act','ekly\x27','last_ts','D\x20user_jid','\x20active\x20us','\x20?,\x20last_u','padStart','key','t_key\x20<=\x20?','trim','me(\x27%s\x27,\x27n','length','found\x20in\x20t','\x20\x27daily\x27\x20A','\x27,\x27monthly','CREATE\x20TAB','\x20\x20\x20\x20\x20\x20disp','from','ive_migrat','get','pdated\x20=\x20?','id\x20=\x20?','\x0a\x20\x20\x20\x20\x20\x20CRE','\x27weekly\x27\x20A','st_updated',',\x20?,\x20?)','EXISTS\x20act','42410hWwnyN','\x0a\x20\x20\x20\x20\x20\x20\x20\x20U','unt,\x20displ','ay_name,\x20l','all',';\x0a\x20\x20\x20\x20','\x20\x20\x20\x20\x20UNIQU',',\x20\x20\x20\x20\x20\x20--\x20','=\x20?\x20WHERE\x20','Could\x20not\x20','\x20?\x20AND\x20tim','eframe,\x20bu','_jid,\x20time','run','nt,\x20displa','EX\x20IF\x20NOT\x20','T\x20\x27\x27,\x0a\x20\x20\x20\x20','\x27monthly\x27\x20','r_jid,\x20tim','\x20+\x201,\x20disp','TIME_ZONE','yyyy-LL-dd','amount','\x20\x20\x20\x20\x20messa','determine\x20','ðŸ‘¤\x20@'];_0x5b51=function(){return _0x3fd3c6;};return _0x5b51();}export async function initialize(_0x3e2198){const _0x5bb1e3=_0x26d59d;try{botRef=_0x3e2198;if(botRef){if(typeof botRef[_0x5bb1e3(0x9f)+'e']===_0x5bb1e3(0x151))sendApi=(_0x550423,_0x528186)=>botRef['sendMessag'+'e'](_0x550423,_0x528186);else{if(botRef[_0x5bb1e3(0x104)]&&typeof botRef[_0x5bb1e3(0x104)][_0x5bb1e3(0x9f)+'e']==='function')sendApi=(_0x5a3469,_0x239592)=>botRef[_0x5bb1e3(0x104)][_0x5bb1e3(0x9f)+'e'](_0x5a3469,_0x239592);else sendApi=null;}}try{const _0x1e20d0=getConfig()||{};if(_0x1e20d0[_0x5bb1e3(0x83)]&&typeof _0x1e20d0['ACTIVE']===_0x5bb1e3(0x122))CONFIG={...CONFIG,..._0x1e20d0[_0x5bb1e3(0x83)]};}catch(_0x718e21){warn(_0x5bb1e3(0x9e)+_0x5bb1e3(0x197)+'ead\x20config'+'.ACTIVE:\x20'+(_0x718e21?.[_0x5bb1e3(0x169)]||_0x718e21));}await ensureSchema(),await performRollups(),info(_0x5bb1e3(0x13e)+'nitialized');}catch(_0x14b262){error(_0x14b262,_0x5bb1e3(0x13e)+'nitialize\x20'+'failed:\x20'+(_0x14b262?.['message']||_0x14b262));throw _0x14b262;}}export async function onMessage(_0x11dbe2){const _0x1015fd=_0x26d59d;try{await trackMessage(_0x11dbe2);if(!_0x11dbe2?.['isCommand'])return;const _0x4c6258=_0x11dbe2[_0x1015fd(0xa9)]?.[_0x1015fd(0x1be)];if(!_0x4c6258||!_0x4c6258[_0x1015fd(0x156)](_0x1015fd(0x176)))return;const _0x592a35=await isadmin(botRef,_0x11dbe2)['catch'](()=>![]);if(!_0x592a35)return;const _0x3db0ae=typeof _0x11dbe2['text']===_0x1015fd(0x91)&&_0x11dbe2['text'][_0x1015fd(0xab)]()?_0x11dbe2[_0x1015fd(0x12a)][_0x1015fd(0xab)]():'';if(!_0x3db0ae)return;const _0x8db61b=_0x3db0ae['split'](/\s+/)[_0x1015fd(0x11b)](Boolean),_0x2854b7=_0x8db61b[-0x1e47+0x14e1+0x966][_0x1015fd(0x1b0)+'e']();if(_0x2854b7!==_0x1015fd(0x75)&&_0x2854b7!==_0x1015fd(0x189))return;const _0xcb2c7c=_0x8db61b[0x12c0+-0xa0d+-0x8b2]||'1w';let _0x241e45=parsePeriodArg(_0xcb2c7c);if(!_0x241e45){const _0x43aed5=parseInt(_0xcb2c7c,-0x2*-0x16+0x1ace+0x8*-0x35e);if(!isNaN(_0x43aed5))_0x241e45={'amount':_0x43aed5,'unit':'d'};else{const _0x49fe51=_0x1015fd(0xa2)+_0x1015fd(0x10b)+_0x1015fd(0xe1)+'>\x20\x20OR\x20\x20ina'+_0x1015fd(0x1a9)+_0x1015fd(0x8b)+_0x1015fd(0x1b7)+_0x1015fd(0x149)+_0x1015fd(0x71)+_0x1015fd(0x19a)+_0x1015fd(0x70);try{await sendApi(_0x4c6258,{'text':_0x49fe51});}catch(_0x4525a8){warn(_0x1015fd(0x182)+_0x1015fd(0x9d)+_0x1015fd(0x82)+(_0x4525a8?.[_0x1015fd(0x169)]||_0x4525a8));}return;}}try{await performRollups();}catch(_0x2ff16a){}const _0x592023=computeCutoffSeconds(_0x241e45[_0x1015fd(0xd3)],_0x241e45[_0x1015fd(0x6d)]);if(_0x2854b7===_0x1015fd(0x75)){const _0x178a91=await buildLeaderboardForChat(_0x4c6258,_0x592023,CONFIG[_0x1015fd(0x120)+_0x1015fd(0x161)]);if(!_0x178a91||_0x178a91[_0x1015fd(0xad)]===-0xfc9+-0x1f73+0x1*0x2f3c){await sendApi(_0x4c6258,{'text':_0x1015fd(0x6f)+_0x1015fd(0x111)+_0x1015fd(0x18f)+_0x1015fd(0x11a)+_0x241e45[_0x1015fd(0xd3)]+_0x241e45[_0x1015fd(0x6d)]+'.'});return;}let _0x560530=_0x1015fd(0xec)+_0x178a91['length']+(_0x1015fd(0xa6)+_0x1015fd(0xfa)+'\x20last\x20')+_0x241e45[_0x1015fd(0xd3)]+_0x241e45['unit']+_0x1015fd(0x121);const _0x3594c4=[];let _0x3d3fb1=0x629*-0x1+-0x1800+0x1e29*0x1;for(const _0x47956a of _0x178a91){_0x3d3fb1++;const _0x1c39e0=_0x47956a[_0x1015fd(0x76)][_0x1015fd(0x90)]('@')[0x5*-0x707+0x3*-0x789+0x1*0x39be];_0x560530+=_0x1015fd(0xd6)+_0x1c39e0+'\x20('+(_0x47956a['display_na'+'me']||_0x1c39e0)+')\x0a',_0x560530+=romanParen(_0x3d3fb1)+'\x20'+_0x47956a[_0x1015fd(0x167)]+(_0x1015fd(0x144)+'\x0a'),_0x3594c4[_0x1015fd(0xe4)](_0x47956a[_0x1015fd(0x76)]);}const _0x479734=-0x21a3+0x10d0+-0x47*-0x75;if(_0x560530[_0x1015fd(0xad)]<=_0x479734)await sendApi(_0x4c6258,{'text':_0x560530,'mentions':_0x3594c4});else{const _0x175d1b=_0x560530[_0x1015fd(0x90)]('\x0a\x0a');let _0x47c173='';for(const _0x301cdd of _0x175d1b){if((_0x47c173+'\x0a\x0a'+_0x301cdd)[_0x1015fd(0xad)]>_0x479734)await sendApi(_0x4c6258,{'text':_0x47c173,'mentions':_0x3594c4}),_0x47c173=_0x301cdd+'\x0a\x0a';else _0x47c173+=(_0x47c173?'\x0a\x0a':'')+_0x301cdd;}if(_0x47c173['trim']())await sendApi(_0x4c6258,{'text':_0x47c173,'mentions':_0x3594c4});}return;}if(_0x2854b7===_0x1015fd(0x189)){const _0x1972a7=botRef?.[_0x1015fd(0x104)]||botRef,_0x18c334=await getGroupParticipants(_0x1972a7,_0x4c6258);if(!_0x18c334||_0x18c334[_0x1015fd(0xad)]===-0x1390+0x1cdd+-0x94d*0x1){await sendApi(_0x4c6258,{'text':_0x1015fd(0xc6)+_0x1015fd(0xd5)+_0x1015fd(0xfb)+_0x1015fd(0x92)});return;}const _0x57d8e5=await buildLeaderboardForChat(_0x4c6258,_0x592023,-0x14b58*-0x5+-0x16e*0x10c7+0x7161*0x4a),_0x20fc68=new Set((_0x57d8e5||[])[_0x1015fd(0x1ac)](_0x1c0aa8=>normalizeJid(_0x1c0aa8['user_jid']))),_0x8a2f3c=_0x18c334[_0x1015fd(0x11b)](_0x1452d2=>!_0x20fc68[_0x1015fd(0x152)](normalizeJid(_0x1452d2)));if(!_0x8a2f3c[_0x1015fd(0xad)]){await sendApi(_0x4c6258,{'text':_0x1015fd(0x179)+_0x1015fd(0xdb)+_0x1015fd(0xae)+_0x1015fd(0x127)+_0x241e45['amount']+_0x241e45[_0x1015fd(0x6d)]+'.'});return;}let _0x3c72b9='Found\x20'+_0x8a2f3c[_0x1015fd(0xad)]+('\x20inactive\x20'+_0x1015fd(0xf8)+'\x20the\x20last\x20')+_0x241e45[_0x1015fd(0xd3)]+_0x241e45['unit']+_0x1015fd(0x121);const _0x137318=[];let _0x585a83=-0x1c78+-0xa*-0x1fb+0x8aa;for(const _0x2fdb88 of _0x8a2f3c){_0x585a83++;const _0x308d93=_0x2fdb88['split']('@')[0x598+-0x65*0x17+0x37b];_0x3c72b9+=_0x1015fd(0xd6)+_0x308d93+'\x20('+_0x308d93+')\x0a',_0x3c72b9+=romanParen(_0x585a83)+(_0x1015fd(0x6a)+_0x1015fd(0x1a8)),_0x137318[_0x1015fd(0xe4)](_0x2fdb88);}await sendApi(_0x4c6258,{'text':_0x3c72b9,'mentions':_0x137318});return;}}catch(_0x4ce5b0){error(_0x4ce5b0,_0x1015fd(0x1aa)+_0x1015fd(0x196)+_0x1015fd(0xf1)+(_0x4ce5b0?.['message']||_0x4ce5b0));}}export async function cleanup(){const _0x9205a0=_0x26d59d;try{for(const _0x428609 of processedMessageKeys[_0x9205a0(0x1bd)]())try{clearTimeout(_0x428609);}catch(_0x54a51d){}processedMessageKeys[_0x9205a0(0x94)]();}catch(_0x124bfd){}botRef=null,sendApi=null,info('[active]\x20c'+_0x9205a0(0x125));}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};