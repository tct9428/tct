const _0x3b529c=_0x3e44;(function(_0x1c0576,_0x91c58d){const _0x52fe23=_0x3e44,_0x343b14=_0x1c0576();while(!![]){try{const _0x51aa07=parseInt(_0x52fe23(0x1db))/(0x1*-0x663+-0xea8+0x704*0x3)*(parseInt(_0x52fe23(0x238))/(0xa7b+-0x508+-0xc7*0x7))+parseInt(_0x52fe23(0x1bd))/(0x38b+-0x2*0x6a3+0x9be*0x1)+-parseInt(_0x52fe23(0x1ec))/(0x1fc+-0x1a81*-0x1+-0x1c79*0x1)+parseInt(_0x52fe23(0x264))/(0x65*0x4d+0xe*-0xc7+-0x137a)*(parseInt(_0x52fe23(0x2de))/(-0x7a*-0x44+0xfb7+0x6df*-0x7))+parseInt(_0x52fe23(0x21e))/(-0x9c3+-0x94d+-0x1*-0x1317)+-parseInt(_0x52fe23(0x1df))/(0x2d*-0x50+-0x1*0x12d+0xf45)+-parseInt(_0x52fe23(0x250))/(0x1ac6+-0x22ec+0x1a3*0x5);if(_0x51aa07===_0x91c58d)break;else _0x343b14['push'](_0x343b14['shift']());}catch(_0x550a6d){_0x343b14['push'](_0x343b14['shift']());}}}(_0x3932,0x1*-0x11250a+0x92489*0x1+0x11d1cf));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x3b529c(0x21a);export const version=_0x3b529c(0x2a1);export const priority=-0xb17+0x226*0xd+-0x107d;export const commands=[_0x3b529c(0x21a),_0x3b529c(0x22e)];let botRef=null,sendApi=null;const DEFAULTS={'TIME_ZONE':_0x3b529c(0x1e7),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(0x13d*0x6+0x2066+-0x27b6)*(0x1*-0x541+0x1*0x539+-0x3*-0x150)};let CONFIG={...DEFAULTS};function normalizeJid(_0x11a886){const _0x5ca50d=_0x3b529c;return _0x11a886?String(_0x11a886)[_0x5ca50d(0x1e4)]():'';}function sleep(_0x5cace2){return new Promise(_0x51cd90=>setTimeout(_0x51cd90,_0x5cace2));}function toLowerRoman(_0x23a307){const _0xc2bab=_0x3b529c,_0x2dd012=[[0x2425+0x2b*-0x89+-0x93a,'M'],[0x1371+-0x7f*0x41+-0x1*-0x1052,'CM'],[-0x1948+-0xc45+0x2781,'D'],[0xce*0x2c+-0x1*0x13c3+-0xe15*0x1,'CD'],[-0x2045*0x1+-0x1f*-0x35+0x1a3e,'C'],[0xd4a+0x64*0xa+-0x10d8,'XC'],[0x1548+-0x1*-0x77+0x158d*-0x1,'L'],[-0x963+-0x9c1*-0x1+-0x1*0x36,'XL'],[-0x2c5*0x3+-0x72d+0xf86,'X'],[-0x11*-0x1e2+-0x1f+-0x6*0x54f,'IX'],[-0x1*-0x22+0x78f+-0x7ac,'V'],[0x2df*0x3+0x1e29+-0x79*0x52,'IV'],[-0x26c4+0x1db4+-0x911*-0x1,'I']];let _0x33be4b=_0x23a307,_0x5cfe75='';for(const [_0x15e45e,_0x12f465]of _0x2dd012)while(_0x33be4b>=_0x15e45e){_0x5cfe75+=_0x12f465,_0x33be4b-=_0x15e45e;}return _0x5cfe75[_0xc2bab(0x295)+'e']();}function romanParen(_0x180971){return'('+toLowerRoman(_0x180971)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x4c98aa){const _0x256cab=_0x3b529c,_0xb7942c=_0x4c98aa?.[_0x256cab(0x2e8)];if(!_0xb7942c)return null;const _0x50d67b=_0xb7942c['id']||_0xb7942c[_0x256cab(0x22d)+'t']||'',_0x4d51f6=_0xb7942c[_0x256cab(0x1cd)]||'';return _0x4d51f6+'::'+_0x50d67b;}function isMsgProcessed(_0x320d6b){const _0xd923a3=_0x3b529c;return _0x320d6b&&processedMessageKeys[_0xd923a3(0x1f4)](_0x320d6b);}function markMsgProcessed(_0x15f1e3){const _0x5b5ace=_0x3b529c;if(!_0x15f1e3)return;if(processedMessageKeys[_0x5b5ace(0x1f4)](_0x15f1e3))clearTimeout(processedMessageKeys[_0x5b5ace(0x25b)](_0x15f1e3));const _0x36aba8=setTimeout(()=>processedMessageKeys[_0x5b5ace(0x2b1)](_0x15f1e3),CONFIG[_0x5b5ace(0x24f)+'_MS']);processedMessageKeys['set'](_0x15f1e3,_0x36aba8);}async function ensureSchema(){const _0x54ab2d=_0x3b529c;try{await db[_0x54ab2d(0x29b)](_0x54ab2d(0x278)+'LE\x20IF\x20NOT\x20'+'EXISTS\x20act'+_0x54ab2d(0x2ea)+_0x54ab2d(0x2e2)+_0x54ab2d(0x26f)+_0x54ab2d(0x1f7)+_0x54ab2d(0x1cf)+'ted_at\x20INT'+'EGER\x20DEFAU'+_0x54ab2d(0x203)+_0x54ab2d(0x244)+_0x54ab2d(0x1a4)),await db[_0x54ab2d(0x29b)](_0x54ab2d(0x1d5)+_0x54ab2d(0x24b)+_0x54ab2d(0x1eb)+_0x54ab2d(0x207)+'_stats\x20(\x0a\x20'+_0x54ab2d(0x231)+_0x54ab2d(0x220)+_0x54ab2d(0x246)+'AUTOINCREM'+_0x54ab2d(0x26d)+'\x20\x20\x20chat_ji'+_0x54ab2d(0x2a0)+'\x20NULL,\x0a\x20\x20\x20'+'\x20\x20\x20\x20\x20user_'+_0x54ab2d(0x2cd)+_0x54ab2d(0x206)+_0x54ab2d(0x233)+_0x54ab2d(0x1d8)+_0x54ab2d(0x24e)+',\x20\x20\x20\x20\x20\x20\x20\x20-'+'-\x20\x27daily\x27|'+_0x54ab2d(0x1a1)+_0x54ab2d(0x217)+_0x54ab2d(0x2a2)+'\x20\x20\x20\x20\x20\x20buck'+_0x54ab2d(0x2e0)+_0x54ab2d(0x24e)+_0x54ab2d(0x226)+_0x54ab2d(0x239)+_0x54ab2d(0x235)+_0x54ab2d(0x20c)+'Y-WW,\x20mont'+'hly:\x20YYYY-'+_0x54ab2d(0x1f8)+_0x54ab2d(0x21b)+_0x54ab2d(0x263)+'ge_count\x20I'+'NTEGER\x20DEF'+_0x54ab2d(0x2c5)+_0x54ab2d(0x224)+'lay_name\x20T'+'EXT\x20DEFAUL'+_0x54ab2d(0x1ca)+'\x20\x20\x20\x20last_u'+_0x54ab2d(0x2b0)+_0x54ab2d(0x1cb)+_0x54ab2d(0x203)+_0x54ab2d(0x244)+'ow\x27)),\x0a\x20\x20\x20'+_0x54ab2d(0x2bb)+'E(chat_jid'+',\x20user_jid'+',\x20timefram'+_0x54ab2d(0x2b7)+_0x54ab2d(0x210)+_0x54ab2d(0x1b3)),await db[_0x54ab2d(0x29b)]('CREATE\x20IND'+_0x54ab2d(0x287)+_0x54ab2d(0x237)+_0x54ab2d(0x286)+_0x54ab2d(0x2c3)+'f\x20ON\x20activ'+_0x54ab2d(0x1d7)+_0x54ab2d(0x28c)+_0x54ab2d(0x1c6)+'ucket_key)'+';'),await db[_0x54ab2d(0x29b)](_0x54ab2d(0x2a6)+'EX\x20IF\x20NOT\x20'+_0x54ab2d(0x237)+'_active_st'+_0x54ab2d(0x1dd)+'ser\x20ON\x20act'+_0x54ab2d(0x1bf)+_0x54ab2d(0x2a8)+_0x54ab2d(0x1c0)),await db['exec'](_0x54ab2d(0x1d5)+'ATE\x20TABLE\x20'+_0x54ab2d(0x1eb)+_0x54ab2d(0x207)+'_leaderboa'+_0x54ab2d(0x1ac)+_0x54ab2d(0x261)+_0x54ab2d(0x1e0)+_0x54ab2d(0x2d7)+_0x54ab2d(0x2be)+_0x54ab2d(0x2d8)+_0x54ab2d(0x25c)+_0x54ab2d(0x218)+_0x54ab2d(0x271)),info(_0x54ab2d(0x2b9)+_0x54ab2d(0x19e)+_0x54ab2d(0x24d));}catch(_0x58a53a){error(_0x58a53a,_0x54ab2d(0x288)+_0x54ab2d(0x28a)+_0x54ab2d(0x2ec));throw _0x58a53a;}}function _0x3e44(_0x72a6c2,_0x2e3ff8){const _0x3009b2=_0x3932();return _0x3e44=function(_0xeb445e,_0x222768){_0xeb445e=_0xeb445e-(0x7*-0x9f+-0xefd+0x14f4);let _0x51c754=_0x3009b2[_0xeb445e];return _0x51c754;},_0x3e44(_0x72a6c2,_0x2e3ff8);}export async function trackMessage(_0x1b1459){const _0x244d6f=_0x3b529c;try{if(!_0x1b1459||!_0x1b1459[_0x244d6f(0x2e8)]||!_0x1b1459[_0x244d6f(0x27b)])return;const _0x49317c=makeDedupeKey(_0x1b1459);if(!_0x49317c)return;if(isMsgProcessed(_0x49317c))return;markMsgProcessed(_0x49317c);if(_0x1b1459[_0x244d6f(0x2e8)]['fromMe'])return;const _0xbea47c=_0x1b1459[_0x244d6f(0x2e8)][_0x244d6f(0x1cd)];if(!_0xbea47c||!_0xbea47c['endsWith'](_0x244d6f(0x2d1)))return;const _0x4791ad=_0x1b1459[_0x244d6f(0x2e8)][_0x244d6f(0x22d)+'t']||_0x1b1459[_0x244d6f(0x2e8)][_0x244d6f(0x292)]||'';if(!_0x4791ad)return;const _0x2517b4=normalizeJid(_0x4791ad),_0x1de87d=DateTime[_0x244d6f(0x293)]()[_0x244d6f(0x243)](CONFIG[_0x244d6f(0x1c3)]),_0x21b019=_0x1de87d[_0x244d6f(0x25e)](_0x244d6f(0x1e9));try{const _0x1776e9=await db[_0x244d6f(0x23c)](_0x244d6f(0x2bc)+_0x244d6f(0x2c4)+'ve_stats\x0a\x20'+_0x244d6f(0x1c8)+'\x20message_c'+'ount\x20=\x20mes'+'sage_count'+_0x244d6f(0x216)+_0x244d6f(0x1af)+'\x20?,\x20last_u'+_0x244d6f(0x27d)+_0x244d6f(0x255)+_0x244d6f(0x26a)+_0x244d6f(0x219)+'D\x20user_jid'+_0x244d6f(0x276)+_0x244d6f(0x2b2)+_0x244d6f(0x1e2)+'ND\x20bucket_'+_0x244d6f(0x2e9)+_0x244d6f(0x285),[_0x1b1459[_0x244d6f(0x215)]||_0x1b1459['senderName']||'',Math[_0x244d6f(0x2b5)](_0x1de87d['toSeconds']()),_0xbea47c,_0x2517b4,_0x21b019]);(!_0x1776e9||!_0x1776e9['changes'])&&await db['run'](_0x244d6f(0x201)+_0x244d6f(0x1c2)+_0x244d6f(0x283)+_0x244d6f(0x23d)+_0x244d6f(0x1ee)+_0x244d6f(0x2d9)+_0x244d6f(0x2aa)+_0x244d6f(0x259)+'message_co'+'unt,\x20displ'+_0x244d6f(0x22f)+_0x244d6f(0x1d4)+'d)\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x244d6f(0x1d9)+'(?,\x20?,\x20\x27da'+_0x244d6f(0x2d6)+_0x244d6f(0x1b8)+_0x244d6f(0x20b),[_0xbea47c,_0x2517b4,_0x21b019,_0x1b1459[_0x244d6f(0x215)]||_0x1b1459[_0x244d6f(0x289)]||'',Math[_0x244d6f(0x2b5)](_0x1de87d[_0x244d6f(0x2e7)]())]);}catch(_0x3777e3){warn(_0x244d6f(0x1a2)+_0x244d6f(0x2b3)+'e\x20DB\x20error'+':\x20'+(_0x3777e3?.['message']||_0x3777e3));}}catch(_0x267085){warn(_0x244d6f(0x1a2)+_0x244d6f(0x2b3)+_0x244d6f(0x241)+_0x244d6f(0x2e6)+(_0x267085?.[_0x244d6f(0x27b)]||_0x267085));}}function _0x3932(){const _0x17ade9=['join','T_RETURN','\x20);\x0a\x20\x20\x20\x20','INSERT\x20INT','ive_stats\x20','FROM\x20activ','user_jid',',\x20?,\x20?)\x0a\x20\x20','month','id\x20=\x20?','ay_name\x20FR','sourceIds','577590KeQFsx','\x20bucket_ke','ive_stats(','user_jid);','IMIT\x201','\x20INSERT\x20IN','TIME_ZONE','meframe\x20=\x20','ive\x20<amoun','meframe,\x20b','text','\x20\x20\x20\x20\x20\x20\x20SET','ROLLOVER_T','T\x20\x27\x27,\x0a\x20\x20\x20\x20','EGER\x20DEFAU','daily\x27\x20AND','remoteJid','unt','KEY,\x20migra','y,\x20message','ACTIVE','M\x20active_s','chat_jid','ast_update','\x0a\x20\x20\x20\x20\x20\x20CRE','end\x20usage\x20','e_stats(ch','eframe\x20TEX','\x20\x20\x20VALUES\x20','\x20messages\x0a','1509sdQBoj','failed\x20for','ats_chat_u','sock','6746160SiYvNe','\x20\x20chat_jid','ECT\x20user_j','\x20\x27daily\x27\x20A','\x20last\x20','trim','e\x20members\x20','Found\x20','UTC',')\x20VALUES\x20(','yyyy-LL-dd','[active]\x20o','IF\x20NOT\x20EXI','2495632kdSlhl','ups\x20failed','t_jid,\x20use','||monthly|','_jid,\x20user','group\x20part','und\x20in\x20the','t_updated\x20','has','length','fromObject','R\x20PRIMARY\x20','MM,\x20yearly','\x20the\x20last\x20','\x27,\x27monthly','MAX_DAILY_','message_co','t_key\x20<=\x20?','AND\x20bucket','_ts\x0a\x20\x20\x20\x20\x20\x20','M(message_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','ata','LT\x20(strfti','No\x20inactiv','id\x20=\x20?\x20AND','OT\x20NULL,\x0a\x20','STS\x20active','members\x20in','failed:\x20','UPDATE\x20act','\x20\x20\x20\x20\x20\x20','eekly:\x20YYY','members\x20fo','\x20AND\x20bucke','groupMetad','key)\x0a\x20\x20\x20\x20\x20','\x20timeframe','\x20FROM\x20acti','unt,\x20displ','_jid,\x20time','pushName','\x20+\x201,\x20disp','monthly\x27|\x27','XT\x0a\x20\x20\x20\x20\x20\x20)','jid\x20=\x20?\x20AN','active',':\x20YYYY\x0a\x20\x20\x20','split','\x20no\x20messag','8684137GRsUTK','ead\x20config','INTEGER\x20PR','kly\x27,\x20?,\x20?','O_WEEK_DAY','map','\x20\x20\x20\x20\x20\x20disp','cnt',',\x20\x20\x20\x20\x20\x20--\x20','unt\x20+\x20?,\x20d','SELECT\x20id\x20','imeframe\x20I','plete','ailed:\x20','Usage:\x20act','participan','inactive','ay_name,\x20l','?,\x20?,\x20\x27yea','\x20\x20\x20\x20\x20\x20\x20id\x20','ND\x20bucket_','\x20\x20\x20\x20\x20\x20\x20tim','\x20\x20\x20\x20WHERE\x20','Y-MM-DD,\x20w','ket_key,\x20m','EXISTS\x20idx','1546dFjmiP','daily:\x20YYY','\x20user_jid\x20','determine\x20','run','stats\x20(cha','ucket_key\x20','ollups\x20com','isArray','e\x20unexpect','minus','setZone','me(\x27%s\x27,\x27n','isCommand','IMARY\x20KEY\x20','nitialized','e_count\x20=\x20','count','string','ATE\x20TABLE\x20','splay_name','red','T\x20NOT\x20NULL','DEDUPE_TTL','6830325EHdcmC','thly\x27,\x20?,\x20','ERE\x20chat_j','.ACTIVE:\x20','last_ts','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','?,\x20?,\x20\x27mon','N\x20(\x27weekly','[active]\x20p','cket_key,\x20','ily\x27\x20AND\x20b','get','sage_id\x20TE','\x20failed:\x20','toFormat','\x27monthly\x27\x20','weekly','s\x20(\x0a\x20\x20\x20\x20\x20\x20','y_name,\x20SU','\x20\x20\x20\x20\x20messa','449885ezBjnI','No\x20active\x20','set','HERE\x20timef','match',',\x20?,\x20?)','HERE\x20chat_','_count,\x20di','[active]\x20d','ENT,\x0a\x20\x20\x20\x20\x20','unt><d|w|m','ion\x20INTEGE','\x27,\x27yearly\x27',';\x0a\x20\x20\x20\x20','rame\x20=\x20\x27we','ticipants\x20','tive\x207d','||yearly||','\x20=\x20?\x20AND\x20t','push','CREATE\x20TAB','st_updated','\x27weekly\x27\x20A','message','display_na','pdated\x20=\x20?','weekYear','ctive\x20<amo','_key\x20=\x20?\x20L','ers\x20in\x20the','frame,\x20buc','TO\x20active_','yearly','\x20\x20\x20\x20','_active_st','EX\x20IF\x20NOT\x20','[active]\x20e','senderName','nsureSchem','O_MONTH_DA','at_jid,\x20ti','padStart','KEEP_DAYS','function','t><d|w|m|y','key\x20=\x20?\x20LI','from','now','monthly','toLowerCas','e_stats\x0a\x20\x20','sendMessag','SELECT\x20id,','chat_jid\x20=','es:\x20active','exec','\x20?\x20AND\x20tim','leaned\x20up','SELECT\x20use','all','d\x20TEXT\x20NOT','1.1.1','yearly\x27\x0a\x20\x20','E\x20chat_jid','DELETE\x20FRO','year','CREATE\x20IND','Could\x20not\x20','chat_jid,\x20','isplay_nam','eframe,\x20bu','nMessage\x20f','slice','=\x20?\x20AND\x20ti','O_YEAR_DAY','\x20id\x20IN\x20(','pdated\x20INT','delete','imeframe\x20=','rackMessag','ailed\x20to\x20r','floor','O\x20active_s','e,\x20bucket_','bucket_key','[active]\x20s','erformRoll','\x20\x20\x20\x20\x20UNIQU','\x0a\x20\x20\x20\x20\x20\x20\x20\x20U','e_stats\x20WH','ARY\x20KEY,\x0a\x20','USERS_LIMI','[active]\x20f','amount','?,\x20?,\x20\x27wee','ats_chat_t','PDATE\x20acti','AULT\x200,\x0a\x20\x20','MIT\x201','count)\x20AS\x20','ðŸ‘¤\x20@','|y>\x0aExampl','essage_cou','=\x20?\x20WHERE\x20','ve_stats\x20W','jid\x20TEXT\x20N','y_name,\x20la','\x201d,\x20activ','nt,\x20displa','@g.us','rame\x20=\x20\x27da','board\x20erro','y\x20>=\x20?\x0a\x20\x20\x20','>\x20\x20OR\x20\x20ina','ily\x27,\x20?,\x201','\x20TEXT\x20PRIM','\x20\x20\x20\x20\x20\x20\x20mes','r_jid,\x20tim','?,\x20?,\x20?)','endsWith','tats\x20WHERE','values','18iqyilM','timeframe','et_key\x20TEX','\x0a\x20\x20\x20\x20\x20\x20SEL','ions\x20(vers','e\x20=\x20?,\x20las','tats\x20(chat','[active]\x20g','ed:\x20','toSeconds','key','key\x20=\x20?\x0a\x20\x20','ive_migrat','\x20user_jid,','a\x20failed','rly\x27,\x20?,\x20?','chema\x20ensu','\x20chat_jid,','nthly\x27','\x27weekly\x27|\x27','[active]\x20t','filter','ow\x27)));','Y\x20user_jid',':\x0a\x0a','catch','unit','[active]\x20i','SET\x20messag','stats\x20WHER','rd_message','[active]\x20b','fromFormat','lay_name\x20=','\x20=\x20\x27daily\x27'];_0x3932=function(){return _0x17ade9;};return _0x3932();}async function performRollups(){const _0x486865=_0x3b529c;try{const _0x366023=DateTime[_0x486865(0x293)]()[_0x486865(0x243)](CONFIG[_0x486865(0x1c3)]),_0x24d4ad=_0x366023['minus']({'days':CONFIG[_0x486865(0x1c9)+_0x486865(0x222)+'S']})['startOf']('day'),_0x57ca99=_0x24d4ad[_0x486865(0x25e)]('yyyy-LL-dd'),_0x332c07=await db[_0x486865(0x29f)](_0x486865(0x298)+'\x20chat_jid,'+_0x486865(0x2eb)+_0x486865(0x1be)+_0x486865(0x1d0)+_0x486865(0x26b)+_0x486865(0x24c)+_0x486865(0x212)+_0x486865(0x2cc)+_0x486865(0x267)+_0x486865(0x2d2)+_0x486865(0x25a)+_0x486865(0x23e)+'<=\x20?',[_0x57ca99]);if(_0x332c07&&_0x332c07[_0x486865(0x1f5)]){const _0x29a6c0=new Map();for(const _0x152dce of _0x332c07){const _0x4fbff3=DateTime[_0x486865(0x1ae)](_0x152dce[_0x486865(0x2b8)],'yyyy-LL-dd',{'zone':CONFIG[_0x486865(0x1c3)]}),_0x18f42a=_0x4fbff3[_0x486865(0x27e)]+'-'+String(_0x4fbff3['weekNumber'])['padStart'](-0x32f*0x1+-0xe73+0x11a4,'0'),_0x480a51=_0x152dce[_0x486865(0x1d3)]+'||'+_0x152dce['user_jid']+'||weekly||'+_0x18f42a;if(!_0x29a6c0['has'](_0x480a51))_0x29a6c0[_0x486865(0x266)](_0x480a51,{'chat_jid':_0x152dce[_0x486865(0x1d3)],'user_jid':_0x152dce[_0x486865(0x1b7)],'timeframe':_0x486865(0x260),'bucket_key':_0x18f42a,'message_count':0x0,'display_name':_0x152dce[_0x486865(0x27c)+'me']||''});const _0x320e89=_0x29a6c0[_0x486865(0x25b)](_0x480a51);_0x320e89['message_co'+'unt']+=Number(_0x152dce[_0x486865(0x1fc)+'unt']||0x2*-0xf47+-0x179*-0xb+0xe5b);}for(const _0x46cc23 of _0x29a6c0['values']()){const _0x216cbd=await db[_0x486865(0x25b)](_0x486865(0x228)+_0x486865(0x1b6)+_0x486865(0x2bd)+_0x486865(0x252)+_0x486865(0x205)+'\x20user_jid\x20'+_0x486865(0x2ad)+'meframe\x20=\x20'+_0x486865(0x27a)+_0x486865(0x232)+_0x486865(0x291)+'MIT\x201',[_0x46cc23[_0x486865(0x1d3)],_0x46cc23[_0x486865(0x1b7)],_0x46cc23[_0x486865(0x2b8)]]);!_0x216cbd?await db['run'](_0x486865(0x1b4)+_0x486865(0x2b6)+_0x486865(0x2e4)+_0x486865(0x1f0)+'_jid,\x20time'+_0x486865(0x282)+'ket_key,\x20m'+_0x486865(0x2ca)+_0x486865(0x2d0)+'y_name,\x20la'+_0x486865(0x279)+_0x486865(0x1e8)+_0x486865(0x2c2)+_0x486865(0x221)+_0x486865(0x269),[_0x46cc23[_0x486865(0x1d3)],_0x46cc23[_0x486865(0x1b7)],_0x46cc23[_0x486865(0x2b8)],_0x46cc23[_0x486865(0x1fc)+'unt'],_0x46cc23[_0x486865(0x27c)+'me']||'',Math[_0x486865(0x2b5)](_0x366023[_0x486865(0x2e7)]())]):await db['run'](_0x486865(0x20a)+_0x486865(0x1b5)+_0x486865(0x1aa)+_0x486865(0x248)+_0x486865(0x1fc)+_0x486865(0x227)+_0x486865(0x2a9)+_0x486865(0x2e3)+_0x486865(0x1f3)+_0x486865(0x2cb)+_0x486865(0x1ba),[_0x46cc23[_0x486865(0x1fc)+'unt'],_0x46cc23[_0x486865(0x27c)+'me']||'',Math[_0x486865(0x2b5)](_0x366023[_0x486865(0x2e7)]()),_0x216cbd['id']]);}try{const _0xb23185=_0x332c07[_0x486865(0x223)](_0x30757e=>_0x30757e['id']);for(let _0x165787=-0x1b91*-0x1+-0x5*0x70f+-0x3dd*-0x2;_0x165787<_0xb23185['length'];_0x165787+=-0x5dd*-0x1+-0x16ba+0x12d1){const _0x1988ed=_0xb23185[_0x486865(0x2ac)](_0x165787,_0x165787+(0x49e*0x1+-0xd42+0xa98)),_0x442500=_0x486865(0x2a4)+_0x486865(0x1d2)+_0x486865(0x2dc)+_0x486865(0x2af)+_0x1988ed[_0x486865(0x223)](()=>'?')[_0x486865(0x1b1)](',')+')';await db[_0x486865(0x23c)](_0x442500,_0x1988ed);}}catch(_0x42c661){warn(_0x486865(0x26c)+'elete\x20old\x20'+'daily\x20rows'+_0x486865(0x25d)+(_0x42c661?.[_0x486865(0x27b)]||_0x42c661));}}const _0x5f1de6=_0x366023[_0x486865(0x242)]({'days':CONFIG['ROLLOVER_T'+_0x486865(0x28b)+'YS']})[_0x486865(0x2e7)](),_0x5cc35a=await db[_0x486865(0x29f)](_0x486865(0x298)+_0x486865(0x19f)+_0x486865(0x2eb)+_0x486865(0x1be)+_0x486865(0x1d0)+'_count,\x20di'+'splay_name'+'\x20FROM\x20acti'+'ve_stats\x20W'+_0x486865(0x267)+_0x486865(0x272)+'ekly\x27');if(_0x5cc35a&&_0x5cc35a[_0x486865(0x1f5)]){const _0xd05fcb=new Map();for(const _0x26ad19 of _0x5cc35a){const _0x326399=String(_0x26ad19[_0x486865(0x2b8)]||'')[_0x486865(0x21c)]('-'),_0x1245e4=Number(_0x326399[0x2299+-0x667+-0x6*0x4b3])||-0xc95*-0x3+0x6*0x4e6+-0x3b71,_0x501343=Number(_0x326399[0xf8f+0x2294+-0x3222])||-0x1f7*0xf+0x1*-0xf4d+0x2cc7,_0x178b3f=DateTime[_0x486865(0x1f6)]({'weekYear':_0x1245e4,'weekNumber':_0x501343,'weekday':0x1},{'zone':CONFIG[_0x486865(0x1c3)]});if(_0x178b3f[_0x486865(0x2e7)]()>_0x5f1de6)continue;const _0x2c5fbc=_0x178b3f[_0x486865(0x2a5)]+'-'+String(_0x178b3f[_0x486865(0x1b9)])[_0x486865(0x28d)](-0x2*-0x185+-0x23d2+0x20ca,'0'),_0x302a3a=_0x26ad19[_0x486865(0x1d3)]+'||'+_0x26ad19[_0x486865(0x1b7)]+(_0x486865(0x1ef)+'|')+_0x2c5fbc;if(!_0xd05fcb[_0x486865(0x1f4)](_0x302a3a))_0xd05fcb[_0x486865(0x266)](_0x302a3a,{'chat_jid':_0x26ad19[_0x486865(0x1d3)],'user_jid':_0x26ad19[_0x486865(0x1b7)],'timeframe':_0x486865(0x294),'bucket_key':_0x2c5fbc,'message_count':0x0,'display_name':_0x26ad19['display_na'+'me']||'','sourceIds':[]});const _0x27f48a=_0xd05fcb[_0x486865(0x25b)](_0x302a3a);_0x27f48a[_0x486865(0x1fc)+'unt']+=Number(_0x26ad19['message_co'+_0x486865(0x1ce)]||0x58*0xe+0x24b3*-0x1+0x1fe3),_0x27f48a[_0x486865(0x1bc)]['push'](_0x26ad19['id']);}for(const _0x2f7066 of _0xd05fcb['values']()){const _0x5265e9=await db[_0x486865(0x25b)](_0x486865(0x228)+_0x486865(0x1b6)+_0x486865(0x2bd)+'ERE\x20chat_j'+_0x486865(0x205)+'\x20user_jid\x20'+_0x486865(0x2ad)+_0x486865(0x1c4)+_0x486865(0x25f)+_0x486865(0x1fe)+_0x486865(0x280)+_0x486865(0x1c1),[_0x2f7066[_0x486865(0x1d3)],_0x2f7066[_0x486865(0x1b7)],_0x2f7066['bucket_key']]);!_0x5265e9?await db[_0x486865(0x23c)](_0x486865(0x1b4)+_0x486865(0x2b6)+_0x486865(0x2e4)+_0x486865(0x1f0)+_0x486865(0x214)+_0x486865(0x282)+_0x486865(0x236)+_0x486865(0x2ca)+'nt,\x20displa'+_0x486865(0x2ce)+_0x486865(0x279)+_0x486865(0x1e8)+_0x486865(0x256)+_0x486865(0x251)+_0x486865(0x2da),[_0x2f7066[_0x486865(0x1d3)],_0x2f7066[_0x486865(0x1b7)],_0x2f7066[_0x486865(0x2b8)],_0x2f7066[_0x486865(0x1fc)+_0x486865(0x1ce)],_0x2f7066[_0x486865(0x27c)+'me']||'',Math[_0x486865(0x2b5)](_0x366023[_0x486865(0x2e7)]())]):await db[_0x486865(0x23c)](_0x486865(0x20a)+_0x486865(0x1b5)+'SET\x20messag'+_0x486865(0x248)+_0x486865(0x1fc)+_0x486865(0x227)+_0x486865(0x2a9)+_0x486865(0x2e3)+_0x486865(0x1f3)+_0x486865(0x2cb)+_0x486865(0x1ba),[_0x2f7066[_0x486865(0x1fc)+_0x486865(0x1ce)],_0x2f7066[_0x486865(0x27c)+'me']||'',Math[_0x486865(0x2b5)](_0x366023[_0x486865(0x2e7)]()),_0x5265e9['id']]);if(Array['isArray'](_0x2f7066[_0x486865(0x1bc)])&&_0x2f7066[_0x486865(0x1bc)][_0x486865(0x1f5)])for(let _0x15508e=0x2037+0x93f+-0x2976;_0x15508e<_0x2f7066[_0x486865(0x1bc)][_0x486865(0x1f5)];_0x15508e+=0x1*-0xa7+-0x5*0x3e4+-0x1*-0x160f){const _0x3fbb0e=_0x2f7066[_0x486865(0x1bc)][_0x486865(0x2ac)](_0x15508e,_0x15508e+(-0x2319+-0x2*-0x52c+0x1ab5)),_0x46c380=_0x486865(0x2a4)+_0x486865(0x1d2)+_0x486865(0x2dc)+_0x486865(0x2af)+_0x3fbb0e[_0x486865(0x223)](()=>'?')['join'](',')+')';await db[_0x486865(0x23c)](_0x46c380,_0x3fbb0e);}}}const _0x4040aa=_0x366023[_0x486865(0x242)]({'days':CONFIG[_0x486865(0x1c9)+_0x486865(0x2ae)+'S']})[_0x486865(0x2e7)](),_0x2138af=await db[_0x486865(0x29f)]('SELECT\x20id,'+'\x20chat_jid,'+_0x486865(0x2eb)+'\x20bucket_ke'+_0x486865(0x1d0)+_0x486865(0x26b)+'splay_name'+_0x486865(0x212)+_0x486865(0x2cc)+_0x486865(0x267)+'rame\x20=\x20\x27mo'+_0x486865(0x1a0));if(_0x2138af&&_0x2138af[_0x486865(0x1f5)]){const _0xaef251=new Map();for(const _0x38bec1 of _0x2138af){const _0x424b6a=String(_0x38bec1[_0x486865(0x2b8)]||'')['split']('-'),_0x53903f=Number(_0x424b6a[0x1d*0xe5+0x82f+-0x2220])||0x146e*0x1+-0x12f9*-0x2+0x1a*-0x1f3,_0x5b0d65=DateTime['fromObject']({'year':_0x53903f,'month':0x1,'day':0x1},{'zone':CONFIG[_0x486865(0x1c3)]});if(_0x5b0d65[_0x486865(0x2e7)]()>_0x4040aa)continue;const _0x2ff415=''+_0x53903f,_0x5a9a85=_0x38bec1[_0x486865(0x1d3)]+'||'+_0x38bec1[_0x486865(0x1b7)]+_0x486865(0x275)+_0x2ff415;if(!_0xaef251[_0x486865(0x1f4)](_0x5a9a85))_0xaef251[_0x486865(0x266)](_0x5a9a85,{'chat_jid':_0x38bec1[_0x486865(0x1d3)],'user_jid':_0x38bec1[_0x486865(0x1b7)],'timeframe':_0x486865(0x284),'bucket_key':_0x2ff415,'message_count':0x0,'display_name':_0x38bec1['display_na'+'me']||'','sourceIds':[]});const _0x1a5c20=_0xaef251[_0x486865(0x25b)](_0x5a9a85);_0x1a5c20[_0x486865(0x1fc)+_0x486865(0x1ce)]+=Number(_0x38bec1['message_co'+_0x486865(0x1ce)]||0x1*0x1bd+-0x1e39+-0x2*-0xe3e),_0x1a5c20[_0x486865(0x1bc)]['push'](_0x38bec1['id']);}for(const _0xa13906 of _0xaef251[_0x486865(0x2dd)]()){const _0x256ad6=await db['get'](_0x486865(0x228)+_0x486865(0x1b6)+_0x486865(0x2bd)+_0x486865(0x252)+_0x486865(0x205)+_0x486865(0x23a)+_0x486865(0x2ad)+_0x486865(0x1c4)+'\x27yearly\x27\x20A'+_0x486865(0x232)+_0x486865(0x291)+_0x486865(0x2c6),[_0xa13906['chat_jid'],_0xa13906['user_jid'],_0xa13906[_0x486865(0x2b8)]]);!_0x256ad6?await db[_0x486865(0x23c)](_0x486865(0x1b4)+'O\x20active_s'+_0x486865(0x2e4)+_0x486865(0x1f0)+'_jid,\x20time'+_0x486865(0x282)+'ket_key,\x20m'+'essage_cou'+_0x486865(0x2d0)+_0x486865(0x2ce)+_0x486865(0x279)+_0x486865(0x1e8)+_0x486865(0x230)+_0x486865(0x2ed)+_0x486865(0x269),[_0xa13906['chat_jid'],_0xa13906[_0x486865(0x1b7)],_0xa13906[_0x486865(0x2b8)],_0xa13906[_0x486865(0x1fc)+'unt'],_0xa13906[_0x486865(0x27c)+'me']||'',Math['floor'](_0x366023[_0x486865(0x2e7)]())]):await db['run'](_0x486865(0x20a)+'ive_stats\x20'+_0x486865(0x1aa)+_0x486865(0x248)+_0x486865(0x1fc)+_0x486865(0x227)+_0x486865(0x2a9)+'e\x20=\x20?,\x20las'+_0x486865(0x1f3)+'=\x20?\x20WHERE\x20'+'id\x20=\x20?',[_0xa13906[_0x486865(0x1fc)+_0x486865(0x1ce)],_0xa13906['display_na'+'me']||'',Math[_0x486865(0x2b5)](_0x366023[_0x486865(0x2e7)]()),_0x256ad6['id']]);if(Array[_0x486865(0x240)](_0xa13906[_0x486865(0x1bc)])&&_0xa13906[_0x486865(0x1bc)]['length'])for(let _0x426d55=0x5*-0x51b+0x1f91+-0x305*0x2;_0x426d55<_0xa13906[_0x486865(0x1bc)]['length'];_0x426d55+=-0x258a+0xdff+0x197f*0x1){const _0x5256a3=_0xa13906[_0x486865(0x1bc)][_0x486865(0x2ac)](_0x426d55,_0x426d55+(0x67*-0x40+-0x2646+0x41fa)),_0x5e419d='DELETE\x20FRO'+_0x486865(0x1d2)+_0x486865(0x2dc)+_0x486865(0x2af)+_0x5256a3['map'](()=>'?')[_0x486865(0x1b1)](',')+')';await db[_0x486865(0x23c)](_0x5e419d,_0x5256a3);}}}try{const _0x3dd8af=DateTime[_0x486865(0x293)]()[_0x486865(0x243)](CONFIG[_0x486865(0x1c3)])['minus']({'days':CONFIG[_0x486865(0x1fb)+_0x486865(0x28e)]})['toFormat'](_0x486865(0x1e9));await db['run']('DELETE\x20FRO'+_0x486865(0x1d2)+_0x486865(0x2dc)+_0x486865(0x211)+_0x486865(0x1b0)+_0x486865(0x20e)+_0x486865(0x1fd),[_0x3dd8af]);}catch(_0x2a3c22){warn(_0x486865(0x258)+'rune\x20daily'+'\x20failed:\x20'+(_0x2a3c22?.[_0x486865(0x27b)]||_0x2a3c22));}info('[active]\x20r'+_0x486865(0x23f)+_0x486865(0x22a));}catch(_0x239707){error(_0x239707,_0x486865(0x258)+_0x486865(0x2ba)+_0x486865(0x1ed)+':\x20'+(_0x239707?.[_0x486865(0x27b)]||_0x239707));}}function parsePeriodArg(_0x1753f3){const _0x584863=_0x3b529c;if(!_0x1753f3)return null;const _0x8faeb5=String(_0x1753f3)[_0x584863(0x1e4)]()[_0x584863(0x295)+'e']()[_0x584863(0x268)](/^(\d+)\s*([dwmy])$/);if(!_0x8faeb5)return null;return{'amount':Number(_0x8faeb5[-0x3*-0x30e+-0x54c+-0x3dd]),'unit':_0x8faeb5[0x1414+0x3*-0xd6+-0x1*0x1190]};}function computeCutoffSeconds(_0x303953,_0x410d1a){const _0x52d151=_0x3b529c,_0x473f98=DateTime[_0x52d151(0x293)]()['setZone'](CONFIG['TIME_ZONE']);let _0x33cbe1;if(_0x410d1a==='d')_0x33cbe1=_0x473f98[_0x52d151(0x242)]({'days':_0x303953});else{if(_0x410d1a==='w')_0x33cbe1=_0x473f98[_0x52d151(0x242)]({'weeks':_0x303953});else{if(_0x410d1a==='m')_0x33cbe1=_0x473f98[_0x52d151(0x242)]({'months':_0x303953});else{if(_0x410d1a==='y')_0x33cbe1=_0x473f98['minus']({'years':_0x303953});else _0x33cbe1=_0x473f98['minus']({'days':_0x303953});}}}return Math[_0x52d151(0x2b5)](_0x33cbe1[_0x52d151(0x2e7)]());}async function buildLeaderboardForChat(_0x4d78f6,_0x30157a,_0x2abe3f=CONFIG[_0x3b529c(0x2bf)+_0x3b529c(0x1b2)]){const _0x2a4ec6=_0x3b529c;try{const _0x446b04=DateTime['fromSecond'+'s'](_0x30157a)[_0x2a4ec6(0x243)](CONFIG[_0x2a4ec6(0x1c3)]),_0x4e07eb=_0x446b04[_0x2a4ec6(0x25e)](_0x2a4ec6(0x1e9)),_0x1c54dc=await db[_0x2a4ec6(0x29f)](_0x2a4ec6(0x2e1)+_0x2a4ec6(0x1e1)+'id,\x20displa'+_0x2a4ec6(0x262)+_0x2a4ec6(0x200)+_0x2a4ec6(0x2c7)+'cnt,\x20MAX(l'+'ast_update'+'d)\x20AS\x20last'+_0x2a4ec6(0x1ff)+_0x2a4ec6(0x1b6)+_0x2a4ec6(0x296)+_0x2a4ec6(0x234)+_0x2a4ec6(0x299)+_0x2a4ec6(0x29c)+'eframe\x20=\x20\x27'+_0x2a4ec6(0x1cc)+_0x2a4ec6(0x1be)+_0x2a4ec6(0x2d4)+'\x20\x20\x20GROUP\x20B'+_0x2a4ec6(0x1a5)+'\x0a\x20\x20\x20\x20',[_0x4d78f6,_0x4e07eb]),_0x26d923=new Map();for(const _0x1d1c9f of _0x1c54dc||[]){const _0x21baca=normalizeJid(_0x1d1c9f[_0x2a4ec6(0x1b7)]);_0x26d923[_0x2a4ec6(0x266)](_0x21baca,{'user_jid':_0x21baca,'display_name':_0x1d1c9f[_0x2a4ec6(0x27c)+'me']||_0x21baca[_0x2a4ec6(0x21c)]('@')[0x16f9*0x1+-0xb*0x2f5+0x4c7*0x2],'count':Number(_0x1d1c9f[_0x2a4ec6(0x225)]||0xa7*0x25+-0x1b*0xfb+0x2*0x12b),'last_ts':Number(_0x1d1c9f[_0x2a4ec6(0x254)]||-0x1840+0x1507*0x1+0x339)});}const _0x1c3f21=await db[_0x2a4ec6(0x29f)](_0x2a4ec6(0x29e)+_0x2a4ec6(0x2d9)+'eframe,\x20bu'+'cket_key,\x20'+_0x2a4ec6(0x1fc)+_0x2a4ec6(0x213)+_0x2a4ec6(0x1bb)+'OM\x20active_'+_0x2a4ec6(0x1ab)+_0x2a4ec6(0x2a3)+_0x2a4ec6(0x276)+_0x2a4ec6(0x229)+_0x2a4ec6(0x257)+_0x2a4ec6(0x1fa)+_0x2a4ec6(0x270)+')',[_0x4d78f6]);for(const _0x10e0fa of _0x1c3f21||[]){let _0x933473=![];try{if(_0x10e0fa[_0x2a4ec6(0x2df)]===_0x2a4ec6(0x260)){const _0x6ea96a=String(_0x10e0fa[_0x2a4ec6(0x2b8)]||'')[_0x2a4ec6(0x21c)]('-'),_0x4d3a57=Number(_0x6ea96a[-0x2*-0x1cf+-0x2288*-0x1+-0x2*0x1313])||0x2353+0xdf0+-0x2991,_0x59cc82=Number(_0x6ea96a[-0x22ed+-0x1e6+0x24d4])||-0x3f*0x71+0x181c+-0x4*-0xed,_0x511050=DateTime[_0x2a4ec6(0x1f6)]({'weekYear':_0x4d3a57,'weekNumber':_0x59cc82,'weekday':0x1},{'zone':CONFIG[_0x2a4ec6(0x1c3)]});if(_0x511050[_0x2a4ec6(0x2e7)]()>=_0x30157a)_0x933473=!![];}else{if(_0x10e0fa['timeframe']===_0x2a4ec6(0x294)){const _0x382cf7=String(_0x10e0fa['bucket_key']||'')['split']('-'),_0x24cfa0=Number(_0x382cf7[0x181*-0xc+0x1e56+-0xc4a])||0x1b25*0x1+0x26d6*-0x1+0x2c5*0x7,_0x3d12d3=Number(_0x382cf7[-0x1*0x1111+-0x98a+-0x4*-0x6a7])||-0xe35+0x232*0x2+0x4e9*0x2,_0x2f8922=DateTime[_0x2a4ec6(0x1f6)]({'year':_0x24cfa0,'month':_0x3d12d3,'day':0x1},{'zone':CONFIG[_0x2a4ec6(0x1c3)]});if(_0x2f8922[_0x2a4ec6(0x2e7)]()>=_0x30157a)_0x933473=!![];}else{if(_0x10e0fa[_0x2a4ec6(0x2df)]===_0x2a4ec6(0x284)){const _0x2c48d3=Number(String(_0x10e0fa[_0x2a4ec6(0x2b8)]||'')[_0x2a4ec6(0x21c)]('-')[0x18b8+-0x78*0x2b+-0x490])||-0xd1f*0x1+0x1de9+-0x918,_0x1be476=DateTime[_0x2a4ec6(0x1f6)]({'year':_0x2c48d3,'month':0x1,'day':0x1},{'zone':CONFIG['TIME_ZONE']});if(_0x1be476[_0x2a4ec6(0x2e7)]()>=_0x30157a)_0x933473=!![];}else _0x933473=!![];}}}catch(_0x57a858){_0x933473=!![];}if(!_0x933473)continue;const _0xa399b6=normalizeJid(_0x10e0fa['user_jid']);if(!_0x26d923[_0x2a4ec6(0x1f4)](_0xa399b6))_0x26d923['set'](_0xa399b6,{'user_jid':_0xa399b6,'display_name':_0x10e0fa[_0x2a4ec6(0x27c)+'me']||_0xa399b6[_0x2a4ec6(0x21c)]('@')[0x1b96+0x8e6+-0x1d3*0x14],'count':0x0,'last_ts':0x0});_0x26d923[_0x2a4ec6(0x25b)](_0xa399b6)['count']+=Number(_0x10e0fa[_0x2a4ec6(0x1fc)+_0x2a4ec6(0x1ce)]||0x4*0x65b+0x1b81+-0x34ed*0x1);}const _0x431743=Array[_0x2a4ec6(0x292)](_0x26d923['values']())['sort']((_0x302b42,_0x3a3a0b)=>_0x3a3a0b[_0x2a4ec6(0x249)]-_0x302b42[_0x2a4ec6(0x249)]||_0x3a3a0b['last_ts']-_0x302b42[_0x2a4ec6(0x254)]);return _0x431743[_0x2a4ec6(0x2ac)](0x75d+0x448+0x1*-0xba5,_0x2abe3f);}catch(_0x58b04f){return warn(_0x2a4ec6(0x1ad)+'uildLeader'+_0x2a4ec6(0x2d3)+'r:\x20'+(_0x58b04f?.[_0x2a4ec6(0x27b)]||_0x58b04f)),[];}}async function getGroupParticipants(_0x12e314,_0x591c47){const _0x1b15f5=_0x3b529c;try{if(!_0x12e314||typeof _0x12e314['groupMetad'+_0x1b15f5(0x202)]!==_0x1b15f5(0x28f))return[];const _0x195829=await _0x12e314[_0x1b15f5(0x20f)+_0x1b15f5(0x202)](_0x591c47),_0x3bc3a8=Array[_0x1b15f5(0x240)](_0x195829?.[_0x1b15f5(0x22d)+'ts'])?_0x195829['participan'+'ts']:Object[_0x1b15f5(0x2dd)](_0x195829?.[_0x1b15f5(0x22d)+'ts']||{}),_0x422c15=_0x3bc3a8[_0x1b15f5(0x223)](_0x46e00a=>_0x46e00a['id'])[_0x1b15f5(0x1a3)](Boolean)['map'](normalizeJid);return _0x422c15;}catch(_0x58f1df){return warn(_0x1b15f5(0x2e5)+'etGroupPar'+_0x1b15f5(0x273)+_0x1b15f5(0x1dc)+'\x20'+_0x591c47+':\x20'+(_0x58f1df?.[_0x1b15f5(0x27b)]||_0x58f1df)),[];}}export async function initialize(_0x5b0f1a){const _0x2c255b=_0x3b529c;try{botRef=_0x5b0f1a;if(botRef){if(typeof botRef[_0x2c255b(0x297)+'e']==='function')sendApi=(_0x5bd17a,_0x3c1d3e)=>botRef[_0x2c255b(0x297)+'e'](_0x5bd17a,_0x3c1d3e);else{if(botRef[_0x2c255b(0x1de)]&&typeof botRef[_0x2c255b(0x1de)]['sendMessag'+'e']===_0x2c255b(0x28f))sendApi=(_0x49ac73,_0x488011)=>botRef[_0x2c255b(0x1de)]['sendMessag'+'e'](_0x49ac73,_0x488011);else sendApi=null;}}try{const _0x557757=getConfig()||{};if(_0x557757[_0x2c255b(0x1d1)]&&typeof _0x557757[_0x2c255b(0x1d1)]==='object')CONFIG={...CONFIG,..._0x557757[_0x2c255b(0x1d1)]};}catch(_0x11d038){warn(_0x2c255b(0x2c0)+_0x2c255b(0x2b4)+_0x2c255b(0x21f)+_0x2c255b(0x253)+(_0x11d038?.[_0x2c255b(0x27b)]||_0x11d038));}await ensureSchema(),await performRollups(),info(_0x2c255b(0x1a9)+_0x2c255b(0x247));}catch(_0x174621){error(_0x174621,'[active]\x20i'+'nitialize\x20'+_0x2c255b(0x209)+(_0x174621?.[_0x2c255b(0x27b)]||_0x174621));throw _0x174621;}}export async function onMessage(_0x508c43){const _0x28608f=_0x3b529c;try{await trackMessage(_0x508c43);if(!_0x508c43?.[_0x28608f(0x245)])return;const _0x2fded1=_0x508c43['key']?.[_0x28608f(0x1cd)];if(!_0x2fded1||!_0x2fded1[_0x28608f(0x2db)]('@g.us'))return;const _0x328780=await isadmin(botRef,_0x508c43)[_0x28608f(0x1a7)](()=>![]);if(!_0x328780)return;const _0xfe7195=typeof _0x508c43[_0x28608f(0x1c7)]===_0x28608f(0x24a)&&_0x508c43[_0x28608f(0x1c7)][_0x28608f(0x1e4)]()?_0x508c43['text'][_0x28608f(0x1e4)]():'';if(!_0xfe7195)return;const _0x197a28=_0xfe7195[_0x28608f(0x21c)](/\s+/)['filter'](Boolean),_0x40615b=_0x197a28[-0x16*-0xf5+-0x2623*-0x1+-0x1*0x3b31][_0x28608f(0x295)+'e']();if(_0x40615b!==_0x28608f(0x21a)&&_0x40615b!==_0x28608f(0x22e))return;const _0x2f4715=_0x197a28[-0x1bc7+-0xd8+-0x728*-0x4]||'1w';let _0x15bee4=parsePeriodArg(_0x2f4715);if(!_0x15bee4){const _0x4e7233=parseInt(_0x2f4715,-0x2280+0x119d+0x7*0x26b);if(!isNaN(_0x4e7233))_0x15bee4={'amount':_0x4e7233,'unit':'d'};else{const _0x202bdd=_0x28608f(0x22c)+_0x28608f(0x1c5)+_0x28608f(0x290)+_0x28608f(0x2d5)+_0x28608f(0x27f)+_0x28608f(0x26e)+_0x28608f(0x2c9)+_0x28608f(0x29a)+_0x28608f(0x2cf)+'e\x201w,\x20inac'+_0x28608f(0x274);try{await sendApi(_0x2fded1,{'text':_0x202bdd});}catch(_0x18d711){warn('[active]\x20s'+_0x28608f(0x1d6)+_0x28608f(0x209)+(_0x18d711?.[_0x28608f(0x27b)]||_0x18d711));}return;}}try{await performRollups();}catch(_0x3df86d){}const _0x11245b=computeCutoffSeconds(_0x15bee4[_0x28608f(0x2c1)],_0x15bee4[_0x28608f(0x1a8)]);if(_0x40615b==='active'){const _0x4fae0c=await buildLeaderboardForChat(_0x2fded1,_0x11245b,CONFIG[_0x28608f(0x2bf)+'T_RETURN']);if(!_0x4fae0c||_0x4fae0c[_0x28608f(0x1f5)]===0xd02+-0xdc1+0xbf){await sendApi(_0x2fded1,{'text':_0x28608f(0x265)+_0x28608f(0x20d)+_0x28608f(0x1f2)+_0x28608f(0x1e3)+_0x15bee4[_0x28608f(0x2c1)]+_0x15bee4[_0x28608f(0x1a8)]+'.'});return;}let _0x1b2e60=_0x28608f(0x1e6)+_0x4fae0c[_0x28608f(0x1f5)]+('\x20active\x20us'+_0x28608f(0x281)+_0x28608f(0x1e3))+_0x15bee4[_0x28608f(0x2c1)]+_0x15bee4[_0x28608f(0x1a8)]+':\x0a\x0a';const _0xc855c7=[];let _0x212529=0x7dc*-0x1+0x1c62+0x4a*-0x47;for(const _0x5596f8 of _0x4fae0c){_0x212529++;const _0x418a7f=_0x5596f8['user_jid'][_0x28608f(0x21c)]('@')[-0x65*-0x4+0x152a+-0x16be];_0x1b2e60+=_0x28608f(0x2c8)+_0x418a7f+'\x20('+(_0x5596f8[_0x28608f(0x27c)+'me']||_0x418a7f)+')\x0a',_0x1b2e60+=romanParen(_0x212529)+'\x20'+_0x5596f8[_0x28608f(0x249)]+(_0x28608f(0x1da)+'\x0a'),_0xc855c7[_0x28608f(0x277)](_0x5596f8[_0x28608f(0x1b7)]);}const _0x379ded=0x4cb*0x4+-0x14cc+-0x20*-0x8a;if(_0x1b2e60[_0x28608f(0x1f5)]<=_0x379ded)await sendApi(_0x2fded1,{'text':_0x1b2e60,'mentions':_0xc855c7});else{const _0x50e4d8=_0x1b2e60[_0x28608f(0x21c)]('\x0a\x0a');let _0x4c8f88='';for(const _0x210608 of _0x50e4d8){if((_0x4c8f88+'\x0a\x0a'+_0x210608)[_0x28608f(0x1f5)]>_0x379ded)await sendApi(_0x2fded1,{'text':_0x4c8f88,'mentions':_0xc855c7}),_0x4c8f88=_0x210608+'\x0a\x0a';else _0x4c8f88+=(_0x4c8f88?'\x0a\x0a':'')+_0x210608;}if(_0x4c8f88[_0x28608f(0x1e4)]())await sendApi(_0x2fded1,{'text':_0x4c8f88,'mentions':_0xc855c7});}return;}if(_0x40615b===_0x28608f(0x22e)){const _0x31093e=botRef?.[_0x28608f(0x1de)]||botRef,_0x1d21d5=await getGroupParticipants(_0x31093e,_0x2fded1);if(!_0x1d21d5||_0x1d21d5[_0x28608f(0x1f5)]===0x1645+-0x1*-0x2245+-0x388a){await sendApi(_0x2fded1,{'text':_0x28608f(0x2a7)+_0x28608f(0x23b)+_0x28608f(0x1f1)+'icipants.'});return;}const _0x119c40=await buildLeaderboardForChat(_0x2fded1,_0x11245b,0x120d7f*-0x1+0x16191e+0xb36a1),_0x1dd376=new Set((_0x119c40||[])[_0x28608f(0x223)](_0x466453=>normalizeJid(_0x466453[_0x28608f(0x1b7)]))),_0x10b1cb=_0x1d21d5['filter'](_0x261766=>!_0x1dd376[_0x28608f(0x1f4)](normalizeJid(_0x261766)));if(!_0x10b1cb[_0x28608f(0x1f5)]){await sendApi(_0x2fded1,{'text':_0x28608f(0x204)+_0x28608f(0x1e5)+'found\x20in\x20t'+'he\x20last\x20'+_0x15bee4[_0x28608f(0x2c1)]+_0x15bee4['unit']+'.'});return;}let _0x212ba5='Found\x20'+_0x10b1cb['length']+('\x20inactive\x20'+_0x28608f(0x208)+_0x28608f(0x1f9))+_0x15bee4[_0x28608f(0x2c1)]+_0x15bee4[_0x28608f(0x1a8)]+_0x28608f(0x1a6);const _0x3a9681=[];let _0x1451f4=0x100a+0x336*0x1+-0x1340*0x1;for(const _0x55b6ee of _0x10b1cb){_0x1451f4++;const _0x2dce75=_0x55b6ee[_0x28608f(0x21c)]('@')[0x10*-0x86+-0xa*0x2b7+0x2386];_0x212ba5+=_0x28608f(0x2c8)+_0x2dce75+'\x20('+_0x2dce75+')\x0a',_0x212ba5+=romanParen(_0x1451f4)+(_0x28608f(0x21d)+'es\x0a\x0a'),_0x3a9681[_0x28608f(0x277)](_0x55b6ee);}await sendApi(_0x2fded1,{'text':_0x212ba5,'mentions':_0x3a9681});return;}}catch(_0x5aaaab){error(_0x5aaaab,_0x28608f(0x1ea)+_0x28608f(0x2ab)+_0x28608f(0x22b)+(_0x5aaaab?.[_0x28608f(0x27b)]||_0x5aaaab));}}export async function cleanup(){const _0x2cfe96=_0x3b529c;try{for(const _0x1c447a of processedMessageKeys[_0x2cfe96(0x2dd)]())try{clearTimeout(_0x1c447a);}catch(_0x5793ae){}processedMessageKeys['clear']();}catch(_0x4b69cf){}botRef=null,sendApi=null,info('[active]\x20c'+_0x2cfe96(0x29d));}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};