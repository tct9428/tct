const _0x571d29=_0x2144;(function(_0x1dcd27,_0x31f245){const _0xb0c470=_0x2144,_0x1ded88=_0x1dcd27();while(!![]){try{const _0x11be61=-parseInt(_0xb0c470(0x1a5))/(-0x2af*-0x3+0x862+-0x106e)+-parseInt(_0xb0c470(0xea))/(-0x17*0xd6+-0xc52+0x241*0xe)+parseInt(_0xb0c470(0x16b))/(0x23da+-0xc*0x23d+-0x8fb*0x1)+parseInt(_0xb0c470(0x1f2))/(0x1ccd+-0xbb*-0x19+0xbc3*-0x4)*(parseInt(_0xb0c470(0x131))/(-0x12dc+0x5*0x39d+0x4*0x34))+-parseInt(_0xb0c470(0xd5))/(0x9*0x3b2+0x2312+0x2*-0x2227)+-parseInt(_0xb0c470(0x1f0))/(0x2156*0x1+-0x190d+-0x842)*(parseInt(_0xb0c470(0x16f))/(0x1878+0x11b1+-0x2a21))+parseInt(_0xb0c470(0xf6))/(0x90*-0xa+-0xd57+-0x1*-0x1300);if(_0x11be61===_0x31f245)break;else _0x1ded88['push'](_0x1ded88['shift']());}catch(_0x88fdc3){_0x1ded88['push'](_0x1ded88['shift']());}}}(_0x125e,0x33*-0x48d+-0x6371e+0x106673));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x571d29(0x1d9);export const version=_0x571d29(0xa8);export const priority=-0x8de+0x1b5+-0x281*-0x3;export const commands=['active',_0x571d29(0x16c)];let botRef=null,sendApi=null;function _0x2144(_0x500940,_0x454333){const _0x23b5e2=_0x125e();return _0x2144=function(_0x8df20a,_0x24de47){_0x8df20a=_0x8df20a-(0x240e+0x21ec+-0x1*0x4559);let _0x31c5f1=_0x23b5e2[_0x8df20a];return _0x31c5f1;},_0x2144(_0x500940,_0x454333);}const DEFAULTS={'TIME_ZONE':_0x571d29(0x18f),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(-0x1105+-0x1061+0x2184)*(0x1563+0x74b+-0x18c6)};let CONFIG={...DEFAULTS};function normalizeJid(_0x24387c){const _0x37e2a2=_0x571d29;return _0x24387c?String(_0x24387c)[_0x37e2a2(0x1b8)]():'';}function sleep(_0x4789df){return new Promise(_0x24e38b=>setTimeout(_0x24e38b,_0x4789df));}function toLowerRoman(_0x75f1c6){const _0x48e306=_0x571d29,_0x48afae=[[0x2*0x88f+-0xe8e+0x158,'M'],[0x1ac6+-0x597+0x1*-0x11ab,'CM'],[0x1d*-0x12e+-0x8*0x367+0x3f62,'D'],[-0x1990+0x1*-0x1ea+0x1d0a,'CD'],[-0xef2+-0x1*0x1c4+-0xc7*-0x16,'C'],[-0x1*0x1af2+-0x18ea*-0x1+0x262,'XC'],[-0x552+0x76*0xa+0x74*0x2,'L'],[0x1*0x25f6+-0x57a+-0x2054,'XL'],[0x13c*0xb+-0x1*0x7c+0x3*-0x45a,'X'],[0x1*-0x186c+0x1*-0x1001+0x2876,'IX'],[0x9d4+-0xf14+0x545,'V'],[0x1*0x40d+-0x390+0x1*-0x79,'IV'],[0x1e24+-0xb6*-0x13+-0x2ba5,'I']];let _0x8ecbd7=_0x75f1c6,_0x1570de='';for(const [_0x2030fc,_0x684ded]of _0x48afae)while(_0x8ecbd7>=_0x2030fc){_0x1570de+=_0x684ded,_0x8ecbd7-=_0x2030fc;}return _0x1570de[_0x48e306(0xcd)+'e']();}function romanParen(_0x3369d8){return'('+toLowerRoman(_0x3369d8)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x4e1bd7){const _0x49b444=_0x571d29,_0x5af769=_0x4e1bd7?.[_0x49b444(0x10d)];if(!_0x5af769)return null;const _0x972448=_0x5af769['id']||_0x5af769[_0x49b444(0x126)+'t']||'',_0x2e8839=_0x5af769[_0x49b444(0x12d)]||'';return _0x2e8839+'::'+_0x972448;}function isMsgProcessed(_0x4f043c){const _0x325a34=_0x571d29;return _0x4f043c&&processedMessageKeys[_0x325a34(0x1b0)](_0x4f043c);}function markMsgProcessed(_0x278ecc){const _0x47c4f0=_0x571d29;if(!_0x278ecc)return;if(processedMessageKeys[_0x47c4f0(0x1b0)](_0x278ecc))clearTimeout(processedMessageKeys[_0x47c4f0(0x17c)](_0x278ecc));const _0x249ae3=setTimeout(()=>processedMessageKeys[_0x47c4f0(0xcb)](_0x278ecc),CONFIG[_0x47c4f0(0x15b)+_0x47c4f0(0xff)]);processedMessageKeys[_0x47c4f0(0x1e8)](_0x278ecc,_0x249ae3);}async function ensureSchema(){const _0x118d5d=_0x571d29;try{await db[_0x118d5d(0x10f)](_0x118d5d(0xe7)+_0x118d5d(0x12a)+_0x118d5d(0xd9)+'ive_migrat'+_0x118d5d(0x197)+_0x118d5d(0x19c)+'R\x20PRIMARY\x20'+_0x118d5d(0x1e1)+_0x118d5d(0x1ac)+_0x118d5d(0x1ad)+_0x118d5d(0xc4)+'me(\x27%s\x27,\x27n'+_0x118d5d(0x1b5)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x118d5d(0x122)+_0x118d5d(0x186)+_0x118d5d(0x1b7)+_0x118d5d(0x1ca)+'\x20\x20\x20\x20\x20\x20\x20id\x20'+'INTEGER\x20PR'+'IMARY\x20KEY\x20'+'AUTOINCREM'+'ENT,\x0a\x20\x20\x20\x20\x20'+_0x118d5d(0x152)+_0x118d5d(0xc1)+'\x20NULL,\x0a\x20\x20\x20'+'\x20\x20\x20\x20\x20user_'+_0x118d5d(0x183)+_0x118d5d(0x19a)+_0x118d5d(0xa2)+_0x118d5d(0x1e6)+_0x118d5d(0x146)+_0x118d5d(0x1e3)+_0x118d5d(0xb8)+_0x118d5d(0x134)+_0x118d5d(0x189)+_0x118d5d(0xe2)+'\x20\x20\x20\x20\x20\x20buck'+_0x118d5d(0xab)+_0x118d5d(0x146)+_0x118d5d(0x114)+_0x118d5d(0x1f8)+_0x118d5d(0xbc)+_0x118d5d(0xa5)+_0x118d5d(0x1c9)+'hly:\x20YYYY-'+'MM,\x20yearly'+_0x118d5d(0x178)+_0x118d5d(0x15f)+_0x118d5d(0x137)+_0x118d5d(0x14b)+'AULT\x200,\x0a\x20\x20'+_0x118d5d(0x107)+_0x118d5d(0xe6)+'EXT\x20DEFAUL'+'T\x20\x27\x27,\x0a\x20\x20\x20\x20'+_0x118d5d(0x18c)+_0x118d5d(0x1ea)+_0x118d5d(0x1ad)+_0x118d5d(0xc4)+'me(\x27%s\x27,\x27n'+'ow\x27)),\x0a\x20\x20\x20'+_0x118d5d(0xbe)+'E(chat_jid'+_0x118d5d(0x1da)+_0x118d5d(0x153)+_0x118d5d(0x130)+_0x118d5d(0xee)+_0x118d5d(0x11d)),await db[_0x118d5d(0x10f)]('CREATE\x20IND'+_0x118d5d(0x1bf)+_0x118d5d(0x160)+_0x118d5d(0x182)+_0x118d5d(0x166)+_0x118d5d(0x151)+'e_stats(ch'+_0x118d5d(0xd3)+_0x118d5d(0xde)+_0x118d5d(0x1d2)+';'),await db[_0x118d5d(0x10f)](_0x118d5d(0xac)+_0x118d5d(0x1bf)+'EXISTS\x20idx'+_0x118d5d(0x182)+'ats_chat_u'+'ser\x20ON\x20act'+_0x118d5d(0xc0)+'chat_jid,\x20'+'user_jid);'),await db[_0x118d5d(0x10f)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x118d5d(0x122)+_0x118d5d(0x186)+'STS\x20active'+_0x118d5d(0x172)+_0x118d5d(0x194)+_0x118d5d(0x10b)+_0x118d5d(0xdd)+'\x20TEXT\x20PRIM'+_0x118d5d(0x139)+_0x118d5d(0x1e7)+_0x118d5d(0x1f5)+_0x118d5d(0x1f7)+_0x118d5d(0x158)),info(_0x118d5d(0x196)+_0x118d5d(0xb0)+_0x118d5d(0x11a));}catch(_0x5e65f9){error(_0x5e65f9,_0x118d5d(0x104)+_0x118d5d(0x193)+_0x118d5d(0xc2));throw _0x5e65f9;}}export async function trackMessage(_0x4b4b46){const _0x5ddd79=_0x571d29;try{if(!_0x4b4b46||!_0x4b4b46[_0x5ddd79(0x10d)]||!_0x4b4b46[_0x5ddd79(0x15e)])return;const _0x3b5ef3=makeDedupeKey(_0x4b4b46);if(!_0x3b5ef3)return;if(isMsgProcessed(_0x3b5ef3))return;markMsgProcessed(_0x3b5ef3);if(_0x4b4b46['key'][_0x5ddd79(0xb4)])return;const _0x2f38ea=_0x4b4b46[_0x5ddd79(0x10d)][_0x5ddd79(0x12d)];if(!_0x2f38ea||!_0x2f38ea[_0x5ddd79(0x1dd)](_0x5ddd79(0x1c0)))return;const _0x546d7d=_0x4b4b46['key']['participan'+'t']||_0x4b4b46['key'][_0x5ddd79(0x14c)]||'';if(!_0x546d7d)return;const _0x21c944=normalizeJid(_0x546d7d),_0x1c443a=DateTime['now']()[_0x5ddd79(0xcf)](CONFIG['TIME_ZONE']),_0x5d749a=_0x1c443a['toFormat'](_0x5ddd79(0x147));try{const _0x5d207a=await db[_0x5ddd79(0x18b)](_0x5ddd79(0xc3)+_0x5ddd79(0x1e0)+_0x5ddd79(0x17f)+'\x20\x20\x20\x20\x20\x20\x20SET'+'\x20message_c'+_0x5ddd79(0x150)+'sage_count'+_0x5ddd79(0x115)+_0x5ddd79(0xfa)+_0x5ddd79(0xb2)+_0x5ddd79(0xda)+_0x5ddd79(0xf9)+_0x5ddd79(0x154)+_0x5ddd79(0xe1)+_0x5ddd79(0xb3)+_0x5ddd79(0x141)+_0x5ddd79(0x100)+_0x5ddd79(0x1a2)+_0x5ddd79(0xf7)+_0x5ddd79(0x1e5)+_0x5ddd79(0x1aa),[_0x4b4b46[_0x5ddd79(0x199)]||_0x4b4b46['senderName']||'',Math[_0x5ddd79(0xf2)](_0x1c443a[_0x5ddd79(0x101)]()),_0x2f38ea,_0x21c944,_0x5d749a]);(!_0x5d207a||!_0x5d207a[_0x5ddd79(0x17b)])&&await db[_0x5ddd79(0x18b)](_0x5ddd79(0xaa)+_0x5ddd79(0x108)+_0x5ddd79(0xec)+_0x5ddd79(0xe8)+_0x5ddd79(0xed)+_0x5ddd79(0x145)+_0x5ddd79(0x171)+_0x5ddd79(0x198)+_0x5ddd79(0x1bb)+_0x5ddd79(0xf0)+_0x5ddd79(0x140)+_0x5ddd79(0x1cd)+_0x5ddd79(0x10e)+_0x5ddd79(0xa1)+_0x5ddd79(0x144)+_0x5ddd79(0xf1)+_0x5ddd79(0x1ee)+_0x5ddd79(0x181),[_0x2f38ea,_0x21c944,_0x5d749a,_0x4b4b46[_0x5ddd79(0x199)]||_0x4b4b46[_0x5ddd79(0x1eb)]||'',Math['floor'](_0x1c443a[_0x5ddd79(0x101)]())]);}catch(_0x5b2faf){warn('[active]\x20t'+_0x5ddd79(0x123)+_0x5ddd79(0xb6)+':\x20'+(_0x5b2faf?.['message']||_0x5b2faf));}}catch(_0x49380c){warn(_0x5ddd79(0x179)+_0x5ddd79(0x123)+'e\x20unexpect'+_0x5ddd79(0x1a4)+(_0x49380c?.[_0x5ddd79(0x15e)]||_0x49380c));}}async function performRollups(){const _0x502fb4=_0x571d29;try{const _0x36799f=DateTime['now']()[_0x502fb4(0xcf)](CONFIG[_0x502fb4(0x1bc)]),_0x3dd31e=_0x36799f['minus']({'days':CONFIG[_0x502fb4(0x11c)+_0x502fb4(0x125)+'S']})['startOf'](_0x502fb4(0x121)),_0x562e7c=_0x3dd31e[_0x502fb4(0x13e)]('yyyy-LL-dd'),_0x1e4d01=await db['all'](_0x502fb4(0x1c3)+_0x502fb4(0x10a)+_0x502fb4(0x135)+_0x502fb4(0x167)+'y,\x20message'+_0x502fb4(0x1e4)+_0x502fb4(0x177)+_0x502fb4(0x173)+_0x502fb4(0x12c)+_0x502fb4(0x1d3)+_0x502fb4(0x1d4)+_0x502fb4(0x1c1)+_0x502fb4(0xc9)+_0x502fb4(0x159),[_0x562e7c]);if(_0x1e4d01&&_0x1e4d01[_0x502fb4(0x1f6)]){const _0x5bce69=new Map();for(const _0x301f88 of _0x1e4d01){const _0x2fe8f9=DateTime[_0x502fb4(0x168)](_0x301f88['bucket_key'],'yyyy-LL-dd',{'zone':CONFIG[_0x502fb4(0x1bc)]}),_0x434ae9=_0x2fe8f9[_0x502fb4(0x1b3)]+'-'+String(_0x2fe8f9[_0x502fb4(0x1c7)])[_0x502fb4(0x1e2)](-0x901+0x60b*0x1+0x2f8,'0'),_0xd9082e=_0x301f88[_0x502fb4(0xca)]+'||'+_0x301f88[_0x502fb4(0x1d5)]+_0x502fb4(0x1b9)+_0x434ae9;if(!_0x5bce69[_0x502fb4(0x1b0)](_0xd9082e))_0x5bce69[_0x502fb4(0x1e8)](_0xd9082e,{'chat_jid':_0x301f88['chat_jid'],'user_jid':_0x301f88[_0x502fb4(0x1d5)],'timeframe':'weekly','bucket_key':_0x434ae9,'message_count':0x0,'display_name':_0x301f88[_0x502fb4(0x13d)+'me']||''});const _0x272136=_0x5bce69[_0x502fb4(0x17c)](_0xd9082e);_0x272136[_0x502fb4(0x1bb)+_0x502fb4(0xbf)]+=Number(_0x301f88[_0x502fb4(0x1bb)+_0x502fb4(0xbf)]||0x24f2+0x19e8+-0x3eda);}for(const _0x5b2fa4 of _0x5bce69['values']()){const _0x3b0209=await db['get']('SELECT\x20id\x20'+_0x502fb4(0x1c5)+_0x502fb4(0x1ba)+_0x502fb4(0x163)+_0x502fb4(0x1c2)+_0x502fb4(0x162)+_0x502fb4(0x18a)+'meframe\x20=\x20'+'\x27weekly\x27\x20A'+_0x502fb4(0xf7)+'key\x20=\x20?\x20LI'+_0x502fb4(0x103),[_0x5b2fa4[_0x502fb4(0xca)],_0x5b2fa4[_0x502fb4(0x1d5)],_0x5b2fa4[_0x502fb4(0x15c)]]);!_0x3b0209?await db['run'](_0x502fb4(0x1df)+_0x502fb4(0x102)+_0x502fb4(0xdc)+_0x502fb4(0xe3)+_0x502fb4(0xf3)+'frame,\x20buc'+'ket_key,\x20m'+'essage_cou'+_0x502fb4(0x1bd)+_0x502fb4(0x14a)+_0x502fb4(0x1d6)+_0x502fb4(0xd6)+_0x502fb4(0xba)+_0x502fb4(0x1e9)+_0x502fb4(0xc7),[_0x5b2fa4[_0x502fb4(0xca)],_0x5b2fa4[_0x502fb4(0x1d5)],_0x5b2fa4[_0x502fb4(0x15c)],_0x5b2fa4[_0x502fb4(0x1bb)+_0x502fb4(0xbf)],_0x5b2fa4[_0x502fb4(0x13d)+'me']||'',Math['floor'](_0x36799f['toSeconds']())]):await db[_0x502fb4(0x18b)]('UPDATE\x20act'+_0x502fb4(0xbd)+_0x502fb4(0x142)+_0x502fb4(0x1b2)+_0x502fb4(0x1bb)+_0x502fb4(0xd8)+_0x502fb4(0xfd)+_0x502fb4(0x124)+_0x502fb4(0x12f)+_0x502fb4(0x1a7)+_0x502fb4(0x13b),[_0x5b2fa4[_0x502fb4(0x1bb)+_0x502fb4(0xbf)],_0x5b2fa4[_0x502fb4(0x13d)+'me']||'',Math[_0x502fb4(0xf2)](_0x36799f[_0x502fb4(0x101)]()),_0x3b0209['id']]);}try{const _0x2f5fe9=_0x1e4d01[_0x502fb4(0x136)](_0x47f42e=>_0x47f42e['id']);for(let _0x242a7f=0x207b*0x1+-0x34*0x5b+0xdff*-0x1;_0x242a7f<_0x2f5fe9[_0x502fb4(0x1f6)];_0x242a7f+=-0x814+-0x163e+0x2046){const _0xf0249a=_0x2f5fe9[_0x502fb4(0xe0)](_0x242a7f,_0x242a7f+(0x1ba1+-0x1925+-0x4*0x22)),_0x5ec6c8=_0x502fb4(0xdf)+_0x502fb4(0x175)+_0x502fb4(0x16d)+_0x502fb4(0x191)+_0xf0249a[_0x502fb4(0x136)](()=>'?')[_0x502fb4(0x155)](',')+')';await db[_0x502fb4(0x18b)](_0x5ec6c8,_0xf0249a);}}catch(_0x2be1e1){warn(_0x502fb4(0xd0)+_0x502fb4(0xd2)+'daily\x20rows'+'\x20failed:\x20'+(_0x2be1e1?.[_0x502fb4(0x15e)]||_0x2be1e1));}}const _0x61c6c1=_0x36799f[_0x502fb4(0xc5)]({'days':CONFIG['ROLLOVER_T'+_0x502fb4(0x15a)+'YS']})['toSeconds'](),_0x473e18=await db[_0x502fb4(0x149)]('SELECT\x20id,'+_0x502fb4(0x10a)+_0x502fb4(0x135)+_0x502fb4(0x167)+_0x502fb4(0x1d7)+_0x502fb4(0x1e4)+'splay_name'+_0x502fb4(0x173)+_0x502fb4(0x12c)+_0x502fb4(0x1d3)+_0x502fb4(0xdb)+_0x502fb4(0xfb));if(_0x473e18&&_0x473e18[_0x502fb4(0x1f6)]){const _0xd48505=new Map();for(const _0x16da25 of _0x473e18){const _0x2b88aa=String(_0x16da25[_0x502fb4(0x15c)]||'')[_0x502fb4(0x1a9)]('-'),_0x6eeb68=Number(_0x2b88aa[-0x18be+-0x1*-0x18ef+-0x7*0x7])||-0x2095+-0x1*-0x1e57+0x9f0,_0x2e8c99=Number(_0x2b88aa[-0x1738+-0x2515+0x3c4e])||-0x106a+-0xb69+0x1a*0x112,_0x3018a4=DateTime[_0x502fb4(0x19d)]({'weekYear':_0x6eeb68,'weekNumber':_0x2e8c99,'weekday':0x1},{'zone':CONFIG[_0x502fb4(0x1bc)]});if(_0x3018a4[_0x502fb4(0x101)]()>_0x61c6c1)continue;const _0x17fea5=_0x3018a4[_0x502fb4(0x170)]+'-'+String(_0x3018a4[_0x502fb4(0xd1)])[_0x502fb4(0x1e2)](0xa27+-0x1208+0x7e3,'0'),_0x9773a7=_0x16da25[_0x502fb4(0xca)]+'||'+_0x16da25['user_jid']+(_0x502fb4(0xaf)+'|')+_0x17fea5;if(!_0xd48505[_0x502fb4(0x1b0)](_0x9773a7))_0xd48505[_0x502fb4(0x1e8)](_0x9773a7,{'chat_jid':_0x16da25['chat_jid'],'user_jid':_0x16da25['user_jid'],'timeframe':'monthly','bucket_key':_0x17fea5,'message_count':0x0,'display_name':_0x16da25[_0x502fb4(0x13d)+'me']||'','sourceIds':[]});const _0x480b6c=_0xd48505['get'](_0x9773a7);_0x480b6c[_0x502fb4(0x1bb)+_0x502fb4(0xbf)]+=Number(_0x16da25[_0x502fb4(0x1bb)+_0x502fb4(0xbf)]||-0x4ff+0x1b1+0x34e),_0x480b6c[_0x502fb4(0x1ec)]['push'](_0x16da25['id']);}for(const _0x318db1 of _0xd48505[_0x502fb4(0x1f3)]()){const _0xe61952=await db[_0x502fb4(0x17c)]('SELECT\x20id\x20'+_0x502fb4(0x1c5)+_0x502fb4(0x1ba)+_0x502fb4(0x163)+_0x502fb4(0x1c2)+_0x502fb4(0x162)+_0x502fb4(0x18a)+_0x502fb4(0x120)+_0x502fb4(0x1c8)+_0x502fb4(0x1b4)+_0x502fb4(0x18e)+_0x502fb4(0x157),[_0x318db1[_0x502fb4(0xca)],_0x318db1[_0x502fb4(0x1d5)],_0x318db1[_0x502fb4(0x15c)]]);!_0xe61952?await db[_0x502fb4(0x18b)](_0x502fb4(0x1df)+'O\x20active_s'+_0x502fb4(0xdc)+_0x502fb4(0xe3)+_0x502fb4(0xf3)+'frame,\x20buc'+_0x502fb4(0x1db)+_0x502fb4(0x109)+_0x502fb4(0x1bd)+'y_name,\x20la'+_0x502fb4(0x1d6)+_0x502fb4(0xd6)+_0x502fb4(0x10c)+_0x502fb4(0x119)+'?,\x20?,\x20?)',[_0x318db1[_0x502fb4(0xca)],_0x318db1[_0x502fb4(0x1d5)],_0x318db1[_0x502fb4(0x15c)],_0x318db1[_0x502fb4(0x1bb)+_0x502fb4(0xbf)],_0x318db1[_0x502fb4(0x13d)+'me']||'',Math[_0x502fb4(0xf2)](_0x36799f[_0x502fb4(0x101)]())]):await db[_0x502fb4(0x18b)](_0x502fb4(0xb9)+_0x502fb4(0xbd)+_0x502fb4(0x142)+_0x502fb4(0x1b2)+'message_co'+'unt\x20+\x20?,\x20d'+_0x502fb4(0xfd)+'e\x20=\x20?,\x20las'+_0x502fb4(0x12f)+_0x502fb4(0x1a7)+_0x502fb4(0x13b),[_0x318db1[_0x502fb4(0x1bb)+_0x502fb4(0xbf)],_0x318db1[_0x502fb4(0x13d)+'me']||'',Math[_0x502fb4(0xf2)](_0x36799f[_0x502fb4(0x101)]()),_0xe61952['id']]);if(Array[_0x502fb4(0x129)](_0x318db1[_0x502fb4(0x1ec)])&&_0x318db1['sourceIds']['length'])for(let _0x378701=-0x93+0x12*-0xbd+0xddd;_0x378701<_0x318db1[_0x502fb4(0x1ec)][_0x502fb4(0x1f6)];_0x378701+=0x65f+0x246e+-0x28d9){const _0x592b4d=_0x318db1[_0x502fb4(0x1ec)][_0x502fb4(0xe0)](_0x378701,_0x378701+(-0x1316+-0x25f1+-0x13a9*-0x3)),_0x48af68=_0x502fb4(0xdf)+_0x502fb4(0x175)+'tats\x20WHERE'+_0x502fb4(0x191)+_0x592b4d[_0x502fb4(0x136)](()=>'?')['join'](',')+')';await db[_0x502fb4(0x18b)](_0x48af68,_0x592b4d);}}}const _0x2af7c4=_0x36799f['minus']({'days':CONFIG[_0x502fb4(0x11c)+_0x502fb4(0x1d8)+'S']})[_0x502fb4(0x101)](),_0x521ada=await db[_0x502fb4(0x149)](_0x502fb4(0x1c3)+'\x20chat_jid,'+_0x502fb4(0x135)+'\x20bucket_ke'+_0x502fb4(0x1d7)+'_count,\x20di'+_0x502fb4(0x177)+'\x20FROM\x20acti'+_0x502fb4(0x12c)+_0x502fb4(0x1d3)+_0x502fb4(0xe5)+_0x502fb4(0x12b));if(_0x521ada&&_0x521ada['length']){const _0x4c210c=new Map();for(const _0x19da9d of _0x521ada){const _0x486f06=String(_0x19da9d[_0x502fb4(0x15c)]||'')[_0x502fb4(0x1a9)]('-'),_0x3fc0f0=Number(_0x486f06[-0xb5*0xd+0xce3+0x56*-0xb])||0x94d+-0x1*0x2659+0x24be,_0x2795b7=DateTime['fromObject']({'year':_0x3fc0f0,'month':0x1,'day':0x1},{'zone':CONFIG[_0x502fb4(0x1bc)]});if(_0x2795b7['toSeconds']()>_0x2af7c4)continue;const _0x42e868=''+_0x3fc0f0,_0x190f2e=_0x19da9d[_0x502fb4(0xca)]+'||'+_0x19da9d[_0x502fb4(0x1d5)]+_0x502fb4(0x1f1)+_0x42e868;if(!_0x4c210c[_0x502fb4(0x1b0)](_0x190f2e))_0x4c210c[_0x502fb4(0x1e8)](_0x190f2e,{'chat_jid':_0x19da9d[_0x502fb4(0xca)],'user_jid':_0x19da9d[_0x502fb4(0x1d5)],'timeframe':'yearly','bucket_key':_0x42e868,'message_count':0x0,'display_name':_0x19da9d[_0x502fb4(0x13d)+'me']||'','sourceIds':[]});const _0x2f2f35=_0x4c210c[_0x502fb4(0x17c)](_0x190f2e);_0x2f2f35[_0x502fb4(0x1bb)+_0x502fb4(0xbf)]+=Number(_0x19da9d['message_co'+_0x502fb4(0xbf)]||-0x253a+-0x5f8*0x5+0x11*0x3f2),_0x2f2f35[_0x502fb4(0x1ec)][_0x502fb4(0x1cb)](_0x19da9d['id']);}for(const _0x5db213 of _0x4c210c['values']()){const _0x4d21fc=await db[_0x502fb4(0x17c)](_0x502fb4(0x180)+_0x502fb4(0x1c5)+_0x502fb4(0x1ba)+_0x502fb4(0x163)+_0x502fb4(0x1c2)+_0x502fb4(0x162)+'=\x20?\x20AND\x20ti'+'meframe\x20=\x20'+'\x27yearly\x27\x20A'+_0x502fb4(0xf7)+_0x502fb4(0x128)+_0x502fb4(0x103),[_0x5db213[_0x502fb4(0xca)],_0x5db213[_0x502fb4(0x1d5)],_0x5db213['bucket_key']]);!_0x4d21fc?await db[_0x502fb4(0x18b)]('INSERT\x20INT'+_0x502fb4(0x102)+_0x502fb4(0xdc)+_0x502fb4(0xe3)+_0x502fb4(0xf3)+'frame,\x20buc'+_0x502fb4(0x1db)+_0x502fb4(0x109)+'nt,\x20displa'+'y_name,\x20la'+_0x502fb4(0x1d6)+_0x502fb4(0xd6)+_0x502fb4(0x17d)+_0x502fb4(0x190)+_0x502fb4(0xc7),[_0x5db213[_0x502fb4(0xca)],_0x5db213[_0x502fb4(0x1d5)],_0x5db213['bucket_key'],_0x5db213[_0x502fb4(0x1bb)+'unt'],_0x5db213[_0x502fb4(0x13d)+'me']||'',Math['floor'](_0x36799f[_0x502fb4(0x101)]())]):await db['run'](_0x502fb4(0xb9)+_0x502fb4(0xbd)+'SET\x20messag'+_0x502fb4(0x1b2)+_0x502fb4(0x1bb)+_0x502fb4(0xd8)+'isplay_nam'+_0x502fb4(0x124)+'t_updated\x20'+_0x502fb4(0x1a7)+_0x502fb4(0x13b),[_0x5db213[_0x502fb4(0x1bb)+_0x502fb4(0xbf)],_0x5db213[_0x502fb4(0x13d)+'me']||'',Math[_0x502fb4(0xf2)](_0x36799f[_0x502fb4(0x101)]()),_0x4d21fc['id']]);if(Array[_0x502fb4(0x129)](_0x5db213[_0x502fb4(0x1ec)])&&_0x5db213[_0x502fb4(0x1ec)][_0x502fb4(0x1f6)])for(let _0x52312c=0x3d*0x2f+0x1b68+-0x1*0x269b;_0x52312c<_0x5db213[_0x502fb4(0x1ec)]['length'];_0x52312c+=-0xa58+-0x3a4+-0xa*-0x198){const _0x6ea66a=_0x5db213[_0x502fb4(0x1ec)][_0x502fb4(0xe0)](_0x52312c,_0x52312c+(0x3fc+0x182*-0x12+0x191c)),_0x5f55d0='DELETE\x20FRO'+_0x502fb4(0x175)+_0x502fb4(0x16d)+_0x502fb4(0x191)+_0x6ea66a[_0x502fb4(0x136)](()=>'?')['join'](',')+')';await db[_0x502fb4(0x18b)](_0x5f55d0,_0x6ea66a);}}}try{const _0x44405c=DateTime[_0x502fb4(0x1f9)]()['setZone'](CONFIG[_0x502fb4(0x1bc)])['minus']({'days':CONFIG[_0x502fb4(0xe9)+_0x502fb4(0x117)]})['toFormat'](_0x502fb4(0x147));await db['run'](_0x502fb4(0xdf)+_0x502fb4(0x175)+_0x502fb4(0x16d)+_0x502fb4(0xc6)+_0x502fb4(0x105)+'\x20AND\x20bucke'+'t_key\x20<=\x20?',[_0x44405c]);}catch(_0x1cfb92){warn('[active]\x20p'+'rune\x20daily'+_0x502fb4(0x133)+(_0x1cfb92?.[_0x502fb4(0x15e)]||_0x1cfb92));}info('[active]\x20r'+_0x502fb4(0x14f)+'plete');}catch(_0x437ef6){error(_0x437ef6,'[active]\x20p'+_0x502fb4(0x1c6)+_0x502fb4(0xef)+':\x20'+(_0x437ef6?.[_0x502fb4(0x15e)]||_0x437ef6));}}function parsePeriodArg(_0x398f12){const _0x589886=_0x571d29;if(!_0x398f12)return null;const _0x595bd3=String(_0x398f12)[_0x589886(0x1b8)]()[_0x589886(0xcd)+'e']()[_0x589886(0x1af)](/^(\d+)\s*([dwmy])$/);if(!_0x595bd3)return null;return{'amount':Number(_0x595bd3[0x2*0xf2c+-0x786+0x3b*-0x63]),'unit':_0x595bd3[0x14cc+-0x9*0x2d0+0x486]};}function computeCutoffSeconds(_0x5039fb,_0x32cc55){const _0x10f18f=_0x571d29,_0x4c98b9=DateTime[_0x10f18f(0x1f9)]()[_0x10f18f(0xcf)](CONFIG[_0x10f18f(0x1bc)]);let _0x29dbc9;if(_0x32cc55==='d')_0x29dbc9=_0x4c98b9[_0x10f18f(0xc5)]({'days':_0x5039fb});else{if(_0x32cc55==='w')_0x29dbc9=_0x4c98b9[_0x10f18f(0xc5)]({'weeks':_0x5039fb});else{if(_0x32cc55==='m')_0x29dbc9=_0x4c98b9[_0x10f18f(0xc5)]({'months':_0x5039fb});else{if(_0x32cc55==='y')_0x29dbc9=_0x4c98b9[_0x10f18f(0xc5)]({'years':_0x5039fb});else _0x29dbc9=_0x4c98b9[_0x10f18f(0xc5)]({'days':_0x5039fb});}}}return Math[_0x10f18f(0xf2)](_0x29dbc9[_0x10f18f(0x101)]());}async function buildLeaderboardForChat(_0x48c38e,_0x41c070,_0x50fd1f=CONFIG[_0x571d29(0x187)+_0x571d29(0x19e)]){const _0x4d7f9d=_0x571d29;try{const _0x4c6234=DateTime[_0x4d7f9d(0x1dc)+'s'](_0x41c070)['setZone'](CONFIG[_0x4d7f9d(0x1bc)]),_0xb291ee=_0x4c6234[_0x4d7f9d(0x13e)](_0x4d7f9d(0x147)),_0x477146=await db[_0x4d7f9d(0x149)](_0x4d7f9d(0x1cf)+_0x4d7f9d(0xfe)+_0x4d7f9d(0x164)+_0x4d7f9d(0x1a0)+_0x4d7f9d(0xfc)+_0x4d7f9d(0x112)+'cnt,\x20MAX(l'+_0x4d7f9d(0x1cd)+_0x4d7f9d(0x11e)+_0x4d7f9d(0xb7)+_0x4d7f9d(0x1c5)+_0x4d7f9d(0x174)+_0x4d7f9d(0x192)+_0x4d7f9d(0xa7)+_0x4d7f9d(0x143)+_0x4d7f9d(0x1b1)+_0x4d7f9d(0x110)+'\x20bucket_ke'+_0x4d7f9d(0x19f)+_0x4d7f9d(0x13a)+_0x4d7f9d(0xf5)+_0x4d7f9d(0x11f),[_0x48c38e,_0xb291ee]),_0x154476=new Map();for(const _0xb7b083 of _0x477146||[]){const _0xd8a048=normalizeJid(_0xb7b083[_0x4d7f9d(0x1d5)]);_0x154476[_0x4d7f9d(0x1e8)](_0xd8a048,{'user_jid':_0xd8a048,'display_name':_0xb7b083[_0x4d7f9d(0x13d)+'me']||_0xd8a048['split']('@')[-0x1*-0x1ea1+-0x2*-0x219+0x22d3*-0x1],'count':Number(_0xb7b083[_0x4d7f9d(0x1ed)]||0x213e+0xc70+-0x2dae),'last_ts':Number(_0xb7b083['last_ts']||0x3db+0x10f*-0xb+0x7ca)});}const _0x45c308=await db[_0x4d7f9d(0x149)](_0x4d7f9d(0xf4)+_0x4d7f9d(0x145)+_0x4d7f9d(0x171)+_0x4d7f9d(0x198)+_0x4d7f9d(0x1bb)+_0x4d7f9d(0xf0)+_0x4d7f9d(0x1f4)+_0x4d7f9d(0xcc)+'stats\x20WHER'+_0x4d7f9d(0x138)+_0x4d7f9d(0x141)+_0x4d7f9d(0xd4)+_0x4d7f9d(0x15d)+_0x4d7f9d(0xb1)+'\x27,\x27yearly\x27'+')',[_0x48c38e]);for(const _0x67146 of _0x45c308||[]){let _0x4acc04=![];try{if(_0x67146[_0x4d7f9d(0x1de)]===_0x4d7f9d(0x18d)){const _0x513ef=String(_0x67146[_0x4d7f9d(0x15c)]||'')[_0x4d7f9d(0x1a9)]('-'),_0x1385ae=Number(_0x513ef[-0x1*-0x395+0x1d6c+-0x2101])||-0xf38+0xac*-0x2e+0x2*0x1ae9,_0x372ab8=Number(_0x513ef[0x11db+0x55*-0x4c+-0x762*-0x1])||0xedf*0x1+-0x24d7+0x15f9,_0x19e942=DateTime[_0x4d7f9d(0x19d)]({'weekYear':_0x1385ae,'weekNumber':_0x372ab8,'weekday':0x1},{'zone':CONFIG[_0x4d7f9d(0x1bc)]});if(_0x19e942[_0x4d7f9d(0x101)]()>=_0x41c070)_0x4acc04=!![];}else{if(_0x67146['timeframe']===_0x4d7f9d(0x106)){const _0x6580f9=String(_0x67146[_0x4d7f9d(0x15c)]||'')[_0x4d7f9d(0x1a9)]('-'),_0x15267a=Number(_0x6580f9[0x1db2+0x27+0x11b*-0x1b])||-0x10e2+-0x153a+0x2*0x16e7,_0x571edd=Number(_0x6580f9[0x9fe*-0x1+0x2*0x9bb+-0x977*0x1])||-0x15e9+0x18ea+-0x300,_0x15e3cf=DateTime['fromObject']({'year':_0x15267a,'month':_0x571edd,'day':0x1},{'zone':CONFIG[_0x4d7f9d(0x1bc)]});if(_0x15e3cf['toSeconds']()>=_0x41c070)_0x4acc04=!![];}else{if(_0x67146[_0x4d7f9d(0x1de)]===_0x4d7f9d(0x185)){const _0x406e9a=Number(String(_0x67146[_0x4d7f9d(0x15c)]||'')[_0x4d7f9d(0x1a9)]('-')[0x1615+0x1302+0x2917*-0x1])||-0x25*0x3b+0x7c*0x3b+-0xc5b,_0x4c9c4c=DateTime[_0x4d7f9d(0x19d)]({'year':_0x406e9a,'month':0x1,'day':0x1},{'zone':CONFIG['TIME_ZONE']});if(_0x4c9c4c['toSeconds']()>=_0x41c070)_0x4acc04=!![];}else _0x4acc04=!![];}}}catch(_0x5433bf){_0x4acc04=!![];}if(!_0x4acc04)continue;const _0x2c3028=normalizeJid(_0x67146['user_jid']);if(!_0x154476[_0x4d7f9d(0x1b0)](_0x2c3028))_0x154476[_0x4d7f9d(0x1e8)](_0x2c3028,{'user_jid':_0x2c3028,'display_name':_0x67146[_0x4d7f9d(0x13d)+'me']||_0x2c3028[_0x4d7f9d(0x1a9)]('@')[0x1d13+-0x1*-0x1907+-0xad2*0x5],'count':0x0,'last_ts':0x0});_0x154476[_0x4d7f9d(0x17c)](_0x2c3028)['count']+=Number(_0x67146[_0x4d7f9d(0x1bb)+_0x4d7f9d(0xbf)]||0xc35+0x35*-0x13+-0x846);}const _0x14dc4b=Array[_0x4d7f9d(0x14c)](_0x154476[_0x4d7f9d(0x1f3)]())['sort']((_0x5e260c,_0x929419)=>_0x929419[_0x4d7f9d(0x1ef)]-_0x5e260c[_0x4d7f9d(0x1ef)]||_0x929419[_0x4d7f9d(0xbb)]-_0x5e260c[_0x4d7f9d(0xbb)]);return _0x14dc4b[_0x4d7f9d(0xe0)](0x7f6*0x4+0x15b0+-0x3588,_0x50fd1f);}catch(_0x53c1a2){return warn(_0x4d7f9d(0xeb)+_0x4d7f9d(0x14d)+_0x4d7f9d(0x1c4)+_0x4d7f9d(0xa4)+(_0x53c1a2?.[_0x4d7f9d(0x15e)]||_0x53c1a2)),[];}}function _0x125e(){const _0x12c83c=['ions\x20(vers','cket_key,\x20','pushName','OT\x20NULL,\x0a\x20','\x20messages\x0a','ion\x20INTEGE','fromObject','T_RETURN','y\x20>=\x20?\x0a\x20\x20\x20','y_name,\x20SU','es\x0a\x0a','\x20\x27daily\x27\x20A','failed:\x20','ed:\x20','239889ZwsoXN','No\x20active\x20','=\x20?\x20WHERE\x20','sendMessag','split','\x20\x20\x20\x20','.ACTIVE:\x20','ted_at\x20INT','EGER\x20DEFAU','No\x20inactiv','match','has','eframe\x20=\x20\x27','e_count\x20=\x20','weekYear','AND\x20bucket','ow\x27)));','groupMetad','STS\x20active','trim','||weekly||','e_stats\x20WH','message_co','TIME_ZONE','nt,\x20displa','icipants.','EX\x20IF\x20NOT\x20','@g.us','ily\x27\x20AND\x20b','id\x20=\x20?\x20AND','SELECT\x20id,','board\x20erro','FROM\x20activ','erformRoll','weekNumber','\x27monthly\x27\x20','Y-WW,\x20mont','_stats\x20(\x0a\x20','push','nitialize\x20','ast_update',':\x0a\x0a','\x0a\x20\x20\x20\x20\x20\x20SEL','leaned\x20up','etGroupPar','ucket_key)','HERE\x20timef','rame\x20=\x20\x27da','user_jid','st_updated','y,\x20message','O_YEAR_DAY','active',',\x20user_jid','ket_key,\x20m','fromSecond','endsWith','timeframe','INSERT\x20INT','PDATE\x20acti','KEY,\x20migra','padStart',',\x20\x20\x20\x20\x20\x20\x20\x20-','_count,\x20di','key\x20=\x20?\x0a\x20\x20','eframe\x20TEX','\x20\x20\x20\x20\x20\x20\x20mes','set','kly\x27,\x20?,\x20?','pdated\x20INT','senderName','sourceIds','cnt',',\x20?,\x20?)\x0a\x20\x20','count','35laaTPQ','||yearly||','684yqJAFH','values','ay_name\x20FR','sage_id\x20TE','length','XT\x0a\x20\x20\x20\x20\x20\x20)','daily:\x20YYY','now','ACTIVE','\x20\x20\x20VALUES\x20','\x20\x20\x20\x20\x20\x20\x20tim','\x20inactive\x20','r:\x20','eekly:\x20YYY','Found\x20','chat_jid\x20=','1.1.1','\x20the\x20last\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','et_key\x20TEX','CREATE\x20IND','catch','filter','||monthly|','chema\x20ensu','\x27,\x27monthly','\x20?,\x20last_u','D\x20user_jid','fromMe','ive\x20<amoun','e\x20DB\x20error','_ts\x0a\x20\x20\x20\x20\x20\x20','-\x20\x27daily\x27|','UPDATE\x20act','?,\x20?,\x20\x27wee','last_ts','Y-MM-DD,\x20w','ive_stats\x20','\x20\x20\x20\x20\x20UNIQU','unt','ive_stats(','d\x20TEXT\x20NOT','a\x20failed','\x0a\x20\x20\x20\x20\x20\x20\x20\x20U','LT\x20(strfti','minus','\x20timeframe',',\x20?,\x20?)','[active]\x20i','ucket_key\x20','chat_jid','delete','OM\x20active_','toLowerCas','found\x20in\x20t','setZone','[active]\x20d','month','elete\x20old\x20','at_jid,\x20ti','imeframe\x20I','5300136NlvZKX',')\x20VALUES\x20(','tive\x207d','unt\x20+\x20?,\x20d','EXISTS\x20act','pdated\x20=\x20?','rame\x20=\x20\x27we','tats\x20(chat','\x20\x20chat_jid','meframe,\x20b','DELETE\x20FRO','slice','jid\x20=\x20?\x20AN','yearly\x27\x0a\x20\x20','_jid,\x20user','t><d|w|m|y','rame\x20=\x20\x27mo','lay_name\x20T','CREATE\x20TAB','stats\x20(cha','MAX_DAILY_','1396566mkEVKf','[active]\x20b','TO\x20active_','t_jid,\x20use','key)\x0a\x20\x20\x20\x20\x20','ups\x20failed','unt,\x20displ','ily\x27,\x20?,\x201','floor','_jid,\x20time','SELECT\x20use','Y\x20user_jid','18540351HMYNYz','ND\x20bucket_','unt><d|w|m','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','lay_name\x20=','ekly\x27','M(message_','isplay_nam','ECT\x20user_j','_MS','imeframe\x20=','toSeconds','O\x20active_s','MIT\x201','[active]\x20e','\x20=\x20\x27daily\x27','monthly','\x20\x20\x20\x20\x20\x20disp','\x20INSERT\x20IN','essage_cou','\x20chat_jid,','s\x20(\x0a\x20\x20\x20\x20\x20\x20','?,\x20?,\x20\x27mon','key','d)\x0a\x20\x20\x20\x20\x20\x20\x20','exec','daily\x27\x20AND','ticipants\x20','count)\x20AS\x20','[active]\x20c',',\x20\x20\x20\x20\x20\x20--\x20','\x20+\x201,\x20disp','ead\x20config','KEEP_DAYS','clear','thly\x27,\x20?,\x20','red','\x20last\x20','ROLLOVER_T','\x20);\x0a\x20\x20\x20\x20','d)\x20AS\x20last','\x0a\x20\x20\x20\x20','meframe\x20=\x20','day','ATE\x20TABLE\x20','rackMessag','e\x20=\x20?,\x20las','O_WEEK_DAY','participan','Usage:\x20act','key\x20=\x20?\x20LI','isArray','LE\x20IF\x20NOT\x20','nthly\x27','ve_stats\x20W','remoteJid','isCommand','t_updated\x20','e,\x20bucket_','5750jTVFDZ','\x20active\x20us','\x20failed:\x20','\x27weekly\x27|\x27','\x20user_jid,','map','ge_count\x20I','E\x20chat_jid','ARY\x20KEY,\x0a\x20','\x20\x20\x20GROUP\x20B','id\x20=\x20?','ata','display_na','toFormat','\x201d,\x20activ','ay_name,\x20l','\x20=\x20?\x20AND\x20t','SET\x20messag','\x20?\x20AND\x20tim','(?,\x20?,\x20\x27da','r_jid,\x20tim','T\x20NOT\x20NULL','yyyy-LL-dd','function','all','y_name,\x20la','NTEGER\x20DEF','from','uildLeader','sock','ollups\x20com','ount\x20=\x20mes','f\x20ON\x20activ','\x20\x20\x20chat_ji',',\x20timefram','HERE\x20chat_','join','|y>\x0aExampl','IMIT\x201',';\x0a\x20\x20\x20\x20','<=\x20?','O_MONTH_DA','DEDUPE_TTL','bucket_key','N\x20(\x27weekly','message','\x20\x20\x20\x20\x20messa','EXISTS\x20idx','text','\x20user_jid\x20','ERE\x20chat_j','id,\x20displa','ers\x20in\x20the','ats_chat_t','\x20bucket_ke','fromFormat','ctive\x20<amo','amount','2609613NpHGYV','inactive','tats\x20WHERE','members\x20fo','1115152rlVDfo','year','eframe,\x20bu','_leaderboa','\x20FROM\x20acti','e_stats\x0a\x20\x20','M\x20active_s','e\x20members\x20','splay_name',':\x20YYYY\x0a\x20\x20\x20','[active]\x20t','string','changes','get','?,\x20?,\x20\x27yea','unit','ve_stats\x0a\x20','SELECT\x20id\x20','\x20\x20\x20\x20\x20\x20','_active_st','jid\x20TEXT\x20N','nitialized','yearly','IF\x20NOT\x20EXI','USERS_LIMI','[active]\x20f','monthly\x27|\x27','=\x20?\x20AND\x20ti','run','\x20\x20\x20\x20last_u','weekly','_key\x20=\x20?\x20L','UTC','rly\x27,\x20?,\x20?','\x20id\x20IN\x20(','\x20\x20\x20\x20WHERE\x20','nsureSchem','rd_message','👤\x20@','[active]\x20s'];_0x125e=function(){return _0x12c83c;};return _0x125e();}async function getGroupParticipants(_0x5329eb,_0x1188b1){const _0x2487fa=_0x571d29;try{if(!_0x5329eb||typeof _0x5329eb['groupMetad'+_0x2487fa(0x13c)]!==_0x2487fa(0x148))return[];const _0x174e44=await _0x5329eb[_0x2487fa(0x1b6)+'ata'](_0x1188b1),_0x4b154d=Array[_0x2487fa(0x129)](_0x174e44?.[_0x2487fa(0x126)+'ts'])?_0x174e44[_0x2487fa(0x126)+'ts']:Object[_0x2487fa(0x1f3)](_0x174e44?.[_0x2487fa(0x126)+'ts']||{}),_0x2d84c2=_0x4b154d[_0x2487fa(0x136)](_0x819981=>_0x819981['id'])[_0x2487fa(0xae)](Boolean)['map'](normalizeJid);return _0x2d84c2;}catch(_0xaee5f){return warn('[active]\x20g'+_0x2487fa(0x1d1)+_0x2487fa(0x111)+'failed\x20for'+'\x20'+_0x1188b1+':\x20'+(_0xaee5f?.[_0x2487fa(0x15e)]||_0xaee5f)),[];}}export async function initialize(_0x1a694e){const _0x481fae=_0x571d29;try{botRef=_0x1a694e;if(botRef){if(typeof botRef[_0x481fae(0x1a8)+'e']===_0x481fae(0x148))sendApi=(_0x42850e,_0x237f57)=>botRef['sendMessag'+'e'](_0x42850e,_0x237f57);else{if(botRef[_0x481fae(0x14e)]&&typeof botRef[_0x481fae(0x14e)][_0x481fae(0x1a8)+'e']==='function')sendApi=(_0x24247f,_0x178d51)=>botRef[_0x481fae(0x14e)]['sendMessag'+'e'](_0x24247f,_0x178d51);else sendApi=null;}}try{const _0x274f28=getConfig()||{};if(_0x274f28['ACTIVE']&&typeof _0x274f28[_0x481fae(0x1fa)]==='object')CONFIG={...CONFIG,..._0x274f28[_0x481fae(0x1fa)]};}catch(_0x3a0bfa){warn(_0x481fae(0x188)+'ailed\x20to\x20r'+_0x481fae(0x116)+_0x481fae(0x1ab)+(_0x3a0bfa?.[_0x481fae(0x15e)]||_0x3a0bfa));}await ensureSchema(),await performRollups(),info(_0x481fae(0xc8)+_0x481fae(0x184));}catch(_0x38c54d){error(_0x38c54d,_0x481fae(0xc8)+_0x481fae(0x1cc)+'failed:\x20'+(_0x38c54d?.[_0x481fae(0x15e)]||_0x38c54d));throw _0x38c54d;}}export async function onMessage(_0x525405){const _0x29f977=_0x571d29;try{await trackMessage(_0x525405);if(!_0x525405?.[_0x29f977(0x12e)])return;const _0x22ea66=_0x525405[_0x29f977(0x10d)]?.[_0x29f977(0x12d)];if(!_0x22ea66||!_0x22ea66['endsWith'](_0x29f977(0x1c0)))return;const _0x5e0e9c=await isadmin(botRef,_0x525405)[_0x29f977(0xad)](()=>![]);if(!_0x5e0e9c)return;const _0x5adf3e=typeof _0x525405[_0x29f977(0x161)]===_0x29f977(0x17a)&&_0x525405[_0x29f977(0x161)][_0x29f977(0x1b8)]()?_0x525405['text']['trim']():'';if(!_0x5adf3e)return;const _0xa4b94f=_0x5adf3e[_0x29f977(0x1a9)](/\s+/)[_0x29f977(0xae)](Boolean),_0x4c9ddc=_0xa4b94f[-0x1*-0x1a5a+0x1*-0x192d+-0x12d][_0x29f977(0xcd)+'e']();if(_0x4c9ddc!=='active'&&_0x4c9ddc!==_0x29f977(0x16c))return;const _0x2000bb=_0xa4b94f[-0x35b*-0x4+0x2701+-0x346c]||'1w';let _0x24472d=parsePeriodArg(_0x2000bb);if(!_0x24472d){const _0x35813b=parseInt(_0x2000bb,-0x1b7f+-0x21fb+0x3d84);if(!isNaN(_0x35813b))_0x24472d={'amount':_0x35813b,'unit':'d'};else{const _0x10e5dc=_0x29f977(0x127)+_0x29f977(0xb5)+_0x29f977(0xe4)+'>\x20\x20OR\x20\x20ina'+_0x29f977(0x169)+_0x29f977(0xf8)+_0x29f977(0x156)+'es:\x20active'+_0x29f977(0x13f)+'e\x201w,\x20inac'+_0x29f977(0xd7);try{await sendApi(_0x22ea66,{'text':_0x10e5dc});}catch(_0x4070e0){warn('[active]\x20s'+'end\x20usage\x20'+_0x29f977(0x1a3)+(_0x4070e0?.[_0x29f977(0x15e)]||_0x4070e0));}return;}}try{await performRollups();}catch(_0x1f700a){}const _0x128abe=computeCutoffSeconds(_0x24472d[_0x29f977(0x16a)],_0x24472d[_0x29f977(0x17e)]);if(_0x4c9ddc==='active'){const _0x2fd4d1=await buildLeaderboardForChat(_0x22ea66,_0x128abe,CONFIG[_0x29f977(0x187)+_0x29f977(0x19e)]);if(!_0x2fd4d1||_0x2fd4d1[_0x29f977(0x1f6)]===0x118b+-0x2b3*-0x8+-0x2723){await sendApi(_0x22ea66,{'text':_0x29f977(0x1a6)+_0x29f977(0x16e)+'und\x20in\x20the'+_0x29f977(0x11b)+_0x24472d[_0x29f977(0x16a)]+_0x24472d['unit']+'.'});return;}let _0x1a0dec=_0x29f977(0xa6)+_0x2fd4d1[_0x29f977(0x1f6)]+(_0x29f977(0x132)+_0x29f977(0x165)+_0x29f977(0x11b))+_0x24472d[_0x29f977(0x16a)]+_0x24472d[_0x29f977(0x17e)]+':\x0a\x0a';const _0x4f888c=[];let _0x537beb=-0xa30+-0x22a3+0x87*0x55;for(const _0x2852fe of _0x2fd4d1){_0x537beb++;const _0x136014=_0x2852fe['user_jid'][_0x29f977(0x1a9)]('@')[0x1*0x75b+-0x15ff*0x1+0xea4];_0x1a0dec+=_0x29f977(0x195)+_0x136014+'\x20('+(_0x2852fe[_0x29f977(0x13d)+'me']||_0x136014)+')\x0a',_0x1a0dec+=romanParen(_0x537beb)+'\x20'+_0x2852fe['count']+(_0x29f977(0x19b)+'\x0a'),_0x4f888c['push'](_0x2852fe['user_jid']);}const _0x3407cb=-0x21e6+-0x3*0xa37+0x502b;if(_0x1a0dec[_0x29f977(0x1f6)]<=_0x3407cb)await sendApi(_0x22ea66,{'text':_0x1a0dec,'mentions':_0x4f888c});else{const _0x2b0ff6=_0x1a0dec['split']('\x0a\x0a');let _0x3ad47d='';for(const _0x14ff16 of _0x2b0ff6){if((_0x3ad47d+'\x0a\x0a'+_0x14ff16)[_0x29f977(0x1f6)]>_0x3407cb)await sendApi(_0x22ea66,{'text':_0x3ad47d,'mentions':_0x4f888c}),_0x3ad47d=_0x14ff16+'\x0a\x0a';else _0x3ad47d+=(_0x3ad47d?'\x0a\x0a':'')+_0x14ff16;}if(_0x3ad47d['trim']())await sendApi(_0x22ea66,{'text':_0x3ad47d,'mentions':_0x4f888c});}return;}if(_0x4c9ddc===_0x29f977(0x16c)){const _0x2df1d6=botRef?.[_0x29f977(0x14e)]||botRef,_0x44bcc3=await getGroupParticipants(_0x2df1d6,_0x22ea66);if(!_0x44bcc3||_0x44bcc3['length']===-0xc9c+-0x277*0x6+0x1b66){await sendApi(_0x22ea66,{'text':'Could\x20not\x20'+'determine\x20'+'group\x20part'+_0x29f977(0x1be)});return;}const _0x27b661=await buildLeaderboardForChat(_0x22ea66,_0x128abe,0x600*0x2a6+-0xe9572+0x1*0xdf3b2),_0x2814ba=new Set((_0x27b661||[])[_0x29f977(0x136)](_0x312788=>normalizeJid(_0x312788['user_jid']))),_0x3addd1=_0x44bcc3[_0x29f977(0xae)](_0x5b9283=>!_0x2814ba[_0x29f977(0x1b0)](normalizeJid(_0x5b9283)));if(!_0x3addd1[_0x29f977(0x1f6)]){await sendApi(_0x22ea66,{'text':_0x29f977(0x1ae)+_0x29f977(0x176)+_0x29f977(0xce)+'he\x20last\x20'+_0x24472d[_0x29f977(0x16a)]+_0x24472d['unit']+'.'});return;}let _0xcd8908=_0x29f977(0xa6)+_0x3addd1[_0x29f977(0x1f6)]+(_0x29f977(0xa3)+'members\x20in'+_0x29f977(0xa9))+_0x24472d[_0x29f977(0x16a)]+_0x24472d[_0x29f977(0x17e)]+_0x29f977(0x1ce);const _0x478b9c=[];let _0x55a499=-0x42a+-0x3*-0xc50+-0x20c6;for(const _0x5d4ae4 of _0x3addd1){_0x55a499++;const _0x1c3a09=_0x5d4ae4['split']('@')[-0x2*0xef3+0x2ab*0xb+0x8d];_0xcd8908+=_0x29f977(0x195)+_0x1c3a09+'\x20('+_0x1c3a09+')\x0a',_0xcd8908+=romanParen(_0x55a499)+('\x20no\x20messag'+_0x29f977(0x1a1)),_0x478b9c[_0x29f977(0x1cb)](_0x5d4ae4);}await sendApi(_0x22ea66,{'text':_0xcd8908,'mentions':_0x478b9c});return;}}catch(_0x407ab6){error(_0x407ab6,'[active]\x20o'+'nMessage\x20f'+'ailed:\x20'+(_0x407ab6?.['message']||_0x407ab6));}}export async function cleanup(){const _0x4cb41b=_0x571d29;try{for(const _0x58c340 of processedMessageKeys[_0x4cb41b(0x1f3)]())try{clearTimeout(_0x58c340);}catch(_0x43631c){}processedMessageKeys[_0x4cb41b(0x118)]();}catch(_0x9d05ac){}botRef=null,sendApi=null,info(_0x4cb41b(0x113)+_0x4cb41b(0x1d0));}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};