const _0x1cc0b1=_0x4b99;(function(_0x1ec602,_0x3fdaa1){const _0x406289=_0x4b99,_0x457a45=_0x1ec602();while(!![]){try{const _0x1f4c5e=-parseInt(_0x406289(0x15c))/(0xe5*-0x29+0xe1c+0x1692)+-parseInt(_0x406289(0x1bd))/(0x10*0xa6+0x1b50+-0x25ae)*(-parseInt(_0x406289(0x1d4))/(0xebe+0x71*-0x28+-0x2ed*-0x1))+-parseInt(_0x406289(0xfd))/(0xd24*0x2+0x9f5+-0xb*0x34b)*(-parseInt(_0x406289(0x203))/(0xe1e+-0x1*-0x1e6e+0x1*-0x2c87))+-parseInt(_0x406289(0x160))/(-0x21a0+0x22f9+-0x71*0x3)+-parseInt(_0x406289(0x1bf))/(0xec8+0x8b8+-0x1779)+parseInt(_0x406289(0x206))/(-0x208+0x1056+-0xe46)+parseInt(_0x406289(0x20d))/(-0x7*-0x493+-0x1bec+0xd0*-0x5)*(parseInt(_0x406289(0x17c))/(0x1826*0x1+0x1bac+0x679*-0x8));if(_0x1f4c5e===_0x3fdaa1)break;else _0x457a45['push'](_0x457a45['shift']());}catch(_0x478982){_0x457a45['push'](_0x457a45['shift']());}}}(_0x2cc0,-0x2*-0x1807d+-0x1dac7+0x1675d));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x1cc0b1(0x123);export const version=_0x1cc0b1(0x14a);export const priority=0xc4f*-0x1+0x71*0x43+-0x10ea;export const commands=[_0x1cc0b1(0x123),_0x1cc0b1(0x19d)];let botRef=null,sendApi=null;const DEFAULTS={'TIME_ZONE':_0x1cc0b1(0x195),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(0x237f+0x2*0x795+-0x328b*0x1)*(0x163c+0xd*-0x17f+-0x1*-0x11f)};let CONFIG={...DEFAULTS};function normalizeJid(_0x2080db){return _0x2080db?String(_0x2080db)['trim']():'';}function sleep(_0x357a1f){return new Promise(_0x5e04c9=>setTimeout(_0x5e04c9,_0x357a1f));}function toLowerRoman(_0x55f843){const _0x1d08a7=_0x1cc0b1,_0x2cbc40=[[0xf1f+-0x9*-0x1bb+0x7f*-0x36,'M'],[0x188f*0x1+-0x19a+-0x1371,'CM'],[0x12f*-0x5+0x1*0x1519+-0x69d*0x2,'D'],[0x1958+-0xd22*-0x1+0x1c2*-0x15,'CD'],[0x77*0x1f+-0x1*0xbce+0x1b*-0x15,'C'],[-0x6bc+-0x1f7*-0x7+-0x6ab,'XC'],[-0x799+-0x163d+0x1*0x1e08,'L'],[-0x13d2+-0x10c*-0x11+0x22e,'XL'],[-0x17*0x15d+-0x1ecd+0x3e32,'X'],[0xc*0x1c0+0x4c8+-0x19bf,'IX'],[0xd29*-0x1+-0x2b*-0x2d+0x59f,'V'],[-0x47d+-0x9c1*-0x2+0xf01*-0x1,'IV'],[-0x5*0x361+0xd5b+0x38b*0x1,'I']];let _0x489af9=_0x55f843,_0x2ef9a5='';for(const [_0x819c13,_0x3fc4a1]of _0x2cbc40)while(_0x489af9>=_0x819c13){_0x2ef9a5+=_0x3fc4a1,_0x489af9-=_0x819c13;}return _0x2ef9a5[_0x1d08a7(0x1f0)+'e']();}function romanParen(_0x20f464){return'('+toLowerRoman(_0x20f464)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x4cabbd){const _0x21a6f2=_0x1cc0b1,_0x4e9873=_0x4cabbd?.[_0x21a6f2(0x157)];if(!_0x4e9873)return null;const _0x5ce20e=_0x4e9873['id']||_0x4e9873[_0x21a6f2(0x1ab)+'t']||'',_0x55285c=_0x4e9873[_0x21a6f2(0x10d)]||'';return _0x55285c+'::'+_0x5ce20e;}function isMsgProcessed(_0x32f21e){return _0x32f21e&&processedMessageKeys['has'](_0x32f21e);}function markMsgProcessed(_0x35fcf9){const _0x594c04=_0x1cc0b1;if(!_0x35fcf9)return;if(processedMessageKeys['has'](_0x35fcf9))clearTimeout(processedMessageKeys[_0x594c04(0xde)](_0x35fcf9));const _0xa939cc=setTimeout(()=>processedMessageKeys[_0x594c04(0xc6)](_0x35fcf9),CONFIG[_0x594c04(0x147)+'_MS']);processedMessageKeys['set'](_0x35fcf9,_0xa939cc);}async function ensureSchema(){const _0x45f9c7=_0x1cc0b1;try{await db[_0x45f9c7(0xe1)]('CREATE\x20TAB'+_0x45f9c7(0x132)+_0x45f9c7(0xee)+'ive_migrat'+_0x45f9c7(0x109)+_0x45f9c7(0x18a)+_0x45f9c7(0x137)+'KEY,\x20migra'+_0x45f9c7(0x15a)+'EGER\x20DEFAU'+_0x45f9c7(0x205)+_0x45f9c7(0x125)+_0x45f9c7(0x129)),await db[_0x45f9c7(0xe1)](_0x45f9c7(0x1d6)+_0x45f9c7(0x1d2)+_0x45f9c7(0x1ae)+_0x45f9c7(0xf7)+_0x45f9c7(0x1e2)+_0x45f9c7(0x1db)+'INTEGER\x20PR'+'IMARY\x20KEY\x20'+_0x45f9c7(0x1ef)+'ENT,\x0a\x20\x20\x20\x20\x20'+_0x45f9c7(0x14d)+_0x45f9c7(0xdb)+_0x45f9c7(0x200)+_0x45f9c7(0x1e8)+_0x45f9c7(0x1ff)+'OT\x20NULL,\x0a\x20'+_0x45f9c7(0x168)+_0x45f9c7(0x1bb)+_0x45f9c7(0xfb)+_0x45f9c7(0x100)+_0x45f9c7(0x148)+'\x27weekly\x27|\x27'+_0x45f9c7(0x202)+'yearly\x27\x0a\x20\x20'+_0x45f9c7(0xd0)+'et_key\x20TEX'+_0x45f9c7(0xfb)+',\x20\x20\x20\x20\x20\x20--\x20'+'daily:\x20YYY'+_0x45f9c7(0x1f8)+_0x45f9c7(0x11a)+_0x45f9c7(0x127)+_0x45f9c7(0x159)+_0x45f9c7(0x1be)+_0x45f9c7(0xea)+'\x20\x20\x20\x20\x20messa'+'ge_count\x20I'+_0x45f9c7(0xeb)+_0x45f9c7(0xce)+_0x45f9c7(0x17a)+_0x45f9c7(0x112)+_0x45f9c7(0xc9)+'T\x20\x27\x27,\x0a\x20\x20\x20\x20'+'\x20\x20\x20\x20last_u'+_0x45f9c7(0x16a)+'EGER\x20DEFAU'+_0x45f9c7(0x205)+_0x45f9c7(0x125)+_0x45f9c7(0x1ad)+_0x45f9c7(0x209)+'E(chat_jid'+_0x45f9c7(0x1c8)+_0x45f9c7(0x194)+_0x45f9c7(0x1e4)+'key)\x0a\x20\x20\x20\x20\x20'+_0x45f9c7(0x106)),await db['exec'](_0x45f9c7(0xd6)+_0x45f9c7(0x1b2)+_0x45f9c7(0x12b)+_0x45f9c7(0x13f)+_0x45f9c7(0x133)+_0x45f9c7(0x1f6)+_0x45f9c7(0x115)+_0x45f9c7(0xc7)+'meframe,\x20b'+_0x45f9c7(0x12f)+';'),await db['exec'](_0x45f9c7(0xd6)+_0x45f9c7(0x1b2)+_0x45f9c7(0x12b)+_0x45f9c7(0x13f)+_0x45f9c7(0x1b5)+_0x45f9c7(0x16c)+'ive_stats('+_0x45f9c7(0x1ee)+_0x45f9c7(0x20b)),await db[_0x45f9c7(0xe1)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+'ATE\x20TABLE\x20'+_0x45f9c7(0x1ae)+'STS\x20active'+_0x45f9c7(0x1ce)+_0x45f9c7(0x1c1)+_0x45f9c7(0x122)+_0x45f9c7(0x177)+_0x45f9c7(0x1a3)+_0x45f9c7(0x17f)+'\x20\x20\x20\x20\x20\x20\x20mes'+'sage_id\x20TE'+'XT\x0a\x20\x20\x20\x20\x20\x20)'+_0x45f9c7(0x1e9)),info(_0x45f9c7(0xe6)+_0x45f9c7(0x124)+_0x45f9c7(0x190));}catch(_0x4b705e){error(_0x4b705e,'[active]\x20e'+_0x45f9c7(0x145)+_0x45f9c7(0xe2));throw _0x4b705e;}}export async function trackMessage(_0x561e66){const _0x2360de=_0x1cc0b1;try{if(!_0x561e66||!_0x561e66[_0x2360de(0x157)]||!_0x561e66[_0x2360de(0x156)])return;const _0x2ecaa0=makeDedupeKey(_0x561e66);if(!_0x2ecaa0)return;if(isMsgProcessed(_0x2ecaa0))return;markMsgProcessed(_0x2ecaa0);if(_0x561e66['key'][_0x2360de(0x1f7)])return;const _0x7d9cf2=_0x561e66[_0x2360de(0x157)]['remoteJid'];if(!_0x7d9cf2||!_0x7d9cf2[_0x2360de(0x210)]('@g.us'))return;const _0x1ea7f0=_0x561e66['key'][_0x2360de(0x1ab)+'t']||_0x561e66[_0x2360de(0x157)][_0x2360de(0x12c)]||'';if(!_0x1ea7f0)return;const _0x5c7ead=normalizeJid(_0x1ea7f0),_0x14d8b3=DateTime[_0x2360de(0x178)]()['setZone'](CONFIG[_0x2360de(0x1ec)]),_0x2126d7=_0x14d8b3[_0x2360de(0x180)](_0x2360de(0x149));try{const _0x4c2f72=await db[_0x2360de(0x192)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20U'+'PDATE\x20acti'+'ve_stats\x0a\x20'+'\x20\x20\x20\x20\x20\x20\x20SET'+_0x2360de(0x17d)+_0x2360de(0x1cd)+_0x2360de(0x153)+'\x20+\x201,\x20disp'+_0x2360de(0xf2)+'\x20?,\x20last_u'+_0x2360de(0xdc)+_0x2360de(0x1ed)+_0x2360de(0x16b)+_0x2360de(0x13d)+_0x2360de(0x1c2)+_0x2360de(0x20f)+_0x2360de(0x187)+_0x2360de(0x1b3)+_0x2360de(0xf9)+'key\x20=\x20?\x0a\x20\x20'+_0x2360de(0x213),[_0x561e66[_0x2360de(0x1f3)]||_0x561e66[_0x2360de(0x1bc)]||'',Math[_0x2360de(0x146)](_0x14d8b3[_0x2360de(0x20e)]()),_0x7d9cf2,_0x5c7ead,_0x2126d7]);(!_0x4c2f72||!_0x4c2f72[_0x2360de(0x11c)])&&await db[_0x2360de(0x192)](_0x2360de(0x204)+_0x2360de(0x1c5)+'TO\x20active_'+_0x2360de(0x1a5)+_0x2360de(0x18d)+'r_jid,\x20tim'+_0x2360de(0x207)+'cket_key,\x20'+_0x2360de(0xe7)+_0x2360de(0x138)+_0x2360de(0x1ac)+_0x2360de(0x197)+_0x2360de(0x1b1)+_0x2360de(0x1a2)+'(?,\x20?,\x20\x27da'+_0x2360de(0x151)+_0x2360de(0x1f4)+_0x2360de(0x171),[_0x7d9cf2,_0x5c7ead,_0x2126d7,_0x561e66[_0x2360de(0x1f3)]||_0x561e66[_0x2360de(0x1bc)]||'',Math[_0x2360de(0x146)](_0x14d8b3[_0x2360de(0x20e)]())]);}catch(_0x73be52){warn('[active]\x20t'+_0x2360de(0x111)+_0x2360de(0x1a0)+':\x20'+(_0x73be52?.['message']||_0x73be52));}}catch(_0x23d8f2){warn('[active]\x20t'+_0x2360de(0x111)+_0x2360de(0x128)+'ed:\x20'+(_0x23d8f2?.[_0x2360de(0x156)]||_0x23d8f2));}}async function performRollups(){const _0x551b4a=_0x1cc0b1;try{const _0x3ae04e=DateTime[_0x551b4a(0x178)]()['setZone'](CONFIG[_0x551b4a(0x1ec)]),_0x2d7502=_0x3ae04e['minus']({'days':CONFIG[_0x551b4a(0x1da)+_0x551b4a(0x120)+'S']})[_0x551b4a(0x13c)](_0x551b4a(0xf0)),_0x4726d1=_0x2d7502[_0x551b4a(0x180)]('yyyy-LL-dd'),_0x5f4fcf=await db[_0x551b4a(0x10f)]('SELECT\x20id,'+_0x551b4a(0x1d5)+_0x551b4a(0x208)+'\x20bucket_ke'+_0x551b4a(0xcf)+_0x551b4a(0x1aa)+_0x551b4a(0xcd)+_0x551b4a(0x15d)+_0x551b4a(0xc4)+_0x551b4a(0xe4)+_0x551b4a(0xd5)+_0x551b4a(0x158)+_0x551b4a(0x1ea)+_0x551b4a(0x173),[_0x4726d1]);if(_0x5f4fcf&&_0x5f4fcf[_0x551b4a(0x179)]){const _0x37f52a=new Map();for(const _0x12a6f8 of _0x5f4fcf){const _0x59db18=DateTime[_0x551b4a(0x142)](_0x12a6f8[_0x551b4a(0x19e)],'yyyy-LL-dd',{'zone':CONFIG['TIME_ZONE']}),_0x5929cf=_0x59db18['weekYear']+'-'+String(_0x59db18[_0x551b4a(0x166)])[_0x551b4a(0xd7)](-0x1b*0x165+-0x1c*0xc7+-0x1cd*-0x21,'0'),_0x709be9=_0x12a6f8[_0x551b4a(0x1af)]+'||'+_0x12a6f8[_0x551b4a(0x182)]+'||weekly||'+_0x5929cf;if(!_0x37f52a['has'](_0x709be9))_0x37f52a[_0x551b4a(0x1f5)](_0x709be9,{'chat_jid':_0x12a6f8[_0x551b4a(0x1af)],'user_jid':_0x12a6f8[_0x551b4a(0x182)],'timeframe':_0x551b4a(0xd8),'bucket_key':_0x5929cf,'message_count':0x0,'display_name':_0x12a6f8['display_na'+'me']||''});const _0x15a21d=_0x37f52a[_0x551b4a(0xde)](_0x709be9);_0x15a21d[_0x551b4a(0xe7)+_0x551b4a(0x154)]+=Number(_0x12a6f8['message_co'+_0x551b4a(0x154)]||-0x5*-0x5ca+-0x1154+-0xb9e);}for(const _0x240beb of _0x37f52a[_0x551b4a(0xcb)]()){const _0x5cf944=await db[_0x551b4a(0xde)](_0x551b4a(0x1eb)+_0x551b4a(0x16e)+_0x551b4a(0xf3)+'ERE\x20chat_j'+_0x551b4a(0x1a8)+'\x20user_jid\x20'+_0x551b4a(0x181)+'meframe\x20=\x20'+_0x551b4a(0x136)+'ND\x20bucket_'+_0x551b4a(0x1a7)+'MIT\x201',[_0x240beb[_0x551b4a(0x1af)],_0x240beb['user_jid'],_0x240beb[_0x551b4a(0x19e)]]);!_0x5cf944?await db['run'](_0x551b4a(0x11d)+_0x551b4a(0x184)+_0x551b4a(0xdd)+_0x551b4a(0x118)+'_jid,\x20time'+_0x551b4a(0x1e1)+_0x551b4a(0x1e7)+_0x551b4a(0x104)+_0x551b4a(0x165)+_0x551b4a(0x1f9)+_0x551b4a(0x175)+_0x551b4a(0x139)+_0x551b4a(0x19f)+_0x551b4a(0xe9)+',\x20?,\x20?)',[_0x240beb[_0x551b4a(0x1af)],_0x240beb['user_jid'],_0x240beb['bucket_key'],_0x240beb[_0x551b4a(0xe7)+_0x551b4a(0x154)],_0x240beb['display_na'+'me']||'',Math[_0x551b4a(0x146)](_0x3ae04e[_0x551b4a(0x20e)]())]):await db[_0x551b4a(0x192)]('UPDATE\x20act'+_0x551b4a(0x1d7)+'SET\x20messag'+_0x551b4a(0x1c3)+_0x551b4a(0xe7)+_0x551b4a(0x1a4)+_0x551b4a(0x211)+_0x551b4a(0x1f2)+'t_updated\x20'+_0x551b4a(0x10a)+_0x551b4a(0x18f),[_0x240beb[_0x551b4a(0xe7)+'unt'],_0x240beb[_0x551b4a(0x1b7)+'me']||'',Math[_0x551b4a(0x146)](_0x3ae04e['toSeconds']()),_0x5cf944['id']]);}try{const _0x595069=_0x5f4fcf[_0x551b4a(0x1cb)](_0x3a570=>_0x3a570['id']);for(let _0xfbfdb8=-0x14b7*-0x1+-0x32f*0x6+-0x1*0x19d;_0xfbfdb8<_0x595069['length'];_0xfbfdb8+=-0x1aa3*0x1+0x1b19+0x1*0x17e){const _0x3f693f=_0x595069[_0x551b4a(0x116)](_0xfbfdb8,_0xfbfdb8+(-0x353+-0x68*0x3b+-0x1d3f*-0x1)),_0x541d12=_0x551b4a(0x126)+_0x551b4a(0xda)+_0x551b4a(0x1d1)+_0x551b4a(0xfc)+_0x3f693f[_0x551b4a(0x1cb)](()=>'?')['join'](',')+')';await db[_0x551b4a(0x192)](_0x541d12,_0x3f693f);}}catch(_0xd4efe1){warn('[active]\x20d'+_0x551b4a(0x14f)+_0x551b4a(0x193)+_0x551b4a(0x183)+(_0xd4efe1?.[_0x551b4a(0x156)]||_0xd4efe1));}}const _0x578d8e=_0x3ae04e[_0x551b4a(0x20a)]({'days':CONFIG[_0x551b4a(0x1da)+_0x551b4a(0x108)+'YS']})[_0x551b4a(0x20e)](),_0x44fd77=await db[_0x551b4a(0x10f)](_0x551b4a(0x185)+_0x551b4a(0x1d5)+_0x551b4a(0x208)+'\x20bucket_ke'+_0x551b4a(0xcf)+_0x551b4a(0x1aa)+_0x551b4a(0xcd)+_0x551b4a(0x15d)+_0x551b4a(0xc4)+_0x551b4a(0xe4)+_0x551b4a(0x1f1)+_0x551b4a(0x196));if(_0x44fd77&&_0x44fd77['length']){const _0x3b7699=new Map();for(const _0x135fc6 of _0x44fd77){const _0x257474=String(_0x135fc6['bucket_key']||'')['split']('-'),_0x5dfce5=Number(_0x257474[-0xc56*0x1+-0x1587+0x21dd])||-0x21*0xdd+-0x13*-0x1b1+0xe*0x4a,_0x123b7a=Number(_0x257474[0x1349*0x2+-0x308*0x8+-0xe51])||-0x1c45+0x1ec2+-0x35*0xc,_0x36a52d=DateTime[_0x551b4a(0x1de)]({'weekYear':_0x5dfce5,'weekNumber':_0x123b7a,'weekday':0x1},{'zone':CONFIG[_0x551b4a(0x1ec)]});if(_0x36a52d[_0x551b4a(0x20e)]()>_0x578d8e)continue;const _0x541f03=_0x36a52d[_0x551b4a(0x16f)]+'-'+String(_0x36a52d[_0x551b4a(0xd2)])[_0x551b4a(0xd7)](0x18da+-0x18*0xed+-0x6*0x70,'0'),_0x3e4c45=_0x135fc6[_0x551b4a(0x1af)]+'||'+_0x135fc6['user_jid']+(_0x551b4a(0xf8)+'|')+_0x541f03;if(!_0x3b7699['has'](_0x3e4c45))_0x3b7699[_0x551b4a(0x1f5)](_0x3e4c45,{'chat_jid':_0x135fc6[_0x551b4a(0x1af)],'user_jid':_0x135fc6[_0x551b4a(0x182)],'timeframe':_0x551b4a(0xd1),'bucket_key':_0x541f03,'message_count':0x0,'display_name':_0x135fc6[_0x551b4a(0x1b7)+'me']||'','sourceIds':[]});const _0x148c4b=_0x3b7699['get'](_0x3e4c45);_0x148c4b[_0x551b4a(0xe7)+_0x551b4a(0x154)]+=Number(_0x135fc6[_0x551b4a(0xe7)+'unt']||-0x203c+-0x1*0x12cd+0x3309),_0x148c4b[_0x551b4a(0x186)][_0x551b4a(0x19b)](_0x135fc6['id']);}for(const _0x36725f of _0x3b7699[_0x551b4a(0xcb)]()){const _0x19f5fd=await db[_0x551b4a(0xde)]('SELECT\x20id\x20'+_0x551b4a(0x16e)+_0x551b4a(0xf3)+_0x551b4a(0x11b)+_0x551b4a(0x1a8)+_0x551b4a(0x12a)+_0x551b4a(0x181)+_0x551b4a(0x18b)+'\x27monthly\x27\x20'+'AND\x20bucket'+'_key\x20=\x20?\x20L'+'IMIT\x201',[_0x36725f[_0x551b4a(0x1af)],_0x36725f[_0x551b4a(0x182)],_0x36725f[_0x551b4a(0x19e)]]);!_0x19f5fd?await db[_0x551b4a(0x192)](_0x551b4a(0x11d)+_0x551b4a(0x184)+_0x551b4a(0xdd)+_0x551b4a(0x118)+_0x551b4a(0x1a1)+'frame,\x20buc'+'ket_key,\x20m'+_0x551b4a(0x104)+'nt,\x20displa'+_0x551b4a(0x1f9)+'st_updated'+_0x551b4a(0x139)+_0x551b4a(0xed)+_0x551b4a(0xc5)+_0x551b4a(0xfa),[_0x36725f[_0x551b4a(0x1af)],_0x36725f['user_jid'],_0x36725f[_0x551b4a(0x19e)],_0x36725f[_0x551b4a(0xe7)+_0x551b4a(0x154)],_0x36725f[_0x551b4a(0x1b7)+'me']||'',Math[_0x551b4a(0x146)](_0x3ae04e[_0x551b4a(0x20e)]())]):await db[_0x551b4a(0x192)](_0x551b4a(0x1d8)+'ive_stats\x20'+_0x551b4a(0xf5)+_0x551b4a(0x1c3)+_0x551b4a(0xe7)+_0x551b4a(0x1a4)+_0x551b4a(0x211)+_0x551b4a(0x1f2)+_0x551b4a(0x19a)+_0x551b4a(0x10a)+_0x551b4a(0x18f),[_0x36725f['message_co'+_0x551b4a(0x154)],_0x36725f['display_na'+'me']||'',Math['floor'](_0x3ae04e[_0x551b4a(0x20e)]()),_0x19f5fd['id']]);if(Array[_0x551b4a(0x162)](_0x36725f['sourceIds'])&&_0x36725f[_0x551b4a(0x186)][_0x551b4a(0x179)])for(let _0x152b23=-0x1a0a+0x22d8+-0x8ce;_0x152b23<_0x36725f[_0x551b4a(0x186)]['length'];_0x152b23+=-0x1f*-0xe5+-0x4b*-0x39+-0x2a7a){const _0x51aa2a=_0x36725f[_0x551b4a(0x186)]['slice'](_0x152b23,_0x152b23+(0x2b*-0x9+-0xe04*0x2+0x1f7f)),_0x502334=_0x551b4a(0x126)+_0x551b4a(0xda)+_0x551b4a(0x1d1)+'\x20id\x20IN\x20('+_0x51aa2a[_0x551b4a(0x1cb)](()=>'?')[_0x551b4a(0x1d9)](',')+')';await db[_0x551b4a(0x192)](_0x502334,_0x51aa2a);}}}const _0x3aa84b=_0x3ae04e[_0x551b4a(0x20a)]({'days':CONFIG[_0x551b4a(0x1da)+_0x551b4a(0x191)+'S']})[_0x551b4a(0x20e)](),_0x512528=await db['all'](_0x551b4a(0x185)+'\x20chat_jid,'+_0x551b4a(0x208)+_0x551b4a(0x1e6)+'y,\x20message'+_0x551b4a(0x1aa)+_0x551b4a(0xcd)+_0x551b4a(0x15d)+'ve_stats\x20W'+_0x551b4a(0xe4)+'rame\x20=\x20\x27mo'+'nthly\x27');if(_0x512528&&_0x512528[_0x551b4a(0x179)]){const _0x4d7759=new Map();for(const _0xe06ed9 of _0x512528){const _0x5b692e=String(_0xe06ed9['bucket_key']||'')[_0x551b4a(0x114)]('-'),_0x29537f=Number(_0x5b692e[0xbf*0x7+0x87e+-0xdb7])||0x2*-0xf6a+0x1*0x17e1+-0x1*-0xea5,_0x33f853=DateTime[_0x551b4a(0x1de)]({'year':_0x29537f,'month':0x1,'day':0x1},{'zone':CONFIG['TIME_ZONE']});if(_0x33f853['toSeconds']()>_0x3aa84b)continue;const _0x3b8337=''+_0x29537f,_0x161c18=_0xe06ed9[_0x551b4a(0x1af)]+'||'+_0xe06ed9[_0x551b4a(0x182)]+'||yearly||'+_0x3b8337;if(!_0x4d7759[_0x551b4a(0x14e)](_0x161c18))_0x4d7759[_0x551b4a(0x1f5)](_0x161c18,{'chat_jid':_0xe06ed9[_0x551b4a(0x1af)],'user_jid':_0xe06ed9[_0x551b4a(0x182)],'timeframe':_0x551b4a(0x134),'bucket_key':_0x3b8337,'message_count':0x0,'display_name':_0xe06ed9[_0x551b4a(0x1b7)+'me']||'','sourceIds':[]});const _0x97997c=_0x4d7759[_0x551b4a(0xde)](_0x161c18);_0x97997c[_0x551b4a(0xe7)+_0x551b4a(0x154)]+=Number(_0xe06ed9[_0x551b4a(0xe7)+_0x551b4a(0x154)]||0x81d*-0x2+-0x1fe1+-0x99f*-0x5),_0x97997c['sourceIds']['push'](_0xe06ed9['id']);}for(const _0x306ef1 of _0x4d7759[_0x551b4a(0xcb)]()){const _0x3649c7=await db[_0x551b4a(0xde)](_0x551b4a(0x1eb)+_0x551b4a(0x16e)+'e_stats\x20WH'+_0x551b4a(0x11b)+'id\x20=\x20?\x20AND'+_0x551b4a(0x12a)+_0x551b4a(0x181)+'meframe\x20=\x20'+_0x551b4a(0x103)+_0x551b4a(0xf9)+_0x551b4a(0x1a7)+_0x551b4a(0x10e),[_0x306ef1['chat_jid'],_0x306ef1[_0x551b4a(0x182)],_0x306ef1[_0x551b4a(0x19e)]]);!_0x3649c7?await db[_0x551b4a(0x192)](_0x551b4a(0x11d)+'O\x20active_s'+_0x551b4a(0xdd)+_0x551b4a(0x118)+_0x551b4a(0x1a1)+_0x551b4a(0x1e1)+_0x551b4a(0x1e7)+_0x551b4a(0x104)+_0x551b4a(0x165)+'y_name,\x20la'+_0x551b4a(0x175)+_0x551b4a(0x139)+_0x551b4a(0xef)+_0x551b4a(0xec)+_0x551b4a(0x1dc),[_0x306ef1[_0x551b4a(0x1af)],_0x306ef1[_0x551b4a(0x182)],_0x306ef1[_0x551b4a(0x19e)],_0x306ef1[_0x551b4a(0xe7)+_0x551b4a(0x154)],_0x306ef1[_0x551b4a(0x1b7)+'me']||'',Math[_0x551b4a(0x146)](_0x3ae04e[_0x551b4a(0x20e)]())]):await db['run'](_0x551b4a(0x1d8)+_0x551b4a(0x1d7)+_0x551b4a(0xf5)+_0x551b4a(0x1c3)+'message_co'+_0x551b4a(0x1a4)+_0x551b4a(0x211)+_0x551b4a(0x1f2)+'t_updated\x20'+_0x551b4a(0x10a)+'id\x20=\x20?',[_0x306ef1[_0x551b4a(0xe7)+'unt'],_0x306ef1[_0x551b4a(0x1b7)+'me']||'',Math[_0x551b4a(0x146)](_0x3ae04e[_0x551b4a(0x20e)]()),_0x3649c7['id']]);if(Array[_0x551b4a(0x162)](_0x306ef1['sourceIds'])&&_0x306ef1[_0x551b4a(0x186)][_0x551b4a(0x179)])for(let _0x153d25=-0x1844*-0x1+-0xa68+0x4*-0x377;_0x153d25<_0x306ef1[_0x551b4a(0x186)]['length'];_0x153d25+=0x696+-0x251*-0x1+0x3*-0x251){const _0x1c826c=_0x306ef1[_0x551b4a(0x186)][_0x551b4a(0x116)](_0x153d25,_0x153d25+(0x500+-0x4*-0x437+0x7*-0x2d8)),_0x2bf9aa=_0x551b4a(0x126)+_0x551b4a(0xda)+_0x551b4a(0x1d1)+_0x551b4a(0xfc)+_0x1c826c[_0x551b4a(0x1cb)](()=>'?')[_0x551b4a(0x1d9)](',')+')';await db['run'](_0x2bf9aa,_0x1c826c);}}}try{const _0x336bb0=DateTime[_0x551b4a(0x178)]()['setZone'](CONFIG[_0x551b4a(0x1ec)])[_0x551b4a(0x20a)]({'days':CONFIG[_0x551b4a(0x1ba)+_0x551b4a(0x10b)]})[_0x551b4a(0x180)](_0x551b4a(0x149));await db[_0x551b4a(0x192)]('DELETE\x20FRO'+_0x551b4a(0xda)+_0x551b4a(0x1d1)+'\x20timeframe'+_0x551b4a(0xf1)+_0x551b4a(0x1c0)+_0x551b4a(0x1b8),[_0x336bb0]);}catch(_0x58142e){warn(_0x551b4a(0x14c)+_0x551b4a(0x105)+_0x551b4a(0x183)+(_0x58142e?.['message']||_0x58142e));}info(_0x551b4a(0x18e)+'ollups\x20com'+_0x551b4a(0x119));}catch(_0x288321){error(_0x288321,_0x551b4a(0x14c)+_0x551b4a(0x1fc)+_0x551b4a(0xfe)+':\x20'+(_0x288321?.[_0x551b4a(0x156)]||_0x288321));}}function parsePeriodArg(_0x10b784){const _0x40c486=_0x1cc0b1;if(!_0x10b784)return null;const _0x6a8268=String(_0x10b784)[_0x40c486(0x201)]()[_0x40c486(0x1f0)+'e']()[_0x40c486(0x1e0)](/^(\d+)\s*([dwmy])$/);if(!_0x6a8268)return null;return{'amount':Number(_0x6a8268[-0x44d+0x1522+-0x10d4]),'unit':_0x6a8268[-0x2*-0x503+-0x1214+0x810]};}function computeCutoffSeconds(_0xac469f,_0x227948){const _0x2eafe7=_0x1cc0b1,_0x53cad6=DateTime[_0x2eafe7(0x178)]()[_0x2eafe7(0x1b0)](CONFIG[_0x2eafe7(0x1ec)]);let _0x523715;if(_0x227948==='d')_0x523715=_0x53cad6[_0x2eafe7(0x20a)]({'days':_0xac469f});else{if(_0x227948==='w')_0x523715=_0x53cad6[_0x2eafe7(0x20a)]({'weeks':_0xac469f});else{if(_0x227948==='m')_0x523715=_0x53cad6[_0x2eafe7(0x20a)]({'months':_0xac469f});else{if(_0x227948==='y')_0x523715=_0x53cad6[_0x2eafe7(0x20a)]({'years':_0xac469f});else _0x523715=_0x53cad6[_0x2eafe7(0x20a)]({'days':_0xac469f});}}}return Math[_0x2eafe7(0x146)](_0x523715['toSeconds']());}async function buildLeaderboardForChat(_0x30d28b,_0x4a45f6,_0x42585e=CONFIG[_0x1cc0b1(0xcc)+_0x1cc0b1(0x1b4)]){const _0x1f9e7e=_0x1cc0b1;try{const _0x5cf57c=DateTime[_0x1f9e7e(0x18c)+'s'](_0x4a45f6)[_0x1f9e7e(0x1b0)](CONFIG[_0x1f9e7e(0x1ec)]),_0x2b4611=_0x5cf57c[_0x1f9e7e(0x180)](_0x1f9e7e(0x149)),_0x5b6fa8=await db[_0x1f9e7e(0x10f)]('\x0a\x20\x20\x20\x20\x20\x20SEL'+_0x1f9e7e(0x1e3)+_0x1f9e7e(0x198)+_0x1f9e7e(0xd9)+_0x1f9e7e(0x16d)+_0x1f9e7e(0x110)+_0x1f9e7e(0x113)+_0x1f9e7e(0x197)+_0x1f9e7e(0x102)+_0x1f9e7e(0x143)+_0x1f9e7e(0x16e)+_0x1f9e7e(0x121)+_0x1f9e7e(0x14b)+_0x1f9e7e(0x11e)+_0x1f9e7e(0x170)+'eframe\x20=\x20\x27'+_0x1f9e7e(0x1c4)+'\x20bucket_ke'+'y\x20>=\x20?\x0a\x20\x20\x20'+_0x1f9e7e(0x1fb)+_0x1f9e7e(0x164)+_0x1f9e7e(0x117),[_0x30d28b,_0x2b4611]),_0x5d00ef=new Map();for(const _0x327e1e of _0x5b6fa8||[]){const _0x580b80=normalizeJid(_0x327e1e[_0x1f9e7e(0x182)]);_0x5d00ef[_0x1f9e7e(0x1f5)](_0x580b80,{'user_jid':_0x580b80,'display_name':_0x327e1e['display_na'+'me']||_0x580b80['split']('@')[0x5*-0x26e+0x1db0+-0x118a],'count':Number(_0x327e1e[_0x1f9e7e(0xd3)]||-0x1f8e+0x14dc+-0x4a*-0x25),'last_ts':Number(_0x327e1e[_0x1f9e7e(0x150)]||0xb17*0x1+0x3c*-0x1f+-0x3d3)});}const _0x596d0c=await db[_0x1f9e7e(0x10f)](_0x1f9e7e(0xc8)+_0x1f9e7e(0x163)+'eframe,\x20bu'+'cket_key,\x20'+_0x1f9e7e(0xe7)+_0x1f9e7e(0x138)+_0x1f9e7e(0x17b)+'OM\x20active_'+_0x1f9e7e(0x169)+_0x1f9e7e(0x1d3)+_0x1f9e7e(0x20f)+_0x1f9e7e(0x189)+_0x1f9e7e(0x131)+'\x27,\x27monthly'+_0x1f9e7e(0x140)+')',[_0x30d28b]);for(const _0x51e413 of _0x596d0c||[]){let _0xc49c5c=![];try{if(_0x51e413['timeframe']===_0x1f9e7e(0xd8)){const _0x1c1b5b=String(_0x51e413[_0x1f9e7e(0x19e)]||'')[_0x1f9e7e(0x114)]('-'),_0x47b36d=Number(_0x1c1b5b[0xa4d*0x1+0x3f7+0x14c*-0xb])||0x187f+-0x220+0xdd*-0x11,_0x48bb36=Number(_0x1c1b5b[-0x1477+-0xc3e+0x9e*0x35])||-0x30c+-0x7*0x200+0x110d,_0x303e26=DateTime[_0x1f9e7e(0x1de)]({'weekYear':_0x47b36d,'weekNumber':_0x48bb36,'weekday':0x1},{'zone':CONFIG[_0x1f9e7e(0x1ec)]});if(_0x303e26['toSeconds']()>=_0x4a45f6)_0xc49c5c=!![];}else{if(_0x51e413[_0x1f9e7e(0x11f)]===_0x1f9e7e(0xd1)){const _0x1a3723=String(_0x51e413[_0x1f9e7e(0x19e)]||'')[_0x1f9e7e(0x114)]('-'),_0x349e0e=Number(_0x1a3723[-0x1f*0x67+-0x2655+-0x2*-0x1967])||-0x3e5*-0x1+-0xaa8+0xe75,_0x29b603=Number(_0x1a3723[-0x71*0x52+-0x91f+-0x1*-0x2d52])||-0x1625*0x1+0x25d8+0x7*-0x23e,_0x5b9330=DateTime[_0x1f9e7e(0x1de)]({'year':_0x349e0e,'month':_0x29b603,'day':0x1},{'zone':CONFIG[_0x1f9e7e(0x1ec)]});if(_0x5b9330[_0x1f9e7e(0x20e)]()>=_0x4a45f6)_0xc49c5c=!![];}else{if(_0x51e413[_0x1f9e7e(0x11f)]===_0x1f9e7e(0x134)){const _0x5df110=Number(String(_0x51e413[_0x1f9e7e(0x19e)]||'')[_0x1f9e7e(0x114)]('-')[-0x1940+-0x21*-0xe5+0x445*-0x1])||0x1456+-0x1be7+0xf43,_0x1a1682=DateTime[_0x1f9e7e(0x1de)]({'year':_0x5df110,'month':0x1,'day':0x1},{'zone':CONFIG[_0x1f9e7e(0x1ec)]});if(_0x1a1682[_0x1f9e7e(0x20e)]()>=_0x4a45f6)_0xc49c5c=!![];}else _0xc49c5c=!![];}}}catch(_0x3ad355){_0xc49c5c=!![];}if(!_0xc49c5c)continue;const _0x40cacf=normalizeJid(_0x51e413[_0x1f9e7e(0x182)]);if(!_0x5d00ef['has'](_0x40cacf))_0x5d00ef[_0x1f9e7e(0x1f5)](_0x40cacf,{'user_jid':_0x40cacf,'display_name':_0x51e413[_0x1f9e7e(0x1b7)+'me']||_0x40cacf[_0x1f9e7e(0x114)]('@')[-0x3*0x7b1+0x25d9+-0x2*0x763],'count':0x0,'last_ts':0x0});_0x5d00ef[_0x1f9e7e(0xde)](_0x40cacf)['count']+=Number(_0x51e413[_0x1f9e7e(0xe7)+_0x1f9e7e(0x154)]||-0x2131*-0x1+-0x2*-0x50d+-0x2b4b);}const _0x152380=Array[_0x1f9e7e(0x12c)](_0x5d00ef[_0x1f9e7e(0xcb)]())[_0x1f9e7e(0xd4)]((_0xcc68b1,_0x3687bf)=>_0x3687bf[_0x1f9e7e(0x1a6)]-_0xcc68b1[_0x1f9e7e(0x1a6)]||_0x3687bf['last_ts']-_0xcc68b1[_0x1f9e7e(0x150)]);return _0x152380['slice'](0x1d86+0x522*-0x2+-0x1342,_0x42585e);}catch(_0x4a03de){return warn(_0x1f9e7e(0x13b)+_0x1f9e7e(0x15b)+_0x1f9e7e(0x12e)+'r:\x20'+(_0x4a03de?.[_0x1f9e7e(0x156)]||_0x4a03de)),[];}}async function getGroupParticipants(_0x247406,_0xe34ff3){const _0x246a7e=_0x1cc0b1;try{if(!_0x247406||typeof _0x247406[_0x246a7e(0x212)+_0x246a7e(0x1c9)]!==_0x246a7e(0x15f))return[];const _0x3fb6d2=await _0x247406[_0x246a7e(0x212)+'ata'](_0xe34ff3),_0x4b5e77=Array[_0x246a7e(0x162)](_0x3fb6d2?.[_0x246a7e(0x1ab)+'ts'])?_0x3fb6d2[_0x246a7e(0x1ab)+'ts']:Object[_0x246a7e(0xcb)](_0x3fb6d2?.[_0x246a7e(0x1ab)+'ts']||{}),_0x332446=_0x4b5e77['map'](_0x272f5e=>_0x272f5e['id'])['filter'](Boolean)[_0x246a7e(0x1cb)](normalizeJid);return _0x332446;}catch(_0x1f31f2){return warn('[active]\x20g'+_0x246a7e(0x1e5)+_0x246a7e(0xe5)+'failed\x20for'+'\x20'+_0xe34ff3+':\x20'+(_0x1f31f2?.['message']||_0x1f31f2)),[];}}function _0x4b99(_0x1dddcf,_0x3b79db){const _0x3e8667=_0x2cc0();return _0x4b99=function(_0x4afaeb,_0x7f34fb){_0x4afaeb=_0x4afaeb-(0x1eea+0x1c85+-0x3aab);let _0x20aa70=_0x3e8667[_0x4afaeb];return _0x20aa70;},_0x4b99(_0x1dddcf,_0x3b79db);}export async function initialize(_0x234c84){const _0x152638=_0x1cc0b1;try{botRef=_0x234c84;if(botRef){if(typeof botRef[_0x152638(0x19c)+'e']===_0x152638(0x15f))sendApi=(_0xd1aaab,_0x178f91)=>botRef['sendMessag'+'e'](_0xd1aaab,_0x178f91);else{if(botRef[_0x152638(0x172)]&&typeof botRef[_0x152638(0x172)]['sendMessag'+'e']===_0x152638(0x15f))sendApi=(_0x81e87f,_0x3cbb4b)=>botRef[_0x152638(0x172)]['sendMessag'+'e'](_0x81e87f,_0x3cbb4b);else sendApi=null;}}try{const _0x7b6682=getConfig()||{};if(_0x7b6682[_0x152638(0x15e)]&&typeof _0x7b6682[_0x152638(0x15e)]===_0x152638(0x20c))CONFIG={...CONFIG,..._0x7b6682[_0x152638(0x15e)]};}catch(_0x4bf602){warn(_0x152638(0x141)+_0x152638(0x1df)+_0x152638(0xf4)+_0x152638(0x1cc)+(_0x4bf602?.[_0x152638(0x156)]||_0x4bf602));}await ensureSchema(),await performRollups(),info(_0x152638(0x1fd)+_0x152638(0x144));}catch(_0x1554d3){error(_0x1554d3,_0x152638(0x1fd)+_0x152638(0x174)+_0x152638(0x1ca)+(_0x1554d3?.['message']||_0x1554d3));throw _0x1554d3;}}export async function onMessage(_0x53b52c){const _0x1da5c8=_0x1cc0b1;try{await trackMessage(_0x53b52c);if(!_0x53b52c?.['isCommand'])return;const _0x5da2fc=_0x53b52c[_0x1da5c8(0x157)]?.[_0x1da5c8(0x10d)];if(!_0x5da2fc||!_0x5da2fc[_0x1da5c8(0x210)](_0x1da5c8(0xca)))return;const _0x32fdbc=await isadmin(botRef,_0x53b52c)[_0x1da5c8(0x1dd)](()=>![]);if(!_0x32fdbc)return;const _0xcb963c=typeof _0x53b52c[_0x1da5c8(0x101)]===_0x1da5c8(0x1c6)&&_0x53b52c[_0x1da5c8(0x101)][_0x1da5c8(0x201)]()?_0x53b52c[_0x1da5c8(0x101)][_0x1da5c8(0x201)]():'';if(!_0xcb963c)return;const _0x32b9a0=_0xcb963c[_0x1da5c8(0x114)](/\s+/)[_0x1da5c8(0x13a)](Boolean),_0x4fd2ee=_0x32b9a0[-0x46*-0x5e+0x1*-0x170d+-0x2a7][_0x1da5c8(0x1f0)+'e']();if(_0x4fd2ee!=='active'&&_0x4fd2ee!=='inactive')return;const _0x1b49e1=_0x32b9a0[-0x1c4*0xc+-0x1*-0xd55+0x2*0x3ee]||'1w';let _0x2121c6=parsePeriodArg(_0x1b49e1);if(!_0x2121c6){const _0x804a24=parseInt(_0x1b49e1,0xfb*0x6+-0x7c6*0x1+0x1ee);if(!isNaN(_0x804a24))_0x2121c6={'amount':_0x804a24,'unit':'d'};else{const _0x581adb='Usage:\x20act'+_0x1da5c8(0xe0)+'t><d|w|m|y'+_0x1da5c8(0x1fa)+_0x1da5c8(0x13e)+'unt><d|w|m'+_0x1da5c8(0x1b6)+'es:\x20active'+'\x201d,\x20activ'+_0x1da5c8(0x167)+'tive\x207d';try{await sendApi(_0x5da2fc,{'text':_0x581adb});}catch(_0x441621){warn('[active]\x20s'+_0x1da5c8(0x152)+_0x1da5c8(0x1ca)+(_0x441621?.['message']||_0x441621));}return;}}try{await performRollups();}catch(_0x39522f){}const _0x2d612d=computeCutoffSeconds(_0x2121c6[_0x1da5c8(0xf6)],_0x2121c6[_0x1da5c8(0x188)]);if(_0x4fd2ee==='active'){const _0x31db80=await buildLeaderboardForChat(_0x5da2fc,_0x2d612d,CONFIG[_0x1da5c8(0xcc)+_0x1da5c8(0x1b4)]);if(!_0x31db80||_0x31db80[_0x1da5c8(0x179)]===-0x7d*0x25+0x34e+0xec3*0x1){await sendApi(_0x5da2fc,{'text':_0x1da5c8(0xe8)+'members\x20fo'+_0x1da5c8(0x1a9)+_0x1da5c8(0x199)+_0x2121c6[_0x1da5c8(0xf6)]+_0x2121c6[_0x1da5c8(0x188)]+'.'});return;}let _0x34d27d=_0x1da5c8(0x17e)+_0x31db80[_0x1da5c8(0x179)]+(_0x1da5c8(0x130)+_0x1da5c8(0xdf)+_0x1da5c8(0x199))+_0x2121c6[_0x1da5c8(0xf6)]+_0x2121c6[_0x1da5c8(0x188)]+_0x1da5c8(0x161);const _0x971f21=[];let _0x3a9072=0x473+0x110*-0x1c+0x194d;for(const _0x1cd5f1 of _0x31db80){_0x3a9072++;const _0x9eaa95=_0x1cd5f1[_0x1da5c8(0x182)][_0x1da5c8(0x114)]('@')[0x8*0x3c3+-0x4b*0xb+0x3*-0x8f5];_0x34d27d+=_0x1da5c8(0x107)+_0x9eaa95+'\x20('+(_0x1cd5f1[_0x1da5c8(0x1b7)+'me']||_0x9eaa95)+')\x0a',_0x34d27d+=romanParen(_0x3a9072)+'\x20'+_0x1cd5f1['count']+(_0x1da5c8(0x1cf)+'\x0a'),_0x971f21[_0x1da5c8(0x19b)](_0x1cd5f1[_0x1da5c8(0x182)]);}const _0x49352d=0x871+-0x8d*-0x29+-0xf66;if(_0x34d27d[_0x1da5c8(0x179)]<=_0x49352d)await sendApi(_0x5da2fc,{'text':_0x34d27d,'mentions':_0x971f21});else{const _0x219e9f=_0x34d27d['split']('\x0a\x0a');let _0x23889a='';for(const _0x24726f of _0x219e9f){if((_0x23889a+'\x0a\x0a'+_0x24726f)[_0x1da5c8(0x179)]>_0x49352d)await sendApi(_0x5da2fc,{'text':_0x23889a,'mentions':_0x971f21}),_0x23889a=_0x24726f+'\x0a\x0a';else _0x23889a+=(_0x23889a?'\x0a\x0a':'')+_0x24726f;}if(_0x23889a[_0x1da5c8(0x201)]())await sendApi(_0x5da2fc,{'text':_0x23889a,'mentions':_0x971f21});}return;}if(_0x4fd2ee===_0x1da5c8(0x19d)){const _0x568c2e=botRef?.[_0x1da5c8(0x172)]||botRef,_0x3f18ca=await getGroupParticipants(_0x568c2e,_0x5da2fc);if(!_0x3f18ca||_0x3f18ca[_0x1da5c8(0x179)]===0x19be+-0xa*-0xfa+-0x38d*0xa){await sendApi(_0x5da2fc,{'text':_0x1da5c8(0x135)+_0x1da5c8(0x1b9)+'group\x20part'+'icipants.'});return;}const _0x467cf6=await buildLeaderboardForChat(_0x5da2fc,_0x2d612d,-0x9d51b+-0x1b1cd9+-0x13c5*-0x2a4),_0xcac83a=new Set((_0x467cf6||[])[_0x1da5c8(0x1cb)](_0x1b2eab=>normalizeJid(_0x1b2eab[_0x1da5c8(0x182)]))),_0x25edf7=_0x3f18ca[_0x1da5c8(0x13a)](_0xb911bd=>!_0xcac83a[_0x1da5c8(0x14e)](normalizeJid(_0xb911bd)));if(!_0x25edf7[_0x1da5c8(0x179)]){await sendApi(_0x5da2fc,{'text':_0x1da5c8(0x1d0)+'e\x20members\x20'+'found\x20in\x20t'+'he\x20last\x20'+_0x2121c6[_0x1da5c8(0xf6)]+_0x2121c6[_0x1da5c8(0x188)]+'.'});return;}let _0x342626='Found\x20'+_0x25edf7[_0x1da5c8(0x179)]+(_0x1da5c8(0x155)+_0x1da5c8(0xe3)+_0x1da5c8(0x10c))+_0x2121c6[_0x1da5c8(0xf6)]+_0x2121c6[_0x1da5c8(0x188)]+_0x1da5c8(0x161);const _0x2d51e9=[];let _0x1f1f6b=-0x7*-0x4cd+-0x5d*-0x19+-0x2ab0;for(const _0x560bdf of _0x25edf7){_0x1f1f6b++;const _0x3fcb0d=_0x560bdf[_0x1da5c8(0x114)]('@')[0x1a35*0x1+-0x25c1+0xb8c];_0x342626+=_0x1da5c8(0x107)+_0x3fcb0d+'\x20('+_0x3fcb0d+')\x0a',_0x342626+=romanParen(_0x1f1f6b)+(_0x1da5c8(0x1fe)+_0x1da5c8(0x12d)),_0x2d51e9['push'](_0x560bdf);}await sendApi(_0x5da2fc,{'text':_0x342626,'mentions':_0x2d51e9});return;}}catch(_0x31692a){error(_0x31692a,_0x1da5c8(0x176)+'nMessage\x20f'+_0x1da5c8(0xff)+(_0x31692a?.['message']||_0x31692a));}}export async function cleanup(){const _0xa91c3d=_0x1cc0b1;try{for(const _0x442f9f of processedMessageKeys['values']())try{clearTimeout(_0x442f9f);}catch(_0x2b9efa){}processedMessageKeys[_0xa91c3d(0x1c7)]();}catch(_0xd727f1){}botRef=null,sendApi=null,info('[active]\x20c'+'leaned\x20up');}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};function _0x2cc0(){const _0x42ae0f=['ekly\x27','ast_update','id,\x20displa','\x20last\x20','t_updated\x20','push','sendMessag','inactive','bucket_key','?,\x20?,\x20\x27wee','e\x20DB\x20error','_jid,\x20time','\x20\x20\x20VALUES\x20','\x20TEXT\x20PRIM','unt\x20+\x20?,\x20d','stats\x20(cha','count','key\x20=\x20?\x20LI','id\x20=\x20?\x20AND','und\x20in\x20the','_count,\x20di','participan','ay_name,\x20l','ow\x27)),\x0a\x20\x20\x20','IF\x20NOT\x20EXI','chat_jid','setZone','d)\x0a\x20\x20\x20\x20\x20\x20\x20','EX\x20IF\x20NOT\x20','\x20\x27daily\x27\x20A','T_RETURN','ats_chat_u','|y>\x0aExampl','display_na','t_key\x20<=\x20?','determine\x20','MAX_DAILY_','eframe\x20TEX','senderName','182KZawBc','MM,\x20yearly','1856876RWoONc','\x20AND\x20bucke','rd_message','D\x20user_jid','e_count\x20=\x20','daily\x27\x20AND','\x20INSERT\x20IN','string','clear',',\x20user_jid','ata','failed:\x20','map','.ACTIVE:\x20','ount\x20=\x20mes','_leaderboa','\x20messages\x0a','No\x20inactiv','tats\x20WHERE','ATE\x20TABLE\x20','E\x20chat_jid','1545XYpCPZ','\x20chat_jid,','\x0a\x20\x20\x20\x20\x20\x20CRE','ive_stats\x20','UPDATE\x20act','join','ROLLOVER_T','\x20\x20\x20\x20\x20\x20\x20id\x20',',\x20?,\x20?)','catch','fromObject','ailed\x20to\x20r','match','frame,\x20buc','_stats\x20(\x0a\x20','ECT\x20user_j','e,\x20bucket_','etGroupPar','\x20bucket_ke','ket_key,\x20m','\x20\x20\x20\x20\x20user_',';\x0a\x20\x20\x20\x20','ucket_key\x20','SELECT\x20id\x20','TIME_ZONE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','chat_jid,\x20','AUTOINCREM','toLowerCas','rame\x20=\x20\x27we','e\x20=\x20?,\x20las','pushName',',\x20?,\x20?)\x0a\x20\x20','set','f\x20ON\x20activ','fromMe','Y-MM-DD,\x20w','y_name,\x20la','>\x20\x20OR\x20\x20ina','\x20\x20\x20GROUP\x20B','erformRoll','[active]\x20i','\x20no\x20messag','jid\x20TEXT\x20N','\x20NULL,\x0a\x20\x20\x20','trim','monthly\x27|\x27','95DEuxTv','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','LT\x20(strfti','863584XHWOjp','eframe,\x20bu','\x20user_jid,','\x20\x20\x20\x20\x20UNIQU','minus','user_jid);','object','9tlCuBz','toSeconds','\x20=\x20?\x20AND\x20t','endsWith','isplay_nam','groupMetad','\x20\x20\x20\x20','ve_stats\x20W','thly\x27,\x20?,\x20','delete','at_jid,\x20ti','SELECT\x20use','EXT\x20DEFAUL','@g.us','values','USERS_LIMI','splay_name','AULT\x200,\x0a\x20\x20','y,\x20message','\x20\x20\x20\x20\x20\x20buck','monthly','month','cnt','sort','rame\x20=\x20\x27da','CREATE\x20IND','padStart','weekly','y_name,\x20SU','M\x20active_s','d\x20TEXT\x20NOT','pdated\x20=\x20?','tats\x20(chat','get','ers\x20in\x20the','ive\x20<amoun','exec','a\x20failed','members\x20in','HERE\x20timef','ticipants\x20','[active]\x20s','message_co','No\x20active\x20','kly\x27,\x20?,\x20?',':\x20YYYY\x0a\x20\x20\x20','NTEGER\x20DEF','rly\x27,\x20?,\x20?','?,\x20?,\x20\x27mon','EXISTS\x20act','?,\x20?,\x20\x27yea','day','\x20=\x20\x27daily\x27','lay_name\x20=','e_stats\x20WH','ead\x20config','SET\x20messag','amount','STS\x20active','||monthly|','ND\x20bucket_','?,\x20?,\x20?)','T\x20NOT\x20NULL','\x20id\x20IN\x20(','32052aVBpma','ups\x20failed','ailed:\x20',',\x20\x20\x20\x20\x20\x20\x20\x20-','text','d)\x20AS\x20last','\x27yearly\x27\x20A','essage_cou','rune\x20daily','\x20);\x0a\x20\x20\x20\x20','👤\x20@','O_MONTH_DA','ions\x20(vers','=\x20?\x20WHERE\x20','KEEP_DAYS','\x20the\x20last\x20','remoteJid','MIT\x201','all','count)\x20AS\x20','rackMessag','lay_name\x20T','cnt,\x20MAX(l','split','e_stats(ch','slice','\x0a\x20\x20\x20\x20','_jid,\x20user','plete','eekly:\x20YYY','ERE\x20chat_j','changes','INSERT\x20INT','chat_jid\x20=','timeframe','O_WEEK_DAY','e_stats\x0a\x20\x20','s\x20(\x0a\x20\x20\x20\x20\x20\x20','active','chema\x20ensu','me(\x27%s\x27,\x27n','DELETE\x20FRO','Y-WW,\x20mont','e\x20unexpect','ow\x27)));','\x20user_jid\x20','EXISTS\x20idx','from','es\x0a\x0a','board\x20erro','ucket_key)','\x20active\x20us','N\x20(\x27weekly','LE\x20IF\x20NOT\x20','ats_chat_t','yearly','Could\x20not\x20','\x27weekly\x27\x20A','R\x20PRIMARY\x20','unt,\x20displ',')\x20VALUES\x20(','filter','[active]\x20b','startOf','jid\x20=\x20?\x20AN','ctive\x20<amo','_active_st','\x27,\x27yearly\x27','[active]\x20f','fromFormat','_ts\x0a\x20\x20\x20\x20\x20\x20','nitialized','nsureSchem','floor','DEDUPE_TTL','-\x20\x27daily\x27|','yyyy-LL-dd','1.1.1','\x20\x20\x20\x20WHERE\x20','[active]\x20p','\x20\x20\x20chat_ji','has','elete\x20old\x20','last_ts','ily\x27,\x20?,\x201','end\x20usage\x20','sage_count','unt','\x20inactive\x20','message','key','ily\x27\x20AND\x20b','hly:\x20YYYY-','ted_at\x20INT','uildLeader','91458ngapFR','\x20FROM\x20acti','ACTIVE','function','1379790XVdiEK',':\x0a\x0a','isArray','r_jid,\x20tim','Y\x20user_jid','nt,\x20displa','weekNumber','e\x201w,\x20inac','\x20\x20\x20\x20\x20\x20\x20tim','stats\x20WHER','pdated\x20INT','HERE\x20chat_','ser\x20ON\x20act','M(message_','FROM\x20activ','year','\x20?\x20AND\x20tim','\x20\x20\x20\x20\x20\x20','sock','<=\x20?','nitialize\x20','st_updated','[active]\x20o','\x20\x20chat_jid','now','length','\x20\x20\x20\x20\x20\x20disp','ay_name\x20FR','4469430qPYoyb','\x20message_c','Found\x20','ARY\x20KEY,\x0a\x20','toFormat','=\x20?\x20AND\x20ti','user_jid','\x20failed:\x20','O\x20active_s','SELECT\x20id,','sourceIds','imeframe\x20=','unit','imeframe\x20I','ion\x20INTEGE','meframe\x20=\x20','fromSecond','t_jid,\x20use','[active]\x20r','id\x20=\x20?','red','O_YEAR_DAY','run','daily\x20rows',',\x20timefram','UTC'];_0x2cc0=function(){return _0x42ae0f;};return _0x2cc0();}