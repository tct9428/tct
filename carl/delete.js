const _0x4a5ad8=_0xb2c8;(function(_0x2c2810,_0x4b9325){const _0x35deb4=_0xb2c8,_0x910559=_0x2c2810();while(!![]){try{const _0x597a4a=parseInt(_0x35deb4(0x372))/(-0x23d2+0x6cd*0x1+0x1d06)*(parseInt(_0x35deb4(0x306))/(0x2501+-0xbc*-0xb+0xb*-0x419))+-parseInt(_0x35deb4(0x208))/(-0x14f*-0x1+-0x2398+0x6dc*0x5)+-parseInt(_0x35deb4(0x35f))/(-0x18e3*-0x1+0x18a4*-0x1+-0x3b)*(parseInt(_0x35deb4(0x364))/(-0x1832+0x2*0x1223+-0xc0f))+-parseInt(_0x35deb4(0x1d9))/(0xd7f+-0xcb6+-0xc3)+-parseInt(_0x35deb4(0x2ff))/(-0x800*0x2+0xfa5+0x7*0xe)*(-parseInt(_0x35deb4(0x1e6))/(0x805+0x173*-0x1+-0x68a))+-parseInt(_0x35deb4(0x387))/(-0x1b74*-0x1+-0x18ca+-0x1*0x2a1)*(-parseInt(_0x35deb4(0x34a))/(0x1*0x1d53+-0x12a9+-0x154*0x8))+parseInt(_0x35deb4(0x326))/(0x7d*-0x28+0x1318+-0x3*-0x29);if(_0x597a4a===_0x4b9325)break;else _0x910559['push'](_0x910559['shift']());}catch(_0x238187){_0x910559['push'](_0x910559['shift']());}}}(_0x477b,-0x3b759+0x122d1*-0x8+0x1257df*0x1));import _0x31db23 from'path';import _0x173ad1 from'fs/promises';import{createWriteStream}from'fs';import{pipeline}from'stream/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import _0x1d339d from'node-cache';import{isSudo}from'../utils/sudo.js';import{getBotJid,getBotJidRaw}from'../utils/bot-state.js';export const name=_0x4a5ad8(0x334)+_0x4a5ad8(0x29a);export const version=_0x4a5ad8(0x37d);export const priority=0x1be*-0x9+-0x26ae+-0x2*-0x1b47;export const commands=[_0x4a5ad8(0x1e7)];export const configKeys=[_0x4a5ad8(0x2e4)+_0x4a5ad8(0x2ec),_0x4a5ad8(0x33b)+_0x4a5ad8(0x367),_0x4a5ad8(0x357)+_0x4a5ad8(0x2f7),_0x4a5ad8(0x26b)+_0x4a5ad8(0x376),_0x4a5ad8(0x2de)+_0x4a5ad8(0x24c),_0x4a5ad8(0x2de)+_0x4a5ad8(0x2a5)+_0x4a5ad8(0x235),_0x4a5ad8(0x2f2)+_0x4a5ad8(0x2bc)+'E'];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':'media','DEFAULT_CONCURRENCY':0x2,'CLEANUP_INTERVAL_MS':(0x1f04+0x1*-0x1547+-0x33d*0x3)*(-0xc94*0x2+-0x158c+0x10*0x2ef)*(-0x1*0x247d+-0x1*-0x5fe+0x1ebb)*(0x1*-0x103f+-0x6*-0x3bc+-0x241),'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'CLEANUP_DAYS':0x3,'QUEUE_MAX_SIZE':0x1f4};let botRef=null,cleanupInterval=null;const messageQueue=[],deletionQueue=[];let activeMessageTasks=0x746*-0x3+-0x2b*-0xcc+-0x213*0x6,activeDeletionTasks=0xa3*0x38+-0x1*0x170f+0x1*-0xc99,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS[_0x4a5ad8(0x256)+'S'],CONCURRENCY=FALLBACKS[_0x4a5ad8(0x35d)+_0x4a5ad8(0x1de)],MEDIA_SEND_DELAY_MS=FALLBACKS[_0x4a5ad8(0x248)+_0x4a5ad8(0x1ed)],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_IN'+'TERVAL_MS'],MAX_SEND_RETRIES=FALLBACKS[_0x4a5ad8(0x2a3)+_0x4a5ad8(0x2dc)],INITIAL_BACKOFF=FALLBACKS[_0x4a5ad8(0x2eb)+_0x4a5ad8(0x1e0)],DELETE_CLEANUP_DAYS=FALLBACKS[_0x4a5ad8(0x220)+'YS'],QUEUE_MAX_SIZE=FALLBACKS[_0x4a5ad8(0x30e)+_0x4a5ad8(0x31e)],DEFAULT_SEND_DELETE=![],DELETE_MODE='p',TARGET_JID=null;const nameCache=new _0x1d339d({'stdTTL':0xe10});function _0x477b(){const _0x2659d4=['ecovered\x20o','\x20WHERE\x20msg','json,\x20time','dMessagesS','1441977qqxfep','sender','_id\x20IN\x20(','ia\x20for\x20','eleteMessa','nsureTable','is\x20set.','\x20PM.','essages\x27)','content','onWhatsApp','poll','\x20send\x20reco','E\x20messages','now','id>\x20\x20\x20\x20\x20->','?,\x20?,\x20?,\x20?','*Delete\x20Re','dia\x20error:','key','\x20saved_at\x20','INSERT\x20OR\x20','dMessages\x20','unset','CLEANUP_DA','[Sticker]','tionItem\x20e','TEXT','CURRENCY_L','audio','t\x20JID.','cipant_alt','d\x20retry','notify','keys','boolean','\x20than\x20','ll\x20(','message','ocessing\x20q','ed\x20due\x20mis','alse\x20â€”\x20ski','stat','es\x20bot\x20arg','g\x20deletion','VAL_MS','remove','ave\x20target','\x20value,\x20up','[Delete]\x20h','code','caption','saved:\x20','ia_path,\x20s','ia_path\x20FR','nfig\x20regis','includes','COVERED*\x20ðŸ—‘','Active:\x20*','\x20?,\x20?,\x20?,\x20','LE\x20IF\x20NOT\x20','ToFile\x20fai','d_at\x20IS\x20NO','\x20failed:\x20','MEDIA_SEND','.updated_a','\x20days)','\x20ADD\x20COLUM','ANUP_DAYS','\x20deleting.','ed_at=excl','lue,\x20updat','\x20\x20\x20\x20\x20\x20\x20VAL','led\x20for\x20','d\x20unexpect','ule\x20requir','Message','videoMessa','DEBOUNCE_M','remoteJidA','zation\x20fai','MEDIA_DIRN','isCommand','\x20WHERE\x20key','fromMe','D_DELETE\x20f','nitialized','extendedTe','le_info(\x27m','t\x20group\x20JI','psert','failed\x20for','PROJECT_RO','sendMessag','endsWith','ge_json,\x20m','[Poll:\x20','load\x20faile','\x20DELETED\x20M','DEFAULT_SE','ded.value,','DELETE\x20FRO','eletion\x20pr','length','VALUES\x20(\x27m','jpg','UES\x20(?,\x20?,','sages\x20row:','cwd','xcluded.va','name','ðŸ—¨\x20Group:\x20','status','[Delete]\x20c','ges\x20(older','nMessage\x20e','shift','mp4','ble','aveDeleteT','ummary\x20sen','bin','CLEANUP_IN','R\x20DEFAULT\x20','[Delete]\x20H','function','RAGMA\x20tabl','[delete]\x20F','webp','size','conversati','No\x20target\x20','catch','DATE\x20SET\x20v','saved_at','[Delete]\x20t','ode\x20failed','_id=?','map','GROUP\x20(','join','esent_at)\x0a','r:\x20',',\x20?)','lear\x20targe','mkdir','overy','_at\x20INTEGE','uded.updat','awMessages','=\x27target_j','[Delete]\x20n','not\x20found\x20','tatus:*\x0a','or:\x20','MAX_SEND_R','ue\x20FROM\x20de','ANUP_INTER','dded\x20missi','\x20delete\x20<j','[Delete]\x20p','tration\x20fa','text','ig\x20error:\x20','delete\x20mod','\x20(all\x20atte','d).\x20Leavin','sage','egacy\x20forw','IA_SEND_DE','nsert\x20fail','mpts\x20faile','leaning\x20','[Delete]\x20r','\x20â€”\x20ensurin','er\x20item\x20er','ode\x20set\x20to','group','mediaPath','T\x20NULL\x20AND','UE_MAX_SIZ','jid,\x20parti','estamp','parse','aveDeleteM','emove\x20file','t=excluded','_id,\x20media','[Delete]\x20P','refs\x20WHERE','type','CREATE\x20TAB','[Delete]\x20a','led:\x20','[Unknown\x20G','AME','adcast','jid','indexOf','dated_at)\x20','arget\x20JID\x20','O\x20delete_p','nitial\x20cle','Configured','at\x20path:\x20','exec','g\x20in\x20DB\x20fo','value','d:\x20','TIAL_BACKO',',\x20Cleanup\x20','[delete]\x20M','ETRIES','pdf','DELETE_CLE','e_info\x20fai','media_path','ptt','run','resolve','DELETE_MED','[Delete]\x20D','arget_jid\x20','FROM\x20messa','ssing\x20key.','[delete]\x20T','r\x20later\x20re','INITIAL_BA','IA_DIRNAME','ata','eletionWor','covery\x20Set','FF_MS','set','DELETE_QUE','slice','participan','ageItem\x20er','DELETE_INI','CURRENCY','splice','rocessDele','mimetype','etchOrigin','annot\x20dete','MARY\x20KEY,\x0a','M\x20messages','70tphGGG','edia_path,','low','stringify','e\x20TEXT\x20NOT','y:\x20','pollCreati','142aJLpaY','edia\x20send\x20','basename','iled:\x20','ssage','group\x20JID\x20','get\x20availa','[Voice\x20not','QUEUE_MAX_','_path,\x20sav','item\x20error','group\x20\x20\x20->','able','B\x20initiali','IES','ror:\x20','INSERT\x20INT','mapping\x20fa','REPLACE\x20IN','\x20days*','leanup\x20com','edia\x20file\x20','ener','ptvMessage','SIZE','o\x20send\x20tar','image','t,\x20sender_','utoCleanOl','anup\x20error','status@bro','y\x20TEXT\x20PRI','6984208dCocUA','g_id=?','[Delete]\x20s','removeList','isArray','\x20messages\x20','\x0a);','lete_prefs','sing\x20colum','n:\x20','TERVAL_MS','object','[Audio]','\x20NULL,\x0a\x20\x20\x20','delete-rec','(no-id)','nsertMessa','pm\x20\x20\x20\x20\x20\x20->','ICT(key)\x20D','SELECT\x20med','ot-reloade','DELETE_DEB','ed_at\x20FROM','O\x20UPDATE\x20S','nable\x20to\x20d','INTEGER','sages\x20(\x0a\x20\x20','has\x20no\x20col','\x20\x20\x20updated','\x20remote_al','[Delete]\x20f','ode\x20saved:','SELECT\x20msg','ðŸ—‘\x20*','led\x20fatall','get','210bDZqBm','_SEND_RETR','SELECT\x20val','find','string','seconds','and\x20reply\x20',').\x20Droppin','plete.','geRow\x20erro','documentMe','[Delete]\x20d','messageTim','DELETE_CON','get\x20group\x20','access','\x20Cleanup\x20A','audioMessa','<\x20?','DEFAULT_CO','ting\x20file\x20','8pQQICc','ng\x20column\x20','data','\x20clear\x20tar','Usage:\x0a','815985DYWUoY','messages.u','push','OUNCE_MS','filter','geToDB\x20fai','[Delete]\x20M','has','MODULE_CON','groupMetad','\x20CONFLICT(','d\x20config.','clear','g\x20incoming','3274Zhdunx','end\x20attemp','stamp,\x20med','riginal\x20fo','ND_DELETE','RY\x20KEY','[Delete]\x20l','[Delete]\x20I','all','\x20is\x20empty,','msg_id','5.2.0','msg_id=?',':\x20*','originalMe','pop','eleted\x20mes','aybeSaveMe','\x20delete\x20cl','et_jid\x27','sock','176859IHDRdS','geToDB:\x20mi','imageMessa','sticker','repeat','roup]','t\x20failed:\x20','[Delete]\x20o','\x20event.','vered\x20send','[Delete]\x20m','g\x20table\x20an','dd\x20column\x20','eliver\x20med','s\x20WHERE\x20ms','vered\x20to\x20b',',\x20?,\x20?)\x20ON','rror:\x20','[Delete]\x20e','ete_prefs\x20','[Delete]\x20C','arget\x20fail','ear\x20\x20\x20\x20\x20->','otReloadCo','DELETE_MAX','umn','floor','\x20delete\x20p|','ecovered\x20m','2557704TvFTVU','fileName','afe\x20error:','ot\x20PM\x0a','[Delete]\x20i','NCURRENCY','lushRecove','CKOFF_MS','alMessage\x20','ueue\x20is\x20fu','not\x20set','\x20group:\x20','arget_jid\x27','253032ejcNTk','delete','leanup\x20err','\x20Send\x20Mode','refs\x20(key,','xtMessage','key)\x20DO\x20UP','_DELAY_MS','OM\x20message','\x20set\x20targe','.\x20Mode:\x20','[Delete]\x20u','remoteJid','\x20key=\x27targ','etry\x20inser','ptv','vered\x20to\x20a','@lid','\x20->\x20','\x20top\x20error','\x20\x20\x20\x20\x20\x20valu','toLowerCas','tings\x20(PM-','split','messages.','\x20full\x20(','\x20chat_jid,','LAY_MS','treamMedia','stickerMes'];_0x477b=function(){return _0x2659d4;};return _0x477b();}let flushTimer=null;const pendingRecovered=[];async function ensureDir(_0xaa9b42){const _0x25aab3=_0x4a5ad8;try{await _0x173ad1[_0x25aab3(0x359)](_0xaa9b42);}catch(_0x8be37f){if(_0x8be37f[_0x25aab3(0x23a)]==='ENOENT')await _0x173ad1[_0x25aab3(0x299)](_0xaa9b42,{'recursive':!![]});else throw _0x8be37f;}}function sleep(_0x28665e){return new Promise(_0x2d86f0=>setTimeout(_0x2d86f0,_0x28665e));}function normalizeToUserJid(_0x227fee){const _0x31f7f9=_0x4a5ad8;try{if(!_0x227fee||typeof _0x227fee!==_0x31f7f9(0x34e))return _0x227fee;const _0x58da66=_0x227fee[_0x31f7f9(0x2ce)]('@');if(_0x58da66===-(-0x2253+-0x1d3*-0x7+0x158f))return _0x227fee;const _0x2be1f0=_0x227fee[_0x31f7f9(0x2f3)](0x15*-0x1bb+-0x630+0x13*0x23d,_0x58da66),_0x1646b3=_0x227fee['slice'](_0x58da66),_0x3c56f2=_0x2be1f0[_0x31f7f9(0x2ce)](':');if(_0x3c56f2===-(0x283*0x4+-0x1169+-0x1*-0x75e))return _0x227fee;return _0x2be1f0[_0x31f7f9(0x2f3)](-0x12d1*0x2+0x1d2a+-0x2*-0x43c,_0x3c56f2)+_0x1646b3;}catch(_0x3bf491){return _0x227fee;}}async function refreshConfig(){const _0x3b7a37=_0x4a5ad8;try{const _0x10afd1=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x10afd1['DEFAULT_SE'+_0x3b7a37(0x376)]===_0x3b7a37(0x22b)?_0x10afd1[_0x3b7a37(0x26b)+'ND_DELETE']:DEFAULT_SEND_DELETE,DEBOUNCE_DELAY_MS=Number(_0x10afd1[_0x3b7a37(0x33b)+'OUNCE_MS']??FALLBACKS[_0x3b7a37(0x256)+'S']),CONCURRENCY=Number(_0x10afd1[_0x3b7a37(0x357)+_0x3b7a37(0x2f7)]??_0x10afd1[_0x3b7a37(0x36c)+_0x3b7a37(0x224)+'IMIT']??FALLBACKS[_0x3b7a37(0x35d)+'NCURRENCY']),MEDIA_SEND_DELAY_MS=Number(_0x10afd1[_0x3b7a37(0x2e4)+_0x3b7a37(0x2b1)+_0x3b7a37(0x201)]??FALLBACKS['MEDIA_SEND'+_0x3b7a37(0x1ed)]),CLEANUP_INTERVAL=Number(_0x10afd1['DELETE_CLE'+_0x3b7a37(0x2a5)+_0x3b7a37(0x235)]??FALLBACKS['CLEANUP_IN'+'TERVAL_MS']),MAX_SEND_RETRIES=Number(_0x10afd1[_0x3b7a37(0x1d4)+_0x3b7a37(0x34b)+_0x3b7a37(0x314)]??FALLBACKS[_0x3b7a37(0x2a3)+'ETRIES']),INITIAL_BACKOFF=Number(_0x10afd1[_0x3b7a37(0x2f6)+_0x3b7a37(0x2d9)+_0x3b7a37(0x2f0)]??FALLBACKS['INITIAL_BA'+'CKOFF_MS']),DELETE_CLEANUP_DAYS=Number(_0x10afd1[_0x3b7a37(0x2de)+_0x3b7a37(0x24c)]??FALLBACKS[_0x3b7a37(0x220)+'YS']),QUEUE_MAX_SIZE=Number(_0x10afd1[_0x3b7a37(0x2f2)+_0x3b7a37(0x2bc)+'E']??FALLBACKS['QUEUE_MAX_'+_0x3b7a37(0x31e)]);const _0x48da86=_0x10afd1['PROJECT_RO'+'OT']&&typeof _0x10afd1[_0x3b7a37(0x264)+'OT']===_0x3b7a37(0x34e)?_0x10afd1['PROJECT_RO'+'OT']:process[_0x3b7a37(0x274)](),_0xa09928=_0x31db23[_0x3b7a37(0x2e3)](_0x48da86,_0x3b7a37(0x361),_0x3b7a37(0x1e7));await ensureDir(_0xa09928),MEDIA_DIR=_0x31db23[_0x3b7a37(0x294)](_0xa09928,_0x10afd1['DELETE_MED'+'IA_DIRNAME']??_0x10afd1[_0x3b7a37(0x2e4)+'IA_DIR']??FALLBACKS[_0x3b7a37(0x259)+_0x3b7a37(0x2cb)]),await ensureDir(MEDIA_DIR);}catch(_0x411425){warn(_0x3b7a37(0x2b5)+'efreshConf'+_0x3b7a37(0x2ab)+(_0x411425?.[_0x3b7a37(0x22e)]||_0x411425));}}try{hotReloadConfig&&hotReloadConfig(()=>{const _0xb46b27=_0x4a5ad8;refreshConfig(),info(_0xb46b27(0x284)+_0xb46b27(0x33a)+_0xb46b27(0x36f));});}catch(_0x419d2d){warn(_0x4a5ad8(0x239)+_0x4a5ad8(0x1d3)+_0x4a5ad8(0x23f)+_0x4a5ad8(0x2a9)+_0x4a5ad8(0x309)+(_0x419d2d?.['message']||_0x419d2d));}refreshConfig();const MESSAGES_COLUMNS={'msg_id':'TEXT\x20PRIMA'+_0x4a5ad8(0x377),'chat_jid':_0x4a5ad8(0x223),'remote_alt':_0x4a5ad8(0x223),'sender_jid':_0x4a5ad8(0x223),'participant_alt':_0x4a5ad8(0x223),'message_json':_0x4a5ad8(0x223),'timestamp':_0x4a5ad8(0x33f),'media_path':_0x4a5ad8(0x223),'saved_at':_0x4a5ad8(0x33f),'resent_at':'INTEGER'};async function ensureTable(){const _0x2acdfd=_0x4a5ad8;try{const _0x53f32b=Object['entries'](MESSAGES_COLUMNS)['map'](([_0x435984,_0x46daeb])=>_0x435984+'\x20'+_0x46daeb)[_0x2acdfd(0x294)](',\x0a\x20\x20');await db[_0x2acdfd(0x2d5)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20mes'+_0x2acdfd(0x340)+_0x53f32b+_0x2acdfd(0x32c));let _0x5edb56=[];try{const _0x30ca30=await db[_0x2acdfd(0x37a)]('PRAGMA\x20tab'+_0x2acdfd(0x260)+_0x2acdfd(0x210));_0x5edb56=(_0x30ca30||[])['map'](_0x365a05=>_0x365a05[_0x2acdfd(0x276)]);}catch(_0x3b35d1){warn(_0x2acdfd(0x2c4)+_0x2acdfd(0x286)+_0x2acdfd(0x2df)+_0x2acdfd(0x2c9)+(_0x3b35d1?.[_0x2acdfd(0x22e)]||_0x3b35d1));}for(const _0x202be9 of Object['keys'](MESSAGES_COLUMNS)){if(!_0x5edb56[_0x2acdfd(0x240)](_0x202be9)){const _0x11df8d=MESSAGES_COLUMNS[_0x202be9];try{await db['run']('ALTER\x20TABL'+_0x2acdfd(0x215)+_0x2acdfd(0x24b)+'N\x20'+_0x202be9+'\x20'+_0x11df8d),info(_0x2acdfd(0x2c8)+_0x2acdfd(0x2a6)+_0x2acdfd(0x360)+_0x2acdfd(0x1fe)+_0x202be9);}catch(_0x359752){warn(_0x2acdfd(0x344)+'ailed\x20to\x20a'+_0x2acdfd(0x1c8)+_0x202be9+':\x20'+(_0x359752?.[_0x2acdfd(0x22e)]||_0x359752));}}}await db[_0x2acdfd(0x2d5)](_0x2acdfd(0x2c7)+_0x2acdfd(0x244)+'EXISTS\x20del'+_0x2acdfd(0x1cf)+'(\x0a\x20\x20\x20\x20\x20\x20ke'+_0x2acdfd(0x325)+_0x2acdfd(0x2fd)+_0x2acdfd(0x1fa)+_0x2acdfd(0x303)+_0x2acdfd(0x333)+_0x2acdfd(0x342)+_0x2acdfd(0x29b)+_0x2acdfd(0x283)+'0\x0a\x20\x20\x20\x20);');try{const _0x31408f=await db[_0x2acdfd(0x349)]('SELECT\x20val'+'ue\x20FROM\x20de'+_0x2acdfd(0x32d)+_0x2acdfd(0x25b)+'=\x27mode\x27');if(!_0x31408f){const _0x225205=Math[_0x2acdfd(0x1d6)](Date[_0x2acdfd(0x216)]()/(0x386+-0x2112+-0x4*-0x85d));await db[_0x2acdfd(0x2e2)](_0x2acdfd(0x316)+'O\x20delete_p'+_0x2acdfd(0x1ea)+'\x20value,\x20up'+'dated_at)\x20'+_0x2acdfd(0x270)+'ode\x27,\x27p\x27,\x20'+'?)',[_0x225205]),DELETE_MODE='p';}else DELETE_MODE=_0x31408f[_0x2acdfd(0x2d7)]==='g'?'g':'p';}catch(_0x2fa0ea){warn(_0x2acdfd(0x2a8)+'refs\x20(mode'+')\x20load\x20fai'+_0x2acdfd(0x2c9)+(_0x2fa0ea?.[_0x2acdfd(0x22e)]||_0x2fa0ea));}try{const _0x5e5ead=await db[_0x2acdfd(0x349)](_0x2acdfd(0x34c)+_0x2acdfd(0x2a4)+_0x2acdfd(0x32d)+_0x2acdfd(0x25b)+_0x2acdfd(0x29e)+'id\x27');TARGET_JID=_0x5e5ead?.['value']||null;}catch(_0x35c588){warn(_0x2acdfd(0x28f)+'arget_jid\x20'+_0x2acdfd(0x269)+_0x2acdfd(0x2d8)+(_0x35c588?.[_0x2acdfd(0x22e)]||_0x35c588)),TARGET_JID=null;}}catch(_0x987bea){warn(_0x2acdfd(0x1ce)+_0x2acdfd(0x20d)+_0x2acdfd(0x1f9)+':\x20'+(_0x987bea?.['message']||_0x987bea));throw _0x987bea;}}async function streamMediaToFile(_0x143bc1,_0x6aceba){const _0x5dbc3b=_0x4a5ad8;try{const _0x4b36bd=_0x143bc1[_0x5dbc3b(0x22e)][_0x6aceba+_0x5dbc3b(0x254)],_0x26282e=await downloadContentFromMessage(_0x4b36bd,_0x6aceba);let _0x1aa13f=_0x5dbc3b(0x281);if(_0x6aceba===_0x5dbc3b(0x320))_0x1aa13f=_0x5dbc3b(0x271);else{if(_0x6aceba==='video'||_0x6aceba==='ptv')_0x1aa13f=_0x5dbc3b(0x27d);else{if(_0x6aceba===_0x5dbc3b(0x225))_0x1aa13f='ogg';else{if(_0x6aceba==='document')_0x1aa13f=_0x4b36bd?.[_0x5dbc3b(0x1da)]?_0x4b36bd['fileName']['split']('.')[_0x5dbc3b(0x381)]():_0x5dbc3b(0x2dd);else{if(_0x6aceba===_0x5dbc3b(0x1bf))_0x1aa13f=_0x5dbc3b(0x288);}}}}const _0x4669d1=_0x143bc1[_0x5dbc3b(0x21b)]['id']+'.'+_0x1aa13f,_0x4c571e=_0x31db23[_0x5dbc3b(0x294)](MEDIA_DIR,_0x4669d1);await pipeline(_0x26282e,createWriteStream(_0x4c571e));const _0x5dcccf=await _0x173ad1[_0x5dbc3b(0x232)](_0x4c571e);if(_0x5dcccf[_0x5dbc3b(0x289)]===0x1eab+-0x8*-0x383+-0x1*0x3ac3)return warn(_0x5dbc3b(0x328)+'aved\x20file\x20'+_0x4c571e+(_0x5dbc3b(0x37b)+_0x5dbc3b(0x24d))),await _0x173ad1['rm'](_0x4c571e,{'force':!![]}),null;return _0x4c571e;}catch(_0x5896fc){return warn('[Delete]\x20s'+_0x5dbc3b(0x202)+_0x5dbc3b(0x245)+_0x5dbc3b(0x251)+(_0x143bc1[_0x5dbc3b(0x21b)]?.['id']||'[no-id]')+':\x20'+(_0x5896fc?.[_0x5dbc3b(0x22e)]||_0x5896fc)),null;}}async function maybeSaveMedia(_0x2c3953){const _0x5dd712=_0x4a5ad8;try{const _0x2a979c=['image','video',_0x5dd712(0x1f5),_0x5dd712(0x225),'document','sticker'];for(const _0x344773 of _0x2a979c){if(_0x344773==='ptv'){if(_0x2c3953[_0x5dd712(0x22e)]?.[_0x5dd712(0x31d)])return await streamMediaToFile(_0x2c3953,'ptv');continue;}if(_0x2c3953[_0x5dd712(0x22e)]?.[_0x344773+_0x5dd712(0x254)])return await streamMediaToFile(_0x2c3953,_0x344773);}return null;}catch(_0x4496ec){return warn(_0x5dd712(0x1c6)+_0x5dd712(0x383)+_0x5dd712(0x21a)+'\x20'+(_0x4496ec?.[_0x5dd712(0x22e)]||_0x4496ec)),null;}}async function insertMessageToDB(_0x4b1147,_0x35f80e){const _0xa00a7a=_0x4a5ad8;try{if(!_0x4b1147||!_0x4b1147[_0xa00a7a(0x21b)])return;const {id:_0x1874fd,remoteJid:_0x322971,participant:_0x5d3ff3}=_0x4b1147[_0xa00a7a(0x21b)],_0x5f251f=_0x5d3ff3||_0x322971,_0x54d853=typeof _0x4b1147[_0xa00a7a(0x356)+'estamp']==='number'?_0x4b1147[_0xa00a7a(0x356)+_0xa00a7a(0x2be)]:_0x4b1147[_0xa00a7a(0x356)+_0xa00a7a(0x2be)]?.[_0xa00a7a(0x301)]||Math[_0xa00a7a(0x1d6)](Date[_0xa00a7a(0x216)]()/(-0x1837*-0x1+0x107b+-0x24ca)),_0x5561a8=_0x4b1147[_0xa00a7a(0x21b)]?.[_0xa00a7a(0x257)+'lt']||null,_0x3406b4=_0x4b1147[_0xa00a7a(0x21b)]?.['participan'+'tAlt']||null,_0x13af26=Math[_0xa00a7a(0x1d6)](Date[_0xa00a7a(0x216)]()/(0x1abd+0x1*-0x1bfa+-0x525*-0x1));if(!_0x1874fd){warn(_0xa00a7a(0x1dd)+'nsertMessa'+_0xa00a7a(0x388)+_0xa00a7a(0x2e8)+'id');return;}const _0x40ed90=_0xa00a7a(0x21d)+_0xa00a7a(0x318)+'TO\x20message'+'s\x20(msg_id,'+_0xa00a7a(0x200)+_0xa00a7a(0x343)+_0xa00a7a(0x321)+_0xa00a7a(0x2bd)+_0xa00a7a(0x227)+',\x20message_'+_0xa00a7a(0x206)+_0xa00a7a(0x374)+_0xa00a7a(0x23d)+'aved_at,\x20r'+_0xa00a7a(0x295)+_0xa00a7a(0x250)+_0xa00a7a(0x272)+_0xa00a7a(0x243)+_0xa00a7a(0x218)+_0xa00a7a(0x297),_0x2b24de=[_0x1874fd,_0x322971||null,_0x5561a8,_0x5f251f||null,_0x3406b4,JSON[_0xa00a7a(0x302)](_0x4b1147),_0x54d853,_0x35f80e||null,_0x13af26,null];try{await db['run'](_0x40ed90,_0x2b24de);}catch(_0x55e2b3){const _0x1dd516=String(_0x55e2b3?.[_0xa00a7a(0x22e)]||'');if(_0x1dd516[_0xa00a7a(0x240)](_0xa00a7a(0x341)+_0xa00a7a(0x1d5))){warn('[Delete]\x20i'+_0xa00a7a(0x2b2)+_0xa00a7a(0x230)+_0xa00a7a(0x32e)+_0xa00a7a(0x32f)+_0x1dd516+(_0xa00a7a(0x2b6)+_0xa00a7a(0x1c7)+_0xa00a7a(0x228)));try{await ensureTable(),await db[_0xa00a7a(0x2e2)](_0x40ed90,_0x2b24de);}catch(_0x1100eb){warn(_0xa00a7a(0x2b5)+_0xa00a7a(0x1f4)+_0xa00a7a(0x1c2)+(_0x1100eb?.[_0xa00a7a(0x22e)]||_0x1100eb));}}else throw _0x55e2b3;}}catch(_0x2f9432){warn(_0xa00a7a(0x1dd)+_0xa00a7a(0x336)+_0xa00a7a(0x369)+'led:\x20'+(_0x2f9432?.[_0xa00a7a(0x22e)]||_0x2f9432));}}async function fetchOriginalMessage(_0x3db8e6){const _0x3539fb=_0x4a5ad8;try{if(!_0x3db8e6)return null;const _0xff2736=await db['get'](_0x3539fb(0x346)+'_id,\x20messa'+_0x3539fb(0x267)+_0x3539fb(0x300)+_0x3539fb(0x21c)+_0x3539fb(0x2e7)+'ges\x20WHERE\x20'+_0x3539fb(0x37e),[_0x3db8e6]);if(_0xff2736)try{return{'msg_id':_0xff2736[_0x3539fb(0x37c)],'message':JSON[_0x3539fb(0x2bf)](_0xff2736['message_js'+'on']),'media_path':_0xff2736['media_path'],'saved_at':_0xff2736[_0x3539fb(0x28e)]};}catch(_0x22d0cd){return{'msg_id':_0xff2736['msg_id'],'message':null,'media_path':_0xff2736[_0x3539fb(0x2e0)],'saved_at':_0xff2736[_0x3539fb(0x28e)]};}return null;}catch(_0x44cb20){return warn(_0x3539fb(0x344)+_0x3539fb(0x2fb)+_0x3539fb(0x1e1)+'error:\x20'+(_0x44cb20?.[_0x3539fb(0x22e)]||_0x44cb20)),null;}}async function deleteMessageRow(_0x3fc8bf){const _0xd225bb=_0x4a5ad8;try{if(!_0x3fc8bf)return;const _0x549a3c=await db[_0xd225bb(0x349)](_0xd225bb(0x339)+_0xd225bb(0x23e)+_0xd225bb(0x1ee)+_0xd225bb(0x1ca)+_0xd225bb(0x327),[_0x3fc8bf]);if(_0x549a3c?.['media_path'])try{await _0x173ad1['rm'](_0x549a3c[_0xd225bb(0x2e0)],{'force':!![]});}catch(_0x58bd9f){warn(_0xd225bb(0x344)+'ailed\x20to\x20r'+_0xd225bb(0x2c1)+'\x20'+_0x549a3c['media_path']+':\x20'+(_0x58bd9f?.[_0xd225bb(0x22e)]||_0x58bd9f));}await db[_0xd225bb(0x2e2)](_0xd225bb(0x26d)+'M\x20messages'+_0xd225bb(0x205)+_0xd225bb(0x291),[_0x3fc8bf]),info(_0xd225bb(0x355)+_0xd225bb(0x382)+_0xd225bb(0x273)+'\x20'+_0x3fc8bf);}catch(_0x2ae5a7){warn(_0xd225bb(0x355)+_0xd225bb(0x20c)+_0xd225bb(0x353)+_0xd225bb(0x296)+(_0x2ae5a7?.['message']||_0x2ae5a7));}}async function sendWithRetry(_0x23cf6c,_0x231376,_0x5d1d5a=[]){const _0x26332f=_0x4a5ad8,_0x5940a6=Number(MAX_SEND_RETRIES||FALLBACKS[_0x26332f(0x2a3)+_0x26332f(0x2dc)]);let _0x1146fd=0x12a1+-0x1*0x1a51+0x7b0,_0x51a968=Number(INITIAL_BACKOFF||FALLBACKS[_0x26332f(0x2eb)+_0x26332f(0x1e0)]);const _0x43ff0c=[_0x23cf6c,TARGET_JID,getBotJid()][_0x26332f(0x368)](Boolean)['map'](normalizeToUserJid),_0x1ca27b=new Set(),_0x10de35=[];for(const _0x4cc7ae of _0x43ff0c){if(!_0x4cc7ae)continue;!_0x1ca27b[_0x26332f(0x36b)](_0x4cc7ae)&&(_0x1ca27b['add'](_0x4cc7ae),_0x10de35['push'](_0x4cc7ae));}let _0x22451a=_0x10de35['length']?_0x10de35[-0x10c+-0x13b4*-0x1+-0x12a8]:null;if(_0x22451a&&_0x22451a[_0x26332f(0x266)](_0x26332f(0x1f7))&&typeof botRef?.['sock']?.[_0x26332f(0x212)]===_0x26332f(0x285))try{const _0x3f672d=await botRef[_0x26332f(0x386)][_0x26332f(0x212)](_0x22451a);if(Array[_0x26332f(0x32a)](_0x3f672d)&&_0x3f672d[0x17ac+0x5*-0x471+-0x5*0x4b]&&_0x3f672d[-0x2d7*-0x7+-0x31*-0xa2+-0x32e3][_0x26332f(0x2cd)])_0x22451a=normalizeToUserJid(_0x3f672d[0x2679+-0xde1+-0x1898*0x1][_0x26332f(0x2cd)]);}catch(_0x22ba81){warn(_0x26332f(0x1c3)+'nWhatsApp\x20'+_0x26332f(0x317)+'iled:\x20'+(_0x22ba81?.[_0x26332f(0x22e)]||_0x22ba81));}while(_0x1146fd<_0x5940a6){try{if(!_0x22451a)throw new Error('no\x20send\x20ta'+'rget\x20avail'+_0x26332f(0x312));if(Array[_0x26332f(0x32a)](_0x5d1d5a)&&_0x5d1d5a[_0x26332f(0x26f)]&&typeof _0x231376===_0x26332f(0x331)&&_0x231376!==null)_0x231376['mentions']=_0x5d1d5a;return await botRef[_0x26332f(0x265)+'e'](_0x22451a,_0x231376),!![];}catch(_0x252eb8){_0x1146fd++;const _0x1c9cc9=String(_0x252eb8?.[_0x26332f(0x22e)]||'')[_0x26332f(0x1fb)+'e']()[_0x26332f(0x240)]('rate')||_0x252eb8?.[_0x26332f(0x278)]===-0x16b3+0x2006*-0x1+-0x2*-0x1c33;warn(_0x26332f(0x328)+_0x26332f(0x373)+'t\x20'+_0x1146fd+'\x20to\x20'+_0x22451a+_0x26332f(0x247)+(_0x252eb8?.[_0x26332f(0x22e)]||_0x252eb8));if(_0x1146fd>=_0x5940a6||!_0x1c9cc9)return![];await sleep(_0x51a968),_0x51a968*=-0x4*-0x3f5+0x1f7*0xc+-0x2766;}}return![];}function extractContent(_0x5b0f14){const _0x4e1848=_0x4a5ad8;if(!_0x5b0f14)return'';if(_0x5b0f14['conversati'+'on'])return _0x5b0f14[_0x4e1848(0x28a)+'on'];if(_0x5b0f14[_0x4e1848(0x25f)+_0x4e1848(0x1eb)])return _0x5b0f14['extendedTe'+_0x4e1848(0x1eb)][_0x4e1848(0x2aa)];if(_0x5b0f14[_0x4e1848(0x1be)+'ge'])return _0x5b0f14[_0x4e1848(0x1be)+'ge'][_0x4e1848(0x23b)]||'';if(_0x5b0f14['videoMessa'+'ge'])return _0x5b0f14[_0x4e1848(0x255)+'ge'][_0x4e1848(0x23b)]||'';if(_0x5b0f14[_0x4e1848(0x31d)])return _0x5b0f14[_0x4e1848(0x31d)][_0x4e1848(0x23b)]||'';if(_0x5b0f14[_0x4e1848(0x35b)+'ge'])return _0x5b0f14[_0x4e1848(0x35b)+'ge']?.[_0x4e1848(0x2e1)]?_0x4e1848(0x30d)+'e]':_0x4e1848(0x332);if(_0x5b0f14[_0x4e1848(0x354)+'ssage'])return _0x5b0f14['documentMe'+_0x4e1848(0x30a)][_0x4e1848(0x1da)]||'';if(_0x5b0f14[_0x4e1848(0x203)+_0x4e1848(0x2af)])return _0x4e1848(0x221);if(_0x5b0f14[_0x4e1848(0x305)+'onMessageV'+'3'])return _0x4e1848(0x268)+(_0x5b0f14[_0x4e1848(0x305)+'onMessageV'+'3'][_0x4e1848(0x276)]||_0x4e1848(0x213))+']';return'[Media]';}function isMediaMessage(_0x5edb1b){const _0x2ac5ea=_0x4a5ad8;if(!_0x5edb1b)return![];const _0x225bfd=Object[_0x2ac5ea(0x22a)](_0x5edb1b||{});for(const _0x11c234 of _0x225bfd){if(_0x11c234[_0x2ac5ea(0x266)]('Message')&&[_0x2ac5ea(0x1be)+'ge',_0x2ac5ea(0x255)+'ge','audioMessa'+'ge',_0x2ac5ea(0x354)+'ssage',_0x2ac5ea(0x203)+_0x2ac5ea(0x2af),'ptvMessage'][_0x2ac5ea(0x240)](_0x11c234))return!![];}return![];}async function buildPayloadForSavedFile(_0x1c82fd,_0x1ba345){const _0x144060=_0x4a5ad8,_0x42d074=_0x1ba345?.[_0x144060(0x22e)]||{},_0x39baea=extractContent(_0x42d074)||undefined;try{await _0x173ad1[_0x144060(0x359)](_0x1c82fd);}catch(_0x352223){return warn(_0x144060(0x36a)+_0x144060(0x31b)+_0x144060(0x2a0)+_0x144060(0x2d4)+_0x1c82fd),null;}if(_0x42d074[_0x144060(0x203)+'sage'])return{'sticker':{'url':_0x1c82fd}};if(_0x42d074['ptvMessage'])return{'video':{'url':_0x1c82fd},'ptv':!![],'caption':_0x39baea,'mimetype':_0x42d074[_0x144060(0x31d)]?.[_0x144060(0x2fa)]};if(_0x42d074[_0x144060(0x255)+'ge'])return{'video':{'url':_0x1c82fd},'caption':_0x39baea,'gifPlayback':!!_0x42d074[_0x144060(0x255)+'ge']?.['gifPlaybac'+'k'],'mimetype':_0x42d074[_0x144060(0x255)+'ge']?.[_0x144060(0x2fa)]};if(_0x42d074[_0x144060(0x1be)+'ge'])return{'image':{'url':_0x1c82fd},'caption':_0x39baea};if(_0x42d074['audioMessa'+'ge'])return{'audio':{'url':_0x1c82fd},'ptt':!!_0x42d074[_0x144060(0x35b)+'ge']?.['ptt'],'mimetype':_0x42d074[_0x144060(0x35b)+'ge']?.[_0x144060(0x2fa)],'seconds':_0x42d074['audioMessa'+'ge']?.[_0x144060(0x34f)]};if(_0x42d074['documentMe'+_0x144060(0x30a)])return{'document':{'url':_0x1c82fd,'fileName':_0x42d074[_0x144060(0x354)+_0x144060(0x30a)]?.[_0x144060(0x1da)]||_0x31db23[_0x144060(0x308)](_0x1c82fd)},'mimetype':_0x42d074['documentMe'+_0x144060(0x30a)]?.[_0x144060(0x2fa)],'caption':_0x42d074[_0x144060(0x354)+'ssage']?.[_0x144060(0x23b)]||_0x39baea};return{'document':{'url':_0x1c82fd,'fileName':_0x31db23[_0x144060(0x308)](_0x1c82fd)},'caption':_0x39baea};}async function processDeletionItem(_0x4fbd1d){const _0x18e5d4=_0x4a5ad8;try{const _0x354edd=_0x4fbd1d['keys']||[];if(!_0x354edd[_0x18e5d4(0x26f)])return;for(const _0x344139 of _0x354edd){const _0x49f597=await fetchOriginalMessage(_0x344139['id']);if(!_0x49f597||!_0x49f597['message'])continue;const _0x45165e=_0x49f597[_0x18e5d4(0x22e)],_0x175fd6=getBotJidRaw(),_0x71068f=_0x45165e['key']?.['participan'+'t']||_0x45165e[_0x18e5d4(0x21b)]?.['remoteJid'];if(_0x45165e[_0x18e5d4(0x21b)]?.[_0x18e5d4(0x25c)]||_0x71068f===_0x175fd6)continue;const _0x2d8e23=_0x45165e[_0x18e5d4(0x21b)][_0x18e5d4(0x2f4)+'t']||_0x45165e['key'][_0x18e5d4(0x1f2)],_0x2bef1b=extractContent(_0x45165e['message']);let _0xfdc3bd=nameCache[_0x18e5d4(0x349)](_0x2d8e23);if(!_0xfdc3bd){try{const [_0x422388]=await botRef[_0x18e5d4(0x386)][_0x18e5d4(0x212)](_0x2d8e23);_0xfdc3bd=_0x422388?.[_0x18e5d4(0x229)]||'~'+_0x2d8e23[_0x18e5d4(0x1fd)]('@')[0x17*-0x17e+-0x4*0x982+0x485a];}catch{_0xfdc3bd='~'+_0x2d8e23[_0x18e5d4(0x1fd)]('@')[0x4d*0x76+0xc47*0x1+-0x2fc5];}nameCache[_0x18e5d4(0x2f1)](_0x2d8e23,_0xfdc3bd);}let _0x488cd9='';if(isJidGroup(_0x45165e[_0x18e5d4(0x21b)][_0x18e5d4(0x1f2)]))try{_0x488cd9=(await botRef[_0x18e5d4(0x386)][_0x18e5d4(0x36d)+_0x18e5d4(0x2ed)](_0x45165e[_0x18e5d4(0x21b)][_0x18e5d4(0x1f2)]))['subject'];}catch{_0x488cd9=_0x18e5d4(0x2ca)+_0x18e5d4(0x1c1);}deletionPush({'msg_id':_0x49f597[_0x18e5d4(0x37c)],'sender':_0x2d8e23,'name':_0xfdc3bd,'group':_0x488cd9,'content':_0x2bef1b,'mediaPath':_0x49f597[_0x18e5d4(0x2e0)]||null,'originalMessage':_0x45165e});}}catch(_0x3d5946){warn(_0x18e5d4(0x2a8)+_0x18e5d4(0x2f9)+_0x18e5d4(0x222)+_0x18e5d4(0x1cd)+(_0x3d5946?.['message']||_0x3d5946));}}async function deletionWorker(){const _0x57232b=_0x4a5ad8,_0x57c245=CONCURRENCY||FALLBACKS[_0x57232b(0x35d)+'NCURRENCY'];while(deletionQueue['length']>-0xb7*-0x13+0x5*-0x4a3+0x99a&&activeDeletionTasks<_0x57c245){const _0x31e3a6=deletionQueue[_0x57232b(0x27c)]();if(!_0x31e3a6)break;activeDeletionTasks++,((async()=>{const _0x5433d0=_0x57232b;try{await processDeletionItem(_0x31e3a6);}catch(_0x404ffb){warn(_0x5433d0(0x355)+_0x5433d0(0x2ee)+'ker\x20item\x20e'+_0x5433d0(0x1cd)+(_0x404ffb?.[_0x5433d0(0x22e)]||_0x404ffb));}finally{activeDeletionTasks--,setImmediate(()=>{const _0x329361=_0x5433d0;if(deletionQueue[_0x329361(0x26f)])deletionWorker()['catch'](()=>{});});}})());}}function deletionPush(_0x5121b6){const _0x42f788=_0x4a5ad8;pendingRecovered[_0x42f788(0x366)](_0x5121b6),clearTimeout(flushTimer),flushTimer=setTimeout(()=>{const _0x4aa41f=_0x42f788,_0x6ff8f=pendingRecovered[_0x4aa41f(0x2f8)](-0x2*-0x52c+-0x10ce+0x33b*0x2,pendingRecovered[_0x4aa41f(0x26f)]);((async()=>{const _0xc75f97=_0x4aa41f;try{await flushRecoveredBatch(_0x6ff8f);}catch(_0x383f77){warn('[Delete]\x20f'+_0xc75f97(0x1df)+'redBatch\x20e'+_0xc75f97(0x1cd)+(_0x383f77?.['message']||_0x383f77));}})());},DEBOUNCE_DELAY_MS||FALLBACKS[_0x42f788(0x256)+'S']);}function resolveDeleteTarget(_0x3f3bae){const _0x1ee4cb=getBotJid();if(DELETE_MODE==='g'&&TARGET_JID){if(TARGET_JID===_0x3f3bae)return _0x1ee4cb;return TARGET_JID;}return _0x1ee4cb;}async function saveDeleteMode(_0x47ee24){const _0x28ddb6=_0x4a5ad8;try{const _0x4a89eb=_0x47ee24==='g'?'g':'p',_0x3b5748=Math[_0x28ddb6(0x1d6)](Date[_0x28ddb6(0x216)]()/(-0x17*-0x125+0xb79+-0x21e4));return await db[_0x28ddb6(0x2e2)](_0x28ddb6(0x316)+_0x28ddb6(0x2d1)+_0x28ddb6(0x1ea)+'\x20value,\x20up'+'dated_at)\x20'+_0x28ddb6(0x270)+'ode\x27,\x20?,\x20?'+')\x20ON\x20CONFL'+_0x28ddb6(0x338)+_0x28ddb6(0x33d)+'ET\x20value=e'+_0x28ddb6(0x275)+_0x28ddb6(0x24f)+_0x28ddb6(0x24e)+_0x28ddb6(0x29c)+'ed_at',[_0x4a89eb,_0x3b5748]),DELETE_MODE=_0x4a89eb,info(_0x28ddb6(0x1c6)+_0x28ddb6(0x345)+'\x20'+DELETE_MODE),!![];}catch(_0x2785cc){return warn(_0x28ddb6(0x328)+_0x28ddb6(0x2c0)+_0x28ddb6(0x290)+':\x20'+(_0x2785cc?.[_0x28ddb6(0x22e)]||_0x2785cc)),![];}}async function saveDeleteTarget(_0xadd341){const _0x1281b8=_0x4a5ad8;try{const _0x351187=Math['floor'](Date[_0x1281b8(0x216)]()/(-0x1831+-0x1*0x119+-0xca*-0x25));if(!_0xadd341)return await db[_0x1281b8(0x2e2)]('DELETE\x20FRO'+'M\x20delete_p'+_0x1281b8(0x2c5)+_0x1281b8(0x1f3)+_0x1281b8(0x385)),TARGET_JID=null,info('[Delete]\x20t'+_0x1281b8(0x2e6)+'cleared'),!![];else{const _0xe2922c=normalizeToUserJid(_0xadd341);return await db[_0x1281b8(0x2e2)](_0x1281b8(0x316)+'O\x20delete_p'+_0x1281b8(0x1ea)+_0x1281b8(0x238)+_0x1281b8(0x2cf)+'VALUES\x20(\x27t'+_0x1281b8(0x1e5)+_0x1281b8(0x1cc)+_0x1281b8(0x36e)+_0x1281b8(0x1ec)+_0x1281b8(0x28d)+'alue=exclu'+_0x1281b8(0x26c)+'\x20updated_a'+_0x1281b8(0x2c2)+_0x1281b8(0x249)+'t',[_0xe2922c,_0x351187]),TARGET_JID=_0xe2922c,info(_0x1281b8(0x28f)+_0x1281b8(0x2e6)+_0x1281b8(0x23c)+TARGET_JID),!![];}}catch(_0xd6aece){return warn(_0x1281b8(0x328)+_0x1281b8(0x27f)+_0x1281b8(0x1d1)+'ed:\x20'+(_0xd6aece?.[_0x1281b8(0x22e)]||_0xd6aece)),![];}}function _0xb2c8(_0x23be65,_0x5935e2){_0x23be65=_0x23be65-(-0x77b*-0x4+0x21e6+-0x3e14);const _0x1b3b38=_0x477b();let _0xade2fa=_0x1b3b38[_0x23be65];return _0xade2fa;}async function flushRecoveredBatch(_0x198c1f){const _0x483d51=_0x4a5ad8;if(!_0x198c1f||_0x198c1f[_0x483d51(0x26f)]===-0x1f8f+0x2259+-0x2ca)return;if(!DEFAULT_SEND_DELETE){info(_0x483d51(0x2e5)+'EFAULT_SEN'+_0x483d51(0x25d)+_0x483d51(0x231)+'pping\x20reco'+_0x483d51(0x1c5)+'s.');return;}const _0xdd94da=_0x198c1f[_0x483d51(0x34d)](_0x415bdb=>_0x415bdb[_0x483d51(0x380)+_0x483d51(0x30a)])?.[_0x483d51(0x380)+_0x483d51(0x30a)]?.[_0x483d51(0x21b)]?.[_0x483d51(0x1f2)]||null,_0x35977d=resolveDeleteTarget(_0xdd94da)||getBotJid();if(!_0x35977d){warn(_0x483d51(0x29f)+_0x483d51(0x31f)+_0x483d51(0x30c)+_0x483d51(0x27e));return;}const _0x183780=[...new Set(_0x198c1f[_0x483d51(0x292)](_0x19749d=>_0x19749d[_0x483d51(0x209)]))],_0x5635c7=_0x198c1f[_0x483d51(0x292)](_0x5bf5ff=>'ðŸ‘¤\x20From:\x20@'+_0x5bf5ff[_0x483d51(0x209)]['split']('@')[0xd*-0x10d+-0x174d+-0xf9*-0x26]+'\x20('+_0x5bf5ff[_0x483d51(0x276)]+')\x0a'+(_0x5bf5ff[_0x483d51(0x2b9)]?_0x483d51(0x277)+_0x5bf5ff[_0x483d51(0x2b9)]+'\x0a':'')+('ðŸ“\x20Content:'+'\x20'+_0x5bf5ff[_0x483d51(0x211)]+'\x0a')+'â”€'[_0x483d51(0x1c0)](-0x1c2d*-0x1+0x1e*0x14b+-0x42de))[_0x483d51(0x294)]('\x0a'),_0x3fb4f7=_0x483d51(0x347)+_0x198c1f['length']+(_0x483d51(0x26a)+'ESSAGES\x20RE'+_0x483d51(0x241)+'\x0a\x0a');try{const _0x5b2d75=await sendWithRetry(_0x35977d,{'text':_0x3fb4f7+_0x5635c7},_0x183780);if(!_0x5b2d75)warn('[Delete]\x20s'+'ummary\x20sen'+'d\x20may\x20have'+'\x20failed');}catch(_0x3bf8c7){warn('[Delete]\x20s'+_0x483d51(0x280)+_0x483d51(0x252)+'ed\x20error:\x20'+(_0x3bf8c7?.['message']||_0x3bf8c7));}for(const _0x1e9ae7 of _0x198c1f){try{const _0x495d5d=_0x1e9ae7[_0x483d51(0x2ba)],_0x41c0b7=_0x1e9ae7[_0x483d51(0x380)+_0x483d51(0x30a)],_0x2d4054=!!_0x495d5d||isMediaMessage(_0x41c0b7?.[_0x483d51(0x22e)]);if(!_0x2d4054){try{await deleteMessageRow(_0x1e9ae7['msg_id']);}catch(_0x5d44e9){}continue;}const _0x32bf8b=_0x41c0b7?.[_0x483d51(0x21b)]?.['id']||_0x483d51(0x335),_0x5835ed=await buildPayloadForSavedFile(_0x495d5d,_0x41c0b7);if(_0x5835ed){const _0xbb1b6f=await sendWithRetry(_0x35977d,_0x5835ed);if(_0xbb1b6f){info(_0x483d51(0x2b5)+_0x483d51(0x1d8)+'edia\x20sent\x20'+'for\x20'+_0x32bf8b+_0x483d51(0x1f8)+_0x35977d),await deleteMessageRow(_0x1e9ae7[_0x483d51(0x37c)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x483d51(0x248)+_0x483d51(0x1ed)]);continue;}else warn(_0x483d51(0x1c6)+_0x483d51(0x307)+_0x483d51(0x263)+'\x20'+_0x32bf8b+'.');}try{const _0x40aad6=await sendWithRetry(_0x35977d,{'forward':_0x41c0b7});if(_0x40aad6){info(_0x483d51(0x2b5)+_0x483d51(0x204)+_0x483d51(0x375)+'rwarded\x20fo'+'r\x20'+_0x32bf8b+_0x483d51(0x1f8)+_0x35977d),await deleteMessageRow(_0x1e9ae7[_0x483d51(0x37c)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS['MEDIA_SEND'+_0x483d51(0x1ed)]);continue;}}catch(_0x33cab2){warn(_0x483d51(0x378)+_0x483d51(0x2b0)+'ard\x20error:'+'\x20'+(_0x33cab2?.[_0x483d51(0x22e)]||_0x33cab2));}warn(_0x483d51(0x1f1)+_0x483d51(0x33e)+_0x483d51(0x1c9)+_0x483d51(0x20b)+_0x32bf8b+(_0x483d51(0x2ad)+_0x483d51(0x2b3)+_0x483d51(0x2ae)+_0x483d51(0x2d6)+_0x483d51(0x2ea)+'try/cleanu'+'p.'));}catch(_0x2e0d40){warn(_0x483d51(0x344)+'lush\x20loop\x20'+_0x483d51(0x310)+':\x20'+(_0x2e0d40?.[_0x483d51(0x22e)]||_0x2e0d40));}}}async function rawMessagesUpsertHandler({messages:_0x1fef54}){const _0x30a893=_0x4a5ad8;try{if(!_0x1fef54||!Array[_0x30a893(0x32a)](_0x1fef54))return;for(const _0x27ff85 of _0x1fef54){if(!_0x27ff85||!_0x27ff85[_0x30a893(0x22e)]||_0x27ff85[_0x30a893(0x21b)]?.['remoteJid']===_0x30a893(0x324)+_0x30a893(0x2cc))continue;if(_0x27ff85[_0x30a893(0x21b)]?.['fromMe'])continue;if(messageQueue[_0x30a893(0x26f)]>=QUEUE_MAX_SIZE){warn(_0x30a893(0x36a)+'essage\x20sav'+'e\x20queue\x20is'+_0x30a893(0x1ff)+messageQueue['length']+(_0x30a893(0x351)+_0x30a893(0x371)+'\x20message.'));continue;}messageQueue['push'](_0x27ff85),setImmediate(()=>{const _0x1ba421=_0x30a893;messageWorker()[_0x1ba421(0x28c)](()=>{});});const _0x1a09e5=_0x27ff85[_0x30a893(0x22e)]?.['protocolMe'+'ssage'];if(_0x1a09e5?.[_0x30a893(0x2c6)]===0x6*0x179+0x25*0x4d+-0x13*0x10d&&_0x1a09e5?.[_0x30a893(0x21b)]){if(deletionQueue[_0x30a893(0x26f)]>=QUEUE_MAX_SIZE){warn('[Delete]\x20D'+_0x30a893(0x26e)+_0x30a893(0x22f)+_0x30a893(0x1e2)+_0x30a893(0x22d)+deletionQueue[_0x30a893(0x26f)]+(_0x30a893(0x351)+_0x30a893(0x234)+_0x30a893(0x1c4)));continue;}deletionQueue[_0x30a893(0x366)]({'keys':[_0x1a09e5[_0x30a893(0x21b)]],'remoteJid':_0x27ff85[_0x30a893(0x21b)]['remoteJid']}),setImmediate(()=>{deletionWorker()['catch'](()=>{});});}}}catch(_0x58e96c){warn(_0x30a893(0x2b5)+_0x30a893(0x29d)+'UpsertHand'+'ler\x20error:'+'\x20'+(_0x58e96c?.['message']||_0x58e96c));}}async function processMessageItem(_0x10c2f6){const _0x38171b=_0x4a5ad8;try{if(!_0x10c2f6||!_0x10c2f6[_0x38171b(0x22e)]||_0x10c2f6[_0x38171b(0x21b)]?.[_0x38171b(0x25c)])return;const _0x4a1d9b=await maybeSaveMedia(_0x10c2f6);await insertMessageToDB(_0x10c2f6,_0x4a1d9b);}catch(_0x1fd4b2){warn(_0x38171b(0x2a8)+'rocessMess'+_0x38171b(0x2f5)+_0x38171b(0x315)+(_0x1fd4b2?.[_0x38171b(0x22e)]||_0x1fd4b2));}}async function messageWorker(){const _0x5c3b61=_0x4a5ad8,_0x5e28aa=CONCURRENCY||FALLBACKS[_0x5c3b61(0x35d)+'NCURRENCY'];while(messageQueue[_0x5c3b61(0x26f)]>0x209f+0x3b*-0x5+-0x1f78&&activeMessageTasks<_0x5e28aa){const _0x4f2397=messageQueue['shift']();if(!_0x4f2397)break;activeMessageTasks++,((async()=>{const _0xf6cc33=_0x5c3b61;try{await processMessageItem(_0x4f2397);}catch(_0x4850d0){warn('[Delete]\x20m'+'essageWork'+_0xf6cc33(0x2b7)+_0xf6cc33(0x315)+(_0x4850d0?.[_0xf6cc33(0x22e)]||_0x4850d0));}finally{activeMessageTasks--,setImmediate(()=>{const _0x186afe=_0xf6cc33;if(messageQueue[_0x186afe(0x26f)])messageWorker()[_0x186afe(0x28c)](()=>{});});}})());}}async function autoCleanOldMessagesSafe(){const _0x9a48ff=_0x4a5ad8;try{await autoCleanOldMessages();}catch(_0x4d1980){warn(_0x9a48ff(0x2c8)+_0x9a48ff(0x322)+_0x9a48ff(0x207)+_0x9a48ff(0x1db)+'\x20'+(_0x4d1980?.[_0x9a48ff(0x22e)]||_0x4d1980));}}async function autoCleanOldMessages(){const _0x45c889=_0x4a5ad8;try{const _0x36bbd9=Math[_0x45c889(0x1d6)](Date[_0x45c889(0x216)]()/(-0x97*-0x17+-0xb26+-0x7f*-0x3))-Number(DELETE_CLEANUP_DAYS||FALLBACKS[_0x45c889(0x220)+'YS'])*(0x1*-0x1ae9+0x1*-0xe77+-0xa5e*-0x4)*(-0x203d+-0xc8*-0x27+0x201)*(0x0+-0x2469+0x24a5),_0x4a3aef=await db['all'](_0x45c889(0x346)+_0x45c889(0x2c3)+_0x45c889(0x30f)+_0x45c889(0x33c)+_0x45c889(0x32b)+'WHERE\x20save'+_0x45c889(0x246)+_0x45c889(0x2bb)+_0x45c889(0x21c)+_0x45c889(0x35c),[_0x36bbd9]);if(!_0x4a3aef||_0x4a3aef[_0x45c889(0x26f)]===-0x2a7+0x57+0x250)return;info(_0x45c889(0x279)+_0x45c889(0x2b4)+_0x4a3aef[_0x45c889(0x26f)]+('\x20old\x20messa'+_0x45c889(0x27a)+_0x45c889(0x22c))+DELETE_CLEANUP_DAYS+_0x45c889(0x24a));for(const _0x3fd355 of _0x4a3aef){if(_0x3fd355['media_path'])try{await _0x173ad1['rm'](_0x3fd355[_0x45c889(0x2e0)],{'force':!![]});}catch(_0x49cf60){warn(_0x45c889(0x344)+'ailed\x20dele'+_0x45c889(0x35e)+_0x3fd355[_0x45c889(0x2e0)]+':\x20'+(_0x49cf60?.[_0x45c889(0x22e)]||_0x49cf60));}}const _0x411a56=_0x4a3aef[_0x45c889(0x292)](_0x3083f1=>_0x3083f1[_0x45c889(0x37c)]),_0x1a3a19=0x1*-0x1147+0x175f+-0x550;for(let _0x7c7739=-0x1*0x24b5+-0x1d9*-0x7+-0x2*-0xbe3;_0x7c7739<_0x411a56[_0x45c889(0x26f)];_0x7c7739+=_0x1a3a19){const _0x5375ed=_0x411a56[_0x45c889(0x2f3)](_0x7c7739,_0x7c7739+_0x1a3a19),_0x456970=_0x5375ed[_0x45c889(0x292)](()=>'?')[_0x45c889(0x294)](',');await db[_0x45c889(0x2e2)]('DELETE\x20FRO'+_0x45c889(0x2fe)+_0x45c889(0x205)+_0x45c889(0x20a)+_0x456970+')',_0x5375ed);}info(_0x45c889(0x279)+_0x45c889(0x31a)+_0x45c889(0x352));}catch(_0x201e13){warn(_0x45c889(0x2c8)+_0x45c889(0x322)+_0x45c889(0x21e)+'failed:\x20'+(_0x201e13?.[_0x45c889(0x22e)]||_0x201e13));}}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0x1cb1+-0x2173+-0x4ca*-0xd)*(-0x2480+0x117*-0x1f+0x1*0x4a31);function markCmdProcessed(_0x7d30ab){const _0x53fc8b=_0x4a5ad8;if(!_0x7d30ab)return;if(processedCmdKeys[_0x53fc8b(0x36b)](_0x7d30ab))try{clearTimeout(processedCmdKeys[_0x53fc8b(0x349)](_0x7d30ab));}catch(_0xf55e19){};const _0x38690c=setTimeout(()=>processedCmdKeys[_0x53fc8b(0x1e7)](_0x7d30ab),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x53fc8b(0x2f1)](_0x7d30ab,_0x38690c);}function isCmdProcessed(_0x416bd9){const _0x46e398=_0x4a5ad8;return _0x416bd9&&processedCmdKeys[_0x46e398(0x36b)](_0x416bd9);}export async function onMessage(_0x168e9f,_0x4ae7f3){const _0x29135e=_0x4a5ad8;try{if(!_0x168e9f||!_0x168e9f[_0x29135e(0x21b)]||!_0x168e9f[_0x29135e(0x22e)]||!_0x168e9f[_0x29135e(0x25a)]||!_0x4ae7f3)return;if(isJidGroup(_0x168e9f[_0x29135e(0x21b)][_0x29135e(0x1f2)]))return;const _0x4cacd6=_0x168e9f[_0x29135e(0x21b)][_0x29135e(0x25c)],_0x4a4893=await isSudo(botRef,_0x168e9f)[_0x29135e(0x28c)](()=>![]);if(!_0x4cacd6&&!_0x4a4893)return;let _0x53ac1e=_0x4cacd6?getBotJid():_0x168e9f[_0x29135e(0x21b)]['remoteJid'];if(!_0x53ac1e){warn(_0x29135e(0x1d0)+_0x29135e(0x2fc)+'rmine\x20comm'+_0x29135e(0x350)+'target.');return;}const _0x201246=String(_0x168e9f['key'][_0x29135e(0x1f2)]||'')+'::'+String(_0x168e9f[_0x29135e(0x21b)]['id']||_0x168e9f[_0x29135e(0x21b)]['participan'+'t']||'');if(isCmdProcessed(_0x201246))return;markCmdProcessed(_0x201246);const _0x347ada=_0x168e9f[_0x29135e(0x2aa)]||'',_0x594fba=_0x347ada['trim']()[_0x29135e(0x1fd)](/\s+/),_0x4a2952=(_0x594fba[0x553*0x6+-0x1a42+0x34*-0x1c]||'')[_0x29135e(0x1fb)+'e']();if(!commands[_0x29135e(0x240)](_0x4a2952))return;const _0xdfaeaa=(_0x594fba[0x108d+0x7*0x7+-0x10bd]||'')[_0x29135e(0x1fb)+'e']();if(_0xdfaeaa&&_0xdfaeaa[_0x29135e(0x240)]('@')){const _0xcc8733=normalizeToUserJid(_0xdfaeaa),_0x3e34fb=await saveDeleteTarget(_0xcc8733);await sendWithRetry(_0x53ac1e,{'text':_0x3e34fb?_0x29135e(0x2e9)+_0x29135e(0x2d0)+'saved:\x20'+_0xcc8733:_0x29135e(0x287)+'ailed\x20to\x20s'+_0x29135e(0x237)+'\x20JID'});return;}if([_0x29135e(0x370),_0x29135e(0x21f),_0x29135e(0x236)][_0x29135e(0x240)](_0xdfaeaa)){const _0x5d63f6=await saveDeleteTarget(null);await sendWithRetry(_0x53ac1e,{'text':_0x5d63f6?_0x29135e(0x2e9)+_0x29135e(0x2d0)+'cleared.':_0x29135e(0x287)+'ailed\x20to\x20c'+_0x29135e(0x298)+_0x29135e(0x226)});return;}if(['p','pm'][_0x29135e(0x240)](_0xdfaeaa)){await saveDeleteMode('p'),await sendWithRetry(_0x53ac1e,{'text':_0x29135e(0x2db)+_0x29135e(0x2b8)+_0x29135e(0x20f)});return;}if(['g',_0x29135e(0x2b9),'gp'][_0x29135e(0x240)](_0xdfaeaa)){await saveDeleteMode('g');const _0x3f2583=TARGET_JID?_0x29135e(0x2d3)+_0x29135e(0x1e4)+TARGET_JID:_0x29135e(0x28b)+_0x29135e(0x30b)+_0x29135e(0x20e);await sendWithRetry(_0x53ac1e,{'text':'[delete]\x20M'+_0x29135e(0x2b8)+'\x20GROUP.\x20'+_0x3f2583});return;}const _0x16073f=DELETE_MODE==='g'?_0x29135e(0x293)+(TARGET_JID||_0x29135e(0x1e3))+')':'PM';await sendWithRetry(_0x53ac1e,{'text':_0x29135e(0x219)+_0x29135e(0x2ef)+_0x29135e(0x1fc)+'Only)*\x0a\x0a'+_0x29135e(0x363)+(_0x29135e(0x1d7)+_0x29135e(0x337)+_0x29135e(0x214)+_0x29135e(0x1cb)+_0x29135e(0x1dc))+('\x20delete\x20g|'+_0x29135e(0x311)+'\x20send\x20reco'+_0x29135e(0x1f6)+'\x20group\x0a')+(_0x29135e(0x2a7)+_0x29135e(0x217)+_0x29135e(0x1ef)+_0x29135e(0x261)+'D\x0a')+(_0x29135e(0x384)+_0x29135e(0x1d2)+_0x29135e(0x362)+_0x29135e(0x358)+'JID\x0a\x0a')+('*Current\x20S'+_0x29135e(0x2a1))+(_0x29135e(0x1e9)+_0x29135e(0x37f)+_0x16073f+'*\x0a')+('\x20Recovery\x20'+_0x29135e(0x242)+DEFAULT_SEND_DELETE+'*\x0a')+(_0x29135e(0x35a)+'fter:\x20*'+DELETE_CLEANUP_DAYS+_0x29135e(0x319))});}catch(_0x6a7e5){error(_0x6a7e5,_0x29135e(0x1c3)+_0x29135e(0x27b)+_0x29135e(0x1cd)+(_0x6a7e5?.[_0x29135e(0x22e)]||_0x6a7e5));}}export async function initialize(_0x2f278b){const _0x499480=_0x4a5ad8;if(!_0x2f278b)throw new Error(_0x499480(0x2ac)+_0x499480(0x253)+_0x499480(0x233));botRef=_0x2f278b,await refreshConfig(),await ensureTable()[_0x499480(0x28c)](_0x1eda89=>{const _0x32fb7e=_0x499480;error('[Delete]\x20D'+_0x32fb7e(0x313)+_0x32fb7e(0x258)+_0x32fb7e(0x348)+_0x32fb7e(0x304)+(_0x1eda89?.['message']||_0x1eda89));throw _0x1eda89;}),_0x2f278b['on'](_0x499480(0x365)+_0x499480(0x262),rawMessagesUpsertHandler),await autoCleanOldMessagesSafe()['catch'](_0x58ac99=>warn(_0x499480(0x1dd)+_0x499480(0x2d2)+_0x499480(0x323)+':\x20'+(_0x58ac99?.[_0x499480(0x22e)]||_0x58ac99)));if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(autoCleanOldMessagesSafe,CLEANUP_INTERVAL||FALLBACKS[_0x499480(0x282)+_0x499480(0x330)]),info(_0x499480(0x379)+_0x499480(0x25e)+_0x499480(0x1f0)+DELETE_MODE+(_0x499480(0x2da)+'Days:\x20')+DELETE_CLEANUP_DAYS);}export async function cleanup(){const _0x5e8dc2=_0x4a5ad8;try{botRef&&typeof botRef[_0x5e8dc2(0x329)+_0x5e8dc2(0x31c)]==='function'&&botRef['removeList'+_0x5e8dc2(0x31c)](_0x5e8dc2(0x365)+_0x5e8dc2(0x262),rawMessagesUpsertHandler),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null),messageQueue['length']=0x1*-0x771+0x1*-0x22d2+-0x1*-0x2a43,deletionQueue[_0x5e8dc2(0x26f)]=-0xa57*0x3+0x9*-0x25f+0x345c,pendingRecovered[_0x5e8dc2(0x26f)]=0x6c1*-0x4+0x43*0x31+0xe31;}catch(_0x54b151){warn('[Delete]\x20c'+_0x5e8dc2(0x1e8)+_0x5e8dc2(0x2a2)+(_0x54b151?.[_0x5e8dc2(0x22e)]||_0x54b151));}finally{botRef=null;}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};