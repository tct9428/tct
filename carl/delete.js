const _0xd9310f=_0xee59;function _0x12f4(){const _0x3c9263=['name','OM\x20message','\x20chat_jid,','ogg','iled:\x20','audio','pm\x20\x20\x20\x20\x20\x20->','\x20delete\x20cl','ET\x20value=e','M\x20messages','\x20group\x0a','run','RY\x20KEY','SIZE','ecovered\x20m','target.','tings\x20(PM-','[Delete]\x20h','msg_id=?',',\x20?,\x20?)\x20ON','poll','lush\x20loop\x20','sages\x20row:','[Delete]\x20c','g_id=?','TEXT','rror:\x20','ed_at\x20FROM','o\x20send\x20tar','lete_prefs','document','CKOFF_MS','participan','SELECT\x20msg','nsureTable','saved_at','gifPlaybac','=\x27target_j','\x20send\x20reco','value','messages.u','eletion\x20pr','split','[delete]\x20T','PROJECT_RO','rocessMess','eletionWor','\x20delete\x20p|','ll\x20(','failed:\x20','dated_at)\x20','audioMessa','dded\x20missi','message','CLEANUP_DA','ker\x20item\x20e','DELETE_QUE','load\x20faile','resolve',').\x20Droppin','DEBOUNCE_M','essages\x27)','INSERT\x20OR\x20','notify','er\x20item\x20er',',\x20Cleanup\x20','not\x20set','ig\x20error:\x20','get\x20group\x20','item\x20error','MEDIA_DIRN','\x20?)','[Delete]\x20d','VALUES\x20(\x27m','[Voice\x20not','code','[Delete]\x20r','group\x20\x20\x20->','is\x20set.','e\x20queue\x20is','uded.updat','treamMedia','documentMe','[Delete]\x20p','number','[Delete]\x20C','ssage','nsert\x20fail','[Delete]\x20I','edia\x20sent\x20','VAL_MS','basename','O\x20UPDATE\x20S','DATE\x20SET\x20v',':\x20*','\x20value,\x20up','ailed\x20to\x20c','xtMessage','7281765DIQCck','aybeSaveMe','1IpiQfP','[Delete]\x20f','y:\x20','\x20message.','aved_at,\x20r','geToDB\x20fai','ptvMessage','R\x20DEFAULT\x20','catch','json,\x20time','ummary\x20sen','s\x20(msg_id,','ule\x20requir','EXISTS\x20del','cleared','tionItem\x20e','[Delete]\x20o','rate','get\x20availa','Usage:\x0a','all','ENOENT','estamp','mkdir','[Delete]\x20m','EXISTS\x20mes','indexOf','message_js','ges\x20(older','IMIT','media','[Delete]\x20e','delete-rec','unset','pop','nsertMessa','for\x20','parse','INSERT\x20INT','video','👤\x20From:\x20@','\x20Recovery\x20','\x20set\x20targe','isCommand','_DELAY_MS','leaning\x20','548fmhDQo','LAY_MS','jid,\x20parti','518416wQlVfz','annot\x20dete','ailed\x20dele','ICT(key)\x20D','has','t=excluded','MAX_SEND_R','[Delete]\x20a','r:\x20','splice','_id,\x20messa','FROM\x20messa','messageTim','image','?,\x20?,\x20?,\x20?','INTEGER','SELECT\x20val','[Delete]\x20u','edia\x20file\x20','access','ode\x27,\x20?,\x20?','xcluded.va','pdf','remove','ue\x20FROM\x20de','ANUP_DAYS','includes','ot-reloade',',\x20message_','nWhatsApp\x20','content','refs\x20(mode','dia\x20error:','_id,\x20media','alMessage\x20','ptv','\x20is\x20empty,','group\x20JID\x20','ata','ot\x20PM\x0a','function','(\x0a\x20\x20\x20\x20\x20\x20ke','isArray','[delete]\x20F','ode\x27,\x27p\x27,\x20','ToFile\x20fai','REPLACE\x20IN','aved\x20file\x20','_SEND_RETR','lue,\x20updat','PRAGMA\x20tab','rget\x20avail','\x20deleting.','msg_id','ed\x20error:\x20','subject','id\x27','messages.','sing\x20colum','IA_SEND_DE','shift','sages\x20(\x0a\x20\x20','ageItem\x20er','DELETE_CON','IA_DIR','CLEANUP_IN','jid','e\x20TEXT\x20NOT','le_info(\x27m','group','media_path','esent_at)\x0a','caption','object','[Delete]\x20n','protocolMe','egacy\x20forw','CREATE\x20TAB','extendedTe','Configured','O\x20delete_p','led\x20fatall','fileName','text','mapping\x20fa','data','key)\x20DO\x20UP','push','onMessageV','filter','ND_DELETE','📝\x20Content:','psert','rmine\x20comm','redBatch\x20e','zation\x20fai',',\x0a\x20\x20','DELETE\x20FRO','\x20Send\x20Mode','ode\x20failed','d_at\x20IS\x20NO','etry\x20inser','videoMessa','\x20days*','mpts\x20faile','\x20top\x20error','\x20->\x20','\x20Cleanup\x20A','CURRENCY','imageMessa','dMessages\x20','M\x20delete_p','UE_MAX_SIZ','vered\x20send','\x20JID','[Delete]\x20s','DELETE_MED','arget_jid\x27','anup\x20error','\x20failed:\x20','D_DELETE\x20f','find','[Delete]\x20l','DEFAULT_CO','395OMzpxY','plete.','etchOrigin','boolean','covery\x20Set','pollCreati','ailed\x20to\x20r','add','nMessage\x20e','roup]','sage','ror:\x20','131816bPPRRe','cwd','e_info\x20fai','*Current\x20S','cleared.','awMessages','ES\x20(?,\x20?,\x20','status','[Delete]\x20D','ia\x20for\x20','ailed\x20to\x20a','\x20PM.','\x20saved_at\x20','[Poll:\x20','dMessagesS','leanup\x20err','.\x20Mode:\x20','dd\x20column\x20','DELETE_DEB','clear','[Delete]\x20i','fromMe','d\x20retry','.updated_a','stat','d:\x20','edia\x20send\x20','tration\x20fa','sender','DELETE_INI','delete','alue=exclu','exec','MEDIA_SEND','LE\x20IF\x20NOT\x20','\x20\x20\x20\x20\x20\x20VALU','or:\x20','ed_at','mediaPath','\x20days)','(no-id)','status@bro','size','\x20clear\x20tar','umn','11964idGFYA','No\x20target\x20','\x20key=\x27targ','\x20full\x20(','slice','arget\x20JID\x20','aveDeleteT','\x20old\x20messa','utoCleanOl','ueue\x20is\x20fu',')\x20load\x20fai','seconds','\x20ADD\x20COLUM','conversati','cipant_alt','FF_MS','ANUP_INTER','TERVAL_MS','ia_path\x20FR','join','overy','\x20(all\x20atte','[delete]\x20M','OUNCE_MS','toLowerCas','Days:\x20','_id\x20IN\x20(','get','\x20WHERE\x20key','aveDeleteM','TEXT\x20PRIMA','failed\x20for','ptt',',\x20?,\x20?,\x20?,','ode\x20set\x20to','\x20delete\x20<j','ave\x20target','y\x20TEXT\x20PRI','EFAULT_SEN','sendMessag','ete_prefs\x20','saved:\x20','[Delete]\x20t','ocessing\x20q','sticker','otReloadCo','T\x20NULL\x20AND','636981KHjhRY','nitial\x20cle','at\x20path:\x20','d\x20unexpect','t\x20failed:\x20','E\x20messages','and\x20reply\x20','edia_path,','key','DEFAULT_SE','floor','repeat','NCURRENCY','eleted\x20mes','essageWork','IA_DIRNAME',')\x20ON\x20CONFL','stickerMes','0\x0a\x20\x20\x20\x20);','set','ailed\x20to\x20s','ed:\x20','QUEUE_MAX_','🗑\x20*','now','groupMetad','IES','has\x20no\x20col','tAlt','type','low','rocessDele','stamp,\x20med','eleteMessa','_path,\x20sav','[Delete]\x20M','\x20\x20\x20updated','mimetype','\x20remote_al','d\x20may\x20have','geToDB:\x20mi','\x20—\x20ensurin','geRow\x20erro','originalMe','DELETE_CLE','\x20messages\x20','ge_json,\x20m','keys','length','arget_jid\x20','\x20delete\x20g|','2534056uLSJLh','GROUP\x20(','sock','remoteJid','[Audio]','[Media]','\x20WHERE\x20msg','WHERE\x20save','INITIAL_BA','refs\x20(key,','ges\x20WHERE\x20','ecovered\x20o','string','bin','onWhatsApp','\x20CONFLICT(','🗨\x20Group:\x20','d\x20config.','map','ETRIES','TO\x20message','es\x20bot\x20arg','pping\x20reco','r\x20later\x20re','rwarded\x20fo','*Delete\x20Re','\x20\x20\x20\x20\x20\x20valu'];_0x12f4=function(){return _0x3c9263;};return _0x12f4();}(function(_0x2feb97,_0x3c7bf5){const _0x5f113a=_0xee59,_0x29ec0a=_0x2feb97();while(!![]){try{const _0x253782=-parseInt(_0x5f113a(0x2f7))/(-0x1*-0x112a+0xee7+0x26*-0xd8)*(parseInt(_0x5f113a(0x325))/(0x1d08+0x8a9*0x3+-0x3701))+-parseInt(_0x5f113a(0x245))/(-0xeb0+0x1741+-0x88e)+parseInt(_0x5f113a(0x328))/(-0x12*-0xfa+-0x1de+-0xfb2)+parseInt(_0x5f113a(0x1dd))/(-0x2cc*0x2+0x4*-0x8e9+0x2941)*(-parseInt(_0x5f113a(0x216))/(0x19ed+0xc1*-0x1+-0x1926))+-parseInt(_0x5f113a(0x278))/(-0x285+0x24bc+-0x4*0x88c)+-parseInt(_0x5f113a(0x1e9))/(0x33*-0xad+-0x1931+-0xbf0*-0x5)+parseInt(_0x5f113a(0x2f5))/(0x1bf3+0xe1e+0x2*-0x1504);if(_0x253782===_0x3c7bf5)break;else _0x29ec0a['push'](_0x29ec0a['shift']());}catch(_0x14b632){_0x29ec0a['push'](_0x29ec0a['shift']());}}}(_0x12f4,-0x28fec*0x1+-0x137*0x151+0x70fd0));import _0x4db3ea from'path';import _0x2b5464 from'fs/promises';import{createWriteStream}from'fs';import{pipeline}from'stream/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import _0x8e963d from'node-cache';import{isSudo}from'../utils/sudo.js';import{getBotJid,getBotJidRaw}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name=_0xd9310f(0x317)+_0xd9310f(0x22a);export const version='5.0.0';export const priority=0x4*-0x2b8+-0x1*0x98f+0x14a1;export const commands=[_0xd9310f(0x207)];export const configKeys=[_0xd9310f(0x1d5)+_0xd9310f(0x254),'DELETE_DEB'+_0xd9310f(0x22d),_0xd9310f(0x1a0)+_0xd9310f(0x1cd),_0xd9310f(0x24e)+_0xd9310f(0x1bb),_0xd9310f(0x271)+_0xd9310f(0x17a),'DELETE_CLE'+_0xd9310f(0x226)+_0xd9310f(0x2ed),_0xd9310f(0x2cb)+_0xd9310f(0x1d1)+'E'];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':_0xd9310f(0x315),'DEFAULT_CONCURRENCY':0x2,'CLEANUP_INTERVAL_MS':(-0x3*0xaa5+0x1337*0x2+0x679*-0x1)*(-0x1d99+-0x21c8+0x1*0x3f9d)*(0x6a8+0x2036+-0x26a2)*(0x1b*-0x115+-0x5*0x2e2+0x2f89),'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'CLEANUP_DAYS':0x3,'QUEUE_MAX_SIZE':0x1f4};let botRef=null,cleanupInterval=null;const messageQueue=[],deletionQueue=[];let activeMessageTasks=0x6*0xf1+0x405+-0x5*0x1ef,activeDeletionTasks=-0x1*-0x1397+-0x243a*-0x1+-0x37d1,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS[_0xd9310f(0x2cf)+'S'],CONCURRENCY=FALLBACKS['DEFAULT_CO'+_0xd9310f(0x251)],MEDIA_SEND_DELAY_MS=FALLBACKS[_0xd9310f(0x20a)+_0xd9310f(0x323)],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_IN'+_0xd9310f(0x227)],MAX_SEND_RETRIES=FALLBACKS[_0xd9310f(0x32e)+_0xd9310f(0x28b)],INITIAL_BACKOFF=FALLBACKS[_0xd9310f(0x280)+_0xd9310f(0x2b2)],DELETE_CLEANUP_DAYS=FALLBACKS[_0xd9310f(0x2c9)+'YS'],QUEUE_MAX_SIZE=FALLBACKS['QUEUE_MAX_'+_0xd9310f(0x2a0)],DEFAULT_SEND_DELETE=![],DELETE_MODE='p',TARGET_JID=null;const nameCache=new _0x8e963d({'stdTTL':0xe10});let flushTimer=null;const pendingRecovered=[];async function ensureDir(_0x522dab){const _0x3b83db=_0xd9310f;try{await _0x2b5464['access'](_0x522dab);}catch(_0x429976){if(_0x429976[_0x3b83db(0x2de)]===_0x3b83db(0x30c))await _0x2b5464[_0x3b83db(0x30e)](_0x522dab,{'recursive':!![]});else throw _0x429976;}}function sleep(_0x4cee0d){return new Promise(_0x4a29b1=>setTimeout(_0x4a29b1,_0x4cee0d));}function normalizeToUserJid(_0x56bec7){const _0x4a0187=_0xd9310f;try{if(!_0x56bec7||typeof _0x56bec7!==_0x4a0187(0x284))return _0x56bec7;const _0x31e6de=_0x56bec7[_0x4a0187(0x311)]('@');if(_0x31e6de===-(-0x50a+-0x1291+0x179c))return _0x56bec7;const _0x38cbbf=_0x56bec7[_0x4a0187(0x21a)](-0x175*0x18+-0x19*0x182+0x1*0x48aa,_0x31e6de),_0x4081e7=_0x56bec7[_0x4a0187(0x21a)](_0x31e6de),_0x265db7=_0x38cbbf['indexOf'](':');if(_0x265db7===-(0x23f6+-0x2f9*-0x3+0x4*-0xb38))return _0x56bec7;return _0x38cbbf[_0x4a0187(0x21a)](-0x556+0x1720+-0x11ca,_0x265db7)+_0x4081e7;}catch(_0x2dc8c5){return _0x56bec7;}}async function refreshConfig(){const _0x572732=_0xd9310f;try{const _0x4a554=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x4a554[_0x572732(0x24e)+_0x572732(0x1bb)]===_0x572732(0x1e0)?_0x4a554[_0x572732(0x24e)+_0x572732(0x1bb)]:DEFAULT_SEND_DELETE,DEBOUNCE_DELAY_MS=Number(_0x4a554[_0x572732(0x1fb)+_0x572732(0x22d)]??FALLBACKS[_0x572732(0x2cf)+'S']),CONCURRENCY=Number(_0x4a554[_0x572732(0x1a0)+_0x572732(0x1cd)]??_0x4a554['MODULE_CON'+'CURRENCY_L'+_0x572732(0x314)]??FALLBACKS[_0x572732(0x1dc)+'NCURRENCY']),MEDIA_SEND_DELAY_MS=Number(_0x4a554[_0x572732(0x1d5)+_0x572732(0x19c)+_0x572732(0x326)]??FALLBACKS['MEDIA_SEND'+_0x572732(0x323)]),CLEANUP_INTERVAL=Number(_0x4a554[_0x572732(0x271)+_0x572732(0x226)+_0x572732(0x2ed)]??FALLBACKS[_0x572732(0x1a2)+_0x572732(0x227)]),MAX_SEND_RETRIES=Number(_0x4a554['DELETE_MAX'+_0x572732(0x191)+_0x572732(0x25f)]??FALLBACKS['MAX_SEND_R'+_0x572732(0x28b)]),INITIAL_BACKOFF=Number(_0x4a554[_0x572732(0x206)+'TIAL_BACKO'+_0x572732(0x225)]??FALLBACKS[_0x572732(0x280)+_0x572732(0x2b2)]),DELETE_CLEANUP_DAYS=Number(_0x4a554['DELETE_CLE'+_0x572732(0x17a)]??FALLBACKS[_0x572732(0x2c9)+'YS']),QUEUE_MAX_SIZE=Number(_0x4a554[_0x572732(0x2cb)+_0x572732(0x1d1)+'E']??FALLBACKS[_0x572732(0x25b)+_0x572732(0x2a0)]);const _0x414b2d=_0x4a554[_0x572732(0x2bf)+'OT']&&typeof _0x4a554['PROJECT_RO'+'OT']===_0x572732(0x284)?_0x4a554[_0x572732(0x2bf)+'OT']:process[_0x572732(0x1ea)](),_0x4dd2b0=_0x4db3ea[_0x572732(0x2cd)](_0x414b2d,_0x572732(0x1b6),_0x572732(0x207));await ensureDir(_0x4dd2b0),MEDIA_DIR=_0x4db3ea[_0x572732(0x229)](_0x4dd2b0,_0x4a554['DELETE_MED'+_0x572732(0x254)]??_0x4a554[_0x572732(0x1d5)+_0x572732(0x1a1)]??FALLBACKS[_0x572732(0x2d9)+'AME']),await ensureDir(MEDIA_DIR);}catch(_0x144b52){warn(_0x572732(0x2df)+'efreshConf'+_0x572732(0x2d6)+(_0x144b52?.[_0x572732(0x2c8)]||_0x144b52));}}try{hotReloadConfig&&hotReloadConfig(()=>{const _0x551502=_0xd9310f;refreshConfig(),info('[Delete]\x20H'+_0x551502(0x17c)+_0x551502(0x289));});}catch(_0x2e9978){warn(_0xd9310f(0x2a4)+_0xd9310f(0x243)+'nfig\x20regis'+_0xd9310f(0x204)+'iled:\x20'+(_0x2e9978?.[_0xd9310f(0x2c8)]||_0x2e9978));}refreshConfig();function _0xee59(_0x3510be,_0xc0e8a6){const _0x2e489a=_0x12f4();return _0xee59=function(_0x188788,_0x226a77){_0x188788=_0x188788-(-0xb1b+0x23a4+0x7b5*-0x3);let _0x240550=_0x2e489a[_0x188788];return _0x240550;},_0xee59(_0x3510be,_0xc0e8a6);}const MESSAGES_COLUMNS={'msg_id':_0xd9310f(0x234)+_0xd9310f(0x29f),'chat_jid':_0xd9310f(0x2ac),'remote_alt':'TEXT','sender_jid':_0xd9310f(0x2ac),'participant_alt':_0xd9310f(0x2ac),'message_json':_0xd9310f(0x2ac),'timestamp':_0xd9310f(0x170),'media_path':_0xd9310f(0x2ac),'saved_at':_0xd9310f(0x170),'resent_at':_0xd9310f(0x170)};async function ensureTable(){const _0x52a983=_0xd9310f;try{const _0x3d77c1=Object['entries'](MESSAGES_COLUMNS)[_0x52a983(0x28a)](([_0x21003e,_0x3003dd])=>_0x21003e+'\x20'+_0x3003dd)[_0x52a983(0x229)](_0x52a983(0x1c1));await db['exec'](_0x52a983(0x1ae)+_0x52a983(0x20b)+_0x52a983(0x310)+_0x52a983(0x19e)+_0x3d77c1+'\x0a);');let _0x57b475=[];try{const _0x450ad1=await db['all'](_0x52a983(0x193)+_0x52a983(0x1a5)+_0x52a983(0x2d0));_0x57b475=(_0x450ad1||[])[_0x52a983(0x28a)](_0x597d75=>_0x597d75['name']);}catch(_0x22ee9e){warn('[Delete]\x20P'+'RAGMA\x20tabl'+_0x52a983(0x1eb)+'led:\x20'+(_0x22ee9e?.['message']||_0x22ee9e));}for(const _0x9597fc of Object[_0x52a983(0x274)](MESSAGES_COLUMNS)){if(!_0x57b475['includes'](_0x9597fc)){const _0x29cc12=MESSAGES_COLUMNS[_0x9597fc];try{await db[_0x52a983(0x29e)]('ALTER\x20TABL'+_0x52a983(0x24a)+_0x52a983(0x222)+'N\x20'+_0x9597fc+'\x20'+_0x29cc12),info(_0x52a983(0x32f)+_0x52a983(0x2c7)+'ng\x20column\x20'+_0x52a983(0x19a)+_0x9597fc);}catch(_0x7df8fa){warn(_0x52a983(0x2f8)+_0x52a983(0x1f3)+_0x52a983(0x1fa)+_0x9597fc+':\x20'+(_0x7df8fa?.[_0x52a983(0x2c8)]||_0x7df8fa));}}}await db[_0x52a983(0x209)](_0x52a983(0x1ae)+_0x52a983(0x20b)+_0x52a983(0x304)+_0x52a983(0x23e)+_0x52a983(0x18a)+_0x52a983(0x23b)+'MARY\x20KEY,\x0a'+_0x52a983(0x292)+_0x52a983(0x1a4)+'\x20NULL,\x0a\x20\x20\x20'+_0x52a983(0x269)+'_at\x20INTEGE'+_0x52a983(0x2fe)+_0x52a983(0x257));try{const _0x423508=await db['get'](_0x52a983(0x171)+_0x52a983(0x179)+_0x52a983(0x2b0)+_0x52a983(0x232)+'=\x27mode\x27');if(!_0x423508){const _0x5c36f0=Math[_0x52a983(0x24f)](Date[_0x52a983(0x25d)]()/(0xb12+-0x126*0x3+-0x3b8));await db['run'](_0x52a983(0x31d)+_0x52a983(0x1b1)+_0x52a983(0x281)+'\x20value,\x20up'+_0x52a983(0x2c5)+_0x52a983(0x2dc)+_0x52a983(0x18d)+'?)',[_0x5c36f0]),DELETE_MODE='p';}else DELETE_MODE=_0x423508[_0x52a983(0x2ba)]==='g'?'g':'p';}catch(_0xf0731b){warn('[Delete]\x20p'+_0x52a983(0x180)+_0x52a983(0x220)+'led:\x20'+(_0xf0731b?.[_0x52a983(0x2c8)]||_0xf0731b));}try{const _0x3e702a=await db['get'](_0x52a983(0x171)+_0x52a983(0x179)+_0x52a983(0x2b0)+_0x52a983(0x232)+_0x52a983(0x2b8)+_0x52a983(0x199));TARGET_JID=_0x3e702a?.['value']||null;}catch(_0x4bb753){warn(_0x52a983(0x240)+_0x52a983(0x276)+_0x52a983(0x2cc)+_0x52a983(0x202)+(_0x4bb753?.[_0x52a983(0x2c8)]||_0x4bb753)),TARGET_JID=null;}}catch(_0xb1ef89){warn(_0x52a983(0x316)+_0x52a983(0x2b5)+_0x52a983(0x1ca)+':\x20'+(_0xb1ef89?.[_0x52a983(0x2c8)]||_0xb1ef89));throw _0xb1ef89;}}async function streamMediaToFile(_0xd092de,_0x8a7099){const _0x4ab6b0=_0xd9310f;try{const _0x5dff4c=_0xd092de[_0x4ab6b0(0x2c8)][_0x8a7099+'Message'],_0x44a1a9=await downloadContentFromMessage(_0x5dff4c,_0x8a7099);let _0x147dcc=_0x4ab6b0(0x285);if(_0x8a7099==='image')_0x147dcc='jpg';else{if(_0x8a7099===_0x4ab6b0(0x31e)||_0x8a7099==='ptv')_0x147dcc='mp4';else{if(_0x8a7099===_0x4ab6b0(0x298))_0x147dcc=_0x4ab6b0(0x296);else{if(_0x8a7099==='document')_0x147dcc=_0x5dff4c?.[_0x4ab6b0(0x1b3)]?_0x5dff4c[_0x4ab6b0(0x1b3)]['split']('.')[_0x4ab6b0(0x319)]():_0x4ab6b0(0x177);else{if(_0x8a7099===_0x4ab6b0(0x242))_0x147dcc='webp';}}}}const _0x2b1991=_0xd092de[_0x4ab6b0(0x24d)]['id']+'.'+_0x147dcc,_0x352d91=_0x4db3ea['join'](MEDIA_DIR,_0x2b1991);await pipeline(_0x44a1a9,createWriteStream(_0x352d91));const _0x392be2=await _0x2b5464[_0x4ab6b0(0x201)](_0x352d91);if(_0x392be2[_0x4ab6b0(0x213)]===0x1a35*-0x1+-0x6f1*0x1+0x2126)return warn(_0x4ab6b0(0x1d4)+_0x4ab6b0(0x190)+_0x352d91+(_0x4ab6b0(0x185)+_0x4ab6b0(0x195))),await _0x2b5464['rm'](_0x352d91,{'force':!![]}),null;return _0x352d91;}catch(_0x3aae9d){return warn(_0x4ab6b0(0x1d4)+_0x4ab6b0(0x2e4)+_0x4ab6b0(0x18e)+'led\x20for\x20'+(_0xd092de[_0x4ab6b0(0x24d)]?.['id']||'[no-id]')+':\x20'+(_0x3aae9d?.['message']||_0x3aae9d)),null;}}async function maybeSaveMedia(_0x2543b7){const _0x4ade24=_0xd9310f;try{const _0x5b2226=[_0x4ade24(0x16e),'video',_0x4ade24(0x184),_0x4ade24(0x298),_0x4ade24(0x2b1),_0x4ade24(0x242)];for(const _0x2c1c37 of _0x5b2226){if(_0x2c1c37===_0x4ade24(0x184)){if(_0x2543b7[_0x4ade24(0x2c8)]?.['ptvMessage'])return await streamMediaToFile(_0x2543b7,_0x4ade24(0x184));continue;}if(_0x2543b7['message']?.[_0x2c1c37+'Message'])return await streamMediaToFile(_0x2543b7,_0x2c1c37);}return null;}catch(_0x5f0a4e){return warn(_0x4ade24(0x30f)+_0x4ade24(0x2f6)+_0x4ade24(0x181)+'\x20'+(_0x5f0a4e?.['message']||_0x5f0a4e)),null;}}async function insertMessageToDB(_0x9e7ddc,_0x20323b){const _0x409f56=_0xd9310f;try{if(!_0x9e7ddc||!_0x9e7ddc['key'])return;const {id:_0x474738,remoteJid:_0x1ce702,participant:_0x5a7e8c}=_0x9e7ddc[_0x409f56(0x24d)],_0x5c2dfc=_0x5a7e8c||_0x1ce702,_0x490122=typeof _0x9e7ddc['messageTim'+_0x409f56(0x30d)]===_0x409f56(0x2e7)?_0x9e7ddc['messageTim'+'estamp']:_0x9e7ddc[_0x409f56(0x16d)+_0x409f56(0x30d)]?.[_0x409f56(0x263)]||Math[_0x409f56(0x24f)](Date['now']()/(-0x117+0x2b1*0x9+0x133a*-0x1)),_0xdaa828=_0x9e7ddc[_0x409f56(0x24d)]?.['remoteJidA'+'lt']||null,_0xc4e423=_0x9e7ddc[_0x409f56(0x24d)]?.[_0x409f56(0x2b3)+_0x409f56(0x261)]||null,_0x390e3a=Math[_0x409f56(0x24f)](Date['now']()/(0x1*-0x55f+-0x1ebf+-0x1*-0x2806));if(!_0x474738){warn(_0x409f56(0x1fd)+'nsertMessa'+_0x409f56(0x26d)+'ssing\x20key.'+'id');return;}const _0x51ee37=_0x409f56(0x2d1)+_0x409f56(0x18f)+_0x409f56(0x28c)+_0x409f56(0x302)+_0x409f56(0x295)+_0x409f56(0x26b)+'t,\x20sender_'+_0x409f56(0x327)+_0x409f56(0x224)+_0x409f56(0x17d)+_0x409f56(0x300)+_0x409f56(0x265)+'ia_path,\x20s'+_0x409f56(0x2fb)+_0x409f56(0x1a8)+_0x409f56(0x20c)+_0x409f56(0x1ef)+_0x409f56(0x16f)+_0x409f56(0x237)+_0x409f56(0x2da),_0x36fef2=[_0x474738,_0x1ce702||null,_0xdaa828,_0x5c2dfc||null,_0xc4e423,JSON['stringify'](_0x9e7ddc),_0x490122,_0x20323b||null,_0x390e3a,null];try{await db[_0x409f56(0x29e)](_0x51ee37,_0x36fef2);}catch(_0x64db2b){const _0x3f1534=String(_0x64db2b?.['message']||'');if(_0x3f1534[_0x409f56(0x17b)](_0x409f56(0x260)+_0x409f56(0x215))){warn(_0x409f56(0x1fd)+_0x409f56(0x2ea)+'ed\x20due\x20mis'+_0x409f56(0x19b)+'n:\x20'+_0x3f1534+(_0x409f56(0x26e)+'g\x20table\x20an'+_0x409f56(0x1ff)));try{await ensureTable(),await db[_0x409f56(0x29e)](_0x51ee37,_0x36fef2);}catch(_0x2c23e5){warn(_0x409f56(0x2df)+_0x409f56(0x1c6)+_0x409f56(0x249)+(_0x2c23e5?.['message']||_0x2c23e5));}}else throw _0x64db2b;}}catch(_0x344641){warn('[Delete]\x20i'+_0x409f56(0x31a)+_0x409f56(0x2fc)+'led:\x20'+(_0x344641?.[_0x409f56(0x2c8)]||_0x344641));}}async function fetchOriginalMessage(_0xfe3d89){const _0x30a714=_0xd9310f;try{if(!_0xfe3d89)return null;const _0x124886=await db[_0x30a714(0x231)](_0x30a714(0x2b4)+_0x30a714(0x16b)+_0x30a714(0x273)+_0x30a714(0x24c)+_0x30a714(0x1f5)+_0x30a714(0x16c)+_0x30a714(0x282)+_0x30a714(0x2a5),[_0xfe3d89]);if(_0x124886)try{return{'msg_id':_0x124886[_0x30a714(0x196)],'message':JSON[_0x30a714(0x31c)](_0x124886[_0x30a714(0x312)+'on']),'media_path':_0x124886[_0x30a714(0x1a7)],'saved_at':_0x124886[_0x30a714(0x2b6)]};}catch(_0x210329){return{'msg_id':_0x124886[_0x30a714(0x196)],'message':null,'media_path':_0x124886[_0x30a714(0x1a7)],'saved_at':_0x124886['saved_at']};}return null;}catch(_0x4cf7c1){return warn(_0x30a714(0x2f8)+_0x30a714(0x1df)+_0x30a714(0x183)+'error:\x20'+(_0x4cf7c1?.[_0x30a714(0x2c8)]||_0x4cf7c1)),null;}}async function deleteMessageRow(_0x5f2ff0){const _0x214f58=_0xd9310f;try{if(!_0x5f2ff0)return;const _0x1b7d48=await db[_0x214f58(0x231)]('SELECT\x20med'+_0x214f58(0x228)+_0x214f58(0x294)+'s\x20WHERE\x20ms'+_0x214f58(0x2ab),[_0x5f2ff0]);if(_0x1b7d48?.[_0x214f58(0x1a7)])try{await _0x2b5464['rm'](_0x1b7d48[_0x214f58(0x1a7)],{'force':!![]});}catch(_0x3fb235){warn(_0x214f58(0x2f8)+_0x214f58(0x1e3)+'emove\x20file'+'\x20'+_0x1b7d48['media_path']+':\x20'+(_0x3fb235?.[_0x214f58(0x2c8)]||_0x3fb235));}await db[_0x214f58(0x29e)](_0x214f58(0x1c2)+'M\x20messages'+_0x214f58(0x27e)+'_id=?',[_0x5f2ff0]),info('[Delete]\x20d'+_0x214f58(0x252)+_0x214f58(0x2a9)+'\x20'+_0x5f2ff0);}catch(_0x552361){warn(_0x214f58(0x2db)+_0x214f58(0x266)+_0x214f58(0x26f)+_0x214f58(0x330)+(_0x552361?.[_0x214f58(0x2c8)]||_0x552361));}}async function sendWithRetry(_0x4d4943,_0x510ed1,_0x235dea=[]){const _0x1dc543=_0xd9310f,_0x266b35=Number(MAX_SEND_RETRIES||FALLBACKS[_0x1dc543(0x32e)+_0x1dc543(0x28b)]);let _0x58d632=0xa0+-0xc4d*0x2+-0x42*-0x5d,_0x453ec2=Number(INITIAL_BACKOFF||FALLBACKS[_0x1dc543(0x280)+'CKOFF_MS']);const _0x3442f7=[_0x4d4943,TARGET_JID,getBotJid()][_0x1dc543(0x1ba)](Boolean)[_0x1dc543(0x28a)](normalizeToUserJid),_0x171702=new Set(),_0x1d20d2=[];for(const _0x3af5fa of _0x3442f7){if(!_0x3af5fa)continue;!_0x171702[_0x1dc543(0x32c)](_0x3af5fa)&&(_0x171702[_0x1dc543(0x1e4)](_0x3af5fa),_0x1d20d2[_0x1dc543(0x1b8)](_0x3af5fa));}let _0x3f619d=_0x1d20d2[_0x1dc543(0x275)]?_0x1d20d2[0x2*0x90f+-0x1a7e+0x4*0x218]:null;if(_0x3f619d&&_0x3f619d['endsWith']('@lid')&&typeof botRef?.[_0x1dc543(0x27a)]?.['onWhatsApp']===_0x1dc543(0x189))try{const _0x204756=await botRef[_0x1dc543(0x27a)][_0x1dc543(0x286)](_0x3f619d);if(Array['isArray'](_0x204756)&&_0x204756[-0x1e29+-0xc1f*0x1+0x2c*0xf6]&&_0x204756[-0x89c*-0x1+0xd2+-0x96e][_0x1dc543(0x1a3)])_0x3f619d=normalizeToUserJid(_0x204756[0x606+0x19d8+-0x1fde][_0x1dc543(0x1a3)]);}catch(_0x49bf71){warn(_0x1dc543(0x307)+_0x1dc543(0x17e)+_0x1dc543(0x1b5)+_0x1dc543(0x297)+(_0x49bf71?.['message']||_0x49bf71));}while(_0x58d632<_0x266b35){try{if(!_0x3f619d)throw new Error('no\x20send\x20ta'+_0x1dc543(0x194)+'able');if(Array[_0x1dc543(0x18b)](_0x235dea)&&_0x235dea[_0x1dc543(0x275)]&&typeof _0x510ed1===_0x1dc543(0x1aa)&&_0x510ed1!==null)_0x510ed1['mentions']=_0x235dea;return await botRef[_0x1dc543(0x23d)+'e'](_0x3f619d,_0x510ed1),!![];}catch(_0x3bdf84){_0x58d632++;const _0x5a0392=String(_0x3bdf84?.['message']||'')[_0x1dc543(0x22e)+'e']()[_0x1dc543(0x17b)](_0x1dc543(0x308))||_0x3bdf84?.[_0x1dc543(0x1f0)]===0x823+0xb*-0x385+0x2041;warn(_0x1dc543(0x1d4)+'end\x20attemp'+'t\x20'+_0x58d632+'\x20to\x20'+_0x3f619d+_0x1dc543(0x1d8)+(_0x3bdf84?.[_0x1dc543(0x2c8)]||_0x3bdf84));if(_0x58d632>=_0x266b35||!_0x5a0392)return![];await sleep(_0x453ec2),_0x453ec2*=-0xe5+-0xa44*0x3+0x1fb3;}}return![];}function extractContent(_0x20b05c){const _0xb153aa=_0xd9310f;if(!_0x20b05c)return'';if(_0x20b05c[_0xb153aa(0x223)+'on'])return _0x20b05c['conversati'+'on'];if(_0x20b05c['extendedTe'+_0xb153aa(0x2f4)])return _0x20b05c[_0xb153aa(0x1af)+_0xb153aa(0x2f4)][_0xb153aa(0x1b4)];if(_0x20b05c[_0xb153aa(0x1ce)+'ge'])return _0x20b05c[_0xb153aa(0x1ce)+'ge'][_0xb153aa(0x1a9)]||'';if(_0x20b05c[_0xb153aa(0x1c7)+'ge'])return _0x20b05c[_0xb153aa(0x1c7)+'ge']['caption']||'';if(_0x20b05c[_0xb153aa(0x2fd)])return _0x20b05c[_0xb153aa(0x2fd)][_0xb153aa(0x1a9)]||'';if(_0x20b05c['audioMessa'+'ge'])return _0x20b05c[_0xb153aa(0x2c6)+'ge']?.['ptt']?_0xb153aa(0x2dd)+'e]':_0xb153aa(0x27c);if(_0x20b05c[_0xb153aa(0x2e5)+_0xb153aa(0x2e9)])return _0x20b05c[_0xb153aa(0x2e5)+_0xb153aa(0x2e9)][_0xb153aa(0x1b3)]||'';if(_0x20b05c[_0xb153aa(0x256)+_0xb153aa(0x1e7)])return'[Sticker]';if(_0x20b05c[_0xb153aa(0x1e2)+_0xb153aa(0x1b9)+'3'])return _0xb153aa(0x1f6)+(_0x20b05c[_0xb153aa(0x1e2)+_0xb153aa(0x1b9)+'3'][_0xb153aa(0x293)]||_0xb153aa(0x2a7))+']';return _0xb153aa(0x27d);}function isMediaMessage(_0x111493){const _0x535c14=_0xd9310f;if(!_0x111493)return![];const _0x191ca0=Object['keys'](_0x111493||{});for(const _0x1c31b0 of _0x191ca0){if(_0x1c31b0['endsWith']('Message')&&[_0x535c14(0x1ce)+'ge',_0x535c14(0x1c7)+'ge','audioMessa'+'ge','documentMe'+_0x535c14(0x2e9),_0x535c14(0x256)+_0x535c14(0x1e7),'ptvMessage'][_0x535c14(0x17b)](_0x1c31b0))return!![];}return![];}async function buildPayloadForSavedFile(_0x2789a0,_0x388a1d){const _0x562919=_0xd9310f,_0x3b7617=_0x388a1d?.[_0x562919(0x2c8)]||{},_0x2b7439=extractContent(_0x3b7617)||undefined;try{await _0x2b5464[_0x562919(0x174)](_0x2789a0);}catch(_0x2301e1){return warn(_0x562919(0x268)+_0x562919(0x173)+'not\x20found\x20'+_0x562919(0x247)+_0x2789a0),null;}if(_0x3b7617['stickerMes'+_0x562919(0x1e7)])return{'sticker':{'url':_0x2789a0}};if(_0x3b7617[_0x562919(0x2fd)])return{'video':{'url':_0x2789a0},'ptv':!![],'caption':_0x2b7439,'mimetype':_0x3b7617[_0x562919(0x2fd)]?.[_0x562919(0x26a)]};if(_0x3b7617[_0x562919(0x1c7)+'ge'])return{'video':{'url':_0x2789a0},'caption':_0x2b7439,'gifPlayback':!!_0x3b7617[_0x562919(0x1c7)+'ge']?.[_0x562919(0x2b7)+'k'],'mimetype':_0x3b7617[_0x562919(0x1c7)+'ge']?.[_0x562919(0x26a)]};if(_0x3b7617[_0x562919(0x1ce)+'ge'])return{'image':{'url':_0x2789a0},'caption':_0x2b7439};if(_0x3b7617[_0x562919(0x2c6)+'ge'])return{'audio':{'url':_0x2789a0},'ptt':!!_0x3b7617[_0x562919(0x2c6)+'ge']?.[_0x562919(0x236)],'mimetype':_0x3b7617[_0x562919(0x2c6)+'ge']?.[_0x562919(0x26a)],'seconds':_0x3b7617[_0x562919(0x2c6)+'ge']?.[_0x562919(0x221)]};if(_0x3b7617[_0x562919(0x2e5)+'ssage'])return{'document':{'url':_0x2789a0,'fileName':_0x3b7617['documentMe'+_0x562919(0x2e9)]?.['fileName']||_0x4db3ea['basename'](_0x2789a0)},'mimetype':_0x3b7617[_0x562919(0x2e5)+_0x562919(0x2e9)]?.[_0x562919(0x26a)],'caption':_0x3b7617['documentMe'+'ssage']?.[_0x562919(0x1a9)]||_0x2b7439};return{'document':{'url':_0x2789a0,'fileName':_0x4db3ea[_0x562919(0x2ee)](_0x2789a0)},'caption':_0x2b7439};}async function processDeletionItem(_0x2095f1){const _0x17a472=_0xd9310f;try{const _0x1aa1d4=_0x2095f1[_0x17a472(0x274)]||[];if(!_0x1aa1d4['length'])return;for(const _0x2bbda4 of _0x1aa1d4){const _0xd38044=await fetchOriginalMessage(_0x2bbda4['id']);if(!_0xd38044||!_0xd38044['message'])continue;const _0x5da84f=_0xd38044[_0x17a472(0x2c8)],_0x284e56=getBotJidRaw(),_0x3e7860=_0x5da84f['key']?.[_0x17a472(0x2b3)+'t']||_0x5da84f[_0x17a472(0x24d)]?.[_0x17a472(0x27b)];if(_0x5da84f[_0x17a472(0x24d)]?.['fromMe']||_0x3e7860===_0x284e56)continue;const _0x403450=_0x5da84f[_0x17a472(0x24d)]['participan'+'t']||_0x5da84f[_0x17a472(0x24d)]['remoteJid'],_0x2c33d3=extractContent(_0x5da84f[_0x17a472(0x2c8)]);let _0x23956f=nameCache[_0x17a472(0x231)](_0x403450);if(!_0x23956f){try{const [_0x5ed971]=await botRef[_0x17a472(0x27a)]['onWhatsApp'](_0x403450);_0x23956f=_0x5ed971?.[_0x17a472(0x2d2)]||'~'+_0x403450[_0x17a472(0x2bd)]('@')[-0x55*-0x3c+-0xc07+-0x7e5];}catch{_0x23956f='~'+_0x403450[_0x17a472(0x2bd)]('@')[-0x1*-0x1bf7+-0x24a9*-0x1+-0xb0*0x5e];}nameCache[_0x17a472(0x258)](_0x403450,_0x23956f);}let _0x3efc9f='';if(isJidGroup(_0x5da84f['key'][_0x17a472(0x27b)]))try{_0x3efc9f=(await botRef[_0x17a472(0x27a)][_0x17a472(0x25e)+_0x17a472(0x187)](_0x5da84f[_0x17a472(0x24d)][_0x17a472(0x27b)]))[_0x17a472(0x198)];}catch{_0x3efc9f='[Unknown\x20G'+_0x17a472(0x1e6);}deletionPush({'msg_id':_0xd38044[_0x17a472(0x196)],'sender':_0x403450,'name':_0x23956f,'group':_0x3efc9f,'content':_0x2c33d3,'mediaPath':_0xd38044[_0x17a472(0x1a7)]||null,'originalMessage':_0x5da84f});}}catch(_0xb6116b){warn('[Delete]\x20p'+_0x17a472(0x264)+_0x17a472(0x306)+_0x17a472(0x2ad)+(_0xb6116b?.[_0x17a472(0x2c8)]||_0xb6116b));}}async function deletionWorker(){const _0x55dded=_0xd9310f,_0x44cb07=CONCURRENCY||FALLBACKS[_0x55dded(0x1dc)+_0x55dded(0x251)];while(deletionQueue['length']>-0xf84+0x1ee7+-0xf63*0x1&&activeDeletionTasks<_0x44cb07){const _0x4acdec=deletionQueue[_0x55dded(0x19d)]();if(!_0x4acdec)break;activeDeletionTasks++,((async()=>{const _0x1285c7=_0x55dded;try{await processDeletionItem(_0x4acdec);}catch(_0x373ba0){warn(_0x1285c7(0x2db)+_0x1285c7(0x2c1)+_0x1285c7(0x2ca)+_0x1285c7(0x2ad)+(_0x373ba0?.[_0x1285c7(0x2c8)]||_0x373ba0));}finally{activeDeletionTasks--,setImmediate(()=>{const _0x15951f=_0x1285c7;if(deletionQueue[_0x15951f(0x275)])deletionWorker()['catch'](()=>{});});}})());}}function deletionPush(_0x249a85){pendingRecovered['push'](_0x249a85),clearTimeout(flushTimer),flushTimer=setTimeout(()=>{const _0x285685=_0xee59,_0x3a2a26=pendingRecovered[_0x285685(0x16a)](-0x1147+-0x1e52+0x1*0x2f99,pendingRecovered[_0x285685(0x275)]);((async()=>{const _0x592abb=_0x285685;try{await flushRecoveredBatch(_0x3a2a26);}catch(_0x87dc29){warn(_0x592abb(0x2f8)+'lushRecove'+_0x592abb(0x1bf)+_0x592abb(0x2ad)+(_0x87dc29?.[_0x592abb(0x2c8)]||_0x87dc29));}})());},DEBOUNCE_DELAY_MS||FALLBACKS['DEBOUNCE_M'+'S']);}function resolveDeleteTarget(_0x39cd02){const _0xb4c141=getBotJid();if(DELETE_MODE==='g'&&TARGET_JID){if(TARGET_JID===_0x39cd02)return _0xb4c141;return TARGET_JID;}return _0xb4c141;}async function saveDeleteMode(_0x81af85){const _0x46e6fc=_0xd9310f;try{const _0x2d36ec=_0x81af85==='g'?'g':'p',_0x1ea45b=Math[_0x46e6fc(0x24f)](Date[_0x46e6fc(0x25d)]()/(0x1fe3+0xa4d+-0x2648));return await db[_0x46e6fc(0x29e)](_0x46e6fc(0x31d)+_0x46e6fc(0x1b1)+'refs\x20(key,'+_0x46e6fc(0x2f2)+_0x46e6fc(0x2c5)+_0x46e6fc(0x2dc)+_0x46e6fc(0x175)+_0x46e6fc(0x255)+_0x46e6fc(0x32b)+_0x46e6fc(0x2ef)+_0x46e6fc(0x29b)+_0x46e6fc(0x176)+_0x46e6fc(0x192)+'ed_at=excl'+_0x46e6fc(0x2e3)+_0x46e6fc(0x20e),[_0x2d36ec,_0x1ea45b]),DELETE_MODE=_0x2d36ec,info(_0x46e6fc(0x30f)+'ode\x20saved:'+'\x20'+DELETE_MODE),!![];}catch(_0x433c1e){return warn(_0x46e6fc(0x1d4)+_0x46e6fc(0x233)+_0x46e6fc(0x1c4)+':\x20'+(_0x433c1e?.[_0x46e6fc(0x2c8)]||_0x433c1e)),![];}}async function saveDeleteTarget(_0x131d59){const _0x4b8612=_0xd9310f;try{const _0x5887d3=Math['floor'](Date[_0x4b8612(0x25d)]()/(-0x270*0x10+-0x2201+0x4ce9));if(!_0x131d59)return await db[_0x4b8612(0x29e)](_0x4b8612(0x1c2)+_0x4b8612(0x1d0)+'refs\x20WHERE'+_0x4b8612(0x218)+'et_jid\x27'),TARGET_JID=null,info('[Delete]\x20t'+_0x4b8612(0x276)+_0x4b8612(0x305)),!![];else{const _0x460138=normalizeToUserJid(_0x131d59);return await db['run'](_0x4b8612(0x31d)+'O\x20delete_p'+_0x4b8612(0x281)+_0x4b8612(0x2f2)+_0x4b8612(0x2c5)+'VALUES\x20(\x27t'+_0x4b8612(0x1d6)+_0x4b8612(0x2a6)+_0x4b8612(0x287)+_0x4b8612(0x1b7)+_0x4b8612(0x2f0)+_0x4b8612(0x208)+'ded.value,'+'\x20updated_a'+_0x4b8612(0x32d)+_0x4b8612(0x200)+'t',[_0x460138,_0x5887d3]),TARGET_JID=_0x460138,info(_0x4b8612(0x240)+_0x4b8612(0x276)+_0x4b8612(0x23f)+TARGET_JID),!![];}}catch(_0x2c309e){return warn('[Delete]\x20s'+_0x4b8612(0x21c)+'arget\x20fail'+_0x4b8612(0x25a)+(_0x2c309e?.[_0x4b8612(0x2c8)]||_0x2c309e)),![];}}async function flushRecoveredBatch(_0x1d2024){const _0x199989=_0xd9310f;if(!_0x1d2024||_0x1d2024[_0x199989(0x275)]===0x8*-0xfb+-0xf04+-0xd1*-0x1c)return;if(!DEFAULT_SEND_DELETE){info(_0x199989(0x1f1)+_0x199989(0x23c)+_0x199989(0x1d9)+'alse\x20—\x20ski'+_0x199989(0x28e)+_0x199989(0x1d2)+'s.');return;}const _0x15d5b1=_0x1d2024[_0x199989(0x1da)](_0x4e9fc3=>_0x4e9fc3['originalMe'+_0x199989(0x2e9)])?.[_0x199989(0x270)+_0x199989(0x2e9)]?.['key']?.[_0x199989(0x27b)]||null,_0x108cf2=resolveDeleteTarget(_0x15d5b1)||getBotJid();if(!_0x108cf2){warn(_0x199989(0x1ab)+_0x199989(0x2af)+_0x199989(0x309)+'ble');return;}const _0x2ed450=[...new Set(_0x1d2024[_0x199989(0x28a)](_0x2349be=>_0x2349be[_0x199989(0x205)]))],_0x551497=_0x1d2024[_0x199989(0x28a)](_0x55444b=>_0x199989(0x31f)+_0x55444b['sender'][_0x199989(0x2bd)]('@')[-0x107*-0x1+-0x1*-0x1485+0x2*-0xac6]+'\x20('+_0x55444b[_0x199989(0x293)]+')\x0a'+(_0x55444b['group']?_0x199989(0x288)+_0x55444b[_0x199989(0x1a6)]+'\x0a':'')+(_0x199989(0x1bc)+'\x20'+_0x55444b[_0x199989(0x17f)]+'\x0a')+'─'[_0x199989(0x250)](-0x92*-0x2+0x17bd+-0x18c8))[_0x199989(0x229)]('\x0a'),_0x1a0f1e=_0x199989(0x25c)+_0x1d2024[_0x199989(0x275)]+('\x20DELETED\x20M'+'ESSAGES\x20RE'+'COVERED*\x20🗑'+'\x0a\x0a');try{const _0x550075=await sendWithRetry(_0x108cf2,{'text':_0x1a0f1e+_0x551497},_0x2ed450);if(!_0x550075)warn(_0x199989(0x1d4)+'ummary\x20sen'+_0x199989(0x26c)+'\x20failed');}catch(_0x2b2c14){warn(_0x199989(0x1d4)+_0x199989(0x301)+_0x199989(0x248)+_0x199989(0x197)+(_0x2b2c14?.[_0x199989(0x2c8)]||_0x2b2c14));}for(const _0x1b653c of _0x1d2024){try{const _0x32d274=_0x1b653c[_0x199989(0x20f)],_0x262570=_0x1b653c['originalMe'+_0x199989(0x2e9)],_0x3f37b1=!!_0x32d274||isMediaMessage(_0x262570?.[_0x199989(0x2c8)]);if(!_0x3f37b1){try{await deleteMessageRow(_0x1b653c['msg_id']);}catch(_0xd34c9){}continue;}const _0x354213=_0x262570?.[_0x199989(0x24d)]?.['id']||_0x199989(0x211),_0x169d8c=await buildPayloadForSavedFile(_0x32d274,_0x262570);if(_0x169d8c){const _0x272bfb=await sendWithRetry(_0x108cf2,_0x169d8c);if(_0x272bfb){info(_0x199989(0x2df)+_0x199989(0x2a1)+_0x199989(0x2ec)+_0x199989(0x31b)+_0x354213+_0x199989(0x1cb)+_0x108cf2),await deleteMessageRow(_0x1b653c[_0x199989(0x196)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x199989(0x20a)+_0x199989(0x323)]);continue;}else warn(_0x199989(0x30f)+_0x199989(0x203)+_0x199989(0x235)+'\x20'+_0x354213+'.');}try{const _0x372096=await sendWithRetry(_0x108cf2,{'forward':_0x262570});if(_0x372096){info(_0x199989(0x2df)+_0x199989(0x283)+'riginal\x20fo'+_0x199989(0x290)+'r\x20'+_0x354213+_0x199989(0x1cb)+_0x108cf2),await deleteMessageRow(_0x1b653c[_0x199989(0x196)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x199989(0x20a)+'_DELAY_MS']);continue;}}catch(_0x22a9ca){warn(_0x199989(0x1db)+_0x199989(0x1ad)+'ard\x20error:'+'\x20'+(_0x22a9ca?.[_0x199989(0x2c8)]||_0x22a9ca));}warn(_0x199989(0x172)+'nable\x20to\x20d'+'eliver\x20med'+_0x199989(0x1f2)+_0x354213+(_0x199989(0x22b)+_0x199989(0x1c9)+'d).\x20Leavin'+'g\x20in\x20DB\x20fo'+_0x199989(0x28f)+'try/cleanu'+'p.'));}catch(_0x1edd49){warn(_0x199989(0x2f8)+_0x199989(0x2a8)+_0x199989(0x2d8)+':\x20'+(_0x1edd49?.[_0x199989(0x2c8)]||_0x1edd49));}}}async function rawMessagesUpsertHandler({messages:_0xf81f3}){const _0x2d9f88=_0xd9310f;try{if(!_0xf81f3||!Array['isArray'](_0xf81f3))return;for(const _0x426e6e of _0xf81f3){if(!_0x426e6e||!_0x426e6e['message']||_0x426e6e[_0x2d9f88(0x24d)]?.[_0x2d9f88(0x27b)]===_0x2d9f88(0x212)+'adcast')continue;if(_0x426e6e['key']?.[_0x2d9f88(0x1fe)])continue;if(messageQueue[_0x2d9f88(0x275)]>=QUEUE_MAX_SIZE){warn(_0x2d9f88(0x268)+'essage\x20sav'+_0x2d9f88(0x2e2)+_0x2d9f88(0x219)+messageQueue[_0x2d9f88(0x275)]+(').\x20Droppin'+'g\x20incoming'+_0x2d9f88(0x2fa)));continue;}messageQueue[_0x2d9f88(0x1b8)](_0x426e6e),setImmediate(()=>{const _0x55c80e=_0x2d9f88;messageWorker()[_0x55c80e(0x2ff)](()=>{});});const _0x372767=_0x426e6e[_0x2d9f88(0x2c8)]?.[_0x2d9f88(0x1ac)+_0x2d9f88(0x2e9)];if(_0x372767?.[_0x2d9f88(0x262)]===-0x1*0x1dfb+-0x42c*0x5+0x32d7&&_0x372767?.[_0x2d9f88(0x24d)]){if(deletionQueue[_0x2d9f88(0x275)]>=QUEUE_MAX_SIZE){warn(_0x2d9f88(0x1f1)+_0x2d9f88(0x2bc)+_0x2d9f88(0x241)+_0x2d9f88(0x21f)+_0x2d9f88(0x2c3)+deletionQueue[_0x2d9f88(0x275)]+(_0x2d9f88(0x2ce)+'g\x20deletion'+'\x20event.'));continue;}deletionQueue[_0x2d9f88(0x1b8)]({'keys':[_0x372767[_0x2d9f88(0x24d)]],'remoteJid':_0x426e6e['key'][_0x2d9f88(0x27b)]}),setImmediate(()=>{const _0x119e5e=_0x2d9f88;deletionWorker()[_0x119e5e(0x2ff)](()=>{});});}}}catch(_0x63bce5){warn(_0x2d9f88(0x2df)+_0x2d9f88(0x1ee)+'UpsertHand'+'ler\x20error:'+'\x20'+(_0x63bce5?.[_0x2d9f88(0x2c8)]||_0x63bce5));}}async function processMessageItem(_0x20c07b){const _0x1f3d41=_0xd9310f;try{if(!_0x20c07b||!_0x20c07b['message']||_0x20c07b[_0x1f3d41(0x24d)]?.[_0x1f3d41(0x1fe)])return;const _0x1ad5bf=await maybeSaveMedia(_0x20c07b);await insertMessageToDB(_0x20c07b,_0x1ad5bf);}catch(_0x434b4c){warn(_0x1f3d41(0x2e6)+_0x1f3d41(0x2c0)+_0x1f3d41(0x19f)+_0x1f3d41(0x1e8)+(_0x434b4c?.[_0x1f3d41(0x2c8)]||_0x434b4c));}}async function messageWorker(){const _0x23ef2d=_0xd9310f,_0xaa11a7=CONCURRENCY||FALLBACKS[_0x23ef2d(0x1dc)+_0x23ef2d(0x251)];while(messageQueue[_0x23ef2d(0x275)]>0x1*0x92b+-0x2*0x99b+0x1*0xa0b&&activeMessageTasks<_0xaa11a7){const _0x398cfd=messageQueue[_0x23ef2d(0x19d)]();if(!_0x398cfd)break;activeMessageTasks++,((async()=>{const _0x57f367=_0x23ef2d;try{await processMessageItem(_0x398cfd);}catch(_0x35c561){warn('[Delete]\x20m'+_0x57f367(0x253)+_0x57f367(0x2d3)+'ror:\x20'+(_0x35c561?.[_0x57f367(0x2c8)]||_0x35c561));}finally{activeMessageTasks--,setImmediate(()=>{const _0xe29556=_0x57f367;if(messageQueue[_0xe29556(0x275)])messageWorker()[_0xe29556(0x2ff)](()=>{});});}})());}}async function autoCleanOldMessagesSafe(){const _0xca0098=_0xd9310f;try{await autoCleanOldMessages();}catch(_0x3dfe1e){warn(_0xca0098(0x32f)+_0xca0098(0x21e)+_0xca0098(0x1f7)+'afe\x20error:'+'\x20'+(_0x3dfe1e?.['message']||_0x3dfe1e));}}async function autoCleanOldMessages(){const _0x50c90c=_0xd9310f;try{const _0x1eb95d=Math[_0x50c90c(0x24f)](Date['now']()/(-0x2*-0xa22+0x1ea4+0x1780*-0x2))-Number(DELETE_CLEANUP_DAYS||FALLBACKS[_0x50c90c(0x2c9)+'YS'])*(0x38f*0x6+-0xe8f*0x1+-0x6b3)*(0x1a3d+0x168a+-0x308b)*(0x2135+-0xf21+-0x476*0x4),_0x4560f8=await db[_0x50c90c(0x30b)](_0x50c90c(0x2b4)+_0x50c90c(0x182)+_0x50c90c(0x267)+_0x50c90c(0x2ae)+_0x50c90c(0x272)+_0x50c90c(0x27f)+_0x50c90c(0x1c5)+_0x50c90c(0x244)+_0x50c90c(0x1f5)+'<\x20?',[_0x1eb95d]);if(!_0x4560f8||_0x4560f8[_0x50c90c(0x275)]===-0x1*-0x1405+0x4d+-0x1452*0x1)return;info(_0x50c90c(0x2aa)+_0x50c90c(0x324)+_0x4560f8[_0x50c90c(0x275)]+(_0x50c90c(0x21d)+_0x50c90c(0x313)+'\x20than\x20')+DELETE_CLEANUP_DAYS+_0x50c90c(0x210));for(const _0x4e8ff2 of _0x4560f8){if(_0x4e8ff2[_0x50c90c(0x1a7)])try{await _0x2b5464['rm'](_0x4e8ff2['media_path'],{'force':!![]});}catch(_0x232096){warn(_0x50c90c(0x2f8)+_0x50c90c(0x32a)+'ting\x20file\x20'+_0x4e8ff2[_0x50c90c(0x1a7)]+':\x20'+(_0x232096?.[_0x50c90c(0x2c8)]||_0x232096));}}const _0x1e03f2=_0x4560f8[_0x50c90c(0x28a)](_0xd92155=>_0xd92155[_0x50c90c(0x196)]),_0x5be6a6=-0xaba+-0xcfa*0x1+0x187c;for(let _0x4bb623=-0x61*0x1d+0x937+0x1c6;_0x4bb623<_0x1e03f2[_0x50c90c(0x275)];_0x4bb623+=_0x5be6a6){const _0x2ad201=_0x1e03f2[_0x50c90c(0x21a)](_0x4bb623,_0x4bb623+_0x5be6a6),_0x294432=_0x2ad201[_0x50c90c(0x28a)](()=>'?')[_0x50c90c(0x229)](',');await db[_0x50c90c(0x29e)](_0x50c90c(0x1c2)+_0x50c90c(0x29c)+'\x20WHERE\x20msg'+_0x50c90c(0x230)+_0x294432+')',_0x2ad201);}info('[Delete]\x20c'+'leanup\x20com'+_0x50c90c(0x1de));}catch(_0x3250d9){warn(_0x50c90c(0x32f)+_0x50c90c(0x21e)+_0x50c90c(0x1cf)+_0x50c90c(0x2c4)+(_0x3250d9?.[_0x50c90c(0x2c8)]||_0x3250d9));}}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(0x1c07+0x75*-0x2f+-0x66e)*(-0x7f8+-0x2*-0x1291+0x3d*-0x6a);function markCmdProcessed(_0x2c99dc){const _0x225a87=_0xd9310f;if(!_0x2c99dc)return;if(processedCmdKeys[_0x225a87(0x32c)](_0x2c99dc))try{clearTimeout(processedCmdKeys[_0x225a87(0x231)](_0x2c99dc));}catch(_0x1ad4f5){};const _0xc35094=setTimeout(()=>processedCmdKeys['delete'](_0x2c99dc),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x225a87(0x258)](_0x2c99dc,_0xc35094);}function isCmdProcessed(_0x59b2ae){const _0x530ccb=_0xd9310f;return _0x59b2ae&&processedCmdKeys[_0x530ccb(0x32c)](_0x59b2ae);}export async function onMessage(_0x3b6ffe){const _0x5d9a88=_0xd9310f;try{if(!_0x3b6ffe||!_0x3b6ffe['key']||!_0x3b6ffe['message']||!_0x3b6ffe[_0x5d9a88(0x322)])return;if(isJidGroup(_0x3b6ffe['key']['remoteJid']))return;const _0xa8ca9e=_0x3b6ffe[_0x5d9a88(0x24d)][_0x5d9a88(0x1fe)],_0x5992d6=await isSudo(botRef,_0x3b6ffe)[_0x5d9a88(0x2ff)](()=>![]);if(!_0xa8ca9e&&!_0x5992d6)return;let _0x4a6539=_0xa8ca9e?getBotJid():_0x3b6ffe[_0x5d9a88(0x24d)][_0x5d9a88(0x27b)];if(!_0x4a6539){warn(_0x5d9a88(0x2e8)+_0x5d9a88(0x329)+_0x5d9a88(0x1be)+_0x5d9a88(0x24b)+_0x5d9a88(0x2a2));return;}const _0x516880=String(_0x3b6ffe[_0x5d9a88(0x24d)][_0x5d9a88(0x27b)]||'')+'::'+String(_0x3b6ffe['key']['id']||_0x3b6ffe[_0x5d9a88(0x24d)]['participan'+'t']||'');if(isCmdProcessed(_0x516880))return;markCmdProcessed(_0x516880);const _0x2cdc4b=_0x3b6ffe[_0x5d9a88(0x1b4)]||'',_0x31d453=_0x2cdc4b['trim']()[_0x5d9a88(0x2bd)](/\s+/),_0x5c7163=(_0x31d453[0x133*0x3+-0x164b*0x1+-0x959*-0x2]||'')[_0x5d9a88(0x22e)+'e']();if(!commands[_0x5d9a88(0x17b)](_0x5c7163))return;const _0x2f0594=(_0x31d453[-0x1c18+0x2*0x9ef+0x83b]||'')[_0x5d9a88(0x22e)+'e']();if(_0x2f0594&&_0x2f0594[_0x5d9a88(0x17b)]('@')){const _0x2ecf5b=normalizeToUserJid(_0x2f0594),_0x561750=await saveDeleteTarget(_0x2ecf5b);await sendWithRetry(_0x4a6539,{'text':_0x561750?_0x5d9a88(0x2be)+_0x5d9a88(0x21b)+'saved:\x20'+_0x2ecf5b:'[delete]\x20F'+_0x5d9a88(0x259)+_0x5d9a88(0x23a)+_0x5d9a88(0x1d3)});return;}if([_0x5d9a88(0x1fc),_0x5d9a88(0x318),_0x5d9a88(0x178)][_0x5d9a88(0x17b)](_0x2f0594)){const _0x2cdf4b=await saveDeleteTarget(null);await sendWithRetry(_0x4a6539,{'text':_0x2cdf4b?_0x5d9a88(0x2be)+_0x5d9a88(0x21b)+_0x5d9a88(0x1ed):_0x5d9a88(0x18c)+_0x5d9a88(0x2f3)+'lear\x20targe'+'t\x20JID.'});return;}if(['p','pm'][_0x5d9a88(0x17b)](_0x2f0594)){await saveDeleteMode('p'),await sendWithRetry(_0x4a6539,{'text':'[delete]\x20M'+_0x5d9a88(0x238)+_0x5d9a88(0x1f4)});return;}if(['g',_0x5d9a88(0x1a6),'gp'][_0x5d9a88(0x17b)](_0x2f0594)){await saveDeleteMode('g');const _0x89a597=TARGET_JID?_0x5d9a88(0x1b0)+'\x20group:\x20'+TARGET_JID:_0x5d9a88(0x217)+_0x5d9a88(0x186)+_0x5d9a88(0x2e1);await sendWithRetry(_0x4a6539,{'text':_0x5d9a88(0x22c)+_0x5d9a88(0x238)+'\x20GROUP.\x20'+_0x89a597});return;}const _0x490bb0=DELETE_MODE==='g'?_0x5d9a88(0x279)+(TARGET_JID||_0x5d9a88(0x2d5))+')':'PM';await sendWithRetry(_0x4a6539,{'text':_0x5d9a88(0x291)+_0x5d9a88(0x1e1)+_0x5d9a88(0x2a3)+'Only)*\x0a\x0a'+_0x5d9a88(0x30a)+(_0x5d9a88(0x2c2)+_0x5d9a88(0x299)+_0x5d9a88(0x2b9)+'vered\x20to\x20b'+_0x5d9a88(0x188))+(_0x5d9a88(0x277)+_0x5d9a88(0x2e0)+_0x5d9a88(0x2b9)+'vered\x20to\x20a'+_0x5d9a88(0x29d))+(_0x5d9a88(0x239)+'id>\x20\x20\x20\x20\x20->'+_0x5d9a88(0x321)+'t\x20group\x20JI'+'D\x0a')+(_0x5d9a88(0x29a)+'ear\x20\x20\x20\x20\x20->'+_0x5d9a88(0x214)+_0x5d9a88(0x2d7)+'JID\x0a\x0a')+(_0x5d9a88(0x1ec)+'tatus:*\x0a')+(_0x5d9a88(0x1c3)+_0x5d9a88(0x2f1)+_0x490bb0+'*\x0a')+(_0x5d9a88(0x320)+'Active:\x20*'+DEFAULT_SEND_DELETE+'*\x0a')+(_0x5d9a88(0x1cc)+'fter:\x20*'+DELETE_CLEANUP_DAYS+_0x5d9a88(0x1c8))});}catch(_0x460876){error(_0x460876,_0x5d9a88(0x307)+_0x5d9a88(0x1e5)+_0x5d9a88(0x2ad)+(_0x460876?.[_0x5d9a88(0x2c8)]||_0x460876));}}export async function initialize(_0xf16217){const _0x1c9ad7=_0xd9310f;if(!_0xf16217)throw new Error('delete\x20mod'+_0x1c9ad7(0x303)+_0x1c9ad7(0x28d));botRef=_0xf16217,await refreshConfig(),await ensureTable()['catch'](_0x15ace2=>{const _0x358e6f=_0x1c9ad7;error(_0x358e6f(0x1f1)+'B\x20initiali'+_0x358e6f(0x1c0)+_0x358e6f(0x1b2)+_0x358e6f(0x2f9)+(_0x15ace2?.['message']||_0x15ace2));throw _0x15ace2;}),startManagedListener({'botRef':botRef,'eventName':_0x1c9ad7(0x2bb)+_0x1c9ad7(0x1bd),'handler':rawMessagesUpsertHandler,'moduleName':name}),await autoCleanOldMessagesSafe()[_0x1c9ad7(0x2ff)](_0xc668f1=>warn(_0x1c9ad7(0x1fd)+_0x1c9ad7(0x246)+_0x1c9ad7(0x1d7)+':\x20'+(_0xc668f1?.['message']||_0xc668f1)));if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(autoCleanOldMessagesSafe,CLEANUP_INTERVAL||FALLBACKS[_0x1c9ad7(0x1a2)+_0x1c9ad7(0x227)]),info(_0x1c9ad7(0x2eb)+'nitialized'+_0x1c9ad7(0x1f9)+DELETE_MODE+(_0x1c9ad7(0x2d4)+_0x1c9ad7(0x22f))+DELETE_CLEANUP_DAYS);}export async function cleanup(){const _0x442f46=_0xd9310f;try{stopManagedListener(name,_0x442f46(0x2bb)+'psert'),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null),messageQueue[_0x442f46(0x275)]=-0x109d+-0xb*-0x281+0xaee*-0x1,deletionQueue[_0x442f46(0x275)]=0x1*-0x185+0x6c9+0x1*-0x544,pendingRecovered[_0x442f46(0x275)]=-0x128b+0x1*0x196d+0x371*-0x2;}catch(_0x1955bc){warn(_0x442f46(0x2aa)+_0x442f46(0x1f8)+_0x442f46(0x20d)+(_0x1955bc?.['message']||_0x1955bc));}finally{botRef=null;}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};