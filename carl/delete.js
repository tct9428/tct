const _0xf7791e=_0x49c7;(function(_0x24b66c,_0x4182ac){const _0x59d45e=_0x49c7,_0x16ccaa=_0x24b66c();while(!![]){try{const _0x1d719d=-parseInt(_0x59d45e(0x262))/(-0xd4d*0x1+-0x2191*-0x1+-0x18f*0xd)+-parseInt(_0x59d45e(0x1e0))/(-0x246b+-0x6*0x4ed+0x13*0x379)*(-parseInt(_0x59d45e(0x2d1))/(0x8*-0x252+0x1e57+-0xbc4))+-parseInt(_0x59d45e(0x31f))/(0x119+0x9a*0x29+-0xd*0x1fb)*(parseInt(_0x59d45e(0x302))/(-0x1612+0x1dad+-0x796))+parseInt(_0x59d45e(0x2e8))/(-0xbbf+0x11f3*-0x2+0x2fab)*(-parseInt(_0x59d45e(0x282))/(0x2*0xae1+0x7b3+0x1*-0x1d6e))+-parseInt(_0x59d45e(0x1fc))/(0xc*-0x25b+-0x1*0xbd4+0x2820)*(parseInt(_0x59d45e(0x30a))/(0x1ed7+0x1d48+-0x3c16))+parseInt(_0x59d45e(0x321))/(0x69c+-0x3*-0x1eb+0xc53*-0x1)+-parseInt(_0x59d45e(0x310))/(-0x23*0x40+-0x43d*-0x1+0x48e)*(-parseInt(_0x59d45e(0x254))/(0x231b+-0x617*-0x2+-0x2f3d));if(_0x1d719d===_0x4182ac)break;else _0x16ccaa['push'](_0x16ccaa['shift']());}catch(_0x26246b){_0x16ccaa['push'](_0x16ccaa['shift']());}}}(_0x15af,-0x1112c5+-0xf16*0xf3+0x284451));import _0xca5806 from'path';import _0x49fbab from'fs/promises';import{createWriteStream}from'fs';import{pipeline}from'stream/promises';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import _0xd9b3ec from'node-cache';import{isSudo}from'../utils/sudo.js';import{getBotJid,getBotJidRaw}from'../utils/bot-state.js';function _0x15af(){const _0x389ced=['low','JID\x0a\x0a','VAL_MS','sticker','is\x20set.','edia\x20sent\x20','ailed\x20to\x20c','webp','R\x20DEFAULT\x20','DELETE_MAX','ANUP_INTER','le_info(\x27m','rwarded\x20fo','isArray','*Delete\x20Re','[Delete]\x20D','essages\x27)','\x20PM.','[Delete]\x20m','\x20to\x20','d\x20config.','target.','riginal\x20fo','t\x20JID.','=\x27mode\x27','messageTim','resolve','for\x20','ptt','[Delete]\x20h','mp4','ummary\x20sen','\x20Recovery\x20','status','nable\x20to\x20d','failed\x20for','\x20failed','ting\x20file\x20','saved:\x20','\x20Cleanup\x20A','nitialized','alue=exclu','[Delete]\x20f','DELETE_INI','INTEGER','Message','ror:\x20','splice','t,\x20sender_','PROJECT_RO','participan','\x20->\x20','json,\x20time','set','ble','ðŸ—‘\x20*','redBatch\x20e','e\x20TEXT\x20NOT','includes','find','[Delete]\x20I','\x20Send\x20Mode','iled:\x20','ND_DELETE','UpsertHand','ule\x20requir','geToDB\x20fai','vered\x20to\x20b','[no-id]','[Delete]\x20c','INSERT\x20INT','ete_prefs\x20','AME','cleared','protocolMe','ssing\x20key.','\x20saved_at\x20','(\x0a\x20\x20\x20\x20\x20\x20ke','1665724tWkOXp','CLEANUP_IN','ogg','stat','ges\x20(older','cipant_alt','get','d\x20may\x20have','videoMessa','=\x27target_j','_at\x20INTEGE','No\x20target\x20','[delete]\x20T','DELETE_CLE','T\x20NULL\x20AND',':\x20*','\x20full\x20(','ker\x20item\x20e','rocessMess','delete','_path,\x20sav','size','e_info\x20fai','t\x20group\x20JI','keys','remove','\x20top\x20error','nitial\x20cle','8YqjWAz','\x20set\x20targe','all','RY\x20KEY','\x20NULL,\x0a\x20\x20\x20','poll','repeat','tionItem\x20e','ailed\x20to\x20r','floor','@lid','DELETE_CON','VALUES\x20(\x27m','\x20clear\x20tar','id>\x20\x20\x20\x20\x20->','etry\x20inser','RAGMA\x20tabl','jid','s\x20(msg_id,','pdf','alMessage\x20','_id\x20IN\x20(','umn','?,\x20?,\x20?,\x20?','MARY\x20KEY,\x0a','ges\x20WHERE\x20','ageItem\x20er','join','ESSAGES\x20RE','y\x20TEXT\x20PRI','unset','\x20WHERE\x20msg','messages.u','FF_MS','ot-reloade','ge_json,\x20m','y:\x20','[Delete]\x20u','ed_at\x20FROM','[Delete]\x20o','WHERE\x20save','\x20ADD\x20COLUM','ðŸ—¨\x20Group:\x20','\x20send\x20reco','\x20than\x20','\x20group:\x20','xcluded.va','msg_id=?','covery\x20Set','access','nsertMessa','trim','basename','NCURRENCY','geRow\x20erro','ded.value,','tration\x20fa','imageMessa','efreshConf','or:\x20','MEDIA_SEND','MODULE_CON','dated_at)\x20','UE_MAX_SIZ','pm\x20\x20\x20\x20\x20\x20->','function','MAX_SEND_R','clear','text','messages.','[Media]','tAlt','stamp,\x20med','ot\x20PM\x0a','_DELAY_MS','DELETE_QUE','awMessages','t\x20failed:\x20','esent_at)\x0a','[Delete]\x20t','aved_at,\x20r','eletion\x20pr','t=excluded','video','[Delete]\x20C','Usage:\x0a','\x20â€”\x20ensurin','O\x20delete_p','14701452BKioEv','\x20delete\x20g|','nWhatsApp\x20','sages\x20(\x0a\x20\x20','nsert\x20fail','[Delete]\x20a','CURRENCY_L','ue\x20FROM\x20de','\x20delete\x20p|','DELETE_MED','stickerMes','\x20\x20\x20\x20\x20\x20valu','exec','lete_prefs','416959CTALhM','name','leanup\x20err','\x20deleting.','emove\x20file','r\x20later\x20re','dd\x20column\x20','TEXT\x20PRIMA','run','Active:\x20*','DELETE_DEB','\x20failed:\x20','shift','end\x20attemp','add','remoteJid','\x20delete\x20cl','OUNCE_MS','SELECT\x20med','\x20WHERE\x20key','[delete]\x20F','indexOf','ia_path,\x20s','o\x20send\x20tar','mapping\x20fa','treamMedia','\x0a);','utoCleanOl','\x20\x20\x20updated','isCommand','[delete]\x20M','string','158375GSIBHV','IMIT','ðŸ“\x20Content:','_id,\x20messa','caption','er\x20item\x20er','d).\x20Leavin','etchOrigin','ed:\x20','CURRENCY','DEFAULT_CO','VALUES\x20(\x27t','CREATE\x20TAB','dMessages\x20','sendMessag','sender','ToFile\x20fai','UES\x20(?,\x20?,','ed_at=excl','arget\x20fail','_id=?','\x20event.','ia\x20for\x20','pping\x20reco','gifPlaybac','ueue\x20is\x20fu','rocessDele','message','d:\x20','roup]','number','led:\x20','group\x20\x20\x20->','data','0\x0a\x20\x20\x20\x20);','INITIAL_BA','conversati','extendedTe','EXISTS\x20del','\x20?,\x20?,\x20?,\x20','SIZE','eleted\x20mes','jpg','tatus:*\x0a','sock','ig\x20error:\x20','ode\x20saved:','plete.','egacy\x20forw','ET\x20value=e','vered\x20to\x20a','pop','DATE\x20SET\x20v','document','\x20updated_a','Configured','refs\x20(mode','\x20GROUP.\x20','ailed\x20dele','vered\x20send','<\x20?','ng\x20column\x20','mimetype','onMessageV','SELECT\x20val','ptvMessage','B\x20initiali','D_DELETE\x20f','failed:\x20','\x20CONFLICT(','boolean','ANUP_DAYS','rget\x20avail','load\x20faile','xtMessage','pollCreati','DEFAULT_SE',')\x20ON\x20CONFL','bin','3WYewps','fromMe','group','g\x20in\x20DB\x20fo','documentMe','\x20days*','[Delete]\x20d','length','Only)*\x0a\x0a','.\x20Mode:\x20','Days:\x20','d\x20retry','value','media_path','[Delete]\x20r','endsWith','leanup\x20com','SELECT\x20msg','error:\x20','g_id=?','lue,\x20updat','\x20remote_al','ode\x20failed','54jLjiSD','M\x20delete_p',',\x20?,\x20?)\x20ON','[Delete]\x20i','key','dded\x20missi','CKOFF_MS','dia\x20error:','estamp','now','able','mentions','and\x20reply\x20','[Delete]\x20p','ptv','TIAL_BACKO','COVERED*\x20ðŸ—‘','nfig\x20regis','DEBOUNCE_M','aved\x20file\x20','lush\x20loop\x20','audioMessa','\x20message.','\x20delete\x20<j','IA_DIRNAME','ðŸ‘¤\x20From:\x20@','95coCdeU','rate','nsureTable','eletionWor','leaning\x20','push','fileName','CLEANUP_DA','1078722ehwQkR','IA_SEND_DE','rror:\x20','[Delete]\x20s','ETRIES','split','11nsSVgt','map','essageWork','not\x20set','ecovered\x20o','onWhatsApp','arget_jid\x20','has','ler\x20error:','TERVAL_MS','toLowerCas','ssage','EFAULT_SEN','\x20key=\x27targ','TEXT','185000oSTVts','\x20JID','1427550JIzYvf','annot\x20dete','code','content','catch','d_at\x20IS\x20NO','audio','[Delete]\x20M','sing\x20colum','[Delete]\x20l','ener','aybeSaveMe','DELETE\x20FRO','.updated_a','ICT(key)\x20D','refs\x20(key,','remoteJidA','5.2.0','IA_DIR','\x20(all\x20atte','afe\x20error:','ALTER\x20TABL',',\x20Cleanup\x20','FROM\x20messa','E\x20messages','entries','ode\x20set\x20to','slice','M\x20messages','[Delete]\x20H','g\x20table\x20an','seconds','filter',').\x20Droppin','\x20chat_jid,','msg_id','d\x20unexpect','sage','no\x20send\x20ta','zation\x20fai','type','[Poll:\x20','originalMe','[Voice\x20not','arget\x20JID\x20','g\x20deletion','object','aveDeleteT','at\x20path:\x20','cwd','subject','try/cleanu','\x20value,\x20up','edia\x20file\x20','media','cleared.'];_0x15af=function(){return _0x389ced;};return _0x15af();}export const name='delete-rec'+'overy';export const version=_0xf7791e(0x332);export const priority=0x18de+-0xc68+0x274*-0x5;export const commands=[_0xf7791e(0x1f3)];export const configKeys=[_0xf7791e(0x25d)+_0xf7791e(0x300),_0xf7791e(0x26c)+'OUNCE_MS',_0xf7791e(0x207)+'CURRENCY',_0xf7791e(0x2ce)+_0xf7791e(0x1d1),_0xf7791e(0x1ed)+_0xf7791e(0x2c9),_0xf7791e(0x1ed)+'ANUP_INTER'+_0xf7791e(0x194),_0xf7791e(0x247)+'UE_MAX_SIZ'+'E'];const FALLBACKS={'DEBOUNCE_MS':0xbb8,'MEDIA_DIRNAME':_0xf7791e(0x190),'DEFAULT_CONCURRENCY':0x2,'CLEANUP_INTERVAL_MS':(0xb*-0x27+-0x1*0xd2a+0xedd)*(-0x1847+0x42+0x1841)*(-0x25*0x7e+-0x2171+-0x33e3*-0x1)*(-0x6ca*0x1+-0xb2*0x4+0xd7a),'MEDIA_SEND_DELAY_MS':0x12c,'MAX_SEND_RETRIES':0x3,'INITIAL_BACKOFF_MS':0x1f4,'CLEANUP_DAYS':0x3,'QUEUE_MAX_SIZE':0x1f4};let botRef=null,cleanupInterval=null;const messageQueue=[],deletionQueue=[];let activeMessageTasks=-0x3*0x1d5+0x3d*-0x1+0x2de*0x2,activeDeletionTasks=-0x277*-0x2+0xd4a+-0x1238,MEDIA_DIR=null,DEBOUNCE_DELAY_MS=FALLBACKS[_0xf7791e(0x2fa)+'S'],CONCURRENCY=FALLBACKS[_0xf7791e(0x28c)+'NCURRENCY'],MEDIA_SEND_DELAY_MS=FALLBACKS['MEDIA_SEND'+_0xf7791e(0x246)],CLEANUP_INTERVAL=FALLBACKS['CLEANUP_IN'+_0xf7791e(0x319)],MAX_SEND_RETRIES=FALLBACKS[_0xf7791e(0x23e)+_0xf7791e(0x30e)],INITIAL_BACKOFF=FALLBACKS[_0xf7791e(0x2a5)+_0xf7791e(0x2ee)],DELETE_CLEANUP_DAYS=FALLBACKS[_0xf7791e(0x309)+'YS'],QUEUE_MAX_SIZE=FALLBACKS['QUEUE_MAX_'+_0xf7791e(0x2aa)],DEFAULT_SEND_DELETE=![],DELETE_MODE='p',TARGET_JID=null;const nameCache=new _0xd9b3ec({'stdTTL':0xe10});let flushTimer=null;const pendingRecovered=[];async function ensureDir(_0x3ab941){const _0x3baf7d=_0xf7791e;try{await _0x49fbab[_0x3baf7d(0x22d)](_0x3ab941);}catch(_0x4e29cc){if(_0x4e29cc[_0x3baf7d(0x323)]==='ENOENT')await _0x49fbab['mkdir'](_0x3ab941,{'recursive':!![]});else throw _0x4e29cc;}}function sleep(_0x3b2e68){return new Promise(_0x1a9f16=>setTimeout(_0x1a9f16,_0x3b2e68));}function normalizeToUserJid(_0x58cf73){const _0x1e007b=_0xf7791e;try{if(!_0x58cf73||typeof _0x58cf73!==_0x1e007b(0x281))return _0x58cf73;const _0x1c0d30=_0x58cf73[_0x1e007b(0x277)]('@');if(_0x1c0d30===-(0x19bb+0x1dd2*-0x1+0x418))return _0x58cf73;const _0x2ce7e1=_0x58cf73[_0x1e007b(0x33c)](-0x10a+0x1071+-0xf67,_0x1c0d30),_0x4aaec8=_0x58cf73[_0x1e007b(0x33c)](_0x1c0d30),_0x136ae0=_0x2ce7e1[_0x1e007b(0x277)](':');if(_0x136ae0===-(-0x1f55+-0x11eb+0x3141))return _0x58cf73;return _0x2ce7e1[_0x1e007b(0x33c)](-0x1ff1+0xf6f+0x1082,_0x136ae0)+_0x4aaec8;}catch(_0x3ce847){return _0x58cf73;}}async function refreshConfig(){const _0x2aad55=_0xf7791e;try{const _0x29f040=getConfig()||{};DEFAULT_SEND_DELETE=typeof _0x29f040['DEFAULT_SE'+'ND_DELETE']===_0x2aad55(0x2c8)?_0x29f040[_0x2aad55(0x2ce)+_0x2aad55(0x1d1)]:DEFAULT_SEND_DELETE,DEBOUNCE_DELAY_MS=Number(_0x29f040[_0x2aad55(0x26c)+_0x2aad55(0x273)]??FALLBACKS['DEBOUNCE_M'+'S']),CONCURRENCY=Number(_0x29f040['DELETE_CON'+_0x2aad55(0x28b)]??_0x29f040[_0x2aad55(0x239)+_0x2aad55(0x25a)+_0x2aad55(0x283)]??FALLBACKS[_0x2aad55(0x28c)+_0x2aad55(0x231)]),MEDIA_SEND_DELAY_MS=Number(_0x29f040[_0x2aad55(0x25d)+_0x2aad55(0x30b)+'LAY_MS']??FALLBACKS[_0x2aad55(0x238)+_0x2aad55(0x246)]),CLEANUP_INTERVAL=Number(_0x29f040[_0x2aad55(0x1ed)+_0x2aad55(0x19c)+'VAL_MS']??FALLBACKS[_0x2aad55(0x1e1)+_0x2aad55(0x319)]),MAX_SEND_RETRIES=Number(_0x29f040[_0x2aad55(0x19b)+'_SEND_RETR'+'IES']??FALLBACKS[_0x2aad55(0x23e)+_0x2aad55(0x30e)]),INITIAL_BACKOFF=Number(_0x29f040[_0x2aad55(0x1bd)+_0x2aad55(0x2f7)+_0x2aad55(0x21d)]??FALLBACKS['INITIAL_BA'+_0x2aad55(0x2ee)]),DELETE_CLEANUP_DAYS=Number(_0x29f040[_0x2aad55(0x1ed)+_0x2aad55(0x2c9)]??FALLBACKS[_0x2aad55(0x309)+'YS']),QUEUE_MAX_SIZE=Number(_0x29f040[_0x2aad55(0x247)+_0x2aad55(0x23b)+'E']??FALLBACKS['QUEUE_MAX_'+_0x2aad55(0x2aa)]);const _0x4643c1=_0x29f040[_0x2aad55(0x1c3)+'OT']&&typeof _0x29f040[_0x2aad55(0x1c3)+'OT']===_0x2aad55(0x281)?_0x29f040['PROJECT_RO'+'OT']:process[_0x2aad55(0x18b)](),_0x429c65=_0xca5806[_0x2aad55(0x1ac)](_0x4643c1,_0x2aad55(0x2a3),_0x2aad55(0x1f3));await ensureDir(_0x429c65),MEDIA_DIR=_0xca5806[_0x2aad55(0x217)](_0x429c65,_0x29f040[_0x2aad55(0x25d)+_0x2aad55(0x300)]??_0x29f040['DELETE_MED'+_0x2aad55(0x333)]??FALLBACKS['MEDIA_DIRN'+_0x2aad55(0x1da)]),await ensureDir(MEDIA_DIR);}catch(_0x2734eb){warn(_0x2aad55(0x2df)+_0x2aad55(0x236)+_0x2aad55(0x2af)+(_0x2734eb?.[_0x2aad55(0x29d)]||_0x2734eb));}}try{hotReloadConfig&&hotReloadConfig(()=>{const _0x32a1df=_0xf7791e;refreshConfig(),info(_0x32a1df(0x33e)+_0x32a1df(0x21e)+_0x32a1df(0x1a6));});}catch(_0x4a1414){warn(_0xf7791e(0x1af)+'otReloadCo'+_0xf7791e(0x2f9)+_0xf7791e(0x234)+_0xf7791e(0x1d0)+(_0x4a1414?.[_0xf7791e(0x29d)]||_0x4a1414));}refreshConfig();const MESSAGES_COLUMNS={'msg_id':_0xf7791e(0x269)+_0xf7791e(0x1ff),'chat_jid':_0xf7791e(0x31e),'remote_alt':_0xf7791e(0x31e),'sender_jid':'TEXT','participant_alt':_0xf7791e(0x31e),'message_json':_0xf7791e(0x31e),'timestamp':_0xf7791e(0x1be),'media_path':_0xf7791e(0x31e),'saved_at':_0xf7791e(0x1be),'resent_at':_0xf7791e(0x1be)};async function ensureTable(){const _0x3386ec=_0xf7791e;try{const _0x37cf52=Object[_0x3386ec(0x33a)](MESSAGES_COLUMNS)['map'](([_0x20b0d5,_0x4625a5])=>_0x20b0d5+'\x20'+_0x4625a5)[_0x3386ec(0x217)](',\x0a\x20\x20');await db[_0x3386ec(0x260)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20mes'+_0x3386ec(0x257)+_0x37cf52+_0x3386ec(0x27c));let _0x1ba7ba=[];try{const _0x15e2d8=await db['all']('PRAGMA\x20tab'+_0x3386ec(0x19d)+_0x3386ec(0x1a2));_0x1ba7ba=(_0x15e2d8||[])[_0x3386ec(0x311)](_0x13c232=>_0x13c232[_0x3386ec(0x263)]);}catch(_0x7ba428){warn('[Delete]\x20P'+_0x3386ec(0x20c)+_0x3386ec(0x1f6)+_0x3386ec(0x2a1)+(_0x7ba428?.['message']||_0x7ba428));}for(const _0x5830f4 of Object['keys'](MESSAGES_COLUMNS)){if(!_0x1ba7ba['includes'](_0x5830f4)){const _0x53221e=MESSAGES_COLUMNS[_0x5830f4];try{await db['run'](_0x3386ec(0x336)+_0x3386ec(0x339)+_0x3386ec(0x225)+'N\x20'+_0x5830f4+'\x20'+_0x53221e),info('[Delete]\x20a'+_0x3386ec(0x2ed)+_0x3386ec(0x2bf)+_0x3386ec(0x241)+_0x5830f4);}catch(_0x3c46b3){warn('[Delete]\x20f'+'ailed\x20to\x20a'+_0x3386ec(0x268)+_0x5830f4+':\x20'+(_0x3c46b3?.[_0x3386ec(0x29d)]||_0x3c46b3));}}}await db[_0x3386ec(0x260)](_0x3386ec(0x28e)+'LE\x20IF\x20NOT\x20'+_0x3386ec(0x2a8)+_0x3386ec(0x1d9)+_0x3386ec(0x1df)+_0x3386ec(0x219)+_0x3386ec(0x214)+_0x3386ec(0x25f)+_0x3386ec(0x1cb)+_0x3386ec(0x200)+_0x3386ec(0x27e)+_0x3386ec(0x1ea)+_0x3386ec(0x19a)+_0x3386ec(0x2a4));try{const _0x476f72=await db[_0x3386ec(0x1e6)](_0x3386ec(0x2c2)+_0x3386ec(0x25b)+'lete_prefs'+_0x3386ec(0x275)+_0x3386ec(0x1aa));if(!_0x476f72){const _0x7d6275=Math[_0x3386ec(0x205)](Date[_0x3386ec(0x2f1)]()/(0x1767+-0x12aa+-0xd5));await db[_0x3386ec(0x26a)](_0x3386ec(0x1d8)+_0x3386ec(0x253)+_0x3386ec(0x330)+_0x3386ec(0x18e)+_0x3386ec(0x23a)+_0x3386ec(0x208)+'ode\x27,\x27p\x27,\x20'+'?)',[_0x7d6275]),DELETE_MODE='p';}else DELETE_MODE=_0x476f72[_0x3386ec(0x2dd)]==='g'?'g':'p';}catch(_0x33758a){warn(_0x3386ec(0x2f5)+_0x3386ec(0x2ba)+')\x20load\x20fai'+'led:\x20'+(_0x33758a?.['message']||_0x33758a));}try{const _0x372aac=await db[_0x3386ec(0x1e6)](_0x3386ec(0x2c2)+_0x3386ec(0x25b)+_0x3386ec(0x261)+'\x20WHERE\x20key'+_0x3386ec(0x1e9)+'id\x27');TARGET_JID=_0x372aac?.[_0x3386ec(0x2dd)]||null;}catch(_0x57687d){warn('[Delete]\x20t'+'arget_jid\x20'+_0x3386ec(0x2cb)+_0x3386ec(0x29e)+(_0x57687d?.[_0x3386ec(0x29d)]||_0x57687d)),TARGET_JID=null;}}catch(_0x429cc3){warn('[Delete]\x20e'+_0x3386ec(0x304)+_0x3386ec(0x1fa)+':\x20'+(_0x429cc3?.[_0x3386ec(0x29d)]||_0x429cc3));throw _0x429cc3;}}function _0x49c7(_0x3dbc6c,_0x36c117){const _0x416ba3=_0x15af();return _0x49c7=function(_0x3ee757,_0x25eaa5){_0x3ee757=_0x3ee757-(0x270f+-0xbb8+-0x19da);let _0x4e0aa8=_0x416ba3[_0x3ee757];return _0x4e0aa8;},_0x49c7(_0x3dbc6c,_0x36c117);}async function streamMediaToFile(_0x4f7ca6,_0x21d2b3){const _0x24aeb0=_0xf7791e;try{const _0x521159=_0x4f7ca6[_0x24aeb0(0x29d)][_0x21d2b3+_0x24aeb0(0x1bf)],_0x157559=await downloadContentFromMessage(_0x521159,_0x21d2b3);let _0x5bb48a=_0x24aeb0(0x2d0);if(_0x21d2b3==='image')_0x5bb48a=_0x24aeb0(0x2ac);else{if(_0x21d2b3===_0x24aeb0(0x24f)||_0x21d2b3==='ptv')_0x5bb48a=_0x24aeb0(0x1b0);else{if(_0x21d2b3===_0x24aeb0(0x327))_0x5bb48a=_0x24aeb0(0x1e2);else{if(_0x21d2b3===_0x24aeb0(0x2b7))_0x5bb48a=_0x521159?.[_0x24aeb0(0x308)]?_0x521159[_0x24aeb0(0x308)][_0x24aeb0(0x30f)]('.')[_0x24aeb0(0x2b5)]():_0x24aeb0(0x20f);else{if(_0x21d2b3===_0x24aeb0(0x195))_0x5bb48a=_0x24aeb0(0x199);}}}}const _0x5956f1=_0x4f7ca6[_0x24aeb0(0x2ec)]['id']+'.'+_0x5bb48a,_0xca54f3=_0xca5806['join'](MEDIA_DIR,_0x5956f1);await pipeline(_0x157559,createWriteStream(_0xca54f3));const _0x4d91be=await _0x49fbab[_0x24aeb0(0x1e3)](_0xca54f3);if(_0x4d91be[_0x24aeb0(0x1f5)]===-0x20e*-0x1+-0x1f6a*0x1+0x1d5c)return warn(_0x24aeb0(0x30d)+_0x24aeb0(0x2fb)+_0xca54f3+('\x20is\x20empty,'+_0x24aeb0(0x265))),await _0x49fbab['rm'](_0xca54f3,{'force':!![]}),null;return _0xca54f3;}catch(_0x426a09){return warn('[Delete]\x20s'+_0x24aeb0(0x27b)+_0x24aeb0(0x292)+'led\x20for\x20'+(_0x4f7ca6[_0x24aeb0(0x2ec)]?.['id']||_0x24aeb0(0x1d6))+':\x20'+(_0x426a09?.[_0x24aeb0(0x29d)]||_0x426a09)),null;}}async function maybeSaveMedia(_0x5e21a7){const _0x3d7578=_0xf7791e;try{const _0x5ed734=['image',_0x3d7578(0x24f),_0x3d7578(0x2f6),_0x3d7578(0x327),_0x3d7578(0x2b7),_0x3d7578(0x195)];for(const _0x41eb4f of _0x5ed734){if(_0x41eb4f===_0x3d7578(0x2f6)){if(_0x5e21a7[_0x3d7578(0x29d)]?.['ptvMessage'])return await streamMediaToFile(_0x5e21a7,'ptv');continue;}if(_0x5e21a7[_0x3d7578(0x29d)]?.[_0x41eb4f+'Message'])return await streamMediaToFile(_0x5e21a7,_0x41eb4f);}return null;}catch(_0x1bc3bf){return warn('[Delete]\x20m'+_0x3d7578(0x32c)+_0x3d7578(0x2ef)+'\x20'+(_0x1bc3bf?.['message']||_0x1bc3bf)),null;}}async function insertMessageToDB(_0x27e413,_0x254e5e){const _0x1794f6=_0xf7791e;try{if(!_0x27e413||!_0x27e413[_0x1794f6(0x2ec)])return;const {id:_0x1bf2e6,remoteJid:_0x401a40,participant:_0x1be6bc}=_0x27e413[_0x1794f6(0x2ec)],_0x48eb97=_0x1be6bc||_0x401a40,_0x2f5932=typeof _0x27e413['messageTim'+'estamp']===_0x1794f6(0x2a0)?_0x27e413[_0x1794f6(0x1ab)+_0x1794f6(0x2f0)]:_0x27e413['messageTim'+'estamp']?.[_0x1794f6(0x192)]||Math[_0x1794f6(0x205)](Date[_0x1794f6(0x2f1)]()/(-0x23e4*-0x1+-0x265e+0x331*0x2)),_0xf0c3f2=_0x27e413[_0x1794f6(0x2ec)]?.[_0x1794f6(0x331)+'lt']||null,_0x21990a=_0x27e413[_0x1794f6(0x2ec)]?.[_0x1794f6(0x1c4)+_0x1794f6(0x243)]||null,_0x3ff386=Math[_0x1794f6(0x205)](Date['now']()/(-0x3c0*0x1+0x6*-0x557+0x27b2));if(!_0x1bf2e6){warn(_0x1794f6(0x2eb)+_0x1794f6(0x22e)+'geToDB:\x20mi'+_0x1794f6(0x1dd)+'id');return;}const _0x1a0477='INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO\x20message'+_0x1794f6(0x20e)+_0x1794f6(0x343)+_0x1794f6(0x2e6)+_0x1794f6(0x1c2)+'jid,\x20parti'+_0x1794f6(0x1e5)+',\x20message_'+_0x1794f6(0x1c6)+_0x1794f6(0x244)+_0x1794f6(0x278)+_0x1794f6(0x24c)+_0x1794f6(0x24a)+'\x20\x20\x20\x20\x20\x20\x20VAL'+_0x1794f6(0x293)+_0x1794f6(0x2a9)+_0x1794f6(0x213)+',\x20?)',_0x3c291a=[_0x1bf2e6,_0x401a40||null,_0xf0c3f2,_0x48eb97||null,_0x21990a,JSON['stringify'](_0x27e413),_0x2f5932,_0x254e5e||null,_0x3ff386,null];try{await db[_0x1794f6(0x26a)](_0x1a0477,_0x3c291a);}catch(_0x142735){const _0x4157d9=String(_0x142735?.['message']||'');if(_0x4157d9[_0x1794f6(0x1cc)]('has\x20no\x20col'+_0x1794f6(0x212))){warn('[Delete]\x20i'+_0x1794f6(0x258)+'ed\x20due\x20mis'+_0x1794f6(0x329)+'n:\x20'+_0x4157d9+(_0x1794f6(0x252)+_0x1794f6(0x33f)+_0x1794f6(0x2dc)));try{await ensureTable(),await db[_0x1794f6(0x26a)](_0x1a0477,_0x3c291a);}catch(_0x58d6ed){warn('[Delete]\x20r'+_0x1794f6(0x20b)+_0x1794f6(0x249)+(_0x58d6ed?.[_0x1794f6(0x29d)]||_0x58d6ed));}}else throw _0x142735;}}catch(_0x1d7b36){warn(_0x1794f6(0x2eb)+'nsertMessa'+_0x1794f6(0x1d4)+'led:\x20'+(_0x1d7b36?.['message']||_0x1d7b36));}}async function fetchOriginalMessage(_0x3c00ca){const _0x3d6746=_0xf7791e;try{if(!_0x3c00ca)return null;const _0x37e561=await db['get'](_0x3d6746(0x2e2)+_0x3d6746(0x285)+_0x3d6746(0x21f)+'edia_path,'+_0x3d6746(0x1de)+_0x3d6746(0x338)+_0x3d6746(0x215)+_0x3d6746(0x22b),[_0x3c00ca]);if(_0x37e561)try{return{'msg_id':_0x37e561['msg_id'],'message':JSON['parse'](_0x37e561['message_js'+'on']),'media_path':_0x37e561[_0x3d6746(0x2de)],'saved_at':_0x37e561['saved_at']};}catch(_0x5ce882){return{'msg_id':_0x37e561[_0x3d6746(0x17d)],'message':null,'media_path':_0x37e561[_0x3d6746(0x2de)],'saved_at':_0x37e561['saved_at']};}return null;}catch(_0xb55013){return warn(_0x3d6746(0x1bc)+_0x3d6746(0x289)+_0x3d6746(0x210)+_0x3d6746(0x2e3)+(_0xb55013?.[_0x3d6746(0x29d)]||_0xb55013)),null;}}async function deleteMessageRow(_0x31142e){const _0x270c5d=_0xf7791e;try{if(!_0x31142e)return;const _0x2d85ca=await db[_0x270c5d(0x1e6)](_0x270c5d(0x274)+'ia_path\x20FR'+'OM\x20message'+'s\x20WHERE\x20ms'+_0x270c5d(0x2e4),[_0x31142e]);if(_0x2d85ca?.[_0x270c5d(0x2de)])try{await _0x49fbab['rm'](_0x2d85ca[_0x270c5d(0x2de)],{'force':!![]});}catch(_0x170616){warn('[Delete]\x20f'+_0x270c5d(0x204)+_0x270c5d(0x266)+'\x20'+_0x2d85ca[_0x270c5d(0x2de)]+':\x20'+(_0x170616?.[_0x270c5d(0x29d)]||_0x170616));}await db[_0x270c5d(0x26a)]('DELETE\x20FRO'+_0x270c5d(0x33d)+_0x270c5d(0x21b)+_0x270c5d(0x296),[_0x31142e]),info(_0x270c5d(0x2d7)+_0x270c5d(0x2ab)+'sages\x20row:'+'\x20'+_0x31142e);}catch(_0x599866){warn(_0x270c5d(0x2d7)+'eleteMessa'+_0x270c5d(0x232)+'r:\x20'+(_0x599866?.[_0x270c5d(0x29d)]||_0x599866));}}async function sendWithRetry(_0x22c866,_0x2133e5,_0x25c81a=[]){const _0x16e665=_0xf7791e,_0x393d61=Number(MAX_SEND_RETRIES||FALLBACKS[_0x16e665(0x23e)+_0x16e665(0x30e)]);let _0x3822ce=0x13*0xbf+0x25b2+0x33df*-0x1,_0x15aa69=Number(INITIAL_BACKOFF||FALLBACKS[_0x16e665(0x2a5)+_0x16e665(0x2ee)]);const _0x4ed082=[_0x22c866,TARGET_JID,getBotJid()][_0x16e665(0x341)](Boolean)[_0x16e665(0x311)](normalizeToUserJid),_0x89397b=new Set(),_0x116da9=[];for(const _0x2de216 of _0x4ed082){if(!_0x2de216)continue;!_0x89397b[_0x16e665(0x317)](_0x2de216)&&(_0x89397b[_0x16e665(0x270)](_0x2de216),_0x116da9[_0x16e665(0x307)](_0x2de216));}let _0x394852=_0x116da9[_0x16e665(0x2d8)]?_0x116da9[-0x427*0x5+0xe2*0x8+0x15*0xa7]:null;if(_0x394852&&_0x394852['endsWith'](_0x16e665(0x206))&&typeof botRef?.['sock']?.[_0x16e665(0x315)]===_0x16e665(0x23d))try{const _0x1f0938=await botRef[_0x16e665(0x2ae)][_0x16e665(0x315)](_0x394852);if(Array[_0x16e665(0x19f)](_0x1f0938)&&_0x1f0938[0x241*0x1+-0x1c63+0x1a22]&&_0x1f0938[-0x1f7*0x13+0x149+0x240c]['jid'])_0x394852=normalizeToUserJid(_0x1f0938[0xd*0x283+-0x24e3+0x43c][_0x16e665(0x20d)]);}catch(_0x908a75){warn(_0x16e665(0x223)+_0x16e665(0x256)+_0x16e665(0x27a)+'iled:\x20'+(_0x908a75?.[_0x16e665(0x29d)]||_0x908a75));}while(_0x3822ce<_0x393d61){try{if(!_0x394852)throw new Error(_0x16e665(0x180)+_0x16e665(0x2ca)+_0x16e665(0x2f2));if(Array[_0x16e665(0x19f)](_0x25c81a)&&_0x25c81a[_0x16e665(0x2d8)]&&typeof _0x2133e5===_0x16e665(0x188)&&_0x2133e5!==null)_0x2133e5[_0x16e665(0x2f3)]=_0x25c81a;return await botRef[_0x16e665(0x290)+'e'](_0x394852,_0x2133e5),!![];}catch(_0x1e85bd){_0x3822ce++;const _0x2a0ec0=String(_0x1e85bd?.[_0x16e665(0x29d)]||'')[_0x16e665(0x31a)+'e']()['includes'](_0x16e665(0x303))||_0x1e85bd?.[_0x16e665(0x1b3)]===-0x38f+-0xf88+0x14c4;warn(_0x16e665(0x30d)+_0x16e665(0x26f)+'t\x20'+_0x3822ce+_0x16e665(0x1a5)+_0x394852+_0x16e665(0x26d)+(_0x1e85bd?.['message']||_0x1e85bd));if(_0x3822ce>=_0x393d61||!_0x2a0ec0)return![];await sleep(_0x15aa69),_0x15aa69*=0xb3d+0x11ef*0x1+0x1*-0x1d2a;}}return![];}function extractContent(_0x585ded){const _0x35db20=_0xf7791e;if(!_0x585ded)return'';if(_0x585ded['conversati'+'on'])return _0x585ded[_0x35db20(0x2a6)+'on'];if(_0x585ded[_0x35db20(0x2a7)+_0x35db20(0x2cc)])return _0x585ded[_0x35db20(0x2a7)+_0x35db20(0x2cc)][_0x35db20(0x240)];if(_0x585ded[_0x35db20(0x235)+'ge'])return _0x585ded[_0x35db20(0x235)+'ge'][_0x35db20(0x286)]||'';if(_0x585ded['videoMessa'+'ge'])return _0x585ded[_0x35db20(0x1e8)+'ge'][_0x35db20(0x286)]||'';if(_0x585ded['ptvMessage'])return _0x585ded[_0x35db20(0x2c3)][_0x35db20(0x286)]||'';if(_0x585ded['audioMessa'+'ge'])return _0x585ded[_0x35db20(0x2fd)+'ge']?.[_0x35db20(0x1ae)]?_0x35db20(0x185)+'e]':'[Audio]';if(_0x585ded[_0x35db20(0x2d5)+_0x35db20(0x31b)])return _0x585ded['documentMe'+_0x35db20(0x31b)][_0x35db20(0x308)]||'';if(_0x585ded[_0x35db20(0x25e)+_0x35db20(0x17f)])return'[Sticker]';if(_0x585ded[_0x35db20(0x2cd)+_0x35db20(0x2c1)+'3'])return _0x35db20(0x183)+(_0x585ded[_0x35db20(0x2cd)+_0x35db20(0x2c1)+'3']['name']||_0x35db20(0x201))+']';return _0x35db20(0x242);}function isMediaMessage(_0x177f75){const _0x7373bd=_0xf7791e;if(!_0x177f75)return![];const _0xa820b9=Object[_0x7373bd(0x1f8)](_0x177f75||{});for(const _0x303f8d of _0xa820b9){if(_0x303f8d[_0x7373bd(0x2e0)](_0x7373bd(0x1bf))&&['imageMessa'+'ge',_0x7373bd(0x1e8)+'ge',_0x7373bd(0x2fd)+'ge',_0x7373bd(0x2d5)+_0x7373bd(0x31b),_0x7373bd(0x25e)+'sage',_0x7373bd(0x2c3)][_0x7373bd(0x1cc)](_0x303f8d))return!![];}return![];}async function buildPayloadForSavedFile(_0x5476eb,_0x4a9aa6){const _0x2b0b8b=_0xf7791e,_0x530ab3=_0x4a9aa6?.['message']||{},_0x3b6061=extractContent(_0x530ab3)||undefined;try{await _0x49fbab[_0x2b0b8b(0x22d)](_0x5476eb);}catch(_0x486460){return warn(_0x2b0b8b(0x328)+_0x2b0b8b(0x18f)+'not\x20found\x20'+_0x2b0b8b(0x18a)+_0x5476eb),null;}if(_0x530ab3[_0x2b0b8b(0x25e)+'sage'])return{'sticker':{'url':_0x5476eb}};if(_0x530ab3['ptvMessage'])return{'video':{'url':_0x5476eb},'ptv':!![],'caption':_0x3b6061,'mimetype':_0x530ab3[_0x2b0b8b(0x2c3)]?.['mimetype']};if(_0x530ab3['videoMessa'+'ge'])return{'video':{'url':_0x5476eb},'caption':_0x3b6061,'gifPlayback':!!_0x530ab3['videoMessa'+'ge']?.[_0x2b0b8b(0x29a)+'k'],'mimetype':_0x530ab3['videoMessa'+'ge']?.['mimetype']};if(_0x530ab3[_0x2b0b8b(0x235)+'ge'])return{'image':{'url':_0x5476eb},'caption':_0x3b6061};if(_0x530ab3[_0x2b0b8b(0x2fd)+'ge'])return{'audio':{'url':_0x5476eb},'ptt':!!_0x530ab3[_0x2b0b8b(0x2fd)+'ge']?.[_0x2b0b8b(0x1ae)],'mimetype':_0x530ab3['audioMessa'+'ge']?.[_0x2b0b8b(0x2c0)],'seconds':_0x530ab3[_0x2b0b8b(0x2fd)+'ge']?.[_0x2b0b8b(0x340)]};if(_0x530ab3[_0x2b0b8b(0x2d5)+'ssage'])return{'document':{'url':_0x5476eb,'fileName':_0x530ab3[_0x2b0b8b(0x2d5)+_0x2b0b8b(0x31b)]?.['fileName']||_0xca5806['basename'](_0x5476eb)},'mimetype':_0x530ab3[_0x2b0b8b(0x2d5)+'ssage']?.[_0x2b0b8b(0x2c0)],'caption':_0x530ab3[_0x2b0b8b(0x2d5)+_0x2b0b8b(0x31b)]?.[_0x2b0b8b(0x286)]||_0x3b6061};return{'document':{'url':_0x5476eb,'fileName':_0xca5806[_0x2b0b8b(0x230)](_0x5476eb)},'caption':_0x3b6061};}async function processDeletionItem(_0x53ae57){const _0x39775d=_0xf7791e;try{const _0x13f93b=_0x53ae57[_0x39775d(0x1f8)]||[];if(!_0x13f93b[_0x39775d(0x2d8)])return;for(const _0x24926a of _0x13f93b){const _0x225cdb=await fetchOriginalMessage(_0x24926a['id']);if(!_0x225cdb||!_0x225cdb['message'])continue;const _0x566b05=_0x225cdb[_0x39775d(0x29d)],_0x32e3e6=getBotJidRaw(),_0x184da4=_0x566b05[_0x39775d(0x2ec)]?.[_0x39775d(0x1c4)+'t']||_0x566b05[_0x39775d(0x2ec)]?.[_0x39775d(0x271)];if(_0x566b05[_0x39775d(0x2ec)]?.[_0x39775d(0x2d2)]||_0x184da4===_0x32e3e6)continue;const _0x344e7e=_0x566b05[_0x39775d(0x2ec)]['participan'+'t']||_0x566b05[_0x39775d(0x2ec)]['remoteJid'],_0x2afaa2=extractContent(_0x566b05['message']);let _0x17fd53=nameCache[_0x39775d(0x1e6)](_0x344e7e);if(!_0x17fd53){try{const [_0x259abd]=await botRef[_0x39775d(0x2ae)][_0x39775d(0x315)](_0x344e7e);_0x17fd53=_0x259abd?.['notify']||'~'+_0x344e7e[_0x39775d(0x30f)]('@')[-0x5ff+-0x1*0x2683+0x2c82];}catch{_0x17fd53='~'+_0x344e7e[_0x39775d(0x30f)]('@')[0x3*0x787+0x8*0x22+-0x17a5*0x1];}nameCache[_0x39775d(0x1c7)](_0x344e7e,_0x17fd53);}let _0x58abc3='';if(isJidGroup(_0x566b05[_0x39775d(0x2ec)]['remoteJid']))try{_0x58abc3=(await botRef[_0x39775d(0x2ae)]['groupMetad'+'ata'](_0x566b05[_0x39775d(0x2ec)][_0x39775d(0x271)]))[_0x39775d(0x18c)];}catch{_0x58abc3='[Unknown\x20G'+_0x39775d(0x29f);}deletionPush({'msg_id':_0x225cdb[_0x39775d(0x17d)],'sender':_0x344e7e,'name':_0x17fd53,'group':_0x58abc3,'content':_0x2afaa2,'mediaPath':_0x225cdb[_0x39775d(0x2de)]||null,'originalMessage':_0x566b05});}}catch(_0x3b4a3d){warn(_0x39775d(0x2f5)+_0x39775d(0x29c)+_0x39775d(0x203)+_0x39775d(0x30c)+(_0x3b4a3d?.['message']||_0x3b4a3d));}}async function deletionWorker(){const _0x2e3fee=_0xf7791e,_0x53459e=CONCURRENCY||FALLBACKS[_0x2e3fee(0x28c)+_0x2e3fee(0x231)];while(deletionQueue['length']>-0x2f*-0x85+0x8*0x3fa+-0x1*0x383b&&activeDeletionTasks<_0x53459e){const _0xf2baf9=deletionQueue[_0x2e3fee(0x26e)]();if(!_0xf2baf9)break;activeDeletionTasks++,((async()=>{const _0x352c16=_0x2e3fee;try{await processDeletionItem(_0xf2baf9);}catch(_0x147e83){warn(_0x352c16(0x2d7)+_0x352c16(0x305)+_0x352c16(0x1f1)+_0x352c16(0x30c)+(_0x147e83?.[_0x352c16(0x29d)]||_0x147e83));}finally{activeDeletionTasks--,setImmediate(()=>{const _0x55b561=_0x352c16;if(deletionQueue[_0x55b561(0x2d8)])deletionWorker()[_0x55b561(0x325)](()=>{});});}})());}}function deletionPush(_0x4d5970){const _0x4a9aca=_0xf7791e;pendingRecovered[_0x4a9aca(0x307)](_0x4d5970),clearTimeout(flushTimer),flushTimer=setTimeout(()=>{const _0x5acb3f=_0x4a9aca,_0x5005ed=pendingRecovered[_0x5acb3f(0x1c1)](-0xa3*0x3a+-0x4*-0x273+-0x12e*-0x17,pendingRecovered['length']);((async()=>{const _0x26fd6a=_0x5acb3f;try{await flushRecoveredBatch(_0x5005ed);}catch(_0x58d0df){warn(_0x26fd6a(0x1bc)+'lushRecove'+_0x26fd6a(0x1ca)+'rror:\x20'+(_0x58d0df?.[_0x26fd6a(0x29d)]||_0x58d0df));}})());},DEBOUNCE_DELAY_MS||FALLBACKS[_0x4a9aca(0x2fa)+'S']);}function resolveDeleteTarget(_0x2dff33){const _0x51f5ef=getBotJid();if(DELETE_MODE==='g'&&TARGET_JID){if(TARGET_JID===_0x2dff33)return _0x51f5ef;return TARGET_JID;}return _0x51f5ef;}async function saveDeleteMode(_0x45a709){const _0x5b3c9e=_0xf7791e;try{const _0x1ea24e=_0x45a709==='g'?'g':'p',_0x400341=Math[_0x5b3c9e(0x205)](Date[_0x5b3c9e(0x2f1)]()/(0x12dc+0x8eb+-0x17df));return await db[_0x5b3c9e(0x26a)](_0x5b3c9e(0x1d8)+_0x5b3c9e(0x253)+_0x5b3c9e(0x330)+_0x5b3c9e(0x18e)+_0x5b3c9e(0x23a)+_0x5b3c9e(0x208)+'ode\x27,\x20?,\x20?'+_0x5b3c9e(0x2cf)+_0x5b3c9e(0x32f)+'O\x20UPDATE\x20S'+_0x5b3c9e(0x2b3)+_0x5b3c9e(0x22a)+_0x5b3c9e(0x2e5)+_0x5b3c9e(0x294)+'uded.updat'+'ed_at',[_0x1ea24e,_0x400341]),DELETE_MODE=_0x1ea24e,info(_0x5b3c9e(0x1a4)+_0x5b3c9e(0x2b0)+'\x20'+DELETE_MODE),!![];}catch(_0x14cb81){return warn(_0x5b3c9e(0x30d)+'aveDeleteM'+_0x5b3c9e(0x2e7)+':\x20'+(_0x14cb81?.[_0x5b3c9e(0x29d)]||_0x14cb81)),![];}}async function saveDeleteTarget(_0x2f1d99){const _0x3779b5=_0xf7791e;try{const _0x3a2f83=Math['floor'](Date[_0x3779b5(0x2f1)]()/(0x2*-0x63b+0x149f+0x9*-0x79));if(!_0x2f1d99)return await db['run']('DELETE\x20FRO'+_0x3779b5(0x2e9)+'refs\x20WHERE'+_0x3779b5(0x31d)+'et_jid\x27'),TARGET_JID=null,info('[Delete]\x20t'+_0x3779b5(0x316)+_0x3779b5(0x1db)),!![];else{const _0x5ae43a=normalizeToUserJid(_0x2f1d99);return await db[_0x3779b5(0x26a)]('INSERT\x20INT'+_0x3779b5(0x253)+_0x3779b5(0x330)+_0x3779b5(0x18e)+_0x3779b5(0x23a)+_0x3779b5(0x28d)+'arget_jid\x27'+_0x3779b5(0x2ea)+_0x3779b5(0x2c7)+'key)\x20DO\x20UP'+_0x3779b5(0x2b6)+_0x3779b5(0x1bb)+_0x3779b5(0x233)+_0x3779b5(0x2b8)+_0x3779b5(0x24e)+_0x3779b5(0x32e)+'t',[_0x5ae43a,_0x3a2f83]),TARGET_JID=_0x5ae43a,info(_0x3779b5(0x24b)+_0x3779b5(0x316)+_0x3779b5(0x1b8)+TARGET_JID),!![];}}catch(_0x5e02ad){return warn('[Delete]\x20s'+_0x3779b5(0x189)+_0x3779b5(0x295)+_0x3779b5(0x28a)+(_0x5e02ad?.[_0x3779b5(0x29d)]||_0x5e02ad)),![];}}async function flushRecoveredBatch(_0x1e45cb){const _0x493ed2=_0xf7791e;if(!_0x1e45cb||_0x1e45cb[_0x493ed2(0x2d8)]===0x217d*-0x1+0x7*0x354+-0xa31*-0x1)return;if(!DEFAULT_SEND_DELETE){info(_0x493ed2(0x1a1)+_0x493ed2(0x31c)+_0x493ed2(0x2c5)+'alse\x20â€”\x20ski'+_0x493ed2(0x299)+_0x493ed2(0x2bd)+'s.');return;}const _0x2fa7da=_0x1e45cb[_0x493ed2(0x1cd)](_0x1b1b64=>_0x1b1b64[_0x493ed2(0x184)+_0x493ed2(0x31b)])?.[_0x493ed2(0x184)+_0x493ed2(0x31b)]?.[_0x493ed2(0x2ec)]?.[_0x493ed2(0x271)]||null,_0x599d32=resolveDeleteTarget(_0x2fa7da)||getBotJid();if(!_0x599d32){warn('[Delete]\x20n'+_0x493ed2(0x279)+'get\x20availa'+_0x493ed2(0x1c8));return;}const _0x53a79c=[...new Set(_0x1e45cb[_0x493ed2(0x311)](_0x43e6a2=>_0x43e6a2[_0x493ed2(0x291)]))],_0x398138=_0x1e45cb[_0x493ed2(0x311)](_0x444e99=>_0x493ed2(0x301)+_0x444e99[_0x493ed2(0x291)][_0x493ed2(0x30f)]('@')[0x7c2+0x0+-0x1*0x7c2]+'\x20('+_0x444e99['name']+')\x0a'+(_0x444e99[_0x493ed2(0x2d3)]?_0x493ed2(0x226)+_0x444e99[_0x493ed2(0x2d3)]+'\x0a':'')+(_0x493ed2(0x284)+'\x20'+_0x444e99[_0x493ed2(0x324)]+'\x0a')+'â”€'[_0x493ed2(0x202)](0x97*-0x5+-0x22d4+0x25e0))[_0x493ed2(0x217)]('\x0a'),_0xd2326=_0x493ed2(0x1c9)+_0x1e45cb[_0x493ed2(0x2d8)]+('\x20DELETED\x20M'+_0x493ed2(0x218)+_0x493ed2(0x2f8)+'\x0a\x0a');try{const _0x51b300=await sendWithRetry(_0x599d32,{'text':_0xd2326+_0x398138},_0x53a79c);if(!_0x51b300)warn(_0x493ed2(0x30d)+_0x493ed2(0x1b1)+_0x493ed2(0x1e7)+_0x493ed2(0x1b6));}catch(_0x5708f3){warn(_0x493ed2(0x30d)+_0x493ed2(0x1b1)+_0x493ed2(0x17e)+'ed\x20error:\x20'+(_0x5708f3?.['message']||_0x5708f3));}for(const _0x2445c9 of _0x1e45cb){try{const _0xb70b26=_0x2445c9['mediaPath'],_0x5be086=_0x2445c9[_0x493ed2(0x184)+_0x493ed2(0x31b)],_0x88c459=!!_0xb70b26||isMediaMessage(_0x5be086?.['message']);if(!_0x88c459){try{await deleteMessageRow(_0x2445c9[_0x493ed2(0x17d)]);}catch(_0x2b7854){}continue;}const _0x1bb40b=_0x5be086?.[_0x493ed2(0x2ec)]?.['id']||'(no-id)',_0x52ec85=await buildPayloadForSavedFile(_0xb70b26,_0x5be086);if(_0x52ec85){const _0xeeeb1=await sendWithRetry(_0x599d32,_0x52ec85);if(_0xeeeb1){info(_0x493ed2(0x2df)+'ecovered\x20m'+_0x493ed2(0x197)+_0x493ed2(0x1ad)+_0x1bb40b+'\x20->\x20'+_0x599d32),await deleteMessageRow(_0x2445c9[_0x493ed2(0x17d)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x493ed2(0x238)+_0x493ed2(0x246)]);continue;}else warn(_0x493ed2(0x1a4)+'edia\x20send\x20'+_0x493ed2(0x1b5)+'\x20'+_0x1bb40b+'.');}try{const _0x173f4e=await sendWithRetry(_0x599d32,{'forward':_0x5be086});if(_0x173f4e){info('[Delete]\x20r'+_0x493ed2(0x314)+_0x493ed2(0x1a8)+_0x493ed2(0x19e)+'r\x20'+_0x1bb40b+_0x493ed2(0x1c5)+_0x599d32),await deleteMessageRow(_0x2445c9[_0x493ed2(0x17d)]),await sleep(MEDIA_SEND_DELAY_MS||FALLBACKS[_0x493ed2(0x238)+_0x493ed2(0x246)]);continue;}}catch(_0x551214){warn(_0x493ed2(0x32a)+_0x493ed2(0x2b2)+'ard\x20error:'+'\x20'+(_0x551214?.[_0x493ed2(0x29d)]||_0x551214));}warn(_0x493ed2(0x221)+_0x493ed2(0x1b4)+'eliver\x20med'+_0x493ed2(0x298)+_0x1bb40b+(_0x493ed2(0x334)+'mpts\x20faile'+_0x493ed2(0x288)+_0x493ed2(0x2d4)+_0x493ed2(0x267)+_0x493ed2(0x18d)+'p.'));}catch(_0x4ecaca){warn(_0x493ed2(0x1bc)+_0x493ed2(0x2fc)+'item\x20error'+':\x20'+(_0x4ecaca?.[_0x493ed2(0x29d)]||_0x4ecaca));}}}async function rawMessagesUpsertHandler({messages:_0x5ba321}){const _0x7c3b7e=_0xf7791e;try{if(!_0x5ba321||!Array[_0x7c3b7e(0x19f)](_0x5ba321))return;for(const _0x5b036d of _0x5ba321){if(!_0x5b036d||!_0x5b036d['message']||_0x5b036d['key']?.[_0x7c3b7e(0x271)]==='status@bro'+'adcast')continue;if(_0x5b036d[_0x7c3b7e(0x2ec)]?.[_0x7c3b7e(0x2d2)])continue;if(messageQueue[_0x7c3b7e(0x2d8)]>=QUEUE_MAX_SIZE){warn(_0x7c3b7e(0x328)+'essage\x20sav'+'e\x20queue\x20is'+_0x7c3b7e(0x1f0)+messageQueue['length']+(_0x7c3b7e(0x342)+'g\x20incoming'+_0x7c3b7e(0x2fe)));continue;}messageQueue[_0x7c3b7e(0x307)](_0x5b036d),setImmediate(()=>{messageWorker()['catch'](()=>{});});const _0x4868c1=_0x5b036d[_0x7c3b7e(0x29d)]?.[_0x7c3b7e(0x1dc)+_0x7c3b7e(0x31b)];if(_0x4868c1?.[_0x7c3b7e(0x182)]===-0x13ac+0x1024*0x1+-0x4*-0xe2&&_0x4868c1?.['key']){if(deletionQueue[_0x7c3b7e(0x2d8)]>=QUEUE_MAX_SIZE){warn(_0x7c3b7e(0x1a1)+_0x7c3b7e(0x24d)+'ocessing\x20q'+_0x7c3b7e(0x29b)+'ll\x20('+deletionQueue[_0x7c3b7e(0x2d8)]+(').\x20Droppin'+_0x7c3b7e(0x187)+_0x7c3b7e(0x297)));continue;}deletionQueue[_0x7c3b7e(0x307)]({'keys':[_0x4868c1['key']],'remoteJid':_0x5b036d[_0x7c3b7e(0x2ec)]['remoteJid']}),setImmediate(()=>{deletionWorker()['catch'](()=>{});});}}}catch(_0x575e38){warn(_0x7c3b7e(0x2df)+_0x7c3b7e(0x248)+_0x7c3b7e(0x1d2)+_0x7c3b7e(0x318)+'\x20'+(_0x575e38?.[_0x7c3b7e(0x29d)]||_0x575e38));}}async function processMessageItem(_0x278d7a){const _0x34713b=_0xf7791e;try{if(!_0x278d7a||!_0x278d7a[_0x34713b(0x29d)]||_0x278d7a[_0x34713b(0x2ec)]?.[_0x34713b(0x2d2)])return;const _0x324f0e=await maybeSaveMedia(_0x278d7a);await insertMessageToDB(_0x278d7a,_0x324f0e);}catch(_0xb5e678){warn(_0x34713b(0x2f5)+_0x34713b(0x1f2)+_0x34713b(0x216)+_0x34713b(0x1c0)+(_0xb5e678?.[_0x34713b(0x29d)]||_0xb5e678));}}async function messageWorker(){const _0x3464ed=_0xf7791e,_0x5239a3=CONCURRENCY||FALLBACKS[_0x3464ed(0x28c)+_0x3464ed(0x231)];while(messageQueue[_0x3464ed(0x2d8)]>-0x1*-0x1917+-0x1c65+-0x34e*-0x1&&activeMessageTasks<_0x5239a3){const _0x4eaf97=messageQueue['shift']();if(!_0x4eaf97)break;activeMessageTasks++,((async()=>{const _0x1e59fd=_0x3464ed;try{await processMessageItem(_0x4eaf97);}catch(_0x455bf4){warn(_0x1e59fd(0x1a4)+_0x1e59fd(0x312)+_0x1e59fd(0x287)+_0x1e59fd(0x1c0)+(_0x455bf4?.[_0x1e59fd(0x29d)]||_0x455bf4));}finally{activeMessageTasks--,setImmediate(()=>{const _0x2a15cd=_0x1e59fd;if(messageQueue['length'])messageWorker()[_0x2a15cd(0x325)](()=>{});});}})());}}async function autoCleanOldMessagesSafe(){const _0x1b7d10=_0xf7791e;try{await autoCleanOldMessages();}catch(_0x3515d4){warn(_0x1b7d10(0x259)+_0x1b7d10(0x27d)+'dMessagesS'+_0x1b7d10(0x335)+'\x20'+(_0x3515d4?.['message']||_0x3515d4));}}async function autoCleanOldMessages(){const _0x240960=_0xf7791e;try{const _0x1f262e=Math['floor'](Date['now']()/(0x2584+0x2*0x538+0x4*-0xb03))-Number(DELETE_CLEANUP_DAYS||FALLBACKS[_0x240960(0x309)+'YS'])*(-0x853*0x3+0x2031+-0x720)*(-0x2*0x5a8+-0x177f+-0x230b*-0x1)*(0x482*-0x7+-0x67b*0x1+0x2645),_0xcffcc4=await db[_0x240960(0x1fe)](_0x240960(0x2e2)+'_id,\x20media'+_0x240960(0x1f4)+_0x240960(0x222)+'\x20messages\x20'+_0x240960(0x224)+_0x240960(0x326)+_0x240960(0x1ee)+'\x20saved_at\x20'+_0x240960(0x2be),[_0x1f262e]);if(!_0xcffcc4||_0xcffcc4[_0x240960(0x2d8)]===-0x29*0xb9+-0xae1*0x1+0x40d*0xa)return;info(_0x240960(0x1d7)+_0x240960(0x306)+_0xcffcc4[_0x240960(0x2d8)]+('\x20old\x20messa'+_0x240960(0x1e4)+_0x240960(0x228))+DELETE_CLEANUP_DAYS+'\x20days)');for(const _0x3caed6 of _0xcffcc4){if(_0x3caed6['media_path'])try{await _0x49fbab['rm'](_0x3caed6[_0x240960(0x2de)],{'force':!![]});}catch(_0x48afb4){warn(_0x240960(0x1bc)+_0x240960(0x2bc)+_0x240960(0x1b7)+_0x3caed6[_0x240960(0x2de)]+':\x20'+(_0x48afb4?.[_0x240960(0x29d)]||_0x48afb4));}}const _0x181b68=_0xcffcc4[_0x240960(0x311)](_0x5423c4=>_0x5423c4[_0x240960(0x17d)]),_0xaf31c0=-0x1610+-0x1*-0x1d+-0x17*-0xfd;for(let _0x44d0df=0x11*-0xc1+0x1bd2+-0xf01;_0x44d0df<_0x181b68[_0x240960(0x2d8)];_0x44d0df+=_0xaf31c0){const _0x448a94=_0x181b68[_0x240960(0x33c)](_0x44d0df,_0x44d0df+_0xaf31c0),_0x5d3484=_0x448a94['map'](()=>'?')[_0x240960(0x217)](',');await db[_0x240960(0x26a)](_0x240960(0x32d)+_0x240960(0x33d)+_0x240960(0x21b)+_0x240960(0x211)+_0x5d3484+')',_0x448a94);}info(_0x240960(0x1d7)+_0x240960(0x2e1)+_0x240960(0x2b1));}catch(_0x494b83){warn(_0x240960(0x259)+_0x240960(0x27d)+_0x240960(0x28f)+_0x240960(0x2c6)+(_0x494b83?.[_0x240960(0x29d)]||_0x494b83));}}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0x1*-0x1eb5+0x2669+-0x4500)*(-0x2007+0x175b+0xe6*0xe);function markCmdProcessed(_0x411341){const _0x3baeba=_0xf7791e;if(!_0x411341)return;if(processedCmdKeys[_0x3baeba(0x317)](_0x411341))try{clearTimeout(processedCmdKeys[_0x3baeba(0x1e6)](_0x411341));}catch(_0x1c105c){};const _0x531de7=setTimeout(()=>processedCmdKeys['delete'](_0x411341),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x3baeba(0x1c7)](_0x411341,_0x531de7);}function isCmdProcessed(_0x2f860d){return _0x2f860d&&processedCmdKeys['has'](_0x2f860d);}export async function onMessage(_0x3b0ebb,_0x4bec0e){const _0x4d9a02=_0xf7791e;try{if(!_0x3b0ebb||!_0x3b0ebb[_0x4d9a02(0x2ec)]||!_0x3b0ebb[_0x4d9a02(0x29d)]||!_0x3b0ebb[_0x4d9a02(0x27f)]||!_0x4bec0e)return;if(isJidGroup(_0x3b0ebb[_0x4d9a02(0x2ec)][_0x4d9a02(0x271)]))return;const _0x23f5f5=_0x3b0ebb[_0x4d9a02(0x2ec)][_0x4d9a02(0x2d2)],_0x5c6ad2=await isSudo(botRef,_0x3b0ebb)[_0x4d9a02(0x325)](()=>![]);if(!_0x23f5f5&&!_0x5c6ad2)return;let _0x43d655=_0x23f5f5?getBotJid():_0x3b0ebb[_0x4d9a02(0x2ec)][_0x4d9a02(0x271)];if(!_0x43d655){warn(_0x4d9a02(0x250)+_0x4d9a02(0x322)+'rmine\x20comm'+_0x4d9a02(0x2f4)+_0x4d9a02(0x1a7));return;}const _0x14c07a=String(_0x3b0ebb[_0x4d9a02(0x2ec)]['remoteJid']||'')+'::'+String(_0x3b0ebb[_0x4d9a02(0x2ec)]['id']||_0x3b0ebb[_0x4d9a02(0x2ec)][_0x4d9a02(0x1c4)+'t']||'');if(isCmdProcessed(_0x14c07a))return;markCmdProcessed(_0x14c07a);const _0x16d1c4=_0x3b0ebb[_0x4d9a02(0x240)]||'',_0x577f32=_0x16d1c4[_0x4d9a02(0x22f)]()['split'](/\s+/),_0x47817f=(_0x577f32[0xb02+-0x586+-0x57c]||'')[_0x4d9a02(0x31a)+'e']();if(!commands['includes'](_0x47817f))return;const _0x48aa27=(_0x577f32[-0x152d+-0x265*-0x4+0xb9a]||'')[_0x4d9a02(0x31a)+'e']();if(_0x48aa27&&_0x48aa27[_0x4d9a02(0x1cc)]('@')){const _0x40495f=normalizeToUserJid(_0x48aa27),_0x415389=await saveDeleteTarget(_0x40495f);await sendWithRetry(_0x43d655,{'text':_0x415389?'[delete]\x20T'+_0x4d9a02(0x186)+_0x4d9a02(0x1b8)+_0x40495f:_0x4d9a02(0x276)+'ailed\x20to\x20s'+'ave\x20target'+_0x4d9a02(0x320)});return;}if([_0x4d9a02(0x23f),_0x4d9a02(0x21a),_0x4d9a02(0x1f9)]['includes'](_0x48aa27)){const _0x2fc896=await saveDeleteTarget(null);await sendWithRetry(_0x43d655,{'text':_0x2fc896?_0x4d9a02(0x1ec)+_0x4d9a02(0x186)+_0x4d9a02(0x191):_0x4d9a02(0x276)+_0x4d9a02(0x198)+'lear\x20targe'+_0x4d9a02(0x1a9)});return;}if(['p','pm']['includes'](_0x48aa27)){await saveDeleteMode('p'),await sendWithRetry(_0x43d655,{'text':_0x4d9a02(0x280)+_0x4d9a02(0x33b)+_0x4d9a02(0x1a3)});return;}if(['g',_0x4d9a02(0x2d3),'gp'][_0x4d9a02(0x1cc)](_0x48aa27)){await saveDeleteMode('g');const _0xcb5915=TARGET_JID?_0x4d9a02(0x2b9)+_0x4d9a02(0x229)+TARGET_JID:_0x4d9a02(0x1eb)+'group\x20JID\x20'+_0x4d9a02(0x196);await sendWithRetry(_0x43d655,{'text':'[delete]\x20M'+_0x4d9a02(0x33b)+_0x4d9a02(0x2bb)+_0xcb5915});return;}const _0x2f5edd=DELETE_MODE==='g'?'GROUP\x20('+(TARGET_JID||_0x4d9a02(0x313))+')':'PM';await sendWithRetry(_0x43d655,{'text':_0x4d9a02(0x1a0)+_0x4d9a02(0x22c)+'tings\x20(PM-'+_0x4d9a02(0x2d9)+_0x4d9a02(0x251)+(_0x4d9a02(0x25c)+_0x4d9a02(0x23c)+_0x4d9a02(0x227)+_0x4d9a02(0x1d5)+_0x4d9a02(0x245))+(_0x4d9a02(0x255)+_0x4d9a02(0x2a2)+'\x20send\x20reco'+_0x4d9a02(0x2b4)+'\x20group\x0a')+(_0x4d9a02(0x2ff)+_0x4d9a02(0x20a)+_0x4d9a02(0x1fd)+_0x4d9a02(0x1f7)+'D\x0a')+(_0x4d9a02(0x272)+'ear\x20\x20\x20\x20\x20->'+_0x4d9a02(0x209)+'get\x20group\x20'+_0x4d9a02(0x193))+('*Current\x20S'+_0x4d9a02(0x2ad))+(_0x4d9a02(0x1cf)+_0x4d9a02(0x1ef)+_0x2f5edd+'*\x0a')+(_0x4d9a02(0x1b2)+_0x4d9a02(0x26b)+DEFAULT_SEND_DELETE+'*\x0a')+(_0x4d9a02(0x1b9)+'fter:\x20*'+DELETE_CLEANUP_DAYS+_0x4d9a02(0x2d6))});}catch(_0x5b0640){error(_0x5b0640,_0x4d9a02(0x223)+'nMessage\x20e'+'rror:\x20'+(_0x5b0640?.[_0x4d9a02(0x29d)]||_0x5b0640));}}export async function initialize(_0x11a6b9){const _0x32dc86=_0xf7791e;if(!_0x11a6b9)throw new Error('delete\x20mod'+_0x32dc86(0x1d3)+'es\x20bot\x20arg');botRef=_0x11a6b9,await refreshConfig(),await ensureTable()[_0x32dc86(0x325)](_0x2cc6f7=>{const _0x46ff78=_0x32dc86;error(_0x46ff78(0x1a1)+_0x46ff78(0x2c4)+_0x46ff78(0x181)+'led\x20fatall'+_0x46ff78(0x220)+(_0x2cc6f7?.[_0x46ff78(0x29d)]||_0x2cc6f7));throw _0x2cc6f7;}),_0x11a6b9['on'](_0x32dc86(0x21c)+'psert',rawMessagesUpsertHandler),await autoCleanOldMessagesSafe()[_0x32dc86(0x325)](_0x1769e3=>warn(_0x32dc86(0x2eb)+_0x32dc86(0x1fb)+'anup\x20error'+':\x20'+(_0x1769e3?.[_0x32dc86(0x29d)]||_0x1769e3)));if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(autoCleanOldMessagesSafe,CLEANUP_INTERVAL||FALLBACKS[_0x32dc86(0x1e1)+_0x32dc86(0x319)]),info(_0x32dc86(0x1ce)+_0x32dc86(0x1ba)+_0x32dc86(0x2da)+DELETE_MODE+(_0x32dc86(0x337)+_0x32dc86(0x2db))+DELETE_CLEANUP_DAYS);}export async function cleanup(){const _0x19e49e=_0xf7791e;try{botRef&&typeof botRef['removeList'+_0x19e49e(0x32b)]===_0x19e49e(0x23d)&&botRef['removeList'+'ener'](_0x19e49e(0x21c)+'psert',rawMessagesUpsertHandler),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null),messageQueue[_0x19e49e(0x2d8)]=-0x12b*-0x1f+-0x14*-0x47+-0x7*0x5f7,deletionQueue[_0x19e49e(0x2d8)]=-0x76*0x41+0x9*-0x139+0x28f7,pendingRecovered[_0x19e49e(0x2d8)]=0x1af0+-0x2144+0x654;}catch(_0xabe04e){warn(_0x19e49e(0x1d7)+_0x19e49e(0x264)+_0x19e49e(0x237)+(_0xabe04e?.[_0x19e49e(0x29d)]||_0xabe04e));}finally{botRef=null;}}export default{'name':name,'version':version,'priority':priority,'configKeys':configKeys,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};