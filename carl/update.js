const _0x5e0d8e=_0x502e;(function(_0x3f7ecf,_0xa94310){const _0x370dbb=_0x502e,_0x5d7ffe=_0x3f7ecf();while(!![]){try{const _0x11878e=parseInt(_0x370dbb(0x248))/(0x12d2*-0x2+0xf*0x1c3+-0x167*-0x8)+-parseInt(_0x370dbb(0x21a))/(0xaf9*0x3+0xe2*0x3+-0x238f)*(parseInt(_0x370dbb(0x2b3))/(-0x12c0+0x129b*-0x1+0x255e))+parseInt(_0x370dbb(0x196))/(-0x31*-0x63+-0xb*-0x14e+-0x2149)*(-parseInt(_0x370dbb(0x1ce))/(-0x34f*0x4+-0x647*-0x5+0x16*-0xd3))+-parseInt(_0x370dbb(0x1c7))/(0x10*0x156+0x1f30+-0x348a)+parseInt(_0x370dbb(0x286))/(0x1*-0x1bc5+0x59*0x6b+0x967*-0x1)*(-parseInt(_0x370dbb(0x252))/(-0xc46*0x2+-0xdf9*0x1+-0x47*-0x8b))+-parseInt(_0x370dbb(0x27a))/(-0x252e*0x1+-0x1dcb*0x1+0x4302)*(-parseInt(_0x370dbb(0x1ac))/(-0x494*0x2+-0x609+-0x22d*-0x7))+-parseInt(_0x370dbb(0x258))/(-0x1*0x115+-0x17ab+0xb*0x241)*(-parseInt(_0x370dbb(0x1f0))/(-0x186c+0x1a17+-0x19f));if(_0x11878e===_0xa94310)break;else _0x5d7ffe['push'](_0x5d7ffe['shift']());}catch(_0x1401f7){_0x5d7ffe['push'](_0x5d7ffe['shift']());}}}(_0x1bec,-0x191*0x35+0x298a9+-0x37b0));import _0x5567ce from'fs/promises';import _0x589a6b from'path';import{exec as _0x323e7e}from'child_process';import{promisify}from'util';import{fileURLToPath}from'url';import{DateTime}from'luxon';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{isSudo,listSudo,normalizeToJid,userJidFromCtx}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';function _0x1bec(){const _0x28c9de=['l).\x20Skippe','carl','ore\x20than\x201','otice:\x0a\x0a','key','\x20snapshot\x20','314gMktdU','d\x20core\x20upd','heck_at\x20IN','sage\x20to\x20','\x20removed).','name','o\x20get\x20auto','o\x20download','ination.','o\x20update\x20c','cable\x20upda','🔄\x20Automati','t\x20get\x20upda','push','up.','TEGER\x0a\x20\x20\x20\x20','roceeding\x20',']\x20Wrote\x20up','ady\x20up\x20to\x20','ULT\x200,\x0a\x20\x20\x20','*Auto-Upda','re\x20compone','connection',']\x20Missing\x20','OT\x20EXISTS\x20','Not\x20schedu','origin','off','ed_at','tct.com/bu','tmp','led','fying\x20owne','ompleted.','\x20may\x20be\x20in','close','able.\x20Run\x20','yarn\x20insta','enabled','r\x20updates.','join',']\x20DB\x20schem','data','ate\x20schedu',']\x20initiali','plugin\x20fil','175385EgRsPU',']\x20Auto-upd','dirname','\x20updates.','.update','🔄\x20Could\x20no','found.\x20Cre','toSeconds','DISABLED','UPDATE\x20upd','726456kHPkls','SELECT\x20*\x20F','auto-updat','un...','te\x20Status*','update\x20set','11iEzctj','\x20called\x20wi','c\x20updates\x20','files','status','tings\x20(\x0a\x20\x20','gs\x20SET\x20las','e\x20error','stall\x27\x20fai','ting.','tamps','filter','mtime','toLowerCas','un\x20the\x20`re','ecked_at\x20I','d\x20successf','WHERE\x20sett','API\x20reques','ENABLED.\x20T','ate:\x20nothi','fromSecond','ating:\x0a','t\x20check\x20fo','heck\x20times','e\x20check...','sendMessag','\x20removed\x20p','writing\x20','y\x20after\x20fi','run','Updates\x20re','\x20for\x20updat','text','9anOBoZ',']\x20No\x20local','ble.','iles\x20were\x20',']\x20Could\x20no','oot`\x20comma','e\x20is\x20avail','map','oupdate\x27','🔄\x20Updated\x20','fromMe','lled\x20succe','7pTfBDk','on\x20first\x20r','has','\x0a\x0aStatus:\x20','te.','y\x20again\x20la','ailed\x20whil','updated.','pplied.\x0a\x0aS','trim','\x20—\x20content','y\x20have\x20bee',']\x20\x27yarn\x20in','nd\x20for\x20the','on|off','d\x20plugin\x20u','ate:\x20no\x20fi','ng\x20to\x20appl','nextCheckA','\x20->\x20','gs\x20SET\x20ena','plus','les\x20were\x20w','utils','json\x20chang','ritten\x20(do','ild\x20info','ing_key\x20=\x20','ter.','snapshot\x20c','tus','n\x20the\x20`reb','parse','update_set','ng\x20is\x20alre','\x20PRIMARY\x20K','\x20unchanged','ate\x20applie','TEGER\x20DEFA','e\x20applying','\x20is\x20alread','utoupdate\x20',']\x20Initial\x20','EY,\x0a\x20\x20\x20\x20\x20\x20','ler\x20starte','501GAIVEB','without\x20ex','te\x20informa','e\x27)','ROM\x20update','download\x20f','every\x2024\x20h','replace','t\x20read\x20rem','nents.','o\x20fetch\x20bu','1904WcPlyW','open','bled\x20=\x20?,\x20','o\x20set\x20auto','O\x20update_s','stall\x27...','string','ly.\x0a\x0aSkipp','@g.us',']\x20onMessag','catch','TABLE\x20IF\x20N','t\x20=\x20?\x20WHER','ating\x20one\x20','jid','cies\x20insta','etting_key','\x20core\x20chan','wnloads\x20ma','🔄\x20Checking','\x20update\x20pr',';\x20skipping','548110Ueffik','zed.','\x0aPlease\x20ru','at\x20=\x20?,\x20ne','\x0a\x0aUsage:\x20a',']\x20No\x20send\x20','🔄\x20An\x20updat','utf-8','ly\x20core\x20ch','🔄\x20Update\x20c','\x20\x20\x20\x20settin','a\x20ensured.','enabled\x20IN','*\x0aNext\x20Che','e\x20effect.','\x27autoupdat','toRelative','remoteJid','kipped\x20upd','tes\x20to\x20app','g_key\x20=\x20\x27a','ed\x20updatin','readFile','update','🔄\x20Your\x20bot','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ate\x20checks','1388706VWbAgE','Updated\x20co','ugins:\x0a','w`\x20to\x20appl','or\x20','ocess...','t\x20failed:\x20','2245XTRgsl','INSERT\x20INT','floor','he\x20bot\x20wil',']\x20Running\x20',']\x20Failed\x20t','`update\x20no','package.js','API\x20availa','oved\x20plugi','now','<unknown>','readyState','ugins:\x20Mor','_at\x20=\x20?\x20WH','xt_check_a','core\x20compo','object','\x20Applying.','🔄\x20Starting','_settings\x20','get','ours.','sock',']\x20safeSend','g_key\x20TEXT','_at','download','c\x20Update\x20N','g\x20\x27yarn\x20in','have\x20been\x20',']\x20cleaned\x20','n\x20identica','al\x20snapsho','5599788uSEGvV','autoupdate','y\x20up\x20to\x20da','.removed.j','plugins:\x20M','Updated\x20pl','2.1.5','findings','next_check','date.','length','key\x20=\x20\x27aut','.update.js','ate:\x20apply','turned\x20no\x20','th\x20no\x20dest','ltering\x20','anges.','lastModifi','ERE\x20settin','includes','ENABLED','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔄\x20Everythi','nts.','zation\x20fai','pshot.\x20Upd','🔄\x20No\x20appli',']\x20Error\x20wh','tings','json','\x20\x20\x20CREATE\x20','l\x20check\x20fo','ns\x20file;\x20p','ate_settin','modules'];_0x1bec=function(){return _0x28c9de;};return _0x1bec();}import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';const exec=promisify(_0x323e7e);export const name=_0x5e0d8e(0x1c3);export const version=_0x5e0d8e(0x1f6);export const priority=-0x1f*-0x46+0x25cd+-0x2e15;export const commands=['update',_0x5e0d8e(0x1f1)];let botRef=null,schedulerInterval=null,schedulerRunning=![];const API_URL='https://i-'+_0x5e0d8e(0x237)+'ild',__filename=fileURLToPath(import.meta['url']),__dirname=_0x589a6b[_0x5e0d8e(0x24a)](__filename),projectRoot=_0x589a6b['resolve'](__dirname,'..'),snapshotPath=_0x589a6b['join'](projectRoot,_0x5e0d8e(0x244),'tmp',_0x5e0d8e(0x1fc)+'on'),removedPluginsPath=_0x589a6b[_0x5e0d8e(0x242)](projectRoot,_0x5e0d8e(0x244),_0x5e0d8e(0x238),_0x5e0d8e(0x1f3)+'son');async function ensureSchema(){const _0xab5b4a=_0x5e0d8e;try{await db['exec'](_0xab5b4a(0x206)+_0xab5b4a(0x20f)+_0xab5b4a(0x1a1)+_0xab5b4a(0x232)+_0xab5b4a(0x2a7)+_0xab5b4a(0x25d)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xab5b4a(0x1b6)+_0xab5b4a(0x1e7)+_0xab5b4a(0x2a9)+_0xab5b4a(0x2b1)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xab5b4a(0x1b8)+_0xab5b4a(0x2ac)+_0xab5b4a(0x22d)+_0xab5b4a(0x1c5)+'\x20\x20\x20last_ch'+_0xab5b4a(0x267)+'NTEGER,\x0a\x20\x20'+_0xab5b4a(0x1c5)+'\x20\x20\x20\x20next_c'+_0xab5b4a(0x21c)+_0xab5b4a(0x229)+'\x20\x20\x20\x20\x20\x20\x20\x20);'+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const _0x3a5ac8=await db[_0xab5b4a(0x1e3)](_0xab5b4a(0x253)+_0xab5b4a(0x18f)+_0xab5b4a(0x1e2)+'WHERE\x20sett'+_0xab5b4a(0x2a1)+_0xab5b4a(0x1bb)+'e\x27');!_0x3a5ac8&&await db[_0xab5b4a(0x276)](_0xab5b4a(0x1cf)+_0xab5b4a(0x19a)+'ettings\x20(s'+_0xab5b4a(0x1a6)+')\x20VALUES\x20('+'\x27autoupdat'+_0xab5b4a(0x2b6)),info('['+name+(']\x20DB\x20schem'+_0xab5b4a(0x1b7)));}catch(_0x483945){error(_0x483945,'['+name+(_0xab5b4a(0x243)+'a\x20initiali'+_0xab5b4a(0x209)+_0xab5b4a(0x239)));throw _0x483945;}}async function getAutoUpdateSettings(){const _0x4580d4=_0x5e0d8e;try{const _0x3c6960=await db[_0x4580d4(0x1e3)]('SELECT\x20*\x20F'+_0x4580d4(0x18f)+_0x4580d4(0x1e2)+_0x4580d4(0x269)+_0x4580d4(0x2a1)+'\x27autoupdat'+'e\x27');return{'enabled':!!_0x3c6960?.[_0x4580d4(0x240)],'lastCheckedAt':_0x3c6960?.['last_check'+_0x4580d4(0x236)]||null,'nextCheckAt':_0x3c6960?.[_0x4580d4(0x1f8)+_0x4580d4(0x1e8)]||null};}catch(_0x43c53f){return error(_0x43c53f,'['+name+(_0x4580d4(0x1d3)+_0x4580d4(0x220)+_0x4580d4(0x257)+_0x4580d4(0x20d))),{'enabled':![],'lastCheckedAt':null,'nextCheckAt':null};}}async function setAutoUpdateStatus(_0x233bd8){const _0x4a2426=_0x5e0d8e;try{const _0x322c2c=_0x233bd8?DateTime[_0x4a2426(0x1d8)]()[_0x4a2426(0x29b)]({'hours':0x18})[_0x4a2426(0x24f)]():null;await db['run'](_0x4a2426(0x251)+'ate_settin'+_0x4a2426(0x29a)+_0x4a2426(0x198)+_0x4a2426(0x1f8)+_0x4a2426(0x1dc)+_0x4a2426(0x203)+_0x4a2426(0x1c0)+'utoupdate\x27',[_0x233bd8?0x3d*0x5+0x87d+-0x9ad:-0x762+-0x601+0xd63,_0x322c2c]);if(_0x233bd8)await updateCheckTimestamps();return!![];}catch(_0x47c76b){return error(_0x47c76b,'['+name+(_0x4a2426(0x1d3)+_0x4a2426(0x199)+'update\x20sta'+_0x4a2426(0x2a4))),![];}}function _0x502e(_0x3aeed3,_0x28d305){const _0x3755b4=_0x1bec();return _0x502e=function(_0x4f24b4,_0x3a093a){_0x4f24b4=_0x4f24b4-(-0x39f+-0x653*0x1+0xb81);let _0x5dd340=_0x3755b4[_0x4f24b4];return _0x5dd340;},_0x502e(_0x3aeed3,_0x28d305);}async function updateCheckTimestamps(){const _0x5f21ab=_0x5e0d8e;try{const _0x2b7818=Math[_0x5f21ab(0x1d0)](Date[_0x5f21ab(0x1d8)]()/(0x56*-0x2+0x925*-0x1+-0x1*-0xdb9)),_0x201d7a=DateTime[_0x5f21ab(0x1d8)]()['plus']({'hours':0x18})[_0x5f21ab(0x24f)]();await db[_0x5f21ab(0x276)](_0x5f21ab(0x251)+_0x5f21ab(0x212)+_0x5f21ab(0x25e)+'t_checked_'+_0x5f21ab(0x1af)+_0x5f21ab(0x1dd)+_0x5f21ab(0x1a2)+'E\x20setting_'+_0x5f21ab(0x1fb)+_0x5f21ab(0x282),[_0x2b7818,Math[_0x5f21ab(0x1d0)](_0x201d7a)]);}catch(_0x27743e){error(_0x27743e,'['+name+(_0x5f21ab(0x1d3)+_0x5f21ab(0x223)+_0x5f21ab(0x270)+_0x5f21ab(0x262)));}}async function safeSend(_0x2d2570,_0x4917fa){const _0x30d6a6=_0x5e0d8e;if(!_0x2d2570){warn('['+name+(_0x30d6a6(0x1e6)+_0x30d6a6(0x259)+_0x30d6a6(0x1ff)+_0x30d6a6(0x222)));return;}try{const _0x5182c2=botRef[_0x30d6a6(0x272)+'e']||botRef[_0x30d6a6(0x1e5)]?.[_0x30d6a6(0x272)+'e'];if(_0x5182c2)await _0x5182c2(_0x2d2570,{'text':_0x4917fa});else warn('['+name+(_0x30d6a6(0x1b1)+_0x30d6a6(0x1d6)+_0x30d6a6(0x27c)));}catch(_0x3195bf){error(_0x3195bf,'['+name+(']\x20Failed\x20t'+'o\x20send\x20mes'+_0x30d6a6(0x21d))+_0x2d2570);}}async function fetchBuildInfo(){const _0x1f8311=_0x5e0d8e;try{const _0x37511d=await fetch(API_URL);if(!_0x37511d['ok'])throw new Error(_0x1f8311(0x26a)+_0x1f8311(0x1cd)+_0x37511d['status']);return await _0x37511d[_0x1f8311(0x20e)]();}catch(_0x1b02d7){return error(_0x1b02d7,'['+name+(_0x1f8311(0x1d3)+_0x1f8311(0x195)+_0x1f8311(0x2a0))),null;}}async function getLocalSnapshot(){const _0x31b3f1=_0x5e0d8e;try{const _0x1d1467=await _0x5567ce[_0x31b3f1(0x1c2)](snapshotPath,_0x31b3f1(0x1b3));return JSON['parse'](_0x1d1467);}catch(_0x252329){return null;}}async function saveLocalSnapshot(_0x4613fc){const _0x37d14c=_0x5e0d8e;try{await _0x5567ce['mkdir'](_0x589a6b[_0x37d14c(0x24a)](snapshotPath),{'recursive':!![]}),await _0x5567ce['writeFile'](snapshotPath,JSON['stringify'](_0x4613fc,null,-0x21c0+-0x1ab*-0x9+0x12bf));}catch(_0x9426af){error(_0x9426af,'['+name+(']\x20Failed\x20t'+'o\x20save\x20loc'+_0x37d14c(0x1ef)+'t'));}}async function createInitialSnapshotIfNeeded(){const _0x10174e=_0x5e0d8e,_0x5d9fa9=await getLocalSnapshot();if(!_0x5d9fa9){info('['+name+(_0x10174e(0x27b)+_0x10174e(0x219)+_0x10174e(0x24e)+_0x10174e(0x1a3)+_0x10174e(0x287)+_0x10174e(0x255)));const _0x1d3577=await fetchBuildInfo();_0x1d3577?(await saveLocalSnapshot(_0x1d3577),info('['+name+(_0x10174e(0x2b0)+_0x10174e(0x2a3)+'reated\x20suc'+'cessfully.'))):warn('['+name+(']\x20Could\x20no'+'t\x20create\x20i'+'nitial\x20sna'+_0x10174e(0x20a)+_0x10174e(0x1c6)+_0x10174e(0x23c)+'accurate.'));}}function getDestinationPath(_0x352233){const _0x4f575d=_0x5e0d8e,_0x19c16a=['bot.js','start.cjs',_0x4f575d(0x1d5)+'on','qrcode.js'];if(_0x352233[_0x4f575d(0x234)]==='carl')return _0x589a6b[_0x4f575d(0x242)](projectRoot,_0x4f575d(0x215),_0x352233[_0x4f575d(0x21f)]);if(_0x352233[_0x4f575d(0x234)]===_0x4f575d(0x213))return _0x589a6b['join'](projectRoot,_0x4f575d(0x213),_0x352233['name']);if(_0x19c16a['includes'](_0x352233[_0x4f575d(0x21f)]))return _0x589a6b['join'](projectRoot,_0x352233['name']);return _0x589a6b['join'](projectRoot,_0x4f575d(0x29d),_0x352233[_0x4f575d(0x21f)]);}async function applyUpdates(_0x151508){const _0x8c1c49=_0x5e0d8e;let _0x15174d=![];const _0x25b9e1=[],_0x17f463=[];for(const _0x312e78 of _0x151508){if(!_0x312e78||!_0x312e78[_0x8c1c49(0x1e9)]){warn('['+name+(_0x8c1c49(0x231)+_0x8c1c49(0x190)+_0x8c1c49(0x1cb))+(_0x312e78?.[_0x8c1c49(0x21f)]??_0x8c1c49(0x1d9))+(_0x8c1c49(0x1ab)+'.'));continue;}const _0x10dd03=getDestinationPath(_0x312e78);try{const _0x1764ae=await fetch(_0x312e78[_0x8c1c49(0x1e9)]);if(!_0x1764ae['ok']){warn('['+name+(']\x20Failed\x20t'+_0x8c1c49(0x221)+'\x20')+_0x312e78[_0x8c1c49(0x21f)]+':\x20'+_0x1764ae[_0x8c1c49(0x25c)]);continue;}const _0x15e43e=await _0x1764ae[_0x8c1c49(0x279)]();let _0x334695=null;try{_0x334695=await _0x5567ce['readFile'](_0x10dd03,_0x8c1c49(0x1b3));}catch(_0x4ad68a){_0x334695=null;}if(_0x334695!==null&&_0x334695===_0x15e43e){info('['+name+(']\x20Skipped\x20'+_0x8c1c49(0x274))+_0x312e78[_0x8c1c49(0x21f)]+(_0x8c1c49(0x290)+_0x8c1c49(0x2aa)+'.'));continue;}await _0x5567ce['mkdir'](_0x589a6b[_0x8c1c49(0x24a)](_0x10dd03),{'recursive':!![]}),await _0x5567ce['writeFile'](_0x10dd03,_0x15e43e,'utf-8'),_0x312e78['origin']===_0x8c1c49(0x215)||_0x312e78[_0x8c1c49(0x234)]===_0x8c1c49(0x213)?_0x25b9e1[_0x8c1c49(0x227)](String(_0x312e78[_0x8c1c49(0x21f)])[_0x8c1c49(0x192)](/\.js$/,'')):_0x17f463['push'](_0x312e78[_0x8c1c49(0x21f)]),info('['+name+(_0x8c1c49(0x22b)+'date\x20for\x20')+_0x312e78['name']+_0x8c1c49(0x299)+_0x10dd03);}catch(_0x87c697){warn(_0x87c697,'['+name+(_0x8c1c49(0x20c)+'ile\x20updati'+'ng\x20')+_0x312e78[_0x8c1c49(0x21f)]);}}const _0xc15409=_0x17f463['includes'](_0x8c1c49(0x1d5)+'on');if(_0xc15409)try{info('['+name+(']\x20package.'+_0x8c1c49(0x29e)+'ed.\x20Runnin'+_0x8c1c49(0x1eb)+_0x8c1c49(0x19b))),await exec(_0x8c1c49(0x23f)+'ll',{'cwd':projectRoot}),info('['+name+(']\x20Dependen'+_0x8c1c49(0x1a5)+_0x8c1c49(0x285)+'ssfully.'));}catch(_0x24e017){error(_0x24e017,'['+name+(_0x8c1c49(0x292)+_0x8c1c49(0x260)+'led.'));}if(_0x17f463[_0x8c1c49(0x1fa)]>0x2154+0x1*0xad+0x6cd*-0x5)_0x15174d=!![];return{'updatedPluginFiles':_0x25b9e1,'updatedCoreFiles':_0x17f463,'needsReboot':_0x15174d};}async function getRemovedPluginsSet(){const _0x159f0a=_0x5e0d8e;try{const _0x46bc00=await _0x5567ce[_0x159f0a(0x1c2)](removedPluginsPath,'utf-8')[_0x159f0a(0x1a0)](()=>null);if(!_0x46bc00)return new Set();const _0x17dd6e=JSON[_0x159f0a(0x2a6)](_0x46bc00);if(!Array['isArray'](_0x17dd6e))return new Set();const _0x2dba40=_0x17dd6e[_0x159f0a(0x281)](_0x20cd6f=>{const _0x1888d2=_0x159f0a;if(!_0x20cd6f)return null;if(typeof _0x20cd6f===_0x1888d2(0x19c))return _0x20cd6f;if(typeof _0x20cd6f===_0x1888d2(0x1df)&&_0x20cd6f[_0x1888d2(0x21f)])return _0x20cd6f[_0x1888d2(0x21f)];return null;})[_0x159f0a(0x263)](Boolean)[_0x159f0a(0x281)](_0x3b6e33=>String(_0x3b6e33)[_0x159f0a(0x265)+'e']()[_0x159f0a(0x192)](/\.js$/,''));return new Set(_0x2dba40);}catch(_0x5de11f){return warn(_0x5de11f,'['+name+(_0x159f0a(0x27e)+_0x159f0a(0x193)+_0x159f0a(0x1d7)+_0x159f0a(0x211)+_0x159f0a(0x22a)+_0x159f0a(0x2b4)+'clusions.')),new Set();}}async function _schedulerTick(){const _0xc3dabb=_0x5e0d8e;if(schedulerRunning)return;schedulerRunning=!![];try{const _0x187290=await getAutoUpdateSettings();if(!_0x187290[_0xc3dabb(0x240)])return;const _0x4781fc=DateTime[_0xc3dabb(0x1d8)](),_0x5f385b=_0x187290[_0xc3dabb(0x298)+'t']?DateTime[_0xc3dabb(0x26d)+'s'](_0x187290[_0xc3dabb(0x298)+'t']):_0x4781fc;_0x4781fc>=_0x5f385b&&(info('['+name+(_0xc3dabb(0x1d2)+'scheduled\x20'+_0xc3dabb(0x254)+_0xc3dabb(0x271))),await performAutomaticUpdate(),await updateCheckTimestamps());}catch(_0x4ddd49){error(_0x4ddd49,'['+name+(']\x20Schedule'+'r\x20tick\x20fai'+_0xc3dabb(0x239)));}finally{schedulerRunning=![];}}function startAutoUpdateScheduler(){const _0x8b791f=_0x5e0d8e;stopAutoUpdateScheduler();const _0x278bdd=0x158c0+-0x1060e+0x97ae-Date['now']()%(-0x1379c+-0x5687+0x27883);setTimeout(()=>{const _0x26e6e3=_0x502e;_schedulerTick()['catch'](()=>{}),schedulerInterval=setInterval(()=>_schedulerTick()[_0x26e6e3(0x1a0)](()=>{}),(-0x1d30+-0xe34*0x2+-0x4*-0xe75)*(-0xfe6+-0x89*-0x36+0xc*-0xc2));},_0x278bdd),info('['+name+(']\x20Auto-upd'+_0x8b791f(0x245)+_0x8b791f(0x2b2)+'d.'));}function stopAutoUpdateScheduler(){schedulerInterval&&(clearInterval(schedulerInterval),schedulerInterval=null);}async function findStoredMatchFromFindings(_0xdd432b=[]){const _0x233f37=_0x5e0d8e;try{const _0xc475ff=await listSudo();if(!Array['isArray'](_0xc475ff)||_0xc475ff[_0x233f37(0x1fa)]===-0x77d*0x1+-0x1*-0x1df3+-0x1676)return null;const _0x2cbcb7=new Set(_0xc475ff[_0x233f37(0x281)](String));for(const _0x1542de of _0xdd432b||[]){if(!_0x1542de||typeof _0x1542de[_0x233f37(0x1a4)]!==_0x233f37(0x19c))continue;const _0x19be5d=normalizeToJid(_0x1542de[_0x233f37(0x1a4)]);if(_0x19be5d&&_0x2cbcb7[_0x233f37(0x288)](_0x19be5d))return _0x19be5d;if(_0x2cbcb7[_0x233f37(0x288)](_0x1542de['jid']))return _0x1542de[_0x233f37(0x1a4)];}return null;}catch(_0x21bc89){return null;}}async function handleManualUpdateCheck(_0x51310d){const _0x1c333a=_0x5e0d8e;await safeSend(_0x51310d,_0x1c333a(0x1a9)+_0x1c333a(0x278)+'es...');const _0x33de92=await fetchBuildInfo();if(!_0x33de92){await safeSend(_0x51310d,_0x1c333a(0x24d)+_0x1c333a(0x26f)+_0x1c333a(0x241)+'\x20Please\x20tr'+_0x1c333a(0x28b)+_0x1c333a(0x2a2));return;}const _0x1990c5=await getLocalSnapshot();!_0x1990c5||_0x33de92[_0x1c333a(0x202)+'ed']!==_0x1990c5[_0x1c333a(0x202)+'ed']?await safeSend(_0x51310d,_0x1c333a(0x1b2)+_0x1c333a(0x280)+_0x1c333a(0x23e)+_0x1c333a(0x1d4)+_0x1c333a(0x1ca)+'y.'):await safeSend(_0x51310d,_0x1c333a(0x1c4)+_0x1c333a(0x2ae)+_0x1c333a(0x1f2)+_0x1c333a(0x28a));}async function handleManualUpdateNow(_0x44b4c0){const _0x4a7a10=_0x5e0d8e;await safeSend(_0x44b4c0,_0x4a7a10(0x1e1)+_0x4a7a10(0x1aa)+_0x4a7a10(0x1cc));const _0x573704=await fetchBuildInfo(),_0x3af6f7=await getLocalSnapshot();if(!_0x573704||!_0x3af6f7){await safeSend(_0x44b4c0,_0x4a7a10(0x24d)+_0x4a7a10(0x226)+_0x4a7a10(0x2b5)+'tion.\x20Abor'+_0x4a7a10(0x261));return;}const _0x59e988=await getRemovedPluginsSet(),_0x5407e8=new Map(_0x3af6f7['files']['map'](_0x37069b=>[_0x37069b[_0x4a7a10(0x21f)],_0x37069b])),_0x21b8a7=_0x573704[_0x4a7a10(0x25b)][_0x4a7a10(0x263)](_0x5905c5=>_0x5407e8[_0x4a7a10(0x1e3)](_0x5905c5[_0x4a7a10(0x21f)])?.[_0x4a7a10(0x264)]!==_0x5905c5[_0x4a7a10(0x264)]),_0x1d586d=[],_0x4b6f11=[];for(const _0x14524e of _0x21b8a7){if(!_0x14524e||!_0x14524e[_0x4a7a10(0x234)]){_0x4b6f11[_0x4a7a10(0x227)](_0x14524e);continue;}if(['carl',_0x4a7a10(0x213)][_0x4a7a10(0x204)](_0x14524e['origin'])){const _0x456972=String(_0x14524e['name'])[_0x4a7a10(0x265)+'e']()[_0x4a7a10(0x192)](/\.js$/,'');if(_0x59e988[_0x4a7a10(0x288)](_0x456972)){_0x1d586d[_0x4a7a10(0x227)](_0x456972);continue;}}_0x4b6f11[_0x4a7a10(0x227)](_0x14524e);}if(_0x4b6f11['length']===-0x8bf+-0x1*-0x1d27+-0x1468){await saveLocalSnapshot(_0x573704);if(_0x1d586d['length']>0x1*-0x20a1+-0x1172+0x3213){const _0x12cfe2=_0x1d586d['map']((_0x689d95,_0x26cc10)=>_0x26cc10+(-0x1eae+0xa66+0x1449)+'.\x20'+_0x689d95)[_0x4a7a10(0x242)]('\x0a');await safeSend(_0x44b4c0,_0x4a7a10(0x20b)+_0x4a7a10(0x224)+_0x4a7a10(0x1bf)+_0x4a7a10(0x19d)+_0x4a7a10(0x1c1)+'g:\x0a'+_0x12cfe2);}else await safeSend(_0x44b4c0,_0x4a7a10(0x207)+_0x4a7a10(0x2a8)+_0x4a7a10(0x22c)+_0x4a7a10(0x1f9));return;}const _0x1e10ee=await applyUpdates(_0x4b6f11);if(!_0x1e10ee){await safeSend(_0x44b4c0,'🔄\x20Update\x20f'+_0x4a7a10(0x28c)+_0x4a7a10(0x2ad)+_0x4a7a10(0x24b));return;}const {updatedPluginFiles:_0x982594,updatedCoreFiles:_0x411bff,needsReboot:_0x2fad28}=_0x1e10ee;if(_0x982594[_0x4a7a10(0x1fa)]===0x1*-0x2063+-0x11d0+0x3233&&_0x411bff['length']===0x1b79+-0xa*0x1f4+-0x7f1){await saveLocalSnapshot(_0x573704);if(_0x1d586d[_0x4a7a10(0x1fa)]>0x1b54+-0xf00+-0xc54){const _0x433b4d=_0x1d586d[_0x4a7a10(0x281)]((_0x349e93,_0x53fd6a)=>_0x53fd6a+(-0xef7*-0x1+-0x431+0xac5*-0x1)+'.\x20'+_0x349e93)[_0x4a7a10(0x242)]('\x0a');await safeSend(_0x44b4c0,_0x4a7a10(0x20b)+_0x4a7a10(0x224)+'tes\x20were\x20a'+_0x4a7a10(0x28e)+_0x4a7a10(0x1be)+_0x4a7a10(0x26e)+_0x433b4d);}else await safeSend(_0x44b4c0,'🔄\x20Everythi'+_0x4a7a10(0x2a8)+_0x4a7a10(0x22c)+_0x4a7a10(0x1f9));return;}const _0x2d44a3=[];if(_0x982594[_0x4a7a10(0x1fa)]>-0x2000+-0x541+0x2541){if(_0x982594[_0x4a7a10(0x1fa)]<=-0x1*-0x1454+-0x1af0+0x6a6){const _0x502775=_0x982594[_0x4a7a10(0x281)]((_0x2ea152,_0x53a11d)=>_0x53a11d+(-0x5*-0x151+-0x1*0x2217+-0x1*-0x1b83)+'.\x20'+_0x2ea152)[_0x4a7a10(0x242)]('\x0a');_0x2d44a3[_0x4a7a10(0x227)]('🔄\x20Updated\x20'+'plugins:\x0a'+_0x502775);}else _0x2d44a3[_0x4a7a10(0x227)](_0x4a7a10(0x283)+_0x4a7a10(0x1f4)+_0x4a7a10(0x216)+'0\x20plugin\x20f'+_0x4a7a10(0x27d)+_0x4a7a10(0x28d));}_0x411bff[_0x4a7a10(0x1fa)]>0x1489+0x1*0x13a3+-0x282c&&_0x2d44a3[_0x4a7a10(0x227)](_0x4a7a10(0x283)+_0x4a7a10(0x1de)+_0x4a7a10(0x194));if(_0x2d44a3[_0x4a7a10(0x1fa)]===-0x1*0x2407+-0x1*0xf65+-0x336c*-0x1)_0x2d44a3[_0x4a7a10(0x227)](_0x4a7a10(0x1b5)+_0x4a7a10(0x23b));(_0x411bff[_0x4a7a10(0x1fa)]>-0x813+-0x9c0+0x11d3*0x1||_0x2fad28)&&_0x2d44a3[_0x4a7a10(0x227)](_0x4a7a10(0x1ae)+_0x4a7a10(0x2a5)+_0x4a7a10(0x27f)+_0x4a7a10(0x293)+_0x4a7a10(0x1a7)+'ges\x20to\x20tak'+_0x4a7a10(0x1ba));const _0x27fd18=_0x2d44a3[_0x4a7a10(0x242)]('\x0a\x0a');await safeSend(_0x44b4c0,_0x27fd18),await saveLocalSnapshot(_0x573704);}async function performAutomaticUpdate(){const _0x320322=_0x5e0d8e,_0xd3e37c=await fetchBuildInfo(),_0x4a74d3=await getLocalSnapshot();if(!_0xd3e37c||!_0x4a74d3||_0xd3e37c[_0x320322(0x202)+'ed']===_0x4a74d3[_0x320322(0x202)+'ed'])return;const _0x27e799=await getRemovedPluginsSet(),_0x464a70=new Map(_0x4a74d3[_0x320322(0x25b)][_0x320322(0x281)](_0x498f39=>[_0x498f39['name'],_0x498f39])),_0x4ccc73=_0xd3e37c[_0x320322(0x25b)][_0x320322(0x263)](_0x2213fa=>_0x464a70[_0x320322(0x1e3)](_0x2213fa[_0x320322(0x21f)])?.[_0x320322(0x264)]!==_0x2213fa['mtime']);if(_0x4ccc73[_0x320322(0x1fa)]===0x199b+-0xf7+0x4c*-0x53){await saveLocalSnapshot(_0xd3e37c);return;}const _0x209738=[],_0x592812=[];for(const _0x48926e of _0x4ccc73){if(!_0x48926e||!_0x48926e[_0x320322(0x234)]){_0x592812[_0x320322(0x227)](_0x48926e);continue;}if([_0x320322(0x215),_0x320322(0x213)][_0x320322(0x204)](_0x48926e['origin'])){const _0x2217b5=String(_0x48926e['name']||'')[_0x320322(0x265)+'e']()[_0x320322(0x192)](/\.js$/,'');if(_0x27e799[_0x320322(0x288)](_0x2217b5)){_0x209738[_0x320322(0x227)](_0x2217b5);continue;}}_0x592812[_0x320322(0x227)](_0x48926e);}if(_0x592812[_0x320322(0x1fa)]===-0x1d89+0xc5f*0x1+0x112a){info('['+name+(_0x320322(0x249)+_0x320322(0x26c)+_0x320322(0x297)+_0x320322(0x275)+_0x320322(0x200))+_0x209738[_0x320322(0x1fa)]+(_0x320322(0x273)+'lugin(s).')),await saveLocalSnapshot(_0xd3e37c);return;}info('['+name+(_0x320322(0x249)+'ate\x20found\x20')+_0x592812[_0x320322(0x1fa)]+('\x20new\x20files'+'\x20(skipped\x20')+_0x209738['length']+(_0x320322(0x21e)+_0x320322(0x1e0)+'..'));const _0x4e9f51=await applyUpdates(_0x592812);if(!_0x4e9f51){warn('['+name+(']\x20Auto-upd'+_0x320322(0x1fd)+_0x320322(0x277)+_0x320322(0x1fe)+'result.')),await saveLocalSnapshot(_0xd3e37c);return;}const {updatedPluginFiles:_0xd9aaab,updatedCoreFiles:_0x23ce5e,needsReboot:_0x20876a}=_0x4e9f51;if(_0xd9aaab[_0x320322(0x1fa)]===-0xcf6*0x1+-0x8b*-0x3f+-0x153f&&_0x23ce5e[_0x320322(0x1fa)]===0xec0+-0x1363+0x1*0x4a3){info('['+name+(_0x320322(0x249)+_0x320322(0x296)+_0x320322(0x29c)+_0x320322(0x29f)+_0x320322(0x1a8)+_0x320322(0x291)+_0x320322(0x1ee)+_0x320322(0x214)+'d\x20')+_0x209738['length']+('\x20removed\x20p'+'lugin(s).')),await saveLocalSnapshot(_0xd3e37c);return;}if(_0x23ce5e['length']>-0x13d9+0x4b5+0xf24){info('['+name+(_0x320322(0x249)+_0x320322(0x2ab)+_0x320322(0x21b)+'ates.\x20Noti'+_0x320322(0x23a)+'r.'));const _0x5e204e=getBotJid();if(_0x5e204e){const _0x14fb6a=[];_0xd9aaab['length']>0xa79+-0x296*-0xd+0x2c17*-0x1&&(_0xd9aaab['length']<=-0x1c16+-0xff1+-0x2c11*-0x1?_0x14fb6a[_0x320322(0x227)](_0x320322(0x1f5)+_0x320322(0x1c9)+_0xd9aaab[_0x320322(0x281)]((_0x3ecb9c,_0x27d083)=>_0x27d083+(-0x219b*0x1+-0x23ca+0xe*0x4f5)+'.\x20'+_0x3ecb9c)[_0x320322(0x242)]('\x0a')):_0x14fb6a[_0x320322(0x227)](_0x320322(0x1f5)+_0x320322(0x1db)+'e\x20than\x2010\x20'+_0x320322(0x247)+'es\x20were\x20up'+'dated.')),_0x14fb6a[_0x320322(0x227)](_0x320322(0x1c8)+_0x320322(0x22f)+_0x320322(0x208)),await safeSend(_0x5e204e,'ℹ️\x20Automati'+_0x320322(0x1ea)+_0x320322(0x217)+_0x14fb6a['join']('\x0a\x0a')+('\x0a\x0aPlease\x20r'+_0x320322(0x266)+'boot`\x20comm'+'and\x20to\x20app'+_0x320322(0x1b4)+_0x320322(0x201)));}}else info('['+name+(_0x320322(0x249)+_0x320322(0x2ab)+_0x320322(0x295)+'pdates:\x20')+_0xd9aaab[_0x320322(0x1fa)]+'\x20item(s).');await saveLocalSnapshot(_0xd3e37c),info('['+name+(_0x320322(0x249)+_0x320322(0x2ab)+_0x320322(0x268)+'ully.'));}export async function initialize(_0x3d6ea0){const _0x1a980e=_0x5e0d8e;botRef=_0x3d6ea0,await ensureSchema(),await createInitialSnapshotIfNeeded(),startManagedListener({'botRef':botRef,'eventName':_0x1a980e(0x230)+_0x1a980e(0x24c),'moduleName':name,'handler':_0x51ff1a=>{const _0x1f482b=_0x1a980e;if(_0x51ff1a[_0x1f482b(0x230)]===_0x1f482b(0x197))startAutoUpdateScheduler();else{if(_0x51ff1a[_0x1f482b(0x230)]===_0x1f482b(0x23d))stopAutoUpdateScheduler();}}}),(botRef['ws']?.['readyState']===-0x77*0x31+-0x3*0xcb5+0x3ce7||botRef[_0x1a980e(0x1e5)]?.['ws']?.[_0x1a980e(0x1da)]===-0x15ce*-0x1+-0x1*-0x30f+0x4*-0x637)&&startAutoUpdateScheduler(),info('['+name+(_0x1a980e(0x246)+_0x1a980e(0x1ad)));}export async function onMessage(_0x579ce3){const _0x261711=_0x5e0d8e;try{if(!_0x579ce3||!_0x579ce3[_0x261711(0x218)])return;const _0x3258d7=_0x579ce3[_0x261711(0x218)]?.[_0x261711(0x1bd)];if(!_0x3258d7||_0x3258d7['endsWith'](_0x261711(0x19e)))return;const _0xdc9268=(_0x579ce3[_0x261711(0x279)]||'')[_0x261711(0x28f)]()[_0x261711(0x265)+'e'](),_0x4e5906=_0xdc9268['split'](/\s+/),_0x6c954d=_0x4e5906[-0xfde+0x1ba4+-0xb*0x112];if(!commands[_0x261711(0x204)](_0x6c954d))return;const _0x269cd0=!!_0x579ce3[_0x261711(0x218)][_0x261711(0x284)],_0x1b386d=await isSudo(botRef,_0x579ce3);if(!_0x269cd0&&!_0x1b386d)return;let _0x4371cd=_0x269cd0?getBotJid():await findStoredMatchFromFindings(userJidFromCtx(_0x579ce3)[_0x261711(0x1f7)]);if(!_0x4371cd)return;if(_0x6c954d===_0x261711(0x1c3)){const _0x386afd=_0x4e5906[0xc32+-0x4c*-0x3a+-0x1d69*0x1];if(_0x386afd===_0x261711(0x1d8))await handleManualUpdateNow(_0x4371cd);else await handleManualUpdateCheck(_0x4371cd);}else{if(_0x6c954d===_0x261711(0x1f1)){const _0x8e1f3a=_0x4e5906[0x6f9+-0x21cb+0x1ad3];if(_0x8e1f3a==='on')await setAutoUpdateStatus(!![]),await safeSend(_0x4371cd,_0x261711(0x225)+'c\x20updates\x20'+_0x261711(0x1ec)+_0x261711(0x26b)+_0x261711(0x1d1)+_0x261711(0x210)+'r\x20updates\x20'+_0x261711(0x191)+_0x261711(0x1e4));else{if(_0x8e1f3a===_0x261711(0x235))await setAutoUpdateStatus(![]),await safeSend(_0x4371cd,_0x261711(0x225)+_0x261711(0x25a)+'have\x20been\x20'+'DISABLED.');else{const _0x236d60=await getAutoUpdateSettings(),_0x2313a2=_0x236d60[_0x261711(0x240)]?_0x261711(0x205):_0x261711(0x250),_0x410e80=_0x236d60[_0x261711(0x298)+'t']?DateTime[_0x261711(0x26d)+'s'](_0x236d60[_0x261711(0x298)+'t'])[_0x261711(0x1bc)]():_0x261711(0x233)+'led';await safeSend(_0x4371cd,_0x261711(0x22e)+_0x261711(0x256)+_0x261711(0x289)+'*'+_0x2313a2+(_0x261711(0x1b9)+'ck:\x20')+_0x410e80+(_0x261711(0x1b0)+_0x261711(0x2af)+_0x261711(0x294)));}}}}}catch(_0x273582){error(_0x273582,'['+name+(_0x261711(0x19f)+_0x261711(0x25f)));}}export async function cleanup(){const _0x1e799b=_0x5e0d8e;stopAutoUpdateScheduler(),stopManagedListener(name,_0x1e799b(0x230)+_0x1e799b(0x24c)),botRef=null,info('['+name+(_0x1e799b(0x1ed)+_0x1e799b(0x228)));}