const _0x129d88=_0x250e;(function(_0x4fce76,_0xd7ffb5){const _0x2a969d=_0x250e,_0x5dffc1=_0x4fce76();while(!![]){try{const _0x4b7bce=parseInt(_0x2a969d(0x19b))/(-0xc34+-0x37*0x6b+0x2332)*(-parseInt(_0x2a969d(0x26c))/(0x375+-0x1e7f+0x1b0c))+-parseInt(_0x2a969d(0x17e))/(-0x1af6+-0x625+-0x36*-0x9d)*(-parseInt(_0x2a969d(0x275))/(-0x1*-0xde6+-0x2599+0x17b7))+-parseInt(_0x2a969d(0x25b))/(0x1*0x443+-0x119*-0x1a+-0x20c8*0x1)+parseInt(_0x2a969d(0x16d))/(0x35*0x51+0x2130+-0x31ef)+parseInt(_0x2a969d(0x195))/(0x56f+-0x9*-0xc7+-0x27b*0x5)+-parseInt(_0x2a969d(0x166))/(-0x19d2+0x24db+-0xb01)+parseInt(_0x2a969d(0x1ff))/(-0x1*0x2bb+-0x212+0x4d6);if(_0x4b7bce===_0xd7ffb5)break;else _0x5dffc1['push'](_0x5dffc1['shift']());}catch(_0x1aa483){_0x5dffc1['push'](_0x5dffc1['shift']());}}}(_0x1f95,-0x29*0x2146+0x5ba5d+0x5c1b4));import _0x126b2f from'fs/promises';import _0x11bccb from'path';import{exec as _0x174460}from'child_process';import{promisify}from'util';import{fileURLToPath}from'url';import{DateTime}from'luxon';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{isSudo,listSudo,normalizeToJid,userJidFromCtx}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';const exec=promisify(_0x174460);export const name=_0x129d88(0x1b8);export const version=_0x129d88(0x188);export const priority=-0xad+-0x3ad*0x8+0x1e47;export const commands=[_0x129d88(0x1b8),_0x129d88(0x228)];let botRef=null,schedulerInterval=null,schedulerRunning=![];const API_URL='https://i-'+_0x129d88(0x17f)+_0x129d88(0x1da),__filename=fileURLToPath(import.meta[_0x129d88(0x233)]),__dirname=_0x11bccb[_0x129d88(0x1cb)](__filename),projectRoot=_0x11bccb[_0x129d88(0x184)](__dirname,'..'),snapshotPath=_0x11bccb[_0x129d88(0x1aa)](projectRoot,_0x129d88(0x1f6),_0x129d88(0x182),'.update.js'+'on'),removedPluginsPath=_0x11bccb['join'](projectRoot,'data',_0x129d88(0x182),'.removed.j'+_0x129d88(0x171));function _0x250e(_0x245478,_0x487612){const _0x37e2bb=_0x1f95();return _0x250e=function(_0x1b7983,_0x59e799){_0x1b7983=_0x1b7983-(-0x1caf+-0x1aa6+0x38a2);let _0x2edd04=_0x37e2bb[_0x1b7983];return _0x2edd04;},_0x250e(_0x245478,_0x487612);}async function ensureSchema(){const _0x470507=_0x129d88;try{await db[_0x470507(0x15a)](_0x470507(0x211)+_0x470507(0x210)+_0x470507(0x1f7)+_0x470507(0x1e3)+'update_set'+_0x470507(0x21b)+_0x470507(0x220)+_0x470507(0x17a)+_0x470507(0x221)+_0x470507(0x26e)+_0x470507(0x199)+_0x470507(0x220)+'enabled\x20IN'+_0x470507(0x219)+_0x470507(0x155)+_0x470507(0x220)+_0x470507(0x180)+'ecked_at\x20I'+_0x470507(0x1c7)+_0x470507(0x220)+_0x470507(0x178)+_0x470507(0x1a8)+_0x470507(0x1c6)+_0x470507(0x172)+_0x470507(0x21c));const _0x112072=await db['get']('SELECT\x20*\x20F'+_0x470507(0x23c)+_0x470507(0x1bc)+_0x470507(0x1b1)+'ing_key\x20=\x20'+_0x470507(0x243)+'e\x27');!_0x112072&&await db[_0x470507(0x1b0)]('INSERT\x20INT'+_0x470507(0x1cc)+_0x470507(0x232)+_0x470507(0x1db)+')\x20VALUES\x20('+_0x470507(0x243)+'e\x27)'),info('['+name+(_0x470507(0x204)+_0x470507(0x237)));}catch(_0x292cf5){error(_0x292cf5,'['+name+(_0x470507(0x204)+_0x470507(0x230)+_0x470507(0x151)+'led'));throw _0x292cf5;}}async function getAutoUpdateSettings(){const _0x11952b=_0x129d88;try{const _0x3bcb8d=await db[_0x11952b(0x1f1)]('SELECT\x20*\x20F'+_0x11952b(0x23c)+'_settings\x20'+'WHERE\x20sett'+_0x11952b(0x200)+_0x11952b(0x243)+'e\x27');return{'enabled':!!_0x3bcb8d?.[_0x11952b(0x193)],'lastCheckedAt':_0x3bcb8d?.[_0x11952b(0x20c)+_0x11952b(0x174)]||null,'nextCheckAt':_0x3bcb8d?.['next_check'+'_at']||null};}catch(_0x2391e4){return error(_0x2391e4,'['+name+(_0x11952b(0x213)+_0x11952b(0x21d)+_0x11952b(0x16f)+_0x11952b(0x20a))),{'enabled':![],'lastCheckedAt':null,'nextCheckAt':null};}}async function setAutoUpdateStatus(_0x186dc6){const _0x50fe48=_0x129d88;try{const _0x210ef7=_0x186dc6?DateTime[_0x50fe48(0x1dc)]()[_0x50fe48(0x19a)]({'hours':0x18})[_0x50fe48(0x159)]():null;await db[_0x50fe48(0x1b0)](_0x50fe48(0x1f3)+_0x50fe48(0x26f)+_0x50fe48(0x262)+_0x50fe48(0x21e)+_0x50fe48(0x244)+_0x50fe48(0x1d9)+_0x50fe48(0x258)+_0x50fe48(0x20b)+_0x50fe48(0x22e),[_0x186dc6?-0x18f7*0x1+0xb*0xb2+0x1152:-0x10df+0x11f9+-0x11a,_0x210ef7]);if(_0x186dc6)await updateCheckTimestamps();return!![];}catch(_0x1b3bdb){return error(_0x1b3bdb,'['+name+(_0x50fe48(0x213)+_0x50fe48(0x229)+'update\x20sta'+_0x50fe48(0x270))),![];}}async function updateCheckTimestamps(){const _0x1b8721=_0x129d88;try{const _0x7b05a3=Math[_0x1b8721(0x1a7)](Date['now']()/(0x1279*0x1+-0x5*-0x25d+0x1a62*-0x1)),_0x41403e=DateTime[_0x1b8721(0x1dc)]()['plus']({'hours':0x18})[_0x1b8721(0x159)]();await db[_0x1b8721(0x1b0)]('UPDATE\x20upd'+'ate_settin'+_0x1b8721(0x15c)+_0x1b8721(0x1cd)+_0x1b8721(0x1ae)+_0x1b8721(0x1b9)+_0x1b8721(0x234)+_0x1b8721(0x247)+'key\x20=\x20\x27aut'+_0x1b8721(0x24e),[_0x7b05a3,Math[_0x1b8721(0x1a7)](_0x41403e)]);}catch(_0x4508bc){error(_0x4508bc,'['+name+(_0x1b8721(0x213)+_0x1b8721(0x187)+_0x1b8721(0x169)+_0x1b8721(0x278)));}}function _0x1f95(){const _0x3d9ab2=['update','xt_check_a','writeFile','download','_settings\x20','oved\x20plugi','and\x20to\x20app','able.\x20Run\x20','files','es...','sock','e\x20effect.','result.','\x0a\x0aStatus:\x20','TEGER\x0a\x20\x20\x20\x20','NTEGER,\x0a\x20\x20','reated\x20suc','üîÑ\x20Starting','found.\x20Cre','dirname','O\x20update_s','t_checked_','nts.','ully.','updated.','iles\x20were\x20','üîÑ\x20Everythi','y\x20again\x20la','ady\x20up\x20to\x20','üîÑ\x20No\x20appli','string','he\x20bot\x20wil','name','_at\x20=\x20?\x20WH','ild','etting_key','now','utf-8','readFile','up.','ate:\x20apply','ritten\x20(do','\x20‚Äî\x20content','OT\x20EXISTS\x20','API\x20reques','bot.js','led','t\x20create\x20i','ltering\x20','map','or\x20','.update','start.cjs',';\x20skipping','c\x20updates\x20','DISABLED.','al\x20snapsho','get','ore\x20than\x201','UPDATE\x20upd','w`\x20to\x20appl','ate:\x20no\x20fi','data','TABLE\x20IF\x20N',']\x20Schedule','`update\x20no','Not\x20schedu','\x20core\x20chan','origin','filter',']\x20Running\x20','7550433ALfRvU','ing_key\x20=\x20','auto-updat','otice:\x0a\x0a','writing\x20',']\x20DB\x20schem','modules','text','o\x20download','y\x20have\x20bee','\x20->\x20','tings','g_key\x20=\x20\x27a','last_check','led.','l).\x20Skippe','ENABLED','\x20\x20\x20CREATE\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','kipped\x20upd',']\x20Failed\x20t',']\x20initiali','üîÑ\x20Updated\x20','e\x20is\x20avail',']\x20Skipped\x20','les\x20were\x20w','TEGER\x20DEFA','roceeding\x20','tings\x20(\x0a\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','o\x20get\x20auto','bled\x20=\x20?,\x20','fromSecond','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','g_key\x20TEXT','*Auto-Upda','boot`\x20comm','<unknown>','lastModifi','API\x20availa','pdates:\x20','autoupdate','o\x20set\x20auto','\x20update\x20pr',']\x20Auto-upd',']\x20No\x20send\x20','date.','utoupdate\x27','isArray','a\x20initiali','parse','ettings\x20(s','url','t\x20=\x20?\x20WHER','have\x20been\x20','ating:\x0a','a\x20ensured.','ate\x20applie','clusions.','y\x20after\x20fi','n\x20the\x20`reb','ROM\x20update','mkdir','ly\x20core\x20ch','without\x20ex','n\x20identica','t\x20check\x20fo','ailed\x20whil','\x27autoupdat','next_check','catch','ly.\x0a\x0aSkipp','E\x20setting_','un...','pshot.\x20Upd','includes','fromMe','jid','yarn\x20insta','oupdate\x27','ng\x20is\x20alre','length','stall\x27...','üîÑ\x20Checking','@g.us','plugin\x20fil','ble.','es\x20were\x20up',']\x20Initial\x20','ERE\x20settin','e\x20check...','\x0aPlease\x20ru','3088935IfATrZ','endsWith','ed\x20updatin','l\x20check\x20fo',']\x20cleaned\x20','tes\x20to\x20app','d\x20core\x20upd','gs\x20SET\x20ena','ate\x20checks','ating\x20one\x20','ed.\x20Runnin',']\x20Error\x20wh','on|off','anges.','Updated\x20co','üîÑ\x20Automati','cable\x20upda','89690rsnmNG','plugins:\x0a','\x20PRIMARY\x20K','ate_settin','tus','stringify','ler\x20starte','ate\x20found\x20','readyState','44REPaNp','wnloads\x20ma','has','tamps',']\x20package.','y\x20up\x20to\x20da','e\x20than\x2010\x20','\x20called\x20wi','\x20removed).','zation\x20fai','un\x20the\x20`re','ges\x20to\x20tak','te\x20Status*','ULT\x200,\x0a\x20\x20\x20','mtime','\x20removed\x20p','utils','toSeconds','exec','e\x20applying','gs\x20SET\x20las','status','ates.\x20Noti','ugins:\x0a','carl','\x20new\x20files','\x20unchanged','push','scheduled\x20','d\x20plugin\x20u','1538008nWineF','o\x20fetch\x20bu',']\x20Wrote\x20up','heck\x20times','qrcode.js','lugin(s).','\x0a\x0aPlease\x20r','682806DzuQmk','ns\x20file;\x20p','update\x20set','connection','son','\x20\x20\x20\x20\x20\x20\x20\x20);','toRelative','ed_at','ng\x20to\x20appl','0\x20plugin\x20f','Updated\x20pl','\x20\x20\x20\x20next_c','json','\x20\x20\x20\x20settin','o\x20send\x20mes','nextCheckA','ssfully.','68748nxGDRA','tct.com/bu','\x20\x20\x20last_ch','key','tmp','ugins:\x20Mor','resolve','d\x20successf','\x20updates.','o\x20update\x20c','2.1.5','nents.','on\x20first\x20r','every\x2024\x20h','g\x20\x27yarn\x20in','replace','ter.','cies\x20insta','sendMessag','te\x20informa','ours.','enabled','core\x20compo','4141396qyANnG',']\x20Missing\x20','utoupdate\x20','üîÑ\x20Could\x20no','EY,\x0a\x20\x20\x20\x20\x20\x20','plus','13JuMeyo','r\x20updates.','\x20Please\x20tr','pplied.\x0a\x0aS','t\x20get\x20upda','package.js','\x20for\x20updat','toLowerCas','findings','open','ate\x20schedu','date\x20for\x20','floor','heck_at\x20IN',']\x20No\x20local','join','c\x20Update\x20N','‚ÑπÔ∏è\x20Automati',']\x20onMessag','at\x20=\x20?,\x20ne','lled\x20succe','run','WHERE\x20sett','cessfully.','r\x20tick\x20fai','ocess...','o\x20save\x20loc','close','plugins:\x20M'];_0x1f95=function(){return _0x3d9ab2;};return _0x1f95();}async function safeSend(_0x5ce102,_0x2211d1){const _0x5e377b=_0x129d88;if(!_0x5ce102){warn('['+name+(']\x20safeSend'+_0x5e377b(0x14f)+'th\x20no\x20dest'+'ination.'));return;}try{const _0x1fed1e=botRef['sendMessag'+'e']||botRef[_0x5e377b(0x1c2)]?.[_0x5e377b(0x190)+'e'];if(_0x1fed1e)await _0x1fed1e(_0x5ce102,{'text':_0x2211d1});else warn('['+name+(_0x5e377b(0x22c)+_0x5e377b(0x226)+_0x5e377b(0x255)));}catch(_0x5d1025){error(_0x5d1025,'['+name+(_0x5e377b(0x213)+_0x5e377b(0x17b)+'sage\x20to\x20')+_0x5ce102);}}async function fetchBuildInfo(){const _0x3f7026=_0x129d88;try{const _0x10cd43=await fetch(API_URL);if(!_0x10cd43['ok'])throw new Error(_0x3f7026(0x1e4)+'t\x20failed:\x20'+_0x10cd43[_0x3f7026(0x15d)]);return await _0x10cd43[_0x3f7026(0x179)]();}catch(_0x2f1733){return error(_0x2f1733,'['+name+(_0x3f7026(0x213)+_0x3f7026(0x167)+'ild\x20info')),null;}}async function getLocalSnapshot(){const _0x527e9a=_0x129d88;try{const _0x23344a=await _0x126b2f['readFile'](snapshotPath,'utf-8');return JSON[_0x527e9a(0x231)](_0x23344a);}catch(_0x34eeb9){return null;}}async function saveLocalSnapshot(_0x11ee48){const _0xbce46b=_0x129d88;try{await _0x126b2f[_0xbce46b(0x23d)](_0x11bccb['dirname'](snapshotPath),{'recursive':!![]}),await _0x126b2f['writeFile'](snapshotPath,JSON[_0xbce46b(0x271)](_0x11ee48,null,-0x815*-0x3+0xa*0x22f+0x23*-0x151));}catch(_0x18dcf9){error(_0x18dcf9,'['+name+(_0xbce46b(0x213)+_0xbce46b(0x1b5)+_0xbce46b(0x1f0)+'t'));}}async function createInitialSnapshotIfNeeded(){const _0x55ae7c=_0x129d88,_0x14e753=await getLocalSnapshot();if(!_0x14e753){info('['+name+(_0x55ae7c(0x1a9)+'\x20snapshot\x20'+_0x55ae7c(0x1ca)+_0x55ae7c(0x264)+_0x55ae7c(0x18a)+_0x55ae7c(0x248)));const _0x3e1df9=await fetchBuildInfo();_0x3e1df9?(await saveLocalSnapshot(_0x3e1df9),info('['+name+(_0x55ae7c(0x257)+'snapshot\x20c'+_0x55ae7c(0x1c8)+_0x55ae7c(0x1b2)))):warn('['+name+(']\x20Could\x20no'+_0x55ae7c(0x1e7)+'nitial\x20sna'+_0x55ae7c(0x249)+_0x55ae7c(0x263)+'\x20may\x20be\x20in'+'accurate.'));}}function getDestinationPath(_0x46f1d9){const _0x12433f=_0x129d88,_0x9097c4=[_0x12433f(0x1e5),_0x12433f(0x1ec),_0x12433f(0x1a0)+'on',_0x12433f(0x16a)];if(_0x46f1d9['origin']===_0x12433f(0x160))return _0x11bccb['join'](projectRoot,_0x12433f(0x160),_0x46f1d9[_0x12433f(0x1d8)]);if(_0x46f1d9[_0x12433f(0x1fc)]===_0x12433f(0x205))return _0x11bccb[_0x12433f(0x1aa)](projectRoot,_0x12433f(0x205),_0x46f1d9[_0x12433f(0x1d8)]);if(_0x9097c4['includes'](_0x46f1d9['name']))return _0x11bccb[_0x12433f(0x1aa)](projectRoot,_0x46f1d9[_0x12433f(0x1d8)]);return _0x11bccb[_0x12433f(0x1aa)](projectRoot,_0x12433f(0x158),_0x46f1d9[_0x12433f(0x1d8)]);}async function applyUpdates(_0x4b56e5){const _0x5d2224=_0x129d88;let _0x124f71=![];const _0x1beb1d=[],_0x50d58c=[];for(const _0x1da6ac of _0x4b56e5){if(!_0x1da6ac||!_0x1da6ac['download']){warn('['+name+(_0x5d2224(0x196)+'download\x20f'+_0x5d2224(0x1ea))+(_0x1da6ac?.['name']??_0x5d2224(0x224))+(_0x5d2224(0x1ed)+'.'));continue;}const _0x3eca69=getDestinationPath(_0x1da6ac);try{const _0x3f6f13=await fetch(_0x1da6ac[_0x5d2224(0x1bb)]);if(!_0x3f6f13['ok']){warn('['+name+(']\x20Failed\x20t'+_0x5d2224(0x207)+'\x20')+_0x1da6ac[_0x5d2224(0x1d8)]+':\x20'+_0x3f6f13[_0x5d2224(0x15d)]);continue;}const _0x37d9e3=await _0x3f6f13[_0x5d2224(0x206)]();let _0xb5b645=null;try{_0xb5b645=await _0x126b2f[_0x5d2224(0x1de)](_0x3eca69,_0x5d2224(0x1dd));}catch(_0x2898c6){_0xb5b645=null;}if(_0xb5b645!==null&&_0xb5b645===_0x37d9e3){info('['+name+(_0x5d2224(0x217)+_0x5d2224(0x203))+_0x1da6ac[_0x5d2224(0x1d8)]+(_0x5d2224(0x1e2)+_0x5d2224(0x162)+'.'));continue;}await _0x126b2f[_0x5d2224(0x23d)](_0x11bccb['dirname'](_0x3eca69),{'recursive':!![]}),await _0x126b2f[_0x5d2224(0x1ba)](_0x3eca69,_0x37d9e3,_0x5d2224(0x1dd)),_0x1da6ac['origin']===_0x5d2224(0x160)||_0x1da6ac[_0x5d2224(0x1fc)]===_0x5d2224(0x205)?_0x1beb1d[_0x5d2224(0x163)](String(_0x1da6ac[_0x5d2224(0x1d8)])[_0x5d2224(0x18d)](/\.js$/,'')):_0x50d58c[_0x5d2224(0x163)](_0x1da6ac[_0x5d2224(0x1d8)]),info('['+name+(_0x5d2224(0x168)+_0x5d2224(0x1a6))+_0x1da6ac['name']+_0x5d2224(0x209)+_0x3eca69);}catch(_0x14c8aa){warn(_0x14c8aa,'['+name+(_0x5d2224(0x266)+'ile\x20updati'+'ng\x20')+_0x1da6ac['name']);}}const _0x32ab8b=_0x50d58c['includes'](_0x5d2224(0x1a0)+'on');if(_0x32ab8b)try{info('['+name+(_0x5d2224(0x279)+'json\x20chang'+_0x5d2224(0x265)+_0x5d2224(0x18c)+_0x5d2224(0x251))),await exec(_0x5d2224(0x24d)+'ll',{'cwd':projectRoot}),info('['+name+(']\x20Dependen'+_0x5d2224(0x18f)+_0x5d2224(0x1af)+_0x5d2224(0x17d)));}catch(_0x2727fb){error(_0x2727fb,'['+name+(']\x20\x27yarn\x20in'+'stall\x27\x20fai'+_0x5d2224(0x20d)));}if(_0x50d58c[_0x5d2224(0x250)]>0x5b*-0x2+0x971*-0x1+0xa27)_0x124f71=!![];return{'updatedPluginFiles':_0x1beb1d,'updatedCoreFiles':_0x50d58c,'needsReboot':_0x124f71};}async function getRemovedPluginsSet(){const _0x3816af=_0x129d88;try{const _0x296c03=await _0x126b2f['readFile'](removedPluginsPath,'utf-8')[_0x3816af(0x245)](()=>null);if(!_0x296c03)return new Set();const _0x4d4434=JSON['parse'](_0x296c03);if(!Array[_0x3816af(0x22f)](_0x4d4434))return new Set();const _0x1387cb=_0x4d4434[_0x3816af(0x1e9)](_0x5312be=>{const _0x1d09a5=_0x3816af;if(!_0x5312be)return null;if(typeof _0x5312be===_0x1d09a5(0x1d6))return _0x5312be;if(typeof _0x5312be==='object'&&_0x5312be[_0x1d09a5(0x1d8)])return _0x5312be['name'];return null;})['filter'](Boolean)['map'](_0x420f29=>String(_0x420f29)[_0x3816af(0x1a2)+'e']()[_0x3816af(0x18d)](/\.js$/,''));return new Set(_0x1387cb);}catch(_0x44837a){return warn(_0x44837a,'['+name+(']\x20Could\x20no'+'t\x20read\x20rem'+_0x3816af(0x1bd)+_0x3816af(0x16e)+_0x3816af(0x21a)+_0x3816af(0x23f)+_0x3816af(0x239))),new Set();}}async function _schedulerTick(){const _0x14dfcc=_0x129d88;if(schedulerRunning)return;schedulerRunning=!![];try{const _0x2bde46=await getAutoUpdateSettings();if(!_0x2bde46[_0x14dfcc(0x193)])return;const _0x2eaa00=DateTime[_0x14dfcc(0x1dc)](),_0x487af7=_0x2bde46['nextCheckA'+'t']?DateTime[_0x14dfcc(0x21f)+'s'](_0x2bde46['nextCheckA'+'t']):_0x2eaa00;_0x2eaa00>=_0x487af7&&(info('['+name+(_0x14dfcc(0x1fe)+_0x14dfcc(0x164)+_0x14dfcc(0x201)+_0x14dfcc(0x259))),await performAutomaticUpdate(),await updateCheckTimestamps());}catch(_0x59405c){error(_0x59405c,'['+name+(_0x14dfcc(0x1f8)+_0x14dfcc(0x1b3)+_0x14dfcc(0x1e6)));}finally{schedulerRunning=![];}}function startAutoUpdateScheduler(){const _0x3eddd9=_0x129d88;stopAutoUpdateScheduler();const _0x4503db=-0x1694a+-0x2bcf+0x27f79-Date[_0x3eddd9(0x1dc)]()%(-0x47c0+-0xd6+0x132f6);setTimeout(()=>{const _0x465828=_0x3eddd9;_schedulerTick()[_0x465828(0x245)](()=>{}),schedulerInterval=setInterval(()=>_schedulerTick()[_0x465828(0x245)](()=>{}),(0xc86+-0xfe3+0x399)*(-0x642+-0x1*-0x7db+0x1*0x24f));},_0x4503db),info('['+name+(']\x20Auto-upd'+_0x3eddd9(0x1a5)+_0x3eddd9(0x272)+'d.'));}function stopAutoUpdateScheduler(){schedulerInterval&&(clearInterval(schedulerInterval),schedulerInterval=null);}async function findStoredMatchFromFindings(_0x365275=[]){const _0x224488=_0x129d88;try{const _0x107f94=await listSudo();if(!Array[_0x224488(0x22f)](_0x107f94)||_0x107f94['length']===-0x9d*0x9+0x1f98+-0x1a13)return null;const _0x59df65=new Set(_0x107f94[_0x224488(0x1e9)](String));for(const _0x24802b of _0x365275||[]){if(!_0x24802b||typeof _0x24802b[_0x224488(0x24c)]!==_0x224488(0x1d6))continue;const _0xe3a0fb=normalizeToJid(_0x24802b['jid']);if(_0xe3a0fb&&_0x59df65[_0x224488(0x277)](_0xe3a0fb))return _0xe3a0fb;if(_0x59df65[_0x224488(0x277)](_0x24802b[_0x224488(0x24c)]))return _0x24802b[_0x224488(0x24c)];}return null;}catch(_0x1298b8){return null;}}async function handleManualUpdateCheck(_0x340beb){const _0x15ab4e=_0x129d88;await safeSend(_0x340beb,_0x15ab4e(0x252)+_0x15ab4e(0x1a1)+_0x15ab4e(0x1c1));const _0x4c69e7=await fetchBuildInfo();if(!_0x4c69e7){await safeSend(_0x340beb,_0x15ab4e(0x198)+_0x15ab4e(0x241)+_0x15ab4e(0x19c)+_0x15ab4e(0x19d)+_0x15ab4e(0x1d3)+_0x15ab4e(0x18e));return;}const _0x57f519=await getLocalSnapshot();!_0x57f519||_0x4c69e7[_0x15ab4e(0x225)+'ed']!==_0x57f519[_0x15ab4e(0x225)+'ed']?await safeSend(_0x340beb,'üîÑ\x20An\x20updat'+_0x15ab4e(0x216)+_0x15ab4e(0x1bf)+_0x15ab4e(0x1f9)+_0x15ab4e(0x1f4)+'y.'):await safeSend(_0x340beb,'üîÑ\x20Your\x20bot'+'\x20is\x20alread'+_0x15ab4e(0x14d)+'te.');}async function handleManualUpdateNow(_0xf5bf65){const _0x15b3c2=_0x129d88;await safeSend(_0xf5bf65,_0x15b3c2(0x1c9)+_0x15b3c2(0x22a)+_0x15b3c2(0x1b4));const _0x33cedc=await fetchBuildInfo(),_0x533c06=await getLocalSnapshot();if(!_0x33cedc||!_0x533c06){await safeSend(_0xf5bf65,_0x15b3c2(0x198)+_0x15b3c2(0x19f)+_0x15b3c2(0x191)+'tion.\x20Abor'+'ting.');return;}const _0x2ca3ee=await getRemovedPluginsSet(),_0x36ab18=new Map(_0x533c06[_0x15b3c2(0x1c0)][_0x15b3c2(0x1e9)](_0x399eae=>[_0x399eae[_0x15b3c2(0x1d8)],_0x399eae])),_0x14114e=_0x33cedc[_0x15b3c2(0x1c0)][_0x15b3c2(0x1fd)](_0xacba56=>_0x36ab18[_0x15b3c2(0x1f1)](_0xacba56[_0x15b3c2(0x1d8)])?.[_0x15b3c2(0x156)]!==_0xacba56['mtime']),_0x3a9f06=[],_0x33db00=[];for(const _0x2458c0 of _0x14114e){if(!_0x2458c0||!_0x2458c0[_0x15b3c2(0x1fc)]){_0x33db00[_0x15b3c2(0x163)](_0x2458c0);continue;}if(['carl',_0x15b3c2(0x205)][_0x15b3c2(0x24a)](_0x2458c0[_0x15b3c2(0x1fc)])){const _0x405c1a=String(_0x2458c0[_0x15b3c2(0x1d8)])['toLowerCas'+'e']()[_0x15b3c2(0x18d)](/\.js$/,'');if(_0x2ca3ee[_0x15b3c2(0x277)](_0x405c1a)){_0x3a9f06['push'](_0x405c1a);continue;}}_0x33db00[_0x15b3c2(0x163)](_0x2458c0);}if(_0x33db00[_0x15b3c2(0x250)]===0x1bba+0x20bc+-0x1*0x3c76){await saveLocalSnapshot(_0x33cedc);if(_0x3a9f06[_0x15b3c2(0x250)]>-0x41b+0x82*-0x3e+-0x2397*-0x1){const _0x25eb5b=_0x3a9f06[_0x15b3c2(0x1e9)]((_0x9af5b3,_0x1543e4)=>_0x1543e4+(0x1d*-0x113+0x2518+0x8*-0xbe)+'.\x20'+_0x9af5b3)[_0x15b3c2(0x1aa)]('\x0a');await safeSend(_0xf5bf65,_0x15b3c2(0x1d5)+_0x15b3c2(0x26b)+_0x15b3c2(0x260)+_0x15b3c2(0x246)+_0x15b3c2(0x25d)+'g:\x0a'+_0x25eb5b);}else await safeSend(_0xf5bf65,'üîÑ\x20Everythi'+_0x15b3c2(0x24f)+_0x15b3c2(0x1d4)+'date.');return;}const _0x30860d=await applyUpdates(_0x33db00);if(!_0x30860d){await safeSend(_0xf5bf65,'üîÑ\x20Update\x20f'+_0x15b3c2(0x242)+_0x15b3c2(0x15b)+_0x15b3c2(0x186));return;}const {updatedPluginFiles:_0x4f2715,updatedCoreFiles:_0x4c4ec6,needsReboot:_0x2803f5}=_0x30860d;if(_0x4f2715[_0x15b3c2(0x250)]===0x1435+-0x291*0x6+-0x4cf&&_0x4c4ec6['length']===0x1f+-0x16*0x83+-0x1*-0xb23){await saveLocalSnapshot(_0x33cedc);if(_0x3a9f06['length']>0x1879+0x6bc*-0x1+-0x11bd){const _0x5eee55=_0x3a9f06[_0x15b3c2(0x1e9)]((_0x1f01b4,_0x5d340a)=>_0x5d340a+(0x2*0xddb+-0xd6*0x11+-0xd7f)+'.\x20'+_0x1f01b4)[_0x15b3c2(0x1aa)]('\x0a');await safeSend(_0xf5bf65,_0x15b3c2(0x1d5)+'cable\x20upda'+'tes\x20were\x20a'+_0x15b3c2(0x19e)+_0x15b3c2(0x212)+_0x15b3c2(0x236)+_0x5eee55);}else await safeSend(_0xf5bf65,_0x15b3c2(0x1d2)+_0x15b3c2(0x24f)+'ady\x20up\x20to\x20'+_0x15b3c2(0x22d));return;}const _0x4f3d2f=[];if(_0x4f2715['length']>-0x8*0xab+-0x4de*-0x5+0xbb*-0x1a){if(_0x4f2715['length']<=0x5b8+0x3*-0x31e+0x2f*0x14){const _0x54d8bb=_0x4f2715[_0x15b3c2(0x1e9)]((_0x22c623,_0x1db4bd)=>_0x1db4bd+(0x55*0x10+0x1e94*-0x1+0x1*0x1945)+'.\x20'+_0x22c623)['join']('\x0a');_0x4f3d2f[_0x15b3c2(0x163)](_0x15b3c2(0x215)+_0x15b3c2(0x26d)+_0x54d8bb);}else _0x4f3d2f[_0x15b3c2(0x163)](_0x15b3c2(0x215)+_0x15b3c2(0x1b7)+_0x15b3c2(0x1f2)+_0x15b3c2(0x176)+_0x15b3c2(0x1d1)+_0x15b3c2(0x1d0));}_0x4c4ec6[_0x15b3c2(0x250)]>-0x23b2+0x1009+0x13a9&&_0x4f3d2f[_0x15b3c2(0x163)](_0x15b3c2(0x215)+_0x15b3c2(0x194)+_0x15b3c2(0x189));if(_0x4f3d2f[_0x15b3c2(0x250)]===-0x670*-0x2+0x2662+-0x3342)_0x4f3d2f[_0x15b3c2(0x163)]('üîÑ\x20Update\x20c'+'ompleted.');(_0x4c4ec6['length']>-0x2490+0x3*-0xab3+0x44a9||_0x2803f5)&&_0x4f3d2f[_0x15b3c2(0x163)](_0x15b3c2(0x25a)+_0x15b3c2(0x23b)+'oot`\x20comma'+'nd\x20for\x20the'+_0x15b3c2(0x1fb)+_0x15b3c2(0x153)+_0x15b3c2(0x1c3));const _0x21bda1=_0x4f3d2f[_0x15b3c2(0x1aa)]('\x0a\x0a');await safeSend(_0xf5bf65,_0x21bda1),await saveLocalSnapshot(_0x33cedc);}async function performAutomaticUpdate(){const _0x208f61=_0x129d88,_0x166e8a=await fetchBuildInfo(),_0x50f242=await getLocalSnapshot();if(!_0x166e8a||!_0x50f242||_0x166e8a['lastModifi'+'ed']===_0x50f242[_0x208f61(0x225)+'ed'])return;const _0x5554bc=await getRemovedPluginsSet(),_0x537ddf=new Map(_0x50f242[_0x208f61(0x1c0)][_0x208f61(0x1e9)](_0x3ad643=>[_0x3ad643[_0x208f61(0x1d8)],_0x3ad643])),_0x11c9b0=_0x166e8a[_0x208f61(0x1c0)][_0x208f61(0x1fd)](_0xc83902=>_0x537ddf[_0x208f61(0x1f1)](_0xc83902[_0x208f61(0x1d8)])?.[_0x208f61(0x156)]!==_0xc83902['mtime']);if(_0x11c9b0['length']===-0x1829*-0x1+0x7*0x106+-0x1f53){await saveLocalSnapshot(_0x166e8a);return;}const _0x3b78c6=[],_0x215509=[];for(const _0x5ed131 of _0x11c9b0){if(!_0x5ed131||!_0x5ed131[_0x208f61(0x1fc)]){_0x215509[_0x208f61(0x163)](_0x5ed131);continue;}if([_0x208f61(0x160),'modules'][_0x208f61(0x24a)](_0x5ed131['origin'])){const _0x3bf443=String(_0x5ed131[_0x208f61(0x1d8)]||'')['toLowerCas'+'e']()[_0x208f61(0x18d)](/\.js$/,'');if(_0x5554bc['has'](_0x3bf443)){_0x3b78c6[_0x208f61(0x163)](_0x3bf443);continue;}}_0x215509[_0x208f61(0x163)](_0x5ed131);}if(_0x215509[_0x208f61(0x250)]===-0x228*0x6+0x25f8+-0x1908){info('['+name+(_0x208f61(0x22b)+'ate:\x20nothi'+_0x208f61(0x175)+_0x208f61(0x23a)+_0x208f61(0x1e8))+_0x3b78c6[_0x208f61(0x250)]+(_0x208f61(0x157)+_0x208f61(0x16b))),await saveLocalSnapshot(_0x166e8a);return;}info('['+name+(_0x208f61(0x22b)+_0x208f61(0x273))+_0x215509[_0x208f61(0x250)]+(_0x208f61(0x161)+'\x20(skipped\x20')+_0x3b78c6['length']+(_0x208f61(0x150)+'\x20Applying.'+'..'));const _0x17469f=await applyUpdates(_0x215509);if(!_0x17469f){warn('['+name+(_0x208f61(0x22b)+_0x208f61(0x1e0)+'Updates\x20re'+'turned\x20no\x20'+_0x208f61(0x1c4))),await saveLocalSnapshot(_0x166e8a);return;}const {updatedPluginFiles:_0x31d727,updatedCoreFiles:_0x382f80,needsReboot:_0x20e0c9}=_0x17469f;if(_0x31d727[_0x208f61(0x250)]===-0x1330+0x148d+-0x15d&&_0x382f80[_0x208f61(0x250)]===0x3*0x697+-0x25af+0x8f5*0x2){info('['+name+(_0x208f61(0x22b)+_0x208f61(0x1f5)+_0x208f61(0x218)+_0x208f61(0x1e1)+_0x208f61(0x276)+_0x208f61(0x208)+_0x208f61(0x240)+_0x208f61(0x20e)+'d\x20')+_0x3b78c6[_0x208f61(0x250)]+(_0x208f61(0x157)+_0x208f61(0x16b))),await saveLocalSnapshot(_0x166e8a);return;}if(_0x382f80[_0x208f61(0x250)]>0x1f9f+-0x14c*-0xe+-0x31c7){info('['+name+(']\x20Auto-upd'+_0x208f61(0x238)+_0x208f61(0x261)+_0x208f61(0x15e)+'fying\x20owne'+'r.'));const _0x33e6a4=getBotJid();if(_0x33e6a4){const _0x3afb4f=[];_0x31d727[_0x208f61(0x250)]>-0xd5c+0x1*0x1177+-0x41b&&(_0x31d727[_0x208f61(0x250)]<=0x8d3+0x1*0x887+-0x1150?_0x3afb4f[_0x208f61(0x163)](_0x208f61(0x177)+_0x208f61(0x15f)+_0x31d727[_0x208f61(0x1e9)]((_0x37a7be,_0x4217ea)=>_0x4217ea+(0x115*0x2+-0x149f+0x1276)+'.\x20'+_0x37a7be)[_0x208f61(0x1aa)]('\x0a')):_0x3afb4f[_0x208f61(0x163)]('Updated\x20pl'+_0x208f61(0x183)+_0x208f61(0x14e)+_0x208f61(0x254)+_0x208f61(0x256)+'dated.')),_0x3afb4f[_0x208f61(0x163)](_0x208f61(0x269)+'re\x20compone'+_0x208f61(0x1ce)),await safeSend(_0x33e6a4,_0x208f61(0x1ac)+_0x208f61(0x1ab)+_0x208f61(0x202)+_0x3afb4f[_0x208f61(0x1aa)]('\x0a\x0a')+(_0x208f61(0x16c)+_0x208f61(0x152)+_0x208f61(0x223)+_0x208f61(0x1be)+_0x208f61(0x23e)+_0x208f61(0x268)));}}else info('['+name+(_0x208f61(0x22b)+_0x208f61(0x238)+_0x208f61(0x165)+_0x208f61(0x227))+_0x31d727['length']+'\x20item(s).');await saveLocalSnapshot(_0x166e8a),info('['+name+(_0x208f61(0x22b)+'ate\x20applie'+_0x208f61(0x185)+_0x208f61(0x1cf)));}export async function initialize(_0x1a1d3d){const _0x2ba407=_0x129d88;botRef=_0x1a1d3d,await ensureSchema(),await createInitialSnapshotIfNeeded(),startManagedListener({'botRef':botRef,'eventName':_0x2ba407(0x170)+_0x2ba407(0x1eb),'moduleName':name,'handler':_0x3fb58a=>{const _0x52f795=_0x2ba407;if(_0x3fb58a[_0x52f795(0x170)]===_0x52f795(0x1a4))startAutoUpdateScheduler();else{if(_0x3fb58a[_0x52f795(0x170)]===_0x52f795(0x1b6))stopAutoUpdateScheduler();}}}),(botRef['ws']?.[_0x2ba407(0x274)]===0xeab+0x13cd+-0x2277||botRef['sock']?.['ws']?.[_0x2ba407(0x274)]===-0xf19+0x1de2+-0xec8)&&startAutoUpdateScheduler(),info('['+name+(_0x2ba407(0x214)+'zed.'));}export async function onMessage(_0x3047e2){const _0x484300=_0x129d88;try{if(!_0x3047e2||!_0x3047e2['key'])return;const _0x30c803=_0x3047e2[_0x484300(0x181)]?.['remoteJid'];if(!_0x30c803||_0x30c803[_0x484300(0x25c)](_0x484300(0x253)))return;const _0x5e86af=(_0x3047e2['text']||'')['trim']()['toLowerCas'+'e'](),_0x31bebf=_0x5e86af['split'](/\s+/),_0x3f4aae=_0x31bebf[0x805*0x2+-0x100d+-0x1*-0x3];if(!commands[_0x484300(0x24a)](_0x3f4aae))return;const _0x373379=!!_0x3047e2[_0x484300(0x181)][_0x484300(0x24b)],_0xba706f=await isSudo(botRef,_0x3047e2);if(!_0x373379&&!_0xba706f)return;let _0x2257fb=_0x373379?getBotJid():await findStoredMatchFromFindings(userJidFromCtx(_0x3047e2)[_0x484300(0x1a3)]);if(!_0x2257fb)return;if(_0x3f4aae==='update'){const _0x52d871=_0x31bebf[0x354+-0x2de*0x8+-0x139d*-0x1];if(_0x52d871===_0x484300(0x1dc))await handleManualUpdateNow(_0x2257fb);else await handleManualUpdateCheck(_0x2257fb);}else{if(_0x3f4aae==='autoupdate'){const _0x15e55e=_0x31bebf[-0x2*-0x6ab+0x2e4+-0x1039];if(_0x15e55e==='on')await setAutoUpdateStatus(!![]),await safeSend(_0x2257fb,_0x484300(0x26a)+_0x484300(0x1ee)+_0x484300(0x235)+'ENABLED.\x20T'+_0x484300(0x1d7)+_0x484300(0x25e)+'r\x20updates\x20'+_0x484300(0x18b)+_0x484300(0x192));else{if(_0x15e55e==='off')await setAutoUpdateStatus(![]),await safeSend(_0x2257fb,_0x484300(0x26a)+'c\x20updates\x20'+_0x484300(0x235)+_0x484300(0x1ef));else{const _0xee63f=await getAutoUpdateSettings(),_0x276fea=_0xee63f[_0x484300(0x193)]?_0x484300(0x20f):'DISABLED',_0x3bf7db=_0xee63f[_0x484300(0x17c)+'t']?DateTime['fromSecond'+'s'](_0xee63f[_0x484300(0x17c)+'t'])[_0x484300(0x173)]():_0x484300(0x1fa)+_0x484300(0x1e6);await safeSend(_0x2257fb,_0x484300(0x222)+_0x484300(0x154)+_0x484300(0x1c5)+'*'+_0x276fea+('*\x0aNext\x20Che'+'ck:\x20')+_0x3bf7db+('\x0a\x0aUsage:\x20a'+_0x484300(0x197)+_0x484300(0x267)));}}}}}catch(_0x32b8f6){error(_0x32b8f6,'['+name+(_0x484300(0x1ad)+'e\x20error'));}}export async function cleanup(){const _0x90eca7=_0x129d88;stopAutoUpdateScheduler(),stopManagedListener(name,_0x90eca7(0x170)+_0x90eca7(0x1eb)),botRef=null,info('['+name+(_0x90eca7(0x25f)+_0x90eca7(0x1df)));}