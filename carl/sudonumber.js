const _0xcaae16=_0x3234;(function(_0x1bda00,_0x5ae790){const _0x4ac993=_0x3234,_0x16272b=_0x1bda00();while(!![]){try{const _0x2582e4=-parseInt(_0x4ac993(0x193))/(0x4fd+-0x111e+0xc22)+parseInt(_0x4ac993(0x186))/(-0x1ff*-0x5+0xf7a+-0x1973*0x1)*(-parseInt(_0x4ac993(0x178))/(-0x303*-0x4+-0x140c+0x803))+-parseInt(_0x4ac993(0x19d))/(0x18ad+-0x1040*0x2+-0x9*-0xdf)+parseInt(_0x4ac993(0x13d))/(0x10a3+0x1*0x2524+-0x35c2)*(-parseInt(_0x4ac993(0x173))/(0x94d+0x157*0xd+-0x33*0x86))+-parseInt(_0x4ac993(0x18c))/(0x25e2+0x114*-0x12+-0x1273)*(parseInt(_0x4ac993(0x155))/(0xc51+-0x15a3+0x31e*0x3))+-parseInt(_0x4ac993(0x135))/(0x1b23*0x1+-0x1eee+0x3d4)*(-parseInt(_0x4ac993(0x15f))/(-0x17b6+0x1*0x99a+-0xe26*-0x1))+parseInt(_0x4ac993(0x143))/(0x1e1+-0x1df7*-0x1+-0x1fcd);if(_0x2582e4===_0x5ae790)break;else _0x16272b['push'](_0x16272b['shift']());}catch(_0x283cee){_0x16272b['push'](_0x16272b['shift']());}}}(_0x26df,0xc7d82+-0x13045f+0x15b45f));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{userJidFromCtx as _0x54651b}from'../utils/sudo.js';export const name=_0xcaae16(0x158);export const version=_0xcaae16(0x13f);export const priority=0x25d4+-0x80f*-0x1+-0x2dde;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(-0x7*0x11f+0x68e+0x187)*(-0x1*0x313+0x154c+-0xe51)};let RETENTION_MINUTES=FALLBACKS[_0xcaae16(0x17d)+_0xcaae16(0x15b)],CLEANUP_INTERVAL_MS=FALLBACKS[_0xcaae16(0x139)+_0xcaae16(0x1a0)];function nowSeconds(){const _0x58540b=_0xcaae16;return Math[_0x58540b(0x149)](Date['now']()/(0x5f4*-0x6+-0x5*0x34e+-0x3826*-0x1));}async function ensureTable(){const _0x463c53=_0xcaae16;await db[_0x463c53(0x182)](_0x463c53(0x169)+_0x463c53(0x162)+_0x463c53(0x195)+'sage_sende'+'rs\x20(\x0a\x20\x20\x20\x20m'+_0x463c53(0x190)+_0x463c53(0x140)+_0x463c53(0x160)+_0x463c53(0x175)+_0x463c53(0x144)+'ender_numb'+_0x463c53(0x151)+_0x463c53(0x145)+'d\x20TEXT,\x0a\x20\x20'+_0x463c53(0x17c)+_0x463c53(0x19e)+_0x463c53(0x17a));}function normalizeNumberFromSudoJid(_0xe2392d){const _0x5d9111=_0xcaae16;if(!_0xe2392d)return'';try{const _0x1c7ba9=String(_0xe2392d),_0x375523=_0x1c7ba9[_0x5d9111(0x136)]('@'),_0x135ee8=_0x375523===-(-0x4*0x821+0x25*0x65+-0x11ec*-0x1)?_0x1c7ba9:_0x1c7ba9[_0x5d9111(0x147)](-0x1*0x71f+-0x1e5+0x4*0x241,_0x375523),_0x17fabe=_0x135ee8[_0x5d9111(0x136)](':'),_0x4709c0=_0x17fabe===-(-0x383+-0x1829+0x1bad)?_0x135ee8:_0x135ee8[_0x5d9111(0x147)](0xa25+-0x260e+-0x595*-0x5,_0x17fabe);return _0x4709c0[_0x5d9111(0x177)](/^\+/,'');}catch{return String(_0xe2392d||'');}}function _0x26df(){const _0x108932=['indexOf','r]\x20message','L\x20AND\x20save','CLEANUP_IN','participan','age_sender','run','10vxhaiR','\x20VALUES\x20(?','1.0.1','\x20PRIMARY\x20K','Old\x20error:','DELETE\x20FRO','58850066qDcKTJ','EXT,\x0a\x20\x20\x20\x20s','\x20\x20\x20chat_ji','O\x20message_','slice','\x20initializ','floor','get','message','toLowerCas','r]\x20getSend','key','r]\x20saveSen','r]\x20per-mes','er\x20TEXT,\x0a\x20','function','id,\x20saved_','jid','820872qzUwvi','ized','s\x20WHERE\x20ms','sudonumber','\x20error:\x20','sender_pn','MINUTES','senders\x20WH','\x20old\x20sende','findings','495820ZYwKQu','EY,\x0a\x20\x20\x20\x20se','r]\x20attache','LE\x20IF\x20NOT\x20','SELECT\x20msg','removeList','ERE\x20msg_id','ders\x20WHERE','M\x20message_','[sudonumbe','CREATE\x20TAB','\x20FROM\x20mess','\x20threw:\x20','r]\x20cleanup','psert:\x20','r]\x20initial','\x20saved_at\x20','ener','find','all','1946778qyizeX','d_at\x20<\x20?','nder_jid\x20T','remoteJid','replace','3EooNJj','psert','\x20);','\x20failed:\x20','\x20\x20saved_at','RETENTION_','r_jid,\x20sen','isArray','r]\x20userjid','fromMe','exec','\x20bot\x20arg','string','r]\x20cleaned','2643646kTEdDc','er,\x20chat_j','e\x20requires','d\x20to\x20messa','join','length','42mzOTIn','der_jid,\x20s','sg_id,\x20sen','msg_id','sg_id\x20TEXT','er\x20error:\x20','map','1278948NXgAOp','dler\x20error','EXISTS\x20mes','catch','ges.upsert','ender_numb','remoteJidA','der_number','r]\x20failed\x20','messages.u','6124748MedWfT','\x20INTEGER\x0a\x20','field','TERVAL_MS','\x20IN\x20(','senders\x20(m','189QTNqii'];_0x26df=function(){return _0x108932;};return _0x26df();}async function saveSenderIfMissing(_0x177a7c,_0x3f8253,_0x1c23c5){const _0x23f46b=_0xcaae16;if(!_0x177a7c||!_0x3f8253)return![];const _0x3de664=normalizeNumberFromSudoJid(_0x3f8253),_0x2f606c=nowSeconds();try{return await db[_0x23f46b(0x13c)]('INSERT\x20OR\x20'+'IGNORE\x20INT'+_0x23f46b(0x146)+_0x23f46b(0x134)+_0x23f46b(0x18e)+_0x23f46b(0x18d)+_0x23f46b(0x198)+_0x23f46b(0x187)+_0x23f46b(0x153)+'at)\x0a\x20\x20\x20\x20\x20\x20'+_0x23f46b(0x13e)+',\x20?,\x20?,\x20?,'+'\x20?)',[_0x177a7c,_0x3f8253,_0x3de664||null,_0x1c23c5||null,_0x2f606c]),!![];}catch(_0x4ab2ab){return warn(_0x23f46b(0x168)+_0x23f46b(0x14f)+'derIfMissi'+'ng\x20failed:'+'\x20'+(_0x4ab2ab?.[_0x23f46b(0x14b)]||_0x4ab2ab)),![];}}export async function getSenderForMsg(_0x9c3590){const _0x545767=_0xcaae16;if(!_0x9c3590)return null;try{const _0x101b20=await db[_0x545767(0x14a)](_0x545767(0x163)+'_id,\x20sende'+_0x545767(0x17e)+_0x545767(0x19a)+',\x20chat_jid'+',\x20saved_at'+_0x545767(0x16a)+_0x545767(0x13b)+_0x545767(0x157)+'g_id\x20=\x20?',[_0x9c3590]);return _0x101b20||null;}catch(_0x3c4924){return warn(_0x545767(0x168)+_0x545767(0x14d)+'erForMsg\x20e'+'rror:\x20'+(_0x3c4924?.[_0x545767(0x14b)]||_0x3c4924)),null;}}async function cleanupOld(){const _0x3d9c09=_0xcaae16;try{const _0x4727f2=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS['RETENTION_'+_0x3d9c09(0x15b)])*(-0x1*0x1405+-0x1989+0x2dca),_0xbe1c17=await db[_0x3d9c09(0x172)]('SELECT\x20msg'+'_id\x20FROM\x20m'+'essage_sen'+_0x3d9c09(0x166)+_0x3d9c09(0x16f)+'IS\x20NOT\x20NUL'+_0x3d9c09(0x138)+_0x3d9c09(0x174),[_0x4727f2]);if(!_0xbe1c17||_0xbe1c17[_0x3d9c09(0x18b)]===0x3*-0x123+0x10d2+0xd69*-0x1)return;const _0x37e13a=_0xbe1c17[_0x3d9c09(0x192)](_0x3adb85=>_0x3adb85[_0x3d9c09(0x18f)]),_0x37f1ec=0x338+0xca5+-0xf15;for(let _0x19c003=-0x14*-0xd5+0x830+0x1c6*-0xe;_0x19c003<_0x37e13a[_0x3d9c09(0x18b)];_0x19c003+=_0x37f1ec){const _0x18ac39=_0x37e13a[_0x3d9c09(0x147)](_0x19c003,_0x19c003+_0x37f1ec),_0x36b844=_0x18ac39[_0x3d9c09(0x192)](()=>'?')[_0x3d9c09(0x18a)](',');await db[_0x3d9c09(0x13c)](_0x3d9c09(0x142)+_0x3d9c09(0x167)+_0x3d9c09(0x15c)+_0x3d9c09(0x165)+_0x3d9c09(0x1a1)+_0x36b844+')',_0x18ac39);}info('[sudonumbe'+_0x3d9c09(0x185)+'\x20'+_0xbe1c17['length']+(_0x3d9c09(0x15d)+'r\x20rows'));}catch(_0x4e8367){warn(_0x3d9c09(0x168)+'r]\x20cleanup'+_0x3d9c09(0x141)+'\x20'+(_0x4e8367?.[_0x3d9c09(0x14b)]||_0x4e8367));}}function _0x3234(_0x20beff,_0x15b95f){const _0x32146d=_0x26df();return _0x3234=function(_0x33dba7,_0x5ddc01){_0x33dba7=_0x33dba7-(0x1552+-0x1*0x1561+0x143);let _0x398668=_0x32146d[_0x33dba7];return _0x398668;},_0x3234(_0x20beff,_0x15b95f);}async function messagesUpsertHandler({messages:_0x4a3b60}){const _0x321140=_0xcaae16;try{if(!_0x4a3b60||!Array[_0x321140(0x17f)](_0x4a3b60))return;for(const _0x3e1ba0 of _0x4a3b60){try{if(!_0x3e1ba0||!_0x3e1ba0['key'])continue;if(_0x3e1ba0[_0x321140(0x14e)][_0x321140(0x181)])continue;const _0x2e6eee=_0x3e1ba0[_0x321140(0x14e)]?.['id']||_0x3e1ba0['id']||_0x3e1ba0[_0x321140(0x14b)]&&_0x3e1ba0[_0x321140(0x14b)][_0x321140(0x14e)]&&_0x3e1ba0['message']['key']['id']||null;if(!_0x2e6eee)continue;const _0x4cd383=await getSenderForMsg(_0x2e6eee);if(_0x4cd383)continue;let _0x259ad9=[];try{const _0x5c75f7=_0x54651b(_0x3e1ba0);_0x259ad9=_0x5c75f7&&Array[_0x321140(0x17f)](_0x5c75f7[_0x321140(0x15e)])?_0x5c75f7[_0x321140(0x15e)]:[];}catch(_0x25e3f4){warn(_0x321140(0x168)+_0x321140(0x180)+_0x321140(0x16b)+(_0x25e3f4?.[_0x321140(0x14b)]||_0x25e3f4)),_0x259ad9=[];}if(!_0x259ad9[_0x321140(0x18b)])continue;const _0x3a5763=[_0x321140(0x199)+'lt',_0x321140(0x15a),_0x321140(0x13a)+'tAlt',_0x321140(0x13a)+'t_pn'];let _0x452b22=null;for(const _0x5d863e of _0x3a5763){_0x452b22=_0x259ad9[_0x321140(0x171)](_0x4636eb=>_0x4636eb[_0x321140(0x19f)]===_0x5d863e&&typeof _0x4636eb['jid']===_0x321140(0x184));if(_0x452b22)break;}if(!_0x452b22)_0x452b22=_0x259ad9[-0x227a*-0x1+-0x12af+-0xfcb*0x1];if(!_0x452b22||!_0x452b22[_0x321140(0x154)]||typeof _0x452b22['jid']!==_0x321140(0x184))continue;const _0x326d95=_0x452b22[_0x321140(0x154)][_0x321140(0x136)]('@'),_0x2d681d=_0x326d95===-(0x2233+-0xd*0x47+-0x1e97)?'':_0x452b22['jid'][_0x321140(0x147)](_0x326d95+(-0x745*-0x5+-0x26b+-0x21ed));if(!_0x2d681d||_0x2d681d[_0x321140(0x14c)+'e']()==='lid')continue;await saveSenderIfMissing(_0x2e6eee,_0x452b22['jid'],_0x3e1ba0[_0x321140(0x14e)]?.[_0x321140(0x176)]||null);}catch(_0x445a34){warn('[sudonumbe'+_0x321140(0x150)+'sage\x20handl'+_0x321140(0x191)+(_0x445a34?.['message']||_0x445a34));}}}catch(_0xd079bf){warn('[sudonumbe'+_0x321140(0x137)+'sUpsertHan'+_0x321140(0x194)+':\x20'+(_0xd079bf?.[_0x321140(0x14b)]||_0xd079bf));}}export async function initialize(_0x294468){const _0x43106f=_0xcaae16;if(!_0x294468)throw new Error('sudonumber'+_0x43106f(0x148)+_0x43106f(0x188)+_0x43106f(0x183));botInstance=_0x294468,await ensureTable()[_0x43106f(0x196)](_0x5e92d9=>{const _0x1a7937=_0x43106f;error(_0x5e92d9,_0x1a7937(0x168)+'r]\x20DB\x20init'+_0x1a7937(0x17b)+(_0x5e92d9?.['message']||_0x5e92d9));throw _0x5e92d9;});try{botInstance['on'](_0x43106f(0x19c)+_0x43106f(0x179),messagesUpsertHandler),info(_0x43106f(0x168)+_0x43106f(0x161)+_0x43106f(0x189)+_0x43106f(0x197));}catch(_0x14dade){warn(_0x43106f(0x168)+_0x43106f(0x19b)+'to\x20attach\x20'+_0x43106f(0x19c)+_0x43106f(0x16d)+(_0x14dade?.[_0x43106f(0x14b)]||_0x14dade));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS['CLEANUP_IN'+_0x43106f(0x1a0)])),info('[sudonumbe'+_0x43106f(0x16e)+_0x43106f(0x156));}export async function cleanup(){const _0x441ba1=_0xcaae16;try{if(botInstance&&typeof botInstance[_0x441ba1(0x164)+_0x441ba1(0x170)]===_0x441ba1(0x152))botInstance[_0x441ba1(0x164)+_0x441ba1(0x170)](_0x441ba1(0x19c)+_0x441ba1(0x179),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x10bf1f){warn(_0x441ba1(0x168)+_0x441ba1(0x16c)+_0x441ba1(0x159)+(_0x10bf1f?.[_0x441ba1(0x14b)]||_0x10bf1f));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};