const _0x30fe74=_0x1648;(function(_0x66ef48,_0x50d22){const _0xee9580=_0x1648,_0x441aa7=_0x66ef48();while(!![]){try{const _0x3bbc19=parseInt(_0xee9580(0x14e))/(0x1*-0xed5+0x123e+0x6d*-0x8)+-parseInt(_0xee9580(0x14d))/(0x1f*0x33+0x108a+-0x16b5)+-parseInt(_0xee9580(0x132))/(0x1*-0x20c6+0xc4b+0x147e)*(parseInt(_0xee9580(0x183))/(-0x23a2*-0x1+0x1e22+-0x41c0))+parseInt(_0xee9580(0x135))/(0x205*-0x7+0x1*-0x148b+0xb91*0x3)*(-parseInt(_0xee9580(0x155))/(-0x73e+0x84+0x6c0))+-parseInt(_0xee9580(0x142))/(0x18e6+-0xc47*0x3+-0x1*-0xbf6)*(parseInt(_0xee9580(0x120))/(-0x20bc+-0x994+-0x2*-0x152c))+parseInt(_0xee9580(0x154))/(-0x2014+-0x1917+-0x1*-0x3934)*(-parseInt(_0xee9580(0x14f))/(0x369+0x9b*-0x37+0x1dee))+parseInt(_0xee9580(0x141))/(0x18ad+0x1591*-0x1+-0x1*0x311);if(_0x3bbc19===_0x50d22)break;else _0x441aa7['push'](_0x441aa7['shift']());}catch(_0x5e92b6){_0x441aa7['push'](_0x441aa7['shift']());}}}(_0x5e48,0x1ec71+-0x1*-0x2764a+-0x27044*0x1));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{userJidFromCtx as _0xf34e21}from'../utils/sudo.js';export const name=_0x30fe74(0x16c);export const version=_0x30fe74(0x16d);export const priority=-0x1*-0x1cf1+-0x22f1+-0x43*-0x17;let botInstance=null,cleanupInterval=null;function _0x5e48(){const _0x40572e=['senders\x20WH','exec','7405618LKctmR','882NIlUrQ','g_id\x20=\x20?','slice','run','sg_id\x20TEXT','MINUTES','senders\x20(m','t_pn','remoteJidA','field','\x20);','15040XOhNfV','20674KwiUEP','2220VrHZrY','d\x20TEXT,\x0a\x20\x20','replace','psert','messages.u','198Mehmdi','1357992cqoMLI','indexOf','\x20IN\x20(','psert:\x20','\x20threw:\x20','d_at\x20<\x20?','r]\x20saveSen','\x20?)','\x20initializ',',\x20saved_at','\x20error:\x20','DELETE\x20FRO','\x20\x20saved_at','ener','IS\x20NOT\x20NUL','participan','message','[sudonumbe','nder_jid\x20T','der_jid,\x20s','r]\x20cleanup','find','erForMsg\x20e','sudonumber','1.0.1',',\x20?,\x20?,\x20?,','sender_pn','essage_sen','INSERT\x20OR\x20','findings','jid','lid','TERVAL_MS','r]\x20initial','r_jid,\x20sen','floor','dler\x20error','remoteJid','key','L\x20AND\x20save','\x20\x20\x20chat_ji','RETENTION_','er,\x20chat_j','O\x20message_','r]\x20message','msg_id','76tbfNBr','er\x20TEXT,\x0a\x20','rs\x20(\x0a\x20\x20\x20\x20m','\x20FROM\x20mess','length','15928LOClBD','r]\x20DB\x20init','isArray','rror:\x20','_id,\x20sende','r]\x20per-mes','id,\x20saved_','ERE\x20msg_id','map','d\x20to\x20messa','all','removeList','string','_id\x20FROM\x20m','catch','CLEANUP_IN','fromMe','ender_numb','12111NOqShU','IGNORE\x20INT','SELECT\x20msg','5fOidBh','sUpsertHan','ders\x20WHERE','\x20old\x20sende','EY,\x0a\x20\x20\x20\x20se','s\x20WHERE\x20ms','\x20PRIMARY\x20K','to\x20attach\x20','ges.upsert','function'];_0x5e48=function(){return _0x40572e;};return _0x5e48();}const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(0x15b2+0x179*-0x6+-0x4*0x328)*(0x66b+0x185+-0x204*0x2)};let RETENTION_MINUTES=FALLBACKS[_0x30fe74(0x17e)+_0x30fe74(0x147)],CLEANUP_INTERVAL_MS=FALLBACKS['CLEANUP_IN'+_0x30fe74(0x175)];function nowSeconds(){const _0x5e5fd4=_0x30fe74;return Math[_0x5e5fd4(0x178)](Date['now']()/(-0x2625+-0x2cc*0xc+0x5d1*0xd));}async function ensureTable(){const _0x448ef1=_0x30fe74;await db[_0x448ef1(0x140)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+'EXISTS\x20mes'+'sage_sende'+_0x448ef1(0x11d)+_0x448ef1(0x146)+_0x448ef1(0x13b)+_0x448ef1(0x139)+_0x448ef1(0x167)+'EXT,\x0a\x20\x20\x20\x20s'+'ender_numb'+_0x448ef1(0x184)+_0x448ef1(0x17d)+_0x448ef1(0x150)+_0x448ef1(0x161)+'\x20INTEGER\x0a\x20'+_0x448ef1(0x14c));}function normalizeNumberFromSudoJid(_0xfc684b){const _0x570cf3=_0x30fe74;if(!_0xfc684b)return'';try{const _0x3367dc=String(_0xfc684b),_0x4d031e=_0x3367dc[_0x570cf3(0x156)]('@'),_0x43adc8=_0x4d031e===-(0x2653*-0x1+-0x1631+0x3c85)?_0x3367dc:_0x3367dc[_0x570cf3(0x144)](-0x315*0xa+0x110a+0x1b9*0x8,_0x4d031e),_0x2a7c7d=_0x43adc8[_0x570cf3(0x156)](':'),_0x5e7b48=_0x2a7c7d===-(-0x31*0xbd+0x2644+-0x216)?_0x43adc8:_0x43adc8['slice'](-0x1*-0x20a4+-0x1e94*0x1+0x4*-0x84,_0x2a7c7d);return _0x5e7b48[_0x570cf3(0x151)](/^\+/,'');}catch{return String(_0xfc684b||'');}}async function saveSenderIfMissing(_0x397273,_0x5a73c5,_0x417974){const _0xc73912=_0x30fe74;if(!_0x397273||!_0x5a73c5)return![];const _0x303166=normalizeNumberFromSudoJid(_0x5a73c5),_0x37b5de=nowSeconds();try{return await db['run'](_0xc73912(0x171)+_0xc73912(0x133)+_0xc73912(0x180)+_0xc73912(0x148)+'sg_id,\x20sen'+_0xc73912(0x168)+_0xc73912(0x131)+_0xc73912(0x17f)+_0xc73912(0x126)+'at)\x0a\x20\x20\x20\x20\x20\x20'+'\x20VALUES\x20(?'+_0xc73912(0x16e)+_0xc73912(0x15c),[_0x397273,_0x5a73c5,_0x303166||null,_0x417974||null,_0x37b5de]),!![];}catch(_0x1adc00){return warn(_0xc73912(0x166)+_0xc73912(0x15b)+'derIfMissi'+'ng\x20failed:'+'\x20'+(_0x1adc00?.['message']||_0x1adc00)),![];}}function _0x1648(_0x4e356f,_0x150fa8){const _0x5302c2=_0x5e48();return _0x1648=function(_0x50a22e,_0x38e763){_0x50a22e=_0x50a22e-(-0xc73*0x3+-0x2a5*-0x2+-0x304*-0xb);let _0x25d55e=_0x5302c2[_0x50a22e];return _0x25d55e;},_0x1648(_0x4e356f,_0x150fa8);}export async function getSenderForMsg(_0x420c77){const _0x18b99d=_0x30fe74;if(!_0x420c77)return null;try{const _0x560800=await db['get'](_0x18b99d(0x134)+_0x18b99d(0x124)+_0x18b99d(0x177)+'der_number'+',\x20chat_jid'+_0x18b99d(0x15e)+_0x18b99d(0x11e)+'age_sender'+_0x18b99d(0x13a)+_0x18b99d(0x143),[_0x420c77]);return _0x560800||null;}catch(_0xd9517d){return warn(_0x18b99d(0x166)+'r]\x20getSend'+_0x18b99d(0x16b)+_0x18b99d(0x123)+(_0xd9517d?.[_0x18b99d(0x165)]||_0xd9517d)),null;}}async function cleanupOld(){const _0x31b593=_0x30fe74;try{const _0x2a407e=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS[_0x31b593(0x17e)+_0x31b593(0x147)])*(-0x23d4+-0x2200+0x4610),_0x555703=await db[_0x31b593(0x12a)](_0x31b593(0x134)+_0x31b593(0x12d)+_0x31b593(0x170)+_0x31b593(0x137)+'\x20saved_at\x20'+_0x31b593(0x163)+_0x31b593(0x17c)+_0x31b593(0x15a),[_0x2a407e]);if(!_0x555703||_0x555703['length']===0xe46+-0x1f4b+-0x1105*-0x1)return;const _0x245b6=_0x555703[_0x31b593(0x128)](_0x4c146f=>_0x4c146f[_0x31b593(0x182)]),_0x3548bd=-0x121b+-0x1f*-0x2f+0x6*0x233;for(let _0x51fa46=0x159f+0x2f3+-0x22*0xb9;_0x51fa46<_0x245b6['length'];_0x51fa46+=_0x3548bd){const _0x319e8e=_0x245b6[_0x31b593(0x144)](_0x51fa46,_0x51fa46+_0x3548bd),_0x26a172=_0x319e8e[_0x31b593(0x128)](()=>'?')['join'](',');await db[_0x31b593(0x145)](_0x31b593(0x160)+'M\x20message_'+_0x31b593(0x13f)+_0x31b593(0x127)+_0x31b593(0x157)+_0x26a172+')',_0x319e8e);}info(_0x31b593(0x166)+'r]\x20cleaned'+'\x20'+_0x555703[_0x31b593(0x11f)]+(_0x31b593(0x138)+'r\x20rows'));}catch(_0x18f542){warn(_0x31b593(0x166)+_0x31b593(0x169)+'Old\x20error:'+'\x20'+(_0x18f542?.['message']||_0x18f542));}}async function messagesUpsertHandler({messages:_0x456a00}){const _0x229d22=_0x30fe74;try{if(!_0x456a00||!Array[_0x229d22(0x122)](_0x456a00))return;for(const _0x17c1fa of _0x456a00){try{if(!_0x17c1fa||!_0x17c1fa[_0x229d22(0x17b)])continue;if(_0x17c1fa[_0x229d22(0x17b)][_0x229d22(0x130)])continue;const _0x253ad0=_0x17c1fa[_0x229d22(0x17b)]?.['id']||_0x17c1fa['id']||_0x17c1fa['message']&&_0x17c1fa[_0x229d22(0x165)][_0x229d22(0x17b)]&&_0x17c1fa['message'][_0x229d22(0x17b)]['id']||null;if(!_0x253ad0)continue;const _0x4c19cd=await getSenderForMsg(_0x253ad0);if(_0x4c19cd)continue;let _0x1c3491=[];try{const _0x67168f=_0xf34e21(_0x17c1fa);_0x1c3491=_0x67168f&&Array[_0x229d22(0x122)](_0x67168f[_0x229d22(0x172)])?_0x67168f['findings']:[];}catch(_0xc2c75d){warn('[sudonumbe'+'r]\x20userjid'+_0x229d22(0x159)+(_0xc2c75d?.[_0x229d22(0x165)]||_0xc2c75d)),_0x1c3491=[];}if(!_0x1c3491[_0x229d22(0x11f)])continue;const _0x758f20=[_0x229d22(0x14a)+'lt',_0x229d22(0x16f),_0x229d22(0x164)+'tAlt','participan'+_0x229d22(0x149)];let _0x52057f=null;for(const _0x315c4c of _0x758f20){_0x52057f=_0x1c3491[_0x229d22(0x16a)](_0x27e1fe=>_0x27e1fe[_0x229d22(0x14b)]===_0x315c4c&&typeof _0x27e1fe['jid']===_0x229d22(0x12c));if(_0x52057f)break;}if(!_0x52057f)_0x52057f=_0x1c3491[-0x1f3d+-0x21*0xdb+0x3b78];if(!_0x52057f||!_0x52057f['jid']||typeof _0x52057f[_0x229d22(0x173)]!==_0x229d22(0x12c))continue;const _0x54fcb6=_0x52057f['jid'][_0x229d22(0x156)]('@'),_0x1cd58=_0x54fcb6===-(-0x1*0x1703+0x14ac+0x258)?'':_0x52057f[_0x229d22(0x173)]['slice'](_0x54fcb6+(-0xcc0+-0x11b+0xddc));if(!_0x1cd58||_0x1cd58['toLowerCas'+'e']()===_0x229d22(0x174))continue;await saveSenderIfMissing(_0x253ad0,_0x52057f[_0x229d22(0x173)],_0x17c1fa[_0x229d22(0x17b)]?.[_0x229d22(0x17a)]||null);}catch(_0xdb3a4a){warn(_0x229d22(0x166)+_0x229d22(0x125)+'sage\x20handl'+'er\x20error:\x20'+(_0xdb3a4a?.['message']||_0xdb3a4a));}}}catch(_0x4d1c6b){warn('[sudonumbe'+_0x229d22(0x181)+_0x229d22(0x136)+_0x229d22(0x179)+':\x20'+(_0x4d1c6b?.[_0x229d22(0x165)]||_0x4d1c6b));}}export async function initialize(_0x341f3f){const _0x3baf08=_0x30fe74;if(!_0x341f3f)throw new Error('sudonumber'+_0x3baf08(0x15d)+'e\x20requires'+'\x20bot\x20arg');botInstance=_0x341f3f,await ensureTable()[_0x3baf08(0x12e)](_0x575124=>{const _0x3bc993=_0x3baf08;error(_0x575124,_0x3bc993(0x166)+_0x3bc993(0x121)+'\x20failed:\x20'+(_0x575124?.['message']||_0x575124));throw _0x575124;});try{botInstance['on'](_0x3baf08(0x153)+_0x3baf08(0x152),messagesUpsertHandler),info(_0x3baf08(0x166)+'r]\x20attache'+_0x3baf08(0x129)+_0x3baf08(0x13d));}catch(_0x1259a9){warn(_0x3baf08(0x166)+'r]\x20failed\x20'+_0x3baf08(0x13c)+_0x3baf08(0x153)+_0x3baf08(0x158)+(_0x1259a9?.[_0x3baf08(0x165)]||_0x1259a9));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS[_0x3baf08(0x12f)+_0x3baf08(0x175)])),info(_0x3baf08(0x166)+_0x3baf08(0x176)+'ized');}export async function cleanup(){const _0x1754e1=_0x30fe74;try{if(botInstance&&typeof botInstance['removeList'+_0x1754e1(0x162)]===_0x1754e1(0x13e))botInstance[_0x1754e1(0x12b)+_0x1754e1(0x162)]('messages.u'+_0x1754e1(0x152),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x1490e5){warn(_0x1754e1(0x166)+'r]\x20cleanup'+_0x1754e1(0x15f)+(_0x1490e5?.[_0x1754e1(0x165)]||_0x1490e5));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};