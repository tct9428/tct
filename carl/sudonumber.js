const _0x5a3330=_0x37b4;(function(_0x40b94c,_0x5aa4ec){const _0x3498fb=_0x37b4,_0x38a488=_0x40b94c();while(!![]){try{const _0x2a2427=parseInt(_0x3498fb(0x1f8))/(-0x1c*0x147+-0xf51*0x2+0x4267)+parseInt(_0x3498fb(0x1fb))/(-0xb*-0xcd+-0x2de+0x7*-0xd9)*(parseInt(_0x3498fb(0x1e9))/(-0x1003*0x1+0x17c5+0x3*-0x295))+parseInt(_0x3498fb(0x1b3))/(-0x3*-0x22d+0x2*-0xe80+0x167d)+parseInt(_0x3498fb(0x1b6))/(0x315+-0x1da9+0x1a99)*(-parseInt(_0x3498fb(0x1fc))/(0x2175+-0x43d*0x7+-0x3c4))+-parseInt(_0x3498fb(0x19c))/(-0x6b*0x1d+0x17*-0xed+0x2171*0x1)+-parseInt(_0x3498fb(0x195))/(-0x1f*0x3d+-0x53*0x1+0x7be)*(parseInt(_0x3498fb(0x1e5))/(0x2*0x9fa+0x3ea*0x8+-0x333b))+parseInt(_0x3498fb(0x1fd))/(0x1d8f*0x1+-0xc0*0x32+-0x7fb*-0x1);if(_0x2a2427===_0x5aa4ec)break;else _0x38a488['push'](_0x38a488['shift']());}catch(_0x3f1132){_0x38a488['push'](_0x38a488['shift']());}}}(_0x2bc4,0x3de8e+-0x4005b+0x35b*0x162));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{userJidFromCtx as _0x122a21}from'../utils/sudo.js';function _0x37b4(_0x225325,_0x2fc967){const _0x206149=_0x2bc4();return _0x37b4=function(_0x50b3bc,_0x31c2cd){_0x50b3bc=_0x50b3bc-(0xebc+0x2db*-0x1+0x527*-0x2);let _0x8188d8=_0x206149[_0x50b3bc];return _0x8188d8;},_0x37b4(_0x225325,_0x2fc967);}export const name=_0x5a3330(0x1d4);export const version=_0x5a3330(0x1e3);export const priority=0x1b0c+0x1*0x1b3+0x2*-0xe5d;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(-0x2455+0x1*-0xaa9+0x2f3a)*(0xe*-0x12d+0x2*0xb9+-0x4bb*-0x4)};let RETENTION_MINUTES=FALLBACKS[_0x5a3330(0x1e7)+_0x5a3330(0x1bf)],CLEANUP_INTERVAL_MS=FALLBACKS['CLEANUP_IN'+_0x5a3330(0x1ac)];function nowSeconds(){const _0x50268e=_0x5a3330;return Math['floor'](Date[_0x50268e(0x1f3)]()/(0x1*-0x168+0x1918+-0x13c8));}async function ensureTable(){const _0x363851=_0x5a3330;await db['exec']('CREATE\x20TAB'+_0x363851(0x1a3)+_0x363851(0x203)+_0x363851(0x1d9)+_0x363851(0x19e)+_0x363851(0x1d6)+'\x20PRIMARY\x20K'+'EY,\x0a\x20\x20\x20\x20se'+_0x363851(0x1e8)+_0x363851(0x1a0)+_0x363851(0x1ff)+_0x363851(0x1d8)+_0x363851(0x1ee)+_0x363851(0x1ef)+_0x363851(0x1e0)+'\x20INTEGER\x0a\x20'+_0x363851(0x1be));}function normalizeNumberFromSudoJid(_0x336f19){const _0x4d7a10=_0x5a3330;if(!_0x336f19)return'';try{const _0x522b95=String(_0x336f19),_0x1e80b1=_0x522b95[_0x4d7a10(0x1d5)]('@'),_0x556e7c=_0x1e80b1===-(-0x8*0x1f9+-0x5d*0x6b+0x4*0xdaa)?_0x522b95:_0x522b95[_0x4d7a10(0x1b5)](0x108b+0x26e6+-0x3771,_0x1e80b1),_0x489ca4=_0x556e7c[_0x4d7a10(0x1d5)](':'),_0x3e14e2=_0x489ca4===-(-0x786+-0x85b+-0x6b*-0x26)?_0x556e7c:_0x556e7c[_0x4d7a10(0x1b5)](-0x2184+-0x1*-0x1614+0xb70,_0x489ca4);return _0x3e14e2[_0x4d7a10(0x1bd)](/^\+/,'');}catch{return String(_0x336f19||'');}}async function saveSenderIfMissing(_0x16f269,_0x5f03cc,_0x2750a5){const _0x4f2e4c=_0x5a3330;if(!_0x16f269||!_0x5f03cc)return![];const _0x57efc1=normalizeNumberFromSudoJid(_0x5f03cc),_0x4c7e25=nowSeconds();try{return await db[_0x4f2e4c(0x1bc)](_0x4f2e4c(0x1df)+_0x4f2e4c(0x19d)+_0x4f2e4c(0x194)+_0x4f2e4c(0x1d1)+_0x4f2e4c(0x1c8)+_0x4f2e4c(0x1e6)+_0x4f2e4c(0x1ff)+'er,\x20chat_j'+'id,\x20saved_'+_0x4f2e4c(0x1fa)+_0x4f2e4c(0x1c6)+_0x4f2e4c(0x19b)+_0x4f2e4c(0x19f),[_0x16f269,_0x5f03cc,_0x57efc1||null,_0x2750a5||null,_0x4c7e25]),!![];}catch(_0x550703){return warn(_0x4f2e4c(0x1ba)+_0x4f2e4c(0x1f2)+'derIfMissi'+_0x4f2e4c(0x198)+'\x20'+(_0x550703?.['message']||_0x550703)),![];}}function _0x2bc4(){const _0x46dd7f=['lid','field','Old\x20error:','r]\x20DB\x20init','g_id\x20=\x20?','r]\x20failed\x20','senders\x20WH','sender_pn','senders\x20(m','t_pn','\x20error:\x20','sudonumber','indexOf','sg_id\x20TEXT','IS\x20NOT\x20NUL','er\x20TEXT,\x0a\x20','sage_sende','jid','to\x20attach\x20','r]\x20initial','\x20old\x20sende','d\x20to\x20messa','INSERT\x20OR\x20','\x20\x20saved_at','toLowerCas','erForMsg\x20e','1.0.1','s\x20WHERE\x20ms','1772982XUekPM','der_jid,\x20s','RETENTION_','nder_jid\x20T','21888vQTVBm','findings','sUpsertHan','remoteJid',',\x20saved_at','\x20\x20\x20chat_ji','d\x20TEXT,\x0a\x20\x20','participan','r]\x20message','r]\x20saveSen','now','r]\x20userjid','\x20threw:\x20','\x20initializ','CLEANUP_IN','336861HoTPXX','\x20saved_at\x20','at)\x0a\x20\x20\x20\x20\x20\x20','160TYHCiN','272178kmbPid','2114990vAnUFy','psert:\x20','ender_numb','dler\x20error','ders\x20WHERE','string','EXISTS\x20mes','fromMe','isArray','r]\x20cleanup','O\x20message_','16bjSctk','all','psert','ng\x20failed:','\x20FROM\x20mess','SELECT\x20msg',',\x20?,\x20?,\x20?,','3299233ukwmgG','IGNORE\x20INT','rs\x20(\x0a\x20\x20\x20\x20m','\x20?)','EXT,\x0a\x20\x20\x20\x20s',',\x20chat_jid','\x20IN\x20(','LE\x20IF\x20NOT\x20','r\x20rows','L\x20AND\x20save','r]\x20per-mes','removeList','ERE\x20msg_id','r_jid,\x20sen','ges.upsert','r]\x20cleaned','TERVAL_MS','DELETE\x20FRO','catch','M\x20message_','ener','der_number','remoteJidA','840640iyCGiA','key','slice','20EFilsJ','sage\x20handl','length','age_sender','[sudonumbe','map','run','replace','\x20);','MINUTES','msg_id','essage_sen','message','r]\x20attache','d_at\x20<\x20?','messages.u','\x20VALUES\x20(?','r]\x20getSend','sg_id,\x20sen'];_0x2bc4=function(){return _0x46dd7f;};return _0x2bc4();}export async function getSenderForMsg(_0x4912a9){const _0xbd79e6=_0x5a3330;if(!_0x4912a9)return null;try{const _0x2d690d=await db['get'](_0xbd79e6(0x19a)+'_id,\x20sende'+_0xbd79e6(0x1a9)+_0xbd79e6(0x1b1)+_0xbd79e6(0x1a1)+_0xbd79e6(0x1ed)+_0xbd79e6(0x199)+_0xbd79e6(0x1b9)+_0xbd79e6(0x1e4)+_0xbd79e6(0x1cd),[_0x4912a9]);return _0x2d690d||null;}catch(_0x1e0ea7){return warn(_0xbd79e6(0x1ba)+_0xbd79e6(0x1c7)+_0xbd79e6(0x1e2)+'rror:\x20'+(_0x1e0ea7?.[_0xbd79e6(0x1c2)]||_0x1e0ea7)),null;}}async function cleanupOld(){const _0x531a86=_0x5a3330;try{const _0x404f70=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS[_0x531a86(0x1e7)+'MINUTES'])*(0x2670+0x25*-0xc6+-0x996),_0x3520a8=await db[_0x531a86(0x196)](_0x531a86(0x19a)+'_id\x20FROM\x20m'+_0x531a86(0x1c1)+_0x531a86(0x201)+_0x531a86(0x1f9)+_0x531a86(0x1d7)+_0x531a86(0x1a5)+_0x531a86(0x1c4),[_0x404f70]);if(!_0x3520a8||_0x3520a8['length']===0x218a+0x476*0x7+-0x40c4)return;const _0x259094=_0x3520a8[_0x531a86(0x1bb)](_0x2a0ecc=>_0x2a0ecc[_0x531a86(0x1c0)]),_0x1d63cf=-0xfbd+-0x1*0xde7+0x1e6c;for(let _0x1ae670=0xc14*0x1+0x2133+-0x1*0x2d47;_0x1ae670<_0x259094[_0x531a86(0x1b8)];_0x1ae670+=_0x1d63cf){const _0x44ccff=_0x259094[_0x531a86(0x1b5)](_0x1ae670,_0x1ae670+_0x1d63cf),_0x183737=_0x44ccff['map'](()=>'?')['join'](',');await db[_0x531a86(0x1bc)](_0x531a86(0x1ad)+_0x531a86(0x1af)+_0x531a86(0x1cf)+_0x531a86(0x1a8)+_0x531a86(0x1a2)+_0x183737+')',_0x44ccff);}info(_0x531a86(0x1ba)+_0x531a86(0x1ab)+'\x20'+_0x3520a8[_0x531a86(0x1b8)]+(_0x531a86(0x1dd)+_0x531a86(0x1a4)));}catch(_0x101cae){warn(_0x531a86(0x1ba)+_0x531a86(0x193)+_0x531a86(0x1cb)+'\x20'+(_0x101cae?.['message']||_0x101cae));}}async function messagesUpsertHandler({messages:_0x5efc69}){const _0x2c3e76=_0x5a3330;try{if(!_0x5efc69||!Array[_0x2c3e76(0x205)](_0x5efc69))return;for(const _0x39ea33 of _0x5efc69){try{if(!_0x39ea33||!_0x39ea33[_0x2c3e76(0x1b4)])continue;if(_0x39ea33[_0x2c3e76(0x1b4)][_0x2c3e76(0x204)])continue;const _0x1ebcef=_0x39ea33[_0x2c3e76(0x1b4)]?.['id']||_0x39ea33['id']||_0x39ea33['message']&&_0x39ea33[_0x2c3e76(0x1c2)][_0x2c3e76(0x1b4)]&&_0x39ea33[_0x2c3e76(0x1c2)]['key']['id']||null;if(!_0x1ebcef)continue;const _0x25e3aa=await getSenderForMsg(_0x1ebcef);if(_0x25e3aa)continue;let _0x3dc160=[];try{const _0x56843e=_0x122a21(_0x39ea33);_0x3dc160=_0x56843e&&Array[_0x2c3e76(0x205)](_0x56843e[_0x2c3e76(0x1ea)])?_0x56843e[_0x2c3e76(0x1ea)]:[];}catch(_0x45991b){warn(_0x2c3e76(0x1ba)+_0x2c3e76(0x1f4)+_0x2c3e76(0x1f5)+(_0x45991b?.[_0x2c3e76(0x1c2)]||_0x45991b)),_0x3dc160=[];}if(!_0x3dc160[_0x2c3e76(0x1b8)])continue;const _0x1feb3b=[_0x2c3e76(0x1b2)+'lt',_0x2c3e76(0x1d0),_0x2c3e76(0x1f0)+'tAlt','participan'+_0x2c3e76(0x1d2)];let _0x5102c3=null;for(const _0x1358d3 of _0x1feb3b){_0x5102c3=_0x3dc160['find'](_0x568980=>_0x568980[_0x2c3e76(0x1ca)]===_0x1358d3&&typeof _0x568980['jid']===_0x2c3e76(0x202));if(_0x5102c3)break;}if(!_0x5102c3)_0x5102c3=_0x3dc160[-0x1*-0x1c73+0x3a9*0x3+-0x67*0x62];if(!_0x5102c3||!_0x5102c3['jid']||typeof _0x5102c3[_0x2c3e76(0x1da)]!==_0x2c3e76(0x202))continue;const _0x2a3412=_0x5102c3[_0x2c3e76(0x1da)]['indexOf']('@'),_0x43b7bb=_0x2a3412===-(0x7d7+-0x12db+0xd*0xd9)?'':_0x5102c3[_0x2c3e76(0x1da)]['slice'](_0x2a3412+(-0x25db+0xee+0x1277*0x2));if(!_0x43b7bb||_0x43b7bb[_0x2c3e76(0x1e1)+'e']()===_0x2c3e76(0x1c9))continue;await saveSenderIfMissing(_0x1ebcef,_0x5102c3[_0x2c3e76(0x1da)],_0x39ea33[_0x2c3e76(0x1b4)]?.[_0x2c3e76(0x1ec)]||null);}catch(_0x10b808){warn('[sudonumbe'+_0x2c3e76(0x1a6)+_0x2c3e76(0x1b7)+'er\x20error:\x20'+(_0x10b808?.[_0x2c3e76(0x1c2)]||_0x10b808));}}}catch(_0x27dfe4){warn(_0x2c3e76(0x1ba)+_0x2c3e76(0x1f1)+_0x2c3e76(0x1eb)+_0x2c3e76(0x200)+':\x20'+(_0x27dfe4?.[_0x2c3e76(0x1c2)]||_0x27dfe4));}}export async function initialize(_0x22698d){const _0x4d0c5a=_0x5a3330;if(!_0x22698d)throw new Error('sudonumber'+_0x4d0c5a(0x1f6)+'e\x20requires'+'\x20bot\x20arg');botInstance=_0x22698d,await ensureTable()[_0x4d0c5a(0x1ae)](_0x1ba052=>{const _0x7006b4=_0x4d0c5a;error(_0x1ba052,_0x7006b4(0x1ba)+_0x7006b4(0x1cc)+'\x20failed:\x20'+(_0x1ba052?.[_0x7006b4(0x1c2)]||_0x1ba052));throw _0x1ba052;});try{botInstance['on'](_0x4d0c5a(0x1c5)+_0x4d0c5a(0x197),messagesUpsertHandler),info(_0x4d0c5a(0x1ba)+_0x4d0c5a(0x1c3)+_0x4d0c5a(0x1de)+_0x4d0c5a(0x1aa));}catch(_0x43cfa4){warn(_0x4d0c5a(0x1ba)+_0x4d0c5a(0x1ce)+_0x4d0c5a(0x1db)+_0x4d0c5a(0x1c5)+_0x4d0c5a(0x1fe)+(_0x43cfa4?.[_0x4d0c5a(0x1c2)]||_0x43cfa4));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS[_0x4d0c5a(0x1f7)+'TERVAL_MS'])),info(_0x4d0c5a(0x1ba)+_0x4d0c5a(0x1dc)+'ized');}export async function cleanup(){const _0x1dc599=_0x5a3330;try{if(botInstance&&typeof botInstance[_0x1dc599(0x1a7)+_0x1dc599(0x1b0)]==='function')botInstance[_0x1dc599(0x1a7)+'ener']('messages.u'+_0x1dc599(0x197),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x38766d){warn(_0x1dc599(0x1ba)+'r]\x20cleanup'+_0x1dc599(0x1d3)+(_0x38766d?.[_0x1dc599(0x1c2)]||_0x38766d));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};