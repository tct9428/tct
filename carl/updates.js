const _0xe64cc=_0x54f2;(function(_0x496153,_0x43acfd){const _0x48b707=_0x54f2,_0x374868=_0x496153();while(!![]){try{const _0x5db23a=parseInt(_0x48b707(0x1a0))/(0x578+-0x524*-0x2+-0x1d*0x8b)+parseInt(_0x48b707(0x1ca))/(-0x172c+-0x120a+0x2938)*(-parseInt(_0x48b707(0x179))/(0x25*0x1+0x343*-0x5+0x102d*0x1))+-parseInt(_0x48b707(0x1d5))/(-0x179d+-0x1232+0x29d3*0x1)+-parseInt(_0x48b707(0x168))/(-0x8f9*-0x1+-0x1*0x479+-0x47b)*(parseInt(_0x48b707(0x1ba))/(0xa*-0x34a+0x1cd6+0x414))+-parseInt(_0x48b707(0x1c1))/(0xa13+-0x2251+0x1845)+parseInt(_0x48b707(0x133))/(0x8c6+-0x10e2+0x824)*(parseInt(_0x48b707(0x140))/(-0x1*0x47+-0x12ea+-0x17*-0xd6))+parseInt(_0x48b707(0x1c0))/(-0xd9a*0x2+0xce1+0xe5d);if(_0x5db23a===_0x43acfd)break;else _0x374868['push'](_0x374868['shift']());}catch(_0x4e9742){_0x374868['push'](_0x374868['shift']());}}}(_0x36f6,-0x2*0xe20b+0x1d333+0x31b9*0x4e));function _0x36f6(){const _0x1de286=[']\x20No\x20send\x20','\x20prefs\x20for','\x20WHERE\x20use','ll\x20retries','ates`\x20to\x20o','key','\x20\x20\x20\x20\x20\x20\x20ena','ER\x20DEFAULT','\x20last_upda','trim','T\x20last_upd','e\x20error','o\x20read\x20con','of\x20automat','708mXDYRO','\x20\x20user_jid','tct.com/up','a\x20initiali','rs\x20from\x20DB','\x20time\x20to\x20r','37580750LkpeeH','6676733YszDEU','enabled','no-cache','\x201,\x20?)','ge\x20after\x20a','o\x20get\x20user','updates\x20en','time\x20for\x20','ain\x20later.','34KqnitB','s\x20update,\x20','r_jid,\x20las','updates','time\x20FROM\x20','FROM\x20user_','ouldn\x27t\x20ch','bled,\x20last','Run\x20`start','hour','r_update_p','804540YKHIXa',']\x20Failed\x20t','setZone','mtime\x20form','object','s.\x0a\x0aRun\x20`s','cribed\x20use','tomatic\x20up','\x20`stop\x20upd','string','function','ND_DELAY_M','dates`\x20at\x20','@g.us','w\x20update!\x0a','OUT_MS','IF\x20NOT\x20EXI','UPDATES','sendMessag','\x20\x20\x20\x20\x20\x20last','\x0a\x0a---\x0a\x0a','abort','s\x20(\x0a\x20\x20\x20\x20\x20\x20','\x20response','start','ry\x20again\x20l','ime\x20FROM\x20u','connection','FETCH_TIME','API\x20availa','mtime','438392fTxues','?))','e_mtime','status','start\x20upda','user_jid','e_prefs\x20WH','refs\x20SET\x20l','\x20after\x20man','REPLACE\x20IN','RE\x20user_ji','\x20ON\x20(1)\x0a\x20\x20','t\x20send\x20to\x20','9rLGBBT','signal','pdate_pref','\x201,\x20--\x20Req','.\x20Please\x20t','content','update_pre','te_mtime)\x20','o\x20opt-out.','o\x20fetch\x20up','ARY\x20KEY,\x0a\x20','message','RETRY_DELA','\x20user\x20','zation\x20fai','\x20updates.','\x0a\x20\x20\x20\x20\x20\x20CRE','o\x20update\x20m','dpoint','get','_update_mt','new?','_prefs\x20WHE','pt-out.','o\x20process\x20','\x0a\x0a(Note:\x20I','ser_jid\x20=\x20','references','ual\x20check','❌\x20You\x20have','\x200,\x20(SELEC','now','remoteJid','\x20(user_jid','at\x20in\x20JSON','ates.','1.2.0','stop\x20updat','sock','json','77305fUiZdZ','led','length','UTC','es`\x20at\x20any','INSERT\x20OR\x20','\x20found\x20thi','text','UPDATES_UR','o\x20opt-out\x20','or!\x20status','\x20new\x20updat','Found\x20a\x20ne','ilable\x20on\x20','last_updat','JSON\x20struc','VALUES\x20(?,','39699VIWOlA','run','eck\x20your\x20p','sage\x20to\x20','minute','uirement:\x20','ime\x20TEXT\x0a\x20','ase\x20try\x20ag','tart\x20updat','endsWith','atus.\x20You\x20','TO\x20user_up','toLowerCas','date_prefs','readyState','stop','ast_update','tic\x20update',']\x20onMessag','\x20\x20\x20\x20\x20);\x0a\x20\x20','fs\x20WHERE\x20u',',\x20enabled,','tes','date\x20messa','exec','dates\x20righ',']\x20Invalid\x20','undefined','MESSAGE_SE','d\x20=\x201','rom\x20automa','toISODate','t\x20now.\x20Ple','Sorry,\x20I\x20c','UPDATE\x20use','r_jid\x20=\x20?','all','ERE\x20enable','ouble\x20savi','388170FamCMH','.update',']\x20Schedule','o\x20send\x20mes','r\x20tick\x20fai','ates\x20found','e-subscrib','ATE\x20TABLE\x20','\x20TEXT\x20PRIM','ibed\x20to\x20au','ater.','bot\x20instan'];_0x36f6=function(){return _0x1de286;};return _0x36f6();}import{DateTime}from'luxon';import{db}from'../utils/database.js';import{warn,error}from'../utils/logger.js';import{getConfig}from'../utils/config.js';export const name=_0xe64cc(0x1cd);export const version=_0xe64cc(0x164);export const priority=0x5*0x1a6+-0x14da*-0x1+-0x1cb4;export const commands=[_0xe64cc(0x12c),_0xe64cc(0x188),_0xe64cc(0x155)];let botRef=null,sendApi=null,schedulerInterval=null,schedulerRunning=![],lastCheckRunDate=null;const DEFAULTS={'TIME_ZONE':_0xe64cc(0x16b),'UPDATES_URL':'https://i-'+_0xe64cc(0x1bc)+'dates','RETRY_DELAY_MS':(0x2393+-0x3*0x4fd+-0x149a)*(-0xb75+0x1d44+-0x1193)*(-0x8e*0x35+0x1823+0x92b),'FETCH_TIMEOUT_MS':(0x4*0x313+0xa03+-0x1*0x1631)*(-0x111e+-0xdf2+0x22f8),'MESSAGE_SEND_DELAY_MS':0x1f4};let CONFIG={...DEFAULTS};async function ensureSchema(){const _0x53f86e=_0xe64cc;try{await db[_0x53f86e(0x191)](_0x53f86e(0x150)+_0x53f86e(0x1a7)+_0x53f86e(0x124)+'STS\x20user_u'+_0x53f86e(0x142)+_0x53f86e(0x12a)+_0x53f86e(0x1bb)+_0x53f86e(0x1a8)+_0x53f86e(0x14a)+_0x53f86e(0x1b2)+'bled\x20INTEG'+_0x53f86e(0x1b3)+_0x53f86e(0x143)+_0x53f86e(0x17e)+'Default\x20to'+_0x53f86e(0x13e)+_0x53f86e(0x127)+_0x53f86e(0x154)+_0x53f86e(0x17f)+_0x53f86e(0x18c)+'\x20\x20');}catch(_0x3e43aa){error(_0x3e43aa,'['+name+(']\x20DB\x20schem'+_0x53f86e(0x1bd)+_0x53f86e(0x14e)+'led'));throw _0x3e43aa;}}function _0x54f2(_0x4d35b0,_0x46eaa9){const _0x5a4d48=_0x36f6();return _0x54f2=function(_0x51d1f2,_0x39bfa6){_0x51d1f2=_0x51d1f2-(0x1f5*-0x2+-0x24f3+0x29fa);let _0x4923be=_0x5a4d48[_0x51d1f2];return _0x4923be;},_0x54f2(_0x4d35b0,_0x46eaa9);}function setupApi(_0x1a77ff){const _0x1db831=_0xe64cc;botRef=_0x1a77ff;if(botRef){if(typeof botRef['sendMessag'+'e']===_0x1db831(0x11e))sendApi=(_0x42ade1,_0x49fb3f)=>botRef['sendMessag'+'e'](_0x42ade1,_0x49fb3f);else botRef[_0x1db831(0x166)]&&typeof botRef[_0x1db831(0x166)][_0x1db831(0x126)+'e']===_0x1db831(0x11e)?sendApi=(_0x441769,_0x1e0d18)=>botRef['sock'][_0x1db831(0x126)+'e'](_0x441769,_0x1e0d18):(sendApi=null,warn('['+name+(']\x20No\x20send\x20'+'method\x20ava'+_0x1db831(0x175)+_0x1db831(0x1ab)+'ce')));}}async function safeSend(_0x137161,_0x271b6a){const _0xf3abf0=_0xe64cc;if(!sendApi){error('['+name+(_0xf3abf0(0x1ac)+_0xf3abf0(0x131)+'ble.\x20Canno'+_0xf3abf0(0x13f))+_0x137161);return;}if(!_0x137161||!_0x271b6a)return;try{await sendApi(_0x137161,{'text':_0x271b6a});}catch(_0x4c5300){error(_0x4c5300,'['+name+(_0xf3abf0(0x1d6)+_0xf3abf0(0x1a3)+_0xf3abf0(0x17c))+_0x137161);}}async function fetchUpdatesWithRetry(_0x5dacf6=0xd86+0xfe5+-0x1d69){const _0x245802=_0xe64cc;try{const _0x495c9c=new AbortController(),_0x15db98=setTimeout(()=>_0x495c9c[_0x245802(0x129)](),CONFIG[_0x245802(0x130)+_0x245802(0x123)]),_0x399a00=await fetch(CONFIG[_0x245802(0x170)+'L'],{'signal':_0x495c9c[_0x245802(0x141)],'headers':{'Cache-Control':_0x245802(0x1c3),'Pragma':_0x245802(0x1c3)}});clearTimeout(_0x15db98);if(!_0x399a00['ok'])throw new Error('['+name+(']\x20HTTP\x20err'+_0x245802(0x172)+':\x20')+_0x399a00[_0x245802(0x136)]);const _0x2cb986=await _0x399a00[_0x245802(0x167)]();if(typeof _0x2cb986?.[_0x245802(0x145)]===_0x245802(0x194)||typeof _0x2cb986?.['mtime']==='undefined')throw new Error('['+name+(_0x245802(0x193)+_0x245802(0x177)+'ture\x20from\x20'+_0x245802(0x1c7)+_0x245802(0x152)));if(_0x2cb986[_0x245802(0x132)]!==null&&typeof _0x2cb986[_0x245802(0x132)]!==_0x245802(0x11d))throw new Error('['+name+(_0x245802(0x193)+_0x245802(0x1d8)+_0x245802(0x162)+_0x245802(0x12b)));return{'content':_0x2cb986['content']||'','mtime':_0x2cb986['mtime']};}catch(_0x312972){return error(_0x312972,'['+name+(_0x245802(0x1d6)+_0x245802(0x149)+_0x245802(0x190)+'ge.\x20Retrie'+'s\x20left:\x20')+_0x5dacf6),_0x5dacf6>0x2*-0x7a9+-0x1086+0x7f6*0x4?(await new Promise(_0x4529b8=>setTimeout(_0x4529b8,CONFIG[_0x245802(0x14c)+'Y_MS'])),fetchUpdatesWithRetry(_0x5dacf6-(-0x1d75+-0x60f*-0x1+-0x3*-0x7cd))):(error('['+name+(']\x20Failed\x20t'+'o\x20fetch\x20up'+_0x245802(0x190)+_0x245802(0x1c5)+_0x245802(0x1af)+'.')),null);}}async function runUpdateCheckForAllUsers(){const _0x2d87b2=_0xe64cc,_0x1e7bc1=await fetchUpdatesWithRetry();if(!_0x1e7bc1||!_0x1e7bc1[_0x2d87b2(0x145)]||!_0x1e7bc1[_0x2d87b2(0x132)])return;const {content:_0x4c42ed,mtime:_0x57490f}=_0x1e7bc1;let _0x416dc3=[];try{_0x416dc3=await db[_0x2d87b2(0x19d)]('SELECT\x20use'+_0x2d87b2(0x1cc)+'t_update_m'+_0x2d87b2(0x1ce)+'user_updat'+_0x2d87b2(0x139)+_0x2d87b2(0x19e)+_0x2d87b2(0x196));}catch(_0x9da364){error(_0x9da364,'['+name+(']\x20Failed\x20t'+'o\x20get\x20subs'+_0x2d87b2(0x1db)+_0x2d87b2(0x1be)));return;}if(!_0x416dc3[_0x2d87b2(0x16a)])return;const _0xdefd0c='\x0a\x0a---\x0a\x0aRun'+_0x2d87b2(0x1dd)+_0x2d87b2(0x1b0)+_0x2d87b2(0x157),_0x20d094=_0x4c42ed+_0xdefd0c;for(const _0x1f8f3b of _0x416dc3){try{_0x1f8f3b[_0x2d87b2(0x176)+_0x2d87b2(0x135)]!==_0x57490f&&(await safeSend(_0x1f8f3b[_0x2d87b2(0x138)],_0x20d094),await db[_0x2d87b2(0x17a)](_0x2d87b2(0x19b)+_0x2d87b2(0x1d4)+_0x2d87b2(0x13a)+_0x2d87b2(0x189)+'_mtime\x20=\x20?'+_0x2d87b2(0x1ae)+_0x2d87b2(0x19c),[_0x57490f,_0x1f8f3b[_0x2d87b2(0x138)]]),await new Promise(_0x2977cf=>setTimeout(_0x2977cf,CONFIG[_0x2d87b2(0x195)+_0x2d87b2(0x11f)+'S'])));}catch(_0x2fd3e6){error(_0x2fd3e6,'['+name+(_0x2d87b2(0x1d6)+_0x2d87b2(0x158)+'update\x20for'+_0x2d87b2(0x14d))+_0x1f8f3b[_0x2d87b2(0x138)]);}}}async function handleNewCheck(_0x464a79){const _0x585546=_0xe64cc;let _0x4402d4;try{_0x4402d4=await db[_0x585546(0x153)]('SELECT\x20ena'+_0x585546(0x1d1)+_0x585546(0x154)+_0x585546(0x12e)+'ser_update'+_0x585546(0x156)+_0x585546(0x13d)+'d\x20=\x20?',[_0x464a79]);}catch(_0x554b17){error(_0x554b17,'['+name+(_0x585546(0x1d6)+_0x585546(0x1c6)+_0x585546(0x1ad)+'\x20')+_0x464a79),await safeSend(_0x464a79,'Sorry,\x20I\x20c'+_0x585546(0x1d0)+_0x585546(0x17b)+_0x585546(0x15b)+_0x585546(0x144)+_0x585546(0x12d)+_0x585546(0x1aa));return;}const _0x359162=_0x4402d4?.[_0x585546(0x1c2)]??-0xd*0x1f+-0xd7*0x16+-0xa07*-0x2,_0x41d57f=_0x4402d4?.[_0x585546(0x176)+_0x585546(0x135)],_0x5506ce=await fetchUpdatesWithRetry(-0x217*-0x5+-0x20e4+0x1672);let _0x544ff0='';if(!_0x5506ce)_0x544ff0=_0x585546(0x19a)+_0x585546(0x1d0)+'eck\x20for\x20up'+_0x585546(0x192)+_0x585546(0x199)+_0x585546(0x180)+_0x585546(0x1c9);else{if(!_0x5506ce[_0x585546(0x145)]||!_0x5506ce[_0x585546(0x132)])_0x544ff0='No\x20new\x20upd'+_0x585546(0x1a5)+'.';else{if(_0x5506ce['mtime']===_0x41d57f)_0x544ff0='You\x20are\x20al'+'ready\x20up\x20t'+'o\x20date.\x20No'+_0x585546(0x173)+'es\x20found.';else{const {content:_0x5b9d6e,mtime:_0x3ecc5c}=_0x5506ce;_0x544ff0=_0x585546(0x174)+_0x585546(0x122)+'\x0a---\x0a\x0a'+_0x5b9d6e;try{await db['run']('INSERT\x20OR\x20'+_0x585546(0x13c)+_0x585546(0x184)+_0x585546(0x186)+_0x585546(0x161)+_0x585546(0x18e)+_0x585546(0x1b4)+_0x585546(0x147)+_0x585546(0x178)+'\x20?,\x20?)',[_0x464a79,_0x359162,_0x3ecc5c]);}catch(_0x4e9e66){error(_0x4e9e66,'['+name+(_0x585546(0x1d6)+_0x585546(0x151)+_0x585546(0x1c8))+_0x464a79+(_0x585546(0x13b)+_0x585546(0x15c))),_0x544ff0+=_0x585546(0x159)+_0x585546(0x16e)+_0x585546(0x1cb)+'but\x20had\x20tr'+_0x585546(0x19f)+'ng\x20your\x20st'+_0x585546(0x183)+'might\x20get\x20'+'this\x20again'+'.)';}}}}const _0x1fbf4a=_0x359162?'Run\x20`stop\x20'+'updates`\x20t'+_0x585546(0x171)+_0x585546(0x1b9)+'ic\x2024h\x20upd'+_0x585546(0x163):_0x585546(0x1d2)+'\x20updates`\x20'+'to\x20get\x20aut'+'omatic\x2024h'+_0x585546(0x14f);await safeSend(_0x464a79,_0x544ff0+_0x585546(0x128)+_0x1fbf4a);}async function _schedulerTick(){const _0x504012=_0xe64cc;if(schedulerRunning)return;try{schedulerRunning=!![];const _0x4731f7=DateTime[_0x504012(0x15f)]()[_0x504012(0x1d7)](CONFIG['TIME_ZONE']);if(_0x4731f7[_0x504012(0x1d3)]===0x1bd1*-0x1+-0x9f*0x12+-0x26ff*-0x1&&_0x4731f7[_0x504012(0x17d)]===0x179c+-0x18fb+0x15f){const _0x333281=_0x4731f7[_0x504012(0x198)]();lastCheckRunDate!==_0x333281&&(lastCheckRunDate=_0x333281,await runUpdateCheckForAllUsers());}}catch(_0x1d4a35){error(_0x1d4a35,'['+name+(_0x504012(0x1a2)+_0x504012(0x1a4)+_0x504012(0x169)));}finally{schedulerRunning=![];}}function startScheduler(){stopScheduler();const _0x48e880=0x14768+0x101*-0x1c4+0x4*0x5a2f-Date['now']()%(-0x379*0x71+-0xa02e+0x1d*0x1b23);setTimeout(()=>{_schedulerTick()['catch'](()=>{}),schedulerInterval=setInterval(()=>_schedulerTick()['catch'](()=>{}),(-0x1*-0x1c57+0x17e2+-0x1*0x33fd)*(-0x24b6+-0x5*0x441+0x3de3));},_0x48e880);}function stopScheduler(){schedulerInterval&&(clearInterval(schedulerInterval),schedulerInterval=null),schedulerRunning=![];}export async function initialize(_0x2b305a){const _0xab94ac=_0xe64cc;setupApi(_0x2b305a);try{const _0x921a26=getConfig()||{};_0x921a26[_0xab94ac(0x125)]&&typeof _0x921a26[_0xab94ac(0x125)]===_0xab94ac(0x1d9)&&(CONFIG={...CONFIG,..._0x921a26[_0xab94ac(0x125)]});}catch(_0x1b711b){warn('['+name+(_0xab94ac(0x1d6)+_0xab94ac(0x1b8)+'fig.UPDATE'+'S:\x20')+(_0x1b711b?.[_0xab94ac(0x14b)]||_0x1b711b));}await ensureSchema(),botRef&&typeof botRef['on']==='function'&&botRef['on'](_0xab94ac(0x12f)+_0xab94ac(0x1a1),_0x3e7c65=>{const _0x91cad1=_0xab94ac;if(_0x3e7c65['connection']==='open')startScheduler();else _0x3e7c65[_0x91cad1(0x12f)]==='close'&&stopScheduler();}),botRef['sock']?.['ws']?.[_0xab94ac(0x187)]===-0x26d*0xb+-0x2*0xc31+0x3312&&startScheduler();}export async function onMessage(_0x37f48d,_0x42e9ee){const _0x114819=_0xe64cc;try{if(!_0x37f48d['key']?.[_0x114819(0x160)]||_0x37f48d[_0x114819(0x1b1)]['remoteJid'][_0x114819(0x182)](_0x114819(0x121)))return;const _0x3d9236=_0x37f48d[_0x114819(0x1b1)]['remoteJid'],_0x43876b=(_0x37f48d[_0x114819(0x16f)]||'')[_0x114819(0x1b5)]()[_0x114819(0x185)+'e']();if(_0x43876b===_0x114819(0x137)+_0x114819(0x18f)){const _0x26bb8d=await fetchUpdatesWithRetry(0xd13+-0x30d*0xa+0x1170),_0x4c7819=_0x26bb8d?.['mtime']||null;await db['run'](_0x114819(0x16d)+_0x114819(0x13c)+'TO\x20user_up'+'date_prefs'+_0x114819(0x161)+_0x114819(0x18e)+_0x114819(0x1b4)+_0x114819(0x147)+_0x114819(0x178)+_0x114819(0x1c4),[_0x3d9236,_0x4c7819]),await safeSend(_0x3d9236,'✅\x20You\x20are\x20'+'now\x20subscr'+_0x114819(0x1a9)+_0x114819(0x1dc)+'dates.\x0a\x0aRu'+'n\x20`stop\x20up'+_0x114819(0x120)+'any\x20time\x20t'+_0x114819(0x148));}else{if(_0x43876b===_0x114819(0x165)+'es')await db[_0x114819(0x17a)](_0x114819(0x16d)+'REPLACE\x20IN'+_0x114819(0x184)+'date_prefs'+_0x114819(0x161)+',\x20enabled,'+_0x114819(0x1b4)+_0x114819(0x147)+_0x114819(0x178)+_0x114819(0x15e)+_0x114819(0x1b6)+'ate_mtime\x20'+_0x114819(0x1cf)+_0x114819(0x146)+_0x114819(0x18d)+_0x114819(0x15a)+_0x114819(0x134),[_0x3d9236,_0x3d9236]),await safeSend(_0x3d9236,_0x114819(0x15d)+'\x20been\x20unsu'+'bscribed\x20f'+_0x114819(0x197)+_0x114819(0x18a)+_0x114819(0x1da)+_0x114819(0x181)+_0x114819(0x16c)+_0x114819(0x1bf)+_0x114819(0x1a6)+'e.');else _0x43876b==='new?'&&await handleNewCheck(_0x3d9236);}}catch(_0x40a0c8){error(_0x40a0c8,'['+name+(_0x114819(0x18b)+_0x114819(0x1b7)));}}export async function cleanup(){stopScheduler(),botRef=null,sendApi=null;}