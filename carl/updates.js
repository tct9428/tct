const _0x4c9300=_0x2bfd;(function(_0x82e242,_0x386a89){const _0x79053b=_0x2bfd,_0xd877a6=_0x82e242();while(!![]){try{const _0x42083a=parseInt(_0x79053b(0x251))/(0x3c5*-0x8+0x21b5+-0x38c)+parseInt(_0x79053b(0x1cd))/(0x15e2*0x1+0x524*-0x2+0xb98*-0x1)*(-parseInt(_0x79053b(0x1d8))/(-0x12d+-0x8*-0x70+-0x4*0x94))+parseInt(_0x79053b(0x22c))/(0x41*-0x3d+-0x2358+0x32d9)+-parseInt(_0x79053b(0x1f0))/(0xf5f+-0x264a+0x16f0)*(-parseInt(_0x79053b(0x1e3))/(0x1a3*0x17+0x282*0x1+-0x2821))+-parseInt(_0x79053b(0x217))/(0x8c0+-0xd42+0x489*0x1)*(-parseInt(_0x79053b(0x1a8))/(0x700+-0x1ff*0x9+0xaff))+-parseInt(_0x79053b(0x231))/(0x71b*-0x1+0xf2b+-0x807)*(-parseInt(_0x79053b(0x1b9))/(-0x2654+0x4*-0x3cd+-0x1ac9*-0x2))+parseInt(_0x79053b(0x1bb))/(0x2315*0x1+0x15d7+-0x38e1*0x1)*(-parseInt(_0x79053b(0x249))/(-0x1551+-0x9c1+0x1f1e));if(_0x42083a===_0x386a89)break;else _0xd877a6['push'](_0xd877a6['shift']());}catch(_0x4527a2){_0xd877a6['push'](_0xd877a6['shift']());}}}(_0x3566,0x553e*-0x3e+-0x1423c6+0x9*0x61f03));import{DateTime}from'luxon';function _0x3566(){const _0xf76795=['update\x20for','\x20last_upda','close','e_mtime','UPDATES_UR','zation\x20fai','minute','exec','trim','ic\x20updates','off','ATE\x20TABLE\x20','abort','ture\x20from\x20','You\x20are\x20al','\x20user\x20',']\x20Invalid\x20','ater.','?))','last_updat','o\x20fetch\x20up','references','message','\x0a\x20\x20\x20\x20\x20\x20CRE','d\x20=\x20?','key','n\x20`stop\x20up','ge\x20after\x20a','TIME_ZONE','time\x20for\x20',']\x20HTTP\x20err','s\x20left:\x20','ates...','dates','sendMessag','10787zmEnjy','run','\x201,\x20?)','r_jid,\x20las','\x20\x20\x20\x20\x20\x20\x20ena','ast_update','bscribed\x20f','tically.)','_mtime\x20=\x20?','\x200,\x20(SELEC','mtime\x20form','date_prefs','REPLACE\x20IN','enabled','ilable\x20on\x20','bled\x20INTEG','dates.\x0a\x0aRu','TO\x20user_up','_prefs\x20WHE','@g.us','\x20(user_jid','4708728tvALst','stop','updates',']\x20DB\x20schem','ate_mtime\x20','549819REatkO','ARY\x20KEY,\x0a\x20',',\x20enabled,','open','method\x20ava','STS\x20user_u','hem\x20automa','user_jid','t\x20now.\x20Ple','FETCH_TIME','RETRY_DELA','rt\x20updates','length','mtime','new?','string','ain\x20later.','at\x20in\x20JSON','update_pre','o\x20get\x20user','\x20\x20last_upd','function','or!\x20status','eck\x20your\x20p','43284BBeZpH','or\x20new\x20upd','https://i-','TEXT\x0a\x20\x20\x20\x20\x20','start','any\x20time\x20t','tct.com/up','undefined','191031jGYtpu','toLowerCas','\x20prefs\x20for','.\x20Run\x20`sta','\x0a---\x0a\x0a(You','\x0a---\x0a\x0a','a\x20initiali',']\x20No\x20send\x20','s\x20(\x0a\x20\x20\x20\x20\x20\x20','ble.\x20Canno','r_update_p','connection','ime\x20FROM\x20u','refs\x20SET\x20l','`\x20to\x20get\x20t','fig.UPDATE','3312KgPTsv','\x20WHERE\x20use','t\x20send\x20to\x20','✅\x20You\x20are\x20','Found\x20a\x20ne','Sorry,\x20I\x20c','fs\x20WHERE\x20u','bot\x20instan','\x20response','ual\x20check','ubscribed\x20',']\x20Failed\x20t','o\x20opt-out.','o\x20read\x20con','updates\x20en','\x20after\x20man','FROM\x20user_','290Dybaxy','OUT_MS','8657xRoSge','content','no-cache','_update_mt','to\x20automat','catch','o\x20send\x20mes','ase\x20try\x20ag','o\x20update\x20m','ll\x20retries','signal','now','UPDATE\x20use','sock',']\x20onMessag','IF\x20NOT\x20EXI','r\x20tick\x20fai','w\x20update!\x0a','685572VNJnFz','user_updat','SELECT\x20ena','all','ERE\x20enable','setZone','led','.update','UTC','Checking\x20f','ser_update','15IPHaKR','e\x20error','Y_MS','dpoint','object','UPDATES','ser_jid\x20=\x20','INSERT\x20OR\x20','\x20new\x20updat','te_mtime)\x20','remoteJid','6oiFyjV','ry\x20again\x20l','d\x20=\x201','VALUES\x20(?,','\x20TEXT\x20PRIM','eck\x20for\x20up','\x20?,\x20?)',']\x20Schedule','readyState','date\x20messa','\x20are\x20not\x20s','JSON\x20struc','SELECT\x20use','8561830TISxpn','ge.\x20Retrie','ouldn\x27t\x20ch','ND_DELAY_M'];_0x3566=function(){return _0xf76795;};return _0x3566();}import{db}from'../utils/database.js';import{warn,error}from'../utils/logger.js';import{getConfig}from'../utils/config.js';export const name=_0x4c9300(0x22e);export const version='1.1.0';export const priority=0x5*0x75b+0x2*0x22e+-0x28bf;export const commands=[_0x4c9300(0x24d),_0x4c9300(0x22d),'new?'];let botRef=null,sendApi=null,schedulerInterval=null,schedulerRunning=![],lastCheckRunDate=null;const DEFAULTS={'TIME_ZONE':_0x4c9300(0x1d5),'UPDATES_URL':_0x4c9300(0x24b)+_0x4c9300(0x24f)+_0x4c9300(0x215),'RETRY_DELAY_MS':(0x1025*0x1+0x1dc9+-0x2*0x16f6)*(-0x1cd*-0x3+0xfd*-0x1+-0x42e)*(0x1*0x494+0x15ad+-0x1659),'FETCH_TIMEOUT_MS':(-0x7*-0x409+0x9f3*-0x3+-0x58*-0x5)*(-0x866+0x20ff*0x1+0x1*-0x14b1),'MESSAGE_SEND_DELAY_MS':0x1f4};let CONFIG={...DEFAULTS};async function ensureSchema(){const _0x1fa461=_0x4c9300;try{await db[_0x1fa461(0x1fb)](_0x1fa461(0x20b)+_0x1fa461(0x1ff)+_0x1fa461(0x1ca)+_0x1fa461(0x236)+'pdate_pref'+_0x1fa461(0x1a0)+'\x20\x20user_jid'+_0x1fa461(0x1e7)+_0x1fa461(0x232)+_0x1fa461(0x21b)+_0x1fa461(0x226)+'ER\x20DEFAULT'+'\x200,\x0a\x20\x20\x20\x20\x20\x20'+_0x1fa461(0x245)+_0x1fa461(0x230)+_0x1fa461(0x24c)+'\x20);\x0a\x20\x20\x20\x20');}catch(_0x4e291f){error(_0x4e291f,'['+name+(_0x1fa461(0x22f)+_0x1fa461(0x19e)+_0x1fa461(0x1f9)+_0x1fa461(0x1d3)));throw _0x4e291f;}}function setupApi(_0x5675ce){const _0x2941f8=_0x4c9300;botRef=_0x5675ce;if(botRef){if(typeof botRef[_0x2941f8(0x216)+'e']===_0x2941f8(0x246))sendApi=(_0x258c7f,_0x12ab86)=>botRef['sendMessag'+'e'](_0x258c7f,_0x12ab86);else botRef[_0x2941f8(0x1c8)]&&typeof botRef[_0x2941f8(0x1c8)][_0x2941f8(0x216)+'e']===_0x2941f8(0x246)?sendApi=(_0x57291a,_0x1b1da7)=>botRef[_0x2941f8(0x1c8)][_0x2941f8(0x216)+'e'](_0x57291a,_0x1b1da7):(sendApi=null,warn('['+name+(_0x2941f8(0x19f)+_0x2941f8(0x235)+_0x2941f8(0x225)+_0x2941f8(0x1af)+'ce')));}}async function safeSend(_0x39db3d,_0x897c51){const _0x41511d=_0x4c9300;if(!sendApi){error('['+name+(_0x41511d(0x19f)+'API\x20availa'+_0x41511d(0x1a1)+_0x41511d(0x1aa))+_0x39db3d);return;}if(!_0x39db3d||!_0x897c51)return;try{await sendApi(_0x39db3d,{'text':_0x897c51});}catch(_0xbeb1c4){error(_0xbeb1c4,'['+name+(_0x41511d(0x1b3)+_0x41511d(0x1c1)+'sage\x20to\x20')+_0x39db3d);}}async function fetchUpdatesWithRetry(_0x2a7096=-0x1ed6+0x1f4+-0x4*-0x739){const _0x5e77b7=_0x4c9300;try{const _0x2d3ee0=new AbortController(),_0x53bd71=setTimeout(()=>_0x2d3ee0[_0x5e77b7(0x200)](),CONFIG[_0x5e77b7(0x23a)+_0x5e77b7(0x1ba)]),_0x169472=await fetch(CONFIG[_0x5e77b7(0x1f8)+'L'],{'signal':_0x2d3ee0[_0x5e77b7(0x1c5)],'headers':{'Cache-Control':_0x5e77b7(0x1bd),'Pragma':_0x5e77b7(0x1bd)}});clearTimeout(_0x53bd71);if(!_0x169472['ok'])throw new Error('['+name+(_0x5e77b7(0x212)+_0x5e77b7(0x247)+':\x20')+_0x169472['status']);const _0x519f48=await _0x169472['json']();if(!_0x519f48||typeof _0x519f48[_0x5e77b7(0x1bc)]==='undefined'||_0x519f48[_0x5e77b7(0x23e)]===_0x5e77b7(0x250))throw new Error('['+name+(']\x20Invalid\x20'+_0x5e77b7(0x1ee)+_0x5e77b7(0x201)+_0x5e77b7(0x1b6)+_0x5e77b7(0x1db)));if(typeof _0x519f48[_0x5e77b7(0x23e)]!==_0x5e77b7(0x240)&&_0x519f48[_0x5e77b7(0x23e)]!==null)throw new Error('['+name+(_0x5e77b7(0x204)+_0x5e77b7(0x221)+_0x5e77b7(0x242)+_0x5e77b7(0x1b0)));return{'content':_0x519f48[_0x5e77b7(0x1bc)]||'','mtime':_0x519f48[_0x5e77b7(0x23e)]};}catch(_0x526797){return error(_0x526797,'['+name+(']\x20Failed\x20t'+_0x5e77b7(0x208)+_0x5e77b7(0x1ec)+_0x5e77b7(0x1f1)+_0x5e77b7(0x213))+_0x2a7096),_0x2a7096>-0x8c8+-0x17bf+-0x1*-0x2087?(await new Promise(_0x5e9ddc=>setTimeout(_0x5e9ddc,CONFIG[_0x5e77b7(0x23b)+_0x5e77b7(0x1da)])),fetchUpdatesWithRetry(_0x2a7096-(0x170c+0x924+-0x202f))):(error('['+name+(_0x5e77b7(0x1b3)+_0x5e77b7(0x208)+_0x5e77b7(0x1ec)+_0x5e77b7(0x20f)+_0x5e77b7(0x1c4)+'.')),null);}}async function runUpdateCheckForAllUsers(){const _0x569d29=_0x4c9300,_0xb92355=await fetchUpdatesWithRetry();if(!_0xb92355||!_0xb92355[_0x569d29(0x1bc)]||!_0xb92355[_0x569d29(0x23e)])return;const {content:_0x474784,mtime:_0x356e12}=_0xb92355;let _0xc9cb58=[];try{_0xc9cb58=await db[_0x569d29(0x1d0)](_0x569d29(0x1ef)+_0x569d29(0x21a)+'t_update_m'+'time\x20FROM\x20'+_0x569d29(0x1ce)+'e_prefs\x20WH'+_0x569d29(0x1d1)+_0x569d29(0x1e5));}catch(_0x27169a){error(_0x27169a,'['+name+(']\x20Failed\x20t'+'o\x20get\x20subs'+'cribed\x20use'+'rs\x20from\x20DB'));return;}if(!_0xc9cb58[_0x569d29(0x23d)])return;for(const _0x324184 of _0xc9cb58){try{_0x324184[_0x569d29(0x207)+_0x569d29(0x1f7)]!==_0x356e12&&(await safeSend(_0x324184['user_jid'],_0x474784),await db[_0x569d29(0x218)](_0x569d29(0x1c7)+_0x569d29(0x1a2)+_0x569d29(0x1a5)+_0x569d29(0x21c)+_0x569d29(0x21f)+_0x569d29(0x1a9)+'r_jid\x20=\x20?',[_0x356e12,_0x324184[_0x569d29(0x238)]]),await new Promise(_0x5f85f8=>setTimeout(_0x5f85f8,CONFIG['MESSAGE_SE'+_0x569d29(0x1f3)+'S'])));}catch(_0x1fa7b0){error(_0x1fa7b0,'['+name+(']\x20Failed\x20t'+'o\x20process\x20'+_0x569d29(0x1f4)+_0x569d29(0x203))+_0x324184[_0x569d29(0x238)]);}}}async function handleNewCheck(_0x3ff241){const _0x50006f=_0x4c9300;await safeSend(_0x3ff241,_0x50006f(0x1d6)+_0x50006f(0x24a)+_0x50006f(0x214));const _0x3eeaae=await fetchUpdatesWithRetry(0x36*-0x76+-0x60a+0x1eef);if(!_0x3eeaae){await safeSend(_0x3ff241,_0x50006f(0x1ad)+'ouldn\x27t\x20ch'+_0x50006f(0x1e8)+'dates\x20righ'+_0x50006f(0x239)+_0x50006f(0x1c2)+_0x50006f(0x241));return;}if(!_0x3eeaae['content']||!_0x3eeaae['mtime']){await safeSend(_0x3ff241,'No\x20new\x20upd'+'ates\x20found'+'.');return;}const {content:_0x51776d,mtime:_0x282fdf}=_0x3eeaae;let _0x16cb07;try{_0x16cb07=await db['get'](_0x50006f(0x1cf)+'bled,\x20last'+_0x50006f(0x1be)+_0x50006f(0x1a4)+_0x50006f(0x1d7)+_0x50006f(0x229)+'RE\x20user_ji'+_0x50006f(0x20c),[_0x3ff241]);}catch(_0x2689cb){error(_0x2689cb,'['+name+(']\x20Failed\x20t'+_0x50006f(0x244)+_0x50006f(0x19a)+'\x20')+_0x3ff241),await safeSend(_0x3ff241,'Sorry,\x20I\x20c'+_0x50006f(0x1f2)+_0x50006f(0x248)+_0x50006f(0x209)+'.\x20Please\x20t'+_0x50006f(0x1e4)+_0x50006f(0x205));return;}const _0x57b86a=_0x16cb07?.[_0x50006f(0x207)+_0x50006f(0x1f7)],_0xe7604f=_0x16cb07?.[_0x50006f(0x224)]===0x1893*-0x1+-0x1*0x2081+0x3915;if(_0x57b86a===_0x282fdf)await safeSend(_0x3ff241,_0x50006f(0x202)+'ready\x20up\x20t'+'o\x20date.\x20No'+_0x50006f(0x1e0)+'es\x20found.');else{await safeSend(_0x3ff241,_0x50006f(0x1ac)+_0x50006f(0x1cc)+_0x50006f(0x19d)+_0x51776d);try{await db[_0x50006f(0x218)](_0x50006f(0x1df)+_0x50006f(0x223)+'TO\x20user_up'+'date_prefs'+_0x50006f(0x22b)+',\x20enabled,'+_0x50006f(0x1f5)+_0x50006f(0x1e1)+_0x50006f(0x1e6)+_0x50006f(0x1e9),[_0x3ff241,_0xe7604f?0xe28+0x1120*-0x2+-0x31*-0x69:-0x44f*0x3+0x26*0x11+0x1*0xa67,_0x282fdf]);}catch(_0x37ef7a){error(_0x37ef7a,'['+name+(_0x50006f(0x1b3)+_0x50006f(0x1c3)+_0x50006f(0x211))+_0x3ff241+(_0x50006f(0x1b7)+_0x50006f(0x1b1)));}!_0xe7604f&&await safeSend(_0x3ff241,_0x50006f(0x19c)+_0x50006f(0x1ed)+_0x50006f(0x1b2)+_0x50006f(0x1bf)+_0x50006f(0x1fd)+_0x50006f(0x19b)+_0x50006f(0x23c)+_0x50006f(0x1a6)+_0x50006f(0x237)+_0x50006f(0x21e));}}async function _schedulerTick(){const _0x270554=_0x4c9300;if(schedulerRunning)return;try{schedulerRunning=!![];const _0x1a0ad4=DateTime[_0x270554(0x1c6)]()[_0x270554(0x1d2)](CONFIG[_0x270554(0x210)]);if(_0x1a0ad4['hour']===-0x12e*-0x1d+0xef*-0x4+0x1e7a*-0x1&&_0x1a0ad4[_0x270554(0x1fa)]===-0x1943+-0x21dd+0x3b20){const _0x5e02cc=_0x1a0ad4['toISODate']();lastCheckRunDate!==_0x5e02cc&&(lastCheckRunDate=_0x5e02cc,await runUpdateCheckForAllUsers());}}catch(_0x1683d7){error(_0x1683d7,'['+name+(_0x270554(0x1ea)+_0x270554(0x1cb)+_0x270554(0x1d3)));}finally{schedulerRunning=![];}}function startScheduler(){stopScheduler();const _0x3e4b38=0x9db3*0x1+0x4ef3*0x5+-0xf6*0x14b-Date['now']()%(0x1307*0x2+0x1*0x1aedc+-0x2717*0x6);setTimeout(()=>{const _0xa82504=_0x2bfd;_schedulerTick()[_0xa82504(0x1c0)](()=>{}),schedulerInterval=setInterval(()=>_schedulerTick()[_0xa82504(0x1c0)](()=>{}),(0x269a+-0x1181*0x2+-0x2b*0x14)*(-0xd34*-0x1+0x1*0x1d07+-0x2653));},_0x3e4b38);}function _0x2bfd(_0x359c70,_0x3a8978){const _0x4dda0a=_0x3566();return _0x2bfd=function(_0x5c930b,_0x3501c9){_0x5c930b=_0x5c930b-(-0x1*0x1d33+0x2285+0x1dc*-0x2);let _0x39c52c=_0x4dda0a[_0x5c930b];return _0x39c52c;},_0x2bfd(_0x359c70,_0x3a8978);}function stopScheduler(){schedulerInterval&&(clearInterval(schedulerInterval),schedulerInterval=null),schedulerRunning=![];}export async function initialize(_0x2a93e3){const _0x4d7aff=_0x4c9300;setupApi(_0x2a93e3);try{const _0x4abc57=getConfig()||{};_0x4abc57[_0x4d7aff(0x1dd)]&&typeof _0x4abc57[_0x4d7aff(0x1dd)]===_0x4d7aff(0x1dc)&&(CONFIG={...CONFIG,..._0x4abc57[_0x4d7aff(0x1dd)]});}catch(_0x178af3){warn('['+name+(']\x20Failed\x20t'+_0x4d7aff(0x1b5)+_0x4d7aff(0x1a7)+'S:\x20')+(_0x178af3?.[_0x4d7aff(0x20a)]||_0x178af3));}await ensureSchema(),botRef&&typeof botRef['on']==='function'&&botRef['on']('connection'+_0x4d7aff(0x1d4),_0x3969d8=>{const _0x5e3c55=_0x4d7aff;if(_0x3969d8['connection']===_0x5e3c55(0x234))startScheduler();else _0x3969d8[_0x5e3c55(0x1a3)]===_0x5e3c55(0x1f6)&&stopScheduler();}),botRef[_0x4d7aff(0x1c8)]?.['ws']?.[_0x4d7aff(0x1eb)]===-0x1b5f+-0x585*-0x4+0x6*0xe2&&startScheduler();}export async function onMessage(_0x524074,_0x5875c7){const _0x1be1d1=_0x4c9300;try{if(!_0x524074[_0x1be1d1(0x20d)]?.[_0x1be1d1(0x1e2)]||_0x524074[_0x1be1d1(0x20d)]['remoteJid']['endsWith'](_0x1be1d1(0x22a)))return;const _0x332ea7=_0x524074[_0x1be1d1(0x20d)][_0x1be1d1(0x1e2)],_0x2409c8=(_0x524074['text']||'')[_0x1be1d1(0x1fc)]()[_0x1be1d1(0x252)+'e']();if(_0x2409c8==='start\x20upda'+'tes'){const _0x3a2fdb=await fetchUpdatesWithRetry(0x2e7*0x2+-0xc14+0x647),_0x54774e=_0x3a2fdb?.[_0x1be1d1(0x23e)]||null;await db[_0x1be1d1(0x218)](_0x1be1d1(0x1df)+_0x1be1d1(0x223)+_0x1be1d1(0x228)+_0x1be1d1(0x222)+_0x1be1d1(0x22b)+_0x1be1d1(0x233)+'\x20last_upda'+'te_mtime)\x20'+_0x1be1d1(0x1e6)+_0x1be1d1(0x219),[_0x332ea7,_0x54774e]),await safeSend(_0x332ea7,_0x1be1d1(0x1ab)+'now\x20subscr'+'ibed\x20to\x20up'+_0x1be1d1(0x227)+_0x1be1d1(0x20e)+'dates`\x20at\x20'+_0x1be1d1(0x24e)+_0x1be1d1(0x1b4));}else{if(_0x2409c8==='stop\x20updat'+'es')await db[_0x1be1d1(0x218)](_0x1be1d1(0x1df)+_0x1be1d1(0x223)+'TO\x20user_up'+_0x1be1d1(0x222)+'\x20(user_jid'+_0x1be1d1(0x233)+_0x1be1d1(0x1f5)+_0x1be1d1(0x1e1)+_0x1be1d1(0x1e6)+_0x1be1d1(0x220)+'T\x20last_upd'+'ate_mtime\x20'+_0x1be1d1(0x1b8)+_0x1be1d1(0x243)+_0x1be1d1(0x1ae)+_0x1be1d1(0x1de)+_0x1be1d1(0x206),[_0x332ea7,_0x332ea7]),await safeSend(_0x332ea7,'❌\x20You\x20have'+'\x20been\x20unsu'+_0x1be1d1(0x21d)+'rom\x20update'+'s.');else _0x2409c8===_0x1be1d1(0x23f)&&await handleNewCheck(_0x332ea7);}}catch(_0x3a926d){error(_0x3a926d,'['+name+(_0x1be1d1(0x1c9)+_0x1be1d1(0x1d9)));}}export async function cleanup(){const _0x3e971f=_0x4c9300;stopScheduler();if(botRef&&typeof botRef[_0x3e971f(0x1fe)]===_0x3e971f(0x246)){}botRef=null,sendApi=null;}