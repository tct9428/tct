const _0x20da03=_0xd085;(function(_0xb59b8c,_0x35bbdd){const _0x55580d=_0xd085,_0x30b8cb=_0xb59b8c();while(!![]){try{const _0x5264dc=-parseInt(_0x55580d(0x179))/(-0x1eca+-0x26dc*-0x1+-0x5*0x19d)*(-parseInt(_0x55580d(0x115))/(0x1fcb+0x57*-0x59+-0x18a))+-parseInt(_0x55580d(0x1bd))/(-0x1591*0x1+0xcf0*-0x2+0x4*0xbdd)+-parseInt(_0x55580d(0x150))/(-0x12e7+-0x439*0x6+0x2c41)+-parseInt(_0x55580d(0x16e))/(0xe07+0x1aa6+0x2*-0x1454)+parseInt(_0x55580d(0x130))/(0x4*-0x377+-0x1c66*-0x1+0x3a1*-0x4)*(-parseInt(_0x55580d(0x1b6))/(0x2b*-0x6+-0x640+0x749))+-parseInt(_0x55580d(0x13f))/(0x16*-0x35+0x2*-0x6bf+-0x164*-0xd)*(-parseInt(_0x55580d(0x17a))/(-0x2335+-0x1cba+-0x5c*-0xb2))+parseInt(_0x55580d(0xfa))/(-0x5*0x486+-0x458+0x100*0x1b);if(_0x5264dc===_0x35bbdd)break;else _0x30b8cb['push'](_0x30b8cb['shift']());}catch(_0x508c3e){_0x30b8cb['push'](_0x30b8cb['shift']());}}}(_0xb03a,0x13e240+-0x1*0xad5b7+0xefa2));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';import{getConfig,hotReloadConfig}from'../utils/config.js';export const name=_0x20da03(0x11b);export const version=_0x20da03(0x141)+'id';function _0xb03a(){const _0x11513e=['ROLLBACK;','push','\x20failed\x20to','_new\x20(chat',',\x20enabled)','extendedTe',',\x20?)\x20\x0a\x20\x20\x20\x20','SPAM_COOLD','map','bled;','includes','id)\x20DO\x20UPD','cipantsUpd','warnCount','t_jid\x20=\x20?',']\x20failed\x20t','SELECT\x20*\x20F',']\x20Migrated','ze\x20fatal:\x20','values','EXISTS\x20','name','HOLD','132XPFbuG','\x20holds\x20onl','cluded.ena','\x20exists\x20wi','ning\x20warni','find','antispam',']\x20handleMe','resetspam','ssageForSp','T\x20chat_id,','\x20(chat_id\x20','contextInf',']\x20refreshC',']\x20kicked\x20','INSERT\x20INT','gesUpsertH','SPAM_WINDO','m\x20DISABLED','\x20failed:\x20','INSERT\x20OR\x20','m\x20for\x20this','er\x20error:\x20','SSAGE','_new\x20RENAM','sAt','le_info(','2445150txTUKs','mentions','led)\x20SELEC','off','OWN_MS','lastWarnAt','users\x20to\x20r','DB\x20error).','{warnings}','ate','keys','ENABLED','led:\x20','ns=','ICT(chat_j','349616CIgPAx','DROP\x20TABLE','2.2.0-hybr','\x20\x20ON\x20CONFL','split','am\x20error:\x20','error\x20for\x20','WARNING_ME','BEGIN\x20TRAN','isCommand','ATE\x20SET\x20en',']\x20Ensuring','\x20warnings.','\x0aConfig:\x20','stop\x20spamm','anti-spam\x20','\x20TEXT\x20PRIM','2528680TZKCjy','\x20VALUES\x20(?','SELECT\x20ena',':\x20sendApi\x20',']\x20Migratio','W_MS','endsWith','catch','ailed:\x20','table\x20','has','n\x20of\x20','stringify','PRIMARY\x20KE','run','ngs','exec','SPAM_THRES','MAX_WARNIN','\x20INTEGER);','remove','antispam.i','\x20(chat_jid',']\x20kickUser','✔️\x20Please\x20@','messages','requires\x20b','e\x20or\x20more\x20','eset\x20their','ings}','2420445XYrJHN','CREATE\x20TAB','ssage\x20fail','o\x20create\x20',')\x20error:\x20','✔️\x20Anti-spa','@g.us','REPLACE\x20IN','clear','zed.\x20In-me','(DB\x20error)','15787LlltFc','207UAcoCf','\x200\x20FROM\x20','\x20from\x20','_jid\x20TEXT\x20','nti-spam\x20(','_jid,\x20enab','toLowerCas','mory\x20enfor','o\x20enable\x20a','SACTION;','⚠️\x20Failed\x20t','spam_setti','ed\x20for\x20','LE\x20IF\x20NOT\x20','slice','WARNING_TT','messages.u','message',']\x20Ensured\x20',']\x20initiali','PRAGMA\x20tab','sIfNeeded\x20','ALTER\x20TABL','andler\x20inn','E\x20TO\x20','groupParti','r:\x20','delete',']\x20Failed\x20t','Y_MS','EGER);','chat_id','isAdmin','nabled\x20INT','KICK_ON_SP',']\x20migrateS','fromMe','\x20WHERE\x20cha',']\x20cleaned\x20','SELECT\x20nam','set','ite_master','.\x20Threshol','warnExpire','nabled\x20DB\x20','m\x20ENABLED\x20','\x20mentioned','Y,\x20enabled','ARY\x20KEY,\x20e','cid','ble','o\x20disable\x20','\x20group:\x20',']\x20getChatE','text','sendMessag',']\x20cleanup\x20','e\x20FROM\x20sql',']\x20sendText','COMMIT;','21ipUVtz','AND\x20name=?','->\x20chat_ji','d\x20spam.','sock','trim','get','3650280UJpyFN','th\x20expecte','rows',']\x20setChatE','sts(','string','ROM\x20','\x20anti-spam','isArray','filter','ot\x20instanc','max','\x20columns\x20f','abled\x20=\x20ex','SPAM','e\x20error:\x20','enabled','L_MS','key','length','participan','unbind\x20fai','psert','21628850kgSGNd','\x20LIMIT\x201','remoteJid','column_nam'];_0xb03a=function(){return _0x11513e;};return _0xb03a();}export const priority=0x312+0x1e12+-0x20ca;export const commands=[_0x20da03(0x11b),_0x20da03(0x11d)];export const configKeys=[_0x20da03(0xf1)];let botRef=null,sendApi=null;const chatUserMap=new Map(),processedMessageKeys=new Map(),DEDUPE_TTL_MS=(0x94*-0x1+0x1e8d+0x1ddb*-0x1)*(0x7a1+-0x10*-0x248+-0x2839),CFG={'SPAM_THRESHOLD':0x6,'SPAM_WINDOW_MS':(0x15f*-0xf+-0x11fa+0x2695*0x1)*(-0xd8b*0x1+-0x18b9+0x1516*0x2),'SPAM_COOLDOWN_MS':0x3e8,'MAX_WARNINGS':0x3,'WARN_EXPIRY_MS':(0x1051+-0x5*-0x5b3+0x5*-0x8f5)*(0x1e0d*0x1+-0x18e4+-0x511)*(-0x1b1*-0x16+0x130f+-0x3809)*(0xd75+-0x1c8d*0x1+-0xc*-0x147)*(-0x21b0+0x1f2c*0x1+0xc*0x89),'KICK_ON_SPAM':!![],'WARNING_MESSAGE':'⚠️\x20{user},\x20'+_0x20da03(0x14d)+'ing.\x20Remai'+_0x20da03(0x119)+'ngs:\x20{warn'+_0x20da03(0x16d),'WARNING_TTL_MS':0xc350};function refreshConfig(){const _0x38f619=_0x20da03;try{const _0x142b42=getConfig?.()?.[_0x38f619(0xf1)]||{};Object[_0x38f619(0x13a)](CFG)['forEach'](_0x3c8111=>{if(_0x142b42[_0x3c8111]!==undefined)CFG[_0x3c8111]=_0x142b42[_0x3c8111];}),CFG['SPAM_THRES'+'HOLD']=Math[_0x38f619(0xee)](0x1d5c+0x3*-0xacd+0x27*0x14,Number(CFG['SPAM_THRES'+_0x38f619(0x114)])||-0x362*0x9+-0x468+0x22e0),CFG['SPAM_WINDO'+_0x38f619(0x155)]=Math[_0x38f619(0xee)](0x780*-0x5+-0x18c7*-0x1+0xcb9,Number(CFG[_0x38f619(0x126)+'W_MS'])||(-0x1864+-0x2089+0x38f7)*(0x23e6+0x2*-0xccd+-0x4*0x199)),CFG['SPAM_COOLD'+'OWN_MS']=Math['max'](0x542+-0x10fa+0xbb8,Number(CFG[_0x38f619(0x105)+_0x38f619(0x134)])||-0x225b+-0x2425*-0x1+0x21e),CFG[_0x38f619(0x162)+'GS']=Math[_0x38f619(0xee)](0x1*-0x313+0x120a+0x5*-0x2fe,Number(CFG['MAX_WARNIN'+'GS'])||-0x251a+0x19b*0x5+0x1b6*0x11),CFG['WARN_EXPIR'+_0x38f619(0x197)]=Math['max'](-0x43*0x40+0x2594+-0x14d4,Number(CFG['WARN_EXPIR'+_0x38f619(0x197)])||(0x2024+-0x4b2+-0x1b6b*0x1)*(-0x6c9+0x3*0x779+0x66*-0x27)*(0x2370+0x1173*-0x2+-0x4e)*(-0x206f+-0x3b8+0x2463)*(-0x137e+0x14a8+0xea*0x3)),CFG['WARNING_TT'+_0x38f619(0xf4)]=Math[_0x38f619(0xee)](0x1359+0x8f7+-0x4*0x714,Number(CFG[_0x38f619(0x189)+'L_MS'])||-0x220f*0x5+-0x1*0x10d2d+-0x3*-0xd398),CFG[_0x38f619(0x19c)+'AM']=!!CFG[_0x38f619(0x19c)+'AM'];}catch(_0x39c2b2){warn('['+name+(_0x38f619(0x122)+'onfig\x20erro'+_0x38f619(0x194))+(_0x39c2b2?.[_0x38f619(0x18b)]||_0x39c2b2));}}const TABLE_SETTINGS=_0x20da03(0x185)+_0x20da03(0x15f);async function tableExists(_0x1d8e6b){const _0x12fc54=_0x20da03;try{const _0x3b4b5f=await db[_0x12fc54(0x1bc)](_0x12fc54(0x1a1)+_0x12fc54(0x1b3)+_0x12fc54(0x1a3)+'\x20WHERE\x20typ'+'e=\x27table\x27\x20'+_0x12fc54(0x1b7),[_0x1d8e6b]);return!!_0x3b4b5f;}catch(_0x45b967){return warn('['+name+(']\x20tableExi'+_0x12fc54(0x1c1))+_0x1d8e6b+_0x12fc54(0x172)+(_0x45b967?.['message']||_0x45b967)),![];}}async function getTableColumns(_0x4eb296){const _0x128916=_0x20da03;try{const _0x179034=await db[_0x128916(0x160)]('PRAGMA\x20tab'+_0x128916(0x12f)+_0x4eb296+');'),_0x4d3b51=Array[_0x128916(0x1c5)](_0x179034)?_0x179034:_0x179034&&_0x179034[_0x128916(0x1bf)]?_0x179034[_0x128916(0x1bf)]:[];return _0x4d3b51[_0x128916(0x106)](_0x4a515d=>_0x4a515d['name']||_0x4a515d[_0x128916(0xfd)+'e']||_0x4a515d[_0x128916(0x1ab)]);}catch(_0x57950e){try{const _0x5e6d03=await db['get'](_0x128916(0x10e)+_0x128916(0x1c3)+_0x4eb296+_0x128916(0xfb));return _0x5e6d03?Object[_0x128916(0x13a)](_0x5e6d03):[];}catch(_0x505cad){return[];}}}async function migrateSpamSettingsIfNeeded(){const _0xaaebcb=_0x20da03,_0x42c1a8=await tableExists(TABLE_SETTINGS);if(!_0x42c1a8)try{await db[_0xaaebcb(0x160)](_0xaaebcb(0x16f)+_0xaaebcb(0x187)+_0xaaebcb(0x112)+TABLE_SETTINGS+(_0xaaebcb(0x166)+_0xaaebcb(0x14f)+'ARY\x20KEY,\x20e'+_0xaaebcb(0x19b)+_0xaaebcb(0x198))),info('['+name+(']\x20Created\x20'+_0xaaebcb(0x159))+TABLE_SETTINGS);return;}catch(_0x2a1989){warn('['+name+(_0xaaebcb(0x196)+_0xaaebcb(0x171))+TABLE_SETTINGS+':\x20'+(_0x2a1989?.['message']||_0x2a1989));return;}try{const _0x2f9f4b=await db['exec'](_0xaaebcb(0x18e)+'le_info('+TABLE_SETTINGS+');');let _0x240645=[];if(Array[_0xaaebcb(0x1c5)](_0x2f9f4b))_0x240645=_0x2f9f4b[_0xaaebcb(0x106)](_0x4da329=>_0x4da329[_0xaaebcb(0x113)]||_0x4da329[-0x4e1+-0x22b3+0x2795*0x1])[_0xaaebcb(0x1c6)](Boolean);else{if(_0x2f9f4b&&Array[_0xaaebcb(0x1c5)](_0x2f9f4b[_0xaaebcb(0x1bf)]))_0x240645=_0x2f9f4b[_0xaaebcb(0x1bf)][_0xaaebcb(0x106)](_0x123904=>_0x123904[_0xaaebcb(0x113)])['filter'](Boolean);else try{const _0x3bf926=await db['get'](_0xaaebcb(0x10e)+_0xaaebcb(0x1c3)+TABLE_SETTINGS+_0xaaebcb(0xfb));_0x240645=_0x3bf926?Object[_0xaaebcb(0x13a)](_0x3bf926):[];}catch(_0x31b7db){_0x240645=[];}}const _0x373883=_0x240645['map'](_0x46c408=>String(_0x46c408)[_0xaaebcb(0x180)+'e']()),_0x3b5556=_0x373883[_0xaaebcb(0x108)]('chat_jid'),_0x3a6c4a=_0x373883['includes'](_0xaaebcb(0xf3)),_0x4181f0=_0x373883['includes'](_0xaaebcb(0x199));if(_0x3b5556&&_0x3a6c4a)return;if(!_0x3b5556&&_0x4181f0)try{await db[_0xaaebcb(0x160)](_0xaaebcb(0x147)+_0xaaebcb(0x183)),await db[_0xaaebcb(0x160)](_0xaaebcb(0x16f)+_0xaaebcb(0x187)+'EXISTS\x20'+TABLE_SETTINGS+('_new\x20(chat'+_0xaaebcb(0x17d)+_0xaaebcb(0x15d)+_0xaaebcb(0x1a9)+_0xaaebcb(0x163)));const _0x23f261=_0x3a6c4a;_0x23f261?await db[_0xaaebcb(0x160)]('INSERT\x20OR\x20'+_0xaaebcb(0x175)+'TO\x20'+TABLE_SETTINGS+(_0xaaebcb(0x101)+_0xaaebcb(0x17f)+_0xaaebcb(0x132)+_0xaaebcb(0x11f)+'\x20enabled\x20F'+_0xaaebcb(0x1c3))+TABLE_SETTINGS+';'):await db[_0xaaebcb(0x160)](_0xaaebcb(0x129)+_0xaaebcb(0x175)+'TO\x20'+TABLE_SETTINGS+(_0xaaebcb(0x101)+'_jid,\x20enab'+_0xaaebcb(0x132)+_0xaaebcb(0x11f)+_0xaaebcb(0x17b))+TABLE_SETTINGS+';');await db['exec'](_0xaaebcb(0x140)+'\x20'+TABLE_SETTINGS+';'),await db[_0xaaebcb(0x160)](_0xaaebcb(0x190)+'E\x20'+TABLE_SETTINGS+(_0xaaebcb(0x12d)+_0xaaebcb(0x192))+TABLE_SETTINGS+';'),await db[_0xaaebcb(0x160)](_0xaaebcb(0x1b5)),info('['+name+(_0xaaebcb(0x10f)+'\x20')+TABLE_SETTINGS+(_0xaaebcb(0x120)+_0xaaebcb(0x1b8)+'d)'));return;}catch(_0x498284){try{await db[_0xaaebcb(0x160)](_0xaaebcb(0xfe));}catch(_0x5816a3){}warn('['+name+(_0xaaebcb(0x154)+_0xaaebcb(0x15b))+TABLE_SETTINGS+_0xaaebcb(0x128)+(_0x498284?.[_0xaaebcb(0x18b)]||_0x498284));return;}if(!_0x3b5556||!_0x3a6c4a)try{await db[_0xaaebcb(0x160)](_0xaaebcb(0x16f)+_0xaaebcb(0x187)+'EXISTS\x20'+TABLE_SETTINGS+('\x20(chat_jid'+'\x20TEXT\x20PRIM'+_0xaaebcb(0x1aa)+'nabled\x20INT'+'EGER);')),info('['+name+_0xaaebcb(0x18c)+TABLE_SETTINGS+(_0xaaebcb(0x118)+_0xaaebcb(0x1be)+'d\x20columns.'));}catch(_0x34f021){warn('['+name+(_0xaaebcb(0x14a)+'\x20')+TABLE_SETTINGS+(_0xaaebcb(0xef)+_0xaaebcb(0x158))+(_0x34f021?.[_0xaaebcb(0x18b)]||_0x34f021));}}catch(_0x4de578){warn('['+name+(_0xaaebcb(0x19d)+'pamSetting'+_0xaaebcb(0x18f)+'error:\x20')+(_0x4de578?.[_0xaaebcb(0x18b)]||_0x4de578));}}async function ensureTables(){await migrateSpamSettingsIfNeeded();}function setupSendApi(){const _0x1af3d6=_0x20da03;if(!botRef)return;if(typeof botRef[_0x1af3d6(0x1b1)+'e']==='function')sendApi=async(_0x1a532e,_0xbd49f3)=>await botRef[_0x1af3d6(0x1b1)+'e'](_0x1a532e,_0xbd49f3);else{if(botRef[_0x1af3d6(0x1ba)]&&typeof botRef[_0x1af3d6(0x1ba)][_0x1af3d6(0x1b1)+'e']==='function')sendApi=async(_0x35e342,_0x10ff67)=>await botRef['sock'][_0x1af3d6(0x1b1)+'e'](_0x35e342,_0x10ff67);else sendApi=null;}}async function sendText(_0x2a9938,_0x13c5e7,_0x4807b1=[]){const _0x23accf=_0x20da03;if(!_0x13c5e7||!_0x2a9938)return null;if(!sendApi)return warn('['+name+(_0x23accf(0x1b4)+_0x23accf(0x153)+'not\x20availa'+_0x23accf(0x1ac))),null;try{const _0x5c624e=typeof _0x13c5e7===_0x23accf(0x1c2)?{'text':_0x13c5e7}:_0x13c5e7;if(Array[_0x23accf(0x1c5)](_0x4807b1)&&_0x4807b1['length'])_0x5c624e[_0x23accf(0x131)]=_0x4807b1;return await sendApi(_0x2a9938,_0x5c624e);}catch(_0x25b6c8){return warn('['+name+(']\x20sendText'+_0x23accf(0x100)+'\x20')+_0x2a9938+':\x20'+(_0x25b6c8?.[_0x23accf(0x18b)]||_0x25b6c8)),null;}}async function deleteMessage(_0x3c0502){const _0x281f9d=_0x20da03;if(!_0x3c0502||!_0x3c0502[_0x281f9d(0xfc)]||!_0x3c0502['id'])return;try{await sendApi(_0x3c0502[_0x281f9d(0xfc)],{'delete':_0x3c0502});}catch(_0x3b4e59){warn('['+name+(']\x20deleteMe'+_0x281f9d(0x170)+_0x281f9d(0x186))+_0x3c0502['id']+':\x20'+_0x3b4e59['message']);}}async function kickUser(_0x47bebe,_0x2798a0){const _0x67aff1=_0x20da03;try{const _0x7724b1=botRef['sock']?.[_0x67aff1(0x193)+_0x67aff1(0x10a)+_0x67aff1(0x139)]||botRef[_0x67aff1(0x193)+_0x67aff1(0x10a)+_0x67aff1(0x139)];if(_0x7724b1)return await _0x7724b1(_0x47bebe,[_0x2798a0],_0x67aff1(0x164)),info('['+name+_0x67aff1(0x123)+_0x2798a0+_0x67aff1(0x17c)+_0x47bebe),!![];return![];}catch(_0x87c13){return warn('['+name+(_0x67aff1(0x167)+_0x67aff1(0x128))+(_0x87c13?.[_0x67aff1(0x18b)]||_0x87c13)),![];}}async function getChatEnabled(_0x2381c2){const _0x30e8d6=_0x20da03;try{const _0x4ac43a=await db[_0x30e8d6(0x1bc)](_0x30e8d6(0x152)+'bled\x20FROM\x20'+TABLE_SETTINGS+(_0x30e8d6(0x19f)+_0x30e8d6(0x10c)),[_0x2381c2]);return _0x4ac43a?Number(_0x4ac43a[_0x30e8d6(0xf3)])===0x2414+-0x4*-0x36d+-0x31c7*0x1:![];}catch(_0x19f7d4){return warn('['+name+(_0x30e8d6(0x1af)+_0x30e8d6(0x1a6)+_0x30e8d6(0x145))+_0x2381c2+':\x20'+(_0x19f7d4?.[_0x30e8d6(0x18b)]||_0x19f7d4)),![];}}async function setChatEnabled(_0x1c1633,_0x431765){const _0x34be9f=_0x20da03;try{return await db[_0x34be9f(0x15e)](_0x34be9f(0x124)+'O\x20'+TABLE_SETTINGS+(_0x34be9f(0x166)+_0x34be9f(0x102)+_0x34be9f(0x151)+_0x34be9f(0x104)+_0x34be9f(0x142)+_0x34be9f(0x13e)+_0x34be9f(0x109)+_0x34be9f(0x149)+_0x34be9f(0xf0)+_0x34be9f(0x117)+_0x34be9f(0x107)),[_0x1c1633,_0x431765?0x1a*0x10d+-0x78d*0x1+-0x13c4:-0x488*-0x3+0x55+-0xded]),!![];}catch(_0x48d25d){return warn('['+name+(_0x34be9f(0x1c0)+'nabled\x20DB\x20'+_0x34be9f(0x145))+_0x1c1633+':\x20'+(_0x48d25d?.['message']||_0x48d25d)),![];}}function ensureChatMap(_0x5a8e13){const _0x4c68f9=_0x20da03;if(!chatUserMap[_0x4c68f9(0x15a)](_0x5a8e13))chatUserMap[_0x4c68f9(0x1a2)](_0x5a8e13,new Map());return chatUserMap[_0x4c68f9(0x1bc)](_0x5a8e13);}function clearChatMemory(_0x1267f0){const _0x4bad70=_0x20da03;if(chatUserMap[_0x4bad70(0x15a)](_0x1267f0))chatUserMap[_0x4bad70(0x195)](_0x1267f0);}function _0xd085(_0x2cf3e9,_0x2f8d8f){const _0x5d3d63=_0xb03a();return _0xd085=function(_0x258439,_0x3339ea){_0x258439=_0x258439-(0x2700+-0x1c63+-0x9af);let _0x336fc3=_0x5d3d63[_0x258439];return _0x336fc3;},_0xd085(_0x2cf3e9,_0x2f8d8f);}async function handleMessageForSpam(_0x132953){const _0x318dd0=_0x20da03;try{const _0x366acd=String(_0x132953['key']?.[_0x318dd0(0xfc)]||'');if(!_0x366acd||!_0x366acd[_0x318dd0(0x156)](_0x318dd0(0x174)))return;if(_0x132953['key']?.[_0x318dd0(0x19e)])return;const _0x56c2fd=await getChatEnabled(_0x366acd);if(!_0x56c2fd)return;const _0x18cf7a=String(_0x132953['key']?.[_0x318dd0(0xf7)+'t']||_0x132953[_0x318dd0(0xf5)]?.['from']||'');if(!_0x18cf7a)return;try{if(await isadmin(botRef,{'key':{'remoteJid':_0x366acd,'participant':_0x18cf7a},'message':_0x132953[_0x318dd0(0x18b)]}))return;}catch(_0xcdd7c1){}const _0x416751=Date['now'](),_0xd4eacb=ensureChatMap(_0x366acd);!_0xd4eacb[_0x318dd0(0x15a)](_0x18cf7a)&&_0xd4eacb[_0x318dd0(0x1a2)](_0x18cf7a,{'messages':[],'lastWarnAt':0x0,'warnCount':0x0,'warnExpiresAt':0x0});const _0x44c340=_0xd4eacb[_0x318dd0(0x1bc)](_0x18cf7a);_0x44c340[_0x318dd0(0x169)][_0x318dd0(0xff)]({'timestamp':_0x416751,'key':_0x132953[_0x318dd0(0xf5)]}),_0x44c340[_0x318dd0(0x169)]=_0x44c340[_0x318dd0(0x169)][_0x318dd0(0x1c6)](_0x4b4837=>_0x416751-_0x4b4837['timestamp']<=CFG[_0x318dd0(0x126)+_0x318dd0(0x155)]);if(_0x44c340['lastWarnAt']&&_0x416751-_0x44c340[_0x318dd0(0x135)]<CFG[_0x318dd0(0x105)+'OWN_MS'])return;if(_0x44c340[_0x318dd0(0x169)][_0x318dd0(0xf6)]>=CFG[_0x318dd0(0x161)+_0x318dd0(0x114)]){_0x44c340[_0x318dd0(0x135)]=_0x416751;const _0x58b53d=_0x44c340[_0x318dd0(0x169)][_0x318dd0(0x106)](_0x49258b=>_0x49258b[_0x318dd0(0xf5)]);_0x44c340['messages']=[];(!_0x44c340['warnExpire'+_0x318dd0(0x12e)]||_0x44c340[_0x318dd0(0x1a5)+_0x318dd0(0x12e)]<=_0x416751)&&(_0x44c340['warnCount']=0x39b*0x5+-0xa2d*0x3+0xc80);_0x44c340['warnCount']=(_0x44c340[_0x318dd0(0x10b)]||-0x203*0x6+0x52a*0x1+0x6e8)+(-0x1cb+-0x2d*-0x21+-0x29*0x19),_0x44c340[_0x318dd0(0x1a5)+_0x318dd0(0x12e)]=_0x416751+CFG['WARN_EXPIR'+_0x318dd0(0x197)];const _0x128e9d=Math[_0x318dd0(0xee)](-0xe3f*0x1+0x179e+-0x95f,CFG[_0x318dd0(0x162)+'GS']-_0x44c340[_0x318dd0(0x10b)]),_0x143135='@'+_0x18cf7a[_0x318dd0(0x143)]('@')[0x5a2*-0x3+0x237a+-0x4a5*0x4],_0x3225ea=String(CFG[_0x318dd0(0x146)+_0x318dd0(0x12c)]||'')['replace']('{user}',_0x143135)['replace'](_0x318dd0(0x138),String(_0x128e9d));for(const _0x3d2921 of _0x58b53d){await deleteMessage(_0x3d2921);}await new Promise(_0x3545a0=>setTimeout(_0x3545a0,0x3*-0x585+0x670*0x5+-0xb*0x155));const _0x1371bd=await sendText(_0x366acd,{'text':_0x3225ea,'mentions':[_0x18cf7a]});_0x1371bd?.[_0x318dd0(0xf5)]&&CFG[_0x318dd0(0x189)+'L_MS']>-0x8c*0x32+-0x2*0xa19+-0x1*-0x2f8a&&setTimeout(async()=>{const _0x304b2a=_0x318dd0;try{await sendText(_0x366acd,{'delete':_0x1371bd[_0x304b2a(0xf5)]});}catch(_0x4d21e3){}},CFG[_0x318dd0(0x189)+_0x318dd0(0xf4)]);if(CFG['KICK_ON_SP'+'AM']&&_0x44c340['warnCount']>=CFG[_0x318dd0(0x162)+'GS']){const _0xab0463=await kickUser(_0x366acd,_0x18cf7a);_0xab0463?(_0xd4eacb[_0x318dd0(0x195)](_0x18cf7a),await sendText(_0x366acd,{'text':_0x143135+('\x20removed\x20f'+'or\x20repeate'+_0x318dd0(0x1b9)),'mentions':[_0x18cf7a]})[_0x318dd0(0x157)](()=>{})):warn('['+name+(_0x318dd0(0x10d)+'o\x20kick\x20')+_0x18cf7a+_0x318dd0(0x17c)+_0x366acd);}}}catch(_0x6034e){warn('['+name+(_0x318dd0(0x11c)+_0x318dd0(0x11e)+_0x318dd0(0x144))+(_0x6034e?.[_0x318dd0(0x18b)]||_0x6034e));}}async function rawMessagesUpsertHandler({messages:_0x41657d}){const _0x28c11e=_0x20da03;if(!Array[_0x28c11e(0x1c5)](_0x41657d))return;for(const _0x780466 of _0x41657d){try{const _0x29719b=String(_0x780466[_0x28c11e(0xf5)]?.[_0x28c11e(0xfc)]||'');if(!_0x29719b||!_0x29719b[_0x28c11e(0x156)](_0x28c11e(0x174)))continue;if(!_0x780466['message'])continue;if(_0x780466[_0x28c11e(0xf5)]?.[_0x28c11e(0x19e)])continue;const _0x2797e3=_0x29719b+'::'+String(_0x780466[_0x28c11e(0xf5)]?.['id']||'')+'::'+String(_0x780466['key']?.['participan'+'t']||'');if(processedMessageKeys[_0x28c11e(0x15a)](_0x2797e3))continue;const _0x1292d3=setTimeout(()=>processedMessageKeys[_0x28c11e(0x195)](_0x2797e3),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x2797e3,_0x1292d3),await handleMessageForSpam(_0x780466);}catch(_0x3425c5){warn('['+name+(']\x20rawMessa'+_0x28c11e(0x125)+_0x28c11e(0x191)+_0x28c11e(0x12b))+(_0x3425c5?.['message']||_0x3425c5));}}}export async function onMessage(_0x487669,_0x81e822){const _0x3f4c8a=_0x20da03;try{if(!_0x487669||!_0x487669['key']||!_0x487669[_0x3f4c8a(0x18b)]||!_0x487669[_0x3f4c8a(0x148)]||!_0x81e822)return;const _0xc3389b=String(_0x487669[_0x3f4c8a(0xf5)][_0x3f4c8a(0xfc)]||'');if(!_0xc3389b[_0x3f4c8a(0x156)](_0x3f4c8a(0x174)))return;if(!_0x81e822[_0x3f4c8a(0x19a)])return;const _0x137e6d=typeof _0x487669[_0x3f4c8a(0x1b0)]===_0x3f4c8a(0x1c2)&&_0x487669[_0x3f4c8a(0x1b0)][_0x3f4c8a(0x1bb)]()[_0x3f4c8a(0xf6)]?_0x487669[_0x3f4c8a(0x1b0)][_0x3f4c8a(0x1bb)]():'';if(!_0x137e6d)return;const _0x3b57bb=_0x137e6d[_0x3f4c8a(0x143)](/\s+/)[_0x3f4c8a(0x1c6)](Boolean);if(!_0x3b57bb[_0x3f4c8a(0xf6)])return;const _0xc699b1=String(_0x3b57bb[-0x9d7+-0x197*0x1+0x85*0x16]||'')[_0x3f4c8a(0x180)+'e'](),_0xadb962=_0x3b57bb[_0x3f4c8a(0x188)](-0x7f2*-0x1+0x12a+-0x14d*0x7);if(!commands['includes'](_0xc699b1))return;if(_0xc699b1===_0x3f4c8a(0x11b)){const _0x4ff8f3=(_0xadb962[_0x3f4c8a(0x11a)](_0x1ce1f4=>['on',_0x3f4c8a(0x133),'show'][_0x3f4c8a(0x108)](String(_0x1ce1f4)[_0x3f4c8a(0x180)+'e']()))||'show')[_0x3f4c8a(0x180)+'e']();if(_0x4ff8f3==='on'){const _0x5733e0=await setChatEnabled(_0xc3389b,!![]);return _0x5733e0?(clearChatMemory(_0xc3389b),sendText(_0xc3389b,_0x3f4c8a(0x173)+_0x3f4c8a(0x1a7)+'for\x20this\x20g'+'roup.')):sendText(_0xc3389b,'⚠️\x20Failed\x20t'+_0x3f4c8a(0x182)+_0x3f4c8a(0x17e)+_0x3f4c8a(0x137));}else{if(_0x4ff8f3===_0x3f4c8a(0x133)){const _0x18e8b8=await setChatEnabled(_0xc3389b,![]);return _0x18e8b8?(clearChatMemory(_0xc3389b),sendText(_0xc3389b,_0x3f4c8a(0x173)+_0x3f4c8a(0x127)+'\x20for\x20this\x20'+'group.')):sendText(_0xc3389b,_0x3f4c8a(0x184)+_0x3f4c8a(0x1ad)+_0x3f4c8a(0x14e)+_0x3f4c8a(0x178)+'.');}else{const _0x4ad821=await getChatEnabled(_0xc3389b),_0x5e943e={'SPAM_THRESHOLD':CFG[_0x3f4c8a(0x161)+_0x3f4c8a(0x114)],'SPAM_WINDOW_MS':CFG[_0x3f4c8a(0x126)+_0x3f4c8a(0x155)],'SPAM_COOLDOWN_MS':CFG['SPAM_COOLD'+'OWN_MS'],'MAX_WARNINGS':CFG[_0x3f4c8a(0x162)+'GS'],'KICK_ON_SPAM':CFG[_0x3f4c8a(0x19c)+'AM']};return sendText(_0xc3389b,'✔️\x20Anti-spa'+_0x3f4c8a(0x12a)+_0x3f4c8a(0x1ae)+(_0x4ad821?_0x3f4c8a(0x13b):'DISABLED')+_0x3f4c8a(0x14c)+JSON[_0x3f4c8a(0x15c)](_0x5e943e));}}}if(_0xc699b1===_0x3f4c8a(0x11d)){const _0x5b5b9a=_0x487669[_0x3f4c8a(0x18b)]?.[_0x3f4c8a(0x103)+'xtMessage']?.[_0x3f4c8a(0x121)+'o']?.['mentionedJ'+'id']||[];if(!_0x5b5b9a||_0x5b5b9a[_0x3f4c8a(0xf6)]===0xc1+0x2*0xbc+-0x239)return sendText(_0xc3389b,_0x3f4c8a(0x168)+'mention\x20on'+_0x3f4c8a(0x16b)+_0x3f4c8a(0x136)+_0x3f4c8a(0x16c)+_0x3f4c8a(0x1c4)+_0x3f4c8a(0x14b));const _0x57d746=chatUserMap[_0x3f4c8a(0x1bc)](_0xc3389b);for(const _0xa82da9 of _0x5b5b9a){if(_0x57d746&&_0x57d746['has'](_0xa82da9))_0x57d746['delete'](_0xa82da9);}return sendText(_0xc3389b,_0x3f4c8a(0x173)+'m\x20warnings'+'\x20reset\x20for'+_0x3f4c8a(0x1a8)+'\x20user(s).');}}catch(_0xed9749){error(_0xed9749,'['+name+(']\x20onMessag'+_0x3f4c8a(0xf2))+(_0xed9749?.['message']||_0xed9749));}}export async function initialize(_0x5e219e){const _0x47c56a=_0x20da03;try{if(!_0x5e219e)throw new Error(_0x47c56a(0x165)+'nitialize\x20'+_0x47c56a(0x16a)+_0x47c56a(0x1c7)+'e');botRef=_0x5e219e,setupSendApi(),refreshConfig(),hotReloadConfig?.(refreshConfig),await ensureTables(),_0x5e219e['on']('messages.u'+_0x47c56a(0xf9),rawMessagesUpsertHandler),info('['+name+(']\x20initiali'+_0x47c56a(0x177)+_0x47c56a(0x181)+'cement.\x20DB'+_0x47c56a(0x116)+'y\x20')+TABLE_SETTINGS+(_0x47c56a(0x1a4)+'d=')+CFG['SPAM_THRES'+_0x47c56a(0x114)]+'\x20within\x20'+CFG['SPAM_WINDO'+'W_MS']+('ms,\x20maxWar'+_0x47c56a(0x13d))+CFG['MAX_WARNIN'+'GS']);}catch(_0x3edecb){error(_0x3edecb,'['+name+(_0x47c56a(0x18d)+_0x47c56a(0x110))+(_0x3edecb?.[_0x47c56a(0x18b)]||_0x3edecb));throw _0x3edecb;}}export async function cleanup(){const _0x1289a9=_0x20da03;try{botRef&&typeof botRef[_0x1289a9(0x133)]==='function'&&botRef[_0x1289a9(0x133)](_0x1289a9(0x18a)+_0x1289a9(0xf9),rawMessagesUpsertHandler);}catch(_0x3ebec0){warn('['+name+(_0x1289a9(0x1b2)+_0x1289a9(0xf8)+_0x1289a9(0x13c))+(_0x3ebec0?.[_0x1289a9(0x18b)]||_0x3ebec0));}for(const _0x311dc5 of processedMessageKeys[_0x1289a9(0x111)]())try{clearTimeout(_0x311dc5);}catch(_0x315aa7){}processedMessageKeys[_0x1289a9(0x176)](),chatUserMap[_0x1289a9(0x176)](),botRef=null,sendApi=null,info('['+name+(_0x1289a9(0x1a0)+'up.'));}export default{'name':name,'version':version,'priority':priority,'commands':commands,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};