const _0x139ce8=_0x3400;(function(_0x1b9a49,_0x53ec03){const _0x4cfe18=_0x3400,_0x264baa=_0x1b9a49();while(!![]){try{const _0x15021a=parseInt(_0x4cfe18(0x1e2))/(0x193c+-0x1*0x173+-0x17c8)+-parseInt(_0x4cfe18(0x1b9))/(-0x20e3+-0xa88+0x2b6d*0x1)+parseInt(_0x4cfe18(0x1b4))/(0x2*-0x51+0x1329+-0x4a1*0x4)+parseInt(_0x4cfe18(0x19f))/(-0x1bcc+0x2ca+0x1906)*(-parseInt(_0x4cfe18(0x1cb))/(0x3d8+-0x79*0x1a+0x877))+parseInt(_0x4cfe18(0x222))/(-0x152f+-0x1df6+0x332b)*(parseInt(_0x4cfe18(0x187))/(0x1e9d*-0x1+-0x2af+0x2153))+parseInt(_0x4cfe18(0x157))/(-0x5*-0x421+0x3fe+-0x189b)*(parseInt(_0x4cfe18(0x1e9))/(-0x23f4+0x1*-0x18d+0x5*0x782))+-parseInt(_0x4cfe18(0x1e7))/(0x15bd+0x389*0x3+-0x5*0x676);if(_0x15021a===_0x53ec03)break;else _0x264baa['push'](_0x264baa['shift']());}catch(_0xc9e152){_0x264baa['push'](_0x264baa['shift']());}}}(_0x4a93,0x34da+0x2d*0x5995+-0x528d8));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{isadmin}from'../utils/isadmin.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';import{getConfig,hotReloadConfig}from'../utils/config.js';export const name=_0x139ce8(0x153);export const version=_0x139ce8(0x16e)+_0x139ce8(0x217);export const priority=0x90d*-0x4+0x753*-0x4+0x41da;export const commands=['antispam',_0x139ce8(0x17f)];export const configKeys=[_0x139ce8(0x1df)];let botRef=null,sendApi=null;const chatUserMap=new Map(),processedMessageKeys=new Map(),DEDUPE_TTL_MS=(0x2dd*-0x7+-0xfe*-0x1+-0x2bd*-0x7)*(0x1*-0x1c63+0x106e+0xfdd),CFG={'SPAM_THRESHOLD':0x6,'SPAM_WINDOW_MS':(-0x1104+0x533+0xbdb)*(0xee+-0x333+0x1f*0x33),'SPAM_COOLDOWN_MS':0x3e8,'MAX_WARNINGS':0x3,'WARN_EXPIRY_MS':(0x1*0x481+-0x386*0xb+0x2248)*(0x130e+-0x2b6*0x1+-0x410*0x4)*(-0x33d*0x7+-0x2c3*0x1+0x19aa)*(-0x1d03*0x1+0xe51+-0xb6*-0x15)*(0x12ce+0xb1*-0x5+-0x1d*0x65),'KICK_ON_SPAM':!![],'WARNING_MESSAGE':_0x139ce8(0x219)+_0x139ce8(0x1a2)+_0x139ce8(0x15b)+_0x139ce8(0x1a4)+_0x139ce8(0x1a8)+_0x139ce8(0x186),'WARNING_TTL_MS':0xc350};function _0x4a93(){const _0x2d5420=['e\x20error:\x20','nabled\x20DB\x20','2332336ChxtUn','\x20warnings.',']\x20Ensuring','get','ing.\x20Remai','string','\x20for\x20this\x20','fromMe','ite_master','OWN_MS','DISABLED','name','->\x20chat_ji','th\x20expecte','table\x20','\x20(chat_id\x20',']\x20cleaned\x20','ICT(chat_j','SELECT\x20nam','{warnings}','L_MS','m\x20warnings','ATE\x20SET\x20en','2.0.0-inme','r\x20failed:\x20','forEach','PRAGMA\x20tab','@g.us','SACTION;','m\x20for\x20this','enabled','off','from','W_MS',']\x20stopMana','up.','SPAM_WINDO','error\x20for\x20','for\x20this\x20g','group.','resetspam','zed.\x20In-me','\x20LIMIT\x201','o\x20create\x20','⚠️\x20Failed\x20t','find','\x20group:\x20','ings}','7WGhRcb','exec','length','o\x20kick\x20','INSERT\x20OR\x20','participan','not\x20availa','message','ze\x20fatal:\x20','filter','max',']\x20Migrated','\x200\x20FROM\x20','o\x20enable\x20a','am\x20error:\x20','anti-spam\x20','rows','chat_id','\x20TEXT\x20PRIM','cipantsUpd','text','\x20from\x20','\x20\x20ON\x20CONFL','KICK_ON_SP','24tIcINo','d\x20spam.','_new\x20(chat','stop\x20spamm','e=\x27table\x27\x20','ning\x20warni','extendedTe','\x20user(s).','run','ngs:\x20{warn','SELECT\x20*\x20F',']\x20Ensured\x20','\x20enabled\x20F','trim','r:\x20',']\x20initiali','sts(','_new\x20RENAM','andler\x20inn','Y_MS','WARNING_ME','112821mmAgfR',')\x20error:\x20','_jid\x20TEXT\x20','\x20reset\x20for',']\x20sendText','220534lAMBEW','ROM\x20','e\x20or\x20more\x20',']\x20setChatE','ALTER\x20TABL','includes','messages.u','toLowerCas','.\x20Threshol','\x20VALUES\x20(?','ARY\x20KEY,\x20e','SELECT\x20ena','spam_setti','remoteJid','set','EGER);','Y,\x20enabled','REPLACE\x20IN','262915ZoJaKx','catch','\x20within\x20',',\x20enabled)',':\x20sendApi\x20','CREATE\x20TAB','T\x20chat_id,','cid','groupParti','_jid,\x20enab','timestamps','m\x20ENABLED\x20','\x0aConfig:\x20','stringify','led)\x20SELEC','SPAM_COOLD','✔️\x20Anti-spa','\x20anti-spam','psert','LE\x20IF\x20NOT\x20','SPAM','show','HOLD','844945VQCOwW','has','SSAGE','sock',']\x20kicked\x20','12757690ycrpvu','mentions','36RWpTop','antispam.i','SPAM_THRES','INSERT\x20INT','mory\x20enfor','E\x20TO\x20','DROP\x20TABLE','remove',']\x20Failed\x20t','EXISTS\x20','delete','ot\x20instanc','le_info(','ms,\x20maxWar','ate','nabled\x20INT','er\x20error:\x20','id)\x20DO\x20UPD','sendMessag','\x20mentioned','COMMIT;','\x20failed:\x20',']\x20failed\x20t','\x20exists\x20wi','warnCount','\x20failed\x20to','PRIMARY\x20KE','t_jid\x20=\x20?','ngs','lastWarnAt','WARNING_TT','function','ssageForSp',']\x20onMessag','{user}','error:\x20','users\x20to\x20r','isArray','\x20(chat_jid','d\x20columns.','column_nam','warnExpire','values','\x20removed\x20f','keys','ble','mory','ENABLED','⚠️\x20{user},\x20',']\x20migrateS','map','contextInf','clear','\x20WHERE\x20typ','key','ROLLBACK;','chat_jid','2161158eQiScS','pamSetting','bled\x20FROM\x20','bled;','split',']\x20Migratio','gesUpsertH','sAt',']\x20kickUser','mention\x20on','MAX_WARNIN','requires\x20b','WARN_EXPIR','antispam','n\x20of\x20'];_0x4a93=function(){return _0x2d5420;};return _0x4a93();}function refreshConfig(){const _0x311ac9=_0x139ce8;try{const _0x129eb7=getConfig?.()?.['SPAM']||{};Object[_0x311ac9(0x215)](CFG)[_0x311ac9(0x170)](_0x1ac6ef=>{if(_0x129eb7[_0x1ac6ef]!==undefined)CFG[_0x1ac6ef]=_0x129eb7[_0x1ac6ef];}),CFG['SPAM_THRES'+'HOLD']=Math[_0x311ac9(0x191)](0x2*-0x20+-0x1fc*0x6+0xc29*0x1,Number(CFG[_0x311ac9(0x1eb)+'HOLD'])||0x1fe0+-0x2657+0x67d),CFG['SPAM_WINDO'+'W_MS']=Math[_0x311ac9(0x191)](-0x1a99*-0x1+-0x1293+-0x806,Number(CFG['SPAM_WINDO'+_0x311ac9(0x178)])||(-0x192f*-0x1+0x10f*-0x17+-0xcc)*(-0x1621+0x172*0x2+0xf*0x18b)),CFG[_0x311ac9(0x1da)+_0x311ac9(0x160)]=Math[_0x311ac9(0x191)](0x687*-0x5+0x19e4+0x9d*0xb,Number(CFG[_0x311ac9(0x1da)+_0x311ac9(0x160)])||-0x1ad+-0x1*0xf22+-0x1*-0x14b7),CFG[_0x311ac9(0x150)+'GS']=Math[_0x311ac9(0x191)](0x1204+0x2a0+-0x14a3,Number(CFG[_0x311ac9(0x150)+'GS'])||-0x8c6+-0xbb7+0x4*0x520),CFG[_0x311ac9(0x152)+_0x311ac9(0x1b2)]=Math['max'](-0x7*-0x115+0x47b+-0xc0e,Number(CFG[_0x311ac9(0x152)+'Y_MS'])||(0x1ada+-0x2700*0x1+0xc2d)*(0x234c+0x791+-0x2ac5*0x1)*(0x11f5*-0x1+0x77a+0xab7*0x1)*(-0xeb1*0x1+0x1*0x8a6+0x647)*(-0xa2f*0x1+-0x2225*0x1+0x303c)),CFG[_0x311ac9(0x207)+_0x311ac9(0x16b)]=Math[_0x311ac9(0x191)](-0x1633*0x1+-0x1*0xb25+0x2158,Number(CFG[_0x311ac9(0x207)+_0x311ac9(0x16b)])||0x12611+-0x16d47+-0x10a86*-0x1),CFG[_0x311ac9(0x19e)+'AM']=!!CFG[_0x311ac9(0x19e)+'AM'];}catch(_0x42b75c){warn('['+name+(']\x20refreshC'+'onfig\x20erro'+_0x311ac9(0x1ad))+(_0x42b75c?.[_0x311ac9(0x18e)]||_0x42b75c));}}const TABLE_SETTINGS=_0x139ce8(0x1c5)+_0x139ce8(0x205);async function tableExists(_0x18f45e){const _0x1ab059=_0x139ce8;try{const _0x5798e0=await db[_0x1ab059(0x15a)](_0x1ab059(0x169)+'e\x20FROM\x20sql'+_0x1ab059(0x15f)+_0x1ab059(0x21e)+_0x1ab059(0x1a3)+'AND\x20name=?',[_0x18f45e]);return!!_0x5798e0;}catch(_0x359988){return warn('['+name+(']\x20tableExi'+_0x1ab059(0x1af))+_0x18f45e+_0x1ab059(0x1b5)+(_0x359988?.[_0x1ab059(0x18e)]||_0x359988)),![];}}async function getTableColumns(_0x1cda14){const _0xa7d130=_0x139ce8;try{const _0x301d09=await db[_0xa7d130(0x188)](_0xa7d130(0x171)+_0xa7d130(0x1f5)+_0x1cda14+');'),_0x1aa75f=Array[_0xa7d130(0x20e)](_0x301d09)?_0x301d09:_0x301d09&&_0x301d09[_0xa7d130(0x197)]?_0x301d09[_0xa7d130(0x197)]:[];return _0x1aa75f['map'](_0x562af9=>_0x562af9[_0xa7d130(0x162)]||_0x562af9[_0xa7d130(0x211)+'e']||_0x562af9[_0xa7d130(0x1d2)]);}catch(_0x31e6cb){try{const _0x9ba741=await db[_0xa7d130(0x15a)](_0xa7d130(0x1a9)+_0xa7d130(0x1ba)+_0x1cda14+'\x20LIMIT\x201');return _0x9ba741?Object[_0xa7d130(0x215)](_0x9ba741):[];}catch(_0x22b4b2){return[];}}}async function migrateSpamSettingsIfNeeded(){const _0x5a100c=_0x139ce8,_0x28a15f=await tableExists(TABLE_SETTINGS);if(!_0x28a15f)try{await db['exec'](_0x5a100c(0x1d0)+_0x5a100c(0x1de)+_0x5a100c(0x1f2)+TABLE_SETTINGS+('\x20(chat_jid'+'\x20TEXT\x20PRIM'+_0x5a100c(0x1c3)+_0x5a100c(0x1f8)+'EGER);')),info('['+name+(']\x20Created\x20'+_0x5a100c(0x165))+TABLE_SETTINGS);return;}catch(_0x5684d3){warn('['+name+(_0x5a100c(0x1f1)+_0x5a100c(0x182))+TABLE_SETTINGS+':\x20'+(_0x5684d3?.['message']||_0x5684d3));return;}try{const _0x3f2fc0=await db[_0x5a100c(0x188)](_0x5a100c(0x171)+_0x5a100c(0x1f5)+TABLE_SETTINGS+');');let _0x2d8e19=[];if(Array[_0x5a100c(0x20e)](_0x3f2fc0))_0x2d8e19=_0x3f2fc0['map'](_0x1baa8b=>_0x1baa8b[_0x5a100c(0x162)]||_0x1baa8b[0x1f86+-0x336+-0x1c4f])['filter'](Boolean);else{if(_0x3f2fc0&&Array[_0x5a100c(0x20e)](_0x3f2fc0[_0x5a100c(0x197)]))_0x2d8e19=_0x3f2fc0[_0x5a100c(0x197)][_0x5a100c(0x21b)](_0x5b7192=>_0x5b7192[_0x5a100c(0x162)])[_0x5a100c(0x190)](Boolean);else try{const _0x2de51d=await db['get']('SELECT\x20*\x20F'+'ROM\x20'+TABLE_SETTINGS+_0x5a100c(0x181));_0x2d8e19=_0x2de51d?Object[_0x5a100c(0x215)](_0x2de51d):[];}catch(_0x3417f9){_0x2d8e19=[];}}const _0x2608e4=_0x2d8e19[_0x5a100c(0x21b)](_0x14d8ec=>String(_0x14d8ec)[_0x5a100c(0x1c0)+'e']()),_0x3210c8=_0x2608e4[_0x5a100c(0x1be)](_0x5a100c(0x221)),_0x4f35f5=_0x2608e4[_0x5a100c(0x1be)](_0x5a100c(0x175)),_0x4ad5fe=_0x2608e4[_0x5a100c(0x1be)](_0x5a100c(0x198));if(_0x3210c8&&_0x4f35f5)return;if(!_0x3210c8&&_0x4ad5fe)try{await db[_0x5a100c(0x188)]('BEGIN\x20TRAN'+_0x5a100c(0x173)),await db[_0x5a100c(0x188)](_0x5a100c(0x1d0)+_0x5a100c(0x1de)+_0x5a100c(0x1f2)+TABLE_SETTINGS+(_0x5a100c(0x1a1)+_0x5a100c(0x1b6)+_0x5a100c(0x203)+_0x5a100c(0x1c9)+'\x20INTEGER);'));const _0x4511aa=_0x4f35f5;_0x4511aa?await db[_0x5a100c(0x188)]('INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO\x20'+TABLE_SETTINGS+(_0x5a100c(0x1a1)+_0x5a100c(0x1d4)+_0x5a100c(0x1d9)+_0x5a100c(0x1d1)+_0x5a100c(0x1ab)+_0x5a100c(0x1ba))+TABLE_SETTINGS+';'):await db[_0x5a100c(0x188)](_0x5a100c(0x18b)+_0x5a100c(0x1ca)+'TO\x20'+TABLE_SETTINGS+(_0x5a100c(0x1a1)+_0x5a100c(0x1d4)+_0x5a100c(0x1d9)+_0x5a100c(0x1d1)+_0x5a100c(0x193))+TABLE_SETTINGS+';');await db['exec'](_0x5a100c(0x1ef)+'\x20'+TABLE_SETTINGS+';'),await db[_0x5a100c(0x188)](_0x5a100c(0x1bd)+'E\x20'+TABLE_SETTINGS+(_0x5a100c(0x1b0)+_0x5a100c(0x1ee))+TABLE_SETTINGS+';'),await db['exec'](_0x5a100c(0x1fd)),info('['+name+(_0x5a100c(0x192)+'\x20')+TABLE_SETTINGS+(_0x5a100c(0x166)+_0x5a100c(0x163)+'d)'));return;}catch(_0x1734a4){try{await db['exec'](_0x5a100c(0x220));}catch(_0x1ca881){}warn('['+name+(_0x5a100c(0x227)+_0x5a100c(0x154))+TABLE_SETTINGS+_0x5a100c(0x1fe)+(_0x1734a4?.['message']||_0x1734a4));return;}if(!_0x3210c8||!_0x4f35f5)try{await db[_0x5a100c(0x188)](_0x5a100c(0x1d0)+_0x5a100c(0x1de)+_0x5a100c(0x1f2)+TABLE_SETTINGS+('\x20(chat_jid'+_0x5a100c(0x199)+_0x5a100c(0x1c3)+_0x5a100c(0x1f8)+_0x5a100c(0x1c8))),info('['+name+_0x5a100c(0x1aa)+TABLE_SETTINGS+(_0x5a100c(0x200)+_0x5a100c(0x164)+_0x5a100c(0x210)));}catch(_0xc5ceeb){warn('['+name+(_0x5a100c(0x159)+'\x20')+TABLE_SETTINGS+('\x20columns\x20f'+'ailed:\x20')+(_0xc5ceeb?.[_0x5a100c(0x18e)]||_0xc5ceeb));}}catch(_0x2d9c42){warn('['+name+(_0x5a100c(0x21a)+_0x5a100c(0x223)+'sIfNeeded\x20'+_0x5a100c(0x20c))+(_0x2d9c42?.['message']||_0x2d9c42));}}async function ensureTables(){await migrateSpamSettingsIfNeeded();}function setupSendApi(){const _0x22a063=_0x139ce8;if(!botRef)return;if(typeof botRef[_0x22a063(0x1fb)+'e']==='function')sendApi=async(_0x2d7ab5,_0x66fbdd)=>await botRef['sendMessag'+'e'](_0x2d7ab5,_0x66fbdd);else{if(botRef[_0x22a063(0x1e5)]&&typeof botRef[_0x22a063(0x1e5)][_0x22a063(0x1fb)+'e']===_0x22a063(0x208))sendApi=async(_0x3c6208,_0x493297)=>await botRef[_0x22a063(0x1e5)]['sendMessag'+'e'](_0x3c6208,_0x493297);else sendApi=null;}}async function sendText(_0x4a7a15,_0x26784e,_0x41caf5=[]){const _0x4555bd=_0x139ce8;if(!_0x26784e||!_0x4a7a15)return null;if(!sendApi)return warn('['+name+(_0x4555bd(0x1b8)+_0x4555bd(0x1cf)+_0x4555bd(0x18d)+_0x4555bd(0x216))),null;try{const _0xa04f3=typeof _0x26784e===_0x4555bd(0x15c)?{'text':_0x26784e}:_0x26784e;if(Array[_0x4555bd(0x20e)](_0x41caf5)&&_0x41caf5[_0x4555bd(0x189)])_0xa04f3[_0x4555bd(0x1e8)]=_0x41caf5;return await sendApi(_0x4a7a15,_0xa04f3);}catch(_0x418a19){return warn('['+name+(_0x4555bd(0x1b8)+_0x4555bd(0x202)+'\x20')+_0x4a7a15+':\x20'+(_0x418a19?.[_0x4555bd(0x18e)]||_0x418a19)),null;}}async function kickUser(_0x153dae,_0x476648){const _0x27331b=_0x139ce8;try{const _0x448bc7=botRef[_0x27331b(0x1e5)]?.[_0x27331b(0x1d3)+'cipantsUpd'+_0x27331b(0x1f7)]||botRef['groupParti'+_0x27331b(0x19a)+'ate'];if(_0x448bc7)return await _0x448bc7(_0x153dae,[_0x476648],_0x27331b(0x1f0)),info('['+name+_0x27331b(0x1e6)+_0x476648+_0x27331b(0x19c)+_0x153dae),!![];return![];}catch(_0x14c231){return warn('['+name+(_0x27331b(0x22a)+_0x27331b(0x1fe))+(_0x14c231?.[_0x27331b(0x18e)]||_0x14c231)),![];}}async function getChatEnabled(_0x19a62b){const _0x3920ed=_0x139ce8;try{const _0x3a1cc7=await db[_0x3920ed(0x15a)](_0x3920ed(0x1c4)+_0x3920ed(0x224)+TABLE_SETTINGS+('\x20WHERE\x20cha'+_0x3920ed(0x204)),[_0x19a62b]);return _0x3a1cc7?Number(_0x3a1cc7[_0x3920ed(0x175)])===-0x20*0x4e+0x8b1+-0x110*-0x1:![];}catch(_0x43211f){return warn('['+name+(']\x20getChatE'+_0x3920ed(0x156)+_0x3920ed(0x17c))+_0x19a62b+':\x20'+(_0x43211f?.['message']||_0x43211f)),![];}}async function setChatEnabled(_0x91bbf4,_0x8d06ea){const _0x1c418b=_0x139ce8;try{return await db[_0x1c418b(0x1a7)](_0x1c418b(0x1ec)+'O\x20'+TABLE_SETTINGS+(_0x1c418b(0x20f)+_0x1c418b(0x1ce)+_0x1c418b(0x1c2)+',\x20?)\x20\x0a\x20\x20\x20\x20'+_0x1c418b(0x19d)+_0x1c418b(0x168)+_0x1c418b(0x1fa)+_0x1c418b(0x16d)+'abled\x20=\x20ex'+'cluded.ena'+_0x1c418b(0x225)),[_0x91bbf4,_0x8d06ea?-0x1df0+0x1e93+-0xa2:-0x1ae7+-0xb0*0x1c+0x2e27]),!![];}catch(_0x5ded68){return warn('['+name+(_0x1c418b(0x1bc)+_0x1c418b(0x156)+_0x1c418b(0x17c))+_0x91bbf4+':\x20'+(_0x5ded68?.[_0x1c418b(0x18e)]||_0x5ded68)),![];}}function _0x3400(_0x322bba,_0x46e90e){const _0x3802c0=_0x4a93();return _0x3400=function(_0xbee75d,_0x3e5db3){_0xbee75d=_0xbee75d-(0x2*-0x706+0x1945*-0x1+-0x28a1*-0x1);let _0x56c01d=_0x3802c0[_0xbee75d];return _0x56c01d;},_0x3400(_0x322bba,_0x46e90e);}function ensureChatMap(_0x54649e){const _0x38915b=_0x139ce8;if(!chatUserMap[_0x38915b(0x1e3)](_0x54649e))chatUserMap[_0x38915b(0x1c7)](_0x54649e,new Map());return chatUserMap[_0x38915b(0x15a)](_0x54649e);}function clearChatMemory(_0x2c0bdb){const _0x1b3854=_0x139ce8;if(chatUserMap['has'](_0x2c0bdb))chatUserMap[_0x1b3854(0x1f3)](_0x2c0bdb);}async function handleMessageForSpam(_0x5c03be){const _0x8204=_0x139ce8;try{const _0x2af933=String(_0x5c03be['key']?.[_0x8204(0x1c6)]||'');if(!_0x2af933||!_0x2af933['endsWith'](_0x8204(0x172)))return;if(_0x5c03be[_0x8204(0x21f)]?.['fromMe'])return;const _0xac0c20=await getChatEnabled(_0x2af933);if(!_0xac0c20)return;const _0x2dbffe=String(_0x5c03be['key']?.[_0x8204(0x18c)+'t']||_0x5c03be[_0x8204(0x21f)]?.[_0x8204(0x177)]||'');if(!_0x2dbffe)return;try{if(await isadmin(botRef,{'key':{'remoteJid':_0x2af933,'participant':_0x2dbffe},'message':_0x5c03be[_0x8204(0x18e)]}))return;}catch(_0x4168f9){}const _0x3df427=Date['now'](),_0x4dbfea=ensureChatMap(_0x2af933);!_0x4dbfea[_0x8204(0x1e3)](_0x2dbffe)&&_0x4dbfea[_0x8204(0x1c7)](_0x2dbffe,{'timestamps':[],'lastWarnAt':0x0,'warnCount':0x0,'warnExpiresAt':0x0});const _0x4be457=_0x4dbfea['get'](_0x2dbffe);_0x4be457[_0x8204(0x1d5)]=(_0x4be457['timestamps']||[])[_0x8204(0x190)](_0x440ff2=>_0x3df427-_0x440ff2<=CFG['SPAM_WINDO'+_0x8204(0x178)]),_0x4be457[_0x8204(0x1d5)]['push'](_0x3df427);if(_0x4be457['lastWarnAt']&&_0x3df427-_0x4be457['lastWarnAt']<CFG[_0x8204(0x1da)+'OWN_MS'])return;if((_0x4be457[_0x8204(0x1d5)]||[])[_0x8204(0x189)]>=CFG[_0x8204(0x1eb)+_0x8204(0x1e1)]){_0x4be457[_0x8204(0x206)]=_0x3df427;(!_0x4be457['warnExpire'+_0x8204(0x229)]||_0x4be457[_0x8204(0x212)+'sAt']<=_0x3df427)&&(_0x4be457['warnCount']=-0xb1*0x29+-0xe4d+0x2aa6);_0x4be457['warnCount']=(_0x4be457[_0x8204(0x201)]||-0xf*0x20e+0x1a20+-0x2*-0x259)+(-0x242f+0x16b0+0xd80),_0x4be457['warnExpire'+_0x8204(0x229)]=_0x3df427+CFG[_0x8204(0x152)+'Y_MS'];const _0x29af27=Math['max'](-0x6f1*-0x1+0x2376+-0x2a67*0x1,CFG['MAX_WARNIN'+'GS']-_0x4be457[_0x8204(0x201)]),_0x27e948='@'+_0x2dbffe[_0x8204(0x226)]('@')[0x1*-0x224d+-0x1fa6+0x41f3],_0x3ad381=String(CFG[_0x8204(0x1b3)+_0x8204(0x1e4)]||'')['replace'](_0x8204(0x20b),_0x27e948)['replace'](_0x8204(0x16a),String(_0x29af27)),_0x47585f=await sendText(_0x2af933,{'text':_0x3ad381,'mentions':[_0x2dbffe]});_0x47585f?.[_0x8204(0x21f)]&&CFG[_0x8204(0x207)+'L_MS']>-0x257f*-0x1+-0x39*0xd+-0x229a&&setTimeout(async()=>{const _0x2629fe=_0x8204;try{await sendText(_0x2af933,{'delete':_0x47585f[_0x2629fe(0x21f)]});}catch(_0x557f9b){}},CFG[_0x8204(0x207)+_0x8204(0x16b)]);if(CFG[_0x8204(0x19e)+'AM']&&_0x4be457[_0x8204(0x201)]>=CFG['MAX_WARNIN'+'GS']){const _0x39287a=await kickUser(_0x2af933,_0x2dbffe);_0x39287a?(_0x4dbfea[_0x8204(0x1f3)](_0x2dbffe),await sendText(_0x2af933,{'text':_0x27e948+(_0x8204(0x214)+'or\x20repeate'+_0x8204(0x1a0)),'mentions':[_0x2dbffe]})[_0x8204(0x1cc)](()=>{})):warn('['+name+(_0x8204(0x1ff)+_0x8204(0x18a))+_0x2dbffe+_0x8204(0x19c)+_0x2af933);}}}catch(_0xedf77b){warn('['+name+(']\x20handleMe'+_0x8204(0x209)+_0x8204(0x195))+(_0xedf77b?.[_0x8204(0x18e)]||_0xedf77b));}}async function rawMessagesUpsertHandler({messages:_0x566425}){const _0x2e58f0=_0x139ce8;if(!Array['isArray'](_0x566425))return;for(const _0x1cbfbf of _0x566425){try{const _0x5c86a7=String(_0x1cbfbf[_0x2e58f0(0x21f)]?.[_0x2e58f0(0x1c6)]||'');if(!_0x5c86a7||!_0x5c86a7['endsWith']('@g.us'))continue;if(!_0x1cbfbf[_0x2e58f0(0x18e)])continue;if(_0x1cbfbf['key']?.[_0x2e58f0(0x15e)])continue;const _0x641fd8=_0x5c86a7+'::'+String(_0x1cbfbf[_0x2e58f0(0x21f)]?.['id']||'')+'::'+String(_0x1cbfbf['key']?.[_0x2e58f0(0x18c)+'t']||'');if(processedMessageKeys[_0x2e58f0(0x1e3)](_0x641fd8))continue;const _0x600d3e=setTimeout(()=>processedMessageKeys[_0x2e58f0(0x1f3)](_0x641fd8),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x641fd8,_0x600d3e),await handleMessageForSpam(_0x1cbfbf);}catch(_0x518bd4){warn('['+name+(']\x20rawMessa'+_0x2e58f0(0x228)+_0x2e58f0(0x1b1)+_0x2e58f0(0x1f9))+(_0x518bd4?.[_0x2e58f0(0x18e)]||_0x518bd4));}}}export async function onMessage(_0x588b58){const _0x516c83=_0x139ce8;try{if(!_0x588b58||!_0x588b58['key']||!_0x588b58['message']||!_0x588b58['isCommand'])return;const _0x49ac83=String(_0x588b58['key'][_0x516c83(0x1c6)]||'');if(!_0x49ac83['endsWith'](_0x516c83(0x172)))return;if(!await isadmin(botRef,_0x588b58))return;const _0x97444d=typeof _0x588b58['text']==='string'&&_0x588b58[_0x516c83(0x19b)]['trim']()[_0x516c83(0x189)]?_0x588b58[_0x516c83(0x19b)][_0x516c83(0x1ac)]():'';if(!_0x97444d)return;const _0xf212b1=_0x97444d[_0x516c83(0x226)](/\s+/)[_0x516c83(0x190)](Boolean);if(!_0xf212b1[_0x516c83(0x189)])return;const _0x438f0b=String(_0xf212b1[-0x59*0x22+0x1*0x1b2b+-0xf59*0x1]||'')['toLowerCas'+'e'](),_0x44881d=_0xf212b1['slice'](0x1a9+0x23*-0x35+0x597);if(!commands[_0x516c83(0x1be)](_0x438f0b))return;if(_0x438f0b==='antispam'){const _0x24b0e5=(_0x44881d[_0x516c83(0x184)](_0x2625cf=>['on',_0x516c83(0x176),_0x516c83(0x1e0)]['includes'](String(_0x2625cf)[_0x516c83(0x1c0)+'e']()))||_0x516c83(0x1e0))[_0x516c83(0x1c0)+'e']();if(_0x24b0e5==='on'){const _0x4f5ed0=await setChatEnabled(_0x49ac83,!![]);return _0x4f5ed0?(clearChatMemory(_0x49ac83),sendText(_0x49ac83,_0x516c83(0x1db)+_0x516c83(0x1d6)+_0x516c83(0x17d)+'roup.')):sendText(_0x49ac83,_0x516c83(0x183)+_0x516c83(0x194)+'nti-spam\x20('+'DB\x20error).');}else{if(_0x24b0e5===_0x516c83(0x176)){const _0x35ee88=await setChatEnabled(_0x49ac83,![]);return _0x35ee88?(clearChatMemory(_0x49ac83),sendText(_0x49ac83,_0x516c83(0x1db)+'m\x20DISABLED'+_0x516c83(0x15d)+_0x516c83(0x17e))):sendText(_0x49ac83,_0x516c83(0x183)+'o\x20disable\x20'+_0x516c83(0x196)+'(DB\x20error)'+'.');}else{const _0x52bbcf=await getChatEnabled(_0x49ac83),_0x1191ce={'SPAM_THRESHOLD':CFG['SPAM_THRES'+_0x516c83(0x1e1)],'SPAM_WINDOW_MS':CFG[_0x516c83(0x17b)+_0x516c83(0x178)],'SPAM_COOLDOWN_MS':CFG['SPAM_COOLD'+_0x516c83(0x160)],'MAX_WARNINGS':CFG[_0x516c83(0x150)+'GS'],'KICK_ON_SPAM':CFG['KICK_ON_SP'+'AM']};return sendText(_0x49ac83,_0x516c83(0x1db)+_0x516c83(0x174)+_0x516c83(0x185)+(_0x52bbcf?_0x516c83(0x218):_0x516c83(0x161))+_0x516c83(0x1d7)+JSON[_0x516c83(0x1d8)](_0x1191ce));}}}if(_0x438f0b===_0x516c83(0x17f)){const _0x2ec37b=_0x588b58[_0x516c83(0x18e)]?.[_0x516c83(0x1a5)+'xtMessage']?.[_0x516c83(0x21c)+'o']?.['mentionedJ'+'id']||[];if(!_0x2ec37b||_0x2ec37b['length']===-0x31*0xc1+-0x9b9*0x1+0x2eaa)return sendText(_0x49ac83,'✔️\x20Please\x20@'+_0x516c83(0x22b)+_0x516c83(0x1bb)+_0x516c83(0x20d)+'eset\x20their'+_0x516c83(0x1dc)+_0x516c83(0x158));const _0x1bcfa4=chatUserMap[_0x516c83(0x15a)](_0x49ac83);for(const _0x466ad3 of _0x2ec37b){if(_0x1bcfa4&&_0x1bcfa4[_0x516c83(0x1e3)](_0x466ad3))_0x1bcfa4[_0x516c83(0x1f3)](_0x466ad3);}return sendText(_0x49ac83,_0x516c83(0x1db)+_0x516c83(0x16c)+_0x516c83(0x1b7)+_0x516c83(0x1fc)+_0x516c83(0x1a6));}}catch(_0x373dae){error(_0x373dae,'['+name+(_0x516c83(0x20a)+_0x516c83(0x155))+(_0x373dae?.[_0x516c83(0x18e)]||_0x373dae));}}export async function initialize(_0x1c4cac){const _0x1bb711=_0x139ce8;try{if(!_0x1c4cac)throw new Error(_0x1bb711(0x1ea)+'nitialize\x20'+_0x1bb711(0x151)+_0x1bb711(0x1f4)+'e');botRef=_0x1c4cac,setupSendApi(),refreshConfig(),hotReloadConfig?.(refreshConfig),await ensureTables(),startManagedListener({'botRef':botRef,'eventName':_0x1bb711(0x1bf)+_0x1bb711(0x1dd),'handler':rawMessagesUpsertHandler,'moduleName':name}),info('['+name+(_0x1bb711(0x1ae)+_0x1bb711(0x180)+_0x1bb711(0x1ed)+'cement.\x20DB'+'\x20holds\x20onl'+'y\x20')+TABLE_SETTINGS+(_0x1bb711(0x1c1)+'d=')+CFG[_0x1bb711(0x1eb)+_0x1bb711(0x1e1)]+_0x1bb711(0x1cd)+CFG[_0x1bb711(0x17b)+_0x1bb711(0x178)]+(_0x1bb711(0x1f6)+'ns=')+CFG['MAX_WARNIN'+'GS']);}catch(_0x35958f){error(_0x35958f,'['+name+(_0x1bb711(0x1ae)+_0x1bb711(0x18f))+(_0x35958f?.[_0x1bb711(0x18e)]||_0x35958f));throw _0x35958f;}}export async function cleanup(){const _0x2988fb=_0x139ce8;try{stopManagedListener(name,_0x2988fb(0x1bf)+'psert');}catch(_0x359931){warn('['+name+(_0x2988fb(0x179)+'gedListene'+_0x2988fb(0x16f))+(_0x359931?.[_0x2988fb(0x18e)]||_0x359931));}for(const _0x426528 of processedMessageKeys[_0x2988fb(0x213)]())try{clearTimeout(_0x426528);}catch(_0x477247){}processedMessageKeys[_0x2988fb(0x21d)](),chatUserMap['clear'](),botRef=null,sendApi=null,info('['+name+(_0x2988fb(0x167)+_0x2988fb(0x17a)));}export default{'name':name,'version':version,'priority':priority,'commands':commands,'configKeys':configKeys,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};