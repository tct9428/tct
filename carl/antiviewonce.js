const _0x51bcd3=_0xd243;(function(_0x2990e3,_0x3b64da){const _0x2e41be=_0xd243,_0x56fe22=_0x2990e3();while(!![]){try{const _0x30498a=parseInt(_0x2e41be(0xf6))/(0x2585+0x1*0x1229+-0x37ad)+parseInt(_0x2e41be(0xff))/(0x14*-0x5f+-0x2373+0x2ae1)*(-parseInt(_0x2e41be(0x18e))/(0x298*-0x2+-0x1631+0x1b64))+parseInt(_0x2e41be(0x1b7))/(-0x187a+0x126a+0x614)*(-parseInt(_0x2e41be(0xd7))/(-0x21e*0x4+-0x9c7*-0x1+-0x14a))+parseInt(_0x2e41be(0x126))/(-0x4c8+0x115*-0x19+0x1fdb)*(parseInt(_0x2e41be(0xee))/(0x69+0x140f+0x1471*-0x1))+parseInt(_0x2e41be(0x187))/(-0x14b4+-0x342+-0x17fe*-0x1)+parseInt(_0x2e41be(0x173))/(-0x354+-0x5*0x4dc+-0x61*-0x49)+-parseInt(_0x2e41be(0x13e))/(0x1ed4+0x5*-0x37d+-0x43*0x33);if(_0x30498a===_0x3b64da)break;else _0x56fe22['push'](_0x56fe22['shift']());}catch(_0x5eaad6){_0x56fe22['push'](_0x56fe22['shift']());}}}(_0x3fea,0x3*-0x76292+0x7a441+0x1d5cfe));function _0xd243(_0x12ee03,_0x4547ff){_0x12ee03=_0x12ee03-(-0x109*0x9+0x1*0x472+0x591);const _0xef6851=_0x3fea();let _0x485497=_0xef6851[_0x12ee03];return _0x485497;}import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';export const name='viewonce';export const version=_0x51bcd3(0x188);export const priority=0x1431+0x1ede+-0x32b0;export const commands=[_0x51bcd3(0xce)];export const configKeys=[_0x51bcd3(0x10f)+_0x51bcd3(0x192)+_0x51bcd3(0xf8)+_0x51bcd3(0x168),_0x51bcd3(0x17f)+_0x51bcd3(0x125)+_0x51bcd3(0x1a7)+_0x51bcd3(0x128)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x12ce3c=_0x51bcd3;try{const _0x501d5b=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x501d5b[_0x12ce3c(0x10f)+_0x12ce3c(0x192)+'GET_EQUALS'+'_SOURCE']!==undefined?Boolean(_0x501d5b[_0x12ce3c(0x10f)+'KIP_IF_TAR'+'GET_EQUALS'+'_SOURCE']):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x501d5b['VIEWONCE_A'+_0x12ce3c(0x125)+'_COMMANDS_'+_0x12ce3c(0x128)]??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(_0x12ce3c(0x1b8)+_0x12ce3c(0x16d)));}catch(_0x10cfea){warn('['+name+(_0x12ce3c(0x129)+_0x12ce3c(0x10a)+_0x12ce3c(0x143))+(_0x10cfea?.[_0x12ce3c(0x196)]||_0x10cfea));}}try{hotReloadConfig&&hotReloadConfig((_0x51e0e8=[])=>{const _0x318b0a=_0x51bcd3,_0x31275b=['VIEWONCE_S'+_0x318b0a(0x192)+_0x318b0a(0xf8)+_0x318b0a(0x168),_0x318b0a(0x17f)+_0x318b0a(0x125)+_0x318b0a(0x1a7)+_0x318b0a(0x128)];if((_0x51e0e8||[])[_0x318b0a(0xfc)](_0x178f8e=>_0x31275b[_0x318b0a(0xb9)](_0x178f8e)))refreshConfig();});}catch(_0x493ad1){warn('['+name+(_0x51bcd3(0x10e)+_0x51bcd3(0x13c)+_0x51bcd3(0x1ac)+_0x51bcd3(0x160))+(_0x493ad1?.[_0x51bcd3(0x196)]||_0x493ad1));}refreshConfig();async function ensureSchema(){const _0x3dada1=_0x51bcd3;try{await db[_0x3dada1(0x1c2)](_0x3dada1(0x1ad)+_0x3dada1(0xd2)+_0x3dada1(0x19b)+_0x3dada1(0xd6)+_0x3dada1(0xd5)+_0x3dada1(0x199)+'ey\x20TEXT\x20PR'+_0x3dada1(0x1a2)+_0x3dada1(0x134)+_0x3dada1(0xed)+_0x3dada1(0x176)+_0x3dada1(0xb6)+'dated_at\x20I'+'NTEGER\x20DEF'+_0x3dada1(0x156)+_0x3dada1(0x12c));try{const _0x33cd39=await db[_0x3dada1(0x1bc)](_0x3dada1(0x112)+'ue\x20FROM\x20vi'+_0x3dada1(0x198)+_0x3dada1(0xc0)+_0x3dada1(0x183));MODE=_0x33cd39?.[_0x3dada1(0x17a)]==='g'?'g':'p';}catch(_0x3ebc51){}try{const _0x2e9f11=await db[_0x3dada1(0x1bc)](_0x3dada1(0x112)+_0x3dada1(0x144)+_0x3dada1(0x198)+'fs\x20WHERE\x20k'+_0x3dada1(0x1a4)+'_jid\x27');TARGET_JID=_0x2e9f11?.[_0x3dada1(0x17a)]||null;}catch(_0x3c9577){TARGET_JID=null;}try{const _0x519936=await db['get']('SELECT\x20val'+_0x3dada1(0x144)+_0x3dada1(0x198)+_0x3dada1(0xc0)+'ey=\x27allow_'+_0x3dada1(0x109)+'ands\x27');ALLOW_GROUP_COMMANDS=_0x519936?.[_0x3dada1(0x17a)]==='1';}catch(_0x4a157b){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x1a4f8c=await db['get'](_0x3dada1(0x112)+'ue\x20FROM\x20vi'+_0x3dada1(0x198)+_0x3dada1(0xc0)+_0x3dada1(0x181)+'_viewonce\x27');NOTIFY_VIEWONCE=_0x1a4f8c?.[_0x3dada1(0x17a)]==='1';}catch(_0x2394e0){NOTIFY_VIEWONCE=![];}info('['+name+(']\x20DB\x20ready'+_0x3dada1(0xf1))+MODE+',\x20target='+(TARGET_JID||_0x3dada1(0x132))+_0x3dada1(0x16a)+NOTIFY_VIEWONCE+(_0x3dada1(0x154)+_0x3dada1(0x11d)+_0x3dada1(0xc4))+ALLOW_GROUP_COMMANDS+')');}catch(_0xb6b5b3){error(_0xb6b5b3,'['+name+(_0x3dada1(0x19c)+_0x3dada1(0x106)+'d'));throw _0xb6b5b3;}}async function savePref(_0x304a48,_0x1af673){const _0xeff142=_0x51bcd3;try{const _0x424f2e=Math[_0xeff142(0x193)](Date[_0xeff142(0xe1)]()/(0x8aa+-0xb4b+0x1*0x689));await db[_0xeff142(0x13d)]('INSERT\x20INT'+_0xeff142(0x11b)+'_prefs\x20(ke'+_0xeff142(0x116)+'dated_at)\x20'+'VALUES\x20(?,'+'\x20?,\x20?)\x20ON\x20'+_0xeff142(0xb7)+_0xeff142(0xe5)+'ATE\x20SET\x20va'+_0xeff142(0x15e)+'ed.value,\x20'+_0xeff142(0x110)+_0xeff142(0xe0)+_0xeff142(0x110),[_0x304a48,_0x1af673,_0x424f2e]);}catch(_0x3027d1){return warn('['+name+(_0xeff142(0xc5)+_0xeff142(0x12f)+_0xeff142(0xbb)+'r\x20')+_0x304a48+'='+_0x1af673+_0xeff142(0x1aa)+(_0x3027d1?.[_0xeff142(0x196)]||_0x3027d1)),![];}try{const _0x16aa36=await db[_0xeff142(0x1bc)](_0xeff142(0x112)+_0xeff142(0x144)+_0xeff142(0x198)+'fs\x20WHERE\x20k'+_0xeff142(0x16f),[_0x304a48]),_0x5a5cd6=_0x16aa36?.['value']??_0x1af673;if(_0x304a48==='mode')MODE=_0x5a5cd6==='g'?'g':'p';if(_0x304a48===_0xeff142(0x164))TARGET_JID=_0x5a5cd6||null;if(_0x304a48===_0xeff142(0xe7)+_0xeff142(0xef))ALLOW_GROUP_COMMANDS=_0x5a5cd6==='1';if(_0x304a48===_0xeff142(0xbe)+_0xeff142(0xc6))NOTIFY_VIEWONCE=_0x5a5cd6==='1';return info('['+name+(_0xeff142(0x161)+_0xeff142(0xf9)+'ded:\x20')+_0x304a48+'='+_0x5a5cd6),!![];}catch(_0x2c3cb1){warn('['+name+(']\x20savePref'+_0xeff142(0x14e)+_0xeff142(0x17c)+'\x20failed\x20fo'+'r\x20')+_0x304a48+'='+_0x1af673+_0xeff142(0x1aa)+(_0x2c3cb1?.[_0xeff142(0x196)]||_0x2c3cb1));if(_0x304a48===_0xeff142(0xde))MODE=_0x1af673==='g'?'g':'p';if(_0x304a48===_0xeff142(0x164))TARGET_JID=_0x1af673||null;if(_0x304a48===_0xeff142(0xe7)+_0xeff142(0xef))ALLOW_GROUP_COMMANDS=_0x1af673==='1';if(_0x304a48===_0xeff142(0xbe)+_0xeff142(0xc6))NOTIFY_VIEWONCE=_0x1af673==='1';return!![];}}function normalizeToUserJid(_0x272b2f){const _0xb919d2=_0x51bcd3;try{if(!_0x272b2f||typeof _0x272b2f!==_0xb919d2(0x146))return _0x272b2f;const _0x4b570a=_0x272b2f['indexOf']('@');if(_0x4b570a===-(-0x1*0x652+-0x1053+0x2*0xb53))return _0x272b2f;const _0x37404e=_0x272b2f[_0xb919d2(0x167)](-0x24a6*-0x1+-0xdd+-0x1*0x23c9,_0x4b570a),_0x32205a=_0x272b2f[_0xb919d2(0x167)](_0x4b570a),_0x1905d8=_0x37404e[_0xb919d2(0xc8)](':');if(_0x1905d8===-(-0xa0c+0x48a+0x583))return _0x272b2f;return _0x37404e[_0xb919d2(0x167)](-0x1*-0x25d7+0x1433+-0x22*0x1b5,_0x1905d8)+_0x32205a;}catch(_0x36ba08){return _0x272b2f;}}async function trySend(_0x41aa93,_0x48b0e5){const _0x1408ac=_0x51bcd3;try{const _0x18d699=normalizeToUserJid(String(_0x41aa93));if(!_0x18d699)throw new Error(_0x1408ac(0x142)+_0x1408ac(0x14d));if(typeof botRef?.[_0x1408ac(0x19a)+'e']===_0x1408ac(0x11f)){await botRef[_0x1408ac(0x19a)+'e'](_0x18d699,_0x48b0e5);return;}if(botRef?.['sock']&&typeof botRef['sock']['sendMessag'+'e']===_0x1408ac(0x11f)){await botRef['sock']['sendMessag'+'e'](_0x18d699,_0x48b0e5);return;}throw new Error(_0x1408ac(0x14c)+_0x1408ac(0x165)+_0x1408ac(0xba));}catch(_0x4e86c4){throw _0x4e86c4;}}const DEDUPE_TTL_MS=(-0x1a*0x1d+0x1a97*0x1+0x179b*-0x1)*(0x1ef3+-0x17fa+-0x5*0x9d),processedKeys=new Map();function markProcessed(_0x397f0a){const _0x102c33=_0x51bcd3;if(!_0x397f0a)return;if(processedKeys[_0x102c33(0x108)](_0x397f0a))try{clearTimeout(processedKeys[_0x102c33(0x1bc)](_0x397f0a));}catch(_0x2fd1e6){}const _0x1558b6=setTimeout(()=>processedKeys[_0x102c33(0x11e)](_0x397f0a),DEDUPE_TTL_MS);processedKeys['set'](_0x397f0a,_0x1558b6);}function isProcessed(_0x5f5b17){const _0x25a500=_0x51bcd3;return _0x5f5b17&&processedKeys[_0x25a500(0x108)](_0x5f5b17);}function extractContextInfo(_0x29047b){const _0x166fac=_0x51bcd3;if(!_0x29047b||!_0x29047b['message'])return null;const _0xf08234=_0x29047b['message'];return _0xf08234[_0x166fac(0x1a9)+_0x166fac(0x1a5)]?.[_0x166fac(0x147)+'o']||_0xf08234[_0x166fac(0x147)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x445686){const _0x5bf0a3=_0x51bcd3;if(!_0x445686)return null;return _0x445686?.[_0x5bf0a3(0xf0)+'ssage']?.[_0x5bf0a3(0x196)]||_0x445686?.[_0x5bf0a3(0xf0)+_0x5bf0a3(0x172)]?.[_0x5bf0a3(0x196)]||(_0x445686[_0x5bf0a3(0x159)+'ge']?_0x445686:null)||(_0x445686[_0x5bf0a3(0xfe)+'ge']?_0x445686:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x3d44c5){const _0x1939d1=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x3d44c5)return _0x1939d1;return TARGET_JID;}return _0x1939d1;}function _0x3fea(){const _0x962f=['\x20notify\x20on','some','quotedMess','videoMessa','158536Leevdq','\x20Notificat','notify',']\x20Sent\x20rec','ned\x20false','underscore','ble;\x20falli','hema\x20faile','\x20clear\x20tar','has','group_comm','onfig\x20erro','et\x20JID:\x20','ia\x20buffer','ions\x20set\x20t',']\x20hotReloa','VIEWONCE_S','updated_at','ssage','SELECT\x20val','ttonId','push','@g.us','y,value,up','\x20p|g`\x0a','eo\x20to\x20','in\x20a\x20view-','*Notificat','O\x20viewonce','singleSele','oup_comman','delete','function','get\x20JID.','pushName','sertSingle','message\x20th','error:\x20','LLOW_GROUP','6oRpMew','o\x20download','DEFAULT',']\x20refreshC','ponseMessa','\x27\x20(undersc','\x20\x20\x20);\x0a\x20\x20\x20\x20','JID\x20set.','isArray',':\x20DB\x20write','ly)*\x0a\x0a','\x20Failed\x20to','unset','age','\x0a\x20\x20\x20\x20\x20\x20\x20\x20v','wId',']\x20notify\x20s','psert','selectedBu','t\x20supporte','Recovered\x0a','e\x20<jid>`\x0a','dConfig\x20re','run','34116030ogOsNe','\x20view-once','ndler\x20erro','image','no\x20send\x20ta','r:\x20','ue\x20FROM\x20vi','overed\x20vid','string','contextInf','nitialize\x20','ream','selectedRo','text','no\x20sendMes','rget',':\x20reload\x20a','\x20in\x20','olved','ot\x20instanc','mmand\x20erro','et*:\x20',',\x20allow_gr','isViewOnce','AULT\x200\x0a\x20\x20\x20','adcast','tempt\x20reco','imageMessa','concat','applicatio','set','remoteJid','lue=exclud','\x20that\x20mess','\x20failed:\x20',']\x20pref\x20sav','requires\x20b','\x20Mode\x20set\x20','target_jid','sage\x20avail','bin','slice','_SOURCE','zed\x20(centr',',\x20notify=','\x20inner\x20med','\x20save\x20noti','efreshed',']\x20quoted\x20v','ey=?','D\x20cleared.',']\x20no\x20confi','ssageV2','17482284cicsUV','fromMe','iew-once\x20i','NOT\x20NULL,\x0a',']\x20cleanup\x20','to\x20GROUP.\x20','hat\x20*start','value','ument\x20to\x20','fter\x20write',']\x20handleCo',']\x20upsertHa','VIEWONCE_A','[viewonce]','ey=\x27notify','nation\x20res','ey=\x27mode\x27','\x20ctx.key.r','\x20Target\x20JI','to\x20PM.','12443272JAGufH','2.1.0',':\x20reply\x20to','Configured','ecoveredTo','ctReply','toLowerCas','24QbYBim','n/octet-st','ge\x20to\x20','e\x20handler\x20','KIP_IF_TAR','floor','\x20`viewonce','d\x20unavaila','message',']\x20no\x20desti','ewonce_pre','\x0a\x20\x20\x20\x20\x20\x20\x20\x20k','sendMessag','IF\x20NOT\x20EXI',']\x20ensureSc','with\x20\x27_\x27\x20(','\x20the\x20view-','\x20cleaned\x20u','unknown\x20ch','listRespon','IMARY\x20KEY,','key','ey=\x27target','xtMessage','Not\x20set','_COMMANDS_','length','extendedTe','\x20â€”\x20','video','gistration','\x0a\x20\x20\x20\x20\x20\x20CRE',']\x20Reply\x20st','status@bro','D\x20saved:\x20','rget\x20-\x20abo','\x20set\x20mode.','\x0a\x0afrom:\x20','*Anti-View','nner\x20is\x20no','ge\x20with\x20a\x20','1200tKjRVt',']\x20config\x20r','ions\x20are\x20c',']\x20getBotJi','group','get','clear','D*:\x20`','\x20-\x20attempt','rmation\x20ta','\x20message\x20t','exec','rting\x20comm','add','ng\x20back\x20to','d\x20media\x20ty','\x20\x20\x20\x20\x20\x20\x20\x20up','CONFLICT(k','ing\x20recove','includes','able','\x20failed\x20fo',']\x20initiali','remove','notify_vie','split','fs\x20WHERE\x20k','once\x20inner','and','endsWith','ds=',']\x20savePref','wonce',']\x20forwardR','indexOf','\x20save\x20targ','caption','urrently\x20*','o\x20*','true','viewonce','seMessage','trim','Content\x20er','ATE\x20TABLE\x20',']\x20handleUp','\x20in\x20chat\x20','ce_prefs\x20(','STS\x20viewon','11555METAML','To\x20recover','once\x20Setti','\x20of\x20view-o','messages.u','conversati',']\x20download','mode','\x20not\x20conta','=excluded.','now','emoteJid','No\x20target\x20','gifPlaybac','ey)\x20DO\x20UPD','*Send\x20Targ','allow_grou','not\x20set','arts\x20with\x20',']\x20onMessag','participan',']\x20Notified','alue\x20TEXT\x20','6552406PbfaOs','p_commands','viewOnceMe','\x20(mode=','OFF','\x20group:\x20','age\x20with\x20a','charAt','1278297gfinXi','essage\x20did','GET_EQUALS','ed\x20&\x20reloa','catch'];_0x3fea=function(){return _0x962f;};return _0x3fea();}function stripDomain(_0x1d248c){const _0x4b9687=_0x51bcd3;if(!_0x1d248c||typeof _0x1d248c!==_0x4b9687(0x146))return _0x1d248c;const _0x6e0ff8=_0x1d248c['indexOf']('@');if(_0x6e0ff8===-(-0x10*0x22+-0x12da+-0x29*-0x83))return _0x1d248c;return _0x1d248c['slice'](0xa7*0xa+0x1754+-0x1dda,_0x6e0ff8);}async function handleUpsertSingle(_0x3a7404){const _0x3b5ac0=_0x51bcd3;try{if(!_0x3a7404||!_0x3a7404['key'])return;if(_0x3a7404[_0x3b5ac0(0x1a3)]?.[_0x3b5ac0(0x15d)]===_0x3b5ac0(0x1af)+_0x3b5ac0(0x157))return;if(Boolean(_0x3a7404[_0x3b5ac0(0x1a3)]?.[_0x3b5ac0(0x174)]))return;const _0xfa4e8d=String(_0x3a7404['key'][_0x3b5ac0(0x15d)]||'')+'::'+String(_0x3a7404[_0x3b5ac0(0x1a3)]['id']||'');if(isProcessed(_0xfa4e8d))return;markProcessed(_0xfa4e8d);const _0x58f9b5=Boolean(_0x3a7404['key']?.[_0x3b5ac0(0x155)]),_0x15215d=Boolean(_0x3a7404['message']?.[_0x3b5ac0(0xf0)+_0x3b5ac0(0x111)]||_0x3a7404[_0x3b5ac0(0x196)]?.[_0x3b5ac0(0xf0)+'ssageV2']);if(!_0x58f9b5&&!_0x15215d)return;if(!NOTIFY_VIEWONCE)return;const _0x2742bf=_0x3a7404[_0x3b5ac0(0x121)]||_0x3a7404[_0x3b5ac0(0x1a3)]?.[_0x3b5ac0(0xeb)+'t']||_0x3a7404['key']?.[_0x3b5ac0(0x15d)]||null,_0x149951=_0x2742bf?stripDomain(String(_0x2742bf)):'unknown',_0x3b728d=_0x3a7404[_0x3b5ac0(0x1a3)]?.[_0x3b5ac0(0x15d)]?stripDomain(_0x3a7404[_0x3b5ac0(0x1a3)][_0x3b5ac0(0x15d)]):_0x3b5ac0(0x1a0)+'at',_0x1b3174=resolveDestination(_0x3a7404[_0x3b5ac0(0x1a3)]?.['remoteJid']);if(!_0x1b3174)return;const _0x567dfe='ðŸ‘ï¸\x20Detected'+_0x3b5ac0(0x13f)+'\x20from\x20'+_0x149951+_0x3b5ac0(0xd4)+_0x3b728d+('.\x0aReply\x20to'+_0x3b5ac0(0x15f)+_0x3b5ac0(0xf4)+_0x3b5ac0(0x1c1)+_0x3b5ac0(0x179)+'s\x20with*\x20\x27_'+_0x3b5ac0(0x12b)+'ore)\x20to\x20at'+_0x3b5ac0(0x158)+'very.');try{await trySend(_0x1b3174,{'text':_0x567dfe}),info('['+name+(_0x3b5ac0(0xec)+'\x20')+_0x1b3174+(_0x3b5ac0(0xda)+'nce\x20from\x20')+_0x149951+_0x3b5ac0(0x14f)+_0x3b728d);}catch(_0x5a0fe0){warn('['+name+(_0x3b5ac0(0x136)+'end\x20failed'+':\x20')+(_0x5a0fe0?.['message']||_0x5a0fe0));}}catch(_0x24910f){warn('['+name+(_0x3b5ac0(0xd3)+_0x3b5ac0(0x122)+'\x20error:\x20')+(_0x24910f?.[_0x3b5ac0(0x196)]||_0x24910f));}}async function upsertHandler({messages:_0x481a4b}){const _0x2838d6=_0x51bcd3;try{if(!Array[_0x2838d6(0x12e)](_0x481a4b))return;for(const _0x375b49 of _0x481a4b)await handleUpsertSingle(_0x375b49);}catch(_0x37f5cd){warn('['+name+(_0x2838d6(0x17e)+_0x2838d6(0x140)+_0x2838d6(0x143))+(_0x37f5cd?.[_0x2838d6(0x196)]||_0x37f5cd));}}async function downloadBufferFromContent(_0x21d916,_0x219750){const _0xa0d9b1=_0x51bcd3;try{if(!_0x21d916||!_0x219750)return null;const _0x278d32=await downloadContentFromMessage(_0x21d916,_0x219750);if(!_0x278d32)return null;const _0x2b25b6=[];for await(const _0x4b6ba4 of _0x278d32){_0x2b25b6[_0xa0d9b1(0x114)](_0x4b6ba4);}if(!_0x2b25b6[_0xa0d9b1(0x1a8)])return null;return Buffer[_0xa0d9b1(0x15a)](_0x2b25b6);}catch(_0xd5627){return warn('['+name+(_0xa0d9b1(0xdd)+'BufferFrom'+_0xa0d9b1(0xd1)+'ror:\x20')+(_0xd5627?.[_0xa0d9b1(0x196)]||_0xd5627)),null;}}async function forwardRecoveredToDest(_0x556528,_0x2182f2,_0xc16189,_0x3e37aa){const _0x24f804=_0x51bcd3,_0x2bd2ba=resolveDestination(_0xc16189);if(!_0x2bd2ba)return warn('['+name+(_0x24f804(0x197)+_0x24f804(0x182)+_0x24f804(0x150))),![];try{const _0x204325=_0x556528?.[_0x24f804(0x159)+'ge']?.['caption']||_0x556528?.['videoMessa'+'ge']?.[_0x24f804(0xca)]||'',_0x21db65=_0x3e37aa?stripDomain(_0x3e37aa):'unknown\x20us'+'er',_0x36e249=_0xc16189?stripDomain(_0xc16189):_0x24f804(0x1a0)+'at',_0x16e51d=_0x24f804(0x1b3)+_0x21db65+'\x20in\x20'+_0x36e249,_0x41ea33='View-Once\x20'+_0x24f804(0x13a)+_0x204325+_0x16e51d;if(_0x556528['imageMessa'+'ge'])return await trySend(_0x2bd2ba,{'image':_0x2182f2,'caption':_0x41ea33}),info('['+name+(']\x20Sent\x20rec'+'overed\x20ima'+_0x24f804(0x190))+_0x2bd2ba),!![];if(_0x556528['videoMessa'+'ge']){const _0xfde86a=Boolean(_0x556528[_0x24f804(0xfe)+'ge']?.[_0x24f804(0xe4)+'k']);return await trySend(_0x2bd2ba,{'video':_0x2182f2,'caption':_0x41ea33,'gifPlayback':_0xfde86a}),info('['+name+(_0x24f804(0x102)+_0x24f804(0x145)+_0x24f804(0x118))+_0x2bd2ba),!![];}return await trySend(_0x2bd2ba,{'document':_0x2182f2,'fileName':'recovered.'+_0x24f804(0x166),'mimetype':_0x24f804(0x15b)+_0x24f804(0x18f)+_0x24f804(0x149),'caption':_0x41ea33}),info('['+name+(']\x20Sent\x20rec'+'overed\x20doc'+_0x24f804(0x17b))+_0x2bd2ba),!![];}catch(_0x5d00be){return warn('['+name+(_0x24f804(0xc7)+'ecoveredTo'+'Dest\x20faile'+'d:\x20')+(_0x5d00be?.[_0x24f804(0x196)]||_0x5d00be)),![];}}function extractTextFromCtx(_0x19dac8){const _0x42d886=_0x51bcd3;if(!_0x19dac8||!_0x19dac8['message'])return'';const _0x3ac915=_0x19dac8['message'];return _0x3ac915[_0x42d886(0xdc)+'on']||_0x3ac915[_0x42d886(0x1a9)+'xtMessage']?.['text']||_0x3ac915[_0x42d886(0x159)+'ge']?.['caption']||_0x3ac915['videoMessa'+'ge']?.['caption']||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0xa0a+-0x582+0xfaa)*(-0x62+0x129d+-0xe53);function markCmdProcessed(_0x447598){const _0x4ab1e1=_0x51bcd3;if(!_0x447598)return;if(processedCmdKeys[_0x4ab1e1(0x108)](_0x447598))try{clearTimeout(processedCmdKeys['get'](_0x447598));}catch(_0x280d7d){};const _0x39cb47=setTimeout(()=>processedCmdKeys['delete'](_0x447598),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x4ab1e1(0x15c)](_0x447598,_0x39cb47);}function isCmdProcessed(_0x367c95){return _0x367c95&&processedCmdKeys['has'](_0x367c95);}const recentResponded=new Set();export async function onMessage(_0x3420df){const _0x14617e=_0x51bcd3;try{if(!_0x3420df||!_0x3420df[_0x14617e(0x1a3)]||!_0x3420df[_0x14617e(0x196)])return;const _0x149616=_0x3420df[_0x14617e(0x1a3)]?.['id']||null;if(_0x149616){if(recentResponded[_0x14617e(0x108)](_0x149616))return;recentResponded[_0x14617e(0xb3)](_0x149616),setTimeout(()=>recentResponded['delete'](_0x149616),(-0x31*0x5b+-0x401*-0x5+-0x25e)*(0x42*-0x12+-0x1*0x1829+-0xae7*-0x3));}if(_0x3420df['isCommand']){const _0x5847bf=_0x3420df['key'][_0x14617e(0x15d)],_0x598aa1=typeof _0x5847bf==='string'&&_0x5847bf[_0x14617e(0xc3)](_0x14617e(0x115));if(_0x598aa1&&!ALLOW_GROUP_COMMANDS){}else{const _0x3cb75d=Boolean(_0x3420df[_0x14617e(0x1a3)][_0x14617e(0x174)]);if(!_0x598aa1&&!_0x3cb75d){const _0x245cb6=await isSudo(botRef,_0x3420df)[_0x14617e(0xfa)](()=>![]);if(!_0x245cb6){}else await handleCommand(_0x3420df)['catch'](_0x437372=>warn('['+name+(']\x20command\x20'+_0x14617e(0x124))+(_0x437372?.[_0x14617e(0x196)]||_0x437372)));}else{const _0x3a8c95=await isSudo(botRef,_0x3420df)[_0x14617e(0xfa)](()=>![]),_0x455268=Boolean(_0x3420df[_0x14617e(0x1a3)][_0x14617e(0x174)]);(_0x455268||_0x3a8c95)&&await handleCommand(_0x3420df)['catch'](_0x3d3960=>warn('['+name+(']\x20command\x20'+'error:\x20')+(_0x3d3960?.[_0x14617e(0x196)]||_0x3d3960)));}}}const _0x354913=extractContextInfo(_0x3420df);if(!_0x354913||!_0x354913[_0x14617e(0xfd)+_0x14617e(0x133)])return;const _0x2e603a=extractTextFromCtx(_0x3420df)||'';if(!_0x2e603a)return;const _0x58b5a1=_0x2e603a[_0x14617e(0xd0)]()[_0x14617e(0xf5)](0x115+0x8*-0x4af+-0x2463*-0x1);if(_0x58b5a1!=='_')return;info('['+name+(_0x14617e(0x1ae)+_0x14617e(0xe9)+_0x14617e(0x104)+_0x14617e(0x1bf)+_0x14617e(0xb8)+'ry'));const _0x2f0590=extractViewOnceInnerFromQuoted(_0x354913[_0x14617e(0xfd)+_0x14617e(0x133)]);if(!_0x2f0590){warn('['+name+(']\x20quoted\x20m'+_0x14617e(0xf7)+_0x14617e(0xdf)+_0x14617e(0x119)+_0x14617e(0xc1)+'\x20message'));return;}let _0x501fee=null,_0x8d9a65=null;if(_0x2f0590[_0x14617e(0x159)+'ge'])_0x501fee=_0x2f0590[_0x14617e(0x159)+'ge'],_0x8d9a65=_0x14617e(0x141);else _0x2f0590[_0x14617e(0xfe)+'ge']&&(_0x501fee=_0x2f0590[_0x14617e(0xfe)+'ge'],_0x8d9a65=_0x14617e(0x1ab));if(!_0x501fee||!_0x8d9a65){warn('['+name+(_0x14617e(0x16e)+_0x14617e(0x175)+_0x14617e(0x1b5)+_0x14617e(0x139)+_0x14617e(0xb5)+'pe'));return;}const _0x5a8f57=await downloadBufferFromContent(_0x501fee,_0x8d9a65);if(!_0x5a8f57){warn('['+name+(']\x20failed\x20t'+_0x14617e(0x127)+_0x14617e(0x16b)+_0x14617e(0x10c)));return;}const _0x2f2742=_0x3420df['key']['remoteJid']||null,_0x5eb327=_0x354913[_0x14617e(0xeb)+'t']||null,_0x163f62=await forwardRecoveredToDest(_0x2f0590,_0x5a8f57,_0x2f2742,_0x5eb327);if(!_0x163f62)warn('['+name+(_0x14617e(0xc7)+_0x14617e(0x18b)+'Dest\x20retur'+_0x14617e(0x103)));}catch(_0xe701ac){error(_0xe701ac,'['+name+(_0x14617e(0xea)+_0x14617e(0x191)+_0x14617e(0x124))+(_0xe701ac?.['message']||_0xe701ac));}}async function handleCommand(_0x529326){const _0x2262b6=_0x51bcd3;try{if(!_0x529326||!_0x529326[_0x2262b6(0x1a3)]||!_0x529326[_0x2262b6(0x196)])return;const _0x25c1d8=_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0x15d)],_0x22744b=typeof _0x25c1d8===_0x2262b6(0x146)&&_0x25c1d8[_0x2262b6(0xc3)](_0x2262b6(0x115));if(_0x22744b&&!ALLOW_GROUP_COMMANDS)return;const _0x12c6c2=Boolean(_0x529326['key'][_0x2262b6(0x174)]);if(!_0x22744b&&!_0x12c6c2){const _0xecd57=await isSudo(botRef,_0x529326)[_0x2262b6(0xfa)](()=>![]);if(!_0xecd57)return;}const _0x210184=Boolean(_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0x174)]),_0x25a3bb=await isSudo(botRef,_0x529326)[_0x2262b6(0xfa)](()=>![]);let _0x2294c6;if(_0x210184)_0x2294c6=getBotJid()||_0x529326['key'][_0x2262b6(0x15d)]||_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0xeb)+'t']||null,!_0x2294c6&&(warn('['+name+(_0x2262b6(0x1ba)+_0x2262b6(0x195)+_0x2262b6(0x105)+_0x2262b6(0xb4)+_0x2262b6(0x184)+_0x2262b6(0xe2))),_0x2294c6=_0x529326[_0x2262b6(0x1a3)]['remoteJid']||null);else{if(_0x25a3bb)_0x2294c6=_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0x15d)];else return;}if(!_0x2294c6){warn('['+name+(_0x2262b6(0x171)+_0x2262b6(0x1c0)+_0x2262b6(0x1b1)+_0x2262b6(0xb2)+_0x2262b6(0xc2)));return;}const _0x347fe4=String(_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0x15d)]||'')+'::'+String(_0x529326[_0x2262b6(0x1a3)]['id']||_0x529326[_0x2262b6(0x1a3)][_0x2262b6(0xeb)+'t']||'');if(isCmdProcessed(_0x347fe4))return;markCmdProcessed(_0x347fe4);const _0x2d51bd=typeof _0x529326[_0x2262b6(0x14b)]==='string'&&_0x529326[_0x2262b6(0x14b)][_0x2262b6(0xd0)]()[_0x2262b6(0x1a8)]?_0x529326[_0x2262b6(0x14b)][_0x2262b6(0xd0)]():function _0x26c9f6(_0x3db014){const _0x3247bd=_0x2262b6;if(!_0x3db014||!_0x3db014[_0x3247bd(0x196)])return'';const _0x3a769b=_0x3db014[_0x3247bd(0x196)];if(_0x3a769b[_0x3247bd(0xdc)+'on'])return _0x3a769b[_0x3247bd(0xdc)+'on'];if(_0x3a769b[_0x3247bd(0x1a9)+'xtMessage']?.[_0x3247bd(0x14b)])return _0x3a769b[_0x3247bd(0x1a9)+_0x3247bd(0x1a5)][_0x3247bd(0x14b)];if(_0x3a769b['imageMessa'+'ge']?.[_0x3247bd(0xca)])return _0x3a769b[_0x3247bd(0x159)+'ge'][_0x3247bd(0xca)];if(_0x3a769b[_0x3247bd(0xfe)+'ge']?.[_0x3247bd(0xca)])return _0x3a769b[_0x3247bd(0xfe)+'ge'][_0x3247bd(0xca)];if(_0x3a769b['buttonsRes'+'ponseMessa'+'ge']?.[_0x3247bd(0x138)+_0x3247bd(0x113)])return _0x3a769b['buttonsRes'+_0x3247bd(0x12a)+'ge'][_0x3247bd(0x138)+_0x3247bd(0x113)];if(_0x3a769b[_0x3247bd(0x1a1)+_0x3247bd(0xcf)]?.[_0x3247bd(0x11c)+_0x3247bd(0x18c)]?.['selectedRo'+_0x3247bd(0x135)])return _0x3a769b['listRespon'+'seMessage']['singleSele'+_0x3247bd(0x18c)][_0x3247bd(0x14a)+_0x3247bd(0x135)];return'';}(_0x529326)||'';if(!_0x2d51bd)return;const _0x1d92d0=(_0x2d51bd[_0x2262b6(0xbf)](/\r?\n/)[-0x2*-0xecf+-0x18c7*0x1+0x1*-0x4d7]||'')[_0x2262b6(0xd0)](),_0x2fee94=_0x1d92d0[_0x2262b6(0xbf)](/\s+/),_0x16d3f2=(_0x2fee94[0x1eec+0x343*0x1+-0x222f]||'')[_0x2262b6(0x18d)+'e']();if(!commands['includes'](_0x16d3f2))return;const _0x534f4d=(_0x2fee94[0xfcf+-0x88*-0x5+-0x116*0x11]||'')['toLowerCas'+'e']();if(_0x534f4d===_0x2262b6(0x101)){const _0x513125=(_0x2fee94[-0x5*-0x368+-0x57*-0x59+-0x2f45]||'')['toLowerCas'+'e']();if(!_0x513125){await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+'\x20Notificat'+_0x2262b6(0x1b9)+_0x2262b6(0xcb)+(NOTIFY_VIEWONCE?'ON':_0x2262b6(0xf2))+'*'});return;}const _0x5c214f=_0x513125==='on'||_0x513125==='1'||_0x513125===_0x2262b6(0xcd),_0x191209=await savePref(_0x2262b6(0xbe)+_0x2262b6(0xc6),_0x5c214f?'1':'0');if(!_0x191209){await trySend(_0x2294c6,{'text':'[viewonce]'+_0x2262b6(0x131)+_0x2262b6(0x16c)+'fications\x20'+'setting.'});return;}await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x100)+_0x2262b6(0x10d)+_0x2262b6(0xcc)+(_0x5c214f?'ON':'OFF')+'*'});return;}if(_0x534f4d==='p'||_0x534f4d==='pm'){const _0x15019e=await savePref(_0x2262b6(0xde),'p');if(!_0x15019e){await trySend(_0x2294c6,{'text':'[viewonce]'+_0x2262b6(0x131)+_0x2262b6(0x1b2)});return;}await trySend(_0x2294c6,{'text':'[viewonce]'+_0x2262b6(0x163)+_0x2262b6(0x186)});return;}if(_0x534f4d==='g'||_0x534f4d===_0x2262b6(0x1bb)||_0x534f4d==='gp'){const _0xf5dfe3=await savePref(_0x2262b6(0xde),'g');if(!_0xf5dfe3){await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+'\x20Failed\x20to'+'\x20set\x20mode.'});return;}const _0x721cc7=TARGET_JID?_0x2262b6(0x18a)+_0x2262b6(0xf3)+TARGET_JID:_0x2262b6(0xe3)+_0x2262b6(0x12d);await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x163)+_0x2262b6(0x178)+_0x721cc7});return;}if(_0x534f4d&&_0x534f4d[_0x2262b6(0xb9)]('@')){const _0x4937d7=normalizeToUserJid(_0x534f4d),_0x18e0c0=await savePref(_0x2262b6(0x164),_0x4937d7);if(_0x18e0c0)await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x185)+_0x2262b6(0x1b0)+_0x4937d7});else await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x131)+_0x2262b6(0xc9)+_0x2262b6(0x10b)+_0x4937d7});return;}if(_0x534f4d===_0x2262b6(0x1bd)||_0x534f4d===_0x2262b6(0x132)||_0x534f4d===_0x2262b6(0xbd)){const _0x597617=await savePref(_0x2262b6(0x164),'');if(_0x597617)await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x185)+_0x2262b6(0x170)});else await trySend(_0x2294c6,{'text':_0x2262b6(0x180)+_0x2262b6(0x131)+_0x2262b6(0x107)+_0x2262b6(0x120)});return;}const _0x5c57f5=MODE==='g'?'GROUP\x20('+(TARGET_JID||_0x2262b6(0xe8))+')':'PM';await trySend(_0x2294c6,{'text':_0x2262b6(0x1b4)+_0x2262b6(0xd9)+'ngs\x20(PM-On'+_0x2262b6(0x130)+(_0x2262b6(0x11a)+'ions*:\x20'+(NOTIFY_VIEWONCE?'ON':'OFF')+(_0x2262b6(0x194)+_0x2262b6(0xfb)+'|off`\x0a'))+(_0x2262b6(0xe6)+_0x2262b6(0x153)+_0x5c57f5+(_0x2262b6(0x194)+_0x2262b6(0x117)))+('*Target\x20JI'+_0x2262b6(0x1be)+(TARGET_JID||_0x2262b6(0x1a6))+('`\x20`viewonc'+_0x2262b6(0x13b)))+(_0x2262b6(0xd8)+_0x2262b6(0x189)+_0x2262b6(0x19e)+'once\x20messa'+_0x2262b6(0x1b6)+_0x2262b6(0x123)+'at\x20starts\x20'+_0x2262b6(0x19d)+_0x2262b6(0x104)+').')});}catch(_0x47331e){warn('['+name+(_0x2262b6(0x17d)+_0x2262b6(0x152)+_0x2262b6(0x143))+(_0x47331e?.[_0x2262b6(0x196)]||_0x47331e));}}export async function initialize(_0x13c974){const _0x392147=_0x51bcd3;if(!_0x13c974)throw new Error('viewonce.i'+_0x392147(0x148)+_0x392147(0x162)+_0x392147(0x151)+'e');botRef=_0x13c974,await ensureSchema(),refreshConfig(),_0x13c974['on'](_0x392147(0xdb)+'psert',upsertHandler),info('['+name+(_0x392147(0xbc)+_0x392147(0x169)+'alized\x20lis'+'tener)'));}export async function cleanup(){const _0x48aaa3=_0x51bcd3;try{botRef&&typeof botRef['off']==='function'&&botRef['off'](_0x48aaa3(0xdb)+_0x48aaa3(0x137),upsertHandler);for(const _0x50bb8a of processedKeys['values']())try{clearTimeout(_0x50bb8a);}catch(_0x42b978){}processedKeys[_0x48aaa3(0x1bd)]();}catch(_0x6a8a0f){warn(name+(_0x48aaa3(0x177)+'error:\x20')+(_0x6a8a0f?.[_0x48aaa3(0x196)]||_0x6a8a0f));}finally{botRef=null,info(name+(_0x48aaa3(0x19f)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};