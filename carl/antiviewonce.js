const _0x5403e0=_0x57da;(function(_0x4d70ae,_0x44a876){const _0x307b59=_0x57da,_0x4cdb32=_0x4d70ae();while(!![]){try{const _0x3676d6=-parseInt(_0x307b59(0x289))/(0x19e5+-0x6*-0x32d+-0x2cf2)+-parseInt(_0x307b59(0x2da))/(0x227b+-0x1637+-0xc42)+parseInt(_0x307b59(0x250))/(0x1be8+0x1*0x1814+-0x1153*0x3)*(-parseInt(_0x307b59(0x2e5))/(0x1*-0x1d81+-0x30e+0x2093))+parseInt(_0x307b59(0x1f6))/(0x15dc+0x177b+0x16a9*-0x2)+-parseInt(_0x307b59(0x200))/(-0x1664+-0x7*0x412+-0x2*-0x1974)*(-parseInt(_0x307b59(0x293))/(-0x1*-0x270b+0x5b4+0xb2e*-0x4))+parseInt(_0x307b59(0x220))/(-0x45*0x8a+-0xa77+0x2fb1)+parseInt(_0x307b59(0x1ec))/(-0x11*-0xe6+0x1*0x22ad+0x18f5*-0x2);if(_0x3676d6===_0x44a876)break;else _0x4cdb32['push'](_0x4cdb32['shift']());}catch(_0x72aff){_0x4cdb32['push'](_0x4cdb32['shift']());}}}(_0x3670,-0xf2196+0x953a6+-0x1d9*-0x77f));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';function _0x3670(){const _0x2c83d4=['overed\x20ima','KIP_IF_TAR','message',':\x20reload\x20a','indexOf','\x20the\x20view-','true','ssage','\x20message','Recovered\x0a','ge\x20with\x20a\x20','no\x20send\x20ta','_viewonce\x27',']\x20initiali','JID\x20set.','\x20Failed\x20to','GET_EQUALS','OFF',':\x20DB\x20write','remoteJid','INSERT\x20INT','Content\x20er',']\x20quoted\x20v',':\x20reply\x20to','ue\x20FROM\x20vi','adcast','ewonce_pre','delete','*Anti-View','text','efreshed',']\x20pref\x20sav','*Notificat','get','run','\x20in\x20','viewOnceMe','418968AuxJtV',']\x20no\x20desti','able','ey=?','=excluded.','.\x0aReply\x20to','ds=','unknown','ument\x20to\x20','nce\x20from\x20','ctReply','1088112nCsKSE','\x20—\x20','emoteJid','in\x20a\x20view-','\x20of\x20view-o','\x20Target\x20JI','function',']\x20onMessag','ions\x20set\x20t','extendedTe','hat\x20*start','end\x20failed','pushName','mode','participan','zed\x20(centr','o\x20*','alue\x20TEXT\x20','ions\x20are\x20c','IF\x20NOT\x20EXI','VIEWONCE_S','\x20?,\x20?)\x20ON\x20','NOT\x20NULL,\x0a','ATE\x20TABLE\x20',']\x20refreshC','ble;\x20falli','sock','lue=exclud','\x20failed:\x20','ecoveredTo','overed\x20doc','ly)*\x0a\x0a','1828755zNOehI','rmation\x20ta','s\x20with*\x20\x27_',']\x20upsertHa','target_jid','\x20not\x20conta','and','message\x20th','messages.u','BufferFrom','2961765tkSAjc',']\x20failed\x20t','_COMMANDS_','[viewonce]','bin','xtMessage',']\x20savePref','ttonId','ey=\x27mode\x27','NTEGER\x20DEF','2511030hKlpQg','hed','ore)\x20to\x20at','imageMessa','et\x20JID:\x20','listRespon','Configured','includes','VALUES\x20(?,','endsWith','slice','status@bro','at\x20starts\x20',']\x20Reply\x20st','\x20Mode\x20set\x20','\x20cleaned\x20u','image','D\x20saved:\x20','STS\x20viewon','ce_prefs\x20(','fromMe','ATE\x20SET\x20va',']\x20Notified','viewonce','p_commands','requires\x20b','View-Once\x20','n/octet-st','group',',\x20notify=','sage\x20avail','\x20`viewonce','5033376YVVUzI','ned\x20false','\x20group:\x20','to\x20GROUP.\x20','\x20from\x20','catch','once\x20inner','CONFLICT(k','wId','concat','\x20failed\x20fo','fs\x20WHERE\x20k','push','isCommand','group_comm','\x20save\x20targ','dated_at)\x20','\x0a\x20\x20\x20\x20\x20\x20CRE','isViewOnce','r:\x20',']\x20handleUp','essage\x20did','viewonce.i','`\x20`viewonc','VIEWONCE_A','set','\x20\x20\x20\x20\x20\x20\x20\x20up','fter\x20write','dConfig\x20re','d\x20media\x20ty','trim','singleSele','seMessage','2.0.0-patc','quotedMess','onfig\x20erro','exec',']\x20command\x20','isArray','t\x20supporte','buttonsRes','d:\x20','y,value,up','\x20that\x20mess','👁️\x20Detected','error:\x20','ed\x20&\x20reloa','notify_vie','9juLAfl','ing\x20recove','_SOURCE','recovered.','updated_at','IMARY\x20KEY,','ions*:\x20',']\x20handleCo','\x20p|g`\x0a','urrently\x20*','ia\x20buffer','_jid\x27',']\x20ensureSc','o\x20download','Dest\x20retur','@g.us',']\x20quoted\x20m','with\x20\x27_\x27\x20(',']\x20no\x20confi','videoMessa',']\x20notify\x20s','applicatio','arts\x20with\x20','ream','\x20set\x20mode.',']\x20Sent\x20rec','caption','conversati','d\x20unavaila','To\x20recover','wonce','floor','key','very.','\x20view-once','once\x20Setti','AULT\x200\x0a\x20\x20\x20','et*:\x20','overed\x20vid','SELECT\x20val',']\x20config\x20r','\x20ctx.key.r','\x0a\x20\x20\x20\x20\x20\x20\x20\x20v','\x20-\x20attempt','ey=\x27allow_','selectedRo','get\x20JID.','allow_grou','LLOW_GROUP','ey=\x27notify','psert','ssageV2','|off`\x0a','nner\x20is\x20no','ot\x20instanc','not\x20set','split','290370OBeIdU','contextInf',']\x20forwardR','mmand\x20erro','rting\x20comm','ngs\x20(PM-On','has','gistration','length','some','7jWACEQ',']\x20getBotJi','Dest\x20faile','ror:\x20','clear','string','toLowerCas','remove','age','no\x20sendMes','sendMessag','ponseMessa','alized\x20lis','\x0a\x0afrom:\x20',']\x20download','oup_comman','nitialize\x20','\x20inner\x20med','gifPlaybac','DEFAULT','selectedBu','unset','once\x20messa','e\x20handler\x20','values','\x20save\x20noti','unknown\x20ch','*Target\x20JI','rget\x20-\x20abo','\x20Notificat','value','unknown\x20us','ng\x20back\x20to','ey=\x27target'];_0x3670=function(){return _0x2c83d4;};return _0x3670();}import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name=_0x5403e0(0x217);export const version=_0x5403e0(0x241)+_0x5403e0(0x201);export const priority=-0x1*0xae4+0xf5a+-0x417;export const commands=[_0x5403e0(0x217)];export const configKeys=[_0x5403e0(0x2f9)+'KIP_IF_TAR'+_0x5403e0(0x2c5)+_0x5403e0(0x252),'VIEWONCE_A'+_0x5403e0(0x280)+'_COMMANDS_'+_0x5403e0(0x2a6)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function _0x57da(_0x4791e0,_0x2d6804){const _0x480ff2=_0x3670();return _0x57da=function(_0x5784ef,_0x2265f8){_0x5784ef=_0x5784ef-(0x2284+-0x2*0x611+-0x147a);let _0x426c6a=_0x480ff2[_0x5784ef];return _0x426c6a;},_0x57da(_0x4791e0,_0x2d6804);}function refreshConfig(){const _0x725802=_0x5403e0;try{const _0x4ea33c=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x4ea33c[_0x725802(0x2f9)+_0x725802(0x2b6)+_0x725802(0x2c5)+_0x725802(0x252)]!==undefined?Boolean(_0x4ea33c[_0x725802(0x2f9)+_0x725802(0x2b6)+_0x725802(0x2c5)+_0x725802(0x252)]):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x4ea33c['VIEWONCE_A'+_0x725802(0x280)+_0x725802(0x1f8)+'DEFAULT']??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(_0x725802(0x278)+_0x725802(0x2d3)));}catch(_0x246b6f){warn('['+name+(_0x725802(0x2fd)+_0x725802(0x243)+_0x725802(0x233))+(_0x246b6f?.[_0x725802(0x2b7)]||_0x246b6f));}}try{hotReloadConfig&&hotReloadConfig((_0x4473c4=[])=>{const _0xcbd848=_0x5403e0,_0x45a76f=['VIEWONCE_S'+_0xcbd848(0x2b6)+_0xcbd848(0x2c5)+_0xcbd848(0x252),_0xcbd848(0x238)+'LLOW_GROUP'+_0xcbd848(0x1f8)+_0xcbd848(0x2a6)];if((_0x4473c4||[])[_0xcbd848(0x292)](_0xea438c=>_0x45a76f['includes'](_0xea438c)))refreshConfig();});}catch(_0x38fbd9){warn('['+name+(']\x20hotReloa'+_0x5403e0(0x23c)+_0x5403e0(0x290)+_0x5403e0(0x1e8))+(_0x38fbd9?.['message']||_0x38fbd9));}refreshConfig();async function ensureSchema(){const _0x2a2d52=_0x5403e0;try{await db[_0x2a2d52(0x244)](_0x2a2d52(0x231)+_0x2a2d52(0x2fc)+_0x2a2d52(0x2f8)+_0x2a2d52(0x212)+_0x2a2d52(0x213)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20k'+'ey\x20TEXT\x20PR'+_0x2a2d52(0x255)+_0x2a2d52(0x27a)+_0x2a2d52(0x2f6)+_0x2a2d52(0x2fb)+_0x2a2d52(0x23a)+'dated_at\x20I'+_0x2a2d52(0x1ff)+_0x2a2d52(0x274)+'\x20\x20\x20);\x0a\x20\x20\x20\x20');try{const _0x3b3dd7=await db[_0x2a2d52(0x2d6)](_0x2a2d52(0x277)+_0x2a2d52(0x2cd)+_0x2a2d52(0x2cf)+'fs\x20WHERE\x20k'+_0x2a2d52(0x1fe));MODE=_0x3b3dd7?.[_0x2a2d52(0x2b1)]==='g'?'g':'p';}catch(_0x338af8){}try{const _0x337d87=await db[_0x2a2d52(0x2d6)](_0x2a2d52(0x277)+_0x2a2d52(0x2cd)+_0x2a2d52(0x2cf)+_0x2a2d52(0x22b)+_0x2a2d52(0x2b4)+_0x2a2d52(0x25b));TARGET_JID=_0x337d87?.['value']||null;}catch(_0x9577c6){TARGET_JID=null;}try{const _0x128f70=await db['get'](_0x2a2d52(0x277)+'ue\x20FROM\x20vi'+_0x2a2d52(0x2cf)+_0x2a2d52(0x22b)+_0x2a2d52(0x27c)+_0x2a2d52(0x22e)+'ands\x27');ALLOW_GROUP_COMMANDS=_0x128f70?.[_0x2a2d52(0x2b1)]==='1';}catch(_0x145c79){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x314f55=await db[_0x2a2d52(0x2d6)]('SELECT\x20val'+_0x2a2d52(0x2cd)+_0x2a2d52(0x2cf)+_0x2a2d52(0x22b)+_0x2a2d52(0x281)+_0x2a2d52(0x2c1));NOTIFY_VIEWONCE=_0x314f55?.['value']==='1';}catch(_0x292d31){NOTIFY_VIEWONCE=![];}info('['+name+(']\x20DB\x20ready'+'\x20(mode=')+MODE+',\x20target='+(TARGET_JID||'unset')+_0x2a2d52(0x21d)+NOTIFY_VIEWONCE+(',\x20allow_gr'+_0x2a2d52(0x2a2)+_0x2a2d52(0x2e0))+ALLOW_GROUP_COMMANDS+')');}catch(_0x378b6e){error(_0x378b6e,'['+name+(_0x2a2d52(0x25c)+'hema\x20faile'+'d'));throw _0x378b6e;}}async function savePref(_0x4593c8,_0x263fc5){const _0x2f5401=_0x5403e0;try{const _0x2127b6=Math[_0x2f5401(0x26f)](Date['now']()/(-0x1*-0x10fd+-0x3fc+0x11*-0x89));await db[_0x2f5401(0x2d7)](_0x2f5401(0x2c9)+'O\x20viewonce'+'_prefs\x20(ke'+_0x2f5401(0x24a)+_0x2f5401(0x230)+_0x2f5401(0x208)+_0x2f5401(0x2fa)+_0x2f5401(0x227)+'ey)\x20DO\x20UPD'+_0x2f5401(0x215)+_0x2f5401(0x300)+'ed.value,\x20'+_0x2f5401(0x254)+_0x2f5401(0x2de)+_0x2f5401(0x254),[_0x4593c8,_0x263fc5,_0x2127b6]);}catch(_0xf7656f){return warn('['+name+(']\x20savePref'+_0x2f5401(0x2c7)+_0x2f5401(0x22a)+'r\x20')+_0x4593c8+'='+_0x263fc5+_0x2f5401(0x2e6)+(_0xf7656f?.[_0x2f5401(0x2b7)]||_0xf7656f)),![];}try{const _0xbe9225=await db[_0x2f5401(0x2d6)](_0x2f5401(0x277)+_0x2f5401(0x2cd)+_0x2f5401(0x2cf)+_0x2f5401(0x22b)+_0x2f5401(0x2dd),[_0x4593c8]),_0x25fecc=_0xbe9225?.[_0x2f5401(0x2b1)]??_0x263fc5;if(_0x4593c8===_0x2f5401(0x2f2))MODE=_0x25fecc==='g'?'g':'p';if(_0x4593c8===_0x2f5401(0x1f0))TARGET_JID=_0x25fecc||null;if(_0x4593c8===_0x2f5401(0x27f)+_0x2f5401(0x218))ALLOW_GROUP_COMMANDS=_0x25fecc==='1';if(_0x4593c8==='notify_vie'+_0x2f5401(0x26e))NOTIFY_VIEWONCE=_0x25fecc==='1';return info('['+name+(_0x2f5401(0x2d4)+_0x2f5401(0x24e)+'ded:\x20')+_0x4593c8+'='+_0x25fecc),!![];}catch(_0x372835){warn('['+name+(_0x2f5401(0x1fc)+_0x2f5401(0x2b8)+_0x2f5401(0x23b)+_0x2f5401(0x22a)+'r\x20')+_0x4593c8+'='+_0x263fc5+_0x2f5401(0x2e6)+(_0x372835?.[_0x2f5401(0x2b7)]||_0x372835));if(_0x4593c8===_0x2f5401(0x2f2))MODE=_0x263fc5==='g'?'g':'p';if(_0x4593c8===_0x2f5401(0x1f0))TARGET_JID=_0x263fc5||null;if(_0x4593c8===_0x2f5401(0x27f)+_0x2f5401(0x218))ALLOW_GROUP_COMMANDS=_0x263fc5==='1';if(_0x4593c8===_0x2f5401(0x24f)+_0x2f5401(0x26e))NOTIFY_VIEWONCE=_0x263fc5==='1';return!![];}}function normalizeToUserJid(_0x4bf177){const _0x96afa6=_0x5403e0;try{if(!_0x4bf177||typeof _0x4bf177!==_0x96afa6(0x298))return _0x4bf177;const _0x479c46=_0x4bf177['indexOf']('@');if(_0x479c46===-(-0x1*-0x112a+-0x1*-0x2579+-0x7e*0x6f))return _0x4bf177;const _0x2d5921=_0x4bf177['slice'](0x1*-0x1670+0x63*0x52+-0x946,_0x479c46),_0x63ee05=_0x4bf177['slice'](_0x479c46),_0x5efcf4=_0x2d5921[_0x96afa6(0x2b9)](':');if(_0x5efcf4===-(0x13ff+0x227b+-0x3679))return _0x4bf177;return _0x2d5921['slice'](0x1*0x246e+0xdff+-0x326d,_0x5efcf4)+_0x63ee05;}catch(_0x29281b){return _0x4bf177;}}async function trySend(_0x3f2a2d,_0x3a6d1f){const _0x308a35=_0x5403e0;try{const _0x106299=normalizeToUserJid(String(_0x3f2a2d));if(!_0x106299)throw new Error(_0x308a35(0x2c0)+'rget');if(typeof botRef?.[_0x308a35(0x29d)+'e']===_0x308a35(0x2eb)){await botRef[_0x308a35(0x29d)+'e'](_0x106299,_0x3a6d1f);return;}if(botRef?.[_0x308a35(0x2ff)]&&typeof botRef[_0x308a35(0x2ff)][_0x308a35(0x29d)+'e']===_0x308a35(0x2eb)){await botRef[_0x308a35(0x2ff)]['sendMessag'+'e'](_0x106299,_0x3a6d1f);return;}throw new Error(_0x308a35(0x29c)+_0x308a35(0x21e)+_0x308a35(0x2dc));}catch(_0x1b4548){throw _0x1b4548;}}const DEDUPE_TTL_MS=(-0x1*0x1279+0xc17*-0x1+0x1e9a)*(-0xffe+0x959*-0x2+0x2698),processedKeys=new Map();function markProcessed(_0x26425b){const _0x3fbd08=_0x5403e0;if(!_0x26425b)return;if(processedKeys[_0x3fbd08(0x28f)](_0x26425b))try{clearTimeout(processedKeys[_0x3fbd08(0x2d6)](_0x26425b));}catch(_0x46b235){}const _0x17411c=setTimeout(()=>processedKeys['delete'](_0x26425b),DEDUPE_TTL_MS);processedKeys[_0x3fbd08(0x239)](_0x26425b,_0x17411c);}function isProcessed(_0x1d10d3){const _0x15fc3a=_0x5403e0;return _0x1d10d3&&processedKeys[_0x15fc3a(0x28f)](_0x1d10d3);}function extractContextInfo(_0xdf90b6){const _0x443966=_0x5403e0;if(!_0xdf90b6||!_0xdf90b6[_0x443966(0x2b7)])return null;const _0x1ca34a=_0xdf90b6[_0x443966(0x2b7)];return _0x1ca34a[_0x443966(0x2ee)+'xtMessage']?.[_0x443966(0x28a)+'o']||_0x1ca34a[_0x443966(0x28a)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x52dd62){const _0x290a6b=_0x5403e0;if(!_0x52dd62)return null;return _0x52dd62?.[_0x290a6b(0x2d9)+_0x290a6b(0x2bc)]?.['message']||_0x52dd62?.[_0x290a6b(0x2d9)+_0x290a6b(0x283)]?.[_0x290a6b(0x2b7)]||(_0x52dd62['imageMessa'+'ge']?_0x52dd62:null)||(_0x52dd62[_0x290a6b(0x263)+'ge']?_0x52dd62:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x5a766f){const _0x1ddcf4=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x5a766f)return _0x1ddcf4;return TARGET_JID;}return _0x1ddcf4;}function stripDomain(_0x2a9064){const _0x2a7c81=_0x5403e0;if(!_0x2a9064||typeof _0x2a9064!==_0x2a7c81(0x298))return _0x2a9064;const _0x583f19=_0x2a9064[_0x2a7c81(0x2b9)]('@');if(_0x583f19===-(0x216+0x208+0x3*-0x15f))return _0x2a9064;return _0x2a9064[_0x2a7c81(0x20a)](0x1*0x23f2+0x8*-0x383+0x1e*-0x43,_0x583f19);}async function handleUpsertSingle(_0x4b8276){const _0x300918=_0x5403e0;try{if(!_0x4b8276||!_0x4b8276[_0x300918(0x270)])return;if(_0x4b8276[_0x300918(0x270)]?.[_0x300918(0x2c8)]===_0x300918(0x20b)+_0x300918(0x2ce))return;if(Boolean(_0x4b8276['key']?.['fromMe']))return;const _0x16b79d=String(_0x4b8276[_0x300918(0x270)][_0x300918(0x2c8)]||'')+'::'+String(_0x4b8276['key']['id']||'');if(isProcessed(_0x16b79d))return;markProcessed(_0x16b79d);const _0x74a1f1=Boolean(_0x4b8276[_0x300918(0x270)]?.[_0x300918(0x232)]),_0x5d9166=Boolean(_0x4b8276[_0x300918(0x2b7)]?.['viewOnceMe'+'ssage']||_0x4b8276[_0x300918(0x2b7)]?.[_0x300918(0x2d9)+_0x300918(0x283)]);if(!_0x74a1f1&&!_0x5d9166)return;if(!NOTIFY_VIEWONCE)return;const _0x554ea2=_0x4b8276[_0x300918(0x2f1)]||_0x4b8276[_0x300918(0x270)]?.['participan'+'t']||_0x4b8276[_0x300918(0x270)]?.[_0x300918(0x2c8)]||null,_0x2b7992=_0x554ea2?stripDomain(String(_0x554ea2)):_0x300918(0x2e1),_0x573942=_0x4b8276['key']?.[_0x300918(0x2c8)]?stripDomain(_0x4b8276[_0x300918(0x270)]['remoteJid']):_0x300918(0x2ad)+'at',_0x17326c=resolveDestination(_0x4b8276[_0x300918(0x270)]?.[_0x300918(0x2c8)]);if(!_0x17326c)return;const _0x40095f=_0x300918(0x24c)+_0x300918(0x272)+_0x300918(0x224)+_0x2b7992+'\x20in\x20chat\x20'+_0x573942+(_0x300918(0x2df)+_0x300918(0x24b)+'age\x20with\x20a'+'\x20message\x20t'+_0x300918(0x2ef)+_0x300918(0x1ee)+'\x27\x20(undersc'+_0x300918(0x202)+'tempt\x20reco'+_0x300918(0x271));try{await trySend(_0x17326c,{'text':_0x40095f}),info('['+name+(_0x300918(0x216)+'\x20')+_0x17326c+(_0x300918(0x2e9)+_0x300918(0x2e3))+_0x2b7992+_0x300918(0x2d8)+_0x573942);}catch(_0x1b011c){warn('['+name+(_0x300918(0x264)+_0x300918(0x2f0)+':\x20')+(_0x1b011c?.[_0x300918(0x2b7)]||_0x1b011c));}}catch(_0x3a12f8){warn('['+name+(_0x300918(0x234)+'sertSingle'+'\x20error:\x20')+(_0x3a12f8?.[_0x300918(0x2b7)]||_0x3a12f8));}}async function upsertHandler({messages:_0xc2cf38}){const _0x7e8a0a=_0x5403e0;try{if(!Array[_0x7e8a0a(0x246)](_0xc2cf38))return;for(const _0x2caeb9 of _0xc2cf38)await handleUpsertSingle(_0x2caeb9);}catch(_0x1654f7){warn('['+name+(_0x7e8a0a(0x1ef)+'ndler\x20erro'+'r:\x20')+(_0x1654f7?.[_0x7e8a0a(0x2b7)]||_0x1654f7));}}async function downloadBufferFromContent(_0x31f0a3,_0x5617db){const _0x6dd255=_0x5403e0;try{if(!_0x31f0a3||!_0x5617db)return null;const _0x7cb923=await downloadContentFromMessage(_0x31f0a3,_0x5617db);if(!_0x7cb923)return null;const _0x29e012=[];for await(const _0x4ff30f of _0x7cb923){_0x29e012[_0x6dd255(0x22c)](_0x4ff30f);}if(!_0x29e012[_0x6dd255(0x291)])return null;return Buffer[_0x6dd255(0x229)](_0x29e012);}catch(_0x1b9bd8){return warn('['+name+(_0x6dd255(0x2a1)+_0x6dd255(0x1f5)+_0x6dd255(0x2ca)+_0x6dd255(0x296))+(_0x1b9bd8?.[_0x6dd255(0x2b7)]||_0x1b9bd8)),null;}}async function forwardRecoveredToDest(_0x489d8c,_0x48d3aa,_0x402071,_0x4d7250){const _0x40346f=_0x5403e0,_0x5b944f=resolveDestination(_0x402071);if(!_0x5b944f)return warn('['+name+(_0x40346f(0x2db)+'nation\x20res'+'olved')),![];try{const _0x27ca77=_0x489d8c?.[_0x40346f(0x203)+'ge']?.[_0x40346f(0x26a)]||_0x489d8c?.[_0x40346f(0x263)+'ge']?.[_0x40346f(0x26a)]||'',_0x14ea7d=_0x4d7250?stripDomain(_0x4d7250):_0x40346f(0x2b2)+'er',_0x22f196=_0x402071?stripDomain(_0x402071):_0x40346f(0x2ad)+'at',_0x2330b5=_0x40346f(0x2a0)+_0x14ea7d+_0x40346f(0x2d8)+_0x22f196,_0xc74542=_0x40346f(0x21a)+_0x40346f(0x2be)+_0x27ca77+_0x2330b5;if(_0x489d8c[_0x40346f(0x203)+'ge'])return await trySend(_0x5b944f,{'image':_0x48d3aa,'caption':_0xc74542}),info('['+name+(_0x40346f(0x269)+_0x40346f(0x2b5)+'ge\x20to\x20')+_0x5b944f),!![];if(_0x489d8c[_0x40346f(0x263)+'ge']){const _0xe0d6a9=Boolean(_0x489d8c[_0x40346f(0x263)+'ge']?.[_0x40346f(0x2a5)+'k']);return await trySend(_0x5b944f,{'video':_0x48d3aa,'caption':_0xc74542,'gifPlayback':_0xe0d6a9}),info('['+name+(_0x40346f(0x269)+_0x40346f(0x276)+'eo\x20to\x20')+_0x5b944f),!![];}return await trySend(_0x5b944f,{'document':_0x48d3aa,'fileName':_0x40346f(0x253)+_0x40346f(0x1fa),'mimetype':_0x40346f(0x265)+_0x40346f(0x21b)+_0x40346f(0x267),'caption':_0xc74542}),info('['+name+(_0x40346f(0x269)+_0x40346f(0x1ea)+_0x40346f(0x2e2))+_0x5b944f),!![];}catch(_0x10ed04){return warn('['+name+(_0x40346f(0x28b)+_0x40346f(0x1e9)+_0x40346f(0x295)+_0x40346f(0x249))+(_0x10ed04?.[_0x40346f(0x2b7)]||_0x10ed04)),![];}}function extractTextFromCtx(_0x3e04e5){const _0x478d84=_0x5403e0;if(!_0x3e04e5||!_0x3e04e5[_0x478d84(0x2b7)])return'';const _0x5701b6=_0x3e04e5[_0x478d84(0x2b7)];return _0x5701b6[_0x478d84(0x26b)+'on']||_0x5701b6['extendedTe'+_0x478d84(0x1fb)]?.[_0x478d84(0x2d2)]||_0x5701b6[_0x478d84(0x203)+'ge']?.[_0x478d84(0x26a)]||_0x5701b6['videoMessa'+'ge']?.['caption']||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0x14c6+-0x457*-0x2+0x6*0x209)*(0x1438+-0x3*-0xb75+-0x32af);function markCmdProcessed(_0x40c103){const _0x2850d4=_0x5403e0;if(!_0x40c103)return;if(processedCmdKeys[_0x2850d4(0x28f)](_0x40c103))try{clearTimeout(processedCmdKeys[_0x2850d4(0x2d6)](_0x40c103));}catch(_0xa3aca0){};const _0x72d95=setTimeout(()=>processedCmdKeys[_0x2850d4(0x2d0)](_0x40c103),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x2850d4(0x239)](_0x40c103,_0x72d95);}function isCmdProcessed(_0x3bee88){const _0x36579c=_0x5403e0;return _0x3bee88&&processedCmdKeys[_0x36579c(0x28f)](_0x3bee88);}const recentResponded=new Set();export async function onMessage(_0x25c99c){const _0x7e3033=_0x5403e0;try{if(!_0x25c99c||!_0x25c99c[_0x7e3033(0x270)]||!_0x25c99c[_0x7e3033(0x2b7)])return;const _0x3cb8a4=_0x25c99c[_0x7e3033(0x270)]?.['id']||null;if(_0x3cb8a4){if(recentResponded[_0x7e3033(0x28f)](_0x3cb8a4))return;recentResponded['add'](_0x3cb8a4),setTimeout(()=>recentResponded[_0x7e3033(0x2d0)](_0x3cb8a4),(0x1*0xc83+0x12d5+-0x1f1c)*(-0x87a+0x17eb+0xb89*-0x1));}if(_0x25c99c[_0x7e3033(0x22d)]){const _0x118b31=_0x25c99c[_0x7e3033(0x270)]['remoteJid'],_0x5d3e6a=typeof _0x118b31===_0x7e3033(0x298)&&_0x118b31[_0x7e3033(0x209)](_0x7e3033(0x25f));if(_0x5d3e6a&&!ALLOW_GROUP_COMMANDS){}else{const _0x26faee=Boolean(_0x25c99c[_0x7e3033(0x270)][_0x7e3033(0x214)]);if(!_0x5d3e6a&&!_0x26faee){const _0xa289ac=await isSudo(botRef,_0x25c99c)['catch'](()=>![]);if(!_0xa289ac){}else await handleCommand(_0x25c99c)['catch'](_0x50717f=>warn('['+name+(_0x7e3033(0x245)+_0x7e3033(0x24d))+(_0x50717f?.[_0x7e3033(0x2b7)]||_0x50717f)));}else{const _0x545e34=await isSudo(botRef,_0x25c99c)[_0x7e3033(0x225)](()=>![]),_0x5225cd=Boolean(_0x25c99c[_0x7e3033(0x270)][_0x7e3033(0x214)]);(_0x5225cd||_0x545e34)&&await handleCommand(_0x25c99c)['catch'](_0x2009e0=>warn('['+name+(']\x20command\x20'+'error:\x20')+(_0x2009e0?.[_0x7e3033(0x2b7)]||_0x2009e0)));}}}const _0x1056ba=extractContextInfo(_0x25c99c);if(!_0x1056ba||!_0x1056ba[_0x7e3033(0x242)+_0x7e3033(0x29b)])return;const _0x3450d9=extractTextFromCtx(_0x25c99c)||'';if(!_0x3450d9)return;const _0x15ad46=_0x3450d9[_0x7e3033(0x23e)]()['charAt'](0x37a*0x8+0xda*-0xc+-0x1198*0x1);if(_0x15ad46!=='_')return;info('['+name+(_0x7e3033(0x20d)+_0x7e3033(0x266)+'underscore'+_0x7e3033(0x27b)+_0x7e3033(0x251)+'ry'));const _0x1bfe9d=extractViewOnceInnerFromQuoted(_0x1056ba['quotedMess'+_0x7e3033(0x29b)]);if(!_0x1bfe9d){warn('['+name+(_0x7e3033(0x260)+_0x7e3033(0x235)+_0x7e3033(0x1f1)+_0x7e3033(0x2e8)+_0x7e3033(0x226)+_0x7e3033(0x2bd)));return;}let _0x4aafb1=null,_0x1d03e8=null;if(_0x1bfe9d[_0x7e3033(0x203)+'ge'])_0x4aafb1=_0x1bfe9d[_0x7e3033(0x203)+'ge'],_0x1d03e8=_0x7e3033(0x210);else _0x1bfe9d[_0x7e3033(0x263)+'ge']&&(_0x4aafb1=_0x1bfe9d[_0x7e3033(0x263)+'ge'],_0x1d03e8='video');if(!_0x4aafb1||!_0x1d03e8){warn('['+name+(_0x7e3033(0x2cb)+'iew-once\x20i'+_0x7e3033(0x285)+_0x7e3033(0x247)+_0x7e3033(0x23d)+'pe'));return;}const _0x504d60=await downloadBufferFromContent(_0x4aafb1,_0x1d03e8);if(!_0x504d60){warn('['+name+(_0x7e3033(0x1f7)+_0x7e3033(0x25d)+_0x7e3033(0x2a4)+_0x7e3033(0x25a)));return;}const _0x4152a8=_0x25c99c['key'][_0x7e3033(0x2c8)]||null,_0x1c0bf7=_0x1056ba['participan'+'t']||null,_0x3c9b33=await forwardRecoveredToDest(_0x1bfe9d,_0x504d60,_0x4152a8,_0x1c0bf7);if(!_0x3c9b33)warn('['+name+(_0x7e3033(0x28b)+'ecoveredTo'+_0x7e3033(0x25e)+_0x7e3033(0x221)));}catch(_0x1bf69d){error(_0x1bf69d,'['+name+(_0x7e3033(0x2ec)+_0x7e3033(0x2aa)+_0x7e3033(0x24d))+(_0x1bf69d?.['message']||_0x1bf69d));}}async function handleCommand(_0x167b03){const _0x56ccc0=_0x5403e0;try{if(!_0x167b03||!_0x167b03[_0x56ccc0(0x270)]||!_0x167b03[_0x56ccc0(0x2b7)])return;const _0xacadbc=_0x167b03['key'][_0x56ccc0(0x2c8)],_0x4b2eb3=typeof _0xacadbc===_0x56ccc0(0x298)&&_0xacadbc[_0x56ccc0(0x209)](_0x56ccc0(0x25f));if(_0x4b2eb3&&!ALLOW_GROUP_COMMANDS)return;const _0x42f3c3=Boolean(_0x167b03[_0x56ccc0(0x270)][_0x56ccc0(0x214)]);if(!_0x4b2eb3&&!_0x42f3c3){const _0x161ca6=await isSudo(botRef,_0x167b03)[_0x56ccc0(0x225)](()=>![]);if(!_0x161ca6)return;}const _0x49b771=Boolean(_0x167b03[_0x56ccc0(0x270)][_0x56ccc0(0x214)]),_0x579408=await isSudo(botRef,_0x167b03)[_0x56ccc0(0x225)](()=>![]);let _0x2e3117;if(_0x49b771)_0x2e3117=getBotJid()||_0x167b03[_0x56ccc0(0x270)]['remoteJid']||_0x167b03[_0x56ccc0(0x270)]['participan'+'t']||null,!_0x2e3117&&(warn('['+name+(_0x56ccc0(0x294)+_0x56ccc0(0x26c)+_0x56ccc0(0x2fe)+_0x56ccc0(0x2b3)+_0x56ccc0(0x279)+_0x56ccc0(0x2e7))),_0x2e3117=_0x167b03['key'][_0x56ccc0(0x2c8)]||null);else{if(_0x579408)_0x2e3117=_0x167b03[_0x56ccc0(0x270)][_0x56ccc0(0x2c8)];else return;}if(!_0x2e3117){warn('['+name+(_0x56ccc0(0x262)+_0x56ccc0(0x1ed)+_0x56ccc0(0x2af)+_0x56ccc0(0x28d)+_0x56ccc0(0x1f2)));return;}const _0x4209b3=String(_0x167b03[_0x56ccc0(0x270)][_0x56ccc0(0x2c8)]||'')+'::'+String(_0x167b03[_0x56ccc0(0x270)]['id']||_0x167b03[_0x56ccc0(0x270)][_0x56ccc0(0x2f3)+'t']||'');if(isCmdProcessed(_0x4209b3))return;markCmdProcessed(_0x4209b3);const _0x43e264=typeof _0x167b03[_0x56ccc0(0x2d2)]===_0x56ccc0(0x298)&&_0x167b03[_0x56ccc0(0x2d2)][_0x56ccc0(0x23e)]()[_0x56ccc0(0x291)]?_0x167b03[_0x56ccc0(0x2d2)][_0x56ccc0(0x23e)]():function _0x6a92d8(_0xf5fcbc){const _0x5cdc3b=_0x56ccc0;if(!_0xf5fcbc||!_0xf5fcbc[_0x5cdc3b(0x2b7)])return'';const _0x10c504=_0xf5fcbc[_0x5cdc3b(0x2b7)];if(_0x10c504[_0x5cdc3b(0x26b)+'on'])return _0x10c504[_0x5cdc3b(0x26b)+'on'];if(_0x10c504[_0x5cdc3b(0x2ee)+_0x5cdc3b(0x1fb)]?.[_0x5cdc3b(0x2d2)])return _0x10c504[_0x5cdc3b(0x2ee)+_0x5cdc3b(0x1fb)][_0x5cdc3b(0x2d2)];if(_0x10c504[_0x5cdc3b(0x203)+'ge']?.[_0x5cdc3b(0x26a)])return _0x10c504[_0x5cdc3b(0x203)+'ge']['caption'];if(_0x10c504[_0x5cdc3b(0x263)+'ge']?.['caption'])return _0x10c504['videoMessa'+'ge'][_0x5cdc3b(0x26a)];if(_0x10c504[_0x5cdc3b(0x248)+_0x5cdc3b(0x29e)+'ge']?.[_0x5cdc3b(0x2a7)+_0x5cdc3b(0x1fd)])return _0x10c504[_0x5cdc3b(0x248)+_0x5cdc3b(0x29e)+'ge'][_0x5cdc3b(0x2a7)+'ttonId'];if(_0x10c504[_0x5cdc3b(0x205)+'seMessage']?.[_0x5cdc3b(0x23f)+'ctReply']?.[_0x5cdc3b(0x27d)+_0x5cdc3b(0x228)])return _0x10c504[_0x5cdc3b(0x205)+_0x5cdc3b(0x240)][_0x5cdc3b(0x23f)+_0x5cdc3b(0x2e4)][_0x5cdc3b(0x27d)+_0x5cdc3b(0x228)];return'';}(_0x167b03)||'';if(!_0x43e264)return;const _0x33ba15=(_0x43e264[_0x56ccc0(0x288)](/\r?\n/)[-0x18fd*0x1+-0x125f+-0x1e*-0x172]||'')[_0x56ccc0(0x23e)](),_0x1271af=_0x33ba15['split'](/\s+/),_0x10a985=(_0x1271af[-0x1e66+0x2565*-0x1+0x43cb]||'')[_0x56ccc0(0x299)+'e']();if(!commands[_0x56ccc0(0x207)](_0x10a985))return;const _0x2c10aa=(_0x1271af[-0xe99+-0x17c3*-0x1+-0x929]||'')['toLowerCas'+'e']();if(_0x2c10aa==='notify'){const _0x5348ba=(_0x1271af[0x175d*0x1+0xb27+-0x2282]||'')[_0x56ccc0(0x299)+'e']();if(!_0x5348ba){await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x2b0)+_0x56ccc0(0x2f7)+_0x56ccc0(0x259)+(NOTIFY_VIEWONCE?'ON':_0x56ccc0(0x2c6))+'*'});return;}const _0x50a736=_0x5348ba==='on'||_0x5348ba==='1'||_0x5348ba===_0x56ccc0(0x2bb),_0x15ce4c=await savePref(_0x56ccc0(0x24f)+_0x56ccc0(0x26e),_0x50a736?'1':'0');if(!_0x15ce4c){await trySend(_0x2e3117,{'text':'[viewonce]'+'\x20Failed\x20to'+_0x56ccc0(0x2ac)+'fications\x20'+'setting.'});return;}await trySend(_0x2e3117,{'text':'[viewonce]'+_0x56ccc0(0x2b0)+_0x56ccc0(0x2ed)+_0x56ccc0(0x2f5)+(_0x50a736?'ON':_0x56ccc0(0x2c6))+'*'});return;}if(_0x2c10aa==='p'||_0x2c10aa==='pm'){const _0x3aab9c=await savePref('mode','p');if(!_0x3aab9c){await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x2c4)+_0x56ccc0(0x268)});return;}await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+'\x20Mode\x20set\x20'+'to\x20PM.'});return;}if(_0x2c10aa==='g'||_0x2c10aa===_0x56ccc0(0x21c)||_0x2c10aa==='gp'){const _0x3da2d9=await savePref(_0x56ccc0(0x2f2),'g');if(!_0x3da2d9){await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x2c4)+_0x56ccc0(0x268)});return;}const _0x31796d=TARGET_JID?_0x56ccc0(0x206)+_0x56ccc0(0x222)+TARGET_JID:'No\x20target\x20'+_0x56ccc0(0x2c3);await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x20e)+_0x56ccc0(0x223)+_0x31796d});return;}if(_0x2c10aa&&_0x2c10aa[_0x56ccc0(0x207)]('@')){const _0x3d6985=normalizeToUserJid(_0x2c10aa),_0x1494e9=await savePref(_0x56ccc0(0x1f0),_0x3d6985);if(_0x1494e9)await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x2ea)+_0x56ccc0(0x211)+_0x3d6985});else await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+'\x20Failed\x20to'+_0x56ccc0(0x22f)+_0x56ccc0(0x204)+_0x3d6985});return;}if(_0x2c10aa===_0x56ccc0(0x297)||_0x2c10aa===_0x56ccc0(0x2a8)||_0x2c10aa===_0x56ccc0(0x29a)){const _0x38ceed=await savePref(_0x56ccc0(0x1f0),'');if(_0x38ceed)await trySend(_0x2e3117,{'text':'[viewonce]'+_0x56ccc0(0x2ea)+'D\x20cleared.'});else await trySend(_0x2e3117,{'text':_0x56ccc0(0x1f9)+_0x56ccc0(0x2c4)+'\x20clear\x20tar'+_0x56ccc0(0x27e)});return;}const _0x121edb=MODE==='g'?'GROUP\x20('+(TARGET_JID||_0x56ccc0(0x287))+')':'PM';await trySend(_0x2e3117,{'text':_0x56ccc0(0x2d1)+_0x56ccc0(0x273)+_0x56ccc0(0x28e)+_0x56ccc0(0x1eb)+(_0x56ccc0(0x2d5)+_0x56ccc0(0x256)+(NOTIFY_VIEWONCE?'ON':_0x56ccc0(0x2c6))+('\x20`viewonce'+'\x20notify\x20on'+_0x56ccc0(0x284)))+('*Send\x20Targ'+_0x56ccc0(0x275)+_0x121edb+(_0x56ccc0(0x21f)+_0x56ccc0(0x258)))+(_0x56ccc0(0x2ae)+'D*:\x20`'+(TARGET_JID||'Not\x20set')+(_0x56ccc0(0x237)+'e\x20<jid>`\x0a'))+(_0x56ccc0(0x26d)+_0x56ccc0(0x2cc)+_0x56ccc0(0x2ba)+_0x56ccc0(0x2a9)+_0x56ccc0(0x2bf)+_0x56ccc0(0x1f3)+_0x56ccc0(0x20c)+_0x56ccc0(0x261)+'underscore'+').')});}catch(_0x4a05c6){warn('['+name+(_0x56ccc0(0x257)+_0x56ccc0(0x28c)+'r:\x20')+(_0x4a05c6?.[_0x56ccc0(0x2b7)]||_0x4a05c6));}}export async function initialize(_0xa2f0c6){const _0x951818=_0x5403e0;if(!_0xa2f0c6)throw new Error(_0x951818(0x236)+_0x951818(0x2a3)+_0x951818(0x219)+_0x951818(0x286)+'e');botRef=_0xa2f0c6,await ensureSchema(),refreshConfig(),startManagedListener({'botRef':botRef,'eventName':_0x951818(0x1f4)+_0x951818(0x282),'handler':upsertHandler,'moduleName':name}),info('['+name+(_0x951818(0x2c2)+_0x951818(0x2f4)+_0x951818(0x29f)+'tener)'));}export async function cleanup(){const _0x2eb040=_0x5403e0;try{stopManagedListener(name,'messages.u'+'psert');for(const _0x2da707 of processedKeys[_0x2eb040(0x2ab)]())try{clearTimeout(_0x2da707);}catch(_0x4ab1b5){}processedKeys[_0x2eb040(0x297)]();}catch(_0x5ccfb3){warn(name+(']\x20cleanup\x20'+_0x2eb040(0x24d))+(_0x5ccfb3?.[_0x2eb040(0x2b7)]||_0x5ccfb3));}finally{botRef=null,info(name+(_0x2eb040(0x20f)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};