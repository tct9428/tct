const _0x3130c3=_0x192c;(function(_0xa40399,_0x43b241){const _0x1a3f8e=_0x192c,_0x10b205=_0xa40399();while(!![]){try{const _0x2ba564=-parseInt(_0x1a3f8e(0x193))/(0x8e*0x13+0xa86+-0x9*0x257)*(-parseInt(_0x1a3f8e(0x16c))/(0x14bf+-0x14*-0x2+0x14e5*-0x1))+parseInt(_0x1a3f8e(0x195))/(0x6*-0x5fb+-0x12cc+0x36b1)*(-parseInt(_0x1a3f8e(0x1f7))/(0x1*-0x2671+0xf75*-0x1+0x35ea))+parseInt(_0x1a3f8e(0x1ce))/(-0x4*-0x830+-0x33*-0xa3+0x104d*-0x4)*(parseInt(_0x1a3f8e(0x199))/(0x1214+-0x52*0x5d+0x5de*0x2))+parseInt(_0x1a3f8e(0x1e1))/(0x1*-0xfb6+0x197+0xe26)*(parseInt(_0x1a3f8e(0x1d2))/(0x204d*-0x1+0x2292*0x1+0xbf*-0x3))+parseInt(_0x1a3f8e(0x1f4))/(-0x6c*-0x1+-0x2225*0x1+0x21c2)+-parseInt(_0x1a3f8e(0x128))/(-0xab2+0x185+0x1*0x937)+-parseInt(_0x1a3f8e(0x100))/(0x1134+-0xab*-0x25+-0x29e0)*(parseInt(_0x1a3f8e(0x1e8))/(-0x1*0x2556+-0x115b+-0x123f*-0x3));if(_0x2ba564===_0x43b241)break;else _0x10b205['push'](_0x10b205['shift']());}catch(_0x2862ba){_0x10b205['push'](_0x10b205['shift']());}}}(_0x2f80,0x3aa06*0x1+-0x9206b*-0x1+0x5*0x2162));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name=_0x3130c3(0x1b3);export const version=_0x3130c3(0x14b)+_0x3130c3(0x190);export const priority=-0x1a55+-0x1c1f*0x1+0x36d3*0x1;export const commands=['viewonce'];export const configKeys=['VIEWONCE_S'+_0x3130c3(0x181)+_0x3130c3(0x1fb)+'_SOURCE','VIEWONCE_A'+'LLOW_GROUP'+'_COMMANDS_'+'DEFAULT'];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x1a4497=_0x3130c3;try{const _0x20b81f=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x20b81f[_0x1a4497(0xf6)+_0x1a4497(0x181)+_0x1a4497(0x1fb)+_0x1a4497(0x120)]!==undefined?Boolean(_0x20b81f[_0x1a4497(0xf6)+_0x1a4497(0x181)+_0x1a4497(0x1fb)+'_SOURCE']):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x20b81f[_0x1a4497(0x182)+_0x1a4497(0x146)+_0x1a4497(0x1d5)+'DEFAULT']??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(_0x1a4497(0x1e6)+'efreshed'));}catch(_0x376ca3){warn('['+name+(_0x1a4497(0x1de)+'onfig\x20erro'+_0x1a4497(0x13c))+(_0x376ca3?.[_0x1a4497(0x151)]||_0x376ca3));}}try{hotReloadConfig&&hotReloadConfig((_0x349d50=[])=>{const _0x212820=_0x3130c3,_0x255a9d=[_0x212820(0xf6)+_0x212820(0x181)+_0x212820(0x1fb)+'_SOURCE',_0x212820(0x182)+_0x212820(0x146)+_0x212820(0x1d5)+'DEFAULT'];if((_0x349d50||[])[_0x212820(0x106)](_0x35a387=>_0x255a9d[_0x212820(0x1a0)](_0x35a387)))refreshConfig();});}catch(_0x37ac0f){warn('['+name+(_0x3130c3(0x13d)+_0x3130c3(0x1cb)+'gistration'+_0x3130c3(0x178))+(_0x37ac0f?.[_0x3130c3(0x151)]||_0x37ac0f));}refreshConfig();async function ensureSchema(){const _0x33a1bd=_0x3130c3;try{await db['exec'](_0x33a1bd(0x172)+'ATE\x20TABLE\x20'+'IF\x20NOT\x20EXI'+_0x33a1bd(0x153)+'ce_prefs\x20('+_0x33a1bd(0x1b9)+'ey\x20TEXT\x20PR'+_0x33a1bd(0x163)+_0x33a1bd(0x115)+_0x33a1bd(0x1d7)+_0x33a1bd(0x1f9)+'\x20\x20\x20\x20\x20\x20\x20\x20up'+'dated_at\x20I'+'NTEGER\x20DEF'+_0x33a1bd(0x11b)+'\x20\x20\x20);\x0a\x20\x20\x20\x20');try{const _0x2ee04e=await db[_0x33a1bd(0x1d8)](_0x33a1bd(0x1bf)+_0x33a1bd(0x16d)+_0x33a1bd(0xf7)+_0x33a1bd(0x121)+_0x33a1bd(0x1aa));MODE=_0x2ee04e?.[_0x33a1bd(0x148)]==='g'?'g':'p';}catch(_0x421577){}try{const _0x44f3d9=await db['get'](_0x33a1bd(0x1bf)+_0x33a1bd(0x16d)+_0x33a1bd(0xf7)+_0x33a1bd(0x121)+_0x33a1bd(0x1c1)+_0x33a1bd(0x117));TARGET_JID=_0x44f3d9?.[_0x33a1bd(0x148)]||null;}catch(_0x28d155){TARGET_JID=null;}try{const _0x4fb4ba=await db[_0x33a1bd(0x1d8)]('SELECT\x20val'+'ue\x20FROM\x20vi'+_0x33a1bd(0xf7)+'fs\x20WHERE\x20k'+_0x33a1bd(0x11c)+_0x33a1bd(0x140)+_0x33a1bd(0x1d4));ALLOW_GROUP_COMMANDS=_0x4fb4ba?.['value']==='1';}catch(_0x1646f8){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x156da0=await db[_0x33a1bd(0x1d8)](_0x33a1bd(0x1bf)+'ue\x20FROM\x20vi'+_0x33a1bd(0xf7)+_0x33a1bd(0x121)+_0x33a1bd(0x1f2)+_0x33a1bd(0x164));NOTIFY_VIEWONCE=_0x156da0?.[_0x33a1bd(0x148)]==='1';}catch(_0x37fb79){NOTIFY_VIEWONCE=![];}info('['+name+(_0x33a1bd(0x119)+_0x33a1bd(0x1be))+MODE+_0x33a1bd(0x1e4)+(TARGET_JID||_0x33a1bd(0x1e5))+_0x33a1bd(0x1a6)+NOTIFY_VIEWONCE+(_0x33a1bd(0x125)+_0x33a1bd(0x139)+_0x33a1bd(0xf1))+ALLOW_GROUP_COMMANDS+')');}catch(_0x14a586){error(_0x14a586,'['+name+(_0x33a1bd(0x1ef)+_0x33a1bd(0x15f)+'d'));throw _0x14a586;}}async function savePref(_0x1b75ee,_0x209be9){const _0x3cda5e=_0x3130c3;try{const _0x1569a7=Math[_0x3cda5e(0x132)](Date[_0x3cda5e(0x192)]()/(-0x10e4+-0xee4+0x23b0));await db[_0x3cda5e(0x142)](_0x3cda5e(0x20e)+'O\x20viewonce'+_0x3cda5e(0x129)+_0x3cda5e(0xfa)+'dated_at)\x20'+_0x3cda5e(0x200)+_0x3cda5e(0x13b)+_0x3cda5e(0x187)+_0x3cda5e(0x1f8)+_0x3cda5e(0x1b2)+_0x3cda5e(0x130)+_0x3cda5e(0x209)+_0x3cda5e(0x126)+_0x3cda5e(0x174)+_0x3cda5e(0x126),[_0x1b75ee,_0x209be9,_0x1569a7]);}catch(_0x1b6549){return warn('['+name+(_0x3cda5e(0x10c)+_0x3cda5e(0xfc)+_0x3cda5e(0x1bc)+'r\x20')+_0x1b75ee+'='+_0x209be9+_0x3cda5e(0x20c)+(_0x1b6549?.[_0x3cda5e(0x151)]||_0x1b6549)),![];}try{const _0x159c77=await db[_0x3cda5e(0x1d8)](_0x3cda5e(0x1bf)+_0x3cda5e(0x16d)+_0x3cda5e(0xf7)+'fs\x20WHERE\x20k'+_0x3cda5e(0x1dd),[_0x1b75ee]),_0x329dcd=_0x159c77?.[_0x3cda5e(0x148)]??_0x209be9;if(_0x1b75ee===_0x3cda5e(0x1b7))MODE=_0x329dcd==='g'?'g':'p';if(_0x1b75ee==='target_jid')TARGET_JID=_0x329dcd||null;if(_0x1b75ee===_0x3cda5e(0x133)+_0x3cda5e(0x165))ALLOW_GROUP_COMMANDS=_0x329dcd==='1';if(_0x1b75ee===_0x3cda5e(0x1eb)+_0x3cda5e(0x145))NOTIFY_VIEWONCE=_0x329dcd==='1';return info('['+name+(_0x3cda5e(0x176)+_0x3cda5e(0x1f3)+_0x3cda5e(0x1ea))+_0x1b75ee+'='+_0x329dcd),!![];}catch(_0x318f06){warn('['+name+(_0x3cda5e(0x10c)+_0x3cda5e(0x108)+_0x3cda5e(0x19b)+'\x20failed\x20fo'+'r\x20')+_0x1b75ee+'='+_0x209be9+_0x3cda5e(0x20c)+(_0x318f06?.[_0x3cda5e(0x151)]||_0x318f06));if(_0x1b75ee===_0x3cda5e(0x1b7))MODE=_0x209be9==='g'?'g':'p';if(_0x1b75ee===_0x3cda5e(0x173))TARGET_JID=_0x209be9||null;if(_0x1b75ee===_0x3cda5e(0x133)+_0x3cda5e(0x165))ALLOW_GROUP_COMMANDS=_0x209be9==='1';if(_0x1b75ee===_0x3cda5e(0x1eb)+_0x3cda5e(0x145))NOTIFY_VIEWONCE=_0x209be9==='1';return!![];}}function normalizeToUserJid(_0x40029e){const _0x6e1f48=_0x3130c3;try{if(!_0x40029e||typeof _0x40029e!=='string')return _0x40029e;const _0x24211b=_0x40029e[_0x6e1f48(0x1d3)]('@');if(_0x24211b===-(-0x1b2+-0x62*-0x56+0x1*-0x1f39))return _0x40029e;const _0x3d4d8c=_0x40029e[_0x6e1f48(0x1b0)](0x8*0x293+-0x663+-0xe35*0x1,_0x24211b),_0x3d87be=_0x40029e[_0x6e1f48(0x1b0)](_0x24211b),_0x61b77e=_0x3d4d8c[_0x6e1f48(0x1d3)](':');if(_0x61b77e===-(-0xa92+-0x26cf+0x3162))return _0x40029e;return _0x3d4d8c[_0x6e1f48(0x1b0)](0x190b+0x1ac+-0x1ab7,_0x61b77e)+_0x3d87be;}catch(_0x290d9f){return _0x40029e;}}async function trySend(_0x1bec02,_0xae8931){const _0x465456=_0x3130c3;try{const _0x1f8776=normalizeToUserJid(String(_0x1bec02));if(!_0x1f8776)throw new Error(_0x465456(0x12e)+_0x465456(0x10f));if(typeof botRef?.['sendMessag'+'e']===_0x465456(0x20d)){await botRef[_0x465456(0x1a7)+'e'](_0x1f8776,_0xae8931);return;}if(botRef?.[_0x465456(0x135)]&&typeof botRef[_0x465456(0x135)][_0x465456(0x1a7)+'e']===_0x465456(0x20d)){await botRef[_0x465456(0x135)][_0x465456(0x1a7)+'e'](_0x1f8776,_0xae8931);return;}throw new Error(_0x465456(0x202)+'sage\x20avail'+_0x465456(0x1b8));}catch(_0x8df238){throw _0x8df238;}}const DEDUPE_TTL_MS=(-0x42a+-0x54e*-0x3+-0x1*0xbb6)*(0x23ed+-0x1*-0x4a9+-0x24ae),processedKeys=new Map();function markProcessed(_0x1fc2ad){const _0x4c2066=_0x3130c3;if(!_0x1fc2ad)return;if(processedKeys[_0x4c2066(0x16e)](_0x1fc2ad))try{clearTimeout(processedKeys[_0x4c2066(0x1d8)](_0x1fc2ad));}catch(_0x3f91f6){}const _0x2e103f=setTimeout(()=>processedKeys[_0x4c2066(0x1c5)](_0x1fc2ad),DEDUPE_TTL_MS);processedKeys['set'](_0x1fc2ad,_0x2e103f);}function isProcessed(_0x51ee86){const _0x456986=_0x3130c3;return _0x51ee86&&processedKeys[_0x456986(0x16e)](_0x51ee86);}function extractContextInfo(_0x313a48){const _0x516dfe=_0x3130c3;if(!_0x313a48||!_0x313a48[_0x516dfe(0x151)])return null;const _0x480df6=_0x313a48[_0x516dfe(0x151)];return _0x480df6[_0x516dfe(0x188)+'xtMessage']?.[_0x516dfe(0x104)+'o']||_0x480df6[_0x516dfe(0x104)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x3cff76){const _0x26e934=_0x3130c3;if(!_0x3cff76)return null;return _0x3cff76?.[_0x26e934(0x159)+_0x26e934(0x1af)]?.[_0x26e934(0x151)]||_0x3cff76?.['viewOnceMe'+_0x26e934(0x1a2)]?.['message']||(_0x3cff76['imageMessa'+'ge']?_0x3cff76:null)||(_0x3cff76[_0x26e934(0x1c7)+'ge']?_0x3cff76:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x1991f3){const _0x11b3ee=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x1991f3)return _0x11b3ee;return TARGET_JID;}return _0x11b3ee;}function stripDomain(_0x293ae1){const _0x57a470=_0x3130c3;if(!_0x293ae1||typeof _0x293ae1!==_0x57a470(0x19e))return _0x293ae1;const _0x1fdfe8=_0x293ae1['indexOf']('@');if(_0x1fdfe8===-(-0x1*-0x1663+-0x1209+-0x9f*0x7))return _0x293ae1;return _0x293ae1[_0x57a470(0x1b0)](-0x2336+-0x3*-0xc63+-0x1f3,_0x1fdfe8);}async function handleUpsertSingle(_0x21a06b){const _0x29e156=_0x3130c3;try{if(!_0x21a06b||!_0x21a06b[_0x29e156(0x1da)])return;if(_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x186)]===_0x29e156(0x196)+'adcast')return;if(Boolean(_0x21a06b['key']?.[_0x29e156(0x1b5)]))return;const _0x3b8204=String(_0x21a06b[_0x29e156(0x1da)][_0x29e156(0x186)]||'')+'::'+String(_0x21a06b['key']['id']||'');if(isProcessed(_0x3b8204))return;markProcessed(_0x3b8204);const _0x32191c=Boolean(_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x169)]),_0x46b819=Boolean(_0x21a06b[_0x29e156(0x151)]?.[_0x29e156(0x159)+'ssage']||_0x21a06b[_0x29e156(0x151)]?.[_0x29e156(0x159)+_0x29e156(0x1a2)]);if(!_0x32191c&&!_0x46b819)return;if(!NOTIFY_VIEWONCE)return;const _0x54bc72=_0x21a06b[_0x29e156(0x16a)]||_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x137)+'t']||_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x186)]||null,_0x364ca2=_0x54bc72?stripDomain(String(_0x54bc72)):_0x29e156(0x141),_0x5e2e71=_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x186)]?stripDomain(_0x21a06b[_0x29e156(0x1da)][_0x29e156(0x186)]):'unknown\x20ch'+'at',_0xc846bd=resolveDestination(_0x21a06b[_0x29e156(0x1da)]?.[_0x29e156(0x186)]);if(!_0xc846bd)return;const _0x5c67a5='👁️\x20Detected'+_0x29e156(0x207)+_0x29e156(0x158)+_0x364ca2+_0x29e156(0x122)+_0x5e2e71+(_0x29e156(0x1fe)+_0x29e156(0x180)+_0x29e156(0xf8)+_0x29e156(0x1b4)+_0x29e156(0x18c)+_0x29e156(0x109)+'\x27\x20(undersc'+'ore)\x20to\x20at'+_0x29e156(0x1db)+_0x29e156(0x105));try{await trySend(_0xc846bd,{'text':_0x5c67a5}),info('['+name+(_0x29e156(0x204)+'\x20')+_0xc846bd+(_0x29e156(0x118)+_0x29e156(0x14f))+_0x364ca2+'\x20in\x20'+_0x5e2e71);}catch(_0x4600d4){warn('['+name+(_0x29e156(0x14a)+_0x29e156(0x1c4)+':\x20')+(_0x4600d4?.['message']||_0x4600d4));}}catch(_0x53550d){warn('['+name+(_0x29e156(0x16f)+_0x29e156(0x12f)+_0x29e156(0x198))+(_0x53550d?.[_0x29e156(0x151)]||_0x53550d));}}async function upsertHandler({messages:_0x129f68}){const _0x3e3516=_0x3130c3;try{if(!Array[_0x3e3516(0x116)](_0x129f68))return;for(const _0x350357 of _0x129f68)await handleUpsertSingle(_0x350357);}catch(_0x352729){warn('['+name+(_0x3e3516(0xfb)+_0x3e3516(0x12b)+'r:\x20')+(_0x352729?.['message']||_0x352729));}}async function downloadBufferFromContent(_0x3b5aba,_0x1cd173){const _0x1187bc=_0x3130c3;try{if(!_0x3b5aba||!_0x1cd173)return null;const _0x36abcf=await downloadContentFromMessage(_0x3b5aba,_0x1cd173);if(!_0x36abcf)return null;const _0x346dd1=[];for await(const _0x41213d of _0x36abcf){_0x346dd1[_0x1187bc(0xfe)](_0x41213d);}if(!_0x346dd1['length'])return null;return Buffer[_0x1187bc(0x1ba)](_0x346dd1);}catch(_0x31820e){return warn('['+name+(_0x1187bc(0x10d)+_0x1187bc(0x1d9)+_0x1187bc(0x10e)+_0x1187bc(0x179))+(_0x31820e?.[_0x1187bc(0x151)]||_0x31820e)),null;}}async function forwardRecoveredToDest(_0x4d223f,_0x8c30a2,_0x559a2d,_0x4c4ab8){const _0x20bd2b=_0x3130c3,_0x505b7f=resolveDestination(_0x559a2d);if(!_0x505b7f)return warn('['+name+(_0x20bd2b(0x1c6)+_0x20bd2b(0x12c)+_0x20bd2b(0x154))),![];try{const _0x3b28f1=_0x4d223f?.[_0x20bd2b(0x1ad)+'ge']?.[_0x20bd2b(0x1f1)]||_0x4d223f?.[_0x20bd2b(0x1c7)+'ge']?.[_0x20bd2b(0x1f1)]||'',_0x5160fa=_0x4c4ab8?stripDomain(_0x4c4ab8):'unknown\x20us'+'er',_0x52e5b7=_0x559a2d?stripDomain(_0x559a2d):_0x20bd2b(0x201)+'at',_0x418315=_0x20bd2b(0x15e)+_0x5160fa+_0x20bd2b(0x18a)+_0x52e5b7,_0x169197=_0x20bd2b(0x162)+_0x20bd2b(0xfd)+_0x3b28f1+_0x418315;if(_0x4d223f[_0x20bd2b(0x1ad)+'ge'])return await trySend(_0x505b7f,{'image':_0x8c30a2,'caption':_0x169197}),info('['+name+(_0x20bd2b(0x127)+'overed\x20ima'+'ge\x20to\x20')+_0x505b7f),!![];if(_0x4d223f[_0x20bd2b(0x1c7)+'ge']){const _0x51eda4=Boolean(_0x4d223f[_0x20bd2b(0x1c7)+'ge']?.[_0x20bd2b(0x161)+'k']);return await trySend(_0x505b7f,{'video':_0x8c30a2,'caption':_0x169197,'gifPlayback':_0x51eda4}),info('['+name+(_0x20bd2b(0x127)+'overed\x20vid'+_0x20bd2b(0x11e))+_0x505b7f),!![];}return await trySend(_0x505b7f,{'document':_0x8c30a2,'fileName':_0x20bd2b(0x14d)+_0x20bd2b(0x131),'mimetype':_0x20bd2b(0x1fc)+_0x20bd2b(0x206)+_0x20bd2b(0x147),'caption':_0x169197}),info('['+name+(_0x20bd2b(0x127)+_0x20bd2b(0x1a3)+_0x20bd2b(0x1e3))+_0x505b7f),!![];}catch(_0x291e1b){return warn('['+name+(_0x20bd2b(0x124)+_0x20bd2b(0x19f)+'Dest\x20faile'+_0x20bd2b(0x10b))+(_0x291e1b?.[_0x20bd2b(0x151)]||_0x291e1b)),![];}}function extractTextFromCtx(_0x2a3c2e){const _0x1c86d1=_0x3130c3;if(!_0x2a3c2e||!_0x2a3c2e['message'])return'';const _0x9b1056=_0x2a3c2e['message'];return _0x9b1056[_0x1c86d1(0x1dc)+'on']||_0x9b1056['extendedTe'+'xtMessage']?.['text']||_0x9b1056[_0x1c86d1(0x1ad)+'ge']?.[_0x1c86d1(0x1f1)]||_0x9b1056[_0x1c86d1(0x1c7)+'ge']?.['caption']||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(0x3c0*0x1+-0x226b+0x1ec9)*(0x33a+0xdd*-0xd+0xbe7*0x1);function markCmdProcessed(_0x711194){const _0x17a221=_0x3130c3;if(!_0x711194)return;if(processedCmdKeys[_0x17a221(0x16e)](_0x711194))try{clearTimeout(processedCmdKeys[_0x17a221(0x1d8)](_0x711194));}catch(_0x1f225e){};const _0xee8bae=setTimeout(()=>processedCmdKeys[_0x17a221(0x1c5)](_0x711194),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x17a221(0x15c)](_0x711194,_0xee8bae);}function _0x192c(_0x203c83,_0x2c9408){const _0x1f4470=_0x2f80();return _0x192c=function(_0xbedc0a,_0x48e0ab){_0xbedc0a=_0xbedc0a-(0x1830+-0x65b+-0x10e5);let _0xf8cd5d=_0x1f4470[_0xbedc0a];return _0xf8cd5d;},_0x192c(_0x203c83,_0x2c9408);}function _0x2f80(){const _0x1c9e0c=['ey)\x20DO\x20UPD','NOT\x20NULL,\x0a','zed\x20(centr','GET_EQUALS','applicatio','\x20group:\x20','.\x0aReply\x20to',']\x20quoted\x20v','VALUES\x20(?,','unknown\x20ch','no\x20sendMes','JID\x20set.',']\x20Notified','*Target\x20JI','n/octet-st','\x20view-once','|off`\x0a','ed.value,\x20',']\x20no\x20confi','iew-once\x20i','\x20—\x20','function','INSERT\x20INT','selectedRo','ng\x20back\x20to','ds=','alized\x20lis','selectedBu',']\x20onMessag','get\x20JID.','VIEWONCE_S','ewonce_pre','age\x20with\x20a','charAt','y,value,up',']\x20upsertHa',':\x20DB\x20write','Recovered\x0a','push','nitialize\x20','1529Npjkwk',']\x20handleCo','ge\x20with\x20a\x20','and','contextInf','very.','some','Dest\x20retur',':\x20reload\x20a','s\x20with*\x20\x27_','\x20`viewonce','d:\x20',']\x20savePref',']\x20download','Content\x20er','rget','error:\x20','to\x20PM.','isCommand','ing\x20recove','\x20Target\x20JI','\x0a\x20\x20\x20\x20\x20\x20\x20\x20v','isArray','_jid\x27','\x20of\x20view-o',']\x20DB\x20ready','toLowerCas','AULT\x200\x0a\x20\x20\x20','ey=\x27allow_','OFF','eo\x20to\x20','urrently\x20*','_SOURCE','fs\x20WHERE\x20k','\x20in\x20chat\x20','ions*:\x20',']\x20forwardR',',\x20allow_gr','updated_at',']\x20Sent\x20rec','5626610grdeUY','_prefs\x20(ke','clear','ndler\x20erro','nation\x20res','t\x20supporte','no\x20send\x20ta','sertSingle','lue=exclud','bin','floor','allow_grou','\x20clear\x20tar','sock','psert','participan','at\x20starts\x20','oup_comman','essage\x20did','\x20?,\x20?)\x20ON\x20','r:\x20',']\x20hotReloa','video','split','group_comm','unknown','run','once\x20Setti',':\x20reply\x20to','wonce','LLOW_GROUP','ream','value','ia\x20buffer',']\x20notify\x20s','2.0.0-patc','remove','recovered.','tener)','nce\x20from\x20','emoteJid','message','ttonId','STS\x20viewon','olved','`\x20`viewonc','\x20Notificat','\x20save\x20noti','\x20from\x20','viewOnceMe','\x20notify\x20on','To\x20recover','set','catch','\x0a\x0afrom:\x20','hema\x20faile','image','gifPlaybac','View-Once\x20','IMARY\x20KEY,','_viewonce\x27','p_commands','ctReply','D*:\x20`','buttonsRes','isViewOnce','pushName','in\x20a\x20view-','122PoTcrT','ue\x20FROM\x20vi','has',']\x20handleUp','\x20cleaned\x20u','notify','\x0a\x20\x20\x20\x20\x20\x20CRE','target_jid','=excluded.',']\x20initiali',']\x20pref\x20sav','\x20Failed\x20to','\x20failed:\x20','ror:\x20','viewonce.i','D\x20cleared.','\x20not\x20conta','ngs\x20(PM-On','rmation\x20ta','et\x20JID:\x20','\x20that\x20mess','KIP_IF_TAR','VIEWONCE_A','endsWith','ponseMessa','requires\x20b','remoteJid','CONFLICT(k','extendedTe','seMessage','\x20in\x20','xtMessage','hat\x20*start',']\x20cleanup\x20','\x20the\x20view-','wId','hed','rting\x20comm','now','20789ZLAZBZ','d\x20unavaila','93uaqfmE','status@bro','\x20p|g`\x0a','\x20error:\x20','42hRWYur','e\x20handler\x20','fter\x20write','\x20-\x20attempt','o\x20download','string','ecoveredTo','includes','trim','ssageV2','overed\x20doc','*Send\x20Targ','Not\x20set',',\x20notify=','sendMessag',']\x20getBotJi',']\x20quoted\x20m','ey=\x27mode\x27','once\x20inner','setting.','imageMessa','rget\x20-\x20abo','ssage','slice','\x20set\x20mode.','ATE\x20SET\x20va','viewonce','\x20message\x20t','fromMe','age','mode','able','\x0a\x20\x20\x20\x20\x20\x20\x20\x20k','concat','[viewonce]','\x20failed\x20fo','text','\x20(mode=','SELECT\x20val','@g.us','ey=\x27target','listRespon','*Anti-View','end\x20failed','delete',']\x20no\x20desti','videoMessa','\x20ctx.key.r','d\x20media\x20ty',']\x20command\x20','dConfig\x20re','o\x20*',']\x20Reply\x20st','1120205vVoAUq','No\x20target\x20','*Notificat','underscore','2696SAyGxu','indexOf','ands\x27','_COMMANDS_',']\x20failed\x20t','alue\x20TEXT\x20','get','BufferFrom','key','tempt\x20reco','conversati','ey=?',']\x20refreshC','GROUP\x20(','ot\x20instanc','35056dlWBJP','messages.u','ument\x20to\x20',',\x20target=','unset',']\x20config\x20r','values','271764mdvEVK','ions\x20are\x20c','ded:\x20','notify_vie','true','message\x20th','ble;\x20falli',']\x20ensureSc','nner\x20is\x20no','caption','ey=\x27notify','ed\x20&\x20reloa','6945822QUgSWT','quotedMess','arts\x20with\x20','90876NedLCQ'];_0x2f80=function(){return _0x1c9e0c;};return _0x2f80();}function isCmdProcessed(_0x4f47a2){return _0x4f47a2&&processedCmdKeys['has'](_0x4f47a2);}const recentResponded=new Set();export async function onMessage(_0x38d0df){const _0x1d6410=_0x3130c3;try{if(!_0x38d0df||!_0x38d0df[_0x1d6410(0x1da)]||!_0x38d0df[_0x1d6410(0x151)])return;const _0x12253d=_0x38d0df['key']?.['id']||null;if(_0x12253d){if(recentResponded['has'](_0x12253d))return;recentResponded['add'](_0x12253d),setTimeout(()=>recentResponded[_0x1d6410(0x1c5)](_0x12253d),(0x144b+-0x803*0x1+-0xc0c)*(-0xd*-0x125+-0x1cd1+0x11d8));}if(_0x38d0df[_0x1d6410(0x112)]){const _0x23ab29=_0x38d0df[_0x1d6410(0x1da)]['remoteJid'],_0x1f518b=typeof _0x23ab29===_0x1d6410(0x19e)&&_0x23ab29[_0x1d6410(0x183)](_0x1d6410(0x1c0));if(_0x1f518b&&!ALLOW_GROUP_COMMANDS){}else{const _0x483478=Boolean(_0x38d0df[_0x1d6410(0x1da)][_0x1d6410(0x1b5)]);if(!_0x1f518b&&!_0x483478){const _0x125a84=await isSudo(botRef,_0x38d0df)[_0x1d6410(0x15d)](()=>![]);if(!_0x125a84){}else await handleCommand(_0x38d0df)[_0x1d6410(0x15d)](_0x245e56=>warn('['+name+(']\x20command\x20'+'error:\x20')+(_0x245e56?.['message']||_0x245e56)));}else{const _0x38fea5=await isSudo(botRef,_0x38d0df)[_0x1d6410(0x15d)](()=>![]),_0x405bbd=Boolean(_0x38d0df[_0x1d6410(0x1da)]['fromMe']);(_0x405bbd||_0x38fea5)&&await handleCommand(_0x38d0df)[_0x1d6410(0x15d)](_0x4d0397=>warn('['+name+(_0x1d6410(0x1ca)+_0x1d6410(0x110))+(_0x4d0397?.[_0x1d6410(0x151)]||_0x4d0397)));}}}const _0x154633=extractContextInfo(_0x38d0df);if(!_0x154633||!_0x154633['quotedMess'+_0x1d6410(0x1b6)])return;const _0x1fb486=extractTextFromCtx(_0x38d0df)||'';if(!_0x1fb486)return;const _0x2c2198=_0x1fb486[_0x1d6410(0x1a1)]()[_0x1d6410(0xf9)](0x187e+-0xaa8+0xb*-0x142);if(_0x2c2198!=='_')return;info('['+name+(_0x1d6410(0x1cd)+_0x1d6410(0x1f6)+'underscore'+_0x1d6410(0x19c)+_0x1d6410(0x113)+'ry'));const _0x16cdf4=extractViewOnceInnerFromQuoted(_0x154633[_0x1d6410(0x1f5)+_0x1d6410(0x1b6)]);if(!_0x16cdf4){warn('['+name+(_0x1d6410(0x1a9)+_0x1d6410(0x13a)+_0x1d6410(0x17c)+_0x1d6410(0x16b)+_0x1d6410(0x1ab)+'\x20message'));return;}let _0x56dbef=null,_0x4ed76f=null;if(_0x16cdf4[_0x1d6410(0x1ad)+'ge'])_0x56dbef=_0x16cdf4[_0x1d6410(0x1ad)+'ge'],_0x4ed76f=_0x1d6410(0x160);else _0x16cdf4[_0x1d6410(0x1c7)+'ge']&&(_0x56dbef=_0x16cdf4[_0x1d6410(0x1c7)+'ge'],_0x4ed76f=_0x1d6410(0x13e));if(!_0x56dbef||!_0x4ed76f){warn('['+name+(_0x1d6410(0x1ff)+_0x1d6410(0x20b)+_0x1d6410(0x1f0)+_0x1d6410(0x12d)+_0x1d6410(0x1c9)+'pe'));return;}const _0x45607d=await downloadBufferFromContent(_0x56dbef,_0x4ed76f);if(!_0x45607d){warn('['+name+(_0x1d6410(0x1d6)+_0x1d6410(0x19d)+'\x20inner\x20med'+_0x1d6410(0x149)));return;}const _0x342f8b=_0x38d0df[_0x1d6410(0x1da)][_0x1d6410(0x186)]||null,_0x3b9b67=_0x154633[_0x1d6410(0x137)+'t']||null,_0x16cf51=await forwardRecoveredToDest(_0x16cdf4,_0x45607d,_0x342f8b,_0x3b9b67);if(!_0x16cf51)warn('['+name+(_0x1d6410(0x124)+_0x1d6410(0x19f)+_0x1d6410(0x107)+'ned\x20false'));}catch(_0x993ca3){error(_0x993ca3,'['+name+(_0x1d6410(0xf4)+_0x1d6410(0x19a)+_0x1d6410(0x110))+(_0x993ca3?.['message']||_0x993ca3));}}async function handleCommand(_0x13361a){const _0x3967d9=_0x3130c3;try{if(!_0x13361a||!_0x13361a[_0x3967d9(0x1da)]||!_0x13361a[_0x3967d9(0x151)])return;const _0x45ca78=_0x13361a[_0x3967d9(0x1da)]['remoteJid'],_0x519781=typeof _0x45ca78===_0x3967d9(0x19e)&&_0x45ca78[_0x3967d9(0x183)]('@g.us');if(_0x519781&&!ALLOW_GROUP_COMMANDS)return;const _0x5b3932=Boolean(_0x13361a['key'][_0x3967d9(0x1b5)]);if(!_0x519781&&!_0x5b3932){const _0x25b8c2=await isSudo(botRef,_0x13361a)[_0x3967d9(0x15d)](()=>![]);if(!_0x25b8c2)return;}const _0x33b825=Boolean(_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x1b5)]),_0x5b8eb1=await isSudo(botRef,_0x13361a)[_0x3967d9(0x15d)](()=>![]);let _0x4249fe;if(_0x33b825)_0x4249fe=getBotJid()||_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x186)]||_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x137)+'t']||null,!_0x4249fe&&(warn('['+name+(_0x3967d9(0x1a8)+_0x3967d9(0x194)+_0x3967d9(0x1ee)+_0x3967d9(0xf0)+_0x3967d9(0x1c8)+_0x3967d9(0x150))),_0x4249fe=_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x186)]||null);else{if(_0x5b8eb1)_0x4249fe=_0x13361a[_0x3967d9(0x1da)]['remoteJid'];else return;}if(!_0x4249fe){warn('['+name+(_0x3967d9(0x20a)+_0x3967d9(0x17e)+_0x3967d9(0x1ae)+_0x3967d9(0x191)+_0x3967d9(0x103)));return;}const _0x5da288=String(_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x186)]||'')+'::'+String(_0x13361a[_0x3967d9(0x1da)]['id']||_0x13361a[_0x3967d9(0x1da)][_0x3967d9(0x137)+'t']||'');if(isCmdProcessed(_0x5da288))return;markCmdProcessed(_0x5da288);const _0x2f0936=typeof _0x13361a[_0x3967d9(0x1bd)]===_0x3967d9(0x19e)&&_0x13361a[_0x3967d9(0x1bd)][_0x3967d9(0x1a1)]()['length']?_0x13361a['text'][_0x3967d9(0x1a1)]():function _0x50c883(_0x240069){const _0x31ffcf=_0x3967d9;if(!_0x240069||!_0x240069['message'])return'';const _0x1ac3c7=_0x240069[_0x31ffcf(0x151)];if(_0x1ac3c7['conversati'+'on'])return _0x1ac3c7[_0x31ffcf(0x1dc)+'on'];if(_0x1ac3c7[_0x31ffcf(0x188)+_0x31ffcf(0x18b)]?.[_0x31ffcf(0x1bd)])return _0x1ac3c7[_0x31ffcf(0x188)+_0x31ffcf(0x18b)][_0x31ffcf(0x1bd)];if(_0x1ac3c7[_0x31ffcf(0x1ad)+'ge']?.[_0x31ffcf(0x1f1)])return _0x1ac3c7[_0x31ffcf(0x1ad)+'ge'][_0x31ffcf(0x1f1)];if(_0x1ac3c7[_0x31ffcf(0x1c7)+'ge']?.[_0x31ffcf(0x1f1)])return _0x1ac3c7['videoMessa'+'ge'][_0x31ffcf(0x1f1)];if(_0x1ac3c7[_0x31ffcf(0x168)+_0x31ffcf(0x184)+'ge']?.[_0x31ffcf(0xf3)+'ttonId'])return _0x1ac3c7[_0x31ffcf(0x168)+'ponseMessa'+'ge'][_0x31ffcf(0xf3)+_0x31ffcf(0x152)];if(_0x1ac3c7[_0x31ffcf(0x1c2)+'seMessage']?.['singleSele'+_0x31ffcf(0x166)]?.[_0x31ffcf(0x20f)+_0x31ffcf(0x18f)])return _0x1ac3c7[_0x31ffcf(0x1c2)+_0x31ffcf(0x189)]['singleSele'+'ctReply'][_0x31ffcf(0x20f)+_0x31ffcf(0x18f)];return'';}(_0x13361a)||'';if(!_0x2f0936)return;const _0x4000d9=(_0x2f0936[_0x3967d9(0x13f)](/\r?\n/)[-0x3*0x487+0x1939+-0xba4]||'')['trim'](),_0x4a3e04=_0x4000d9['split'](/\s+/),_0x1b0736=(_0x4a3e04[-0x1*-0x679+0x158+-0x7d1]||'')[_0x3967d9(0x11a)+'e']();if(!commands[_0x3967d9(0x1a0)](_0x1b0736))return;const _0x342928=(_0x4a3e04[0xf8d+-0x1b27*-0x1+0x283*-0x11]||'')[_0x3967d9(0x11a)+'e']();if(_0x342928===_0x3967d9(0x171)){const _0x345b6a=(_0x4a3e04[-0x15b5+0x3d*-0x1+0x15f4]||'')[_0x3967d9(0x11a)+'e']();if(!_0x345b6a){await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x156)+_0x3967d9(0x1e9)+_0x3967d9(0x11f)+(NOTIFY_VIEWONCE?'ON':'OFF')+'*'});return;}const _0x4e125f=_0x345b6a==='on'||_0x345b6a==='1'||_0x345b6a===_0x3967d9(0x1ec),_0x525f2a=await savePref(_0x3967d9(0x1eb)+'wonce',_0x4e125f?'1':'0');if(!_0x525f2a){await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x177)+_0x3967d9(0x157)+'fications\x20'+_0x3967d9(0x1ac)});return;}await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x156)+'ions\x20set\x20t'+_0x3967d9(0x1cc)+(_0x4e125f?'ON':_0x3967d9(0x11d))+'*'});return;}if(_0x342928==='p'||_0x342928==='pm'){const _0x60ac97=await savePref('mode','p');if(!_0x60ac97){await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x177)+_0x3967d9(0x1b1)});return;}await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+'\x20Mode\x20set\x20'+_0x3967d9(0x111)});return;}if(_0x342928==='g'||_0x342928==='group'||_0x342928==='gp'){const _0x136d7b=await savePref('mode','g');if(!_0x136d7b){await trySend(_0x4249fe,{'text':'[viewonce]'+_0x3967d9(0x177)+_0x3967d9(0x1b1)});return;}const _0x41ce92=TARGET_JID?'Configured'+_0x3967d9(0x1fd)+TARGET_JID:_0x3967d9(0x1cf)+_0x3967d9(0x203);await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+'\x20Mode\x20set\x20'+'to\x20GROUP.\x20'+_0x41ce92});return;}if(_0x342928&&_0x342928['includes']('@')){const _0x125944=normalizeToUserJid(_0x342928),_0x12fd7d=await savePref(_0x3967d9(0x173),_0x125944);if(_0x12fd7d)await trySend(_0x4249fe,{'text':'[viewonce]'+_0x3967d9(0x114)+'D\x20saved:\x20'+_0x125944});else await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x177)+'\x20save\x20targ'+_0x3967d9(0x17f)+_0x125944});return;}if(_0x342928===_0x3967d9(0x12a)||_0x342928===_0x3967d9(0x1e5)||_0x342928===_0x3967d9(0x14c)){const _0x49ea22=await savePref(_0x3967d9(0x173),'');if(_0x49ea22)await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x114)+_0x3967d9(0x17b)});else await trySend(_0x4249fe,{'text':_0x3967d9(0x1bb)+_0x3967d9(0x177)+_0x3967d9(0x134)+_0x3967d9(0xf5)});return;}const _0x17beed=MODE==='g'?_0x3967d9(0x1df)+(TARGET_JID||'not\x20set')+')':'PM';await trySend(_0x4249fe,{'text':_0x3967d9(0x1c3)+_0x3967d9(0x143)+_0x3967d9(0x17d)+'ly)*\x0a\x0a'+(_0x3967d9(0x1d0)+_0x3967d9(0x123)+(NOTIFY_VIEWONCE?'ON':_0x3967d9(0x11d))+(_0x3967d9(0x10a)+_0x3967d9(0x15a)+_0x3967d9(0x208)))+(_0x3967d9(0x1a4)+'et*:\x20'+_0x17beed+(_0x3967d9(0x10a)+_0x3967d9(0x197)))+(_0x3967d9(0x205)+_0x3967d9(0x167)+(TARGET_JID||_0x3967d9(0x1a5))+(_0x3967d9(0x155)+'e\x20<jid>`\x0a'))+(_0x3967d9(0x15b)+_0x3967d9(0x144)+_0x3967d9(0x18e)+'once\x20messa'+_0x3967d9(0x102)+_0x3967d9(0x1ed)+_0x3967d9(0x138)+'with\x20\x27_\x27\x20('+_0x3967d9(0x1d1)+').')});}catch(_0x532f1c){warn('['+name+(_0x3967d9(0x101)+'mmand\x20erro'+_0x3967d9(0x13c))+(_0x532f1c?.[_0x3967d9(0x151)]||_0x532f1c));}}export async function initialize(_0x12914d){const _0x26eff5=_0x3130c3;if(!_0x12914d)throw new Error(_0x26eff5(0x17a)+_0x26eff5(0xff)+_0x26eff5(0x185)+_0x26eff5(0x1e0)+'e');botRef=_0x12914d,await ensureSchema(),refreshConfig(),startManagedListener({'botRef':botRef,'eventName':_0x26eff5(0x1e2)+_0x26eff5(0x136),'handler':upsertHandler,'moduleName':name}),info('['+name+(_0x26eff5(0x175)+_0x26eff5(0x1fa)+_0x26eff5(0xf2)+_0x26eff5(0x14e)));}export async function cleanup(){const _0xb641e4=_0x3130c3;try{stopManagedListener(name,_0xb641e4(0x1e2)+_0xb641e4(0x136));for(const _0x4040d2 of processedKeys[_0xb641e4(0x1e7)]())try{clearTimeout(_0x4040d2);}catch(_0x357640){}processedKeys[_0xb641e4(0x12a)]();}catch(_0x2f4a54){warn(name+(_0xb641e4(0x18d)+_0xb641e4(0x110))+(_0x2f4a54?.[_0xb641e4(0x151)]||_0x2f4a54));}finally{botRef=null,info(name+(_0xb641e4(0x170)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};