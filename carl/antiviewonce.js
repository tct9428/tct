const _0x29d4a9=_0x1469;(function(_0x4f146b,_0x243b3b){const _0x174fef=_0x1469,_0x4537bb=_0x4f146b();while(!![]){try{const _0x835971=-parseInt(_0x174fef(0x15d))/(-0x598+0xe5e+-0x8c5)*(parseInt(_0x174fef(0x186))/(-0x79f*0x1+-0x1a9b+0x223c))+-parseInt(_0x174fef(0x1ec))/(0x900*0x4+-0x3*0x5d1+0x71*-0x2a)*(-parseInt(_0x174fef(0x189))/(-0x1167+-0x270*-0x1+0xefb))+parseInt(_0x174fef(0x198))/(-0x1d8b+0x182b+0x565)*(-parseInt(_0x174fef(0x1c3))/(-0x15e0+-0x7b*0x24+0x2732))+-parseInt(_0x174fef(0x1ad))/(-0x1*0xa39+0xb2*0x2b+0x3ee*-0x5)*(-parseInt(_0x174fef(0x120))/(-0x900+0x1b39+-0x1231))+parseInt(_0x174fef(0x20f))/(0x1*0x1941+0x21f3+-0x99*0x63)*(parseInt(_0x174fef(0x175))/(0x2*-0x4d+0x7b4*-0x4+-0x2*-0xfba))+-parseInt(_0x174fef(0x1e1))/(-0x1*-0x24e2+0x1607+-0x3ade)+-parseInt(_0x174fef(0x121))/(-0x266c+-0xd67+0x33df)*(parseInt(_0x174fef(0x1f6))/(-0x162b+0x1*-0xd79+-0x23b1*-0x1));if(_0x835971===_0x243b3b)break;else _0x4537bb['push'](_0x4537bb['shift']());}catch(_0x3348c1){_0x4537bb['push'](_0x4537bb['shift']());}}}(_0x3f16,0xe771+-0x5da88+0x769*0x23e));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x29d4a9(0x21f);export const version=_0x29d4a9(0x22c);export const priority=0xd8b*0x1+0x1c10+-0x196*0x1a;export const commands=[_0x29d4a9(0x21f)];function _0x1469(_0x4d6f2f,_0x25e4c2){const _0x403833=_0x3f16();return _0x1469=function(_0x51f09a,_0x3c99cb){_0x51f09a=_0x51f09a-(-0x22a3*0x1+0x1*0x21a4+-0x1*-0x21b);let _0x5a6875=_0x403833[_0x51f09a];return _0x5a6875;},_0x1469(_0x4d6f2f,_0x25e4c2);}export const configKeys=[_0x29d4a9(0x15f)+_0x29d4a9(0x176)+_0x29d4a9(0x134)+_0x29d4a9(0x200),'VIEWONCE_A'+_0x29d4a9(0x164)+'_COMMANDS_'+_0x29d4a9(0x1e0)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x4e3e5b=_0x29d4a9;try{const _0x4aa99d=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x4aa99d[_0x4e3e5b(0x15f)+_0x4e3e5b(0x176)+_0x4e3e5b(0x134)+'_SOURCE']!==undefined?Boolean(_0x4aa99d[_0x4e3e5b(0x15f)+_0x4e3e5b(0x176)+_0x4e3e5b(0x134)+_0x4e3e5b(0x200)]):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x4aa99d[_0x4e3e5b(0x1e8)+_0x4e3e5b(0x164)+'_COMMANDS_'+_0x4e3e5b(0x1e0)]??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(_0x4e3e5b(0x1e9)+_0x4e3e5b(0x1d2)));}catch(_0xcc2cad){warn('['+name+(_0x4e3e5b(0x154)+'onfig\x20erro'+_0x4e3e5b(0x15a))+(_0xcc2cad?.[_0x4e3e5b(0x1ff)]||_0xcc2cad));}}try{hotReloadConfig&&hotReloadConfig((_0x2584cb=[])=>{const _0x23edb8=_0x29d4a9,_0xcf2805=[_0x23edb8(0x15f)+_0x23edb8(0x176)+_0x23edb8(0x134)+_0x23edb8(0x200),_0x23edb8(0x1e8)+'LLOW_GROUP'+_0x23edb8(0x221)+_0x23edb8(0x1e0)];if((_0x2584cb||[])[_0x23edb8(0x1b6)](_0x237c21=>_0xcf2805[_0x23edb8(0x1ed)](_0x237c21)))refreshConfig();});}catch(_0xf9e4bd){warn('['+name+(_0x29d4a9(0x12f)+_0x29d4a9(0x1dc)+_0x29d4a9(0x129)+'\x20failed:\x20')+(_0xf9e4bd?.['message']||_0xf9e4bd));}refreshConfig();async function ensureSchema(){const _0x3413fa=_0x29d4a9;try{await db['exec'](_0x3413fa(0x123)+_0x3413fa(0x18f)+'IF\x20NOT\x20EXI'+'STS\x20viewon'+_0x3413fa(0x167)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20k'+_0x3413fa(0x149)+_0x3413fa(0x19d)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20v'+'alue\x20TEXT\x20'+_0x3413fa(0x1d1)+_0x3413fa(0x179)+_0x3413fa(0x153)+'NTEGER\x20DEF'+'AULT\x200\x0a\x20\x20\x20'+_0x3413fa(0x1e5));try{const _0x4c7745=await db['get']('SELECT\x20val'+_0x3413fa(0x21d)+_0x3413fa(0x183)+'fs\x20WHERE\x20k'+_0x3413fa(0x21a));MODE=_0x4c7745?.[_0x3413fa(0x215)]==='g'?'g':'p';}catch(_0x5d8520){}try{const _0x3672b6=await db[_0x3413fa(0x1ca)](_0x3413fa(0x16c)+_0x3413fa(0x21d)+_0x3413fa(0x183)+'fs\x20WHERE\x20k'+_0x3413fa(0x16a)+_0x3413fa(0x1f5));TARGET_JID=_0x3672b6?.['value']||null;}catch(_0x5c7fa6){TARGET_JID=null;}try{const _0x1e4a49=await db['get'](_0x3413fa(0x16c)+_0x3413fa(0x21d)+'ewonce_pre'+_0x3413fa(0x160)+'ey=\x27allow_'+_0x3413fa(0x146)+_0x3413fa(0x1f4));ALLOW_GROUP_COMMANDS=_0x1e4a49?.['value']==='1';}catch(_0x28aae1){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x539037=await db[_0x3413fa(0x1ca)](_0x3413fa(0x16c)+'ue\x20FROM\x20vi'+_0x3413fa(0x183)+_0x3413fa(0x160)+_0x3413fa(0x17b)+_0x3413fa(0x172));NOTIFY_VIEWONCE=_0x539037?.[_0x3413fa(0x215)]==='1';}catch(_0x7ab47b){NOTIFY_VIEWONCE=![];}info('['+name+(']\x20DB\x20ready'+'\x20(mode=')+MODE+',\x20target='+(TARGET_JID||_0x3413fa(0x182))+_0x3413fa(0x13b)+NOTIFY_VIEWONCE+(_0x3413fa(0x1b0)+_0x3413fa(0x222)+_0x3413fa(0x1b8))+ALLOW_GROUP_COMMANDS+')');}catch(_0x18b500){error(_0x18b500,'['+name+(_0x3413fa(0x19c)+_0x3413fa(0x13d)+'d'));throw _0x18b500;}}function _0x3f16(){const _0x4ef220=['set','r:\x20','\x0a\x0afrom:\x20','üëÅÔ∏è\x20Detected','1HQkVdp',']\x20Reply\x20st','VIEWONCE_S','fs\x20WHERE\x20k','*Target\x20JI','\x20save\x20targ','length','LLOW_GROUP','videoMessa','once\x20messa','ce_prefs\x20(','JID\x20set.','\x20from\x20','ey=\x27target','toLowerCas','SELECT\x20val','fromMe',']\x20handleCo','y,value,up','ing\x20recove','\x27\x20(undersc','_viewonce\x27','ions\x20set\x20t','ecoveredTo','15288550QHVESE','KIP_IF_TAR',']\x20download',']\x20failed\x20t','\x20\x20\x20\x20\x20\x20\x20\x20up','ument\x20to\x20','ey=\x27notify','urrently\x20*','message\x20th','ble;\x20falli','ssage','text','caption','unset','ewonce_pre','\x20Notificat','ot\x20instanc','1353794CIXflm','Not\x20set','wonce','8672tRJFVl',']\x20Sent\x20rec','endsWith','status@bro','slice','remoteJid','ATE\x20TABLE\x20','VALUES\x20(?,','with\x20\x27_\x27\x20(','ey)\x20DO\x20UPD','setting.','sage\x20avail','CONFLICT(k','true','d\x20unavaila','6835885LncxsA','iew-once\x20i','singleSele','et\x20JID:\x20',']\x20ensureSc','IMARY\x20KEY,','not\x20set','|off`\x0a','floor','\x20message\x20t','indexOf','applicatio','essage\x20did','no\x20sendMes','ndler\x20erro','\x20Failed\x20to','ed\x20&\x20reloa','to\x20GROUP.\x20','Dest\x20faile','and','push','7eoPQNp','participan',']\x20command\x20',',\x20allow_gr','D\x20cleared.','e\x20handler\x20','concat',']\x20handleUp','no\x20send\x20ta','some','ge\x20to\x20','ds=',']\x20onMessag','very.','*Send\x20Targ','fter\x20write','able','key','psert','sertSingle','selectedRo','bin','6PcoWlm','\x20notify\x20on','fications\x20','\x20cleaned\x20u','now','once\x20Setti','values','get','\x20-\x20attempt','mmand\x20erro','seMessage','GROUP\x20(','*Notificat','\x20?,\x20?)\x20ON\x20','NOT\x20NULL,\x0a','efreshed','in\x20a\x20view-','ions\x20are\x20c','\x20clear\x20tar','[viewonce]','\x20set\x20mode.','contextInf','lue=exclud','run','INSERT\x20INT','dConfig\x20re','olved','\x20view-once','buttonsRes','DEFAULT','5004791UdPdeu','\x20of\x20view-o','extendedTe','image','\x20\x20\x20);\x0a\x20\x20\x20\x20','ATE\x20SET\x20va','imageMessa','VIEWONCE_A',']\x20config\x20r',']\x20cleanup\x20','mode','894xnEpLw','includes','arts\x20with\x20','unknown','nation\x20res','\x20error:\x20','\x20‚Äî\x20','notify','ands\x27','_jid\x27','9308aDgfWd','viewonce.i','overed\x20vid','Configured','error:\x20','unknown\x20us','ions*:\x20','age','ror:\x20','message','_SOURCE','function','string','ssageV2','ngs\x20(PM-On','unknown\x20ch','\x20inner\x20med',']\x20forwardR','video',']\x20Notified','rget\x20-\x20abo',']\x20upsertHa','rget','sock','conversati','9gQvhMh','sendMessag','has','ream','isViewOnce','pushName','value','group','viewOnceMe','charAt','isCommand','ey=\x27mode\x27','catch','ge\x20with\x20a\x20','ue\x20FROM\x20vi','\x20that\x20mess','viewonce','p_commands','_COMMANDS_','oup_comman','allow_grou','tener)','age\x20with\x20a',']\x20quoted\x20m','requires\x20b','ore)\x20to\x20at','split','D*:\x20`','Content\x20er','2.1.0','ed.value,\x20',':\x20reload\x20a','delete','`\x20`viewonc','wId','9367832vVTSPb','1380Xzzqvg','o\x20download','\x0a\x20\x20\x20\x20\x20\x20CRE','adcast','recovered.','ponseMessa','emoteJid','\x20not\x20conta','gistration','tempt\x20reco',']\x20savePref','off','ctReply','ttonId',']\x20hotReloa','\x20failed\x20fo','*Anti-View','quotedMess','\x20`viewonce','GET_EQUALS','end\x20failed','nner\x20is\x20no','hat\x20*start','\x20save\x20noti','gifPlaybac','clear',',\x20notify=','trim','hema\x20faile','Recovered\x0a','e\x20<jid>`\x0a','listRespon','xtMessage','overed\x20ima',':\x20DB\x20write','d:\x20','\x20the\x20view-','group_comm','target_jid','notify_vie','ey\x20TEXT\x20PR','OFF','View-Once\x20','\x20group:\x20',']\x20notify\x20s','messages.u','ia\x20buffer','\x20Target\x20JI','to\x20PM.','updated_at','dated_at\x20I',']\x20refreshC','ded:\x20','underscore','\x20ctx.key.r',']\x20quoted\x20v'];_0x3f16=function(){return _0x4ef220;};return _0x3f16();}async function savePref(_0x2d9fff,_0x210574){const _0x5b2564=_0x29d4a9;try{const _0x1cd96a=Math[_0x5b2564(0x1a0)](Date[_0x5b2564(0x1c7)]()/(-0x3*0x2f0+-0x29+0x3*0x44b));await db[_0x5b2564(0x1da)](_0x5b2564(0x1db)+'O\x20viewonce'+'_prefs\x20(ke'+_0x5b2564(0x16f)+'dated_at)\x20'+_0x5b2564(0x190)+_0x5b2564(0x1d0)+_0x5b2564(0x195)+_0x5b2564(0x192)+_0x5b2564(0x1e6)+_0x5b2564(0x1d9)+_0x5b2564(0x22d)+_0x5b2564(0x152)+'=excluded.'+'updated_at',[_0x2d9fff,_0x210574,_0x1cd96a]);}catch(_0x111fc6){return warn('['+name+(_0x5b2564(0x12b)+_0x5b2564(0x143)+'\x20failed\x20fo'+'r\x20')+_0x2d9fff+'='+_0x210574+_0x5b2564(0x1f2)+(_0x111fc6?.[_0x5b2564(0x1ff)]||_0x111fc6)),![];}try{const _0x1d6f89=await db['get'](_0x5b2564(0x16c)+'ue\x20FROM\x20vi'+_0x5b2564(0x183)+_0x5b2564(0x160)+'ey=?',[_0x2d9fff]),_0x4c4ab2=_0x1d6f89?.[_0x5b2564(0x215)]??_0x210574;if(_0x2d9fff===_0x5b2564(0x1eb))MODE=_0x4c4ab2==='g'?'g':'p';if(_0x2d9fff===_0x5b2564(0x147))TARGET_JID=_0x4c4ab2||null;if(_0x2d9fff==='allow_grou'+_0x5b2564(0x220))ALLOW_GROUP_COMMANDS=_0x4c4ab2==='1';if(_0x2d9fff===_0x5b2564(0x148)+_0x5b2564(0x188))NOTIFY_VIEWONCE=_0x4c4ab2==='1';return info('['+name+(']\x20pref\x20sav'+_0x5b2564(0x1a8)+_0x5b2564(0x155))+_0x2d9fff+'='+_0x4c4ab2),!![];}catch(_0x17b857){warn('['+name+(_0x5b2564(0x12b)+_0x5b2564(0x11c)+_0x5b2564(0x1bc)+_0x5b2564(0x130)+'r\x20')+_0x2d9fff+'='+_0x210574+_0x5b2564(0x1f2)+(_0x17b857?.['message']||_0x17b857));if(_0x2d9fff===_0x5b2564(0x1eb))MODE=_0x210574==='g'?'g':'p';if(_0x2d9fff==='target_jid')TARGET_JID=_0x210574||null;if(_0x2d9fff===_0x5b2564(0x223)+_0x5b2564(0x220))ALLOW_GROUP_COMMANDS=_0x210574==='1';if(_0x2d9fff===_0x5b2564(0x148)+_0x5b2564(0x188))NOTIFY_VIEWONCE=_0x210574==='1';return!![];}}function normalizeToUserJid(_0x5d1c05){const _0x1f361c=_0x29d4a9;try{if(!_0x5d1c05||typeof _0x5d1c05!==_0x1f361c(0x202))return _0x5d1c05;const _0x2fd2de=_0x5d1c05[_0x1f361c(0x1a2)]('@');if(_0x2fd2de===-(-0x9cb+-0x5*0x67a+-0x2a2e*-0x1))return _0x5d1c05;const _0x5695be=_0x5d1c05[_0x1f361c(0x18d)](0x1b02+0x1718+-0x321a,_0x2fd2de),_0x539842=_0x5d1c05['slice'](_0x2fd2de),_0x28a03c=_0x5695be[_0x1f361c(0x1a2)](':');if(_0x28a03c===-(-0x968+0x1*0x1543+0x2*-0x5ed))return _0x5d1c05;return _0x5695be[_0x1f361c(0x18d)](-0x3e9*-0x5+0x9ae+-0x1d3b*0x1,_0x28a03c)+_0x539842;}catch(_0x17b52b){return _0x5d1c05;}}async function trySend(_0x5ec79f,_0x475270){const _0x501b14=_0x29d4a9;try{const _0x56566d=normalizeToUserJid(String(_0x5ec79f));if(!_0x56566d)throw new Error(_0x501b14(0x1b5)+_0x501b14(0x20c));if(typeof botRef?.[_0x501b14(0x210)+'e']===_0x501b14(0x201)){await botRef['sendMessag'+'e'](_0x56566d,_0x475270);return;}if(botRef?.[_0x501b14(0x20d)]&&typeof botRef['sock']['sendMessag'+'e']==='function'){await botRef['sock'][_0x501b14(0x210)+'e'](_0x56566d,_0x475270);return;}throw new Error(_0x501b14(0x1a5)+_0x501b14(0x194)+_0x501b14(0x1bd));}catch(_0x40c6b6){throw _0x40c6b6;}}const DEDUPE_TTL_MS=(0x611+0x1147+-0x174e)*(0x2456+0x946+0x9d*-0x44),processedKeys=new Map();function markProcessed(_0x551949){const _0x4a84ab=_0x29d4a9;if(!_0x551949)return;if(processedKeys[_0x4a84ab(0x211)](_0x551949))try{clearTimeout(processedKeys[_0x4a84ab(0x1ca)](_0x551949));}catch(_0x4b728a){}const _0x33eb09=setTimeout(()=>processedKeys[_0x4a84ab(0x11d)](_0x551949),DEDUPE_TTL_MS);processedKeys[_0x4a84ab(0x159)](_0x551949,_0x33eb09);}function isProcessed(_0x57acf8){const _0x2f92aa=_0x29d4a9;return _0x57acf8&&processedKeys[_0x2f92aa(0x211)](_0x57acf8);}function extractContextInfo(_0x580e4a){const _0xf306e8=_0x29d4a9;if(!_0x580e4a||!_0x580e4a[_0xf306e8(0x1ff)])return null;const _0xa44e09=_0x580e4a[_0xf306e8(0x1ff)];return _0xa44e09[_0xf306e8(0x1e3)+_0xf306e8(0x141)]?.[_0xf306e8(0x1d8)+'o']||_0xa44e09[_0xf306e8(0x1d8)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x1c1ede){const _0x503d0e=_0x29d4a9;if(!_0x1c1ede)return null;return _0x1c1ede?.['viewOnceMe'+_0x503d0e(0x17f)]?.[_0x503d0e(0x1ff)]||_0x1c1ede?.[_0x503d0e(0x217)+_0x503d0e(0x203)]?.[_0x503d0e(0x1ff)]||(_0x1c1ede[_0x503d0e(0x1e7)+'ge']?_0x1c1ede:null)||(_0x1c1ede[_0x503d0e(0x165)+'ge']?_0x1c1ede:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x5e3d1c){const _0x2ea244=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x5e3d1c)return _0x2ea244;return TARGET_JID;}return _0x2ea244;}function stripDomain(_0x487f3a){const _0x36891e=_0x29d4a9;if(!_0x487f3a||typeof _0x487f3a!==_0x36891e(0x202))return _0x487f3a;const _0x403688=_0x487f3a[_0x36891e(0x1a2)]('@');if(_0x403688===-(0x258a+-0x178c+-0xdfd))return _0x487f3a;return _0x487f3a[_0x36891e(0x18d)](0x1bc3+0x28d+0xf28*-0x2,_0x403688);}async function handleUpsertSingle(_0x28926b){const _0x19f536=_0x29d4a9;try{if(!_0x28926b||!_0x28926b[_0x19f536(0x1be)])return;if(_0x28926b[_0x19f536(0x1be)]?.[_0x19f536(0x18e)]===_0x19f536(0x18c)+_0x19f536(0x124))return;if(Boolean(_0x28926b[_0x19f536(0x1be)]?.[_0x19f536(0x16d)]))return;const _0x847abb=String(_0x28926b[_0x19f536(0x1be)][_0x19f536(0x18e)]||'')+'::'+String(_0x28926b['key']['id']||'');if(isProcessed(_0x847abb))return;markProcessed(_0x847abb);const _0x393fac=Boolean(_0x28926b[_0x19f536(0x1be)]?.[_0x19f536(0x213)]),_0x418cdb=Boolean(_0x28926b[_0x19f536(0x1ff)]?.[_0x19f536(0x217)+'ssage']||_0x28926b[_0x19f536(0x1ff)]?.[_0x19f536(0x217)+_0x19f536(0x203)]);if(!_0x393fac&&!_0x418cdb)return;if(!NOTIFY_VIEWONCE)return;const _0x40fcd9=_0x28926b[_0x19f536(0x214)]||_0x28926b[_0x19f536(0x1be)]?.['participan'+'t']||_0x28926b[_0x19f536(0x1be)]?.[_0x19f536(0x18e)]||null,_0x3066f2=_0x40fcd9?stripDomain(String(_0x40fcd9)):_0x19f536(0x1ef),_0x13cf7a=_0x28926b['key']?.['remoteJid']?stripDomain(_0x28926b[_0x19f536(0x1be)][_0x19f536(0x18e)]):_0x19f536(0x205)+'at',_0xf18107=resolveDestination(_0x28926b[_0x19f536(0x1be)]?.[_0x19f536(0x18e)]);if(!_0xf18107)return;const _0x9f1957=_0x19f536(0x15c)+_0x19f536(0x1de)+_0x19f536(0x169)+_0x3066f2+'\x20in\x20chat\x20'+_0x13cf7a+('.\x0aReply\x20to'+_0x19f536(0x21e)+_0x19f536(0x225)+_0x19f536(0x1a1)+_0x19f536(0x137)+'s\x20with*\x20\x27_'+_0x19f536(0x171)+_0x19f536(0x228)+_0x19f536(0x12a)+_0x19f536(0x1ba));try{await trySend(_0xf18107,{'text':_0x9f1957}),info('['+name+(_0x19f536(0x209)+'\x20')+_0xf18107+(_0x19f536(0x1e2)+'nce\x20from\x20')+_0x3066f2+'\x20in\x20'+_0x13cf7a);}catch(_0x5742f7){warn('['+name+(_0x19f536(0x14d)+_0x19f536(0x135)+':\x20')+(_0x5742f7?.['message']||_0x5742f7));}}catch(_0x165b13){warn('['+name+(_0x19f536(0x1b4)+_0x19f536(0x1c0)+_0x19f536(0x1f1))+(_0x165b13?.[_0x19f536(0x1ff)]||_0x165b13));}}async function upsertHandler({messages:_0x9f14df}){const _0x4c5b7c=_0x29d4a9;try{if(!Array['isArray'](_0x9f14df))return;for(const _0x18473a of _0x9f14df)await handleUpsertSingle(_0x18473a);}catch(_0x1552d8){warn('['+name+(_0x4c5b7c(0x20b)+_0x4c5b7c(0x1a6)+_0x4c5b7c(0x15a))+(_0x1552d8?.['message']||_0x1552d8));}}async function downloadBufferFromContent(_0xdd9d35,_0x4eb0f6){const _0x3064d6=_0x29d4a9;try{if(!_0xdd9d35||!_0x4eb0f6)return null;const _0x576e1d=await downloadContentFromMessage(_0xdd9d35,_0x4eb0f6);if(!_0x576e1d)return null;const _0x5b355c=[];for await(const _0x5a483f of _0x576e1d){_0x5b355c[_0x3064d6(0x1ac)](_0x5a483f);}if(!_0x5b355c['length'])return null;return Buffer[_0x3064d6(0x1b3)](_0x5b355c);}catch(_0x5ed245){return warn('['+name+(_0x3064d6(0x177)+'BufferFrom'+_0x3064d6(0x22b)+_0x3064d6(0x1fe))+(_0x5ed245?.[_0x3064d6(0x1ff)]||_0x5ed245)),null;}}async function forwardRecoveredToDest(_0x5dbd04,_0x2cd6c2,_0x3fab20,_0x493751){const _0x4dfa8f=_0x29d4a9,_0x40262f=resolveDestination(_0x3fab20);if(!_0x40262f)return warn('['+name+(']\x20no\x20desti'+_0x4dfa8f(0x1f0)+_0x4dfa8f(0x1dd))),![];try{const _0x533132=_0x5dbd04?.['imageMessa'+'ge']?.[_0x4dfa8f(0x181)]||_0x5dbd04?.[_0x4dfa8f(0x165)+'ge']?.['caption']||'',_0x577b10=_0x493751?stripDomain(_0x493751):_0x4dfa8f(0x1fb)+'er',_0x1a2cef=_0x3fab20?stripDomain(_0x3fab20):'unknown\x20ch'+'at',_0x6f318=_0x4dfa8f(0x15b)+_0x577b10+'\x20in\x20'+_0x1a2cef,_0x1c604b=_0x4dfa8f(0x14b)+_0x4dfa8f(0x13e)+_0x533132+_0x6f318;if(_0x5dbd04['imageMessa'+'ge'])return await trySend(_0x40262f,{'image':_0x2cd6c2,'caption':_0x1c604b}),info('['+name+(']\x20Sent\x20rec'+_0x4dfa8f(0x142)+_0x4dfa8f(0x1b7))+_0x40262f),!![];if(_0x5dbd04[_0x4dfa8f(0x165)+'ge']){const _0x4ace23=Boolean(_0x5dbd04['videoMessa'+'ge']?.[_0x4dfa8f(0x139)+'k']);return await trySend(_0x40262f,{'video':_0x2cd6c2,'caption':_0x1c604b,'gifPlayback':_0x4ace23}),info('['+name+(_0x4dfa8f(0x18a)+_0x4dfa8f(0x1f8)+'eo\x20to\x20')+_0x40262f),!![];}return await trySend(_0x40262f,{'document':_0x2cd6c2,'fileName':_0x4dfa8f(0x125)+_0x4dfa8f(0x1c2),'mimetype':_0x4dfa8f(0x1a3)+'n/octet-st'+_0x4dfa8f(0x212),'caption':_0x1c604b}),info('['+name+(_0x4dfa8f(0x18a)+'overed\x20doc'+_0x4dfa8f(0x17a))+_0x40262f),!![];}catch(_0x101eb1){return warn('['+name+(']\x20forwardR'+'ecoveredTo'+_0x4dfa8f(0x1aa)+_0x4dfa8f(0x144))+(_0x101eb1?.[_0x4dfa8f(0x1ff)]||_0x101eb1)),![];}}function extractTextFromCtx(_0x241fed){const _0x36d881=_0x29d4a9;if(!_0x241fed||!_0x241fed[_0x36d881(0x1ff)])return'';const _0x5a4db8=_0x241fed[_0x36d881(0x1ff)];return _0x5a4db8[_0x36d881(0x20e)+'on']||_0x5a4db8[_0x36d881(0x1e3)+'xtMessage']?.[_0x36d881(0x180)]||_0x5a4db8['imageMessa'+'ge']?.[_0x36d881(0x181)]||_0x5a4db8[_0x36d881(0x165)+'ge']?.['caption']||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0x3*0x23e+-0xd9f+0x1477)*(-0x1d0f+-0x1*0xe45+0x2f3c);function markCmdProcessed(_0x4b93a1){const _0x4346e8=_0x29d4a9;if(!_0x4b93a1)return;if(processedCmdKeys[_0x4346e8(0x211)](_0x4b93a1))try{clearTimeout(processedCmdKeys[_0x4346e8(0x1ca)](_0x4b93a1));}catch(_0x25eaaa){};const _0x73e973=setTimeout(()=>processedCmdKeys[_0x4346e8(0x11d)](_0x4b93a1),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x4346e8(0x159)](_0x4b93a1,_0x73e973);}function isCmdProcessed(_0x529b7c){const _0x2660fe=_0x29d4a9;return _0x529b7c&&processedCmdKeys[_0x2660fe(0x211)](_0x529b7c);}const recentResponded=new Set();export async function onMessage(_0x516e12){const _0x272faa=_0x29d4a9;try{if(!_0x516e12||!_0x516e12[_0x272faa(0x1be)]||!_0x516e12[_0x272faa(0x1ff)])return;const _0x21622d=_0x516e12[_0x272faa(0x1be)]?.['id']||null;if(_0x21622d){if(recentResponded[_0x272faa(0x211)](_0x21622d))return;recentResponded['add'](_0x21622d),setTimeout(()=>recentResponded['delete'](_0x21622d),(0xb80+-0xff2+-0x257*-0x2)*(0x1*-0x1981+-0xca*-0x2a+-0x3bb*0x1));}if(_0x516e12[_0x272faa(0x219)]){const _0x591521=_0x516e12[_0x272faa(0x1be)][_0x272faa(0x18e)],_0x31548a=typeof _0x591521===_0x272faa(0x202)&&_0x591521[_0x272faa(0x18b)]('@g.us');if(_0x31548a&&!ALLOW_GROUP_COMMANDS){}else{const _0x1d465c=Boolean(_0x516e12[_0x272faa(0x1be)][_0x272faa(0x16d)]);if(!_0x31548a&&!_0x1d465c){const _0x2ed302=await isSudo(botRef,_0x516e12)[_0x272faa(0x21b)](()=>![]);if(!_0x2ed302){}else await handleCommand(_0x516e12)[_0x272faa(0x21b)](_0x5907eb=>warn('['+name+(_0x272faa(0x1af)+'error:\x20')+(_0x5907eb?.[_0x272faa(0x1ff)]||_0x5907eb)));}else{const _0x385955=await isSudo(botRef,_0x516e12)['catch'](()=>![]),_0x21f3c4=Boolean(_0x516e12[_0x272faa(0x1be)][_0x272faa(0x16d)]);(_0x21f3c4||_0x385955)&&await handleCommand(_0x516e12)[_0x272faa(0x21b)](_0x4a4901=>warn('['+name+(_0x272faa(0x1af)+_0x272faa(0x1fa))+(_0x4a4901?.['message']||_0x4a4901)));}}}const _0x2c766c=extractContextInfo(_0x516e12);if(!_0x2c766c||!_0x2c766c[_0x272faa(0x132)+_0x272faa(0x1fd)])return;const _0x39096a=extractTextFromCtx(_0x516e12)||'';if(!_0x39096a)return;const _0x54f41a=_0x39096a[_0x272faa(0x13c)]()[_0x272faa(0x218)](0x4c1+0x7ec+-0xcad);if(_0x54f41a!=='_')return;info('['+name+(_0x272faa(0x15e)+_0x272faa(0x1ee)+_0x272faa(0x156)+_0x272faa(0x1cb)+_0x272faa(0x170)+'ry'));const _0x554a2f=extractViewOnceInnerFromQuoted(_0x2c766c['quotedMess'+'age']);if(!_0x554a2f){warn('['+name+(_0x272faa(0x226)+_0x272faa(0x1a4)+_0x272faa(0x128)+_0x272faa(0x1d3)+'once\x20inner'+'\x20message'));return;}let _0x4c28af=null,_0x3bccd5=null;if(_0x554a2f[_0x272faa(0x1e7)+'ge'])_0x4c28af=_0x554a2f[_0x272faa(0x1e7)+'ge'],_0x3bccd5=_0x272faa(0x1e4);else _0x554a2f[_0x272faa(0x165)+'ge']&&(_0x4c28af=_0x554a2f[_0x272faa(0x165)+'ge'],_0x3bccd5=_0x272faa(0x208));if(!_0x4c28af||!_0x3bccd5){warn('['+name+(_0x272faa(0x158)+_0x272faa(0x199)+_0x272faa(0x136)+'t\x20supporte'+'d\x20media\x20ty'+'pe'));return;}const _0x2d6d92=await downloadBufferFromContent(_0x4c28af,_0x3bccd5);if(!_0x2d6d92){warn('['+name+(_0x272faa(0x178)+_0x272faa(0x122)+_0x272faa(0x206)+_0x272faa(0x14f)));return;}const _0x350c16=_0x516e12[_0x272faa(0x1be)]['remoteJid']||null,_0x1ff04b=_0x2c766c[_0x272faa(0x1ae)+'t']||null,_0x7cc519=await forwardRecoveredToDest(_0x554a2f,_0x2d6d92,_0x350c16,_0x1ff04b);if(!_0x7cc519)warn('['+name+(_0x272faa(0x207)+_0x272faa(0x174)+'Dest\x20retur'+'ned\x20false'));}catch(_0x206eca){error(_0x206eca,'['+name+(_0x272faa(0x1b9)+_0x272faa(0x1b2)+_0x272faa(0x1fa))+(_0x206eca?.[_0x272faa(0x1ff)]||_0x206eca));}}async function handleCommand(_0x5dac69){const _0x58828c=_0x29d4a9;try{if(!_0x5dac69||!_0x5dac69[_0x58828c(0x1be)]||!_0x5dac69[_0x58828c(0x1ff)])return;const _0x5dc19a=_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x18e)],_0x53385e=typeof _0x5dc19a==='string'&&_0x5dc19a[_0x58828c(0x18b)]('@g.us');if(_0x53385e&&!ALLOW_GROUP_COMMANDS)return;const _0x591faf=Boolean(_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x16d)]);if(!_0x53385e&&!_0x591faf){const _0x3c2290=await isSudo(botRef,_0x5dac69)['catch'](()=>![]);if(!_0x3c2290)return;}const _0x29976a=Boolean(_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x16d)]),_0x4709ee=await isSudo(botRef,_0x5dac69)[_0x58828c(0x21b)](()=>![]);let _0x5e0ecd;if(_0x29976a)_0x5e0ecd=getBotJid()||_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x18e)]||_0x5dac69['key']['participan'+'t']||null,!_0x5e0ecd&&(warn('['+name+(']\x20getBotJi'+_0x58828c(0x197)+_0x58828c(0x17e)+'ng\x20back\x20to'+_0x58828c(0x157)+_0x58828c(0x127))),_0x5e0ecd=_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x18e)]||null);else{if(_0x4709ee)_0x5e0ecd=_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x18e)];else return;}if(!_0x5e0ecd){warn('['+name+(']\x20no\x20confi'+'rmation\x20ta'+_0x58828c(0x20a)+'rting\x20comm'+_0x58828c(0x1ab)));return;}const _0x1694b0=String(_0x5dac69[_0x58828c(0x1be)][_0x58828c(0x18e)]||'')+'::'+String(_0x5dac69[_0x58828c(0x1be)]['id']||_0x5dac69['key']['participan'+'t']||'');if(isCmdProcessed(_0x1694b0))return;markCmdProcessed(_0x1694b0);const _0x33b32=typeof _0x5dac69['text']===_0x58828c(0x202)&&_0x5dac69[_0x58828c(0x180)]['trim']()[_0x58828c(0x163)]?_0x5dac69[_0x58828c(0x180)][_0x58828c(0x13c)]():function _0x2b2a37(_0x3c6d78){const _0x5a48eb=_0x58828c;if(!_0x3c6d78||!_0x3c6d78[_0x5a48eb(0x1ff)])return'';const _0x3ebaf7=_0x3c6d78['message'];if(_0x3ebaf7[_0x5a48eb(0x20e)+'on'])return _0x3ebaf7[_0x5a48eb(0x20e)+'on'];if(_0x3ebaf7[_0x5a48eb(0x1e3)+_0x5a48eb(0x141)]?.[_0x5a48eb(0x180)])return _0x3ebaf7['extendedTe'+_0x5a48eb(0x141)][_0x5a48eb(0x180)];if(_0x3ebaf7['imageMessa'+'ge']?.[_0x5a48eb(0x181)])return _0x3ebaf7[_0x5a48eb(0x1e7)+'ge'][_0x5a48eb(0x181)];if(_0x3ebaf7[_0x5a48eb(0x165)+'ge']?.[_0x5a48eb(0x181)])return _0x3ebaf7[_0x5a48eb(0x165)+'ge'][_0x5a48eb(0x181)];if(_0x3ebaf7[_0x5a48eb(0x1df)+_0x5a48eb(0x126)+'ge']?.['selectedBu'+'ttonId'])return _0x3ebaf7[_0x5a48eb(0x1df)+'ponseMessa'+'ge']['selectedBu'+_0x5a48eb(0x12e)];if(_0x3ebaf7[_0x5a48eb(0x140)+_0x5a48eb(0x1cd)]?.['singleSele'+'ctReply']?.['selectedRo'+_0x5a48eb(0x11f)])return _0x3ebaf7['listRespon'+_0x5a48eb(0x1cd)][_0x5a48eb(0x19a)+_0x5a48eb(0x12d)][_0x5a48eb(0x1c1)+_0x5a48eb(0x11f)];return'';}(_0x5dac69)||'';if(!_0x33b32)return;const _0xd7836d=(_0x33b32[_0x58828c(0x229)](/\r?\n/)[-0xbb3+-0x162c+-0x17*-0x179]||'')['trim'](),_0x4efbfb=_0xd7836d['split'](/\s+/),_0xa4ecb9=(_0x4efbfb[0x1091*-0x2+0x1*0xee+0x2*0x101a]||'')[_0x58828c(0x16b)+'e']();if(!commands[_0x58828c(0x1ed)](_0xa4ecb9))return;const _0x38eb07=(_0x4efbfb[0x689*-0x2+-0x2c5*-0x7+-0x650]||'')[_0x58828c(0x16b)+'e']();if(_0x38eb07===_0x58828c(0x1f3)){const _0x4ca7a=(_0x4efbfb[0xcd2+0xffe+-0x6*0x4cd]||'')[_0x58828c(0x16b)+'e']();if(!_0x4ca7a){await trySend(_0x5e0ecd,{'text':'[viewonce]'+_0x58828c(0x184)+_0x58828c(0x1d4)+_0x58828c(0x17c)+(NOTIFY_VIEWONCE?'ON':_0x58828c(0x14a))+'*'});return;}const _0x5f0cc3=_0x4ca7a==='on'||_0x4ca7a==='1'||_0x4ca7a===_0x58828c(0x196),_0x47ed6e=await savePref(_0x58828c(0x148)+_0x58828c(0x188),_0x5f0cc3?'1':'0');if(!_0x47ed6e){await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+_0x58828c(0x1a7)+_0x58828c(0x138)+_0x58828c(0x1c5)+_0x58828c(0x193)});return;}await trySend(_0x5e0ecd,{'text':'[viewonce]'+_0x58828c(0x184)+_0x58828c(0x173)+'o\x20*'+(_0x5f0cc3?'ON':_0x58828c(0x14a))+'*'});return;}if(_0x38eb07==='p'||_0x38eb07==='pm'){const _0x3bdc65=await savePref('mode','p');if(!_0x3bdc65){await trySend(_0x5e0ecd,{'text':'[viewonce]'+_0x58828c(0x1a7)+_0x58828c(0x1d7)});return;}await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+'\x20Mode\x20set\x20'+_0x58828c(0x151)});return;}if(_0x38eb07==='g'||_0x38eb07===_0x58828c(0x216)||_0x38eb07==='gp'){const _0x15b3a4=await savePref('mode','g');if(!_0x15b3a4){await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+_0x58828c(0x1a7)+'\x20set\x20mode.'});return;}const _0x153aa6=TARGET_JID?_0x58828c(0x1f9)+_0x58828c(0x14c)+TARGET_JID:'No\x20target\x20'+_0x58828c(0x168);await trySend(_0x5e0ecd,{'text':'[viewonce]'+'\x20Mode\x20set\x20'+_0x58828c(0x1a9)+_0x153aa6});return;}if(_0x38eb07&&_0x38eb07[_0x58828c(0x1ed)]('@')){const _0x2bb80a=normalizeToUserJid(_0x38eb07),_0x1dfdee=await savePref('target_jid',_0x2bb80a);if(_0x1dfdee)await trySend(_0x5e0ecd,{'text':'[viewonce]'+_0x58828c(0x150)+'D\x20saved:\x20'+_0x2bb80a});else await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+_0x58828c(0x1a7)+_0x58828c(0x162)+_0x58828c(0x19b)+_0x2bb80a});return;}if(_0x38eb07===_0x58828c(0x13a)||_0x38eb07===_0x58828c(0x182)||_0x38eb07==='remove'){const _0x5ba443=await savePref(_0x58828c(0x147),'');if(_0x5ba443)await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+_0x58828c(0x150)+_0x58828c(0x1b1)});else await trySend(_0x5e0ecd,{'text':_0x58828c(0x1d6)+_0x58828c(0x1a7)+_0x58828c(0x1d5)+'get\x20JID.'});return;}const _0x47cb8f=MODE==='g'?_0x58828c(0x1ce)+(TARGET_JID||_0x58828c(0x19e))+')':'PM';await trySend(_0x5e0ecd,{'text':_0x58828c(0x131)+_0x58828c(0x1c8)+_0x58828c(0x204)+'ly)*\x0a\x0a'+(_0x58828c(0x1cf)+_0x58828c(0x1fc)+(NOTIFY_VIEWONCE?'ON':'OFF')+(_0x58828c(0x133)+_0x58828c(0x1c4)+_0x58828c(0x19f)))+(_0x58828c(0x1bb)+'et*:\x20'+_0x47cb8f+(_0x58828c(0x133)+'\x20p|g`\x0a'))+(_0x58828c(0x161)+_0x58828c(0x22a)+(TARGET_JID||_0x58828c(0x187))+(_0x58828c(0x11e)+_0x58828c(0x13f)))+('To\x20recover'+':\x20reply\x20to'+_0x58828c(0x145)+_0x58828c(0x166)+_0x58828c(0x21c)+_0x58828c(0x17d)+'at\x20starts\x20'+_0x58828c(0x191)+_0x58828c(0x156)+').')});}catch(_0x2aed95){warn('['+name+(_0x58828c(0x16e)+_0x58828c(0x1cc)+'r:\x20')+(_0x2aed95?.[_0x58828c(0x1ff)]||_0x2aed95));}}export async function initialize(_0x404f23){const _0x413ced=_0x29d4a9;if(!_0x404f23)throw new Error(_0x413ced(0x1f7)+'nitialize\x20'+_0x413ced(0x227)+_0x413ced(0x185)+'e');botRef=_0x404f23,await ensureSchema(),refreshConfig(),_0x404f23['on']('messages.u'+'psert',upsertHandler),info('['+name+(']\x20initiali'+'zed\x20(centr'+'alized\x20lis'+_0x413ced(0x224)));}export async function cleanup(){const _0x2391d7=_0x29d4a9;try{botRef&&typeof botRef['off']===_0x2391d7(0x201)&&botRef[_0x2391d7(0x12c)](_0x2391d7(0x14e)+_0x2391d7(0x1bf),upsertHandler);for(const _0x277314 of processedKeys[_0x2391d7(0x1c9)]())try{clearTimeout(_0x277314);}catch(_0x5a7e76){}processedKeys['clear']();}catch(_0x4dc09f){warn(name+(_0x2391d7(0x1ea)+_0x2391d7(0x1fa))+(_0x4dc09f?.[_0x2391d7(0x1ff)]||_0x4dc09f));}finally{botRef=null,info(name+(_0x2391d7(0x1c6)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};